         TITLE ' IEDQOT01 - TCAM RESOURCE TERMINATION MANAGER '         00200000
IEDQOT01 CSECT                                                          00800021
*A-000000-999999                                               @Y02X6B0 00810000
         SPACE 3                                                        00850005
*  CHANGE ACTIVITY AS FOLLOWS                                           00900005
******************** MICROFICHE FLAGS *********************** SUPT CODE 00950005
*A596000,612000                                                 SA51771 01000005
*D548000-572000,576000-596000,597800,600000-612000               Y01004 01000105
*A572000,5984000                                                SA62368 01000205
*C304000                                                        SA62368 01000305
*D308000-316000,598400-599000,614000-668000,676000-692000       SA62368 01000405
*C292000-304000,597200                                           Y05330 01000505
*D060000-068000,232000-236000,244000,268000,7599600-672000,      Y05330 01000605
*D708000-712000,724000-732000                                    Y05330 01000705
*A778100                                                       @Z30AABG 01000800
*C418802                                                       @Z30AABG 01009800
*D761600                                                       @Z30AABG 01020700
*D345676                                                       @ZA02643 01030700
*C344160,344004-344616,345000-345336,345363-345372,345393      @ZA02601 01040700
*D287000,346395,346480-346780                                  @ZA02601 01050700
*A340000,344622,344760-344770,345480,547802,574000             @ZA02601 01100700
*C345417-345423,345503-345676,345710-345750,345860             @ZA02601 01150700
*C346170-346200,346340-346365,346450-346455                    @ZA02601 01200700
*C424802,587000,590000,602000,605000,607112-607126             @ZA02601 01250700
*C607450-607750,618000,626300-626600,628640-628992             @ZA02601 01300700
*A614000,758000,777000,788000,791200                           @ZA02601 01350700
*C637090-670000                                                @ZA02601 01400700
*C345315-345370                                                @ZA03055 01408700
*A346160                                                       @ZA04027 01416700
*C649090                                                       @ZA04027 01424700
*A547802,759500,778200,798000                                  @Z40X9BG 01432700
*C038000,346460,424802,593000                                  @Z40X9BG 01440700
*C346345-346390                                                @Z40X9BG 01450700
*D345427,345432                                                @ZA07067 01457700
*D345365-345367                                                @ZA07078 01464700
*A345370                                                       @ZA07078 01471700
*A345452,345480                                                @ZA07083 01480700
*C607550-607600                                                @OZ08086 01490700
*C670690                                                       @OZ07798 01500700
*A344180                                                       @OZ07816 01510700
*C344780-344820                                                @OZ07816 01517700
*D345048-345056,614300-614600                                  @OZ07816 01524700
*C758500                                                       @OZ09293 01531700
*C345437-345452                                                @OZ08374 01540700
*C346377                                                       @OZ08384 01551100
*A676290                                                       @OZ16542 01556100
*C656290                                                       @OZ17630 01561100
*A651490,652290,655490,656690,778100                           @OZ17630 01571100
*C346680                                                       @G36XRBB 01580100
*A541862                                                       @G36XRBB 01589100
*                                       PEWA DSECT CHG         @OZ27843 01592100
*A554102                                                       @OZ26963 01595100
*C554102-554312                                                @OZ29317 01595286
*A652690                                                       @OZ32424 01595386
*C543122                                                       @OZ33173 01595486
         SPACE 3                                                        01600005
************************START OF SPECFICATIONS************************* 01800000
*                                                                     * 02000000
*                                                                     * 02200000
* MODULE NAME = IEDQOT01                                              * 02300000
*                                                                     * 02400000
* DESCRIPTIVE NAME = RESOURCE TERMINATION MANAGER (RTM)               * 02600000
*                                                                     * 02800000
* COPYRIGHT = NONE                                                    * 03000000
*                                                                     * 03200000
* STATUS = LEVEL 9                                             @Z40X9BG 03400000
*                                                                     * 03600000
* FUNCTION = CLEAN UP TCAM RESOURCES                                  * 03800000
*                                                                     * 04000000
* NOTES = SEE BELOW                                                   * 04200000
*                                                                     * 04400000
*    DEPENDENCIES = NONE                                              * 04600000
*                                                                     * 04800000
*    RESTRICTIONS = NONE                                              * 05000000
*                                                                     * 05200000
*    REGISTER CONVENTIONS = R2  BRANCH AND LINK REGISTER              * 05400000
*                           R3  POINTER TO CVT                        * 05600000
*                           R5  POINTER TO RTM WORK AREA              * 06000000
*                           R6  POINTER TO TCX                        * 06200000
*                           R7  ADDRESS SPACE ID REGISTER             * 06300000
*                           R8  POINTER TO RMPL                       * 06400000
*                           R9  BASE REGISTER                         * 06500000
*                           R10 POINTER TO PEB                        * 06600000
*                           R11 POINTER TO AIB                        * 06800000
*                           R12 POINTER TO PEWA                       * 07200000
*                           R13 SAVE AREA POINTER                     * 07400000
*                                                                     * 07600000
*    PATCH LABEL = PATCH                                              * 07800000
*                                                                     * 08000000
* MODULE TYPE = PROCEDURE                                             * 08200000
*                                                                     * 08400000
*    PROCESSOR = ASSEMBLER XF                                         * 08600000
*                                                                     * 08800000
*    ATTRIBUTES = REENTRANT, SUPERVISOR STATE, KEY 0                  * 09000000
*                                                                     * 09200000
* ENTRY POINT = IEDQOT01                                              * 09400000
*                                                                     * 09600000
*    PURPOSE = SEE FUNCTION                                           * 09800000
*                                                                     * 10000000
*    LINKAGE = CONTROL PASSED TO THIS MODULE FROM IGC0001C VIA        * 10200000
*              A CALL MACRO                                           * 10400000
*                                                                     * 10600000
* INPUT = R1  LOADED WITH THE PARAMETER LIST ADDRESS                  * 10800000
*         R13 POINTS TO STANDARD SAVE AREA                            * 11000000
*         R14 CONTAINS RETURN ADDRESS                                 * 11200000
*         R15 CONTAINS ENTRY POINT OF THIS MODULE                     * 11400000
*                                                                     * 11600000
* OUTPUT = NONE                                                       * 11800000
*                                                                     * 12000000
* EXIT-NORMAL = RETURN TO IGC0001C VIA RETURN MACRO WITH R15 = 0      * 12200000
*                                                                     * 12400000
* EXIT-ERROR = NONE                                                   * 12600000
*                                                                     * 12800000
* EXTERNAL REFERENCES = SEE BELOW                                     * 13000000
*                                                                     * 13200000
*    ROUTINES = NONE                                                  * 13400000
*                                                                     * 13600000
*    DATA AREAS = RESOURCE MANAGER WORK AREA ADDRESSED BY             * 13800000
*                 RMPLRMWA.                                           * 14000000
*                                                                     * 14200000
*    CONTROL BLOCKS = AIB (APPLICATION INTERFACE BLOCK)               * 14400000
*                     AVT (TCAM'S ADDRESS VECTOR TABLE)               * 15000000
*                     CVT                                             * 15200000
*                     PEB (PROCESS EXTENSION BLOCK)                   * 15400000
*                     PEWA (PROCESS ENTRY WORK AREA)                  * 15600000
*                     PSA (PREFIXED SAVE AREA)                        * 15800000
*                     RECB (RESOURCE ELEMENT CONTROL BLOCK)           * 16000000
*                     RMPL (RESOURCE MANGER PARAMETER LIST)           * 16200000
*                     TCX (TCAM CVT EXTENSION)                        * 16400000
*                                                                     * 16600000
* TABLES = NONE                                                       * 16800000
*                                                                     * 17200000
* MACROS = CALLRTM                                                    * 17400000
*          FREEMAIN                                                   * 17600000
*          GETMAIN                                                    * 17800000
*          IOSGEN                                                     * 18000000
*          MODESET                                                    * 18200000
*          SETLOCK                                                    * 18400000
*          TCABEND                                                    * 18600000
*                                                                     * 18800000
* CHANGE ACTIVITY = NONE                                              * 19000000
*                                                                     * 19200000
*************************END OF SPECIFICATIONS************************* 19400000
         EJECT                                                          22000021
*        REGISTER USAGE                                                 22400021
*                                                                       22800021
RZERO    EQU   0                        WORK REGISTER            Y02027 22900000
RONE     EQU   1                        WORK REGISTER            Y02027 23100000
RBRANCH  EQU   2                        BRANCH REGISTER          Y02027 23400000
RCVT     EQU   3                        CVT DSECT BASE REGISTER         24000021
RPEBF    EQU   4                        POINTER TO PEB PRECEDING Y02027 24200000
*                                       THE CURRENT PEB          Y02027 24400000
RRTMWA   EQU   5                        POINTER TO RTM WORK AREA Y02027 24860000
RTCX     EQU   6                        THE TCX BASE REGISTER    Y02027 24920000
RASID    EQU   7                        ADDRESS SPACE ID REG     Y02027 24980000
RUCB     EQU   7                        UCB REGISTER             Y02027 25040000
RRMPL    EQU   8                        ADDR OF RESOURCE MANAGER Y02027 25070000
*                                       PARAMETER LIST           Y02027 25100000
RBASE    EQU   9                        IEDQOT01 BASE REGISTER   Y02027 25150000
RPEB     EQU   10                       PROCESS ENTRY BLOCK ADDR Y02027 25170000
RAIB     EQU   11                       AIB BASE REGISTER        Y02027 25200000
RTCB     EQU   11                       TCB BASE REGISTER        Y02027 25600000
RLOOKUP  EQU   11                       UCB LOOKUP TABLE POINTER Y02027 26000000
RUCBEXT  EQU   12                       UCB EXTENSION            Y02027 26100000
RPEWA    EQU   12                       BASE REG FOR PEWA        Y02027 26220000
RSAVE    EQU   13                       SAVE AREA POINTER        Y02027 26300000
RRECB    EQU   14                       RECB BASE REGISTER       Y02027 26600000
R15      EQU   15                       REGISTER 15              Y02027 26800000
         SPACE 3                                                        27000000
*        REGISTER EQUATES USED ONLY FOR CROSS MEMORY POST        Y02027 27200000
         SPACE 1                                                        27230000
RPOST9   EQU   9                        REG SAVE AREA FOR POST   Y02027 27260000
RPOST10  EQU   10                       COMPLETION CODE          Y02027 27290000
RPOST11  EQU   11                       ECB ADDRESS              Y02027 27320000
RPOST12  EQU   12                       ERRET ENTRY POINT        Y02027 27350000
RPOST13  EQU   13                       ASCB ADDRESS             Y02027 27400000
RPOST14  EQU   14                       RETURN ADDRESS           Y02027 27450000
RPOST15  EQU   15                       POST ENTRY POINT         Y02027 27500000
         SPACE 2                                                        27550000
*                                                                       27600021
         USING CVT,RCVT                 CVT DSECT                       28000021
         USING RTMWA,RRTMWA             WORK AREA DSECT          Y02027 28080000
         USING IEDQPEB,RPEB             PROCESS ENTRY BLOCK ADDR Y02027 28160000
         USING RMPL,RRMPL               RECOVERY PARAMETER LIST  Y02027 28240000
         USING IEDQTCX,RTCX             TCX DSECT                Y02027 28320000
         USING IEDQPEWA,RPEWA           PROCESS ENTRY WORK AREA  Y02027 28400000
         USING IEDQAIB,RAIB             AIB DSECT                Y02027 28500000
         EJECT                                                          28600000
***************************************************************  Y02027 28700000
*                                                             *  Y02027 28800000
*        SET UP BASE REGISTER AND PARAMETER LIST              *  Y02027 28850000
*        ADDRESSABILITY                                       *  Y02027 28900000
*                                                             *  Y02027 28950000
***************************************************************  Y02027 29000000
         SAVE  (14,12)                  SAVE THE CALLER'S REGS   Y02027 29050000
         SPACE 2                                                        29100000
         LR    RBASE,R15                SET BASE REGISTER        Y02027 29150000
         USING IEDQOT01,RBASE           ADDRESSABILITY           Y02027 29200000
         SPACE 2                                                        30000000
IEDQOT01 IEDHJN START                   SET DATE                 Y02027 30800000
         SPACE 2                                                        31600000
         L     RRMPL,ZERO(RONE)         LOAD THE PARAMETER LIST  Y02027 32000000
*                                       ADDRESS                  Y02027 32400000
         L     RRTMWA,RMPLRMWA          GET ADDR OF RTM WORK AREAY02027 33200000
         ST    RSAVE,SAVE13             SAVE CALLER'S REG 13 IN  Y02027 33400000
*                                       WORK AREA                Y02027 33600000
         SR    RCVT,RCVT                CLEAR FOR STORE        @ZA02601 33800000
         ST    RCVT,PTRSA               CLEAR SAVE AREA POINTER@ZA02601 34000000
         L     RCVT,CVTPTR              LOAD THE CVT ADDRESS            34400021
         EJECT                                                          34401000
***************************************************************  Y02027 34402000
*                                                             *  Y02027 34404000
*        IF TCAM IS NOT IN THE SYSTEM, THEN SKIP IEDQOT01     *  Y02027 34406000
*                                                             *  Y02027 34408000
***************************************************************  Y02027 34410000
         ICM   RTCX,ADDR,CVTAQAVT+ONE   GET TCX ADDRESS          Y02027 34412000
         BZ    RETURN1                  IF TCX ADDR IS 0, THEN @ZA02601 34414000
*                                       BRANCH                   Y02027 34416000
         BAL   RBRANCH,GETSA            GET SAVE AREA          @OZ07816 34418000
         BAL   RBRANCH,LOCK             GET LOCAL & CMS LOCK   @OZ07816 34418400
         CLM   RTCX,ADDR,CVTAQAVT+ONE   TCX STILL VALID        @OZ07816 34418800
         BNE   RETURN                   NO, RETURN             @OZ07816 34419200
         SPACE 3                                                 Y02027 34419600
***************************************************************  Y02027 34420000
*                                                             *  Y02027 34422000
*        DETERMINE IF THE TERMINATING TASK OR MEMORY IS TCAM  *  Y02027 34424000
*                                                             *  Y02027 34426000
***************************************************************  Y02027 34430000
         TM    RMPLFLG1,RMPLTERM        IS THIS A MEMORY         Y02027 34432000
*                                         TERMINATION            Y02027 34438000
         BO    TASKTEST                 YES, BRANCH              Y02027 34440000
         CLC   RMPLTCBA+ONE(L3),TCXTCB+ONE DOES TCAM'S TCB ADDR  Y02027 34442000
*                                       MATCH THAT OF THE        Y02027 34444000
*                                       TERMINATING TASK         Y02027 34445000
         BNE   PROCTERM                 NO, BRANCH               Y02027 34446000
TASKTEST EQU   *                                                 Y02027 34448000
         CLC   RMPLASCB+ONE(L3),TCXASCB+ONE DOES TCAM'S ASCB ADDRY02027 34450000
*                                       MATCH THAT OF THE        Y02027 34452000
*                                       TERMINATING MEMORY OR    Y02027 34452800
*                                       THE MEMORY OF THE        Y02027 34453600
*                                       TERMINATING TASK         Y02027 34454400
         BNE   PROCTERM                 NO, BRANCH               Y02027 34455200
         SPACE 2                                                        34456000
***************************************************************  Y02027 34458000
*                                                             *  Y02027 34458300
*        CHECK TCXRTM. IF THE FLAG IS SET, THEN IEDQOT01 HAS  *  Y02027 34458400
*        ALREADY BEEN CALLED FOR TCAM MCP TERMINATION  --     *  Y02027 34458600
*        RETURN TO CALLER. IF TCXRTM IS NOT SET, CONTINUE.    *  Y02027 34458900
*                                                             *  Y02027 34459000
***************************************************************  Y02027 34459200
         OI    TCXFLAG1,TCXMCPCD        INDICATE THAT TCAM IS  @ZA02601 34460100
*                                       TERMINATING AND THAT     Y02027 34461000
*                                       RTM HAS BEEN CALLED      Y02027 34461900
         OI    TCXFLAG1,TCXMCPCD        AGAIN FOR MP           @ZA02601 34462200
         EJECT                                                          34462500
***************************************************************  Y02027 34462800
*                                                             *  Y02027 34463200
*        ISSUE TCABEND IF TSO IS ACTIVE                       *  Y02027 34463600
*                                                             *  Y02027 34464000
***************************************************************  Y02027 34468000
         ICM   RONE,ALL,TCXRPT          IS TSO ACTIVE            Y02027 34470000
         BZ    CHKPEB                   NO, BRANCH               Y02027 34472000
         TM    TCXFLAG1,TCXRTM          RECURRSION ON MCP ABEND@ZA02601 34475000
         BO    CHKPEB                   YES, BRANCH            @ZA02601 34476000
         BAL   RBRANCH,UNLOCK           RELEASE LOCKS          @OZ07816 34477000
         TCABEND ,                      ABEND TSO                Y02027 34478000
         BAL   RBRANCH,GETSA            GET SAVE AREA          @OZ07816 34481000
         BAL   RBRANCH,LOCK             GET LOCAL & CMS LOCK   @OZ07816 34484000
         CLM   RTCX,ADDR,CVTAQAVT+ONE   TCX STILL VALID        @OZ07816 34487000
         BNE   RETURN                   NO, RETURN             @OZ07816 34490000
         EJECT                                                          34493000
***************************************************************@ZA02601 34498000
*                                                              @ZA02601 34500000
*        CHECK FOR APPLICATION WAITING ON MCP                  @ZA02601 34500800
*                                                              @ZA02601 34501600
***************************************************************@ZA02601 34502400
CHKPEB   EQU   *                                               @ZA02601 34503200
         LA    RAIB,TCXAIBC             PTR TO AIBS            @ZA02601 34504000
LOOPAIB  EQU   *                                               @ZA02601 34506400
         ICM   RAIB,ADDR,AIBCHAIN       GET AIB                @ZA02601 34507200
         BZ    CHKPEB1                  END OF CHAIN           @ZA02601 34508000
         TM    AIBSTATE-IEDQAIB(RAIB),ABEND AIB IN USE         @ZA02601 34508800
         BNO   LOOPAIB                  NO, SKIP TO NEXT       @ZA02601 34509600
         L     RRECB,AIBECBA-IEDQAIB(RAIB) GET OPEN/CLOSE FLAG @ZA02601 34510400
         CLM   RRECB,ALL,OPEN           OPEN IN PROGRESS       @ZA02601 34511200
         BNE   CLOSEAIB                 NO, CHECK CLOSE        @ZA02601 34512000
         MVI   RCBERR-IEDQRECB+AIBKEY-IEDQAIB(RAIB),NOTCAM     @ZA02601 34512800
*                                       SET TCAM NOT IN SYSTEM @ZA02601 34513600
         B     APPLPOST                 POST APPL OPEN         @ZA02601 34514400
CLOSEAIB EQU   *                                               @ZA02601 34515200
         CLM   RRECB,ALL,CLOS           CLOSE IN PROGRESS      @ZA02601 34516000
         BE    APPLPOST                 YES, POST APPL COMPLETE@ZA02601 34516800
         B     LOOPAIB                  CHECK NEXT AIB         @ZA02601 34517600
CHKPEB1  EQU   *                                               @ZA02601 34518400
         LA    RPEB,TCXPEBC             DUMMY FIRST PEB        @ZA02601 34519200
LOOPPEB  EQU   *                                               @ZA02601 34520000
         LTR   RPEBF,RPEB               COPY PEB ADDRESS       @ZA02601 34520800
         BZ    FREESA                   END OF PEB CHAIN       @ZA02601 34521600
         ICM   RPEB,ALL,PEBLINK         GET NEXT PEB           @ZA02601 34522400
         BZ    FREESA                   END OF PEB CHAIN       @ZA02601 34523200
         CLC   PEBASCB,QOT1             RTM ALREADY TRIED PEB  @ZA02601 34524000
         BNE   CALLRTM                  PEB NOT PROCESSED BY   @ZA02601 34524800
*                                       RTM                    @ZA02601 34525600
RMVPEB   EQU   *                                               @ZA02601 34526400
         BAL   RRECB,DLKPEWA            DELINK PEWA AND PEB    @ZA02601 34527200
         B     LOOPPEB                  CHECK NEXT PEB         @ZA02601 34528000
APPLPOST EQU   *                                               @ZA02601 34528800
         XC    AIBECBA-IEDQAIB(FOUR,RAIB),AIBECBA-IEDQAIB(RAIB) ZA02601 34529600
*                                       CLEAR SPECIAL FLAG     @ZA02601 34530400
***************************************************************  Y02027 34531200
*                                                             *  Y02027 34533900
*        SAVE REGISTERS AND SET UP FOR BRANCH ENTRY INTO      *  Y02027 34534200
*        CROSS MEMORY POST TO POST APPLICATION PROGRAM CLOSE  *  Y02027 34534500
*                                                             *  Y02027 34534800
***************************************************************  Y02027 34535100
         L     RONE,PTRSA               GET POINTER TO SAVE AREA Y02027 34535400
         STM   RZERO,R15,ZERO(RONE)     SAVE ALL REGISTERS       Y02027 34535700
         L     RPOST13,RCBASCB-IEDQRECB+AIBKEY-IEDQAIB(RAIB)   @ZA02601 34536000
*                                       GET ASCB ADDRESS       @ZA02601 34536100
         SR    RPOST10,RPOST10          CLEAR FOR COMP CODE    @ZA02601 34536200
         IC    RPOST10,RCBERR-IEDQRECB+AIBKEY-IEDQAIB(RAIB) SET@ZA02601 34536300
*                                       COMPLETION CODE        @ZA02601 34536400
         L     RPOST11,RCBPECB-IEDQRECB+AIBKEY-IEDQAIB(RAIB)   @ZA07078 34536500
*                                        ECB ADDRESS           @ZA07078 34536600
         ICM   RPOST11,HIGHORDR,HIBIT   SET CROSS MEM POST     @ZA07078 34536700
         LA    RPOST12,CVTBRET          LOAD BR 14 AS ERRET ADDR Y02027 34536800
         L     RPOST15,CVT0PT01         POST ENTRY PT IEA0PT01   Y02027 34536900
         LR    RPOST9,RONE              SAVE AREA ADDR           Y02027 34537000
         BALR  RPOST14,RPOST15          POST ECB                 Y02027 34538100
         SPACE 1                                                        34538200
         LM    RZERO,R15,ZERO(RPOST9)   RESTORE REGISTERS        Y02027 34538400
         B     LOOPAIB                  CHECK NEXT AIB         @ZA02601 34538700
         EJECT                                                          34538800
***************************************************************  Y02027 34539000
*                                                             *  Y02027 34539300
*        ISSUE CALLRTM FOR APPLICATION PROGRAM                *  Y02027 34540200
*                                                             *  Y02027 34540500
***************************************************************  Y02027 34540800
CALLRTM  EQU   *                                                 Y02027 34541100
         ICM   RTCB,ALL,PEBTCB          TCB ADDRESS            @ZA02601 34541400
         BZ    RMVPEB                   BRANCH NO TCB          @ZA02601 34541700
         TM    PEBFLAG,PEBTERM          APPL ALREADY TERMINTED @OZ08374 34542200
         BO    RMVPEB                   YES, DELINK PEB & PEWAS@OZ08374 34542700
         L     RASID,PEBASID            ASID FOR APPL          @OZ08374 34543200
         L     RSAVE,PTRSA              GET SAVE AREA ADDRESS  @OZ08374 34543700
         CLC   PEBASCB+1(L3),PSAAOLD+1-PSA(RZERO) IS A.P. A    @OZ08374 34544000
*                                       SUBTASK OF THE MCP     @OZ08374 34544100
         BNE   DUMP                     BR, NO                 @OZ08374 34544200
         TM    TCBFLGS-IEDQTCB(RTCB),TERM  IS A.P. TERMINATING @OZ08374 34544300
         BNZ   DUMPED                   YES,SET TERMINATING BIT@OZ08374 34544400
DUMP     EQU   *                                               @OZ08374 34544500
         TM    TCXFLAG1,TCXAPDMP        IS APPL DUMP REQUESTED @OZ08374 34544600
         BZ    NODUMP                   NO, DON'T REQUEST DUMP @OZ08374 34544700
         CALLRTM TYPE=ABTERM,COMPCOD=X'046',TCB=(RTCB),ASID=(RASID),   *34544800
               DUMP=YES                                        @ZA07083 34544900
         B     DUMPED                   DUMP REQUESTED         @ZA07083 34545000
NODUMP   EQU   *                                               @ZA07083 34545100
         CALLRTM TYPE=ABTERM,COMPCOD=X'046',TCB=(RTCB),ASID=(RASID),   *34545300
               DUMP=NO                                           Y02027 34546000
DUMPED   EQU   *                                               @ZA07083 34548000
         OI    PEBFLAG,PEBTERM          MARK APPL TERMINATED   @ZA02601 34548600
         B     LOOPPEB                  PROCESS NEXT PEB       @ZA02601 34549200
         EJECT                                                   Y02027 34549600
FREESA   EQU   *                                               @ZA02601 34550000
         TM    TCXFLAG1,TCXRTM          RECURRSION             @ZA02601 34550500
         BO    PEBFREE                  YES, BRANCH            @ZA02601 34551000
         OI    TCXFLAG1,TCXRTM          SET RECURRSION FLAG    @ZA02601 34551700
         TM    RMPLFLG1,RMPLTERM        IS THIS MCP MEMORY     @ZA02601 34552400
*                                       TERMINATION            @ZA02601 34553100
         BO    PEBFREE                  YES, FREE CNTRL BLOCKS @ZA02601 34553800
         ICM   RPEB,ALL,TCXPEBC         FIRST PEB ON CHAIN     @ZA02601 34554500
         BNZ   RETURN                   CHAIN NOT EMPTY        @ZA02601 34554800
PEBFREE  EQU   *                                               @ZA02601 34555200
         L     RPEB,TCXPEBC             FIRST PEB ON CHAIN     @ZA02601 34556600
         SR    RONE,RONE                CLEAR FOR CS           @ZA02601 34557300
PEBFREE1 EQU   *                                               @ZA02601 34558000
         CS    RPEB,RONE,TCXPEBC        REMOVE PEBS FROM CHAIN @ZA02601 34558700
         BNE   PEBFREE1                 RETRY IF FAILED        @ZA02601 34559400
FRPEBS   EQU   *                                               @ZA02601 34560100
         LTR   RPEB,RPEB                END OF CHAIN           @ZA02601 34560800
         BZ    FREEPEWA                 YES, BRANCH            @ZA02601 34561500
         LR    RONE,RPEB                COPY PEB ADDRESS       @ZA02601 34562200
         L     RPEB,PEBLINK             NEXT PEB               @ZA02601 34562900
         LA    RZERO,PEBSIZE            LENGTH OF PEB          @ZA02601 34563600
         BAL   RBRANCH,FREE231          FREE PEB               @ZA02601 34564300
         B     FRPEBS                   FREE NEXT PEB          @ZA02601 34565000
         EJECT                                                          34565700
*********************************************************************** 34566200
*                                                                     * 34566700
*        FREE PROCESS ENTRY WORK AREAS (PEWA'S)                  Y02027 34567200
*                                                                     * 34568000
*********************************************************************** 34568600
FREEPEWA EQU   *                                                 Y02027 34569200
         SR    RONE,RONE                CLEAR FOR CS           @ZA02601 34570000
         L     RPEWA,TCXPEWAC           PEWA CHAIN             @ZA02601 34571000
FRPEWA1  EQU   *                                               @ZA02601 34572000
         CS    RPEWA,RONE,TCXPEWAC      REMOVE PEWAS FOR CHAIN @ZA02601 34573000
         BNE   FRPEWA1                  RETRY IF FAILED        @ZA02601 34574000
FRPEWA   EQU   *                                                 Y02027 34575000
         LTR   RPEWA,RPEWA              IS THERE A PEWA          Y02027 34578000
         BZ    FREEAIBS                 NO, BRANCH               Y02027 34580000
         LR    RONE,RPEWA               LOAD THE PEWA ADDRESS    Y02027 34582000
         ICM   RPEWA,ADDR,PEWALINK+ONE  GET ADDR OF NEXT PEWA    Y02027 34584000
         SR    RBRANCH,RBRANCH          CLEAR REG              @ZA02601 34585000
         IC    RBRANCH,TCXSCBSZ         SCB SIZE               @ZA02601 34586000
         LA    RBRANCH,PEWASIZE(RBRANCH) ADD PEWA SIZE         @ZA02601 34586200
         TM    PEWAOPT2-IEDQPEWA(RONE),PEWAIN  INPUT DCB       @ZA02601 34586400
         BNO   FRPEWAS                  NO, BRANCH             @ZA02601 34586600
         LA    RBRANCH,TRT(RBRANCH)     ADD TRT SIZE           @ZA02601 34586800
FRPEWAS  EQU   *                                               @ZA02601 34587000
         LA    RZERO,LCBCHAIN-IEDQLCB+FOUR ADJUST FOR LCB      @ZA02601 34587200
         SR    RONE,RZERO               SET ADDR FOR FREEMAIN  @ZA02601 34587400
         AR    RZERO,RBRANCH            SET LENGTH FOR FREEMAIN@ZA02601 34587600
         BAL   RBRANCH,FREE231          FREE PEWA IN SUBPOOL 231 Y02027 34587800
         SPACE 1                                                 Y02027 34588000
         B     FRPEWA                   TEST FOR ANOTHER PEWA    Y02027 34590000
         EJECT                                                          34592000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *  Y02027 34602000
*                                                             *  Y02027 34604000
*        THIS SECTION OF CODE WILL SEARCH THE TCX APPLICATION    Y02027 34606000
*        INTERFACE BLOCK (AIB) CHAIN AND FREE ANY AIB'S          Y02027 34608000
*        REMAINING ON THE CHAIN.                                 Y02027 34609000
*                                                             *  Y02027 34610000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *  Y02027 34612000
FREEAIBS EQU   *                                                 Y02027 34614000
         TM    TCXFLAG1,TCXMCPCD        MCP TERMINATED         @ZA04027 34616000
         BNO   RETURN                   NO EXIT                @ZA04027 34616600
         SR    RONE,RONE                CLEAR FOR CS           @ZA02601 34617000
         L     RAIB,TCXAIBC             CHAIN OF AIBS          @ZA02601 34617500
FRAIBS1  EQU   *                                               @ZA02601 34618000
         CS    RAIB,RONE,TCXAIBC        REMOVE AIBS FROM CHAIN @ZA02601 34619000
         BNE   FRAIBS1                  RETRY IF FAILED        @ZA02601 34620000
FRAIBS   EQU   *                                                 Y02027 34621000
         LTR   RAIB,RAIB                IS THERE AN AIB          Y02027 34622000
         BZ    FREESRBS                 NO, BRANCH             @Z49X9BG 34624000
         LR    RONE,RAIB                COPY THE AIB ADDRESS     Y02027 34626000
         ICM   RAIB,ADDR,AIBCHAIN       GET ADDR OF NEXT AIB     Y02027 34628000
         LH    RZERO,TCXSZAIB           GET AIB SIZE             Y02027 34629000
         BAL   RBRANCH,FREE231          FREE AIB IN SUBPOOL 231  Y02027 34629100
         B     FRAIBS                   TEST FOR ANOTHER AIB   @ZA02601 34629200
         EJECT                                                 @Z40X9BG 34629300
************************************************************** @Z40X9BG 34629400
*                                                            * @Z40X9BG 34629500
*        FREE SRB'S USED FOR POST FUNCTION                   * @Z40X9BG 34629600
*                                                            * @Z40X9BG 34629700
************************************************************** @Z40X9BG 34629800
FREESRBS EQU   *                                               @Z40X9BG 34629900
         SLR   RZERO,RZERO              CLEAR FOR CS           @Z40X9BG 34630000
         L     RONE,TCXSRBS             GET PTR TO SRB'S       @Z40X9BG 34631000
FRSRB1   EQU   *                                               @Z40X9BG 34632000
         LTR   RONE,RONE                ANY SRB'S TO FREE      @Z40X9BG 34633000
         BZ    RESTAB                   NO, BRANCH             @Z40X9BG 34634000
         CS    RONE,RZERO,TCXSRBS       DECHAIN SRB'S          @Z40X9BG 34635000
         BNE   FRSRB1                   BRANCH IF DECHAIN      @Z40X9BG 34636000
*                                       UNSUCESSFUL            @Z40X9BG 34637000
         SPACE 2                                               @Z40X9BG 34638000
************************************************************** @Z40X9BG 34639000
*                                                            * @Z40X9BG 34640000
*        BRANCH ENTER FREEMAIN - ENTRY EXPECTS TCB ADDRESS   * @Z40X9BG 34641000
*        IN REG 4 AND ASCB ADDRESS IN REG 7. EXPANSION       * @Z40X9BG 34642000
*        DESTROYS REGS 3,14 AND 15 AND CODE USES REG 7.      * @Z40X9BG 34643000
*                                                            * @Z40X9BG 34644000
************************************************************** @Z40X9BG 34645000
FREES    EQU   *                                               @Z40X9BG 34646000
         LA    RPEB,SRBBLKSZ-SIZESRB(,RONE) POINT TO LAST      @Z40X9BG 34647000
*                                       SRB IN THE BLOCK       @Z40X9BG 34648000
         ICM   RPEB,ADDR,ONE(RPEB)      SAVE ADDR OF FIRST SRB @Z40X9BG 34649000
*                                       IN NEXT BLOCK          @Z40X9BG 34650000
         L     RSAVE,PTRSA              GET SAVE AREA POINTER  @Z40X9BG 34651000
         STM   RBRANCH,R15,ZERO(RSAVE)  SAVE REGISTERS         @Z40X9BG 34652000
         L     RPEBF,PSATOLD-PSA(,RZERO) SET TCB ADDRESS       @VS41904 34653000
         L     RASID,PSAAOLD-PSA(,RZERO) SET ASCB ADDRESS      @VS41904 34654000
         LA    RZERO,SRBBLKSZ           GET SRB BLOCK SIZE     @OZ08384 34655000
         FREEMAIN RU,LV=(0),A=(1),SP=SQA,KEY=KEY0,BRANCH=YES   @Z40X9BG 34656000
         LM    RBRANCH,R15,ZERO(RSAVE)  RESTORE REGISTERS      @Z40X9BG 34657000
         LTR   RONE,RPEB                POINT TO NEXT SRB BLK  @Z40X9BG 34658000
         BNZ   FREES                    FREE NEXT BLOCK OF SRBS@Z40X9BG 34660000
         EJECT                                                          34661000
RESTAB   EQU   *                                               @ZA02601 34662000
         TM    TCXFLAG1,TCXMCPCD+TCXRTM MCP TERMINATED         @ZA02601 34663000
         BNO   RETURN                   NO EXIT                @ZA02601 34664000
         SPACE 2                                               @Z49X9BG 34665000
***************************************************************  Y02027 34666000
*                                                             *  Y02027 34667000
*        RESTORE ATTENTION TABLE POINTER SAVED BY TCAM OPEN   *  Y02027 34668000
*                                                             *  Y02027 34669000
***************************************************************  Y02027 34670000
         L     RONE,CVTIXAVL            GET POINTER TO IOCOM   @Z49X9BG 34678000
         USING IOCOM,RONE               IOCOM ADDRESSABILITY   @Z49X9BG 34686000
         L     RONE,IOCATTBL            GET ATTN TABLE POINTER   Y02027 34694000
         USING ATB,RONE                 ATTN TABLE ADDRESSABILITYY02027 34702000
         LA    RONE,TCAM(RONE)          INCREMENT ATTN TABLE ADDRY02027 34710000
         MVC   ATBRTN,TCXSATTN          RESTORE INITIAL VALUE OF Y02027 34718000
*                                       ATTN ROUTINE POINTER     Y02027 34726000
*                                       FOR TCAM                 Y02027 34734000
         SR    RBRANCH,RBRANCH          CLEAR FOR STH          @ZA02601 34742000
         STH   RBRANCH,ATBASID          CLEAR ASID VALUE       @ZA02601 34750000
         DROP  RONE                                            @ZA02601 34758000
         SPACE 4                                               @Z40X9BG 34766000
************************************************************** @Z40X9BG 34774000
*                                                            * @Z40X9BG 34782000
*        RESET TCAM'S PURGE ENTRY IN THE VECTOR OF IOS       * @Z40X9BG 34790000
*        DRIVERS (VOID)                                      * @Z40X9BG 34798000
*                                                            * @Z40X9BG 34806000
************************************************************** @Z40X9BG 34814000
         L     RONE,CVTIXAVL            GET POINTER TO IOCM    @Z40X9BG 34822000
         USING IOCOM,RONE               IOCOM ADDRESSABILITY   @Z40X9BG 34830000
         L     RONE,IOCVOID             GET ADDR OF VOID       @Z40X9BG 34838000
         USING VOID,RONE                VOID ADDRESSABILITY    @Z40X9BG 34846000
         LA    RONE,VOIEL*IOSTCMID(,RONE) GET ADDR OF TCAM'S   @G36XRBB 34854000
*                                       SLOT IN THE VOID       @Z40X9BG 34862000
         MVC   VOIPRG,VOIRSTR           RESET PURGE ADDR TO    @Z40X9BG 34870000
*                                       SAME NO-OP ADDRESS     @Z40X9BG 34878000
*                                       USED FOR RESTORE ADDR  @Z40X9BG 34886000
         DROP  RONE                                            @Z40X9BG 34894000
         EJECT                                                   Y02027 34902000
***************************************************************  Y02027 34910000
*                                                             *  Y02027 34918000
*        RESET TABS IN TCAM UCB'S                             *  Y02027 34926000
*                                                             *  Y02027 34934000
***************************************************************  Y02027 34942000
         USING UCB,RUCB                 UCB ADDRESSABILITY       Y02027 34950000
         USING UCBCMEXT,RUCBEXT         UCB EXTENSION            Y02027 34958000
*                                       ADDRESSABILITY           Y02027 34966000
         L     RLOOKUP,CVTILK2          LOAD THE ADDRESS OF THE  Y02027 34980200
*                                       UCB HALFWORD ADDRESS LISTY02027 37080200
*                                       SECTION IN THE UCB       Y02027 37380200
*                                       LOOKUP TABLE             Y02027 37680200
         SR    RUCB,RUCB                CLEAR FOR INSERT         Y02027 37980200
         SPACE 3                                                        38280200
***************************************************************  Y02027 38580200
*                                                             *  Y02027 38880200
*        RESET THE ERROR TAB IN ANY NON-BISC UCB'S MODIFIED   *  Y02027 39180200
*        BY TCAM                                              *  Y02027 39480200
*                                                             *  Y02027 39780200
***************************************************************  Y02027 40080200
GETUCBAD EQU   *                                                 Y02027 40380200
         ICM   RUCB,HALF,ZERO(RLOOKUP)  GET THE ADDR OF THE      Y02027 40680200
*                                       FIRST/NEXT UCB           Y02027 40980200
         BZ    NEXTUCB                  IF ADDR IS 0, BRANCH     Y02027 41280200
         CLM   RUCB,HALF,ENDUCB         IS THIS THE END OF THE @Z30AABG 41580200
*                                       UCB LOOKUP TABLE         Y02027 41880200
         BE    FREEIOSB                 YES, BRANCH            @Z40X9BG 42180200
         L     RUCBEXT,UCBEXTPT         GET UCB EXTENSION ADDR   Y02027 42480200
         CLI   UCBETI,NONBISC           IS THIS A NON-BISC LINE  Y02027 42780200
         BNE   TESTBISC                 NO, BRANCH               Y02027 43080200
         LR    R15,RUCB                 SET UCB ADDR             Y02027 43380200
         IOSGEN TP,VAR=29,UCB=(R15)     RESET THE ERROR TAB      Y02027 43680200
         SPACE 3                                                        44280200
         B     TESTATTN                 GO CHECK ATTN TAB        Y02027 44480200
         EJECT                                                          44680200
***************************************************************  Y02027 44880200
*                                                             *  Y02027 46880200
*        RESET THE ERROR TAB IN ANY BISC UCB'S MODIFIED       *  Y02027 49680200
*        BY TCAM                                              *  Y02027 50280200
*                                                             *  Y02027 50580200
***************************************************************  Y02027 50880200
TESTBISC EQU   *                                                 Y02027 51180200
         CLI   UCBETI,BISC              IS THIS A BISC LINE      Y02027 51480200
         BNE   NEXTUCB                  NO, BRANCH               Y02027 51780200
         LR    R15,RUCB                 SET UCB ADDR             Y02027 52080200
         IOSGEN TP,VAR=2B,UCB=(R15)     RESET BISC ERROR TAB     Y02027 52380200
         EJECT                                                          52980200
***************************************************************  Y02027 53180200
*                                                             *  Y02027 53380200
*        RESET THE ATTENTION TAB IN ANY GRAPHICS OR 3705      *  Y02027 53580200
*        UCB'S MODIFIED BY TCAM                               *  Y02027 53601200
*                                                             *  Y02027 53615200
***************************************************************  Y02027 53622200
TESTATTN EQU   *                                                 Y02027 53636200
         CLI   UCBATI,ATTNTAB           HAS THE ATTENTION TAB    Y02027 53643200
*                                       BEEN MODIFIED            Y02027 53650200
         BNE   NEXTUCB                  NO, BRANCH               Y02027 53664200
         SPACE 2                                                        53671200
*        CHECK UCB FOR TYPE OF DEVICE                            Y02027 53685200
         SPACE 1                                                        53692200
         CLI   UCBDVCLS,DISPLAY         IS THIS A DISPLAY DEVICE Y02027 53706200
         BNE   RN                       NO, ASSUME 3705          Y02027 53713200
         SPACE 1                                                        53720200
         CLI   UCBUNTYP,L2260           IS DEVICE A LOCAL 2260   Y02027 53734200
         BNE   TEST3270                 NO, BRANCH               Y02027 53741200
         SPACE 1                                                        53755200
         MVI   UCBATI,ATI2260           SET ATTN TAB FOR 2260L   Y02027 53762200
         B     NEXTUCB                  SET UP FOR NEXT UCB      Y02027 53776200
         SPACE 2                                                        53783200
TEST3270 EQU   *                                                 Y02027 53790200
         CLI   UCBUNTYP,TUBE            IS THIS A 3270 TUBE      Y02027 53804200
         BE    TYP3270                  YES, RESET ATTN TAB      Y02027 53811200
         CLI   UCBUNTYP,PRT1            IS THIS A 3270 PRINTER   Y02027 53825200
         BE    TYP3270                  YES, RESET ATTN TAB      Y02027 53832200
         CLI   UCBUNTYP,PRT2            IS THIS A 3270 PRINTER   Y02027 53841200
         BNE   RN                       NO, DEFAULT TO 3705      Y02027 53850200
         SPACE 1                                                 Y02027 53859200
TYP3270  EQU   *                                                 Y02027 53868200
         MVI   UCBATI,ATI3270           SET ATTN TAB FOR 3270L   Y02027 53880200
         B     NEXTUCB                  SET UP FOR NEXT UCB      Y02027 53910200
         SPACE 2                                                 Y02027 53940200
RN       EQU   *                                                 Y02027 53970200
         MVI   UCBATI,ATI3705           SET ATTN TAB FOR 3705    Y02027 54000200
         SPACE 3                                                        54030200
NEXTUCB  EQU   *                                                 Y02027 54060200
         LA    RLOOKUP,TWO(RLOOKUP)     INCREMENT THE UCB LOOKUP Y02027 54090200
*                                       POINTER                  Y02027 54180200
         B     GETUCBAD                 GET NEXT UCB ADDR        Y02027 54186200
         EJECT                                                 @G36XRBB 54192200
************************************************************** @G36XRBB 54198200
*                                                            * @G36XRBB 54204200
*        FREE THE SRB/IOSB BLOCKS USED BY 3705 I/O           * @G36XRBB 54210200
*                                                            * @G36XRBB 54216200
************************************************************** @G36XRBB 54222200
FREEIOSB EQU   *                                               @G36XRBB 54228200
         L     RTCX,CVTAQAVT            GET TCX ADDRESS        @G36XRBB 54234200
         SLR   RPEB,RPEB                CLEAR FOR CS           @G36XRBB 54240200
         L     RONE,TCXNCPIO            GET ADDR OF 1ST BLOCK  @G36XRBB 54246200
*                                       OF SRB/IOSB'S          @G36XRBB 54252200
         ST    RPEB,TCXNCPIO            CLEAR PTR              @G36XRBB 54258200
FRLOOP   EQU   *                                               @G36XRBB 54264200
         LTR   RONE,RONE                IS THERE A BLK TO FREE @G36XRBB 54270200
         BZ    FREEMORE                 NO, BRANCH             @G36XRBB 54276200
         L     RPEB,0(RONE)             SAVE PTR TO NEXT BLOCK @G36XRBB 54282200
         LA    RBRANCH,SRBSIZE+IOSEND-IOSB+CONTROL GET LENGTH  @G36XRBB 54288200
         AR    RBRANCH,RONE             CALCULATE END ADDRESS  @G36XRBB 54294200
         ICM   RONE,HIGHORDR,PGFLG1     SET PAGE ...           @G36XRBB 54300200
         ICM   RBRANCH,HIGHORDR,PGFLG2  ... FREE VSL FLAGS     @G36XRBB 54306200
         LA    RPEBF,RZERO              SET TCB PTR            @OZ33173 54312286
         SLR   RZERO,RZERO              NO ECB ADDRESS         @G36XRBB 54318200
         L     R15,CVTVPSIB             GET BRANCH ENTRY PT    @G36XRBB 54324200
*                                       ADDR FOR PGFREE        @G36XRBB 54330200
         BALR  RRECB,R15                BRANCH TO PAGE FREE    @G36XRBB 54336200
         SPACE 1                                               @G36XRBB 54342200
         L     RSAVE,PTRSA              GET SAVE AREA ADDR     @G36XRBB 54348200
         STM   RBRANCH,R15,ZERO(RSAVE)  SAVE REGS              @Z40X9BG 54354200
         L     RPEBF,PSATOLD-PSA(,RZERO) SET TCB ADDRESS       @G36XRBB 54360200
         L     RASID,PSAAOLD-PSA(,RZERO) SET ASCB ADDRESS      @G36XRBB 54366200
         LA    RZERO,SRBSIZE+IOSEND-IOSB+CONTROL GET LENGTH    @G36XRBB 54372200
         LA    RONE,ZERO(,RONE)         CLEAR HIGH BYTE        @G36XRBB 54378200
         FREEMAIN RU,LV=(0),A=(1),SP=241,KEY=KEY0,BRANCH=YES   @G36XRBB 54384200
         LM    RBRANCH,R15,ZERO(RSAVE)  RESTORE REGS           @G36XRBB 54390200
         LR    RONE,RPEB                GET PTR TO NEXT BLOCK  @G36XRBB 54396200
         B     FRLOOP                   TEST FOR ANOTHER BLOCK @G36XRBB 54402200
         EJECT                                                 @Z40X9BG 54408200
************************************************************** @Z40X9BG 54414200
*                                                            * @Z40X9BG 54420200
*        FREE THE SRB/IOSB BLOCKS USED BY MESSAGE QUEUES     * @Z40X9BG 54426200
*        DISK I/O.                                           * @Z40X9BG 54432200
*                                                            * @Z40X9BG 54480200
************************************************************** @Z40X9BG 54580200
FREEMORE EQU   *                                               @Z40X9BB 54680200
         SLR   RPEB,RPEB                CLEAR FOR CS           @Z40X9BG 54780200
         L     RONE,TCXSIOSB            GET ADDR OF 1ST BLOCK  @Z40X9BG 54840200
*                                       OF SRB/IOSB'S          @Z40X9BG 54880200
FRIOSBCS EQU   *                                               @Z40X9BG 54920200
         CS    RONE,RPEB,TCXSIOSB       DECHAIN SRB/IOSB'S     @Z40X9BG 54960200
         BNE   FRIOSBCS                 RETRY IF UNSUCCESSFUL  @Z40X9BG 55000200
FRSIOSB  EQU   *                                               @Z40X9BG 55040200
         LTR   RONE,RONE                IS THERE A BLK TO FREE @Z40X9BG 55080200
         BZ    FREETCX                  NO, BRANCH             @Z40X9BG 55120200
         L     RPEB,FOUR(,RONE)         SAVE PTR TO NEXT BLOCK @Z40X9BG 55160200
         L     RAIB,ZERO(,RONE)         SAVE THE LENGTH        @Z40X9BG 55200200
         LA    RBRANCH,ZERO(,RAIB)      GET LENGTH             @Z40X9BG 55240200
         AR    RBRANCH,RONE             CALCULATE END ADDRESS  @Z40X9BG 55280200
         ICM   RONE,HIGHORDR,PGFLG1     SET PAGE ...           @Z40X9BG 55320200
         ICM   RBRANCH,HIGHORDR,PGFLG2  ... FREE VSL FLAGS     @Z40X9BG 55380200
         LA    RPEBF,RZERO              SET TCB ADDR TO ZERO   @OZ29317 55410286
         SLR   RZERO,RZERO              NO ECB ADDRESS         @Z40X9BG 55440200
         L     R15,CVTVPSIB             GET BRANCH ENTRY PT    @Z40X9BG 55470200
*                                       ADDR FOR PGFREE        @Z40X9BG 55500200
         BALR  RRECB,R15                BRANCH TO PAGE FREE    @Z40X9BG 55530200
         SPACE 1                                               @Z40X9BG 55560200
         L     RSAVE,PTRSA              GET SAVE AREA ADDR     @Z40X9BG 55590200
         STM   RBRANCH,R15,ZERO(RSAVE)  SAVE REGS              @Z40X9BG 55680200
         L     RPEBF,PSATOLD-PSA(,RZERO) SET TCB ADDRESS       @VS41904 55720200
         L     RASID,PSAAOLD-PSA(,RZERO) SET ASCB ADDRESS      @VS41904 55760200
         LA    RZERO,ZERO(,RAIB)        GET LENGTH             @Z40X9BG 55800200
         LA    RONE,ZERO(,RONE)         CLEAR HIGH BYTE        @VS41085 55840200
         FREEMAIN RU,LV=(0),A=(1),SP=241,KEY=KEY0,BRANCH=YES   @VS41091 55880200
         LM    RBRANCH,R15,ZERO(RSAVE)  RESTORE REGS           @Z40X9BG 55920200
         LA    RONE,ZERO(,RPEB)         GET PTR TO NEXT BLOCK  @Z40X9BG 55980200
         B     FRSIOSB                  TEST FOR ANOTHER BLOCK @Z40X9BG 56010200
         EJECT                                                 @ZA02601 56040200
***************************************************************@ZA02601 56070200
*                                                              @ZA02601 56100200
*              THIS SECTION OF CODE WILL REMOVE THE TCX FROM   @ZA02601 56130200
*              THE SYSTEM.                                     @ZA02601 56160200
*                                                              @ZA02601 56190200
***************************************************************@ZA02601 56280200
FREETCX  EQU   *                                               @ZA02601 56320200
         L     RTCX,CVTAQAVT            TCX ADDRESS            @ZA02601 56360200
         SR    RONE,RONE                CLEAR FOR CS           @ZA02601 56400200
         CS    RTCX,RONE,CVTAQAVT       REMOVE TCX             @ZA02601 56440200
         BNE   FREETCX                  RETRY IF FAILED        @ZA02601 56480200
         BAL   RBRANCH,UNLOCK           RELEASE LOCKS HELD     @ZA02601 56520200
         BAL   RBRANCH,SAFREE           FREE SAVE AREA         @ZA02601 56580200
         LR    RONE,RTCX                COPY TCX ADDRESS       @ZA02601 56620200
         LA    R15,TCXSIZE(,RONE)       END OF TCX             @ZA02601 56660200
         PGFREE R,A=(1),EA=(15)         PAGE FREE THE TCX      @ZA02601 56700200
         LR    RONE,RTCX                COPY TCX ADDRESS       @ZA02601 56740200
         LA    RZERO,TCXSIZE            LENGTH OF TCX          @ZA02601 56780200
         ICM   RZERO,HIGHORDR,SP231     SET SUBPOOL VALUE      @ZA02601 56820200
         MODESET EXTKEY=TCAM            GET INTO TCAM KEY      @ZA02601 56860200
         FREEMAIN R,LV=(0),A=(1)        FREE THE TCX           @ZA02601 56900200
         MODESET EXTKEY=SUPR            RETURN TO KEY 0        @ZA02601 56940200
         B     RETURN1                  EXIT                   @ZA02601 56980200
         EJECT                                                          57020200
***************************************************************  Y02027 57060200
*                                                             *  Y02027 57100200
*        RETURN TO CALLER OF IEDQOT01                         *  Y02027 57140200
*                                                             *  Y02027 57180200
***************************************************************  Y02027 57220200
RETURN   EQU   *                                                 Y02027 57260200
         BAL   RBRANCH,UNLOCK           RELEASE LOCKS HELD     @ZA02601 57300200
         BAL   RBRANCH,SAFREE           FREE SAVE AREA         @ZA02601 57400000
RETURN1  EQU   *                                               @ZA02601 57440000
         L     RSAVE,SAVE13             RESTORE CALLER'S REG 13  Y02027 57520000
         SPACE 1                                                        57600000
         RETURN (14,12),T,RC=0          RETURN WITH CODE 0       Y02027 57700000
         EJECT                                                          57750000
***************************************************************  Y02027 57800000
*                                                             *  Y02027 57900000
*        OBTAIN LOCAL AND CMS LOCKS                           *  Y02027 57950000
*        (REGISTERS 11,12,13, AND 14 ARE DESTROYED)           *  Y02027 58000000
*                                                             *  Y02027 58100000
***************************************************************  Y02027 58150000
LOCK     EQU   *                                                 Y02027 58300000
         SPACE 1                                                        58400000
LOCALGET SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,                        X58500000
               RELATED=(PEBPEWA,IEDQEU(LOCALREL),IEDQOT01(LOCALREL),IGGX58600000
               02046(LOCALREL))                                @ZA02601 58650000
         SPACE 1                                                        58700000
CMSGET   SETLOCK OBTAIN,TYPE=CMS,MODE=UNCOND,                          *58750000
               RELATED=(PEBPEWA,IEDQEU(CMSREL),IEDQOT01(CMSREL),IGG0204X58820000
               6(CMSREL))                                      @ZA02601 58900000
         SPACE 1                                                        59000000
         BR    RBRANCH                  RETURN                   Y02027 59050000
         SPACE 2                                               @Z40X9BG 59100000
***************************************************************  Y02027 59200000
*                                                             *  Y02027 59300000
*        RELEASE CMS AND LOCAL LOCKS                          *  Y02027 59350000
*        (REGISTERS 11,12,13, AND 14 ARE DESTROYED)           *  Y02027 59400000
*                                                             *  Y02027 59500000
***************************************************************  Y02027 59700000
UNLOCK   EQU   *                                                 Y02027 59800000
         SPACE 1                                                        59900000
CMSREL   SETLOCK RELEASE,TYPE=CMS,                                     *59930000
               RELATED=(PEBPEWA,IEDQEU(CMSGET),IEDQOT01(CMSGET),IGG0204X59960000
               6(CMSGET))                                      @ZA02601 60000000
         SPACE 1                                                        60020000
LOCALREL SETLOCK RELEASE,TYPE=LOCAL,                                   X60040000
               RELATED=(PEBPEWA,IEDQEU(LOCALGET),IEDQOT01(LOCALGET),IGGX60060000
               02046(LOCALGET))                                @ZA02601 60100000
         SPACE 1                                                        60130000
         BR    RBRANCH                  RETURN                   Y02027 60160000
         EJECT                                                   Y02027 60200000
***************************************************************  Y02027 60220000
*                                                             *  Y02027 60250000
*        DELINK PEB AND FREE IT.                              *  Y02027 60300000
*                                                             *  Y02027 60320000
***************************************************************  Y02027 60340000
FREEPEB  EQU   *                                                 Y02027 60360000
         LR    RONE,RPEB                COPY PEB FOR CS        @ZA02601 60400000
         L     RPEB,PEBLINK             ADDRESS OF NEXT PEB    @ZA02601 60430000
         CS    RONE,RPEB,PEBLINK-IEDQPEB(RPEBF) DELINK PEB     @ZA02601 60460000
         BZ    FREEPEB1                 BYPASS RECOVERY CS O K @ZA02601 60500000
         LA    RPEB,TCXPEBC             START AGAIN AT TOP     @ZA02601 60520000
FREEPEB1 EQU   *                                               @ZA02601 60550000
         LR    RPEB,RPEBF               COPY OLD PEB ADDR      @ZA02601 60600000
         LA    RZERO,PEBSIZE            GET SIZE OF THE PEB      Y02027 60620000
         SPACE 2                                                        60640000
***************************************************************  Y02027 60660000
*                                                             *  Y02027 60700000
*        FREE CORE IN SUBPOOL 231 IN KEY OF TCAM              *  Y02027 60733000
*                                                             *  Y02027 60760000
***************************************************************  Y02027 60800000
FREE231  EQU   *                                                 Y02027 60830000
         L     RSAVE,PTRSA              GET SAVE AREA ADDRESS  @ZA02601 60860000
         STM   RBRANCH,R15,ZERO(RSAVE)  SAVE REGS              @ZA02601 60900000
         L     RPEBF,PSATOLD-PSA        TCB ADDRESS            @OZ08086 60920000
         L     RASID,PSAAOLD-PSA        ASCB ADDRESS           @OZ08086 60940000
         FREEMAIN RU,LV=(0),A=(1),SP=CSA,KEY=KEY6,BRANCH=YES   @ZA02601 60960000
         LM    RBRANCH,R15,ZERO(RSAVE)  RESTORE REGS           @ZA02601 61000000
         SPACE 1                                                 Y02027 61030000
         BR    RBRANCH                  RETURN TO CALLER         Y02027 61060000
         EJECT                                                          61100000
***************************************************************  Y02027 61120000
*                                                             *  Y02027 61150000
*        DETERMINE IF THE TERMINATING TASK OR MEMORY IS A     *  Y02027 61200000
*        TCAM APPLICATION PROGRAM                             *  Y02027 61220000
*                                                             *  Y02027 61240000
***************************************************************  Y02027 61260000
PROCTERM EQU   *                                                 Y02027 61300000
         SR    RPEB,RPEB                CLEAR FOR INSERT         Y02027 61330000
         ICM   RPEB,ADDR,TCXPEBC+ONE    GET ADDR OF 1ST PEB      Y02027 61360000
         BZ    TSTCHAIN                 IF ADDR IS 0, BRANCH   @ZA02601 61400000
         LA    RPEBF,FIRSTPEB(,RTCX)    POINT TO TCXPEBC AS DUMMYY02027 61430000
*                                       FIRST PEB                Y02027 61460000
PEBTEST  EQU   *                                                 Y02027 61500000
         TM    RMPLFLG1,RMPLTERM        IS THIS MEMORY TERM      Y02027 61520000
         BO    TESTASCB                 YES, BRANCH              Y02027 61540000
         CLC   RMPLTCBA+ONE(L3),PEBTCB+ONE DOES APPL. PGM. TCB   Y02027 61560000
*                                       ADDR MATCH THAT OF THE   Y02027 61580000
*                                       TERMINATING TASK         Y02027 61600000
         BNE   NEXTPEB                  NO, BRANCH               Y02027 61620000
TESTASCB EQU   *                                                 Y02027 61640000
         CLC   RMPLASCB+ONE(L3),PEBASCB+ONE DOES THE APPL. PGM.  Y02027 61660000
*                                       ASCB ADDR MATCH THAT OF  Y02027 61750000
*                                       THE TERMINATING MEMORY   Y02027 61800000
*                                       OR THE MEMORY OF THE     Y02027 61830000
*                                       TERMINATING TASK         Y02027 61860000
         BE    POSTPEB                  YES, BRANCH              Y02027 61880000
NEXTPEB  EQU   *                                                 Y02027 61900000
         LTR   RPEBF,RPEB               SAVE OLD PEB ADDR      @ZA02601 61930000
         BZ    TSTCHAIN                 END OF CHAIN           @ZA02601 61960000
         ICM   RPEB,ADDR,PEBLINK+ONE    GET ADDR OF NEXT PEB     Y02027 61990000
         BNZ   PEBTEST                  IF ADDR IS NOT 0, BRANCH Y02027 62020000
*                                       TO PEBTEST               Y02027 62060000
         EJECT                                                          62100000
***************************************************************  Y02027 62130000
*                                                             *  Y02027 62160000
*        CHECK FOR EMPTY PEB CHAIN                            *  Y02027 62190000
*                                                             *  Y02027 62220000
***************************************************************  Y02027 62240000
TSTCHAIN EQU   *                                                 Y02027 62260000
         ICM   RPEB,ADDR,TCXPEBC+ONE    IS PEB CHAIN EMPTY       Y02027 62300000
         BZ    PEBFREE                  YES, CLEAN UP          @ZA02601 62320000
         B     RETURN                   EXIT                   @ZA02601 62350000
***************************************************************@ZA02601 62400000
*                                                              @ZA02601 62420000
*        DELINK THE PEWA'S AND THE PEB. CONTINUE SEARCH IF     @ZA02601 62440000
*        THIS IS MEMORY TERMINATION                            @ZA02601 62480000
*                                                              @ZA02601 62520000
***************************************************************@ZA02601 62540000
DLKPEWA  EQU   *                                               @ZA02601 62560000
         LA    RPEWA,TCXPEWAC-PEWALINK+IEDQPEWA DUMMY PEWA     @ZA02601 62600000
DLKPEWA1 EQU   *                                               @ZA02601 62630000
         LTR   RAIB,RPEWA               COPY OLD PEWA          @ZA02601 62660000
         BZ    DELINK1                  BRANCH END OF CHAIN    @ZA02601 62700000
         ICM   RPEWA,ALL,PEWALINK-IEDQPEWA(RPEWA) GET NEXT PEWA@ZA02601 62720000
         BZ    DELINK1                  BRANCH END OF CHAIN    @ZA02601 62740000
         CLC   PEPCBAD+ONE-IEDQPEWA(L3,RPEWA),PEBPCB+ONE PEWA  @ZA02601 62780000
*                                       FOR THIS PEB           @ZA02601 62824000
         BNE   DLKPEWA1                 NO, BRANCH             @ZA02601 62833000
         LR    RONE,RPEWA               COPY PEWA FOR CS       @ZA02601 62860000
         L     RPEWA,PEWALINK-IEDQPEWA(RPEWA) NEXT PEWA        @ZA02601 62890400
         CS    RONE,RPEWA,PEWALINK-IEDQPEWA(RAIB) UNCHAIN PEWA @ZA02601 62920400
         BNE   DLKPEWA                  RETRY IF FAILED        @ZA02601 62950400
         SR    R15,R15                  CLEAR REG              @ZA02601 63000000
         IC    R15,TCXSCBSZ             SCB SIZE               @ZA02601 63020000
         LA    R15,PEWASIZE(R15)        ADD PEWA SIZE          @ZA02601 63040000
         TM    PEWAOPT2-IEDQPEWA(RONE),PEWAIN INPUT DCB        @ZA02601 63060000
         BNO   DLKPEWA2                 NO, BRANCH             @ZA02601 63100000
         LA    R15,TRT(R15)             ADD TRT SIZE           @ZA02601 63130000
DLKPEWA2 EQU   *                                               @ZA02601 63160000
         LA    RZERO,LCBCHAIN-IEDQLCB+FOUR ADJUST FOR LCB      @ZA02601 63200000
         SR    RONE,RZERO               SET ADDR FOR FREEMAIN  @ZA02601 63230000
         AR    RZERO,R15                SET LENGTH FOR FREEMAIN@ZA02601 63260000
         BAL   RBRANCH,FREE231          FREE THE PEWA          @ZA02601 63300000
         B     DLKPEWA1                 CHECK NEXT PEWA        @ZA02601 63320000
DELINK1  EQU   *                                               @ZA02601 63340000
         BAL   RBRANCH,FREEPEB          DELINK AND FREE PEB    @ZA02601 63360000
         BR    RRECB                    RETURN TO CALLER       @ZA02601 63400000
DELINK   EQU   *                                               @ZA02601 63430000
         BAL   RRECB,DLKPEWA            DELINK PEWA AND PEB    @ZA02601 63460000
         B     NEXTPEB                  CONT SEARCH FOR PEBS   @ZA02601 63490000
TERMPEB  EQU   *                                               @ZA02601 63520000
         OI    PEBFLAG,PEBTERM          FLAG AS TERMINATED     @ZA02601 63550000
         B     NEXTPEB                  CHECK NEXT PEB         @ZA02601 63580000
         EJECT                                                          63610000
***************************************************************  Y02027 63640000
*                                                             *  Y02027 63670000
*        DETERMINE IF PEB SHOULD BE PUT ON READY QUEUE        *  Y02027 63700000
*                                                             *  Y02027 63749000
***************************************************************  Y02027 63789000
POSTPEB  EQU   *                                                 Y02027 63809000
         TM    TCXFLAG1,TCXMCPCD        IS TCAM TERMINATING      Y02027 63829000
         BO    DELINK                   YES, DO NOT POST PEB TO  Y02027 63869000
*                                       TCAM - GO DELINK PEB     Y02027 63909000
         CLC   PEBASID,TCXASID          APPL A SUBTASK OF MCP  @ZA02601 63929000
         BNE   MCPOK                    NO, BRANCH             @ZA02601 63949000
         L     RTCB,TCXTCB              GET MCP TCB ADDRESS    @ZA02601 63989000
         TM    TCBFLGS-IEDQTCB(RTCB),TERM MCP TERMINATING      @ZA02601 64029000
         BNZ   DELINK                   YES, DELINK PEB        @ZA02601 64049000
MCPOK    EQU   *                                               @ZA02601 64069000
         TM    PEBFLAG,PEBCLOSE         ALREADY PROCESSED PEB  @ZA02601 64109000
         BO    NEXTPEB                  YES, CHECK NEXT PEB    @ZA02601 64149000
CKPEWA   EQU   *                                               @ZA02601 64169000
         LA    RPEWA,TCXPEWAC-PEWALINK+IEDQPEWA                @ZA02601 64189000
LOOPPEWA EQU   *                                               @ZA02601 64229000
         ICM   RPEWA,ALL,PEWALINK-IEDQPEWA(RPEWA) GET PEWA     @ZA02601 64269000
         BZ    TERMPEB                  CHECK NEXT PEB         @ZA02601 64289000
         CLC   PEPCBAD+ONE-IEDQPEWA(L3,RPEWA),PEBPCB+ONE  PEWA @ZA02601 64309000
*                                       FOR THIS PEB           @ZA02601 64349000
         BNE   LOOPPEWA                 NO , BRANCH            @ZA02601 64389000
         LA    RONE,TCXAIBC             ADDRESS OF AIBS        @ZA02601 64409000
ALOOPAIB EQU   *                                               @ZA02601 64429000
         ICM   RONE,ADDR,AIBCHAIN-IEDQAIB(RONE) GET AIB        @ZA02601 64469000
         BZ    PROSPEB                  PROCESS THE PEBS       @ZA02601 64509000
         TM    AIBSTATE-IEDQAIB(RONE),ABEND AIB IN USE         @ZA02601 64529000
         BNE   ALOOPAIB                 NO, BRANCH             @ZA02601 64549000
         CLM   RPEWA,ALL,RCBDSNM-IEDQRECB+AIBKEY-IEDQAIB(RONE) @ZA02601 64589000
*                                       AIB FOR THIS PEWA      @ZA02601 64629000
         BNE   ALOOPAIB                 NO, BRANCH             @ZA02601 64649000
         L     RZERO,AIBECBA-IEDQAIB(RONE) GET SPECIAL FLAG    @ZA02601 64669000
         CLM   RZERO,ALL,CLOS           CLOSE HUNG UP          @ZA02601 64709000
         BNE   ALOOPAIB                 NO, BRANCH             @ZA02601 64749000
         TM    RCBERR-IEDQRECB+AIBKEY-IEDQAIB(RONE),ABEND      @ZA02601 64769000
*                                       HAS QEU SEEN REQUEST   @ZA02601 64789000
         BO    LOOPPEWA                 YES, SEARCH PEWAS      @ZA04027 64829000
         B     GOTAIB                   POST APPL CLOSEDOWN    @ZA02601 64869000
PROSPEB  EQU   *                                               @ZA02601 64889000
         LA    RONE,TCXAIBC             TCX AIB POINTER        @ZA02601 64909000
AIBGET   EQU   *                                               @ZA02601 64949000
         ICM   RONE,ADDR,AIBCHAIN-IEDQAIB(RONE) ANY AIB'S AVAIL@ZA02601 64989000
         BNZ   GOTAIBS                  YES, GET ONE           @ZA02601 65009000
         LH    RZERO,TCXSZAIB           GET SIZE OF AIB        @OZ17630 65029000
         CH    RZERO,FOURK              SIZE GREATER THAN 4K   @OZ17630 65069000
         BH    GETCORE                  YES, BRANCH            @OZ17630 65109000
         LA    RZERO,HPAGE              2K VALUE               @ZA02601 65129000
         AR    RZERO,RZERO              DOUBLE TO PAGE SIZE    @ZA02601 65149000
GETCORE  EQU   *                                               @OZ17630 65179000
         L     RSAVE,PTRSA              GET SAVE AREA ADDRESS  @ZA02601 65229000
         STM   RBRANCH,R15,ZERO(RSAVE)  SAVE REGS              @ZA02601 65249000
         ICM   RPEBF,ADDR,RMPLTCBA+ONE  TCB ADDRESS            @ZA02601 65269000
         BNZ   TASKTERM                 BR NOT ZERO            @OZ32424 65279086
         ICM   RPEBF,ADDR,PEBTCB+ONE    GET TCB ADDR           @OZ32424 65289086
TASKTERM EQU   *                                               @OZ32424 65299086
         ICM   RASID,ADDR,RMPLASCB+ONE  ASCB ADDRESS           @ZA02601 65309000
*                                       GETMAIN CSA KEY6       @ZA02601 65349000
         GETMAIN RU,LV=(0),SP=CSA,KEY=KEY6,BNDRY=PAGE,BRANCH=YES        65369000
         LM    RBRANCH,R15,ZERO(RSAVE)  RESTORE REGS           @ZA02601 65389000
         LH    RRECB,TCXSZAIB           SIZE OF AIB            @ZA02601 65429000
         CH    RRECB,FOURK              SIZE GREATER THAN 4K   @OZ17630 65469000
         BNH   SMALLAIB                 NO, BRANCH             @OZ17630 65489000
         LR    R15,RONE                 GET ADDR OF ONLY AIB   @OZ17630 65509000
         B     CLRBYTE                  BRANCH TO CLEAR BYTE   @OZ17630 65549000
SMALLAIB EQU   *                                               @OZ17630 65561000
         LA    R15,HPAGE                2K VALUE               @ZA02601 65591000
         LA    R15,HPAGE(R15,RONE)      ADDR OF END OF AIBS    @OZ17630 65629000
         SR    R15,RRECB                ADDR OF LAST AIB       @ZA02601 65669000
CLRBYTE  EQU   *                                               @OZ17630 65689000
         LA    RZERO,ZERO(RONE)         CLEAR HI ORDER BYTE    @ZA02601 65719000
         B     BXLE                     BRANCH TO INITIALIZE   @ZA02601 65749000
CHAINAIB EQU   *                                               @ZA02601 65789000
         ST    RZERO,AIBCHAIN-ONE-IEDQAIB(RONE)  STORE AIB PTR @ZA02601 65829000
         LR    RONE,RZERO               SAVE CURRENT PTR       @ZA02601 65849000
BXLE     EQU   *                                               @ZA02601 65869000
         BXLE  RZERO,RRECB,CHAINAIB     LOOP THRU NEW CORE     @ZA02601 65909000
*                                       TILL ALL AIBS LINKED   @ZA02601 65949000
         LR    R15,RONE                 LAST AIB PTR           @ZA02601 65969000
         N     RONE,CLRLOW              START OF GOTTEN CORE   @ZA02601 65989000
         L     RZERO,TCXAIBC            GET CURRENT AIB PTR    @ZA02601 66029000
AIBLOOP  EQU   *                                               @ZA02601 66069000
         ST    RZERO,AIBCHAIN-ONE-IEDQAIB(R15) LINK AIBS       @ZA02601 66089000
         CS    RZERO,RONE,TCXAIBC       CHAIN AIBS             @ZA02601 66109000
         BNE   AIBLOOP                  RETRY IF CS FAILED     @ZA02601 66149000
GOTAIBS  EQU   *                                               @ZA02601 66189000
         TS    AIBSTATE-IEDQAIB(RONE)   ALLOCATE AIB           @ZA02601 66209000
         BNZ   AIBGET                   IN USE, RETRY          @ZA02601 66229000
GOTAIB   EQU   *                                               @ZA02601 66269000
         MVC   AIBECBA-IEDQAIB(FOUR,RONE),QOT1 SET ID FOR      @ZA02601 66309000
*                                       FAILURE                @ZA02601 66329000
         LA    RONE,AIBKEY-IEDQAIB(RONE) BUMP TO RCB           @ZA02601 66349000
         XC    ZERO(RCBSIZE,RONE),ZERO(RONE) CLEAR RCB         @ZA02601 66389000
***************************************************************@ZA02601 66429000
*                                                              @ZA02601 66449000
*        PUT RCB ON ASYNCHRONOUS READY QUEUE FOR MCP CLEANUP   @ZA02601 66469000
*                                                              @ZA02601 66509000
***************************************************************@ZA02601 66549000
         USING IEDQRECB,RONE                                   @ZA02601 66569000
         MVC   RECBKEY(FOUR),TCXOCQ     SET OPEN/CLOSE QCB     @ZA02601 66589000
         MVI   RECBPRI,PRIORITY         SET PRIORITY           @ZA02601 66629000
         MVI   RCBTCBFL,TERM            SET TERMINATION KEY    @ZA02601 66669000
         MVC   RCBTCB+ONE(L3),RMPLTCBA+ONE MOVE TCB ADDRESS    @ZA02601 66689000
         ST    RPEWA,RCBDSNM            PASS PEWA ADDRESS      @ZA02601 66709000
         ST    RONE,PEWARCB-IEDQPEWA(RPEWA)  RCB ADDR IN PEWA  @OZ07798 66749000
         MVC   PEBASCB,QOT1             INVALIDATE ASCB        @ZA02601 66789000
         OI    PEWAFLG-IEDQPEWA(RPEWA),TERMKEY SET CLOSE REQ   @ZA02601 66809000
         OI    PEWAFLG-IEDQPEWA(RPEWA),TERMKEY AGAIN FOR MP    @ZA02601 66829000
         OI    PEBFLAG,PEBCLOSE         FLAG PEB AS POCESSED   @ZA02601 66869000
         TM    PEWAOPT2-IEDQPEWA(RPEWA),PEWAIN INPUT OPENED    @ZA02601 66909000
         BNO   NOTBUSY                  NO, BRANCH             @ZA02601 66929000
         MVI   RCBDCBMA,PEWAIN          SET FOR INPUT          @ZA02601 66949000
         TM    PEWAFLG-IEDQPEWA(RPEWA),ERBBUSY ERB BUSY        @ZA02601 66989000
         BO    LOOPPEWA                 YES, SKIP POST         @ZA02601 67029000
NOTBUSY  EQU   *                                               @ZA02601 67049000
         L     RRECB,TCXREADY           GET FIRST ELEMENT ON   @ZA02601 67069000
*                                       ASYNCHRONOUS RDY QUEUE @ZA02601 67109000
SWAP     EQU   *                        CHAIN READY QUEUE      @ZA02601 67149000
*                                       ELEMENT TO THE RCB     @ZA02601 67169000
         STCM  RRECB,ADDR,RECBLINK      SET UP LINK POINTER    @OZ16542 67189000
         CS    RRECB,RONE,TCXREADY      PUT RCB ON QUEUE       @ZA02601 67229000
         BNE   SWAP                     RETRY IF CS FAILED     @ZA02601 67269000
         L     RONE,PTRSA               GET SAVE AREA ADDRESS  @ZA02601 67289000
         STM   RZERO,R15,ZERO(RONE)     SAVE REGS              @ZA02601 67309000
         L     RPOST13,TCXASCB          ASCB ADDR FOR MCP      @ZA02601 67349000
         L     RPOST11,TCXAVT           AVT ADDRESS            @ZA02601 67389000
         LA    RPOST11,AVTOSECB-IEDQAVTD(RPOST11) ECB ADDRESS  @ZA02601 67409000
         ICM   RPOST11,HIGHORDR,HIBIT SET CROSS MEM POST       @ZA02601 67429000
         SR    RPOST10,RPOST10          SET COMPLETION CODE    @ZA02601 67469000
         LA    RPOST12,CVTBRET          SET ERROR RETURN       @ZA02601 67509000
         L     RPOST15,CVT0PT01         ADDRESS OF POST        @ZA02601 67529000
         LR    RPOST9,RONE              SAVE ADDR OF REGS      @ZA02601 67549000
         BALR  RPOST14,RPOST15          POST MCP               @ZA02601 67589000
         LM    RZERO,R15,ZERO(RPOST9)   RESTORE REGS           @ZA02601 67629000
         B     LOOPPEWA                 GET NEXT PEWA          @ZA02601 67649000
         SPACE 5                                               @ZA02601 67669000
GETSA    EQU   *                                               @ZA02601 67709000
         ICM   RONE,ALL,PTRSA           ALREADY HAVE SAVE AREA @ZA02601 67749000
         BNZR  RBRANCH                  YES, SKIP GETMAIN      @ZA02601 67769000
         L     RZERO,GETPARM            SUBPOOL AND LENGTH     @ZA02601 67789000
         GETMAIN R,LV=(0)               GET SAVE AREA          @ZA02601 67829000
         ST    RONE,PTRSA               SAVE ADDR OF SAVE AREA @ZA02601 67869000
         BR    RBRANCH                  RETURN TO MAINLINE CODE@ZA02601 67889000
         SPACE 3                                               @ZA02601 67909000
SAFREE   EQU   *                                               @ZA02601 67949000
         ICM   RONE,ALL,PTRSA           SAVE AREA ADDRESS      @ZA02601 67989000
         BZR   RBRANCH                  NONE TO FREE, RETURN   @ZA02601 68009000
         L     RZERO,GETPARM            SUBPOOL AND LENGTH     @ZA02601 68029000
         FREEMAIN R,LV=(0),A=(1)        FREE SAVE AREA         @ZA02601 68069000
         BR    RBRANCH                  RETURN TO CALLER       @ZA02601 68109000
         EJECT                                                          69600021
*********************************************************************** 69700000
*                                                                     * 69800000
*        EQUATES                                                 Y02027 70000000
*                                                                     * 70600000
*********************************************************************** 70900000
ZERO     EQU   0                        OFFSET                   Y02027 71200000
ONE      EQU   1                        OFFSET                   Y02027 71500000
TWO      EQU   2                        OFFSET                   Y02027 71800000
FOUR     EQU   4                        OFFSET                   Y02027 71900000
FIVE     EQU   5                        OFFSET                   Y02027 72100000
         SPACE 2                                                 Y02027 72200000
L3       EQU   3                        COMPARE LENGTH OF 3      Y02027 72300000
L4       EQU   4                        ADDRESS LENGTH           Y02027 72400000
HALF     EQU   3                        ICM/STCM MASK            Y02027 72700000
ADDR     EQU   7                        MASK FOR ADDRESS INSERTS Y02027 72800000
HIGHORDR EQU   8                        MASK FOR HIGH ORDER      Y02027 73000000
*                                       BYTE INSERTS             Y02027 73300000
ALL      EQU   15                       ICM/STCM MASK            Y02027 73400000
         SPACE 2                                                 Y02027 73600000
TERMKEY  EQU   X'40'                    TERMINATOR KEY FOR CLOSE Y02027 73900000
TERM     EQU   X'C0'                    NORMAL OR ABNORMAL       Y02027 74700000
*                                       TERMINATION              Y02027 75500000
PRIORITY EQU   X'C0'                    PRIORITY                 Y02027 75600000
TRT      EQU   256                      LEN OF TRT TABLE       @OZ09293 75650000
NOTCAM   EQU   4                        TCAM NOT IN SYSTEM     @ZA02601 75700000
HPAGE    EQU   2048                     HALF PAGE SIZE         @ZA02601 75750000
KEY0     EQU   0                        KEY 0                  @Z40X9BG 75800000
SQA      EQU   245                      SRB SUBPOOL            @Z40X9BG 75900000
KEY6     EQU   6                        KEY 6                  @ZA02601 75950000
CSA      EQU   231                      SUBPOOL FOR AIB'S      @ZA02601 76000000
ABEND    EQU   X'FF'                    ABEND CODE FOR CLEANUP   Y02027 76020000
NONBISC  EQU   X'2F'                    NON-BISC LINE            Y02027 76050000
ATTNTAB  EQU   X'14'                    ATTENTION TAB            Y02027 76060000
TCAM     EQU   ATTNTAB*TWO              OFFSET OF TCAM'S ENTRY   Y02027 76070000
*                                       IN ATTENTION TABLE       Y02027 76100000
BISC     EQU   X'30'                    BISC LINE                Y02027 76120000
         SPACE 1                                                 Y02027 76140000
DISPLAY  EQU   X'10'                    GRAPHICS DEVICE          Y02027 76160000
L2260    EQU   X'03'                    2260 LOCAL               Y02027 76180000
TUBE     EQU   X'09'                    3270 TUBE                Y02027 76200000
PRT1     EQU   X'0A'                    3270 PRINTER             Y02027 76220000
PRT2     EQU   X'0B'                    3270 PRINTER             Y02027 76240000
         SPACE 1                                                 Y02027 76260000
ATI2260  EQU   X'10'                    ATTENTION TAB FOR 2260L  Y02027 76280000
ATI3270  EQU   X'1C'                    ATTENTION TAB FOR 3270L  Y02027 76300000
ATI3705  EQU   X'00'                    ATTENTION TAB FOR 3705   Y02027 76320000
CONTROL  EQU   4                        LEN OF CONTROL WORD    @G36XRBB 76330000
         EJECT                                                          76340000
*********************************************************************** 76360000
*                                                                     * 76380000
*        STORAGE DEFINITIONS                                     Y02027 76400000
*                                                                     * 76600000
*********************************************************************** 76800000
         DS    0F                                                Y02027 77000000
GETPARM  DC    AL1(253)                 SUBPOOL NUMBER           Y02027 77200000
         DC    AL3(72)                  LENGTH OF SAVE AREA      Y02027 77300000
         SPACE 1                                                 Y02027 77400000
OPEN     DC    C'OPEN'                  OPEN KEY               @ZA02601 77600000
CLOS     DC    C'CLOS'                  CLOSE KEY              @ZA02601 77710000
QOT1     DC    C'QOT1'                  RTM CALL KEY           @ZA02601 77720000
CLRLOW   DS    0F                       MASK USED TO           @ZA02601 77730000
         DC    X'FFFFF000'              CLEAR 3 LOW BYTES      @ZA02601 77740000
SP231    DC    AL1(231)                 SUBPOOL 231              Y02027 77750000
HIBIT    DC    X'80'                    HIGH-ORDER BIT           Y02027 77800000
FOURK    DC    H'4096'                  LENGTH OF A PAGE       @OZ17630 77810000
ENDUCB   DC    X'FFFF'                  END-OF-UCB INDICATOR   @Z30AABG 77815000
         SPACE 1                                                 Y02027 77817000
PGFLG1   DC    XL1'20'                  PERFORM PGFREE         @Z40X9BG 77820000
PGFLG2   DC    XL1'80'                  LAST ENTRY             @Z40X9BG 77822000
         SPACE 1                                               @Z40X9BG 77824000
PATCH    DC    14H'0'                   PATCH AREA               Y02027 77826000
         EJECT                                                   Y02027 77830000
***************************************************************  Y02027 77840000
*                                                             *  Y02027 77850000
*        DSECT FOR RESOURCE MANAGER WORK AREA ADDRESSED BY    *  Y02027 77860000
*        RMPLRMWA IN THE RESOURCE MANAGER PARAMETER LIST.     *  Y02027 77870000
*                                                             *  Y02027 77880000
***************************************************************  Y02027 77890000
RTMWA    DSECT                          DSECT NAME               Y02027 77900000
SAVE13   DS    A                        SAVE AREA FOR CALLER'S   Y02027 77910000
*                                       REGISTER 13              Y02027 77920000
PTRSA    DS    A                        POINTER TO SAVE AREA     Y02027 77930000
         DS    6F                       UNUSED                   Y02027 77960000
         EJECT                                                          78000021
CVT      DSECT                                                          78400021
         CVT                                                            78800021
         EJECT                                                 @ZA02601 78803000
         TLCBD                                                 @ZA02601 78806000
         EJECT                                                          78812000
         IHARMPL                                                        78820000
         EJECT                                                          78826000
         IHAPSA                                                         78832000
         EJECT                                                          78840000
         TTCXD                                                   Y02027 78845000
         SPACE 3                                                 Y02027 78850000
         EJECT                                                          78855000
         TPEBD                                                          78860000
         SPACE 3                                                        78866000
FIRSTPEB EQU   TCXPEBC-IEDQTCX-PEBLINK+IEDQPEB OFFSET IN TCX TO  Y02027 78872000
*                                       MAKE TCXPEBC THE PEBLINK Y02027 78880000
*                                       FIELD IN A DUMMY PEB     Y02027 78886000
         EJECT                                                          78892000
         TAVTD                                                   Y02027 78900000
         EJECT                                                          78905000
         TPEWAD                                                  Y02027 78910000
         EJECT                                                          78915000
         TAIBD                                                          78920000
         EJECT                                                          78926000
         TRECBD                                                  Y02027 78933000
***************************************************************@ZA02601 78940000
*****    RCB EXTENSION FOR TCAM APPLICATION OPEN/CLOSE.        @ZA02601 78946000
***************************************************************@ZA02601 78952000
RCBPECB  DS    F                        APPLIC. PGM PECB ADDR. @ZA02601 78960000
RCBASCB  DS    F                        APPLIC. PGM ASCB ADDR. @ZA02601 78964000
RCBERRET DS    0F                       ERROR RTN ADDR         @ZA02601 78968000
RCBASID  DS    F                        APPLIC. PGM ASID ADDR. @ZA02601 78976000
RCBTCB   DS    F                        APPLIC. PGM TCB ADDR.  @ZA02601 78980000
RCBDCBMA DS    H                        DCBMACRF FROM APPLIC.  @ZA02601 78986000
RCBTCBFL DS    0X                       APPLIC. TCB FLAGS.     @ZA02601 78992000
RCBDCBDS DS    H                        DCBDSORG FROM APPLIC.  @ZA02601 79000000
RCBDSNM  DS    CL8                      PROCESS QUEUE NAME.    @ZA02601 79006000
RCBDEBAD DS    F                        DEB ADDR FOR APPL DCB  @ZA02601 79012000
RCBDCBBU DS    H                        DCBBUFL FROM APPLIC.   @ZA02601 79020000
RCBDCBLR DS    H                        DCBLRECL FROM APPLIC.  @ZA02601 79025000
RCBDCBOP DS    X                        DCBOPTCD FROM APPLIC.  @ZA02601 79030000
RCBDCBRF DS    X                        DCBRECFM FROM APPLIC   @ZA02601 79035000
RCBDCBF1 DS    X                        DCBFLAG1 FROM APPLIC   @ZA02601 79040000
RCBERR   DS    X                        ERROR INDICATOR        @ZA02601 79046000
RCBJOBNM DS    CL8                      JOBNAME                @ZA02601 79052000
RCBSAVE  DS    18F                      SAVE AREA FOR IEDQEU   @ZA02601 79060000
RCBEND   DS    0X                       END OF DSECT.          @ZA02601 79066000
         ORG   RCBTCB                                          @ZA02601 79072000
RCBDEBTA DS    H                        OFFSET IN T.T. FOR     @ZA02601 79080000
*                                       ENTRY                  @ZA02601 79085000
RCBOPECB DS    0AL3                     OPCTL ECB ADDRESS      @ZA02601 79090000
RCBDEBPW DS    AL3                      ADDR. OF PEWA.         @ZA02601 79095000
RCBDEBPC DS    AL3                      ADDR. OF PCB.          @ZA02601 79100000
         DS    2F                       QNAME                  @ZA02601 79106000
RCBSQ    DS    0X                       SECURE QUEUE FLAG      @ZA02601 79112000
RCBAVTBT DS    X                        AVTBIT1 ON RETURN      @ZA02601 79120000
*                                       FROM IEDQEU            @ZA02601 79124000
RCBPEBAD DS    AL3                      READ-AHEAD QCB ADDR.   @ZA02601 79130000
RCBSIZE  EQU   RCBEND-RECBKEY           SIZE OF DSECT.         @ZA02601 79136000
         EJECT                                                          79144000
         TTCBD                                                   Y02027 79152000
         EJECT                                                          79200021
UCB      DSECT                                                   Y02027 79300000
         IEFUCBOB                                                Y02027 79500000
         EJECT                                                 @Z40X9BG 79510000
         IECDVOID                                              @Z40X9BG 79520000
         EJECT                                                 @Z40X9DG 79530000
         IECDIOSB                                              @G36XRBB 79540000
         EJECT                                                 @G36XRBB 79550000
*        SRB DSECT                                             @Z40X9DG 79560000
         SPACE 2                                               @Z40X9DG 79570000
         IHASRB                                                @Z40X9DG 79580000
         EJECT                                                 @Z40X9DG 79590000
*        DSECT FOR FOUR-BYTE PREFIX TO SRB                     @Z40X9DG 79600000
         SPACE 1                                               @Z40X9DG 79610000
PSRBSECT DSECT                                                 @Z40X9DG 79620000
PSRBTSFL DS    XL1                      TEST AND SET FLAG      @Z40X9DG 79630000
PSRBLINK DS    AL3                      LINK TO NEXT SRB       @Z40X9DG 79640000
PSRBSRB  EQU   *                        START OF SRB           @Z40X9DG 79650000
PSRBSIZE EQU   *-PSRBSECT               SIZE OF PREFIX         @Z40X9DG 79660000
         SPACE 4                                               @Z40X9BG 79670000
NUMSRBS  EQU   8                        NUMBER OF SRB'S WITH   @Z40X9BG 79680000
*                                       PREFIX IN ONE BLOCK    @Z40X9BG 79690000
SIZESRB  EQU   SRBSIZE+PSRBSIZE         SIZE OF ONE SRB +      @Z40X9BG 79700000
*                                       PREFIX                 @Z40X9BG 79710000
SRBBLKSZ EQU   NUMSRBS*SIZESRB          SIZE OF SRB BLOCK      @Z40X9BG 79720000
         EJECT                                                          79800000
         IECDIOCM ,                                              Y02027 79810000
         EJECT                                                          79820000
         IECDATB ,                                               Y02027 79830000
         SPACE 3                                                        80040000
         END                                                            80400021
