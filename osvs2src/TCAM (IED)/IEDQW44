QW44     TITLE 'IEDQW44 - DIO SERVICE MODULE'                         * 00300022
IEDQW44  CSECT                                                        * 00600022
*A000000-999999                                                @Y16X5U0 00620000
* CHANGE ACTIVITY AS FOLLOWS:                                    S22024 00700000
*A272900,354000,366000,661000,783000                           @Y17XAUU 00760000
*C691000-715400                                                         00820000
* A008200,665400                                               @G36XRUV 00840010
* C429000,447000,665460                                        @G36XRUV 00860010
*                                                                       00880010
         SPACE 4                                                      * 00900022
****************************************************************        01200022
*                                                              *        01400022
* MODULE NAME = IEDQW44 (TCAM,TOTE)                            @Y17XAUU 01460000
*                                                              * S22024 01480000
* DESCRIPTIVE NAME = TOTE DIO MODULE                           * S22024 01500000
*                                                              * S22024 01520000
* COPYRIGHT = NONE                                             * S22024 01540000
*                                                              * S22024 01560000
* STATUS --                                                    *        01600022
*    VERSION 10.0                                              @Y17XAUU 01800000
*                                                              *        02000022
* FUNCTIONS --                                                 *        02200022
*    THE PURPOSE OF THIS ROUTINE IS TO ISSUE A HIO TO A        *        02400022
*    TEST DEVICE/LINE. CONTROL BLOCKS ARE SET UP AND THE       *        02600022
*    IOHALT MACRO IS EXECUTED. REGISTERS ARE RESTORED          *        02800022
*    AND CONTROL IS RETURNED TO THE UNIT TEST.                 *        03000022
*                                                              *        03200022
*    AT THE COMPLETION OF THIS ROUTINE ONE OF THE FOLLOWING    *        03400022
*    CODES IS PLACED IN REGISTER 15:                           *        03600022
*                                                              *        03800022
*    X'00' - NORMAL COMPLETION                                 *        04000022
*    X'04' - FUNCTION NOT AVAILABLE                            *        04200022
*    X'08' - I/O ERROR                                         *        04400022
*                                                              *        04600022
* PURPOSE -- SEE FUNCTION                                      @Y17XAUU 04600900
*                                                              @Y17XAUU 04601800
* MODULE TYPE -- PROCEDURE                                     @Y17XAUU 04602700
*                                                              @Y17XAUU 04603600
* MODULE SIZE -- 2K MAXIMUM                                    @Y17XAUU 04604500
*                                                              @Y17XAUU 04605400
* LINKAGE -- BALR R14,R15 FROM IEDQWA                          @Y17XAUU 04606300
*                                                              @Y17XAUU 04607200
* MACROS -- IEDHJN,IEDHALT                                     @Y17XAUU 04608100
*                                                              @Y17XAUU 04609000
* ENTRY POINTS --                                              *        04800022
*    IEDQW44 - CALLED WHEN THE UNIT TEST ISSUES A DIO MACRO.   *        05000022
*                                                              *        05200022
* INPUT --                                                     *        05400022
*    REGISTER 01, 02, 13, 14, 15 CONTAIN THE FOLLOWING VALUES  *        05600022
*                                                              *        05800022
*    01 - MESSAGE PARAMETER LIST ADDRESS                       *        06000022
*    02 - OLTCB BASE POINTER                                   *        06200022
*    13 - CALLER'S SAVE AREA ADDRESS                           *        06400022
*    14 - CALLER'S RETURN ADDRESS                              *        06600022
*    15 - IEDQW44 ENTRY POINT ADDRESS                          *        06800022
*                                                              *        07000022
* OUTPUT --                                                    *        07200022
*    THE RETURN CODE IS PLACED IN THE OLTCB                    *        07400022
*                                                              *        07600022
* EXTERNAL REFERENCES --                                       *        07800022
*    NONE                                                      *        08000022
*                                                              *        08200022
* EXITS,NORMAL --                                              *        08400022
*    RETURN TO CALLER                                          *        08600022
*    BR   TO IEDQWM2 TO PROVIDE TRACE FUNCTION                 @Y17XAUU 08800000
*                                                              *        09000022
* EXITS,ERROR --                                               *        09200022
*    RETURN TO CALLER                                          *        09400022
*    BR   TO IEDQWM2 TO PROVIDE TRACE FUNCTION                 @Y17XAUU 09600000
*                                                              *        09800022
* TABLES/WORK AREAS --                                         *        10000022
*    OLTCB,TECB,IOB,DCB,ECB                                    *        10200022
*                                                              *        10400022
* ATTRIBUTES --                                                *        10600022
*    ENABLED, PROBLEM PROGRAM MODE, RESIDENT, REENTRANT        @Y17XAUU 10800000
*                                                              *        11000022
* NOTES -- SEE BELOW                                           @Y17XAUU 11200000
*                                                              *        11600022
*  DEPENDENCIES -- EBCDIC CHARACTER CODE                       @Y17XAUU 11602000
*                                                              @Y17XAUU 11604000
*  REGISTERS CONVENTION -- SEE REGISTER ASSIGNMENT             @Y17XAUU 11606000
*                                                              @Y17XAUU 11608000
*  PATCH LABEL -- PATCH                                        @Y17XAUU 11610000
*                                                              @Y17XAUU 11612000
*  RESTRICTIONS -- NONE                                        @Y17XAUU 11614000
****************************************************************        11800022
         EJECT                                                          12600022
*                                                                       12900022
*        E Q U A T E S                                                  13200022
*                                                                       13500022
D0       EQU   0                  DISP OF 0                             13800022
D1       EQU   1                  DISP OF 1                             14100022
D2       EQU   2                  DISP OF 2                             14400022
D3       EQU   3                  DISP OF 3                             14700022
D4       EQU   4                  DISP OF 4                             15000022
D5       EQU   5                  DISP OF 5                             15300022
D6       EQU   6                  DISP OF 6                             15600022
D7       EQU   7                  DISP OF 7                             15900022
D8       EQU   8                  DISP OF 8                             16200022
D9       EQU   9                  DISP OF 9                             16500022
D10      EQU   10                 DISP OF 10                            16800022
D11      EQU   11                 DISP OF 11                            17100022
D12      EQU   12                 DISP OF 12                            17400022
D13      EQU   13                 DISP OF 13                            17700022
D14      EQU   14                 DISP OF 14                            18000022
D15      EQU   15                 DISP OF 15                            18300022
D16      EQU   16                 DISP OF 16                            18600022
D20      EQU   20                 DISP OF 20                            18900022
D24      EQU   24                 DISP OF 24                            19200022
D28      EQU   28                 DISP OF 28                            19500022
D32      EQU   32                 DISP OF 32                            19800022
R0       EQU   0                  REG 0                                 20100022
R1       EQU   1                  REG 1                                 20400022
R2       EQU   2                  REG 2                                 20700022
R3       EQU   3                  REG 3                                 21000022
R4       EQU   4                  REG 4                                 21300022
R5       EQU   5                  REG 5                                 21600022
R6       EQU   6                  REG 6                                 21900022
R7       EQU   7                  REG 7                                 22200022
R8       EQU   8                  REG 8                                 22500022
R9       EQU   9                  REG 9                                 22800022
R10      EQU   10                 REG 10                                23100022
R11      EQU   11                 REG 11                                23400022
R12      EQU   12                 REG 12                                23700022
R13      EQU   13                 REG 13                                24000022
R14      EQU   14                 REG 14                                24300022
R15      EQU   15                 REG 15                                24600022
RTNALL   EQU   X'FF'              TEST ALL BITS FLAG                    24900022
BADLEV   EQU   X'04'              UNAVAILABLE FUNCTION RETURN CODE      25200022
GDLEV    EQU   X'02'              LEVEL OF THIS MODULE                  25500022
UNSUP    EQU   X'04'              UNSUPPORTED MACRO FUNCTION            25800022
BDCOD    EQU   X'08'              DEVICE STOPPED RETURN CODE            26100022
CVTADR   EQU   16                 POINTER TO CVT ADDR                   26400022
PURRB    EQU   X'80'              PURGE DEB FLAG                        26700022
GDRCOD   EQU   0                  RETURN CODE OF 0                      27000022
PRIFLG   EQU   X'80'              TEST ON PRIMARY TERMINAL/LINE ?       27050022
FOUR     EQU   4                  VALUE OF 4                            27100022
TWO      EQU   2                  VALUE OF TWO                          27150022
EIGHT    EQU   8                  VALUE OF EIGHT                        27200022
X3F      EQU   X'3F'              USED TO CLEAR FLAG                    27250022
XFF      EQU   X'FF'              MASK FIELD                            27258022
CC0      EQU   X'00'              CONDITION CODE 0                      27266022
CC1      EQU   X'01'              CONDITION CODE 1                      27274022
UCHK     EQU   X'02'              UNIT CHECK                            27282022
XF0      EQU   X'F0'              MASK FIELD                            27290022
DISREG2  EQU   28                 DISPLACEMENT TO REG 2        @Y17XAUU 27292000
         EJECT                                                          27300022
         USING IEDQW44,R15                                              27600022
         SPACE                                                          27900022
IEDQW44  IEDHJN STAR44,HJN                                              28200022
         SPACE                                                          28500022
         DROP  R15                                                      28800022
         SPACE                                                          29100022
         SAVE  (14,12)            SAVE CALLER'S REGISTERS               29400022
         SPACE                                                          29700022
         USING IEDQW44,R4                                               30000022
         USING TOTOLTCB,R2                                              30300022
         USING PLIST,R3                                                 30500022
         LR    R3,R1              SET PARAMETER LIST BASE               30700022
         SPACE                                                          30900022
         LR    R4,R15             SET BASE REGISTER FOR THIS MODULE     31200022
         SPACE                                                          31500022
         LA    R15,TOTSAVE1       GET MY SAVE AREA ADDRESS              31800022
         ST    R15,D8(R13)        SAVE IT IN CALLER'S SAVE AREA         32100022
         ST    R13,D4(R15)        SAVE CALLER'S SAVE REG                32400022
         LR    R13,R15            SET UP SAVE AREA REG                  32700022
         SPACE                                                          33000022
         CLI   PLMLEV,GDLEV       CORRECT MACRO LEVEL ?                 33300022
         BE    DI010              YES - CHECK FOR UNSUPPORTED FUNCTIONS 33600022
DI005    EQU   *                                                        33900022
         LA    R15,BADLEV         SET RETURN CODE                       34200022
         STC   R15,TOTRTCOD       SAVE RETURN CODE                      34500022
         L     R13,D4(R13)        RESTORE SAVE AREA ADDR                34800022
         L     R14,D12(R13)       RESTORE REG 14                        35100022
*                                                                       35400022
         USING RESPL,R5           SET RESPL ADDRESSABILITY     @Y17XAUU 35405000
         L     R5,TOTRESPL        GET RESPL ADDRESS            @Y17XAUU 35410000
         L     R15,RESPLM2        GET TRACE ROUTINE ADDRESS    @Y17XAUU 35415000
         LM    R2,R12,DISREG2(R13) RESTORE REGISTERS           @Y17XAUU 35420000
         BR    R15                EXIT TO TRACE ROUTINE        @Y17XAUU 35425000
         DROP  R5                                                       35430000
*                                                                       36000022
         SPACE                                                          36300022
DI010    EQU   *                                                        36600022
         TM    PLOFLG,PLTIO+PLTCH TIO OR TCH REQUESTED ?                36900022
         BZ    DI015              NO                                    37200022
*                                                                       37500022
*        UNSUPPORTED MACRO FUNCTION REQUESTED                           37800022
*                                                                       38100022
         OI    TOTFLG09,TOTMACFT  SET UNSUPPORTED MACRO FTN FLAG        38200022
         B     DI005              NOTIFY CTL TERMINAL OF ERROR          38400022
         SPACE 2                                                        38700022
*                                                                       39000022
DI015    EQU   *                                                        39300022
*        BEGIN PROCESSING OF HIO REQUEST                                39600022
         ST    R1,PLSAVE          SAVE PLIST ADDR                       39900022
         BAL   R5,CDSFIND         DETERMINE TEST TYPE                   40200022
         TM    KFLAG,PRIFLG       PRIMARY TEST ?                        40500022
         BO    DIPRI              YES                                   40800022
         B     DISEC              NO - HIO FOR SECONDARY DEVICE         41400022
*                                                                       41700022
DIPRI    EQU   *    HIO FOR PRIMARY DEVICE                              42000022
*                                                                       42300022
         SR    R6,R6              CLEAR REG 6                           42600022
         ICM   R6,3,TOTPRUCB      GET PRIMARY UCB ADDR         @G36XRUV 42900010
         B     DI020              EXIT TO VERIFY UCB CLASS              43200022
*                                                                       43500022
DISEC    EQU   *                                                        43800022
*                                                                       44100022
         SR     R6,R6             CLEAR REG 6                           44400022
         ICM    R6,3,TOTSCUCB     GET SECONDARY UCB ADDR       @G36XRUV 44700010
         SPACE                                                          45000022
*                                                                       45300022
DI020    EQU   *    DETERMINE TEST DEVICE CLASS                         45600022
*                                                                       45900022
         USING UCB,R6                                                   46200022
         CLI   UCBTBYT3,UCB3COMM  TP CLASS ?                            46500022
         BNE   DI030              NO - EXIT TO PURGE DEVICE (SVC 16)    46800022
         SPACE                                                          47100022
         LR    R1,R6              SET UP PARAMETER FOR SVC 33 (IOHALT)  47400022
*                                                                       47700022
         SVC   33                 ISSUE IOHALT TO TEST DEVICE           48000022
*                                                                       48300022
         LTR   R15,R15            WAS DEVICE STOPPED                    48600022
         BZ    DI025              YES                                   48900022
         CH    R15,INACT          WAS DEVICE ACTIVE                     49200022
         BE    DI025              NO                                    49500022
*                                                                       49800022
         LA    R15,BDCOD          SET DEVICE NOT STOPPED RETURN CODE    50100022
         B     DI083              EXIT                                  50400022
*                                                                       50700022
         SPACE                                                          51000022
DI025    EQU    *                                                       51300022
         SR    R15,R15            CLEAR RETURN CODE REG                 51600022
         B     DI080              EXIT                                  51900022
         SPACE 2                                                        52200022
*                                                                       52500022
DI030    EQU   *    PURGE TEST DEVICE - NON TP                          52800022
*                                                                       53100022
         L     R5,CVTADR          GET CVT ADDR                          53400022
         USING CVT,R5                                                   53700022
         L     R6,CVTTCBP         GET ADDR OF CURRENT TCB POINTER LIST  54000022
         L     R6,D4(R6)          GET CURRENT TCB ADDR                  54300022
         ST    R6,PRGTCB-D1       PUT IN P-LIST                         54600022
         DROP  R5                                                       54900022
*                                                                       55200022
         L     R5,PLCNFG          GET ADDR OF CONFIGURATION DATA (SEC)  55500022
         LA    R5,D0(R5)          CLEAR HIGH ORDER BYTE                 55800022
         LTR   R5,R5              IS ADDRESS ZERO                       56100022
         BZ    DI035              YES - GET PRIMARY DEB ADDR            56400022
         L     R6,TOTSCDEB        NO - GET SECONDARY DEB ADDR           56700022
         B     DI040              CONTINUE PROCESSING                   57000022
*                                                                       57300022
DI035    EQU   *                                                        57600022
*                                                                       57900022
         L     R6,TOTPRDEB        GET PRIMARY DEB ADDR                  58200022
*                                                                       58500022
DI040    EQU   *                                                        58800022
*                                                                       59100022
         ST    R6,PRGDEB-D1       PUT DEB ADDR IN P-LIST                59400022
         SPACE                                                          59700022
         MVI   PRGOPT,PURRB       SET OPTION FLAGS                      60000022
         LA    R1,PRGOPT          GET ADDR OF REQUEST ELEMENT           60100022
         SPACE                                                          60300022
         SVC   16                                                       60600022
         SPACE                                                          60900022
         B     DI025              EXIT                                  61200022
         SPACE 2                                                        61500022
DI080    EQU   *                                                        61800022
         EJECT                                                          61802022
PRESULT  EQU   *                                                        61804022
         DROP  R3                                                       61806022
         USING PLIST,R12                                                61808022
         L     R12,PLSAVE         GET PLIST ADDR                        61810022
         USING IOBLOCKS,R7                                              61812022
         L     R5,PLTECB          GET TECB ADDR                         61814022
         NI    IOBFLG4,XFF-IOBCSWNV TURN OFF NOT VALID FLAG             61816022
         USING TTECB,R5                                                 61818022
         SR    R8,R8                   CLEAR REG                        61820022
         IC    R8,TECBFDCT             GET NUMBER OF EVENT BLOCKS       61822022
         SR    R3,R3                   CLEAR REG                        61824022
         IC    R3,TECBEVOC             GET NUMBER OF EVENTS OCCURRED    61826022
         CR    R3,R8                   COMPARE NUMBER USED WITH NUMBER  61828022
*        OF BLOCKS                                                      61830022
         BL    NXTENT                  ANY LEFT BRANCH TO FIND NEXT     61832022
NONELEFT LA    R3,1(R3)                ADD ONE TO OCCURRED EVENTS       61834022
         STC   R3,TECBEVOC             STORE IN TECB                    61836022
CLEARECB XC    ECBOLT,ECBOLT           CLEAR ECB                        61838022
         TM    IOBFLG4,IOBCSWNV   NOT VALID SET                         61840022
         BO    PRESULT            YES BRANCH                            61842022
         B     DI083              EXIT                                  61844022
***      FIND NEXT AVAILABLE EVENT ENTRY                                61846022
NXTENT   EQU   *                                                        61848022
         SR    R11,R11                 CLEAR REG                        61850022
         IC    R11,TECBFDLN            GET LENGTH OF FIELD SIXE         61852022
         MR    R10,R3                  LENGTH OF ALL USED EVENT BLOCKS  61854022
         LA    R11,D8(R11)        ADD LENGTH OF FIXED AREA              61856022
         LR    R10,R5                  GET TECB ADDRESS                 61858022
         AR    R10,R11                 POINT TO FIRST FREE EVENT BLOCK  61860022
         IC    R6,IOBSIOCD        GET CC                                61862022
         SLL   R6,26              CLEAR ALL                             61864022
         SRL   R6,30              OUT BUT CC                            61866022
         STC   R6,IOBSIOCD        RETURN TO IOB                         61868022
         MVC   D0(D1,R10),IOBSIOCD MOVE CC FROM UCB                     61870022
         OI    D0(R10),XF0        CONVERT TO EBCDIC                     61872022
         L     R1,OLTUCBA              GET UCB ADDRESS                  61874022
         SRL   R1,D16             UCB ADDRESS                           61876022
         USING UCB,R1                                                   61878022
         MVC   D2(D2,R10),UCBCHA  MOVE IN I/O ADDR                      61880022
         CLI   IOBSIOCD,CC0       CONDITION CODE = 0                    61882022
         BE    ZEROCC             YES BRANCH                            61884022
         CLI   IOBSIOCD,CC1       CONDITION CODE = 1                    61886022
         BE    ONECC                   YES BRANCH                       61888022
***      ASSUME CONDITION CODE 3                                        61890022
NOUSEDEV EQU   *                                                        61892022
         LA    R3,D1(R3)          BUMP NUMBER OF USED BLKS              61893022
CONTSAVE STC   R3,TECBEVOC             SAVE EVENTS USED COUNT           61894022
         B     UNITCKTS                GO CHECK FOR UNIT CHECK          61896022
ONECC    EQU   *                                                        61898022
         TM    IOBFLG4,IOBCSWV    SECOND CSW VALID                      61900022
         BZ    MOVECSW            NO BRANCH                             61902022
         NI    IOBFLG4,XFF-IOBCSWV TURN OFF FLAG                        61904022
         OI    IOBFLG4,IOBCSWNV   TURN ON NOT VALID                     61905022
         MVC   D5(D7,R10),IOBCSWS CSW TO TECB                           61906022
         B     NOUSEDEV           GO INCREMENT EVENT COUNT              61907022
MOVECSW  EQU   *                                                        61908022
         MVC   D5(D7,R10),IOBCSW1 CSW TO TECB                           61909022
         B     NOUSEDEV                GO BUMP NUMBER USED EVENTS       61914022
ZEROCC   EQU   *                                                        61916022
         TM    OLTFLAG2,OLTLV3IO       WAS EXIO LEVEL 3                 61918022
         BO    LEVEL3                  YES BRANCH                       61920022
         OI    D0(R10),XFF        CC OF 0                               61922022
         B     ONECC              GO MOVE CSW                           61924022
LEVEL3   EQU   *                                                        61926022
         LA    R3,D1(R3)          BUMP NUMBER USED EVENT BLOCKS         61928022
         CR    R3,R8                   ANY MORE BLOCKS LEFT             61930022
         BE    NONELEFT                NO MORE BLOCKS BRANCH            61932022
         IC    R11,TECBFDLN            GET FIELD LENGTH                 61934022
         AR    R10,R11                 POINT TO NEXT FIELD ENTRY        61936022
         OI    D0(R10),XFF        SET CC TO ALL ONES                    61938022
         USING UCB,R1                                                   61940022
         MVC   D2(D2,R10),UCBCHA  MOVE IN I/O ADDRESS                   61942022
         MVC   D5(D7,R10),IOBCSW1 MOVE CSW TO TECB                      61944022
         B     CONTSAVE                GO SAVE COUNT                    61946022
UNITCKTS EQU   *                                                        61948022
         TM    IOBCSW+D4,UCHK     UNIT CK IN CSW                        61950022
         BZ    CLEARECB                NO BRANCH                        61952022
         IC    R11,TECBFDLN            GET EVENT LENGTH                 61954022
         MR    R10,R8                  GET LENGTH OF ALL EVENT BLOCKS   61956022
*                                      IN R11                           61958022
         LA    R11,D8(R11)        ADD LENGTH OF FIXED AREA              61960022
         LR    R10,R5                  GET TECB ADDRESS                 61962022
         AR    R10,R11                 POINT TO FIRST SENSE BLOCK       61964022
***      SENSE FIEND                                                    61966022
         IC    R3,TECBSNOC             GET NUMBER OF USED SENSE BLOCKS  61968022
         IC    R11,TECBSNCT            GET NUMBER OF SENSE BLOCKS       61970022
         CR    R3,R11                  ALL USED?                        61972022
         BNL   BUMPSNOC                YES BRANCH                       61974022
         LH    R9,TECBSNLN             GET SIZE OF EACH SENSE FIELD     61976022
         MR    R8,R3                   SIZE SENSE FIELD TIMES # USED    61978022
         AR    R9,R10                  ADD TO ADDRESS OF FIRST SENSE    61980022
***                                    FIELD                            61982022
         LH    R11,TECBSNLN            GET SIZE OF SENSE FIELD          61984022
         MVC   D1(D2,R9),UCBCHA   MOVE IN I/O ADDRESS                   61986022
         L     R12,SENSELN             SENSE LENGTH COMPUTE             61988022
         SR    R11,R12                 FIND LENGTH OF SENSE TO MOVE     61990022
         EX    R11,SENSEMOV            GO MOVE SENSE                    61992022
BUMPSNOC EQU   *                                                        61994022
         LA    R3,D1(R3)          BUMP NUMBER USED SNS BLKS             61995022
         B     CLEARECB                BRANCH                           61996022
         EJECT                                                          61998022
*                                                                       62000022
DI083    EQU   *                                                        62002022
*                                                                       62004022
         STC   R15,TOTRTCOD       SAVE RETURN CODE                      62100022
         L     R13,D4(R13)        GET CALLER'S SAVE AREA ADDR           62400022
         L     R14,D12(R13)       RESTORE RETURN ADDR                   62700022
         TM    $OLTFLGS,$TRACE    TRACE FUNCTION REQUESTED ?            63000022
         BO    DI095              YES                                   63300022
         CLI   TOTRTCOD,GDRCOD    ZERO RETURN CODE ?                    63600022
         BE    DI085              YES                                   63900022
         CLI   $RETMASK,D0        ANY TRACE FLAGS SET          @Y17XAUU 64000000
         BNE   DI095              YES                                   64500022
DI085    EQU   *                                                        64800022
         LM    R0,R12,D20(R13)    RESTORE CALLER'S REG                  65100022
         BR    R14                RETURN                                65400022
         SPACE                                                          65700022
DI095    EQU   *                                                        66000022
         L     R1,D20(R13)        RESTORE REG 1                         66100022
         USING RESPL,R5           SET RESPL ADDRESSABILITY     @Y17XAUU 66102000
         L     R5,TOTRESPL        GET RESPL ADDRESS            @Y17XAUU 66104000
         L     R15,RESPLM2        GET TRACE ROUTINE ADDRESS    @Y17XAUU 66106000
         LM    R2,R12,DISREG2(R13) RESTORE REGISTERS           @Y17XAUU 66108000
         BR    R15                EXIT TO TRACE ROUTINE        @Y17XAUU 66110000
         DROP  R5                                              @Y17XAUU 66112000
         EJECT                                                          66306022
*        DETERMINE WHETHER TO USE PRIMARY OR SECONDARY UCB              66312022
*                                                                       66318022
CDSFIND  EQU   *                                                        66324022
         DROP  R12                                                      66330022
         USING PLIST,R3                                                 66336022
         STM   R7,R9,SAVE         SAVE REG                              66342022
         CLC   PLCNFG(FOUR),ZEROADDR IS CDS ADDR EQU TO 0               66348022
         BE    CDSPRI             YES - SH0W PRIMARY TEST               66354022
*                                                                       66360022
         L     R7,PLCNFG          GET ADDR OF BASIC CDS INFO            66366022
         TM    TOTTDTBL,TOTTDTRM  TEST DEVICE A TERMINAL                66372022
         BZ    CDSLINE            NO - TEST IS FOR A LINE               66378022
         SR    R8,R8              CLEAR REG 8                           66384022
         IC    R8,TOTTTBEL        GET LENGTH OF NAME FIELD IN           66390022
*                                 TERMNAME TABLE ENTRY                  66396022
         BCT   R8,CDSLABEL        DECREMENT LENGTH BY 1                 66402022
CDSLABEL EQU   *                                                        66408022
         L     R9,TOTTNTPR        GET TNT ADDR OF PRIMARY DEVICE        66414022
*                                                                       66420022
         EX    R8,COMPARE         COMPARE SYMBOLIC NAME                 66426022
         BE    CDSPRI             IF THE SAME SHOW PRIMARY              66432022
*                                                                       66438022
         L     R9,TOTSRTNT        GET TNT ADDR                          66444022
*                                                                       66450022
         EX    R8,COMPARE         COMPARE SYMBOLIC NAME                 66456022
         BE    CDSSEC             SECONDARY TEST                        66462022
*                                                                       66468022
CDSPRI   EQU   *                                                        66474022
         LA    R7,TOTPRIBK        SET UP PRIMARY IOBLOCKS BASE          66480022
         OI    KFLAG,PRIFLG       SHOW PRIMARY                          66486022
         B     CDSEND             EXIT                                  66492022
CDSSEC   EQU   *                                                        66498022
         LA    R7,TOTSCIBK        SET UP SECONDARY IOBLOCKS BASE        66504022
*                                                                       66510022
CDSEND   EQU   *                                                        66516022
         LM    R8,R9,SAVE+D4      RESTORE REG                           66522022
         BR    R5                 RETURN                                66528022
*                                                                       66534022
CDSLINE  EQU   *                                                        66540022
         SLR   R8,R8              CLEAR                        @G36XRUV 66543010
         ICM   R8,3,TOTPRUCB      GET PRIMARY UCB ADDR         @G36XRUV 66546010
         MVC   UCBAREA,FOUR(R8)   STORE UNIT ADDR                       66552022
         NI    UCBAREA,X3F        CLEAR HI ORDER HALF BYTE              66558022
         CLC   UCBAREA,TWO(R7)    COMPARE UNIT NAMES                    66564022
         BE    CDSPRI             SHOW PRINARY                          66570022
         B     CDSSEC             SHOW SECONDARY                        66576022
         EJECT                                                          66582022
         EJECT                                                          66600022
*                                                                       66900022
*        C O N S T A N T S                                              67200022
*                                                                       67500022
INACT    DC    H'4'               DEVICE INACTIVE                       67800022
         SPACE                                                          68100022
*                                                                       68400022
*        SVC 33 PARAMETER LIST                                          68700022
*                                                                       69000022
SENSELN  DC    F'4'               SENSE LENGTH FACTOR          @Y17XAUU 71542000
SENSEMOV MVC   3(0,R9),UCBSNS     MOVE UCB SENSE                        71560022
COMPARE  CLC   D0(D0,R9),D12(R7)  COMPARE NAMES                         71580022
PATCH    DS    CL150              PATCH AREA                            71600022
         EJECT                                                          71700022
PLIST    DSECT                                                          72000022
PLFLG    DS    CL1                CONTROL PROGRAM FLAGS                 72300022
PLMLEV   DS    AL1                MACRO LEVEL                           72600022
PLID     DS    CL2                MACRO ID                              72900022
PLCNFG   DS    A                  ADDR OF CONFIGURATION DATA            73200022
PLTECB   DS    A                  TECB ADDRESS                          73500022
PLOFLG   DS    AL1                OPERATION FLAGS                       73800022
*                                                                       74100022
PLHIO    EQU   X'01'              HIO OPERATION                         74400022
PLTIO    EQU   X'02'              TIO OPERATION                         74700022
PLTCH    EQU   X'04'              TCH OPERATION                         75000022
*                                                                       75300022
         EJECT                                                          75370022
IOBLOCKS IOBLOCKS                                                       75440022
*                                                                       75510022
         SPACE 4                                                        75600022
UCB      DSECT                                                          75900022
         IEFUCBOB                                                       76200022
         EJECT                                                          76500022
         TTECB                                                          76800022
         EJECT                                                          77100022
CVT      DSECT                                                          77400022
         CVT                                                            77700022
         EJECT                                                          77730000
RESPL    RESPL                                                 @Y17XAUU 77760000
         EJECT                                                          78000022
         OLTCB                                                          78300022
PRGOPT   DC    AL1(0)             PURGE OPTIONS                @Y17XAUU 78301000
PRGDEB   DC    AL3(0)             ADDRESS OF DEB               @Y17XAUU 78302000
PRGCOD   DC    AL1(0)             COMPLETION CODE              @Y17XAUU 78303000
PRGTCB   DC    AL3(0)             ADDRESS OF TCB               @Y17XAUU 78304000
PRGCTR   DC    AL1(0)             QUIESCE COUNT                @Y17XAUU 78305000
PRGCHN   DC    AL3(0)             ADDRESS OF FIRST LINK IN CHN @Y17XAUU 78306000
PRGFLG   DC    AL1(0)             FLAGS                        @Y17XAUU 78307000
PRGQUI   DC    AL3(0)             ADDR OF QUIESCE IO PARM LIST @Y17XAUU 78308000
PLSAVE   DC    F'0'               PLIST ADDR SAVE AREA         @Y17XAUU 78309000
SAVE     DC    3F'0'              SAVE AREA                    @Y17XAUU 78310000
ZEROADDR DC    F'0'               COMPARE FIELD                @Y17XAUU 78311000
UCBAREA  DC    H'0'               UCB UNIT NAME                @Y17XAUU 78312000
KFLAG    DC    X'00'              CONTROL FLAG                 @Y17XAUU 78313000
         END                                                            78600022
