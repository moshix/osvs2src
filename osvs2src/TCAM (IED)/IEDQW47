QW47     TITLE 'IEDQW47 - ROUTINE SERVICE MODULE'                       00300022
IEDQW47  CSECT                                                          00600022
*A000000-999999                                                @Y16X5U0 00620000
*CHANGE ACTIVITY AS FOLLOWS:                                            00650022
*A366000                                                        SA41596 00700022
*A273000,420000,432000                                          SA41599 00800022
*A405022-405026,683500-683880                                   SA64770 00850054
*D414000,417000                                                @YA11128 00850158
*A311800,393000,405000,510000,622000,872500,963000             @Y17XAUU 00860100
*C646000,656000,660000,670000,676000-680000,787000-825000      @Y17XAUU 00870100
* A660000                                                      @G36XRUV 00879110
* C662000                                                      @G36XRUV 00888110
*                                                                       00900022
*                                                                       01200022
         USING IEDQW47,R15                                              01500022
*                                                                       01800022
IEDQW47  IEDHJN START,HJN                                               02100022
         SPACE 2                                                        02400022
*********************************************************************** 02700022
*                                                                     * 02900022
* MODULE NAME:  IEDQW47 (TCAM,TOTE)                            @Y17XAUU 02960000
*                                                                     * 02980022
* DESCRIPTIVE NAME:  TOTE ROUTINE SERVICE MODULE                      * 03000022
*                                                                     * 03020022
* COPYRIGHT:  'NONE'                                                  * 03040022
*                                                                     * 03060022
* STATUS --                                                           * 03100022
*    VERSION 10.0                                              @Y17XAUU 03300000
*                                                                     * 03500022
* FUNCTIONS --                                                        * 03700022
*    THE PURPOSE OF THIS MODULE IS TO HANDLE THE SELECTION AND        * 03900022
*    RUNNING OF ROUTINES WITHIN AN OLT SECTION.  THE BASIC            * 04100022
*    FUNCTIONS PERFORMED ARE AS FOLLOWS:                              * 04300022
*         A. DETERMINE IF THE ROUTINE SHOULD BE RUN BY CHECKING       * 04500022
*            THE ROUTINE MASK IN THE SCT. IF THE ROUTINE MASK         * 04700022
*            IS OFF THE ROUTINE SERVICE MODULE WILL GET THE           * 04900022
*            POINTER TO THE NEXT ROUTINE FROM THE MACRO PARAMETER     * 05100022
*            LIST AND BRANCH TO THE NEXT ROUTINE.                     * 05300022
*                                                                     * 05500022
*         B. DETERMINE IF THE ROUTINE SHOULD BE RUN BY CHECKING       * 05700022
*            THE MI BIT IN THE SCT (WORD 9, BYTE 0, BIT 0),           * 05900022
*            IF MASK=MI IS SPECIFIED.                                 * 06100022
*                                                                     * 06300022
*         C. DETERMINE IF THE ROUTINE SHOULD BE RUN BY CHECKING       * 06500022
*            THE DCL BIT IN THE SCT (WORD 9, BYTE 0, BIT 2), IF       * 06700022
*            DCL IS SPECIFIED. IF THE DCL BIT IS ON AND THE           * 06900022
*            CONTROL TERMINAL OR ALTERNATE PRINTER IS ON THE          * 07100022
*            SAME COMMUNICATION LINE AS THE TEST TERMINAL, THE        * 07300022
*            ROUTINE WILL BE BYPASSED.                                * 07500022
*                                                                     * 07700022
*         D. RESET THE ERROR BIT (SCT WORD 0, BIT 24) AND             * 07900022
*            UPDATE THE ACTIVE ROUTINE NUMBER IN THE SECTION          * 08100022
*            PREFACE IF THE ROUTINE IS TO BE RUN.                     * 08300022
*                                                                     * 08500022
*         E. MOVE THE REFERENCE NUMBER INTO THE SECTION PREFACE       * 08700022
*            (IF THE REFNUM IS SPECIFIED).                            * 08900022
*                                                              @Y17XAUU 08960000
* PURPOSE -- SEE FUNCTION                                      @Y17XAUU 09020000
*                                                                     * 09100022
* ENTRY POINT --                                                      * 09300022
*    IEDQW47                                                          * 09500022
*                                                                     * 09700022
* INPUT --                                                            * 09900022
*    REGISTERS 1,2,13,14,15 CONTAIN THE FOLLOWING VALUES:             * 10100022
*                                                                     * 10300022
*         1 - ROUTINE PARAMETER LIST ADDRESS                          * 10500022
*         2 - SCT ADDRESS                                             * 10700022
*        13 - SAVE AREA ADDRESS                                       * 10900022
*        14 - RETURN ADDRESS                                          * 11100022
*        15 - ENTRY POINT ADDRESS FOR THIS MODULE                     * 11300022
*                                                                     * 11500022
* OUTPUT --                                                           * 11700022
*    NO OUTPUT VALUES ARE RETURNED                                    * 11900022
*                                                              @Y17XAUU 11910000
* MODULE TYPE -- PROCEDURE                                     @Y17XAUU 11920000
*                                                              @Y17XAUU 11930000
* PROCESSOR -- ASSEMBLER XF                                    @Y17XAUU 11940000
*                                                              @Y17XAUU 11950000
* MODULE SIZE -- 2K MAXIMUM                                    @Y17XAUU 11960000
*                                                              @Y17XAUU 11970000
* LINKAGE -- BALR 14,15 FROM IEDQWA                            @Y17XAUU 11980000
*                                                              @Y17XAUU 11990000
* MACROS -- AQCTL, IEDHJN, SAVE, WAIT                          @Y17XAUU 12000000
*                                                                     * 12100022
* EXTERNAL ROUTINES --                                                * 12300022
*    IEDQWO - ACCESS MANAGER TO PRINT MESSAGE                  * S22024 12500000
*                                                                     * 12700022
* EXITS,NORMAL --                                                     * 12900022
*    XCTL TO IEDQWM2 IF TRACE FUNCTION ACTIVE                         * 13100022
*    RETURN R14                                                       * 13300022
*                                                                     * 13500022
* EXITS,ERROR --                                                      * 13700022
*    XCTL TO IEDQWM2 IF UNSUPPORTED MACRO FUNCTION OR MACRO LEVEL     * 13900022
*                                                                     * 14100022
* TABLES/WORK AREAS --                                                * 14300022
*    SCT                                                              * 14500022
*                                                                     * 14700022
* ATTRIBUTES --                                                       * 14900022
*    ENABLED, PROBLEM PROGRAM MODE, RESIDENT, REENTRANT        @Y17XAUU 15100000
*                                                                     * 15300022
* NOTES -- SEE BELOW                                           @Y17XAUU 15500000
*                                                                     * 15900022
*  DEPENDENCIES -- EBCDIC CHARACTER CODE                       @Y17XAUU 15920000
*                                                              @Y17XAUU 15940000
*  REGISTERS CONVENTION -- SEE REGISTER ASSIGNMENT             @Y17XAUU 15960000
*                                                              @Y17XAUU 15980000
*  RESTRICTIONS -- NONE                                        @Y17XAUU 16000000
*                                                              @Y17XAUU 16020000
*  PATCH LABEL -- PATCH                                        @Y17XAUU 16040000
*                                                              @Y17XAUU 16060000
*********************************************************************** 16100022
         SPACE 4                                                        20400022
         EJECT                                                          20700022
*********************************************************************** 20900022
*                                                                     * 21100022
*        EQUATES                                                      * 21300022
*                                                                     * 21500022
*********************************************************************** 21700022
         SPACE 2                                                        21900022
R0       EQU   0                  WORK REGISTER                         22100022
R1       EQU   1                  PARAMETER LIST ADDRESS                22300022
R2       EQU   2                  SCT ADDRESS                           22500022
R3       EQU   3                  ADDRESS OF SECTION PREFACE PART 1     22700022
R4       EQU   4                  BASE REGISTER                         22900022
R5       EQU   5                  REGISTER 5                            23100022
R6       EQU   6                  REGISTER 6                            23300022
R7       EQU   7                  REGISTER 7                            23500022
R8       EQU   8                  REGISTER 8                            23700022
R9       EQU   9                  ADDRESS OF SECTION PREFACE PART 2     23900022
R10      EQU   10                 REGISTER 10                           24100022
R11      EQU   11                 PARAMETER LIST BASE ADDRESS           24300022
R12      EQU   12                 REGISTER 12                           24500022
R13      EQU   13                 SAVE AREA ADDRESS                     24700022
R14      EQU   14                 RETURN ADDRESS                        24900022
R15      EQU   15                 ENTRY POINT ADDRESS                   25100022
         SPACE 2                                                        25300022
ZERO     EQU   0                  CONSTANT DISPLACEMENT                 25500022
ONE      EQU   1                  CONSTANT DISPLACEMENT                 25700022
TWO      EQU   2                  CONSTANT DISPLACEMENT                 25900022
THREE    EQU   3                  CONSTANT DISPLACEMENT                 26100022
FOUR     EQU   4                  CONSTANT DISPLACEMENT                 26300022
EIGHT    EQU   8                  CONSTANT DISPLACEMENT                 26500022
NINE     EQU   9                  CONSTANT DISPLACEMENT                 26700022
TEN      EQU   10                 CONSTANT DISPLACEMENT                 26900022
TWELVE   EQU   12                 CONSTANT DISPLACEMENT                 27100022
SIXTN    EQU   16                 CONSTANT DISPLACEMENT                 27300022
D0       EQU   0                  CONSTANT DISPLACEMENT         SA41599 27400022
D20      EQU   20                 CONSTANT DISPLACEMENT                 27500022
D83      EQU   83                 CONSTANT DISPLACEMENT                 27700022
TERM     EQU   X'40'              BLANK CHARACTER                       27900022
MINUS    EQU   X'FF'              USED TO TURN OFF FLAG BITS            28100022
RTNEND   EQU   X'40'              LAST ROUTINE SPECIFIED                30600022
RTNMI    EQU   X'80'              MI ROUTINE SPECIFIED                  30900022
D24      EQU   24                 DISP. OF 24                           31000022
RUNRTN   EQU   X'80'              RUN ROUTINE FLAG                      31100022
D1       EQU   1                  DISP OF 1                      S22024 31120000
D4       EQU   4                  DISP OF 4                      S22024 31140000
RQINIT   EQU   X'0C'              START OF LIST                  S22024 31160000
RQEND    EQU   X'80'              END OF LIST                    S22024 31180000
DISREG2  EQU   28                 DISPLACEMENT TO REG 2        @Y17XAUU 31190000
         SPACE 2                                                        31200022
         SAVE  (14,12)                                                  31500022
         SPACE 2                                                        31800022
*                                                                       32100022
         USING PLIST,R11          PARAMETER LIST BASE IS 11             32400022
         USING TOTOLTCB,R2        OLTCB BASE                            32700022
         USING SPREF1,R3          SECTION PREFACE DSECT PART 1          33000022
         USING SPREF2,R9          SECTION PREFACE DSECT PART 2          33300022
*                                                                       33600022
*                                                                       33900022
         DROP  R15                                                      34200022
         USING IEDQW47,R4         BASE REG IS 4                         34500022
         LR    R4,R15             SET UP BASE                           34800022
         LA    R15,TOTSAVE1       GET ADDRESS OF OWN SAVE AREA          35100022
         ST    R15,EIGHT(R13)     PUT IN CALLER'S SAVE AREA             35400022
         ST    R13,FOUR(R15)      SAVE ADDRESS OF CALLER'S SAVE         35700022
         LR    R13,R15            SET REG 13 TO MY SAVE AREA            36000022
         SPACE 2                                                        36300022
         LR    R11,R1             GET PLIST ADDR                        36600022
         L     R3,TOTOLTEN        SECTION PREFACE BASE          SA41596 36700022
*                                                                       36900022
         CLI   RTNML,TWO          CORRECT MACRO LEVEL ?                 37200022
         BE    RTN004             YES                                   37500022
*                                                                       37800022
         LA    R15,FOUR           SET INCORRECT MACRO LEVEL RET CODE    38100022
         SPACE 2                                                        38400022
         STC   R15,TOTRTCOD       SAVE RETURN CODE                      38700022
         L     R13,FOUR(R13)      RESTORE CALLER'S SAVE AREA PTR        39000022
         L     R14,TWELVE(R13)    RESTORE CALLER'S RETURN ADDR          39300022
         USING RESPL,R5           SET RESPL ADDRESSABILITY     @Y17XAUU 39340000
         L     R5,TOTRESPL        GET RESPL ADDRESS            @Y17XAUU 39380000
         L     R15,RESPLM2        GET TRACE ROUTINE ADDRESS    @Y17XAUU 39420000
         LM    R2,R12,DISREG2(R13) RESTORE CALLER'S REGISTERS  @Y17XAUU 39460000
         BR    R15                GO TO IEDQWM2                @Y17XAUU 39500000
         DROP  R5                                              @Y17XAUU 39540000
         SPACE 2                                                        39900022
*                                                                       40200022
RTN004   EQU   *                                                        40500022
         XC    RTNFLAG,RTNFLAG    CLEAR CONTROL FLAGS          @Y17XAUU 40500300
         MVC   RTNMSG(QTNMSGAE-QTNMSG),QTNMSG  WORK AREA       @Y17XAUU 40500600
         TM    RTNFLG,RTNDCL      DCL FLAG SET                   S22024 40501000
         BZ    RTN0040            NO                             S22024 40502000
         TM    $TOTFLG1,$CTEQTT   CT AND TT ON SAME SUB-CHAN     S22024 40503000
         BO    RTN0070            YES - BYPASS ROUTINE           S22024 40504000
RTN0040  EQU   *                                                 S22024 40505000
         SR    R9,R9              CLEAR REG                             40508022
         LH    R9,RTNDISP         GET DISPLACEMENT TO RTN NUMBER        40516022
         AR    R9,R3              SET BASE FOR SECT PREF PART 2         40524022
*                                                                       40532022
         MVC   RTN#(ONE),RTNNUM   MOVE RTN NUMBER TO SECT PREF          40540022
         MVI   $RETMASK,ZERO      CLEAR RETURN CODE MASK                40548022
         NI    $ERROPT,MINUS-$TESTERR CLEAR TEST ERROR FLAG             40556022
         NI    $ERROPT,MINUS-$CATERR CLEAR CAT. ERROR FLAG              40564022
*                                                                       40572022
         MVC   REFNUM(ONE),REFNUMB MOVE REFNUM TO SECT PREF             40580022
*                                                                       40588022
         MVI   TOTRTCOD,ZERO      SET RETURN CODE                       40600022
         TM    TOTFLG06,TOTNCMFG  NON-CONCURRENT MODE ASKED?            40800022
         BO    RTN005             YES BYPASS START LINE                 41100022
         USING IOBLOCKS,R7                                              42000022
         L     R7,TOTSAVE5        GET ADDRESS OF CURRENT        SA41599 42060022
*                                   PRIMARY TEST DEVICE         SA41599 42120022
         TM    D0(R7),TOTTDLST    WAS LINE INITIALLY STOPPED?   SA41599 42180022
         BO    RTN005             YES, DO NOT START LINE        SA41599 42240022
         TM    D0(R7),TOTTDORN    TEST DEVICE ON 3705            S22024 42260000
         BO    RTN005             YES - BYPASS STARTLINE         S22024 42280000
         LA    R7,TOTPRIBK        SET UP TO START PRIMARY LINE          42300022
         BAL   R8,STRTLINE        START PRIMARY LINE                    42600022
*                                                                       42900022
RTN004A  EQU   *                                                        43200022
         L     R7,TOTGRABP        GET ADDRESS OF CURRENT        SA41599 43260022
*                                   SECONDARY TEST DEVICE       SA41599 43320022
         TM    D0(R7),TOTTDLST    WAS LINE INITIALLY STOPPED?   SA41599 43380022
         BO    RTN005             YES, DO NOT START LINE        SA41599 43440022
         LA    R7,TOTSCIBK        SET UP TO START SECONDARY LINE        43500022
         BAL   R8,STRTLINE        START SECONDARY LINE                  43800022
*                                                                       44100022
RTN005   EQU   *                                                        44400022
*                                                                       45600022
         BAL   R5,RTNCHK          DETERMINE IF ROUTINE SHOULD BE RUN    45720022
         TM    RTNFLAG,RUNRTN     RUN ROUTINE ?                         45760022
         BZ    RTN007             NO - BYPASS ROUTINE                   45800022
RTN006   EQU   *                                                        45840022
*                                                                       45900022
*                                                                       47100022
*                                                                       47400022
         TM    RTNFLG,RTNMI       MI ROUTINE ?                          47700022
         BZ    RTN008             NO - BYPASS CHECK                     48000022
         TM    $OLTFLGS,$MANINTV  MI OPTION IN TRM ?                    48300022
         BO    RTN008             YES - RUN ROUTINE                     48600022
*                                                                       48900022
         MVI   TOTOTBUF,TERM      BLANK OUT THE                         49200022
         MVC   TOTOTBUF+ONE(D83),TOTOTBUF  OUTPUT BUFFER                49500022
         MVC   RTNSID(EIGHT),TOTCROLT  MOVE SECTION ID TO MSG           49800022
         MVC   TOTOTBUF(RTNMSGE-RTNMSG),RTNMSG NOTIFY CT TERM           50100022
         LA    R5,RTNMSGE-RTNMSG  GET MSG LENGTH                        50200022
         STC   R5,TOTOTCNT        PUT IT IN OLTCB                       50300022
RTN0060  EQU   *                                                 S22024 50350000
         NI    TOTFLG05,X'FF'-TOTREPLY CLEAR REPLY FLAG                 50400022
         NI    TOTFLG05,X'FF'-TOTPRINT CLEAR PRINT FLAG                 50700022
         OI    TOTFLG05,TOTCECOM  SET CECOM FLAG                        51000022
         SPACE                                                          51300022
         USING RESPL,R5           SET RESPL ADDRESSABILITY     @Y17XAUU 51350000
         L     R5,TOTRESPL        GET RESPL ADDRESS            @Y17XAUU 51400000
         L     R15,RESPLWO        GET ACCESS MANAGER ADDRESS   @Y17XAUU 51450000
         BALR  R14,R15            REPORT THAT ROUTINE BYPASSED @Y17XAUU 51500000
         DROP  R5                                              @Y17XAUU 51550000
         SPACE                                                          51700022
RTN007   EQU   *                                                        51800022
         SPACE                                                          51900022
         L     R13,FOUR(R13)      RESTORE CALLER'S ADDR                 52200022
         B     RTN060             EXIT                                  52500022
         SPACE                                                          52530000
RTN0070  EQU   *                                                 S22024 52560000
         MVI   TOTOTBUF,TERM      BLANK OUT THE                  S22024 52590000
         MVC   TOTOTBUF+ONE(D83),TOTOTBUF OUTPUT BUFFER          S22024 52620000
         MVC   RTNSIDA(EIGHT),TOTCROLT SECTION ID TO MSG         S22024 52650000
         MVC   TOTOTBUF(RTNMSGAE-RTNMSGA),RTNMSGA MSG            S22024 52680000
         LA    R5,RTNMSGAE-RTNMSGA MSG LENGTH                    S22024 52710000
         STC   R5,TOTOTCNT        PUT IT IN OLTCB                S22024 52740000
         B     RTN0060            CONTINUE                       S22024 52770000
*                                                                       52800022
RTN008   EQU   *                                                        53100022
*                                                                       53400022
*                                                                       53700022
*                                                                       54900022
         L     R13,FOUR(R13)      GET SAVE AREA ADDRESS                 55800022
         L     R14,TWELVE(R13)    RESTORE RETURN ADDR                   56100022
         TM    RTNFLG,RTNEND      LAST ROUTINE ?                        56400022
         BO    RTN062             YES - GET RTNTERM ADDR                56700022
         TM    $OLTFLGS,$TRACE    TRACE FTN REQUESTED ?                 57300022
         BO    RTN080             YES                                   57600022
         LM    R14,R12,TWELVE(R13)  RESTORE CALLER'S REG                57700022
         BR    R14                RETURN TO EXECUTIVE                   57900022
*                                                                       58200022
*                                                                       58500022
*                                                                       58800022
RTN060   EQU   *                                                        59100022
         L     R14,TWELVE(R13)    RESTORE RETURN ADDR                   59400022
         L     R5,NXTRTNA         GET RETURN ADDR                       59700022
         ST    R5,TOTSMGRT        SAVE IT                               60000022
RTN062   EQU   *                                                        60300022
         TM    $OLTFLGS,$TRACE    TRACE FTN REQUESTED ?                 60600022
         BO    RTN080             YES                                   60900022
         LM    R14,R12,TWELVE(R13) RESTORE CALLER'S REGISTERS           61200022
         BR    R14                RETURN TO NEXT RTN OR RTNTERM         61500022
         SPACE 4                                                        61800022
RTN080   EQU   *                                                        62100022
         LM    R0,R1,D20(R13)     RESTORE REG 0-1                       62200022
         USING RESPL,R5           SET RESPL ADDRESSABILITY     Y17XAUU  62220000
         L     R5,TOTRESPL        GET RESPL ADDRESS            @Y17XAUU 62240000
         L     R15,RESPLM2        GET TRACE ROUTINE ADDRESS    @Y17XAUU 62260000
         LM    R2,R12,DISREG2(R13) RESTORE CALLER'S REGISTERS  @Y17XAUU 62280000
         BR    R15                GO TO IEDQWM2                @Y17XAUU 62300000
         DROP  R5                                              @Y17XAUU 62320000
         EJECT                                                          62700022
*********************************************************************** 63000022
*                                                                     * 63200022
*        START LINE VIA TCAM'S OP-CONTROL FACILITY                    * 63400022
*                                                                     * 63600022
*********************************************************************** 63800022
         SPACE 1                                                        64000022
STRTLINE EQU   *                                                        64200022
         STM   R6,R12,STRTSAVE    SAVE REGS DURING STARTLINE            64400022
         MVI   TOTOVBCD,LINESTRT  MOVE IN STARTLINE VERB CODE  @Y17XAUU 64600000
*                                                                       64800022
         L     R6,TOTAVTPT        GET ADDRESS OF AVT                    65000022
         USING IEDQAVTD,R6                                              65200022
         LA    R10,AVTOPCOB       GET POINTER TO OP CONTROL QCB         65400022
         ST    R10,TOTOKEY        PUT IN PARAMETER LIST        @Y17XAUU 65600000
         DROP R6                                                        65800022
         MVC   TOTORLN,OLTTCRLN   MOVE IN RELATIVE LINE NUMBER @Y17XAUU 66000000
         SR    R6,R6              CLEAR                        @G36XRUV 66100010
         ICM   R6,3,OLTUCBA       GET UCB ADDRESS              @G36XRUV 66200010
         LTR   R6,R6              IS THERE A VALID UCB ADDRESS?         66400022
         BZ    STRT5              NO - DONT ISSUE STARTLINE             66600022
         USING UCB,R6                                                   66800022
         MVC   TOTOLADR(THREE),UCBNAME GET UNIT NAME           @Y17XAUU 67000000
         DROP  R6                                                       67200022
         LA    R1,TOTOTECB        GET TOTE ECB                          67400022
         ST    R1,TOTOECBA        PUT IN PARAMETER LIST        @Y17XAUU 67600000
         XC    TOTOLINK(THREE),TOTOLINK CLEAR LINK FIELD       @Y17XAUU 67900000
         XC    TOTOTECB(FOUR),TOTOTECB  CLEAR TOTE ECB                  68200022
         LA    R1,TOTPLIST        ADDR OF ELEMENT                S22024 68240000
         ST    R1,TRMSLPL         PUT IN PLIST                   S22024 68260000
         ST    R1,TRMSLPL+D4      PUT IN PLIST                   S22024 68280000
         MVI   TRMSLPL,RQINIT     SET INITIAL ELEMENT FLAG       S22024 68300000
         MVI   TRMSLPL+D4,RQEND   SET LAST ELEMENT FLAG          S22024 68320000
         LA    R1,TRMSLPL         ADDR OF PLIST                  S22024 68340000
         L     R6,TOTAVTPT        GET ADDRESS OF AVT            SA64770 68350054
         USING IEDQAVTD,R6        SET ADDRESSIBILITY FOR AVT    SA64770 68360054
         TM    AVTBIT1,AVTCLOSN   TCAM CLOSEDOWN IN PROGRESS?   SA64770 68370054
         BO    RTN062             YES - RETURN                  SA64770 68380054
         AQCTL                    POST ELEMENT TO OPERATOR CONTROL      68400022
*                                                                       68600022
         WAIT  ECB=TOTOTECB       WAIT FOR START LINE TO COMPLETE       68800022
*                                                                       69000022
STRT5    EQU   *                                                        69200022
         LM    R6,R12,STRTSAVE    RESTORE REGS FROM STARTLINE           69400022
         BR    R8                 RETURN TO CALLER                      69600022
*                                                                       69800022
         DROP  R7                                                       70000022
         EJECT                                                          73206022
*                                                                       73212022
RTNCHK   EQU   *   DETERMINE IF ROUTINE SHOULD BE RUN                   73218022
*                                                                       73224022
         SR    R6,R6              CLEAR REG 6                           73230022
         IC    R6,RTNNUM          GET ROUTINE NUMBER                    73236022
         CL    R6,K16             ROUTINE NUMBER GREATER THAN 16 ?      73242022
         BH    RTNCHK6            YES - CHECK 2ND MASK LIST             73248022
*                                                                       73254022
*        ROUTINE NUMBER IS BETWEEN 1 AND 16                             73260022
*                                                                       73266022
         LA    R8,TESET           POINT TO MASK COMPARE TABLE           73272022
         LA    R7,$RT0108         POINT TO START OF 1ST MASK FIELD      73278022
         CL    R6,K8              ROUTINE NUMBER GREATER THAN 8 ?       73284022
         BNH   RTNCHK2            NO                                    73290022
         LA    R7,$RT0916         POINT TO NEXT MASK BYTE               73296022
         S     R6,K8              ADJUST INDEX INTO COMPARE TABLE       73302022
RTNCHK2  EQU   *                                                        73308022
         BCTR  R6,R0              ADJUST TO CORRECT MASK FIELD          73314022
RTNCHK4  EQU   *   TEST BIT SETTING                                     73320022
         AR    R6,R8              POINT TO RTN MASK COMPARAND           73326022
         SR    R10,R10            CLEAR REG 10                          73332022
         IC    R10,ZERO(R6)       GET MASK BYTE FOR TEST                73338022
         EX    R10,RTNBIT         ROUTINE TO BE RUN ?                   73344022
         BZ    RTNCHKE            NO - EXIT                             73350022
         OI    RTNFLAG,RUNRTN     YES - SHOW THAT RTN IS TO BE RUN      73356022
         B     RTNCHKE            GO TO RETURN                          73362022
*                                                                       73368022
RTNCHK6  EQU   *   ROUTINE NUMBER IS BETWEEN 17-256                     73374022
*                                                                       73380022
         LA    R8,TESET           POINT TO MASK TABLE                   73386022
         LA    R7,$R017024        POINT TO START OF 2ND MASK FIELD      73392022
         LA    R10,D24            INIT. COMPARAND                       73398022
RTNCHK8  EQU   *                                                        73404022
         CR    R6,R10             CORRECT MASK BYTE ?                   73410022
         BH    RTNCHKA            NO - SET UP FOR ANOTHER CHECK         73416022
         A     R6,K8              ADJUST ROUTINE NUMBER                 73422022
         SR    R6,R10             ADJUST INDEX INTO MASK TABLE          73428022
         BCTR  R6,R0              ADJUST AGAIN                          73434022
         B     RTNCHK4            GO TEST BIT SETTING                   73440022
RTNCHKA  EQU   *                                                        73446022
         LA    R10,EIGHT(R10)     INCREMENT COMPARAND                   73452022
         LA    R7,ONE(R7)         POINT TO NEXT RTN MASK BYTE           73458022
         B     RTNCHK8            GO CHECK AGAIN                        73464022
RTNCHKE  EQU   *                                                        73470022
         BR    R5                 RETURN TO CALLER                      73476022
         SPACE 2                                                        73500022
         EJECT                                                   S99528 73800022
*                                   IN EBCDIC                           77500022
LINESTRT EQU   X'40'              VERB CODE FOR START LINE              77700022
LINESTOP EQU   X'41'              VERB CODE FOR STOP LINE               77900022
TERMSTRT EQU   X'45'              VERB CODE FOR START TERMINAL          78100022
TERMSTOP EQU   X'47'              VERB CODE FOR STOP TERMINAL           78300022
********************START OF COPY DATA************************ @Y17XAUU 78400000
*                                                                       78700022
         SPACE 2                                                        78900022
QTNMSG   EQU   *                  ROUTINE MESSAGE              @Y17XAUU 79100000
         DC    C'IED346I '        MSG ID                         S22024 79200000
QTNSID   DS    CL8                SECTION ID                   @Y17XAUU 79300000
         DC    C' - '             CHARACTER 'DASH'                      79500022
         DC    C'MI ROUTINE BYPASSED - MI NOT SPECIFIED IN TRM'  MSG    79700022
*                                 GENERATED WHEN MI NOT INDICATED       79900022
QTNMSGE  EQU   *                  END OF MESSAGE               @Y17XAUU 80100000
         SPACE                                                          80400000
QTNMSGA  EQU   *                  ROUTINE MESSAGE              @Y17XAUU 80700000
         DC    C'IED239I '        MSG ID                         S22024 81000000
QTNSIDA  DS    CL8                SECTION ID                   @Y17XAUU 81300000
         DC    C' - '             CHAR DASH                      S22024 81600000
         DC    C'ROUTINE BYPASSED - CONTROL AND TEST TERMINALS ON SAME *81900000
               LINE'                                             S22024 82200000
QTNMSGAE EQU   *                                               @Y17XAUU 82500000
**********************END OF COPY DATA************************@Y17XAUU  82800000
         EJECT                                                   S99528 83100022
*                                                                       85800022
K8       DC    F'8'               VALUE OF 8                            87050022
K16      DC    F'16'              VALUE OF 16                           87100022
TESET    DC    X'8040201008040201' RTN MASK CHECK TABLE                 87200022
RTNBIT   TM    ZERO(R7),ZERO      SHOLD ROUTINE BE RUN ?                87250022
PATCH    DC    15F'0'             PATCH AREA                   @Y17XAUU 87270000
         SPACE 4                                                        87300022
PLIST    DSECT                                                          87600022
CTLFLG   DS    CL1                CONTROL PROGRAM FLAGS                 87900022
RTNML    DS    CL1                MACRO LEVEL                           88200022
RTNMID   DS    CL2                MACRO ID                              88500022
NXTRTNA  DS    F                  ADDRESS OF NEXT ROUTINE               88800022
RTNNUM   DS    CL1                RTN NUMBER                            89100022
REFNUMB  DS    CL1                REFNUM                                89400022
RTNFLG   DS    CL1                ROUTINE FLAGS                         89700022
RTNDCL   EQU   X'20'              DCL FLAG                     @XM05675 89750010
         SPACE 2                                                        90000022
SPREF1   DSECT                    SECTION PREFACE PART 1                90300022
SECTID   DS    CL8                OLT SECTION ID                        90600022
LEVEL    DS    CL2                OLT LEVEL                             90900022
RTNDISP  DS    AL2                DISP TO ROUTINE #                     91200022
         SPACE 3                                                        91500022
SPREF2   DSECT                    SECTION PREFACE PART 2                91800022
RTN#     DS    CL1                ROUTINE NUMBER                        92100022
         DS    CL8                FLAGS                                 92400022
RM       DS    CL2                ROUTINE MASK FLAGS                    92700022
         DS    CL6                PLINK MANAGEMENT                      93000022
REFNUM   DS    CL1                REFERENCE NUMBER                      93300022
         EJECT                                                          93600022
         EJECT                                                   S99528 93900022
         TAVTD                                                   S99528 94200022
         EJECT                                                   S99528 94500022
         IOBLOCKS                                                S99528 94800022
         EJECT                                                   S99528 95100022
UCB      DSECT                                                   S99528 95400022
         IEFUCBOB                                                S99528 95700022
         EJECT                                                   S99528 96000022
RESPL    RESPL                                                 @Y17XAUU 96100000
         EJECT                                                          96200000
         OLTCB                                                          96300022
TRMSLPL  DS    0F                 OP CONTROL PLIST             @Y17XAUU 96310000
         DC    X'0C'              FLAG START                   @Y17XAUU 96320000
         DC    AL3(0)             POINTER TO FIRST ELEMENT     @Y17XAUU 96330000
         DC    X'08'              FLAG LAST                    @Y17XAUU 96340000
         DC    AL3(0)             POINTER TO LAST ELEMENT      @Y17XAUU 96350000
STRTSAVE DS    7F                 SAVE AREA                    @Y17XAUU 96360000
RTNMSG   DS    0C                 ROUTINE MSG                  @Y17XAUU 96370000
         DC    C'IED346I '        MSG ID                       @Y17XAUU 96380000
RTNSID   DS    CL8                SECTION ID                   @Y17XAUU 96390000
         DC    C' - '             CHARACTER 'DASH'             @Y17XAUU 96400000
         DC    C'MI ROUTINE BYPASSED - MI NOT SPECIFIED IN TRM'         96410000
*        MSG GENERATED WHEN MI NOT SPECIFIED                   @Y17XAUU 96420000
RTNMSGE  DS    0C                 END OF MESSAGE               @Y17XAUU 96430000
RTNMSGA  DS    0C                 ROUTINE MESSAGE              @Y17XAUU 96440000
         DC    C'IED239I '        MSG ID                       @Y17XAUU 96450000
RTNSIDA  DS    CL8                SECTION ID                   @Y17XAUU 96460000
         DC    C' - '             CHAR DASH                    @Y17XAUU 96470000
         DC    C'ROUTINE BYPASSED - CONTROL AND TEST TERMINALS ON SAME *96480000
               LINE'                                           @Y17XAUU 96490000
RTNMSGAE DS    0C                 END OF MESSAGE               @Y17XAUU 96500000
RTNFLAG  DS    XL1                ROUTINE CONTROL FLAG         @Y17XAUU 96510000
         END                                                            96600022
