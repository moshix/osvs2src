         TITLE 'IEDQWA - TOTE RESIDENT MODULE'                          00100022
IEDQWA   CSECT                                                          00200022
*CHANGE ACTIVITY AS FOLLOWS:                                            00230022
*A000000-999999                                                @M02XRUV 00240000
*A612240-612360,619840-619960                                   SA41599 00260022
*D489000-489300                                                 SA41603 00270022
*A496300-496400                                                 SA41603 00280022
*A604500,624900                                                 SA41612 00283022
*C604400,624800                                                 SA41612 00286022
*A474650-474850                                                 SA41613 00289022
*C466800,475200                                                 SA41613 00292022
*D467100,475500,768500-768800                                   SA41613 00295022
*A026600-026800,033030-033450,033700,036560-036920,051700        S22024 00295300
*A054700,063570-063920,078700,093200,137000-145400,170300-170600 S22024 00295600
*A268600-268800,269200-269800,271000,453960-454140,466600-466700 S22024 00295900
*A477300-477552,481000,491120-491300,494100,591000-591990        S22024 00296200
*A593000-593760,612370-612380,619970-619980,615640-615760        S22024 00296500
*A617060-617120,658000,764000,776700,776730-776850,847000        S22024 00296800
*A858000-868000                                                  S22024 00297100
*C007000,009000,026500,041500-042400,046500,051500,069000,076000 S22024 00297400
*C082500,093000,094500-095500,268000,269000,270000,611000,614800 S22024 00297700
*C615600,616000,617000,617600-618150,776300-776600,790400        S22024 00298000
*D189000-191000,588000,621000,782300-790700,749000-757400        S22024 00298300
*D760700-763700,764300-766340,770600,772700-773000               S22024 00298600
*A139730-139760,142130-142160,145700-145800,466720-466780        S05331 00298800
*A476340-476361,476680-477100,587805-587875,588460-588480        S05331 00299000
*A592450-592500,607610-607700,776866-776890,816020-816780        S05331 00299200
*C196000-203000,592200,592360                                    S05331 00299400
*A139000,145820-145960,476131-476138,477100-477848,776891-776898 Y06330 00299605
*C908000                                                         Y06330 00299805
*A139200,593483-593495                                           Y06330 00299905
*A476124-476126                                                 SA64777 00300005
*A466780,476361,477090                                         @YA07679 00305058
*A508200,508500                                                 SA64792 00310005
*D621600-624350,834140-834910                                  @YA06302 00310156
*A462330                                                       @ZA00208 00310256
*D510900,511800-514800                                         @ZA00208 00310356
*C515700                                                       @ZA00208 00310456
*C177000-186000                                                 SA64772 00320054
*A145840-145880,498000,498660-498840,500160-500340              SA64785 00320153
*A145920-145960,495920-496100                                   SA64790 00320253
*A366300,145960                                                @YA08757 00320358
*C618150                                                       @YA11128 00320458
*A611600,620800,769100                                         @YA11128 00320558
*D003500-033450,053000-059000,070000-078700,                   @Y17XAUV 00321200
*D083000-096000,139730-140100,140400-143100,                   @Y17XAUV 00321900
*D145700-187000,235000-559000,587400-592520,                   @Y17XAUV 00322100
*D603800-604200                                                @Y17XAUV 00322300
*D621200-625200,757700-776000,776700-776898                    @Y17XAUV 00322600
*C038000,071500,079500,081500-082000,082000-082500,            @Y17XAUV 00323300
*C123000,126000,139400,200000,220000                           @Y17XAUV 00324000
*C595000,604000,611700                                         @Y17XAUV 00324300
*A003205,052500,067500,068000,077000,082000,                   @Y17XAUV 00324700
*A082500,123000,126000,139700,220000,234000,593740             @Y17XAUV 00325100
*A603600,621000,776600,777200                                  @Y17XAUV 00325500
*C146480                                                       @YM07361 00325800
* A002300,003258,003471,450560,776900                          @XM05672 00325900
* C054940,068080-068120                                        @XM05672 00326000
* D777230-777440                                               @XM05672 00326100
* A616000                                                      @G36XRUV 00326200
* C616200,681000                                               @G36XRUV 00326300
* D680000,682000                                               @G36XRUV 00326400
*                                                                       00326500
         EJECT                                                 @Y17XAUV 00326600
*********************************************************************** 00326800
*                                                              @Y17XAUV 00327500
* MODULE NAME = IEDQWA (TCAM,TELECOMMUNICATION ON-LINE TEST EXECUTOR) * 00328200
*                                                              @Y17XAUV 00328900
* DESCRIPTIVE NAME = TOTE RESIDENT MODULE                      @Y17XAUV 00329600
*                                                              @Y17XAUV 00330300
* COPYRIGHT = NONE                                             @Y17XAUV 00331000
*                                                              @Y17XAUV 00331700
* STATUS = VERSION 10.0                                        @Y17XAUV 00332400
*                                                              @Y17XAUV 00333100
* FUNCTION = IEDQWA PERFORMS THE BASIC RESIDENT FUNCTION       @Y17XAUV 00333800
* OF TOTE. IN ADDITION, IT CONTAINS ASYCHRONOUS TASK EXITS     @Y17XAUV 00334500
* AND SUBROUTINES USED BY THE OTHER TOTE MODULES AND           @Y17XAUV 00335200
* THE OLT MODULES.  EACH OF THESE ACTIVITES IS REPRESENTED     @Y17XAUV 00335900
* AS A SEPARATE ENTRY POINT.                                   @Y17XAUV 00336600
*                                                              @Y17XAUV 00338700
*    ENTRY POINT IEDQWA:                                       @Y17XAUV 00339400
*                                                              @Y17XAUV 00340100
*    THE MODULE IS ENTERED AT IEDQWA FROM THE OPERATING        @Y17XAUV 00340800
*    SYSTEM AS A RESULT OF THE ATTACH MACRO ISSUED BY          @Y17XAUV 00341500
*    THE MCP TASK AT INTRO TIME.  THIS ROUTINE PERFORMS        @Y17XAUV 00342200
*    THE BASIC RESIDENT FUNCTION FOR TOTE.  ON ENTRY IT        @Y17XAUV 00342900
*    PERFORMS CERTAIN INITIALIZATION PROCEDURES.  IT THEN      @Y17XAUV 00343000
*    WAITS ON AN ECB LIST.  ONE OF THESE ECB'S IS PART OF      @Y17XAUV 00343100
*    THE TOTE QCB IN THE TCAM AVT AND IS POSTED BY THE TCAM    @Y17XAUV 00343200
*    MCP TASK WHEN INPUT IS ENQUEUED ON THE TOTE QCB.  THE     @Y17XAUV 00343300
*    OTHER ECB IS IN THE TOTE RESIDENT PARAMETER LIST AND      @Y17XAUV 00343400
*    IS POSTED BY THE OLT SUBTASKS WHEN THEY REQUIRE SERVICE   @Y17XAUV 00343500
*    BY THE TOTE MAIN TASK.  WHEN TOTE IS POSTED, IT FIRST     @Y17XAUV 00343600
*    DETERMINES IF TCAM IS IN SHUTDOWN.  IF SO, ALL OLT        @Y17XAUV 00343700
*    SUBTASKS ARE DETACHED AND IEDQWA RETURNS TO TCAM.  IF     @Y17XAUV 00343800
*    SHUTDOWN IS NOT IN PROGRESS, THEN IEDQWA FULFILLS THE     @Y17XAUV 00343900
*    REQUESTS OF OLT SUBTASKS FOR RESOURCES BY LINKING         @Y17XAUV 00344000
*    TO IEDQWB, THE TOTE RESOURCE MANAGER, AND INITIATES       @Y17XAUV 00344100
*    THE PROCESSING OF INCOMING MESSAGES ENQUEUED ON THE       @Y17XAUV 00344200
*    TOTE QCB BY CALLING IEDQWA1, THE TOTE INPUT DATA          @Y17XAUV 00344300
*    HANDLER.  WHEN ALL WORK IS COMPLETE, IEDQWA RESUMES       @Y17XAUV 00344400
*    THE WAIT.  IF CATESTROPHIC ERRORS WERE DETECTED BY        @Y17XAUV 00344500
*    THE TWO OTHER TOTE MODULES, IEDQWA IS INFORMED BY         @Y17XAUV 00344600
*    RETURN CODE AND EXITS TO TCAM.                            @Y17XAUV 00344700
*                                                              @Y17XAUV 00344800
*    ENTRY POINT: ALLOCBUF                                     @Y17XAUV 00344900
*                                                              @Y17XAUV 00345000
*    THIS ROUTINE IS CALLED BY TOTE MODULES REQUIRING A        @Y17XAUV 00345100
*    TCAM BUFFER. IT TPOSTS AN ERB TO THE BUFFER REQUEST       @Y17XAUV 00345200
*    QCB FOR THE DESIRED NUMBER OF OF BUFFER UNITS.  THESE     @Y17XAUV 00345300
*    ARE RETURNED TO THE REQUESTING TOTE MODULE.               @Y17XAUV 00345400
*                                                              @Y17XAUV 00345500
*    ENTRY POINT: FREEBUF                                      @Y17XAUV 00345600
*                                                              @Y17XAUV 00345700
*    THIS ROUTINE IS CALLED BY TOTE MODULES DESIRING TO        @Y17XAUV 00345800
*    FREE A BUFFER. IT TPOSTS THE BUFFER UNITS BACK TO         @Y17XAUV 00345900
*    THE BUFFER RETURN QCB.                                    @Y17XAUV 00346000
*                                                              @Y17XAUV 00346100
*    ENTRY POINT: POSTWAIT                                     @Y17XAUV 00346200
*                                                              @Y17XAUV 00346300
*    THIS ROUTINE IS CALLED BY TOTE MODULES IN ORDER TO        @Y17XAUV 00346400
*    TPOST AN ELEMENT TO TCAM.  A WAIT MAY BE DONE FOR THE     @Y17XAUV 00346500
*    RETURN OF THE ELEMENT IF THE TOTE MODULE SO REQUESTS.     @Y17XAUV 00346600
*                                                              @Y17XAUV 00347100
*    ENTRY POINT: HIERSCAN                                     @XM05672 00847100
*                                                              @XM05672 01347100
*    THIS ROUTINE SCANS THE HIERARCHY UNDER A SDLC LINK AND    @XM05672 01847100
*    RESETS THE TRMSTOTE BIT.                                  @XM05672 02347100
*                                                              @XM05672 02847100
*    ENTRY POINT: OLTETXR                                             * 03350022
*                                                               S22024* 03370000
*    THIS ROUTINE IS THE END OF TASK EXIT ROUTINE INDICATED ON THE    * 03400022
*    ATTACH MACRO WHICH IS ENTERED WHEN THE OLT ENDS EITHER           * 03450022
*    NORMALLY OR ABNORMALLY. THE CORRECT OLT IS DETACHED BY           * 03500022
*    COMPARING THE TCB ADDRESS IN THE OLTCB TO THE TCB ADDRESS        * 03550022
*    INDICATED IN REGISTER 1.                                         * 03600022
*                                                                     * 03650022
*    ENTRY POINT: STAERT                                        S22024* 03656000
*                                                               S22024* 03662000
*    THIS ROUTINE IS THE STAE EXIT ROUTINE WHICH GETS CONTROL   S22024* 03668000
*    WHEN AN OLTT ABENDS.  IF THE OLTT HAS A CLEANUP ROUTINE    S22024* 03674000
*    SPECIFIED, THE ROOT MODULE IS ENTERED FOR CLEANUP.  OTHER- S22024* 03680000
*    WISE CONTROL IS RETURNED TO ABTERM.                        S22024* 03686000
*                                                               S22024* 03692000
*    ENTRY POINT: SMGR                                                * 03700022
*                                                                     * 03750022
*    THIS IS THE SERVICE MODULE MANAGER ROUTINE. IT IS         @Y17XAUV 03800000
*    ENTERED BY THE OLT WHEN HE REQUESTS A SERVICE OF THE EXECUTOR.   * 03850022
*    THE CANCEL PENDING BIT IS CHECKED FOR THE REQUESTING OLT. IF IT  * 03900022
*    IS ON AND THE OLT HAS A CLEANUP ROUTINE, THEN THE OLT IS         * 03950022
*    BRANCHED TO FOR CLEANUP. IF THE OLT DOES NOT HAVE A CLEANUP      * 04000022
*    ROUTINE, IEDQWF IS BRANCHED TO TO DELETE THE OLT. IF A CANCEL    * 04050022
*    REQUEST IS NOT PENDING FOR THE OLT, IEDQWA NOW DETERMINES IF     * 04100022
*    A START LINE COMMAND SHOULD BE ISSUED.  IF NON-CONCURRENT  S22024* 04150000
*    MODE IS REQUESTED, LINE SHARING IS NOT ACTIVE, THE LINE    S22024* 04180000
*    WAS INITIALLY STOPPED, OR THE TEST DEVICE IS ON A 3705,    S22024* 04210000
*    THEN THE START LINE IS BYPASSED. OTHERWISE THE START LINE  S22024* 04240000
*    COMMAND IS ISSUED. IEDQWA THEN GETS THE NAME OF THE SERVICE      * 04300022
*    MODULE REQUESTED AND PERFORMS A BLDL ON SYS1.LINKLIB TO VERIFY   * 04350022
*    THAT A VALID MODULE HAS BEEN REQUESTED. IF THE NAME IS NOT       * 04400022
*    FOUND, A RETURN CODE OF FOUR INDICATING AN UNSUPPORTED           * 04450022
*    FUNCTION IS SET AND THE OLT IS RETURNED TO. IF THE MODULE IS     * 04500022
*    VALID, IT IS LINKED TO TO PERFORM THE REQUESTED FUNCTION.        * 04550022
*    IF AN I/O OPERATION IS REQUESTED ON A TEST DEVICE, IEDQWN IS     * 04600022
*    CALLED. IF COMMUNICATION WITH THE ON-LINE TEST OPERATOR IS S22024* 04650000
*    REQUESTED IEDQWP OR IEDQWQ IS CALLED. IF AN OLT SUBMODULE IS     * 04700022
*    TO BE LOADED OR DELETED, IEDQWR IS CALLED. IF THE OLT WISHES     * 04750022
*    TO WAIT FOR THE COMPLETION OF AN I/O OPERATION, IEDQWS IS CALLED.* 04800022
*    IF AN ADDITIONAL TEST DEVICE IS REQUIRED IEDQWV IS CALLED. IF    * 04850022
*    DATA CONVERSION IS REQUIRED IEDQWX IS CALLED. IF CONFIGURATION   * 04900022
*    DATA IS REQUESTED, IEDQWY IS CALLED. IF A HALT I/O I REQUESTED,  * 04950022
*    IEDQW44 IS CALLED. IF THE OLT REQUIRES MORE CORE OR WANTS TO     * 05000022
*    FREE CORE, IEDQW42 (ALIAS IEDQW43) IS CALLED. IF A CONTROL UNIT  * 05050022
*    TEST IS DESIRED, IEDQWAJ IS CALLED. IF THE TIME IS DESIRED,      * 05100022
*    IEDQWAB IS CALLED.  IF THE DATE IS DESIRED, IEDQWAA IS     S22024* 05150000
*    CALLED.  AND DETERMINING WHETHER A ROUTINE SHOULD BE       S22024* 05170000
*    RUN IS PROVIDED BY IEDQW47. CONTROL IS THEN RETUNRED TO THE OLT. * 05200022
*                                                                     * 05250022
*    ENTRY POINT: QADDNDX                                      @Y17XAUV 05251000
*                                                              @Y17XAUV 05252000
*    THIS QUEUE HANDLER SUBROUTINE ADDS AN ELEMENT TO THE      @Y17XAUV 05253000
*    THE END OF A QUEUE.                                       @Y17XAUV 05254000
*                                                              @Y17XAUV 05255000
*    ENTRY POINT: QADDAFX                                      @Y17XAUV 05256000
*                                                              @Y17XAUV 05257000
*    THIS QUEUE HANDLER SUBROUTINE INSERTS AN ELEMENT AFTER    @Y17XAUV 05258000
*    A SPECIFIED ELEMENT ON A QUEUE.                           @Y17XAUV 05259000
*                                                              @Y17XAUV 05260000
*    ENTRY POINT: QREMELX                                      @Y17XAUV 05261000
*                                                              @Y17XAUV 05262000
*    THIS QUEUE HANDLER SUBROUTINE REMOVES A SPECIFIED         @Y17XAUV 05263000
*    ELEMENT FROM A QUEUE.                                     @Y17XAUV 05264000
*                                                              @Y17XAUV 05265000
*    ENTRY POINT: QREMFRX                                      @Y17XAUV 05266000
*                                                              @Y17XAUV 05267000
*    THIS QUEUE HANDLER SUBROUTINE REMOVES THE FIRST           @Y17XAUV 05268000
*    ELEMENT OF A QUEUE.                                       @Y17XAUV 05269000
*                                                              @Y17XAUV 05270000
* NOTES = SEE BELOW                                            @Y17XAUV 05271000
*                                                              @Y17XAUV 05272000
*    DEPENDENCIES = EBCDIC CHARACTER CODE.                     @Y17XAUV 05273000
*                                                              @Y17XAUV 05274000
*    RESTRICTIONS = NONE                                       @Y17XAUV 05275000
*                                                              @Y17XAUV 05276000
*    PATCH LABEL = PATCH                                       @Y17XAUV 05277000
*                                                              @Y17XAUV 05278000
* MODULE TYPE = CSECT                                          @Y17XAUV 05279000
*                                                              @Y17XAUV 05280000
*    PROCESSOR = ASMX                                          @Y17XAUV 05281000
*                                                              @Y17XAUV 05282000
*    MODULE SIZE = NO RESTRICTION                              @Y17XAUV 05283000
*                                                              @Y17XAUV 05284000
*    ATTRIBUTES = THE RESIDENT ROUTINE IS SERIALLY             @Y17XAUV 05285000
*    REUSEABLE.  ALL OTHER ROUTINES ARE REENTRANT.  THE        @Y17XAUV 05285200
*    LINKAGE EDITOR ATTIBUTES SHOULD BE SPECIFIED AS           @Y17XAUV 05285400
*    SERIALLY REUSEABLE.                                       @Y17XAUV 05285600
*                                                              @Y17XAUV 05286000
* INPUT = SEE BELOW                                            @Y17XAUV 05287000
*                                                              @Y17XAUV 05288000
*    ENTRY POINT IEDQWA:                                       @Y17XAUV 05289000
*                                                              @Y17XAUV 05290000
*         REGISTER 1 - TCAM AVT ADDRESS                        @Y17XAUV 05291000
*         REGISTER 13 - SAVE AREA ADDRESS                      @Y17XAUV 05292000
*         REGISTER 14 - RETURN ADDRESS                         @Y17XAUV 05293000
*         REGISTER 15 - ENTRY POINT ADDRESS                    @Y17XAUV 05294000
*                                                              @Y17XAUV 05394000
*    ENTRY POINTS ALLOCBUF, FREEBUF, POSTWAIT, AND HIERSCAN:   @XM05672 05494000
*                                                              @Y17XAUV 05594000
*         SEE SUBROUTINE COMMENTS.                             @Y17XAUV 05694000
*                                                                     * 05950022
*    ENTRY POINT OLTETXR:                                             * 06000022
*                                                                     * 06050022
*         REGISTER 1 - TCB ADDRESS OF ENDING SUBTASK                  * 06100022
*         REGISTER 2 - OLTCB ADDRESS                                  * 06150022
*         REGISTER 13 - SAVE AREA ADDRESS                             * 06200022
*         REGISTER 14 - RETURN ADDRESS                                * 06250022
*         REGISTER 15 - ENTRY POINT ADDRESS                           * 06300022
*                                                                     * 06350022
*    ENTRY POINT STAERT:                                        S22024* 06357000
*                                                               S22024* 06364000
*         REGISTER 13 - SAVE AREA ADDRESS                       S22024* 06371000
*         REGISTER 14 - RETURN ADDRESS                          S22024* 06378000
*         REGISTER 15 - ENTRY POINT ADDRESS                     S22024* 06385000
*                                                               S22024* 06392000
*    ENTRY POINT SMGR:                                                * 06400022
*                                                                     * 06450022
*         REGISTER 1 - PARAMETER LIST ADDRESS                         * 06500022
*         REGISTER 2 - OLTCB ADDRESS                                  * 06550022
*         REGISTER 13 - SAVE AREA ADDRESS                             * 06600022
*         REGISTER 14 - RETURN ADDRESS                                * 06650022
*         REGISTER 15 - ENTRY POINT ADDRESS                           * 06700000
*                                                                     * 06750022
*    ENTRY POINTS QADDNDX,QADDAFX,QREMNDX,QREMFRX (QUEUE       @Y17XAUV 06760000
*    HANDLERS) : SEE CODE.                                     @Y17XAUV 06770000
*                                                              @Y17XAUV 06780000
* OUTPUT:                                                             * 06800022
*                                                              @Y17XAUV 06804000
*    FOR THE ALLOCBUF, FREEBUF, POSTWAIT, HIERSCAN, AND        @XM05672 06808000
*    QUEUE HANDLER SUBROUTINES, SEE THE SUBROUTINE COMMENTS.   @XM05672 06812000
*                                                              @Y17XAUV 06816000
*    IEDQWA: (WHEN CALLING IEDQWA1)                            @Y17XAUV 06820000
*                                                              @Y17XAUV 06824000
*         REGISTER 1 - PARAMETER LIST ADDRESS.                 @Y17XAUV 06828000
*         REGISTER 4 - TCAM AVT ADDRESS.                       @Y17XAUV 06832000
*                                                              @Y17XAUV 06836000
*    IEDQWA: (WHEN LINKING TO IEDQWB)                          @Y17XAUV 06840000
*                                                                     * 06850022
*    REGISTER 1 - PARAMETER LIST ADDRESS                        S22024* 06900000
*    REGISTER 2 - OLTCB ADDRESS                                       * 06950022
*                                                                     * 07900022
* EXITS,NORMAL:  BR 14 TO OPERATING SYSTEM.                    @Y17XAUV 07950000
*                                                                     * 08000022
* EXITS,ERROR:  NONE                                                  * 08050022
*                                                                     * 08100022
* EXTERNAL REFERENCES:                                         @Y17XAUV 08150000
*                                                              @Y17XAUV 08154000
*    ROUTINES =                                                @Y17XAUV 08158000
*                                                              @Y17XAUV 08162000
*    IEDQWA1 - TOTE INPUT DATA HANDLER MODULE                  @Y17XAUV 08166000
*    IEDQWN (IEDQW35) - EXIO SERVICE MODULE                    @Y17XAUV 08170000
*    IEDQWP (IEDQW39) - DPRINT SERVICE MODULE                  @Y17XAUV 08174000
*    IEDQWQ (IEDQW37) - CECOM SERVICE MODULE                   @Y17XAUV 08178000
*    IEDQWR (IEDQW28) - PLINK SERVICE MODULE                   @Y17XAUV 08182000
*    IEDQWS(IEDQW36) - WAITIO SERVICE MODULE                   @Y17XAUV 08186000
*    IEDQWV (IEDQW21,IEDQWAC) - GRAB/LETGO SERVICE MODULE      @Y17XAUV 08190000
*    IEDQWX (IEDQW41) - CONVERT SERVICE MODULE                 @Y17XAUV 08194000
*    IEDQWY (IEDQW16) - GETCONFG SERVICE MODULE                @Y17XAUV 08198000
*    IEDQWAA - $DDATE SERVICE MODULE                           @Y17XAUV 08202000
*    IEDQWAB - $DTIME SERVICE MODULE                           @Y17XAUV 08206000
*    IEDQWAJ - $CUTEST SERVICE MODULE                          @Y17XAUV 08210000
*    IEDQW25 - SEND SERVICE MODULE                             @Y17XAUV 08214000
*    IEDQW33 - RECEIVE SERVICE MODULE                          @Y17XAUV 08218000
*    IEDQW42 (IEDQW43) - FREECORE/MORECORE SERVICE MODULE      @Y17XAUV 08222000
*    IEDQW44 - DIO SERVICE MODULE                              @Y17XAUV 08226000
*    IEDQW47 - ROUTINE SERVICE MODULE                          @Y17XAUV 08230000
*                                                              @Y17XAUV 08234000
*    CONTROL BLOCKS =                                          @Y17XAUV 08238000
*                                                              @Y17XAUV 08242000
*    OLTCB,AVT,PRF,TRM,QCB,SCB,LCB,TCB,UCB,TPRIOR,IOBLOCKS     @Y17XAUV 08250000
*                                                              @Y17XAUV 08258000
*    MACROS =                                                  @Y17XAUV 08266000
*                                                              @Y17XAUV 08274000
*    AQCTL,DCB,DELETE,DETACH,FREEMAIN,GETMAIN,LOAD,POST,WAIT   @Y17XAUV 08282000
*                                                              @Y17XAUV 08290000
*********************************************************************** 09650022
         EJECT                                                          11500022
*********************************************************************** 11600022
*                                                                     * 11700022
*              REGISTER EQUATES                                       * 11800022
*                                                                     * 11900022
*********************************************************************** 12000022
         SPACE 2                                                        12100022
R0       EQU   0                  WORK REGISTER                         12200022
R1       EQU   1                  WORK REGISTER                @Y17XAUV 12300000
RPARM    EQU   1                  PARAMETER LIST ADDR          @Y17XAUV 12350000
R2       EQU   2                  ADDRESS OF ELEMENT BEING PROCESSED    12400022
R3       EQU   3                  WORK REGISTER                         12500022
R4       EQU   4                  WORK REGISTER                @Y17XAUV 12600000
RAVT     EQU   4                  AVT BASE                     @Y17XAUV 12650000
R5       EQU   5                  WORK REGISTER                         12700022
R6       EQU   6                  WORK REGISTER                         12800022
R7       EQU   7                  WORK REGISTER                         12900022
R8       EQU   8                  WORK REGISTER                         13000022
R9       EQU   9                  WORK REGISTER                         13100022
R10      EQU   10                 WORK REGISTER                         13200022
R11      EQU   11                 BASE REGISTER                         13300022
R12      EQU   12                 WORK REGISTER                         13400022
R13      EQU   13                 SAVE AREA ADDRESS                     13500022
R14      EQU   14                 RETURN ADDRESS                        13600022
R15      EQU   15                 ENTRY POINT ADDRESS                   13700000
         EJECT                                                          13710000
**************************************************************** S22024 13720000
*                                                              * S22024 13730000
*                       MODULE EQUATES                         * S22024 13740000
*                                                              * S22024 13750000
**************************************************************** S22024 13760000
* EQUATES MOVED FROM THE END OF MODULE                           S22024 13765000
         SPACE 2                                                        13770000
D0       EQU   0                  CONSTANT DISPLACEMENT                 13780000
D1       EQU   1                  CONSTANT DISPLACEMENT                 13790000
D2       EQU   2                  CONSTANT DISPLACEMENT                 13800000
D3       EQU   3                  CONSTANT DISPLACEMENT                 13810000
D4       EQU   4                  CONSTANT DISPLACEMENT                 13820000
D5       EQU   5                  CONSTANT DISPLACEMENT                 13830000
D6       EQU   6                  CONSTANT DISPLACEMENT                 13840000
D7       EQU   7                  CONSTANT DISPLACEMENT                 13850000
D8       EQU   8                  CONSTANT DISPLACEMENT                 13860000
D11      EQU   11                 CONSTANT DISPLACEMENT                 13870000
D12      EQU   12                 CONSTANT DISPLACEMENT                 13880000
D16      EQU   16                 CONSTANT DISPLACEMENT          S22024 13885000
D17      EQU   17                 CONSTANT DISPLACEMENT                 13890000
D18      EQU   18                 CONSTANT DISPLACEMENT                 13900000
D19      EQU   19                 CONSTANT DISPLACEMENT          Y06330 13905005
D1C      EQU   X'1C'              CONSTANT DISPLACEMENT                 13910000
D28      EQU   28                 CONSTANT DISPLACEMENT                 13920000
D2C      EQU   X'2C'              CONSTANT DISPLACEMENT          Y06330 13925005
D30      EQU   30                 CONSTANT DISPLACEMENT                 13930000
D20      EQU   20                 CONSTANT DISPLACEMENT        @Y17XAUV 13940000
D58      EQU   58                 CONSTANT DISPLACEMENT                 13950000
D62      EQU   62                 CONSTANT DISPLACEMENT                 13960000
D72      EQU   72                 CONSTANT DISPLACEMENT 72       S22024 13970000
D255     EQU   255                CONSTANT DISPLACEMENT 255    @Y17XAUV 13970700
D24      EQU   24                 CONSTANT DISPLACEMENT 24     @Y17XAUV 13971000
         SPACE 2                                               @Y17XAUV 13971400
X00      EQU   X'00'              USED TO ZERO A FIELD         @Y17XAUV 13972100
TICCODE  EQU   X'08'              TIC CCW COMMAND CODE         @Y17XAUV 14052100
WAITING  EQU   X'0C'              OLT WAITING FOR MORE CORE             14132100
PROCTRM  EQU   X'10'              TRM TO PROCESS CODE                   14212100
XFF      EQU   X'FF'              USED TO CLEAR FLAG BITS               14320000
BLANK    EQU   X'40'              USED TO CLEAR A FIELD                 14330000
SIXTEEN  EQU   16                 ADDRESS OF CVT                        14340000
ANR      EQU   X'1E'              INDICATION IN LCB OF LOCAL RECEIVE    14350000
*                                   SCHEDULER                           14360000
XF0      EQU   X'F0'              MOVED INTO LOCAL LCB BEFORE RETURNING 14370000
*                                   THE BUFFER                          14380000
START    EQU   X'0C'              INDICATES START OF SVC 102            14390000
*                                   PARAMETER LIST                      14400000
EIGHTY   EQU   X'80'              INDICATES END OF PARM LIST FOR        14410000
*                                   SVC 102                             14420000
OPCKEY   EQU   X'00'              OP CONTROL KEY FIELD           S22024 14440000
OPCPRI   EQU   X'DC'              OP CONTROL PRIORITY            S22024 14460000
OPCRTCD  EQU   X'00'              OP CONTROL RETURN CODE FIELD   S22024 14480000
OPCELNG  EQU   X'18'              OP CONTROL ELEMENT LENGTH      S22024 14500000
LINESTRT EQU   X'40'              VERB CODE FOR START LINE       S22024 14520000
LINESTOP EQU   X'41'              STOP LINE VERB CODE            S22024 14540000
         EJECT                                                 @Y17XAUV 14600000
*********************************************************************** 14602000
*                                                                     * 14604000
*        TOTE INITIALIZATION - TERMINATION                     @Y17XAUV 14606000
*                                                                     * 14608000
*********************************************************************** 14610000
         SPACE 2                                               @Y17XAUV 14612000
         SAVE  (14,12)                                         @Y17XAUV 14614000
         LR    R12,R15            COPY ENTRY PT ADDR           @Y17XAUV 14616000
         USING IEDQWA,R12         SET MODULE BASE REG          @Y17XAUV 14618000
IEDQWA   IEDHJN IEDQWAA,HJN       ID,TIME,DATE                 @Y17XAUV 14620000
         ST    R13,REGSAVE+4      SAVE PTR TO TCAM SAVE AREA   @Y17XAUV 14622000
         LR    R14,R13            COPY                         @Y17XAUV 14624000
         LA    R13,REGSAVE        PTR TO TOTE SAVE AREA        @Y17XAUV 14626000
         ST    R13,D8(R14)        SAVE PTR TO TOTE SAVE AREA   @Y17XAUV 14628000
*                                  IN TCAM'S SAVE AREA         @Y17XAUV 14630000
         SPACE 2                                               @Y17XAUV 14632000
**********                                                     @Y17XAUV 14634000
*        INITIALIZATION                                        @Y17XAUV 14636000
**********                                                     @Y17XAUV 14638000
         LR    RAVT,RPARM         LOAD ADDR OF TCAM AVT        @Y17XAUV 14640000
         USING IEDQAVTD,RAVT                                   @Y17XAUV 14642000
         LA    R5,AVTOLTQB+4      ADDR OF TOTE ECB IN TOTE QCB @Y17XAUV 14644000
         ST    R5,RESTECBS        STORE IN WAIT PARM LIST      @Y17XAUV 14646000
         LA    R5,RESPL           LOAD ADDR OF RESPL           @YM07361 14648000
         ST    R5,AVTCWTOT        STORE IN TCAM AVT            @Y17XAUV 14650000
         LOAD  EP=IEDQWA1         LOAD INPUT DATA HANDLER      @Y17XAUV 14652000
         ST    R0,RESPLA1         COPY ENTRY POINT ADDR        @Y17XAUV 14654000
         SPACE 3                                               @Y17XAUV 14654200
RES005   EQU   *                                               @Y17XAUV 14654400
         WAIT  1,ECBLIST=RESTECBS WAIT FOR TOTE TASK REQUEST   @Y17XAUV 14654600
         XC    AVTOLTQB+D4(D4),AVTOLTQB+D4 CLEAR TOTE AVT ECB  @Y17XAUV 14654800
         XC    RESTECB1(D4),RESTECB1   CLEAR TOTE RESPL        @Y17XAUV 14655000
*                                                                       14655200
RES10A   EQU   *                                                        14656000
         L     R2,RESOBQCB        GET FIRST ELEMENT IN OLT              14756000
*                                   ACTIVE QUEUE                        14856000
         TM    AVTBIT1,AVTCLOSN   IS TCAM CLOSEDOWN IN PROGRESS?        14956000
         BZ    RES02              NO, CONTINUE                          15056000
RES011   EQU   *                                                        15156000
         USING TOTOBPTR,R2        SET UP ADDRESSIBILITY FOR OLTCB       15256000
         CLI   TOTELKEY,QENDKEY   IS OLT ACTIVE QUEUE EMPTY?            15356000
         BE    RESTERM            YES, GO EXIT TO TCAM         @Y17XAUV 15456000
         OI    TOTFLG04,TOTCLOSE  SET CLOSEDOWN IN PROGRES BIT   Y06330 15556000
         DETACH TOTTCBAD          DETACH ACTIVE SUBTASK          S05331 15656000
*                                                                       15756000
         L     R2,TOTELLNK-D1     GET NEXT OLTCB IN QUEUE               15856000
         B     RES011             BRANCH BACK AND EXAMINE NEXT OLTCB    15956000
         DROP  R2                 DROP OLTCB BASE                       16056000
*                                                                       16156000
RES02    EQU   *                                                        16256000
*                                                                     * 16356000
*        TEST OLT ACTIVE QUEUE                                        * 16456000
*                                                                     * 16556000
RES022   EQU   *                                                        16656000
         USING TOTOBPTR,R2        SET UP ADDRESSIBILITY FOR OLTCB       16756000
         CLI   TOTELKEY,QENDKEY   IS OLT ACTIVE QUEUE EMPTY?            16856000
         BE    RES030             YES, GO CHECK TRM QUEUE               16956000
         MVI   RESWBFNC,WAITING   SET CODE FOR OLT WAITING              17056000
         TM    TOTFLG10,TOTOLTED+TOTOLTRS+TOTTNTRQ+TOTOLTWT  TEST       17156000
*                                 DOES SUBTASK NEED RESOURCES?          17256000
         BZ    RES25              NO - CHECK NEXT OLTCB        @Y17XAUV 17356000
         LA    R1,RESPL           RESIDENT PARM LIST           @Y17XAUV 17456000
         LINK  EP=IEDQWB          TOTE RESOURCE MANAGER        @Y17XAUV 17556000
         B     WBRTNL(R15)        BRANCH TO WB RETURN LIST     @Y17XAUV 17656000
WBRTNL   DS    0H                                              @Y17XAUV 17756000
         B     RES10A             RETURN TO QUEUE PROCESSING   @Y17XAUV 17856000
         B     RES005             WAIT ON ECB LIST             @Y17XAUV 17956000
         B     RESTERM            TERMINATE TOTE TASK          @Y17XAUV 18056000
RES25    DS    0H                                              @Y17XAUV 18156000
         L     R2,TOTELLNK-D1     GET NEXT OLTCB IN QUEUE               18256000
         B     RES022             BRANCH BACK AND EXAMINE NEXT OLTCB    18356000
         DROP  R2                 DROP OLTCB BASE                       18456000
*                                                                       18556000
RES030   EQU   *                                                        18656000
*                                                                     * 18756000
*        TEST TRM QUEUE                                               * 18856000
*                                                                     * 18956000
         MVI   RESWBFNC,PROCTRM   SET CODE FOR TRM PROCESSING           19056000
         CLC   AVTOLTQB+1(3),AVTDELAD+1 IS QUEUE EMPTRY        @YM07728 19156000
         BE    RES005             YES, GO WAIT FOR ANOTHER REQUEST      19456000
         SPACE 1                                               @Y17XAUV 19656000
         LA    RPARM,RESPL        PARAMETER                    @Y17XAUV 19756000
         L     R15,RESPLA1        ADDR OF INPUT DATA HANDLER   @Y17XAUV 19856000
         BALR  R14,R15            CALL INPUT DATA HANDLER      @Y17XAUV 19956000
         B     WA1RTNL(R15)       BRANCH TO WA1 RETURN LIST    @Y17XAUV 20056000
WA1RTNL  DS    0H                                              @Y17XAUV 20156000
         B     RES10A             GO CHECK IF OLTCB NEEDS      @Y17XAUV 20256000
*                                  RESOURCES                   @Y17XAUV 20356000
         B     RES005             GO WAIT ON ECB LIST          @Y17XAUV 20456000
         SPACE 1                                               @Y17XAUV 20556000
**********                                                     @Y17XAUV 20656000
*        TERMINATION                                           @Y17XAUV 20756000
**********                                                     @Y17XAUV 20856000
RESTERM  DS    0H                                              @Y17XAUV 20956000
         DELETE EP=IEDQWA1        DELETE INPUT DATA HANDLER    @Y17XAUV 21056000
         L     R13,D4(R13)        LOAD CALLER'S SAVE AREA      @Y17XAUV 21156000
         LM    R14,R12,D12(R13)   RESTORE REGS                 @Y17XAUV 21256000
         BR    14                 RETURN TO CALLER             @Y17XAUV 21356000
         EJECT                                                 @Y17XAUV 21456000
*********************************************************************** 21556000
*                                                                     * 21656000
*        ALLOCATE BUFFER ROUTINE                               @Y17XAUV 21756000
*                                                              @Y17XAUV 21856000
*        INPUT  :  R0 - POINTS TO WORKAREA OF X'34' BYTES.     @Y17XAUV 21956000
*                  R1 - CONTAINS NUMBER OF UNITS TO GET.       @Y17XAUV 22056000
*                  R4 - POINTS TO TCAM AVT.                    @Y17XAUV 22156000
*                  R13,R14,R15 - STANDARD LINKAGE CONVENTIONS. @Y17XAUV 22256000
*                                                              @Y17XAUV 22356000
*        OUTPUT :  R1 - POINTS TO FIRST UNIT IN BUFFER.        @Y17XAUV 22456000
*                                                                     * 22556000
*********************************************************************** 22656000
         SPACE 3                                               @Y17XAUV 22756000
ALLOCBUF DS    0H                                              @Y17XAUV 22856000
         STM   R14,R12,D12(R13)   SAVE REGS                    @Y17XAUV 22956000
         USING ALLOCBUF,R15       TEMPORARY BASE REG           @Y17XAUV 23056000
         L     R12,RESBASE        LOAD MODULE BASE REGISTER    @Y17XAUV 23156000
         DROP  R15                DROP R12 AS BASE             @Y17XAUV 23256000
         USING IEDQAVTD,R4        TCAM AVT BASE                @Y17XAUV 23356000
         USING IEDTTCD,R5         WORK AREA BASE               @Y17XAUV 23456000
         USING IEDQPRF,R6         BUFFER PREFIX BASE           @Y17XAUV 23556000
         USING IEDPF1,R8          NEG BUFFER PREFIX BASE       @Y17XAUV 23656000
         USING IEDQLCB,R11        LCB BASE                     @Y17XAUV 23756000
         LR    R5,R0              COPY WORKAREA ADDR           @Y17XAUV 23856000
*                                                              @Y17XAUV 23956000
*        OBTAIN LCB ADDR. FIELDS USED ARE CONTAINED IN         @Y17XAUV 24056000
*        WORKAREA.                                             @Y17XAUV 24156000
*                                                              @Y17XAUV 24256000
         LA    R11,TTCSTOFF       OFFSET FROM BEGINNING OF LCB @Y17XAUV 24356000
         LCR   R11,R11            MAKE NEGATIVE NUMBER         @Y17XAUV 24456000
         ALR   R11,R5             OBTAIN START OF DUMMY LCB    @Y17XAUV 24556000
*                                                              @Y17XAUV 24656000
*        SET UP ERB FOR BUFFER REQUEST                         @Y17XAUV 24756000
*                                                              @Y17XAUV 24856000
         LA    R6,AVTBFREB        SET BUFFER REQUEST           @Y17XAUV 24956000
         ST    R6,LCBERBQB-D1      QCB IN ERB                  @Y17XAUV 25056000
         MVI   LCBERBPY,PRIINTRQ  SET PRIORITY OF POST         @Y17XAUV 25156000
         XC    LCBERBLK(D7),LCBERBLK CLEAR LINK,STATUS,CHAIN   @Y17XAUV 25256000
         MVI   LCBERBST,D2        APPLICATION PROGRAM STATUS   @Y17XAUV 25356000
         MVI   LCBRBCT1,D1        NUMBER OF BUFFERS IS 1       @Y17XAUV 25456000
         STC   R1,LCBRBCT2        NUMBER OF UNITS              @Y17XAUV 25556000
*                                                              @Y17XAUV 25656000
         LA    R6,TTCQCB          PLACE ADDR OF WORKAREA'S     @Y17XAUV 25756000
         ST    R6,LCBRCQCB         QCB INTO THE LCB            @Y17XAUV 25856000
         XC    LCBSTAT1(D2),LCBSTAT1 CLEAR LCB STATUS FIELDS   @Y17XAUV 25956000
*                                                              @Y17XAUV 26056000
*        POST ERB AND WAIT FOR UNITS                           @Y17XAUV 26156000
*                                                              @Y17XAUV 26256000
         LA    R1,LCBERB          ADDR OF ERB                  @Y17XAUV 26356000
         ICM   R1,D8,ERBCODE      INDICATES ERB REQUEST        @Y17XAUV 26456000
         ST    R14,D0(R13)         SAVE RETURN REG             @Y17XAUV 26556000
         ST    R15,D4(R13)        SAVE ENTRY POINT             @Y17XAUV 26656000
         ST    R12,D8(R13)        SAVE BASE REG                @Y17XAUV 26756000
         LA    R15,POSTWAIT       GET ADDR OF POST WAIT ROUTINE@Y17XAUV 26856000
         L     R0,D20(R13)        RESTORE REGS 0               @Y17XAUV 26956000
         LM    R2,R12,D28(R13)    RESTORE REGS 2 - 12          @Y17XAUV 27056000
         BALR  R14,R15            POST ERB AND WAIT            @Y17XAUV 27156000
*                                                              @Y17XAUV 27256000
         L     R15,D4(R13)        RESTORE ENTRY POINT          @Y17XAUV 27356000
         L     R14,D0(R13)        RESTORE RETURN REG           @Y17XAUV 27456000
         STM   R14,R12,D12(R13)   SAVE REGS AGAIN              @Y17XAUV 27556000
         L     R12,D8(R13)        RESTORE BASE REG             @Y17XAUV 27656000
*                                                              @Y17XAUV 27756000
*        CLEAR EACH BUFFER UNIT EXCEPT FOR UNIT CONTROL AREA   @Y17XAUV 27856000
*                                                              @Y17XAUV 27956000
         LR    R5,R0              WORKAREA ADDRESSIBILITY      @Y17XAUV 28056000
         LR    R6,R1              COPY ADDR OF UNITS           @Y17XAUV 28156000
         SR    R9,R9              CLEAR                        @Y17XA7V 28256000
         TM    AVTSAVTF,AVTVTMCP  IS THERE NCP SUPPORT         @Y17XAUV 28356000
         BNO   NONCP              NO - BRANCH                  @Y17XAUV 28456000
         LA    R9,PRF1LEN         LENGTH OF NEG PREFIX         @Y17XAUV 28556000
         LCR   R9,R9              MAKE A NEG VALUE             @Y17XAUV 28656000
NONCP    DS    0H                                              @Y17XAUV 28756000
         SLR   R7,R7              CLEAR                        @Y17XAUV 28806000
         ICM   R7,D3,AVTKEYLE     GET UNIT SIZE                @Y17XAUV 28856000
         BCTR  R7,R0              DECREMENT FOR EXECUTE        @Y17XAUV 28956000
CLRBUFUT DS    0H                                              @Y17XAUV 29056000
         EX    R7,CLRINSTR        CLEAR UNIT                   @Y17XAUV 29156000
         LTR   R8,R9              DOES UNIT HAVE NEG PREFIX ?  @Y17XAUV 29256000
         BZ    CLRBRNCH           NO - BRANCH                  @Y17XAUV 29356000
         ALR   R8,R6              COPY ADDR OF BUFFER          @Y17XAUV 29456000
         XC    IEDPF1(PRF1LEN),IEDPF1 CLEAR NEG PREFIX         @Y17XAUV 29556000
CLRBRNCH DS    0H                                              @Y17XAUV 29656000
         L     R6,PRFTIC          LOAD TIC FIELD               @Y17XAUV 29756000
         EX    R6,CHKTIC          IS THIS THE LAST UNIT ?      @Y17XAUV 29856000
         BZ    CLRBUFUT           NO - CLEAR NEXT UNIT         @Y17XAUV 29956000
*                                                              @Y17XAUV 30056000
         LM    R14,R12,D12(R13)   RESTORE REGISTERS            @Y17XAUV 30156000
         BR    R14                RETURN                       @Y17XAUV 30256000
         DROP  R4                                              @Y17XAUV 30356000
         DROP  R5                                              @Y17XAUV 30456000
         DROP  R6                                              @Y17XAUV 30556000
         DROP  R8                                              @Y17XAUV 30656000
         DROP  R11                                             @Y17XAUV 30756000
         EJECT                                                 @Y17XAUV 30856000
*********************************************************************** 30956000
*                                                                     * 31056000
*        FREE BUFFER ROUTINE                                   @Y17XAUV 31156000
*                                                              @Y17XAUV 31256000
*        INPUT  :  R0 - POINTS TO WORKAREA OF X'34' BYTES.     @Y17XAUV 31356000
*                  R1 - POINTS TO ONE BUFFER.                  @Y17XAUV 31456000
*                  R4 - POINTS TO TCAM ACT.                    @Y17XAUV 31556000
*                  R13,R14,R15 - STANDARD LINKAGE CONVENTIONS. @Y17XAUV 31656000
*                                                                     * 31756000
*********************************************************************** 31856000
         SPACE 3                                               @Y17XAUV 31956000
FREEBUF  DS    0H                                              @Y17XAUV 32056000
*                                                              @Y17XAUV 32156000
         STM   R14,R12,D12(R13)   SAVE REGS                    @Y17XAUV 32256000
         LR    R5,R0              COPY WORKAREA ADDR           @Y17XAUV 32356000
         USING FREEBUF,R15        TEMPORARY BASE REG           @Y17XAUV 32456000
         L     R12,RESBASE        LOAD MODULE BASE ADDR        @Y17XAUV 32556000
         DROP  R15                DROP TEMPORARY               @Y17XAUV 32656000
         USING IEDQAVTD,R4        TCAM AVT                     @Y17XAUV 32756000
         USING IEDTTCD,R5         WORKAREA BASE                @Y17XAUV 32856000
*                                                              @Y17XAUV 32956000
*        COUNT NUMBER OF UNITS                                 @Y17XAUV 33056000
*                                                              @Y17XAUV 33156000
         USING IEDQPRF,R6         BUFFER PREFIX                @Y17XAUV 33256000
         LR    R6,R1              COPY ADDR OF 1ST UNIT        @Y17XAUV 33356000
         XC    PRFLINK(D3),PRFLINK INSURE CLEAR FOR POSTWAIT   @Y17XAUV 33456000
         SR    R7,R7              CLEAR FOR USE AS COUNTER     @Y17XAUV 33556000
NEXTUNIT DS    0H                                              @Y17XAUV 33656000
         EX    R6,CHKTIC          CHECK FOR INVALID TIC        @Y17XAUV 33756000
         BNZ   ENDBUF             BRANCH IF LAST UNIT          @Y17XAUV 33856000
         MVI   PRFTIC,TICCODE     SET TIC CCW CMND             @Y17XAUV 33956000
         L     R6,PRFTIC          POINT TO NEXT BUFFER UNIT    @Y17XAUV 34056000
         BCT   R7,NEXTUNIT        INCREMENT COUNT AS NEGATIVE  @Y17XAUV 34156000
         DROP  R6                                              @YM07685 34206000
*                                                              @Y17XAUV 34256000
ENDBUF   DS    0H                                              @Y17XAUV 34356000
         LPR   R7,R7              MAKE COUNT NON-NEGATIVE      @Y17XAUV 34456000
*                                                              @Y17XAUV 34556000
*        POST UNITS TO BUFFER RETURN                           @Y17XAUV 34656000
*                                                              @Y17XAUV 34756000
         USING IEDQPRF,R1         BASE ON FIRST UNIT           @Y17XAUV 34856000
         LA    R8,AVTBFRTB        PLACE QCB ADDR IN            @YM08007 34956000
         ST    R8,PRFQCBA-1        BUFFER PREFIX               @Y17XAUV 35056000
         MVI   PRFPRI,PRIBFRTB    SET POST PRIORITY            @Y17XAUV 35156000
         STC   R7,PRFNBUNT        SET NUMBER OF UNITS IN BUF   @Y17XAUV 35256000
         LA    R1,D0(R1)          INDICATE NO WAIT AFTER POST  @Y17XAUV 35356000
         ST    R14,D0(R13)        SAVE RETURN REG              @Y17XAUV 35456000
         ST    R15,D4(R13)        SAVE ENTRY POINT             @Y17XAUV 35556000
         ST    R12,D8(R13)        SAVE BASE REG                @Y17XAUV 35656000
         LA    R15,POSTWAIT       GET ADDR OF POST WAIT ROUTINE@Y17XAUV 35756000
         L     R0,D20(R13)        RESTORE REGS 0               @Y17XAUV 35856000
         LM    R2,R12,D28(R13)    RESTORE REGS 2 - 12          @Y17XAUV 35956000
         BALR  R14,R15            POST ERB AND WAIT            @Y17XAUV 36056000
*                                                              @Y17XAUV 36156000
         L     R15,D4(R13)        RESTORE ENTRY POINT          @Y17XAUV 36256000
         L     R14,D0(R13)        RESTORE RETURN REG           @Y17XAUV 36356000
         BR    R14                RETURN                       @Y17XAUV 36456000
         DROP  R1                                              @Y17XAUV 36556000
         DROP  R4                                              @Y17XAUV 36656000
         DROP  R5                                              @Y17XAUV 36756000
         EJECT                                                 @Y17XAUV 36856000
*********************************************************************** 36956000
*                                                                     * 37056000
*        TOTE POST AND WAIT ROUTINE                            @Y17XAUV 37156000
*                                                              @Y17XAUV 37256000
*        INPUT  :  R0 - POINTS TO WORKAREA OF X'34' BYTES.     @Y17XAUV 37356000
*                  R1 - HIGH ORDER BYTE CONTAINS A CODE:       @Y17XAUV 37456000
*                       X'00' - NO WAIT IS NEEDED              @Y17XAUV 37556000
*                       X'80' - WAIT IS TO BE PERFORMED AND    @Y17XAUV 37656000
*                               GENERAL REQUEST ELEMENT IS     @Y17XAUV 37756000
*                               POINTED TO IN LOWER 3 BYTES    @Y17XAUV 37856000
*                       X'C0' - WAIT AND ERB IS POINTED TO     @Y17XAUV 37956000
*                       X'E0' - POST AND WAIT, NO ELEMENT IS   @Y17XAUV 38056000
*                               RETURNED                       @Y17XAUV 38156000
*                     - LOW ORDER 3 BYTES CONTAIN ELEMENT TO   @Y17XAUV 38256000
*                       BE POSTED.                             @Y17XAUV 38356000
*                  R4 - POINTS TO TCAM ACT.                    @Y17XAUV 38456000
*                  R13,R14,R15 - STANDARD LINKAGE CONVENTIONS. @Y17XAUV 38556000
*                                                              @Y17XAUV 38656000
*        OUTPUT :  R1 - POINTS TO THE ELEMENT BEING RETURNED   @Y17XAUV 38756000
*                       OR BUFFER UNITS IF INPUT WAS AN ERB.   @Y17XAUV 38856000
*                                                                     * 38956000
*********************************************************************** 39056000
         SPACE 3                                               @Y17XAUV 39156000
POSTWAIT DS    0H                                              @Y17XAUV 39256000
         STM   R14,R12,D12(R13)   SAVE REGS                    @Y17XAUV 39356000
         LR    R5,R0              COPY WORKAREA ADDR           @YM07641 39456000
         USING IEDTTCD,R5         WORKAREA BASE                @Y17XAUV 39556000
         USING IEDQAVTD,R4        TCAM AVT                     @Y17XAUV 39656000
         USING IEDQPRF,R6         BUFFER PREFIX BASE           @Y17XAUV 39756000
         USING IEDREQD,R8         GENERAL REQUEST ELEMENT      @Y17XAUV 39856000
         USING IEDQLCB,R11        LINE CONTROL BLOCK           @YM07748 39906000
         USING POSTWAIT,R15       TEMPORARY BASE REG           @Y17XAUV 39956000
         L     R12,RESBASE        LOAD MODULE BASE REG         @Y17XAUV 40056000
         DROP  R15                DROP TEMPORARY BASE REG      @Y17XAUV 40156000
*                                                              @Y17XAUV 40256000
*        SET UP SVC 102 LIST                                   @Y17XAUV 40356000
*                                                              @Y17XAUV 40456000
         LA    R6,D0(R1)          COPY ADDR OF CHAIN OF ELMTS  @Y17XAUV 40556000
         ST    R6,TTCSVCW1        SET PTR TO FIRST IN PARM LIST@Y17XAUV 40656000
GETNEXT  DS    0H                                              @Y17XAUV 40756000
         CLC   PRFLINK(D3),WORD0  IS THIS ELMT LAST IN CHAIN ? @YM07735 40856000
         BZ    LASTUNIT           Y - BRANCH                   @Y17XAUV 40956000
         ICM   R6,D7,PRFLINK      POINT TO NEXT ELEMENT        @Y17XAUV 41056000
         B     GETNEXT                                         @Y17XAUV 41156000
LASTUNIT DS    0H                                              @Y17XAUV 41256000
         ST    R6,TTCLAST         SET PTR TO LAST IN PARM LIST @Y17XAUV 41356000
         MVI   TTCPCODE,TTCCHAIN  SET CODE FOR CHAIN POST      @Y17XAUV 41456000
*                                                              @Y17XAUV 41556000
*        SET UP QCB IF WAIT DESIRED                            @Y17XAUV 41656000
*                                                              @Y17XAUV 41756000
         LTR   R8,R1              COPY AND TEST WAIT BIT       @Y17XAUV 41856000
         BNM   POSTELMT           IF OFF - DON'T SET QCB       @Y17XAUV 41956000
         MVC   TTCQBELC-1(D4),AVTDELAD SET CHAIN PTR WITH DUMMY@Y17XAUV 42056000
         MVI   TTCQBFLG,D2        ATTACHED TASK QCB            @Y17XAUV 42156000
         XC    TTCQBECB(D4),TTCQBECB CLEAR ECB                 @Y17XAUV 42256000
         LA    R6,TTCQCB          LOAD ADDR OF DUMMY QCB       @Y17XAUV 42356000
         ST    R6,TTCQSTCB        POINT QCB TO SELF            @Y17XAUV 42456000
         CLM   R8,D8,CODEREQ      WAS INPUT A REQUEST ELEMT?   @Y17XAUV 42556000
         BNE   POSTELMT           NO - BRANCH                  @Y17XAUV 42656000
         STCM  R6,D7,REQRQCBA     SET AS RETURN QCB ADDR       @YM07770 42756000
*                                                              @Y17XAUV 42856000
*        SET UP SVC 102 PARM LIST AND POST ELEMENT             @Y17XAUV 42956000
*                                                              @Y17XAUV 43056000
POSTELMT DS    0H                                              @Y17XAUV 43156000
         LA    R1,TTCSVCPL        SET POINTER TO PARM LIST     @Y17XAUV 43256000
         AQCTL                    POST ELEMENT                 @Y17XAUV 43356000
*                                                              @Y17XAUV 43456000
         LTR   R8,R8              CHECK WAIT BIT               @Y17XAUV 43556000
         BNM   NOWAIT             BYPASS WAIT IF OFF           @Y17XAUV 43656000
*                                                              @Y17XAUV 43756000
         WAIT  ECB=TTCQBECB       WAIT                         @Y17XAUV 43856000
*                                                              @Y17XAUV 43956000
         CLM   R8,D8,ERBCODE      IS THIS FOR AN ERB ?         @YM07748 43965000
         BNE   NOTERB             NO - BRANCH                  @YM07748 43974000
         LA    R11,TTCSTOFF       OFFSET OF LCBRCQCB           @YM07748 43983000
         LCR   R11,R11            MAKE IT NEGATIVE             @YM07748 43992000
         ALR   R11,R5             START OF DUMMY LCB           @YM07748 44001000
         L     R1,LCBERBCH-1      POINT TO FIRST UNIT OF BUF   @YM07748 44010000
         LA    R1,0(R1)           CLEAR HI ORDER BYTE          @YM07748 44019000
         B     SAVELMPT           GO SAVE REG 1 IN SAVE AREA   @YM07748 44028000
NOTERB   DS    0H                 NOT ERB - QCB CHAIN POINTER  @YM07748 44037000
*                                  POINTS TO ELEMENT           @YM07748 44046000
         L     R1,TTCQBELC-D1     SET WITH ADDR OF ELEMENT     @Y17XAUV 44056000
         LA    R1,D0(R1)          CLEAR HIGH ORDER BYTE        @Y17XAUV 44156000
SAVELMPT DS    0H                                              @YM07748 44206000
         ST    R1,D24(R13)        STORE IN REG 1 SAVE LOCATION @Y17XAUV 44256000
NOWAIT   DS    0H                                              @Y17XAUV 44356000
         LM    R14,R12,D12(R13)   RESTORE REGS                 @Y17XAUV 44456000
         BR    R14                RETURN                       @Y17XAUV 44556000
         DROP  R4                                              @Y17XAUV 44656000
         DROP  R5                                              @Y17XAUV 44756000
         DROP  R6                                              @Y17XAUV 44856000
         DROP  R8                                              @Y17XAUV 44956000
         DROP  R11                                             @YM07748 45006000
         DROP  R12                                             @Y17XAUV 45056000
         EJECT                                                 @XM05672 45057000
***************************************************************@XM05672 45058000
*                                                              @XM05672 45059000
*        HIERARCHY SCAN ROUTINTE:                              @XM05672 45060000
*        THIS ROUTINE SCANS THE HIERARCHY UNDER A GIVEN        @XM05672 45061000
*        RESOURCE AND RESETS THE TOTE BITS.                    @XM05672 45062000
*        PARMS:  R1  = TTCIN OF GIVEN RESOURCE RIGHT JUSTIFIED @XM05672 45063000
*                R4  = AVT ADDRESS                             @XM05672 45064000
*                R13,R14,R15 = STANDARD LINKAGE                @XM05672 45065000
***************************************************************@XM05672 45066000
*                                                              @XM05672 45067000
*        REGSITER CONVENTIONS:                                 @XM05672 45068000
*        R1    = TTE BASE AND PARAMETER REGISTER               @XM05672 45069000
*        R4    = AVT BASE REGISTER                             @XM05672 45070000
*        R5    = LENGTH OF TTE NEGATIVE PREFIX                 @XM05672 45071000
*        R6    = TOP TTCIN                                     @XM05672 45072000
*        R7    = CURRENT TTCIN                                 @XM05672 45073000
*        R12   = BASE REGISTER                                 @XM05672 45074000
*        R13,R14,R15 = STANDARD USAGES                         @XM05672 45075000
*                                                              @XM05672 45076000
HIERSCAN DS    0H                                              @XM05672 45077000
         STM   R14,R12,12(R13)          SAVE REGS              @XM05672 45078000
         USING HIERSCAN,R15             SET TEMPORARY BASE     @XM05672 45079000
         L     R12,RESBASE              SET BASE REG           @XM05672 45080000
         DROP  R15                      DROP TEMPORARY BASE    @XM05672 45081000
         USING IEDQWA,R12               MODULE ADDRESSABILITY  @XM05672 45082000
         USING IEDNTRM,R1               TTE ADDRESSABILTIY     @XM05672 45083000
         USING IEDQAVTD,R4              AVT ADDRESSABILITY     @XM05672 45084000
         SLR   R7,R7                    CLEAR FOR TTCIN HOLD   @XM05672 45085000
         LR    R6,R1                    TOP TTCIN              @XM05672 45086000
         L     R15,AVTRNMPT             CONVERSION ROUTINE     @XM05672 45087000
         BALR  R14,R15                  CONVERT TTCIN TO TTE   @XM05672 45088000
         LA    R5,TRMPRFSZ              LENGTH OF NEG PREFIX   @XM05672 45089000
         SLR   R1,R5                    POINT TO NEG PREFIX    @XM05672 45090000
         BAL   R3,COMSWAP               TURN OFF TOTE FLAG     @XM05672 45091000
         ICM   R7,3,TRMSUBST            CURRENT TTINC=SUBSTRUCT@XM05672 45092000
         LTR   R7,R7                    Q-SUBSTRUCT ZERO       @XM05672 45093000
         BZ    HIEREND                  Y-NO INFERIOR RESOURCES@XM05672 45094000
*        LOOP THROUGH ALL RESOURCES UNDER TOP TTCIN            @XM05672 45095000
TOPLOOP  DS    0H                                              @XM05672 45096000
         CLR   R6,R7                    Q-TOP = CURRENT TTCIN  @XM05672 45097000
         BE    HIEREND                  Y-END OF HIER SCAN     @XM05672 45098000
         LR    R1,R7                    COPY CURRENT TTCIN     @XM05672 45099000
         L     R15,AVTRNMPT             CONVERSION ROUTINE     @XM05672 45100000
         BALR  R14,R15                  CONVERT TO TTE ADDR    @XM05672 45101000
         SLR   R1,R5                    POINT TO NEG PREFIX    @XM05672 45102000
         TM    TRMBYTE1,TRMSTOTE        Q-ALREADY RESET        @XM05672 45103000
         BNZ   CHKSUBST                 N-GO GET SUBSTRUCT     @XM05672 45104000
         ICM   R7,3,TRMCOHRT            CURRENT = COHORT       @XM05672 45105000
         B     TOPLOOP                  GO TO TOP OF LOOP      @XM05672 45106000
CHKSUBST DS    0H                                              @XM05672 45107000
         BAL   R3,COMSWAP               TOFF TOTE FLAG         @XM05672 45108000
         ICM   R7,3,TRMSUBST            GET SUBSTRUCT          @XM05672 45109000
         LTR   R7,R7                    Q-IS SUBSTRUCT ZERO    @XM05672 45110000
         BNZ   TOPLOOP                  N-GO TO TOP OF LOOP    @XM05672 45111000
         ICM   R7,3,TRMCOHRT            CURRENT = COHORT       @XM05672 45112000
         B     TOPLOOP                  GO TO TOP OF LOOP      @XM05672 45113000
HIEREND  DS    0H                                              @XM05672 45114000
         LM    R14,R12,12(R13)          RESTORE REGS           @XM05672 45115000
         BR    R14                      RETURN                 @XM05672 45116000
*                                                              @XM05672 45117000
*        TURN OFF TRMSTOTE BIT USING COMPARE AND SWAP INSTR    @XM05672 45118000
COMSWAP  DS    0H                                              @XM05672 45119000
         L     R10,TRMBYTE2             WORD WITH TRMSTOTE BIT @XM05672 45120000
SWAPLOOP DS    0H                                              @XM05672 45121000
         LR    R11,R10                  COPY WORD              @XM05672 45122000
         N     R11,TOTEOFF              TURN OFF TRMSTOTE      @XM05672 45123000
         CS    R10,R11,TRMBYTE2          AND STORE IN TTE      @XM05672 45124000
         BNE   SWAPLOOP                 BR IF UNSUCCESSFUL     @XM05672 45125000
         BR    R3                       RETURN                 @XM05672 45126000
         DROP  R12                                             @XM05672 45127000
         DROP  R1                                              @XM05672 45128000
         DROP  R4                                              @XM05672 45129000
         USING IEDQWA,R11                                      @Y17XAUV 45156000
         EJECT                                                          56000022
*********************************************************************** 56100022
*                                                                     * 56200022
*        OLT END OF TASK EXIT ROUTINE                                 * 56300022
*                                                                     * 56400022
*********************************************************************** 56500022
         SPACE 2                                                        56600022
OLTETXR  EQU   *                                                        56700022
         STM   R14,R12,D12(R13)   SAVE CALLER'S REGISTERS               56800022
         USING OLTETXR,R15        SET UP BASE REGISTER                  56900022
         L     R11,RESBASE        GET RESIDENT MODULE BASE              57000022
         DROP  R15                DROP BASE REGISTER                    57100022
         USING TCBRBPA,R1         SET UP ADDRESSIBILITY FOR TCB         57200022
         L     R2,RESOBFWD        GET ADDRESS OF FIRST OLTCB IN QUEUE   57300022
ETXR04   EQU   *                                                        57400022
         USING TOTOBPTR,R2        SET UP ADDRESSIBILITY FOR OLTCB       57500022
         CLI   TOTELKEY,QENDKEY   IS IT DUMMY LAST ELEMENT?             57600022
         BE    ETXR08             YES, BRANCH                           57700022
         C     R1,TOTTCBAD        IS THIS THE CORRECT OLTCB?            57800022
         BE    ETXR06             YES, BRANCH                           57900022
         L     R2,TOTELLNK-D1     GET NEXT OLTCB IN QUEUE               58000022
         B     ETXR04             GO EXAMINE NEXT OLTCB                 58100022
ETXR06   EQU   *                                                        58200022
         MVC   TOTCMPCD(D4),TCBCMPA  MOVE TASK COMPLETION CODE TO OLTCB 58300022
         DETACH TOTTCBAD          DETACH SUBTASK                        58400022
         OI    TOTFLG10,TOTOLTED  SET OLT ENDED FLAG                    58500022
         POST  RESTECB1           POST ECB                              58600022
         DROP  R1                 DROP TCB BASE                  S22024 58700000
ETXR08   EQU   *                                                 S22024 58708000
         LM    R14,R12,D12(R13)   RESTORE CALLER'S REGISTERS     S22024 58716000
         BR    R14                RETURN TO CALLER               S22024 58724000
         EJECT                                                          58732000
**************************************************************** S22024 59268000
*                                                              * S22024 59302022
*              OLT STAE EXIT ROUTINE                           * S22024 59304022
*                                                              * S22024 59306022
**************************************************************** S22024 59308022
         SPACE 2                                                        59310022
STAERT   EQU   *                                                 S22024 59312022
         STM   R14,R12,D12(R13)   SAVE CALLER'S REGISTERS        S22024 59314022
         USING STAERT,R15         SET UP BASE                    S22024 59314200
         L     R11,RESBASE        GET RESIDENT MODULE BASE       S22024 59314400
         DROP  R15                DROP BASE REGISTER             S22024 59314600
         LA    R0,D72             GET LENGTH OF SAVE AREA        S22024 59314800
         GETMAIN  R,LV=(0)        GET CORE FOR SAVE AREA         S22024 59315000
         LR    R12,R1             SAVE AREA ADDRESS              S22024 59315200
         ST    R13,D4(R12)        SAVE CALLERS SAVE AREA ADDRESS S22024 59315400
         ST    R12,D8(R13)        SAVE ADDRESS OF STAE SAVE AREA S22024 59315600
         LR    R13,R12            MY SAVE AREA ADDRESS IN REG 13 S22024 59315800
         L     R2,RESOBFWD        GET ADDRESS OF FIRST OLTCB     S22024 59322022
*                                   IN QUEUE                     S22024 59324022
STAERT10 EQU   *                                                 S22024 59326022
         USING TOTOBPTR,R2        SET UP ADDRESSIBILITY FOR OLTCBS22024 59328022
         CLI   TOTELKEY,QENDKEY   IS IT DUMMY LAST ELEMENT?      S22024 59330022
         BE    STAERT30           YES, GO EXIT                   S22024 59332022
         L     R1,SIXTEEN         GET POINTER TO CVT             S22024 59334022
         L     R1,D0(R1)          GET ADDRESS OF TCB POINTERS    S22024 59336022
         L    R1,D4(R1)                GET ACTIVE TCB ADDRESS    S22024 59338000
         C     R1,TOTTCBAD        IS THIS THE CORRECT OLTCB?     S22024 59340022
         BE    STAERT20           YES, BRANCH                    S22024 59342022
         L     R2,TOTELLNK-D1     GET NEXT OLTCB IN QUEUE        S22024 59344022
         B     STAERT10           GO EXAMINE NEXT OLTCB          S22024 59346022
STAERT20 EQU   *                                                 S22024 59348022
         POST  TOTOTECB           POST TOTE SUBTASK ECB          Y06330 59348305
         POST  TOTPRECB           POST PRIMARY DEVICE ECB        Y06330 59348605
         POST  TOTSCECB           POST SECONDARY DEVICE ECB      Y06330 59348905
         TM    $OLTFLGS,$CLEANRT  DOES OLT HAVE A CLEANUP        S22024 59350022
*                                   ROUTINE?                     S22024 59352022
         BNO   STAERT30           NO, RETURN TO ABTERM           S22024 59354022
         OI    $EXECFLG,$CLEANUP  YES, SET SECTION ENTERED FOR   S22024 59356022
*                                   CLEANUP FLAG                 SI2024 59358022
         L     R15,TOTOLTEN       GET OLT ENTRY POINT ADDRESS    S22024 59360000
         L     R15,D12(R15)       GET OLT ACTUAL ENTRY POINT ADDRS22024 59362000
         LA    R1,TOTOLTPL        SET UP PARM LIST ADDRESS       S22024 59364000
         BALR  R14,R15            BRANCH TO OLT                  S22024 59366022
STAERT30 EQU   *                                                 S22024 59368022
         L     R13,D4(R13)             GET CALLERS SAVE AREA     S22024 59369000
         LR    R1,R12             GET ADDRESS OF CORE TO BE FREEDS22024 59369200
         LA    R0,D72             LENGTH OF CORE TO BE FREED     S22024 59369400
         FREEMAIN  R,LV=(0),A=(1)      FREE SAVE AREA            S22024 59369600
         LM    R14,R12,D12(R13)   RESTORE CALLER'S REGISTERS     S22024 59370022
         BR    R14                RETURN TO CALLER               S22024 59372022
         DROP  R2                 DROP OLTCB BASE                S22024 59374022
         DROP  R11                DROP R11 AS MODULE BASE REG  @Y17XAUV 59374600
         USING IEDQWA,R12         RESTORE R12 AS MODULE BASE   @Y17XAUV 59375200
         EJECT                                                          59376022
**************************************************************** S22024 59378022
*                                                                       59400022
*        SERVICE MODULE MANAGER                                @Y17XAUV 59500000
*                                                                       59600022
*********************************************************************** 59700022
*                                                                       59800022
SMGR     EQU   *                                                        59900022
*                                                                       60000022
*        PERFORM INITIALIZATION                                         60100022
*                                                                       60200022
         STM   R14,R12,D12(R13)   SAVE CALLER'S REGISTERS               60300022
         USING TOTOLTCB,R2        SET UP ADDRESSIBILITY FOR OLTCB       60320022
         ST    R14,TOTSMGRT       SAVE CALLER'S RETURN ADDRESS          60340022
*                                   TO BE USED BY THE SERVICE MODULE    60360022
         USING SMGR,R15                                                 60380022
         L     R12,RESBASE        SET UP BASE REGISTER                  60400000
         DROP  R15                                                      60420022
         ST    R1,TOTPARML        SAVE ADDRESS OF PARAMETER     SA41612 60440022
*                                   LIST                        SA41612 60450022
         LA    R5,TOTSAVE3        GET SERVICE MANAGER SAVE AREA         60460022
*                                   ADDRESS                             60480022
         ST    R13,D4(R5)         SAVE ADDRESS OF CALLER'S SAVE AREA    60500022
         ST    R5,D8(R13)         SAVE ADDRESS OF SERVICE MANAGER'S     60520022
*                                   SAVE AREA                           60540022
         LR    R13,R5             PUT SAVE AREA ADDRESS INTO REG 13     60560022
         SPACE 2                                                        60580022
         TM    TOTFLG06,TOTWACAN  IS CANCEL REQUEST PENDING FLAG SET?   60600022
         BZ    XMGR00             NO, BRANCH                            60620022
         NI    TOTFLG06,XFF-TOTWACAN  YES, TURN OFF CANCEL REQUEST      60640022
*                                       PENDING FLAG                    60660022
SMGR002  EQU   *                                                        60680022
         TM    $OLTFLGS,$CLEANRT  DOES OLT HAVE A CLEANUP ROUTINE?      60700022
         BNO   EXIT               NO, BRANCH TO IEDQWF                  60720022
         OI    $EXECFLG,$CLEANUP  YES, SET SECTION ENTERED FOR          60740022
*                                   CLEANUP FLAG                        60760022
         L     R3,TOTOLTEN        GET START OF OLT               S05331 60761000
         USING PSPREF,R3          SET UP BASE FOR SECTION PREFACES05331 60762000
         LH    R14,RTNDISP        GET DISPLACEMENT TO ROUTINE    S05331 60763000
         AR    R14,R3             GET ADDRESS OF ROUTINE         S05331 60764000
         USING SPREF,R14          SET UP BASE FOR RTN PREFACE    S05331 60765000
         TM    #FLAG,#MSGIDRQ     MESSAGE ID PROVIDED?           S05331 60766000
         BZ    NOID               NO, BRANCH                     S05331 60767000
         MVC   $MSGIDAC(D2),MSGID MOVE ID FROM SECTION PREFACE   S05331 60768000
*                                   TO SCT                       S05331 60769000
NOID     EQU   *                                                 S05331 60770000
         LA    R13,TOTSAVE4       GET ADDRESS OF IEDQWF'S SAVE AREA     60780022
         LM    R14,R12,D12(R13)   RESTORE IEDQWF'S REGISTERS            60800022
         BR    R15                BRANCH TO OLT                         60820022
         SPACE 1                                                        60840022
EXIT     EQU   *                                                        60860022
         LA    R13,TOTSAVE4       GET TEST CONTROL SAVE ADDRESS         60880022
         LM    R14,R12,D12(R13)   RESTORE TEST CONTROL REGISTERS        60900022
         LA    R15,D1             SET RETURN CODE TO 1                  60920022
         BR    R14                RETURN TO IEDQWF TO CANCEL TEST       60940022
*                                   FOR TERMINATION                     60960022
         SPACE 1                                                        60980022
XMGR00   EQU   *                                                        61000022
         LR    R5,R1              SAVE PARAMETER LIST ADDRESS           61020022
         USING XMGRPARM,R5        SET UP ADDRESSIBILITY FOR PARM LIST   61040022
*                                                                       61060022
         TM    TOTFLG02,XFF       ARE ANY SERVICE FLAGS SET?            61080022
         BZ    RTN005             NO, BRANCH                     S22024 61100000
SMGR02   EQU   *                                                        61120022
         TM    TOTFLG06,TOTNCMFG  NON-CONCURRENT MODE ASKED?            61140022
         BO    RTN005             YES, BYPASS START LINE                61160022
         L     R8,TOTPARML              GET PARM LIST ADDR     @YA11128 61165058
         CLC   D2(D2,R8),MODRTN         IS THIS A ROUTINE MACRO@Y17XAUV 61170000
         BE    RTN005                   LET QW47 DO STARTLINE  @YA11128 61175058
         TM    $TOTFLG1,$LINESHR  IS LINE SHARING REQUESTED?            61180022
         BZ    RTN005             NO, DO NOT START LINE                 61200022
         USING IOBLOCKS,R7        SET UP ADDRESSIBILITY FOR IOBLOCKS    61220022
         L     R7,TOTSAVE5        GET ADDRESS OF CURRENT        SA41599 61224022
*                                   PRIMARY TEST DEVICE         SA41599 61228022
         TM    D0(R7),TOTTDLST    WAS LINE INITIALLY STOPPED?   SA41599 61232022
         BO    RTN005             YES, DO NOT START LINE        SA41599 61236022
         TM    D0(R7),TOTTDORN    IS TEST DEVICE ON 3705?        S22024 61237000
         BO    RTN005             YES, BYPASS STARTLINE          S22024 61238000
         LA    R7,TOTPRIBK        SET UP TO START PRIMARY LINE          61240022
         BAL   R8,STRTLINE        START PRIMARY LINE                    61260022
         B     RTN004A            SEE IF SECONDARY LINE SHOULD          61280022
*                                   BE STARTED                          61300022
         SPACE 2                                                        61320022
*********************************************************************** 61340022
*                                                                     * 61360022
*        START LINE VIA TCAM'S OP-CONTROL FACILITY                    * 61380022
*                                                                     * 61400022
*********************************************************************** 61420022
STRTLINE EQU   *                                                        61440022
         STM   R6,R12,STRTSAVE    SAVE REGS DURING STARTLINE            61460022
         MVI   TOTOVBCD,LINESTRT  MOVE IN STARTLINE VERB CODE    S22024 61480000
         L     R6,TOTAVTPT        GET ADDRESS OF AVT                    61500022
         USING IEDQAVTD,R6        SET UP ADDRESSIBILITY FOR AVT         61520022
         LA    R10,AVTOPCOB       GET POINTER TO OP CONTROL QCB         61540022
         ST    R10,TOTOKEY        PUT IN PARAMETER LIST          S22024 61560000
         MVI   TOTOKEY,OPCKEY     SET KEY TO ZERO                S22024 61564000
         MVI   TOTOELNG,OPCELNG   SET ELEMENT LENGTH TO X'18'    S22024 61568000
         MVI   TOTOPRI,OPCPRI     SET OP CONTROL PRIORITY OF 'DC'S22024 61572000
         MVI   TOTORTCD,OPCRTCD   ZERO OUT RETURN CODE FIELD     S22024 61576000
         DROP  R6                 DROP AVT BASE                         61580022
         MVC   TOTORLN,OLTTCRLN   MOVE IN RELATIVE LINE NUMBER   S22024 61600000
         SLR   R6,R6              CLEAR                        @G36XRUV 61610000
         ICM   R6,D3,OLTUCBA      GET ADDRESS OF UCB           @G36XRUV 61620000
         LTR   R6,R6              IS THERE A VALID UCB ADDRESS?         61640022
         BZ    RTN005             NO, DON'T TRY TO ISSUE STARTLINE      61660022
         USING UCB,R6             SET UP ADDRESSIBILITY FOR UCB         61680022
         MVI   TOTOLADR,BLANK     MOVE BLANK INTO NAME FIELD     S22024 61700000
         MVC   TOTOLADR+D1(D7),TOTOLADR  BLANK OUT NAME FIELD    SI2024 61706000
         MVC   TOTOLADR(D3),UCBNAME  GET UNIT NAME               S22024 61712000
         DROP  R6                 DROP UCB BASE                         61720022
         LA    R1,TOTOTECB        GET TOTE ECB ADDRESS                  61740022
         ST    R1,TOTOECBA        PUT IT IN PARAMETER LIST       S22024 61760000
         LA    R1,TOTPLIST        GET ADDRESS OF OPERATOR CONTROLS22024 61765000
*                                   PARAMETER LIST               S22024 61770000
         ST    R1,ELEM1           STROE ADDRESS IN 1ST WORD OF   S22024 61775000
*                                   SVC 102 POST LIST            S22024 61780000
         ST    R1,ELEM2           STORE ADDRESS IN 2ND WORD OF   S22024 61785000
*                                   SVC 102 POST LIST            S22024 61790000
         MVI   ELEM1,START        SET SVC 102 ACTION CODE        S22024 61795000
         MVI   ELEM2,EIGHTY       SET END OF LIST INDICATOR      S22024 61800000
         XC    TOTOLINK(D3),TOTOLINK  CLEAR REQUEST ELEMENT      S22024 61805000
*                                       LINK FIELD               S22024 61810000
         LA    R1,ELEM1                 POINT TO SVC POST LIST @YA11128 61815058
         XC    TOTOTECB(D4),TOTOTECB  CLEAR TOTE ECB                    61820022
         AQCTL                    POST ELEMENT TO OPERATOR CONTROL      61840022
         WAIT  ECB=TOTOTECB       WAIT ON OPERATOR CONTROL TO          X61860022
                                    HONOR REQUEST                       61880022
         SPACE 1                                                        61900022
         LM    R6,R12,STRTSAVE    RESTORE REGS FROM STARTLINE           61920022
         BR    R8                 RETURN TO CALLER                      61940022
         SPACE 1                                                        61960022
RTN004A  EQU   *                                                        61980022
         L     R7,TOTGRABP        GET ADDRESS OF CURRENT        SA41599 61984022
*                                   SECONDARY TEST DEVICE       SA41599 61988022
         TM    D0(R7),TOTTDLST    WAS LINE INITIALLY STOPPED?   SA41599 61992022
         BO    RTN005             YES, DO NOT START LINE        SA41599 61996022
         TM    D0(R7),TOTTDORN    IS TEST DEVICE ON 3705?        S22024 61997000
         BO    RTN005             YES, BYPASS STARTLINE          S22024 61998000
         LA    R7,TOTSCIBK        SET UP TO START SECONDARY LINE        62000022
         BAL   R8,STRTLINE        START SECONDARY LINE                  62020022
         DROP  R7                 DROP IOBLOCKS BASE                    62040022
         SPACE 2                                                        62060022
RTN005   EQU   *                                                        62080022
         NI    $TOTFLG1,XFF-$LINESHR    TURN OFF LINE SHARE    @YA11128 62100058
         LA    R8,TOTSERV         ADDR OF SERVICE MOD WORKAREA @Y17XAUV 62100500
         LR    R10,R8             COPY                         @Y17XAUV 62100700
         LA    R9,L'TOTSERV       LENGTH OF WORKAREA           @Y17XAUV 62100900
         SR    R11,R11            MOVE OF 0 AND PAD OF 0       @Y17XAUV 62101100
         MVCL  R8,R10             CLEAR WORKAREA               @Y17XAUV 62101300
         SPACE 1                                               @Y17XAUV 62101500
*        FIND ADDR OF SERVICE ROUTINE IN RESPL AND BALR        @Y17XAUV 62102000
         SPACE 1                                               @Y17XAUV 62102500
         SR    R8,R8              CLEAR LOOP CONTROL REG       @Y17XAUV 62103000
         LA    R9,MODIDTAB        ADDR OF MODULE ID TABLE      @Y17XAUV 62103500
         LA    R10,MODIDEND       ADDR OF END OF TABLE         @Y17XAUV 62104000
         USING MODIDMAP,R9        BASE TABLE ENTRY DSECT       @Y17XAUV 62104500
CHKLOOP  DS    0H                 LOOP UNTIL FIND ID MATCH OR  @Y17XAUV 62105000
*                                  REACH END OF TABLE          @Y17XAUV 62105500
         LTR   R8,R8              TERMINATE LOOP ?             @Y17XAUV 62106000
         BP    EXITOLT            Y - GO RETURN TO OLT         @Y17XAUV 62106500
         CR    R9,R10             END OF TABLE REACHED ?       @Y17XAUV 62107000
         BNE   CHKID              N - CHECK FOR ID MATCH       @Y17XAUV 62107500
         LA    R8,1               SET TO EXIT LOOP             @Y17XAUV 62108000
         B     ENDCHKLP           BRANCH TO END OF LOOP        @Y17XAUV 62108500
CHKID    DS    0H                 CHECK FOR ID MATCH           @Y17XARV 62109000
         CLC   MODID(L'MODID),XMGRCODE                         @Y17XAUV 62109500
*                                 IS ENTRY IN MODULE ID TABLE  @Y17XAUV 62110000
*                                  THE SAME AS ID IN PARM LIST?@Y17XAUV 62110500
         BE    FNDMATCH           Y - GO CALL SERVICE MODULE   @Y17XAUV 62111000
         LA    R9,D3(R9)          INCREMENT MODULE ID TAB      @Y17XAUV 62111500
*                                  ENTRY POINTER               @Y17XAUV 62112000
         B     ENDCHKLP           BRANCH TO END OF LOOP        @Y17XAUV 62112500
FNDMATCH DS    0H                 FOUND MATCH                  @Y17XAUV 62113000
         LA    R8,1               SET TO GET OUT OF LOOP       @Y17XAUV 62113500
         LA    R10,RESPLADR       LOAD ADDR OF SERVICE MODULE  @Y17XAUV 62114000
*                                  ADDR LIST IN RESPL          @Y17XAUV 62114500
         SR    R7,R7              CLEAR AND                    @Y17XAUV 62115000
         IC    R7,MODINDEX         OBTAIN OFFSET INTO ADDR     @Y17XAUV 62115500
*                                  LIST FOR THIS MODULE        @Y17XAUV 62116000
         AR    R10,R7             POINT TO ENTRY IN LIST FOR   @Y17XAUV 62116500
*                                  THIS MODULE                 @Y17XAUV 62117000
         L     R15,D0(R10)        LOAD ENTRY POINT FOR SERVICE @Y17XAUV 62117500
*                                  MODULE                      @Y17XAUV 62118000
         L     R1,TOTPARML        RESIDENT PARAMETER LIST      @Y17XAUV 62118200
         BALR  R14,R15            CALL SERVICE MODULE          @Y17XAUV 62118500
ENDCHKLP DS    0H                 END OF LOOP                  @Y17XAUV 62119000
         B     CHKLOOP            BRANCH TO TOP OF LOOP        @Y17XAUV 62119500
         DROP  R9                                              @Y17XAUV 62319500
         SPACE 1                                                        62540022
EXITOLT  EQU   *                                                        62560022
         L     R13,D4(R13)        GET CALLER'S SAVE AREA ADDRESS        62580022
         L     R14,TOTSMGRT       RESTORE CALLER'S RETURN ADDRESS       62600022
         LM    R2,R12,D28(R13)    RESTORE CALLER'S REGISTERS            62620022
         BR    R14                RETURN TO CALLER                      62640022
         DROP  R2                 DROP OLTCB BASE                       62660022
         EJECT                                                          63800022
*********************************************************************** 63900022
*                                                                     * 64000022
*        TOTE QUEUE HANDLERS                                          * 64100022
*                                                                     * 64200022
*********************************************************************** 64300022
         SPACE 5                                                        64400022
QADDND   EQU   *                                                        64500022
         LA    R15,QADDNDX        SET UP QUEUE HANDLER BASE             64600022
QADDNDX  EQU   *                                                        64700022
*                                                                       64800022
*        ADD ELEMENT TO END OF QUEUE                                    64900022
*             INPUT   REGISTER R2 POINTS TO ELEMENT TO BE ADDED         65000022
*                                                                       65100022
         USING QADDNDX,R15                                              65200022
         USING QEL,R2                                                   65300022
         L     R1,QELQCB-D1       GET QCB ADDRESS                       65400022
         DROP  R2                                                       65500022
QADDE20  EQU   *                                                        65600022
         USING TQCB,R1                                                  65700022
         L     R3,TQCBLINK-D1     GET NEXT ELEMENT ADDRESS              65800022
         LA    R3,D0(R3)          CLEAR HIGH ORDER BYTE          S22024 65850000
         USING QEL,R3                                                   65900022
         LTR   R3,R3              IS LINK FIELD ZERO?                   65920022
         BZ    QADD40             YES, GO ADD NEW ELEMENT               65940022
*                                   TO QUEUE                            65960022
         CLI   QELKEY,QENDKEY     IS IT DUMMY LAST ELEMENT?             66000022
         BE    QADD40             YES, GO ADD NEW ELEMENT               66100022
*                                   TO QUEUE                            66200022
         DROP  R1                                                       66300022
         LA    R1,QELLINK-D1      NO, GET ADDRESS OF LINK FIELD         66400022
         DROP  R3                                                       66500022
         B     QADDE20            BRANCH BACK AND EXAMINE NEXT ELEMENT  66600022
         DROP  R15                                                      66700022
         SPACE 5                                                        66800022
QADDAF   EQU   *                                                        66900022
         LA    R15,QADDAFX        SET UP QUEUE HANDLER BASE             67000022
QADDAFX  EQU   *                                                        67100022
*                                                                       67200022
*        INSERT AFTER SPECIFIED ELEMENT                                 67300022
*                                                                       67400022
         USING QADDAFX,R15                                              67500022
QADD40   EQU   *                                                        67600022
         USING QEL,R2                                                   67700022
         USING TQCB,R1                                                  67800022
         MVC   QELLINK(D3),TQCBLINK  SET NEW ELEMENT LINK FIELD         67900022
         STCM  R2,D7,TQCBLINK     SET PREVIOUS LINK FIELD      @G36XRUV 68100000
         BR    R10                RETURN TO CALLER                      68300022
         DROP  R15                                                      68400022
         SPACE 5                                                        68500022
QREMEL   EQU   *                                                        68600022
         LA    R15,QREMELX        SET UP QUEUE HANDLER BASE             68700022
QREMELX  EQU   *                                                        68800022
*                                                                       68900022
*        REMOVE DESIGNATED ELEMENT FROM QUEUE                           69000022
*             INPUT   REGISTER R2 CONTAINS ELEMENT ADDRESS              69100022
*             OUTPUT  REGISTER R2 CONTAINS ELEMENT ADDRESS              69200022
*                                                                       69300022
         USING QREMELX,R15                                              69400022
         LR    R3,R2              SAVE ELEMENT ADDR FOR COMPARE         69500022
         USING QEL,R3                                                   69600022
         L     R1,QELQCB-D1       GET QCB ADDRESS                       69700022
         DROP  R3                                                       69800022
QREMA20  EQU   *                                                        69900022
         USING TQCB,R1                                                  70000022
         L     R2,TQCBLINK-D1     GET NEXT ELEMENT ADDRESS              70100022
         USING QEL,R2                                                   70200022
         LA    R2,D0(R2)          CLEAR HIGH ORDER                      70300022
         LA    R3,D0(R3)            BYTES FOR COMPARE                   70400022
         CR    R2,R3              IS IT THE CORRECT ELEMENT?            70500022
         BE    QREM40             YES, GO REMOVE IT FROM QUEUE          70600022
         LA    R1,QELLINK-D1      NO, GET ADDRESS OF LINK FIELD         70700022
         B     QREMA20            GO EXAMINE NEXT ELEMENT               70800022
         DROP  R1                                                       70900022
         DROP  R2                                                       71000022
         DROP  R15                                                      71100022
         SPACE 5                                                        71200022
QREMFR   EQU   *                                                        71300022
         LA    R15,QREMFRX        SET UP QUEUE HANDLER BASE             71400022
QREMFRX  EQU   *                                                        71500022
*                                                                       71600022
*        REMOVE FIRST ELEMENT FROM QUEUE                                71700022
*             INPUT   REGISTER R1 CONTAINS QCB ADDRESS                  71800022
*             OUTPUT  REGISTER R2 CONTAINS REMOVED ELEMENT              71900022
*                                                                       72000022
         USING QREMFRX,R15                                              72100022
         USING TQCB,R1                                                  72200022
         L     R2,TQCBLINK-D1     GET NEXT ELEMENT ADDRESS              72300022
         USING QEL,R2                                                   72400022
         CLI   QELKEY,QENDKEY     IS IT DUMMY LAST ELEMENT?             72500022
         BNE   QREM40             NO, REMOVE FROM QUEUE                 72600022
*                                 YES, SET ERROR CODE                   72700022
         DROP  R1                                                       72800022
         DROP  R2                                                       72900022
         SPACE 5                                                        73000022
QREM30   EQU   *                                                        73100022
         LA    R1,QERROR          SET ERROR CODE                        73200022
         BR    R10                RETURN TO CALLER                      73300022
         SPACE 5                                                        73400022
QREM40   EQU   *                                                        73500022
         USING QEL,R2                                                   73600022
         USING TQCB,R1                                                  73700022
         MVC   TQCBLINK(D3),QELLINK REMOVE ELEMENT FROM QUEUE           73800022
         DROP  R1                                                       73900022
         DROP  R2                                                       74000022
         BR    R10                RETURN TO CALLER                      74100022
         DROP  R15                                                      74200022
         EJECT                                                          74300022
RESPL    RESPL DSECT=NO,EQUATES=NO                                      74400022
         EJECT                                                          74600022
REGSAVE  DS    18F                REGISTER SAVE AREA                    74700022
RESBASE  DC    A(IEDQWA)          THIS MODULE BASE ADDRESS              74800022
ELEM1    DS    F                  POINTER TO 1ST ELEMENT         S22024 77630000
ELEM2    DS    F                  POINTER TO 2ND ELEMENT         S22024 77640000
STRTSAVE DS    7F                 SAVE AREA FOR START LINE       S22024 77650000
*                                   ROUTINE                      S22024 77660000
         SPACE                                                          77690022
TOTEOFF  DS    0F                 USED TO COMPARE AND SWAP     @XM05672 77690600
         DC    X'FF'                    TRMSTOTE OFF           @XM05672 77691200
         DC    AL1(255-TRMSTOTE)                               @XM05672 77691800
         DC    X'FFFF'                                         @XM05672 77692400
WORD0    DC    XL4'00000000'      WORD OF ZEROS                @Y17XAUV 77693000
         DS    0H                 ALIGNMENT                    @Y17XAUV 77696000
CHKTIC   TM    INVALTIC,D0        USED TO CHECK FOR INVALID TIC@Y17XAUV 77699000
CLRINSTR XC    D12(D0,R6),D12(R6) CLEAR UNIT                   @Y17XAUV 77702000
INVALTIC DC    XL1'03'            BITS INDICATING INVALID TIC  @Y17XAUV 77705000
ERBCODE  DC    XL1'C0'            ERB CODE FOR POSTWAIT ROUTINE@Y17XAUV 77708000
CODEREQ  DC    XL1'80'            CODE FOR GEN REQEST ELEMENT  @Y17XAUV 77711000
PATCH    DC    CL90' '            MAINTAINANCE AREA                     77720005
         EJECT                                                          77750022
*********************************************************************** 77810000
*                                                                     * 77870000
*        MODULE ID TABLE                                              * 77930000
*                                                                     * 77990000
*********************************************************************** 78050000
MODAB    EQU   RESPLAB-RESPLADR                                @Y17XAUV 78052000
MODAJ    EQU   RESPLAJ-RESPLADR                                @Y17XAUV 78054000
MOD35    EQU   RESPL35-RESPLADR                                @Y17XAUV 78056000
MODAA    EQU   RESPLAA-RESPLADR                                @Y17XAUV 78058000
MOD39    EQU   RESPL39-RESPLADR                                @Y17XAUV 78060000
MODP1    EQU   RESPLP1-RESPLADR                                @Y17XAUV 78062000
MODP2    EQU   RESPLP2-RESPLADR                                @Y17XAUV 78064000
MOD37    EQU   RESPL37-RESPLADR                                @Y17XAUV 78066000
MOD28    EQU   RESPL28-RESPLADR                                @Y17XAUV 78068000
MOD36    EQU   RESPL36-RESPLADR                                @Y17XAUV 78070000
MODAC    EQU   RESPLAC-RESPLADR                                @Y17XAUV 78072000
MOD21    EQU   RESPL21-RESPLADR                                @Y17XAUV 78074000
MOD41    EQU   RESPL41-RESPLADR                                @Y17XAUV 78076000
MOD16    EQU   RESPL16-RESPLADR                                @Y17XAUV 78078000
MOD42    EQU   RESPL42-RESPLADR                                @Y17XAUV 78080000
MOD43    EQU   RESPL43-RESPLADR                                @Y17XAUV 78082000
MOD44    EQU   RESPL44-RESPLADR                                @Y17XAUV 78084000
MOD47    EQU   RESPL47-RESPLADR                                @Y17XAUV 78086000
MODM2    EQU   RESPLM2-RESPLADR                                @Y17XAUV 78088000
MOD25    EQU   RESPL25-RESPLADR                                @Y17XAUV 78090000
MOD33    EQU   RESPL33-RESPLADR                                @Y17XAUV 78092000
MODIDTAB DS    0H                 EACH ENTRY CONTAINS MODULE ID@Y17XAUV 78110000
*                                  AND OFFSET INTO RESPL       @Y17XAUV 78170000
*                                  SERVICE MOD ADDR LIST       @Y17XAUV 78230000
         DC    CL2'AB',AL1(MODAB) DATE ROUTINE                 @Y17XAUV 78290000
         DC    CL2'AJ',AL1(MODAJ) $CUTEST ROUTINE              @Y17XAUV 78350000
         DC    CL2'35',AL1(MOD35) EXIO ROUTINE                 @Y17XAUV 78410000
         DC    CL2'AA',AL1(MODAA) TIME ROUTINE                 @Y17XAUV 78470000
         DC    CL2'39',AL1(MOD39) DPRINT ROUTINE LOAD 1        @Y17XAUV 78530000
         DC    CL2'P1',AL1(MODP1) DPRINT ROUTINE LOAD 2        @Y17XAUV 78590000
         DC    CL2'P2',AL1(MODP2) DPRINT ROUTINE LOAD 3        @Y17XAUV 78650000
         DC    CL2'37',AL1(MOD37) CECOM ROUTINE                @Y17XAUV 78710000
         DC    CL2'28',AL1(MOD28) PLINK ROUTINE                @Y17XAUV 78770000
         DC    CL2'36',AL1(MOD36) WAITIO ROUTINE               @Y17XAUV 78830000
         DC    CL2'AC',AL1(MODAC) $GRAB ROUTINE                @Y17XAUV 78890000
         DC    CL2'21',AL1(MOD21) $LETGO ROUTINE               @Y17XAUV 78950000
         DC    CL2'41',AL1(MOD41) CONVERT ROUTINE              @Y17XAUV 79010000
         DC    CL2'16',AL1(MOD16) GETCONFIG ROUTINE            @Y17XAUV 79070000
         DC    CL2'42',AL1(MOD42) MORECORE ROUTINE             @Y17XAUV 79130000
         DC    CL2'43',AL1(MOD43) FREECORE ROUTINE             @Y17XAUV 79190000
         DC    CL2'44',AL1(MOD44) DIO ROUTINE                  @Y17XAUV 79250000
MODRTN   DC    CL2'47',AL1(MOD47) ROUTINE ROUTINE              @Y17XAUV 79310000
         DC    CL2'M2',AL1(MODM2) TRACE/RETURN CODE ROUTINE    @Y17XAUV 79370000
         DC    CL2'25',AL1(MOD25) SEND ROUTINE                 @Y17XAUV 79430000
         DC    CL2'33',AL1(MOD33) RECEIVE ROUTINE              @Y17XAUV 79490000
MODIDEND EQU   *                                               @Y17XAUV 79550000
         SPACE 2                                               @Y17XAUV 79580000
         SPACE 2                                               @Y17XAUV 79610000
*********************************************************************** 79670000
*                                                                     * 79730000
*        MODULE ID TABLE ENTRY MAP                             @Y17XAUV 79790000
*                                                                     * 79850000
*********************************************************************** 79910000
MODIDMAP DSECT                                                 @Y17XAUV 79970000
MODID    DS    CL2                MODULE ID                    @Y17XAUV 80030000
MODINDEX DS    CL1                INDEX INTO RESPL ADDR LIST   @Y17XAUV 80090000
         EJECT                                                          80150000
TQCB     DSECT                                                          80400022
TQCBKEY  DS    C .           QCB KEY FIELD                              80500022
TQCBLINK DS    AL3 .         QUEUE CONTROL BLOCK LINK FIELD             80600022
         SPACE 5                                                        80700022
QEL      DSECT                                                          80800022
QELKEY   DS    C .           QUEUE ELEMENT KEY                          80900022
QELQCB   DS    AL3 .         ADDRESS OF QCB                             81000022
         DS    C                  UNUSED                                81100022
QELLINK  DS    AL3 .         ELEMENT LINK FIELD                         81200022
QELSIZE  DS    H .           ELEMENT SIZE                               81300022
*                                                                       81400022
QENDKEY  EQU   X'00' .       DUMMY LAST ELEMENT KEY                     81500022
QERROR   EQU   X'FF' .       QUEUE HANDLER ERROR CODE                   81600022
         SPACE 3                                                        81602000
PSPREF   DSECT                    SECTION PREFACE                S05331 81604000
SECTID   DS    CL8                SECTION ID                     S05331 81606000
LEVEL    DS    CL2                LEVEL                          S05331 81608000
RTNDISP  DS    AL2                DISPLACEMENT TO RTN #          S05331 81610000
INST     DS    A                  POINTER TO FIRST EXECUTABLE    S05331 81612000
*                                   INSTRUCTION                  S05331 81614000
MSGID    DS    CL2                OLT COMPONENT ID               S05331 81616000
         SPACE 3                                                        81618000
SPREF    DSECT                    ROUTINE PREFIX                 S05331 81620000
RTN#     DS    CL1                ROUTINE NUMBER                 S05331 81622000
         DS    CL15               SECTION PREFACE FLAGS/DATA     S05331 81624000
#FLAG    DS    CL1                FLAGS                          S05331 81626000
#MSGIDRQ EQU   X'10'              MESSAGE ID PROVIDED            S05331 81628000
         EJECT                                                          81630000
**************************************************************** S05331 81632000
*                                                              * S05331 81634000
*        CONTROL TERMINAL OR ALTERNATE PRINTER DEVICE ENTRY    * S05331 81636000
*                                                              * S05331 81638000
**************************************************************** S05331 81640000
         SPACE 2                                                        81642000
DEVENTRY DSECT                    DEVICE ENTRY DSECT             S05331 81644000
ENTUCB   DS    AL2                UCB ADDRESS                    S05331 81646000
ENTRSID  DS    H                  RESOURCE ID OF DEVICE          S05331 81648000
ENTRLN   DS    C                  RELATIVE LINE NUMBER           S05331 81650000
ENTLCB   DS    AL3                LCB ADDRESS                    S05331 81652000
ENTTNT   DS    F                  TERMINAL NAME TABLE ENTRY      S05331 81654000
*                                   ADDRESS (DUMMY ENTRY)        S05331 81656000
ENTRTNT  DS    F                  TERMINAL NAME TABLE ENTRY      S05331 81658000
*                                   ADDRESS (REAL ENTRY)         S05331 81660000
ENTTLN   DS    H                  LENGTH OF TTE AREA             S05331 81662000
ENTFLAG  DS    C                  FLAGS                          S05331 81664000
ENTASN   EQU   X'80'              DUMMY ENTRY ASSIGNED           S05331 81666000
ENTORN   EQU   X'40'              DEVICE ON A 3705               S05331 81668000
ENTACT   EQU   X'20'              ACTIVATE REQUIRED              S05331 81670000
ENTSTR   EQU   X'10'              START LINE REQUIRED            S05331 81672000
ENTDISC  EQU   X'08'              DISCONNECT SESSION REQUIRED    S05331 81674000
ENTRESET EQU   X'04'              RESET ERROR LOCK REQUIRED      S05331 81676000
ENT1RS   EQU   X'02'              FIRST RESET ERROR LOCK ISSUED  S05331 81678000
         EJECT                                                          81700022
TCBRBPA  DSECT                                                          81800022
         DS    4F                 UNUSED                                81900022
TCBCMPA  DS    F             TASK COMPLETION CODE                       82000022
         DS    2F                 UNUSED                                82100022
         DS    C                  UNUSED                                82200022
TCBFLGSA DS    5C            TCB FLAGS                                  82300022
ABEND    EQU   X'80'                   ABEND CODE                       82400022
         ORG   TCBRBPA+X'71'      RESET INSTRUCTION COUNTER             82500022
TCBFSAA  DS    AL3(0)        ADDRESS OF 1ST PROGRAM SAVE AREA           82600022
         EJECT                                                          82700022
*                                                                       82800022
*        TRANSIENT MANAGER PARAMETERS                                   82900022
*                                                                       83000022
XMGRPARM DSECT                                                          83100022
XMGRIND  DS    CL1                TRANSIENT MANAGER INDICATORS          83200022
XMGRLEV  DS    CL1                MACRO LEVEL                           83300022
XMGRCODE DS    CL2                MODULE CODE                           83400022
         SPACE 5                                                        83407022
         EJECT                                                          83500022
         TAVTD                                                          83600022
         EJECT                                                          83700022
         TPRFD                                                          83800022
         EJECT                                                          83820022
         TTRMD                                                          83830022
         EJECT                                                          83840022
         TQCBD                                                   S99528 83860022
         EJECT                                                          83900022
         OLTCB POINTER=YES                                              84000022
         EJECT                                                          84100022
         TSCBD                                                          84300022
         EJECT                                                          84600022
         TLCBD                                                          84610022
         EJECT                                                          84612000
         TTTCD                                                          84614000
         EJECT                                                          84616000
         TREQD                                                          84618000
         EJECT                                                          84620022
         TTCBD                                                          84630022
         EJECT                                                          84640022
         IOBLOCKS                                                       84650022
         EJECT                                                   S99528 84660022
UCB      DSECT                                                          84680022
         IEFUCBOB                                                       84700022
         CVT                      CVT DSECT                      S22024 84710000
         EJECT                                                   S99528 84720022
         TPRIOR                                                         84800022
         EJECT                                                          85800000
         TTNTD                    TERMNAME TABLE DSECT           Y06330 90800005
         EJECT                                                          93800005
         END                                                            96800005
