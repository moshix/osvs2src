         TITLE 'IEDQWC1 TRM ANALYSIS MODULE 2'                          00080000
IEDQWC1  CSECT                                                          00240000
*A000000-999999                                                @Y16X5U0 00260000
* CHANGE ACTIVITY AS FOLLOWS:                                           00320000
*D129000,556400-556600                                           S21903 00400000
*A552500                                                        SA41597 00480000
*A158000                                                        SA41614 00560000
*C000000,999999                                                  S22024 00600000
*C264000,357600-373600,397600,403200,408800-412000             @YA12402 00600158
*D272800-273600,278400-280000,283200,319200-350400,405600      @YA12402 00600258
*D416000                                                       @YA12402 00600358
*A297600,356000,400800,401600,424000                           @YA12402 00600458
*C802400-806400                                                @OY12987 00602400
*D812900-813300                                                @OY12987 00604400
*D502000                                                       @OY12987 00606400
*A191200,466400,472000,500000,532800,622400,688800,801600      @Y17XAUU 00609400
*A803200,832800                                                @Y17XAUU 00618400
*C812900,813600,824000                                         @Y17XAUU 00627400
* A006274,139200,424330,424570,424450,880000                   @G36XRUV 00629410
* C424360                                                      @G36XRUV 00631410
* D424600-424750,424420,424480                                 @G36XRUV 00633410
*                                                                       00635410
****************************************************************        00640000
*                                                              *        00720000
* MODULE NAME = IEDQWC1 (TCAM,TOTE)                            @Y17XAUU 00740000
*                                                              *        01040000
* DESCRIPTIVE NAME = TRM ANALYSIS MODULE 2                     *        01120000
*                                                              *        01200000
* COPYRIGHT = NONE                                             *        01280000
*                                                              *        01360000
* STATUS --                                                    *        01440000
*                                                              *        01520000
*    VERSION 10.0                                              @Y17XAUU 01600000
*                                                              *        01680000
*                                                              *        01760000
* FUNCTIONS --                                                 *        01840000
*                                                              *        01920000
*    THE PURPOSE OF THIS MODULE IS TO ANALYZE THE TEST DEVICE  *        02000000
*    FIELD OF THE TEST REQUEST MESSAGE (TRM).                  *        02080000
*                                                              *        02160000
*    CONTROL IS PASSED FROM IEDQWC WITH TRM IN THE OLTCB.      *        02240000
*    THE TEST DEVICE FIELD IS CHECKED FOR VALID SYMBOLIC       *        02320000
*    NAMES OR LINE ADDRESSES (CUU).                            *        02400000
*                                                              *        02480000
*    IF THE ENTRY IS VALID THE UCB OR TNT OF THE ENTRY IS      *        02560000
*    SAVED IN THE OLTCB. IF ANY ENTRY IS INVALID, THE TRM      *        02640000
*    PROMPTER (IEDQWJ) IS CALLED.                              *        02720000
*                                                              *        02800000
* PURPOSE -- SEE FUNCTION                                      @Y17XAUU 02820000
*                                                              *        02880000
* ENTRY POINTS --                                              *        02960000
*                                                              *        03040000
*    IEDQWC1                                                   @Y17XAUU 03120000
*                                                              *        03200000
* LINKAGE -- CALLED BY IEDQWB1 AND IEDQWH TO PROCESS           @Y17XAUU 03200600
*             TEST DEVICE FIELD OF TRM.                        @Y17XAUU 03201200
*                                                              @Y17XAUU 03201800
* MODULE SIZE -- MAXIMUM 4K                                    @Y17XAUU 03202400
*                                                              @Y17XAUU 03203000
* MODULE TYPE -- PROCEDURE                                     @Y17XAUU 03203600
*                                                              @Y17XAUU 03204200
* PROCESSOR -- ASSEMBLER XF                                    @Y17XAUU 03204800
*                                                              @Y17XAUU 03205400
* MACROS -- AQCTL,IEDHJN,IEDQMSG,LINK,SAVE,WAIT,WTO,XCTL       @Y17XAUU 03206000
*                                                              *        03280000
* INPUT --                                                     *        03360000
*                                                              *        03440000
*    REGISTERS 02,13,14,15 CONTAINS THE FOLLOWING VALUES:      *        03520000
*                                                              *        03600000
*    02 - OLTCB POINTER                                        *        03680000
*    13 - SAVE AREA ADDRESS                                    *        03760000
*    14 - RETURN ADDRESS                                       *        03840000
*    15 - ENTRY POINT ADDRESS                                  *        03920000
*                                                              *        04000000
*                                                              *        04080000
* OUTPUT --                                                    *        04160000
*                                                              *        04240000
*    SAME AS INPUT                                             @Y17XAUU 04320000
*                                                              *        04400000
*                                                              *        04480000
* EXTERNAL REFERENCES --                                       *        04560000
*                                                              *        04640000
*    IEDQWK - MESSAGE MODULE                                   *        04720000
*    IEDQCA - OPERATOR CONTROL STOPLINE ROUTINE                *        04800000
*    AVTUI  - TCAM BINARY SEARCH ROUTINE                       *        04880000
*                                                              *        04960000
*                                                              *        05040000
* EXITS,NORMAL --                                              *        05120000
*                                                              *        05200000
*    XCTL TO IEDQWC2                                           *        05280000
*                                                              *        05360000
*                                                              *        05440000
* EXITS,ERROR --                                               *        05520000
*                                                              *        05600000
*    XCTL TO IEDQWJ                                            *        05680000
*                                                              *        05760000
*                                                              *        05840000
* TABLES/WORK AREAS --                                         *        05920000
*                                                              *        06000000
*    CVT, AVT, TERMNAME TABLE, TERMINAL TABLE, OLTCB,          *        06080000
*    LCB, QCB, DCB, SCB, TCB                                   *        06160000
*                                                              *        06240000
*                                                              *        06320000
* ATTRIBUTES --                                                *        06400000
*                                                              *        06480000
*    ENABLED, PROBLEM PROGRAM MODE, TRANSIENT                  *        06560000
*                                                              *        06640000
*                                                              *        06720000
* NOTES -- SEE BELOW                                           @Y17XAUU 06800000
*                                                              *        06880000
*  DEPENDENCIES -- EBCDIC CODE CHARACTER SET                   @Y17XAUU 06881000
*                                                              @Y17XAUU 06882000
*  RESTRICTIONS -- NONE                                        @Y17XAUU 06883000
*                                                              @Y17XAUU 06884000
*  REGISTER CONVENTIONS -- SEE REGISTERS ASSIGNMENT            @Y17XAUU 06885000
*                                                              @Y17XAUU 06886000
*  PATCH LABEL -- PATCH                                        @Y17XAUU 06887000
*                                                              *        07040000
****************************************************************        07120000
         EJECT                                                          07200000
*                                                                       07280000
*        EQUATES                                                        07360000
*                                                                       07440000
R0       EQU   0                  REG 0                                 07520000
R1       EQU   1                  REG 1                                 07600000
R2       EQU   2                  REG 2                                 07680000
R3       EQU   3                  REG 3                                 07760000
R4       EQU   4                  REG 4                                 07840000
R5       EQU   5                  REG 5                                 07920000
R6       EQU   6                  REG 6                                 08000000
R7       EQU   7                  REG 7                                 08080000
R8       EQU   8                  REG 8                                 08160000
R9       EQU   9                  REG 9                                 08240000
R10      EQU   10                 REG 10                                08320000
R11      EQU   11                 REG 11                                08400000
R12      EQU   12                 REG 12                                08480000
R13      EQU   13                 REG 13                                08560000
R14      EQU   14                 REG 14                                08640000
R15      EQU   15                 REG 15                                08720000
         SPACE                                                          08800000
INACT    EQU   X'48'              INACTIVATE VERB CODE           S22024 08880000
INACTRC  EQU   X'08'              TERM ALREADY INACTIVE RC       S22024 08960000
D19      EQU   25                 DISP OF 25                     S22024 09040000
DCBNIDLE EQU   X'02'              3705 ACTIVE                    S22024 09120000
         SPACE                                                          09200000
         SPACE                                                          09280000
SPACE    EQU   X'40'              A BLANK CHAR                          09360000
TWO      EQU   2                  DISP OF TWO                           09440000
FOUR     EQU   4                  DISP OF FOUR                          09520000
PARMREG0 EQU   0                  PARMETER REG 0                        09600000
PARMREG1 EQU   1                  PARMETER REG 1                        09680000
ZERO     EQU   0                  VALUE OF ZERO                         09760000
ONE      EQU   1                  VALUE OF ONE                          09840000
EIGHT    EQU   8                  VALUE OF EIGHT                        09920000
TWELVE   EQU   12                 VALUE OF TWELVE                       10000000
SLASH    EQU   X'61'              A SLASH CHAR                          10080000
COMMA    EQU   X'6B'              A COMMA CHAR                          10160000
SWITCHS  EQU   X'90'              SWITCHED START/STOP                   10240000
SWITCHB  EQU   X'96'              SWITCHED BI-SYNC                      10320000
MORE     EQU   X'80'              MORE ENTRIES FLAG                     10400000
NCMOFF   EQU   X'F7'              TURN OFF                              10480000
END      EQU   X'7F'              NO MORE ENTRIES FLAG                  10560000
SYM      EQU   X'40'              SYMBOLIC TEST DEVICE FLAG             10640000
NOSYM    EQU   X'BF'              TURN OFF SYMBOLIC FLAG                10720000
INCLUS   EQU   X'20'              INCLUSIVE TD FLAG                     10800000
NOINC    EQU   X'DF'              TURN OFF INCLUSIVE FLAG               10880000
ADDONE   EQU   X'10'              ADD ONE FLAG                          10960000
ADDOFF   EQU   X'EF'              TURN OFF ADD ONE FLAG                 11040000
ALLOFF   EQU   X'00'              MASK OFF ALL BIT                      11120000
NCM      EQU   X'08'              NON-CONCURRENT MORE FLAG              11200000
ADRMSK   EQU   7                  ADDRESS MASK                 @YM08136 11240000
LGBA     EQU   X'80'              LGB MAP                        S22024 11280000
RQINIT   EQU   X'0C'              START OF LIST                  S22024 11300000
RQEND    EQU   X'80'              END OF LIST                    S22024 11320000
D0       EQU   0                  DISP OF 0                             11360000
D1       EQU   1                  DISP OF 1                             11440000
D2       EQU   2                  DISP OF 2                             11520000
D3       EQU   3                  DISP OF 3                             11600000
D4       EQU   4                  DISP OF 4                             11680000
D5       EQU   5                  DISP OF 5                             11760000
D6       EQU   6                  DISP OF 6                             11840000
D7       EQU   7                  DISP OF 7                             11920000
D8       EQU   8                  DISP OF 8                             12000000
D9       EQU   9                  DISP OF 9                             12080000
D10      EQU   10                 DISP OF 10                            12160000
D11      EQU   11                 DISP OF 11                            12240000
D12      EQU   12                 DISP OF 12                            12320000
D16      EQU   16                 DISP OF 16                            12400000
D20      EQU   20                 DISP OF 20                            12480000
D24      EQU   24                 DISP OF 24                            12560000
D28      EQU   28                 DISP OF 28                            12640000
D32      EQU   32                 DISP OF 32                            12720000
ACTRTCD  EQU   X'08'              INV. LIST INIT ACTIVE                 12800000
TERMACTV EQU   X'46'              OP CONTROL ACTIVATE VERB CODE         12880000
D40      EQU   40                 DISP OF 40                            12960000
ACVT     EQU   16                 ADDR OF CVT ADDR                      13040000
TRMLEN   EQU   72                 TRM BUFFER SIZE                       13120000
FPAS     EQU   0                  1ST PASS FLAG                         13200000
NUMER    EQU   X'F0'              NUMERIC FLAG                          13280000
KF       EQU   X'C6'              CHAR F                                13360000
F9       EQU   X'F9'              CHAR 9                                13440000
F0       EQU   X'F0'              CHAR 0                                13520000
XC0      EQU   X'C0'              COMPARAND                             13600000
NEG      EQU   4                  NEGATIVE TEST                         13680000
DASH#    EQU   X'60'              HYPHEN CHAR                           13760000
D13      EQU   13                 DISP OF 13                            13840000
X0F      EQU   X'0F'              MASK BYTE                             13920000
XF0      EQU   X'F0'              MASK BYTE                    @G36XRUV 13940010
X09      EQU   X'09'              USED TO TEST FOR 3270 LOCAL  @G36XRUV 13960010
DCBOPEN  EQU   X'10'              DCB OPEN FLAG                         14000000
TCAMDEB  EQU   X'44'              DEB BELONGS TO TCAM FLAG       S22024 14080000
TERM     EQU   X'80'              TERMINAL TEST DEV                     14160000
XFF      EQU   X'FF'              MASK ALL BITS                  S22024 14240000
XE0      EQU   X'E0'              MASK SETTING                   S22024 14320000
X80      EQU   X'80'              MASK SETTING                   S22024 14400000
TCU3705  EQU   X'05'              3705 CHECK                     S22024 14480000
LINE     EQU   X'01'              LINE TEST                      S22024 14560000
RNTERM   EQU   X'08'              RN TERMINAL                    S22024 14640000
RNLINE   EQU   X'04'              RN LINE                        S22024 14720000
RNCHAN   EQU   X'02'              RN SUBCHAN                     S22024 14800000
*                                                                S22024 14880000
         USING IEDQWC1,R15                                       S22024 14960000
IEDQWC1  IEDHJN STARC1,HJN                                              15040000
         DROP  R15                                                      15120000
         SPACE 2                                                        15200000
         SAVE  (14,12)            SAVE CALLER'S REG                     15280000
         SPACE                                                          15360000
         LR    R6,R15                   LOAD BASE                       15440000
         USING IEDQWC1,R6                                               15520000
         USING TOTOLTCB,R2                                              15600000
         LA    R3,TOTSAVE4        GET MY SAVE AREA ADDR                 15680000
         ST    R3,D8(R13)         STORE IN CALLER'S SAVE AREA           15760000
         ST    R13,D4(R3)         SAVE CALLER'S                         15840000
         LR    R13,R3                   SET R13 TO SAVE AREA            15920000
         XC    TOTTDTBL(D40),TOTTDTBL CLEAR TEST DEV TABLE              16000000
         L     R8,ACVT(R0)        CVT ADDR                              16080000
         USING CVT,R8                                                   16160000
         L     R9,AVTCVTPT(R8)            PICK UP DISPATCHER ADDR       16240000
         L     R7,CVTILK2              PICK UP 2 BYTE UCB TABLE         16320000
         ST    R7,UCBSAVE                                               16400000
         DROP  R8                                                       16480000
         L     R8,D0(R9)          AVT ADDR                              16560000
         USING IEDQAVTD,R8                                              16640000
         L     R7,AVTRNMPT             PICK UP ADDR OF TERMNAME TABLE   16720000
         ST    R7,TERNMTAB             SAVE IT                          16800000
         USING IEDQTNTD,R7                                              16880000
         IC    R9,TNTENLEN             PICK UP LENGTH OF ENTRY NAME     16960000
         STC   R9,TERNMLEN             SAVE IT                          17040000
         DROP  R7                                                       17120000
         MVC   PAREMLST(D1),AVTBSX SET UP FOR BIN. SRCH                 17200000
         L     R9,AVTMSGS-D1      VCON TABLE ADDR                       17280000
         L     R9,D8(R9)          ADDR OF A1 ROUTINE                    17360000
         ST    R9,AVTUISV                                               17440000
         LA    R9,AVTOPCOB             PICK UP ADDR OF OP CON QCB       17520000
         ST    R9,OCQCB                SAVE IT                          17600000
         DROP R8                                                        17680000
         SR    R5,R5              CLEAR REG 5                           17760000
         LA    R5,TRMLEN          GET TRM BFR LENGTH                    17840000
         BCTR  R5,R0              LENGTH MINUS ONE                      17920000
         LA    R3,TOTTRMBF        POINT TO TRM BUFFER                   18000000
         EX    R5,MOVE            MOVE TRM TO WORK AREA                 18080000
         LA    R10,TRMWRK               FIND TEST DEVICE FIELD          18160000
         TM    TOTFLG04,TOTNUMDV  NUMERIC TRM ENTRY             SA41614 18240000
         BZ    FLDFIND            NO                            SA41614 18320000
         LA    R9,D9              SET LIMIT                     SA41614 18400000
         OI    TOTFLG09,TOTPRECT  SET CT EQU AP FLAG            SA41614 18480000
TRMRTNH  EQU   *                                                SA41614 18560000
         CLI   D0(R10),SLASH      CHAR A '/'                    SA41614 18640000
         BE    TRMRTNH6           YES                           SA41614 18720000
         LA    R10,D1(R10)        CHECK NEXT CHAR               SA41614 18800000
         BCT   R9,TRMRTNH         CHECK NEXT CHAR               SA41614 18880000
*        ERROR EXIT - NO ENDING SLASH                           SA41614 18960000
         WTO   'IED127I OLT REQUEST REJECTED, CONTROL TERMINAL UNIDENTI*19040000
               FIED',ROUTCDE=10,DESC=7                          SA41614 19120000
         TM    TOTFLG05,TOTSRCON  TRM ENTERED FROM SYSCON      @Y17XAUU 19125000
         BO    GETOUT             YES                          @Y17XAUU 19130000
         IEDQMSG MSGID=077,FUNCT=SRC  SEND MSG TO SOURCE       @Y17XAUU 19135000
         B     GETOUT             EXIT TO IEDQWE                SA41614 19200000
TRMRTNH6 EQU   *                                                SA41614 19280000
         LA    R10,TRMWRK         ADDR OF TRM WORK AREA         SA41614 19360000
FLDFIND  EQU   *                                                        19440000
         CLI   D0(R10),SLASH      END OF CT FIELD                       19520000
         BE    TDFLD01                 YES BRANCH                       19600000
         LA    R10,D1(R10)        NO BUMP POINTER                       19680000
         B     FLDFIND            CHECK AGAIN                           19760000
TDFLD01  EQU   *                                                        19840000
         NI    TDFLG,XFF-RNTERM-RNLINE CLEAR INTERMEDIATE FLAG   S22024 19880000
         BAL   R9,TYPECHK         DETERMINE TYPE OF TEST         S22024 19920000
TDFLD    EQU   *                                                        20160000
         LA    R10,D1(R10)        BUMP PASS DELIMITER                   20240000
         TM    TDFLG,RNCHAN       RN SUBCHAN TEST                S22024 20320000
         BO    NUMDEV             YES                            S22024 20400000
         TM    TDFLG,RNTERM+RNLINE+SYM SYMBOLIC ENTRY            S22024 20480000
         BM    TDFLD1             YES                            S22024 20560000
         B     NUMDEV             NO - ASSUME LINE ENTRY         S22024 20640000
TDFLD1   EQU   *                                                        20720000
         MVC   WORK1(D9),D0(R10)  FIND LEN OF TEST DEV ENTRY            20800000
         LA    R7,D9              LOOP COUNT                            20880000
         LA    R4,D0              COUNTER                               20960000
         LA    R3,WORK1                                                 21040000
TDCHK    CLI   D0(R3),SLASH       END OF FIELD ?                        21120000
         BE    TDOK                    YES BRANCH                       21200000
         CLI   D0(R3),COMMA       END OF NAME ?                         21280000
         BE    TDOK1                   YES BRANCH                       21360000
         LA    R3,D1(R3)          BUMP POINTER                          21440000
         LA    R4,D1(R4)          INCREMENT COUNTER                     21520000
         BCT   R7,TDCHK                GO LOOK AGAIN                    21600000
         B     TDERR                   ERROR, NAME TOO LONG             21680000
MOVE     MVC   TRMWRK(D0),D0(R3)  MOVE TRM TO WORK AREA                 21760000
TDERR    EQU   *                                                        21840000
         OI    TOTFLG03,TOTTDFER  SHOW ERROR IN TEST DEVICE FIELD       21920000
         L     R13,D4(R13)        CALLER'S SAVE AREA ADDR               22000000
         LM    R14,R1,D12(R13)    RESTORE CALLER'S REG                  22080000
         XCTL  (2,12),EP=IEDQWJ                                         22160000
TDOK1    EQU   *                                                        22240000
         OI    TDFLG,MORE              TURN ON MORE ENTRIES FLAG        22320000
         LA    R7,D1              INITIALIZE COUNTER                    22400000
         A     R7,NUMBER                                                22480000
         ST    R7,NUMBER               ADD 1 TO NUMBER OF DEVICES       22560000
         B     TDOK5              CONTINUE PROCESSING                   22640000
TDOK     EQU   *                                                        22720000
         NI    TDFLG,END               TURN OFF MORE ENTRIES FLAG       22800000
TDOK5    EQU   *                       TURN ON SYMBOLIC FLAG            22880000
         LA    R7,D10             SET COMPARAND                  S22024 22960000
         C     R7,NUMBER               MORE THAN NINE DEVICES?          23040000
         BNL   TDOK2                   NO BRANCH                        23120000
         B     TDTLON             TOOO MANY TD ENTRIES           S22024 23200000
TDOK2    EQU   *                                                        23280000
         STC   R4,LENGTH                                                23360000
         LA    R9,D8              MAX NAME LENGTH                       23440000
         CR    R9,R4                   ALREADY HAVE 8 CHARS?            23520000
         BE    TDOK22                  YES BRANCH                       23600000
         SR    R9,R4                   GET NUMBER OF POSITIONS TO FILL  23680000
         LA    R1,WORK1                GET WORK AREA ADDRESS            23760000
         BCTR  R9,R0              DECREMENT FOR MOVE                    23840000
         AR    R1,R4                   POINT PAST NAME                  23920000
         EX    R9,BLMOVE          BLANK NAME WORK AREA                  24000000
TDOK22   EQU   *                                                        24080000
         ST    R10,REGSAVE              SAVE R2                         24160000
         LR    R10,R4                                                   24240000
         BAL   R9,NAMESRCH        VERIFY TEST TERMINAL NAME             24320000
         B     TDOK3                   BRANCH AROUND ERROR RETURN       24400000
         B     TDERR                   NAME NOT IN TABLE                24480000
BLMOVE   MVC   D0(D0,R1),BLANK    BLANK NAME WORK AREA                  24560000
TDOK3    EQU   *                                                        24640000
         L     R10,REGSAVE              RESTORE R2                      24720000
TDOK3A   EQU   *                                                        24800000
         TM    TDFLG,RNTERM+RNLINE+SYM NEED UCB                  S22024 24880000
         BZ    TDOK6              NO - BRANCH                    S22024 24960000
         BAL   R9,UCBFIND         FIND CUU FOR DEVICE                   25040000
         USING UCB,R8                                                   25120000
         CLI   UCBTBYT3,UCB3COMM       IS TERMINAL COMMUNICATION DEV?   25200000
         BNE   TRM1094                   NO                             25280000
         TM    UCBTBYT2,SWITCHS   SWITCHED/START STOP                   25360000
         BNZ   TRM1092                   YES                            25440000
         MVN   WORKAREA(1),UCBTBYT1    IS TERMINAL                      25520000
         MVZ   WORKAREA(D1),UCBTBYT4 SWITCHED TD                        25600000
         XI    WORKAREA,SWITCHB   BI-SYNC                               25680000
         BNZ   TRM1094                     NO                           25760000
TRM1092  EQU   *                                                        25840000
         OI    TOTFLG04,TOTTTSWT  SET SWITCHED TEST DEVICE FLAG         25920000
         OI    TOTFLG06,TOTNCMFG  SET NCM FLAG                          26000000
TRM1094  EQU   *                                                        26080000
         DROP  R8                                                       26160000
TDOK6    EQU   *                                                        26240000
         BAL   R9,PLUG                 GO PLUG LINE NO. IN OLTCB        26320000
TDOK7    EQU   *                                               @YA12402 26400058
         TM    TDFLG,INCLUS             INCLUSIVE?             @YA12402 26420058
         BO    TDOK9                    YES                    @YA12402 26440058
         TM    TDFLG,MORE               ANY MORE TO DO         @YA12402 26460058
         BO    TDOK4                   YES BRANCH                       26480000
TRM1099  EQU   *                                                        26560000
         BAL   R11,LINECHK        VERIFY THAT LINE IS OPENED            26640000
         BAL   R3,TERMSTAT        CHECK INIT STATUS OF TEST DEVICES     26720000
         L     R13,D4(R13)        CALLER'S SAVE AREA                    26800000
         LM    R14,R1,D12(R13)    CALLER'S REG                          26880000
         XCTL  (2,12),EP=IEDQWC2                                        26960000
TDOK4    EQU   *                                                        27040000
         TM    TDFLG,RNTERM+RNLINE+SYM SYMBOLICE                 S22024 27120000
         BM    TDOK8              YES - EXIT                     S22024 27200000
         B     TDFLD01            PROCESS NEXT ENTRY             S22024 27440000
TDOK8    EQU   *                                                        27520000
         LA    R10,D0(R4,R10)     POINT TO NEXT ENTRY                   27600000
         B     TDFLD01            PROCESS NEXT ENTRY             S22024 27680000
TDOK9    EQU   *                                                        27760000
*                                                                       28080000
*              ROUTINE TO CHANGE CUU TO NEXT ONE IN ORDER               28160000
*                                                                       28240000
         SR    R3,R3                                                    28400000
         IC    R3,WORK1+D2        LAST DIGIT                            28480000
         LA    R4,KF              HEX 15                                28560000
         CR    R3,R4                   FIND IF 0-9 OR A-F               28640000
         BL    BUMP1                   A-E                              28720000
         BE    BUMP2                   F?                               28800000
         LA    R4,F9              HEX 9                                 28880000
         CR    R3,R4                   9?                               28960000
         BE    BUMP3                   YES                              29040000
BUMP1    EQU   *                                                        29120000
         LA    R3,D1(R3)          ADD 1 TO DIGIT                        29200000
BUMP1A   EQU   *                                                        29280000
         STC   R3,WORK1+D2        CHANGE CUU                            29360000
         CLC   WORK3,WORK1                                              29440000
         BE    TURNOFF                 LAST DEVICE INCLUSIVE            29520000
         B     TURNOFF1           CONTINUE PROCESSING                   29600000
TURNOFF  NI    TDFLG,NOINC             TURN OFF INCLUSIVE FLG           29680000
TURNOFF1 EQU   *                                                        29760000
         BAL   R9,UCBLOOK               GO FIND UCB ADDR       @YA12402 29800058
         LA    R7,D1              SET INCREMENT                         29840000
         A     R7,NUMBER               ADD ONE TO NUMBER                29920000
         ST    R7,NUMBER               STORE IT                         30000000
         LA    R7,D10             SET COMPARAND                  S22024 30080000
         C     R7,NUMBER               GT THAN 9 DEVICES?               30160000
         BNL   TDOK6                   NO BRANCH                        30240000
         B     TDTLON             TOO MANY TD ENTRIES            S22024 30320000
BUMP2    EQU   *                                                        30400000
         IC    R3,WORK1+D1        PICK UP SECOND DIGIT                  30480000
         CR    R3,R4                                                    30560000
         BL    BUMP2A                  A-E?                             30640000
         BE    TDERR                   F TOO LARGE A NUMBER             30720000
         LA    R4,F9              SET COMPARAND                         30800000
         CR    R3,R4                   9?                               30880000
         BE    BUMP2C                  YES                              30960000
BUMP2A   EQU   *                                                        31040000
         LA    R3,D1(R3)          ADD TO SECOND DIGIT                   31120000
         STC   R3,WORK1+D1        SAVE                                  31200000
         LA    R3,F0              CHANGE LAST DIGIT TO F0               31280000
         B     BUMP1A             MAKE NEXT CHECK                       31360000
BUMP2C   EQU   *                                                        31440000
         LA    R3,XC0             SET COMPARAND                         31520000
         B     BUMP2A             MAKE NEXT CHECK                       31600000
BUMP3    EQU   *                                                        31680000
         LA    R3,XC0             SET COMPARAND                         31760000
         B     BUMP1              GO INCREMENT NUMBER                   31840000
         EJECT                                                          35120000
*                                                                       35200000
*                                                                       35280000
*              ROUTINE TO HANDLE TEST DEVICE ENTERED AS CUU             35360000
*                                                                       35440000
*                                                                       35520000
NUMDEV   EQU   *                                                        35600000
         CLI   D0(R10),NUMER            IS FIRST CHAR ZERO     @YA12402 35608058
         BNE   DIGIT3                   NO                     @YA12402 35616058
         TM    D3(R10),XC0              IS 4TH CHAR ALPHANUM   @YA12402 35624058
         BNO   DIGIT3                   NO                     @YA12402 35632058
         SPACE 1                                               @YA12402 35640058
         LA    R10,D1(R10)              ADJUST FOR LEADING ZERO@YA12402 35648058
         SPACE 1                                               @YA12402 35656058
DIGIT3   EQU   *                                               @YA12402 35664058
         MVC   WORK1(D3),D0(R10)  MOVE CUU TO WORK AREA                 35680000
         BAL   R9,UCBLOOK               GO FIND UCB ADDR       @YA12402 35760058
UCBEND1  EQU   *                                                 S22024 37440000
         CLI   D3(R10),SLASH      END OF FIELD                          37520000
         BE    UCBEND3                 YES BRANCH                       37600000
         CLI   D3(R10),COMMA      ANOTHER ENTRY                         37680000
         BE    UCBEND4                 YES BRANCH                       37760000
         CLI   D3(R10),DASH#      INCLUSIVE DEVICE                      37840000
         BE    UCBEND5                 YES BRANCH                       37920000
         B     TDERR                   NO DELIMITER                     38000000
UCBEND3  EQU   *                                                        38080000
         NI    TDFLG,END               TURN OFF MORE ENTRIES FLAG       38160000
         LA    R7,D9              SET COMPARAND                  S22024 38240000
         C     R7,NUMBER               MORE THAN 9 DEVICES?             38320000
         BNL   TDOK6              NO - CONTINUE PROCESSING              38400000
UCBEND4  EQU   *                                                        38480000
         OI    TDFLG,MORE              TURN ON MORE FLAG                38560000
         LA    R10,D3(R10)        BUMP PASS CUU                         38640000
         LA    R7,D1              ADD ONE TO COUNTER                    38720000
         A     R7,NUMBER                                                38800000
         ST    R7,NUMBER                                                38880000
         LA    R7,D10             SET COMPARAND                  S22024 38960000
         C     R7,NUMBER                                                39040000
         BL    TDTLON             ERROR - TOO MANY TD ENTRIES    S22024 39120000
         B     TDOK3A             NO BRANCH                      S22024 39200000
UCBEND5  EQU   *                                                        39280000
         LR    R4,R10                                                   39360000
         LA    R10,D4(R10)        POINT PAST DASH                       39440000
         LA    R3,D5              SET LOOP COUNT                        39520000
         LA    R7,D0              INIT COUNTER                          39600000
DASH     CLI   D0(R10),COMMA      END OF ENTRY ?                        39680000
         BE    DASH1A                   YES                    @YA12402 39760058
         CLI   D0(R10),SLASH      END OF FIELD ?                        39840000
         BE    DASH2                   YES BRANCH                       39920000
         LA    R10,D1(R10)        BUMP POINTER                          40000000
         LA    R7,D1(R7)          INCREMENT COUNTER                     40080000
         BCT   R3,DASH                  CHECK CHAR AGAIN       @YA12402 40120058
         B     TDERR                   ERROR TOO MANY DIGITS AFTER DAS  40160000
DASH1A   EQU   *                                               @YA12402 40180058
         OI    TDFLG,MORE               MORE TO DO             @YA12402 40200058
DASH1    EQU   *                                                        40240000
         C     R7,F4                    4 DIGITS?              @YA12402 40320058
         BE    DASH3                   YES BRANCH                       40400000
         C     R7,K3              3 DIGITS                              40480000
         BE    DASH10                  YES BRANCH                       40640000
         B     TDERR                   WRONG NUMBER OF DIGITS           40720000
DASH3    EQU   *                                                        40800000
         LA    R4,D1(R4)                ADJUST FOR LEADING ZERO@YA12402 40880058
DASH10   EQU   *                                                        41280000
         OI    TDFLG,INCLUS            TURN ON INCLUSIVE FLAG           41360000
         MVC   WORK3(D3),D4(R4)   MOVE END CUU TO SAVE                  41440000
DASH11   EQU   *                                                        41520000
         LA    R7,D1              ADD ONE TO NUMBER                     41680000
         A     R7,NUMBER                                                41760000
         ST    R7,NUMBER                                                41840000
         LA    R7,D10             SET COMPARAND                  S22024 41920000
         C     R7,NUMBER               MORE THAN 9 DEVICES?             42000000
         BNL   TDOK6              NO                                    42080000
         B     TDERR                   TOO MANY DECVICES                42160000
DASH2    EQU   *                                                        42240000
         NI    TDFLG,ALLOFF            TURN OFF ALL THE FLAGS           42320000
         B     DASH1              CHECK NEXT NUMBER                     42400000
         EJECT                                                          42403058
*                                                              @YA12402 42406058
*                                                              @YA12402 42409058
*    ROUTINE TO LOOK UP UCB ENTRY,                             @YA12402 42412058
*     GIVEN THE CUU                                            @YA12402 42415058
*                                                              @YA12402 42418058
*                                                              @YA12402 42421058
UCBLOOK  EQU   *                                               @YA12402 42424058
         L     R8,UCBSAVE               GET ADDR OF UCB PTRS   @YA12402 42427058
         USING UCB,R7                                          @YA12402 42430058
UCBLOOK1 EQU   *                                               @YA12402 42433058
         SLR   R7,R7                    CLEAR                  @G36XRUV 42434010
         ICM   R7,3,D0(R8)              LOAD UCB ADDR          @G36XRUV 42436010
         LA    R8,D2(R8)                POINT TO NEXT ENTRY    @YA12402 42439058
         BZ    UCBLOOK1                 PADDING IGNORE         @YA12402 42445058
         CLM   R7,3,ENDTABLE            AT END OF UCB TABLE    @G36XRUV 42446010
         BE    TDERR                    Y-ERROR                @G36XRUV 42447010
         ST    R7,WORK4                 SAVE UCB ADDR          @YA12402 42451058
         CLC   WORK1(D3),UCBNAME        MATCH?                 @YA12402 42454058
         BNE   UCBLOOK1                 NO GO LOOK AGAIN       @YA12402 42457058
*********************************************************************** 42457110
*        THE FOLLOWING CODE IS MVS UNIQUE. IT CHECKS FOR 3270  @G36XRUV 42457210
*        LOCAL AND 3705 USING THE UCB. IF THE DEVICE IS EITHER,@G36XRUV 42457310
*        IT IS AN ERROR. NOTE: THE MEANINGS OF THE UCB BITS MAY@G36XRUV 42457410
*        CHANGE IN THE FUTURE NECESSITATING CHANGES TO THIS    @G36XRUV 42457510
*        CODE.                                                 @G36XRUV 42457610
*********************************************************************** 42457710
         MVC   WORK2(D1),UCBTBYT4       MOVE TYPE TO WORK AREA @G36XRUV 42457810
         TM    UCBDVCLS,UCB3DISP        Q-GRAPHICS DEVICE      @G36XRUV 42457910
         BNO   NCPCHK                   N-CHECK FOR NCP        @G36XRUV 42458010
         TM    WORK2,XF0                Q-ANY HI BITS ON       @G36XRUV 42458110
         BNZ   NCPCHK                   N-NOT 3270             @G36XRUV 42458210
         CLI   WORK2,X09                Q-IN 3270 RANGE        @G36XRUV 42458310
         BL    NCPCHK                   N-CHECK FOR NCP        @G36XRUV 42458410
         B     GETOUT1                  3270 LOCAL - ERROR     @G36XRUV 42458510
NCPCHK   DS    0H                                              @G36XRUV 42458610
         NI    WORK2,X0F                CLEAR HI BITS          @G36XRUV 42458710
         CLI   WORK2,TCU3705            3705?                  @G36XRUV 42458810
         BNER  R9                       RETURN                 @G36XRUV 42458910
         B     GETOUT1                  3705 - ERROR           @G36XRUV 42459010
         EJECT                                                          42480000
*              ROUTINE TO SEARCH TERMNAME TABLE. R3 HAS ADDR OF         42560000
*              START OF TABLE. WORK1 HAS NAME IN IT. R2 HAS LENGTH      42640000
*                                                                       42720000
NAMESRCH EQU   *                                                        42800000
         LA    R1,PAREMLST              SET R1                          42880000
         L     R15,AVTUISV                                              42960000
         LH    R0,TWO(R1)         LOAD CHAR STRING LEN                  43040000
         L     R1,FOUR(R1)        LOAD ADDR OF CHARS                    43120000
         BAL   R14,FOUR(R15)      BRANCH TO SCAN ROUTINE                43200000
         LTR   R15,R15                                                  43280000
         BZ    D4(R9)             NAME NOT FOUND                        43360000
         SPACE                                                          43440000
         STM   R7,R9,TRMSAV1      SAVE REG 7-9                          43520000
         L     R8,TERNMTAB        SET START OF TABLE                    43600000
         USING IEDQTNTD,R8                                              43680000
         LA    R7,TNTFIRST        POINT TO FIRST ENTRY OF TABLE         43760000
         SR    R9,R9              CLEAR REG 9                           43840000
         IC    R9,TNTENLEN        GET MAX. LENGTH OF NAME FIELD         43920000
         LA    R9,D3(R9)          LENGTH OF 1 ENTRY                     44000000
         DROP  R8                                                       44080000
         BCTR  R15,R0             DECREMENT REL POSITION COUNT          44160000
         MR    R8,R15             GET DISPLACEMENT TO ENTRY DESIRED     44240000
         AR    R7,R9              GET DESIRED TNT ADDRESS               44320000
         ST    R7,TRMTNT          SAVE IT                               44400000
         LA    R1,D1(R15)         RESTORE REL POSITION COUNT            44480000
         LM    R7,R9,TRMSAV1      RESTORE REG                           44560000
         L     R15,TERNMTAB                                             44640000
         BALR  R14,R15            GET TTE ADDR                          44720000
         ST    R1,TNTENTRY                                              44800000
         USING IEDQTRM,R1                                        S22024 44808000
         TM    TRMDSORG,TRMLGB    LGB RATHER THAN A TTE          S22024 44810000
         BO    D4(R9)             YES - ERROR - NOT A TERMINAL   S22024 44812000
         L     R1,TRMDESTQ-D1     DEST. QCB ADDR                 S22024 44816000
         DROP  R1                                                S22024 44824000
         USING IEDQQCB,R1                                        S22024 44832000
         LA    R1,D0(R1)          CLEAR HI ORDER BYTE            S22024 44840000
         TM    QCBFLAG,QCBTSSES   TSO TERMINAL                  SA61759 44848000
         BO    TRMTSO             YES - ERROR EXIT               S22024 44856000
         DROP R1                                                 S22024 44864000
         BR    R9                 RETURN TO CALLER                      44880000
         SPACE                                                          44890000
TRMTSO   DS    0H                 BOUNDARY ALLIGNMENT            S22024 44900000
         IEDQMSG MSGID=011,FUNCT=CEC TSO TEST DEVICE             S22024 44910000
         B     GETOUT             TERMINATE TRM                  S22024 44920000
         EJECT                                                          44960000
*                                                                       45040000
*                                                                       45120000
*        ROUTINE TO FIND UCB ADDR AFTER ENTRY IN TERMINAL TABLE HAS     45200000
*        BEEN FOUND                                                     45280000
*                                                                       45360000
*                                                                       45440000
UCBFIND  EQU   *                                                        45520000
         L     R8,TNTENTRY                                              45600000
         USING IEDQTRM,R8                                               45680000
         L     R8,TRMDESTQ-D1     GET QCB ADDR                          45760000
         DROP  R8                                                       45840000
         USING IEDQQCB,R8                                               45920000
         SR    R7,R7                   GET RELATIVE                     46000000
         IC    R7,QCBRELLN          RELATIVE LINE NUMBER                46080000
         SLL   R7,2                    MULT BY 4                        46160000
         L     R8,QCBDCBAD-1      GET DCB ADDRESS                       46240000
         DROP  R8                                                       46320000
         USING IHADCB,R8                                                46400000
         TM    DCBDSORG,LGBA      LGB VS. DCB                    S22024 46480000
         BZ    UCB0X              NO                             S22024 46560000
         DROP  R8                                                S22024 46640000
         L     R1,TNTENTRY        GET TERMINAL TTE ADDRESS     @Y17XAUU 46641000
         BAL   R14,NCPTTE         GET NCP TTE ADDRESS          @Y17XAUU 46642000
*                                                              @Y17XAUU 46643000
*        ON RETURN R1 CONTAINS ADDRESS OF NCP TTE PREFIX       @Y17XAUU 46644000
*                                                              @Y17XAUU 46645000
         USING IEDNTRM,R1         ESTABLISH ADDRESSABILITY     @Y17XAUU 46646000
         LA    R7,D4              SHOW RLN EQU 1                 S22024 46880000
         TM    TRMBYTE2,TRMRSACT  3705 ACTIVE                  @Y17XAUU 46886000
         BO    UCB0X1             YES - CONTINUE               @Y17XAUU 46892000
UCBNACT  EQU   *                                               @Y17XAUU 46992000
         IEDQMSG MSGID=010,FUNCT=CEC MSG                         S22024 47120000
         B     TDERR              ERROR EXIT                     S22024 47200000
UCB0X1   EQU   *                                               @Y17XAUU 47201000
         L     R1,TRMDESTQ-D1     GET 3705 QCB ADDRESS         @Y17XAUU 47202000
         DROP  R1                                              @Y17XAUU 47203000
         USING IEDQQCB,R1         ESTABLISH ADDRESSABILITY     @Y17XAUU 47204000
         L     R8,QCBDCBAD-D1     GET 3705 DCB ADDRESS         @Y17XAUU 47205000
         DROP  R1                                              @Y17XAUU 47206000
UCB0X    EQU   *                                                 S22024 47280000
         USING IHADCB,R8                                         S22024 47440000
         TM    DCBOFLGS,DCBOPEN   DCB OPEN                              47520000
         BZ    NOOPEN                  NO BRANCH                        47600000
         L     R8,DCBDEBAD        GET DEB ADDRESS                       47680000
         DROP  R8                                                       47760000
         USING DEBNMSUB,R8                                              47840000
         SR    R15,R15                                                  47920000
         IC    R15,DEBNMEXT       GET NUMBER OF EXTENTS                 48000000
         SLL   R15,2                MULTIPLY BY 4                       48080000
         CR    R15,R7             IS DESIRED LINE OPENED?               48160000
         BL    NOOPEN               NO                                  48240000
         L     R8,DEBUCBAD-D4(R7) UCB ADDR                              48320000
         USING UCB,R8                                                   48400000
         MVC   WORK1(D3),UCBNAME  MOVE UCB ID IN EBCDIC                 48800000
         MVC   WORK2(D2),UCBCHA   MOVE UCB ID IN HEX                    48880000
         DROP  R8                                                       48960000
         MVI   WORK2+D2,D0        CLEAR HI ORDER BYTE                   49040000
         NI    WORK2,X0F          MASK OFF UNWANTED BITS                49120000
         BR    R9                      RETURN                           49200000
NOOPEN   EQU   *                                                        49280000
         MVC   CEOUT2(D8),WORK1   PUT TERMINAL NAME IN MSG              49360000
         SPACE                                                          49440000
*                                                                       49520000
*        TEST LINE NOT OPEN                                             49600000
*                                                                       49680000
         SPACE                                                          49760000
         IEDQMSG OTBUF=CEOUT2A,OTCNT=CEOUT2E-CEOUT2A,FUNCT=CEC,LINK=YES 49840000
         SPACE                                                          49920000
         B     TDERR              GO TO PROMPTER                        50000000
         EJECT                                                          50001000
************************************************************** @Y17XAUU 50002000
*        ROUTINE TO FIND NCP TTE ADDRESS. INPUT: REG1 =      * @Y17XAUU 50003000
*        TERMINAL TTE ADDRESS. OUTPUT: REG 1 = NCP TTE PREFIX* @Y17XAUU 50004000
*        ADDRESS. RETURN TO CALLER VIA REG 14.               * @Y17XAUU 50005000
************************************************************** @Y17XAUU 50006000
NCPTTE   EQU   *                                               @Y17XAUU 50007000
         ST    R14,TRMSAVE2       SAVE RETURN ADDRESS          @Y17XAUU 50008000
         LA    R8,TRMPRFSZ        GET TTE PREFIX SIZE          @Y17XAUU 50009000
         SLR   R1,R8              POINT TO TTE PREFIX          @Y17XAUU 50010000
         USING IEDNTRM,R1         ESTABLISH ADDRESSABILITY     @Y17XAUU 50011000
NCPLOOP  EQU   *                                               @Y17XAUU 50012000
         LH    R1,TRMCOHRT        GET COHORT POINTER           @Y17XAUU 50013000
         LTR   R1,R1              ENTRY IN HIERARCHY           @YM07415 50013300
         BZ    UCBNACT            NO - ERROR RETURN            @YM07415 50013600
         L     R15,TERNMTAB       TTCIN TO TTE CONVERSION      @Y17XAUU 50014000
*                                 ROUTINE ADDRESS              @Y17XAUU 50015000
         BALR  14,R15             FIND TTE ADDRESS             @Y17XAUU 50016000
         SLR   R1,R8              POINT TO TTE PREFIX          @Y17XAUU 50017000
         CLI   TRMTYPE,TRMLNCP    NCP ENTRY                    @Y17XAUU 50018000
         BNE   NCPLOOP            NO - CHECK NEXT ENTRY        @Y17XAUU 50019000
         L     R14,TRMSAVE2       RESTORE RETURN ADDRESS       @Y17XAUU 50020000
         BR    R14                RETURN TO CALLER             @Y17XAUU 50021000
         DROP  R1                                              @Y17XAUU 50022000
         EJECT                                                          50080000
GETOUT1  DS    0H                                              @G36XRUV 50100010
         IEDQMSG MSGID=094,FUNCT=CEC                           @G36XRUV 50120010
GETOUT   EQU   *                                                        50160000
         OI    TOTFLG06,TOTOTERM  SET TERMINATE FLAG                    50240000
         L     R13,D4(R13)        CALLER'S SAVE AREA                    50320000
         LM    R14,R1,D12(R13)    CALLER'S REG                          50400000
         XCTL  (2,12),EP=IEDQWE                                         50480000
NOOPEN2  EQU   *                                                        50560000
         L     R9,REGSAVE              RESTORE RETURN REG               50640000
         BR    R9                      RETURN                           50720000
         SPACE 4                                                        50800000
**************************************************************** S22024 50880000
**************************************************************** S22024 50960000
*        ERROR EXIT - MORE THAN 10 TEST DEVICES                * S22024 51040000
TDTLON   EQU   *                                                 S22024 51120000
         IEDQMSG MSGID=000,FUNCT=CEC MORE THAN 10 TEST DEVICES   S22024 51200000
         B     TDERR              EXIT TO PROMPTER               S22024 51280000
         EJECT                                                          51360000
*                                                                       51440000
*        FIND LCB ADDR FOR LINE ENTRY IN TEST DEVICE TABLE.             51520000
*        THE UCB NAME IS PASSED TO THIS ROUTINE.                        51600000
*        THE LCB ADDRESS IS RETURN TO THE CALLER.                       51680000
*                                                                       51760000
LCBFIND  EQU   *                                                        51840000
         STM   R1,R12,REGSAVE     SAVE CALLER'S REG                     51920000
NOUCBAD  EQU   *                                                        52000000
         L     R1,ACVT(R0)        CVT ADDR                              52080000
         L     R1,AVTCVTPT(R1)         GET TCAM DISP ADDR               52160000
         L     R1,D0(R1)          AVT ADDR                              52240000
         USING IEDQAVTD,R1                                              52320000
         L     R1,AVTTCB               GET TCB ADDR                     52400000
         DROP  R1                                                       52480000
         L     R1,D8(R1)          DEB CHAIN ADDR                        52560000
AGAIN    DS    0H                 ALLIGN ON HALFWORD BOUNDARY    S22024 52640000
         SR    R3,R3              CLEAR REG                      S22024 52720000
         IC    R3,D16(R1)         NUMBER OF EXTENTS                     52800000
         LA    R5,D32(R1)         UCB CHAIN ADDR                        52880000
         L     R4,D24(R1)         DCB ADDR                              52960000
         USING IHADCB,R4                                         S22024 53040000
         TM    DCBDSORG,LGBA      LGB VS. DCB                    S22024 53120000
         BZ    HERE0              NO                             S22024 53200000
         DROP  R4                                                S22024 53280000
         L     R1,TNTENTRY        GET TERMINAL TTE ADDRESS     @Y17XAUU 53280800
         BAL   R14,NCPTTE         FIND NCP TTE ADDRESS         @Y17XAUU 53281600
         USING IEDNTRM,R1         ESTABLISH ADDRESSABILITY     @Y17XAUU 53282400
         L     R7,TRMDESTQ-D1     GET QCB ADDRESS              @Y17XAUU 53283200
         DROP  R1                                              @Y17XAUU 53284000
         USING IEDQQCB,R7         ESTABLISH ADDRESSABILITY     @Y17XAUU 53284800
         L     R4,QCBDCBAD-D1     GET NCP DCB ADDRESS          @Y17XAUU 53285600
         DROP  R7                                              @Y17XAUU 53286400
         USING IHADCB,R4                                         S22024 53600000
HERE0    EQU   *                                                 S22024 53680000
         L     R12,D4(R1)         NEXT DEB ADDR                         53760000
         TM    DCBDSORG+D1,TCAMDEB TCAM DEB                             53840000
         BZ    HERE1                   NO BRANCH                        53920000
         MVC   LCBLEN(D1),DCBEIOBX GET LCB SIZE                         54000000
         LA    R8,D1              COUNTER                               54080000
HERE     EQU   *                                                        54160000
         L     R9,D0(R5)          UCB ADDR                              54240000
         CLC   WORK1(D3),D13(R9)  CUU MATCH                             54320000
         BE    THERE                   YES BRANCH                       54400000
         LA    R8,D1(R8)          BUMP COUNTER                          54480000
         LA    R5,D4(R5)          BUMP UCB ADDR PTR                     54560000
         BCT   R3,HERE                 GO LOOK AGAIN                    54640000
HERE1    EQU   *                                                        54720000
         LA    R12,D0(R12)        CLR HI ORDER BYTE                     54800000
         LTR   R12,R12                 ANY MORE DEBS?                   54880000
         BZ    BADRET                  NO BRANCH                        54960000
         LR    R1,R12                  SET R1 TO NEXT DEB               55040000
         B     AGAIN                   GO LOOK AT NEXT DEB              55120000
BADRET   EQU   *                                                        55200000
         LM    R1,R12,REGSAVE     RESTORE REG                           55280000
         B     D4(R9)             RETURN                                55360000
THERE    EQU   *                                                        55440000
         USING UCB,R9                                            S22024 55520000
         MVC   RNWORK(D1),UCBTBYT4 TCU TYPE BYTE                 S22024 55600000
         NI    RNWORK,X0F         CLEAR UNWANTED BITS            S22024 55680000
         CLI   RNWORK,TCU3705     3705 TCU                       S22024 55760000
         BNE   THERE2             NO                             S22024 55840000
         LA    R8,D1              SET RLN EQU 1                  S22024 55920000
         DROP  R9                                                S22024 56000000
THERE2   EQU   *                                                 S22024 56080000
         STC   R8,RLN                  STORE THE REL LIN NO.            56160000
         STC   R8,MULT+D3         SET UP MULTIPLIER                     56240000
         L     R8,DCBIOBAD            PICK UP LCB IOB ADDR              56320000
         SR    R10,R10                                                  56400000
         SR    R11,R11                                                  56480000
         IC    R11,LCBLEN               SET R3 TO SIZE OF LCB           56560000
         M     R10,MULT                 MULTIPLY                        56640000
         LA    R8,D0(R11,R8)      IOB OF DESIRED LCB                    56720000
         S     R8,K32             ADJUST TO START OF LCB                56800000
         ST    R8,WORK1           SAVE UCB ADDR                         56880000
         LM    R1,R12,REGSAVE     RESTORE REG                           56960000
         BR    R9                      RETURN                           57040000
         DROP  R4                                                       57120000
         EJECT                                                          57200000
*                                                                       57280000
*        ROUTINE TO DETERMINE INITIAL STATUS OF                         57360000
*        TERMINAL TEST DEVICES                                          57440000
*                                                                       57520000
TERMSTAT EQU   *                                                        57600000
         TM    TOTFLG10,TOTTERMS  TERMINAL TEST ?                       57680000
         BZ    LINESTAT           NO - LINE TEST                        57760000
         LA    R12,TOTTDTBL       POINT TO TEST DEVICE TABLE            57840000
         LA    R11,TOTTDEND       POINT TO END OF TABLE                 57920000
STAT2    EQU   *                                                        58000000
         CR    R12,R11            END OF TABLE ?                        58080000
         BE    ZERO(R3)           YES - RETURN                          58160000
         L     R7,D0(R12)         GET TNT ADDR                          58240000
         LA    R7,D0(R7)          CLEAR HI ORDER BYTE                   58320000
         LTR   R7,R7              LAST ENTRY ?                          58400000
         BZ    ZERO(R3)           YES - RETURN                          58480000
         ST    R7,TDTNT           SAVE TD TNT ADDRESS          @YM08136 58520000
         MVI   RQLADR,SPACE       BLANK NAME FIELD                      58560000
         MVC   RQLADR+D1(D7),RQLADR  IN REQUEST ELEMENT                 58640000
         SR    R10,R10            CLEAR REG                             58720000
         IC    R10,TOTTTBEL       GET MAX NAME LENG9H                   58800000
         LR    R9,R10             SAVE LENGTH                           58880000
         BCTR  R9,R0              DECREMENT FOR EX                      58960000
         EX    R9,RQMOVE          MOVE NAME TO REQ ELEMENT              59040000
         AR    R7,R10             POINT TO TTE ADDR                     59120000
         MVC   TTEADDR+D1(D3),D0(R7) ALLIGN ADDR                        59200000
         L     R8,TTEADDR         GET TTE ADDR                          59280000
         LA    R1,TRMPRFSZ        GET TTE PREFIX SIZE          @Y17XAUU 59300000
         SLR   R8,R1              POINT TO TTE PREFIX          @Y17XAUU 59320000
         USING IEDNTRM,R8                                      @Y17XAUU 59360000
         CLI   TRMTYPE,TRMLUNT    LU ENTRY                     @Y17XAUU 59380000
         BE    STAT16             YES - BYPASS INIT STATUS     @Y17XAUU 59400000
         L     R8,TRMDESTQ-D1     GET QCB ADDR                          59440000
         DROP  R8                                                       59520000
         USING IEDQQCB,R8                                               59600000
         MVC   RQRLN(D1),QCBRELLN SAVE RLN IN OP CONTROL PLIST          59680000
         TM    QCBSTAT,QCBTRMHO   TERMINAL INITIALLY HELD ?             59760000
         BZ    STAT6              NO                                    59840000
         OI    D0(R12),TOTTDTHD   SHOW INIT HELD                        59920000
STAT6    EQU   *                                                        60000000
         L     R9,TOTAVTPT        GET AVT ADDR                          60080000
         TM    TOTFLG04,TOTTTSWT  TEST DEVICE SWITCHED ?                60160000
         BO    STAT12             YES - TERMINAL ACTIVE          S22024 60240000
*                                                                       60243000
*        IF THE TEST ENTRY IS AN NCP PRE SNA RESOURCE AND      @YM08136 60246000
*        EQUAL TO THE CONTROL TERMINAL OR ALTERNATE PRINTER    @YM08136 60249000
*        BYPASS ISSUING AN INACTIVATE FOR THE RESOURCE.        @YM08136 60252000
*                                                                       60255000
         SLR   R1,R1              CLEAR REGISTER               @YM08136 60258000
         ICM   R1,ADRMSK,TOTCRTNT+D1 GET CT TNT ADDRESS        @YM08136 60261000
         BZ    CHKAP              CHECK AP IF CT NOT TERMINAL  @YM08136 60264000
         CL    R1,TDTNT           CT EQU TD                    @YM08136 60267000
         BE    CHKTYPE            YES - CHECK FOR PRE SNA TERM @YM08136 60270000
CHKAP    EQU   *                                               @YM08136 60273000
         SLR   R1,R1              CLEAR REG                    @YM08136 60276000
         ICM   R1,ADRMSK,TOTARTNT+D1 GET AP TNT ADDRESS        @YM08136 60279000
         BZ    CHKEND             GO - INACTIVATE RESOURCE     @YM08136 60282000
         CL    R1,TDTNT           AP EQU TD                    @YM08136 60285000
         BNE   CHKEND             NO - GO INACTIVATE RESOURCE  @YM08136 60288000
CHKTYPE  EQU   *                                               @YM08136 60291000
         L     R1,TTEADDR         GET TTE ADDRESS              @YM08136 60294000
         LA    R15,TRMPRFSZ       GET TTE PREFIX SIZE          @YM08136 60297000
         SLR   R1,R15             POINT TO TTE PREFIX          @YM08136 60300000
         USING IEDNTRM,R1         SET TTE ADDRESSABILITY       @YM08136 60303000
         CLI   TRMTYPE,TRMPSNA    NCP PRE SNA TERMINAL         @YM08136 60306000
         BE    STAT12             YES - PROCESS NEXT TD ENTRY  @YM08136 60309000
CHKEND   EQU   *                                               @YM08136 60312000
         LA    R1,TOTOTECB        GET ECB ADDR                          60320000
         ST    R1,RQECBA          PUT IN REQ ELEMENT                    60400000
         L     R5,TOTAVTPT        GET AVT ADDR                          60480000
         USING IEDQAVTD,R5                                              60560000
         LA    R14,AVTOPCOB       GET OP CONTROL QCB ADDR               60640000
         DROP  R5                                                       60720000
         ST    R14,RQQCBA-D1      PUT IN QCB ADDR                       60800000
         MVI   RQVBCD,INACT       INACTIVATE VERB CODE           S22024 60880000
         XC    RQLINK(D3),RQLINK  CLEAR LINK FIELD                      60960000
         XC    TOTOTECB(D4),TOTOTECB CLEAR ECB                          61040000
         MVC   TOTPLIST(RQND-RQELE),RQELE ELEMENT TO OLTCB       S22024 61120000
         LA    R1,TOTPLIST        ADDR OF ELEMENT                S22024 61130000
         ST    R1,TRMSLPL         PUT IN PLIST                   S22024 61140000
         ST    R1,TRMSLPL+D4      PUT IN PLIST                   S22024 61150000
         MVI   TRMSLPL,RQINIT     SET INITIAL ELEMENT FLAG       S22024 61160000
         MVI   TRMSLPL+D4,RQEND   SET LAST ELEMENT FLAG          S22024 61170000
         LA    R1,TRMSLPL         ADDR OF PLIST                  S22024 61180000
*                                                                       61200000
         AQCTL                    ISSUE ACTIVATE COMMAND                61280000
         WAIT  ECB=TOTOTECB                                             61360000
*                                                                       61440000
         MVC   RQRTCD(D1),TOTORTCD RETURN CODE                   S22024 61480000
         CLI   RQRTCD,INACTRC     INIT INACTIVE                  S22024 61520000
         BNE   STAT12             NO - ACTIVE                    S22024 61600000
STAT10   EQU   *                                                        61680000
         OI    D0(R12),TOTTDIAC   SHOW THAT LIST INACTIVE               61760000
STAT12   EQU   *                  FIND LCB ADDR                         61840000
         L     R9,QCBDCBAD-D1     GET DCB ADDR                          61920000
         USING IHADCB,R9                                                62000000
         TM    DCBDSORG,LGBA      LGB VS. DCB                    S22024 62080000
         BZ    STAT13             NO                             S22024 62160000
         DROP  R9                                                S22024 62240000
         L     R1,TNTENTRY        GET TERMINAL TTE ADDRESS     @Y17XAUU 62240800
         BAL   R14,NCPTTE         FIND NCP TTE ADDRESS         @Y17XAUU 62241600
         USING IEDNTRM,R1         ESTABLISH ADDRESSABILITY     @Y17XAUU 62242400
         L     R9,TRMDESTQ-D1     GET QCB ADDRESS              @Y17XAUU 62243200
         USING IEDQQCB,R9         ESTABLISH ADDRESSABILITY     @Y17XAUU 62244000
         L     R9,QCBDCBAD-D1     GET 3705 DCB ADDRESS         @Y17XAUU 62244800
         DROP  R1                                              @Y17XAUU 62245600
         DROP  R9                                              @Y17XAUU 62246400
         USING IHADCB,R9                                         S22024 62560000
STAT13   EQU   *                                                 S22024 62640000
         L     R7,DCBDEBAD        GET DEB ADDR                          62720000
         USING DEBNMSUB,R7                                              62800000
         SR    R15,R15            CLEAR REG                             62880000
         IC    R15,DEBNMEXT       GET DEB NUMBER OF EXTENTS             62960000
         DROP  R7                                                       63040000
         SR    R7,R7              CLEAR REG                             63120000
         IC    R7,QCBRELLN        GET RLN                        S22024 63200000
         TM    D0(R12),TOTTDORN   TD ON 3705                     S22024 63280000
         BZ    STAT14             NO                             S22024 63360000
         L     R5,TTEADDR         GET TTE ADDR                   S22024 63440000
         LA    R1,TRMPRFSZ        GET TTE PREFIX SIZE          @Y17XAUU 63440200
         SLR   R5,R1              POINT TO TTE PREFIX          @Y17XAUU 63440400
         USING IEDNTRM,R5         ESTABLISH ADDRESSABILITY     @Y17XAUU 63440600
LINELOOP EQU   *                                               @Y17XAUU 63440800
         LH    R1,TRMCOHRT        GET COHORT POINTER           @Y17XAUU 63441000
         L     R15,TERNMTAB       TTCIN TO TTE CONVERSION      @Y17XAUU 63441200
*                                 ROUTINE ADDRESS              @Y17XAUU 63441400
         BALR  R14,R15            FIND TTE ADDRESS             @Y17XAUU 63441600
         LR    R5,R1              GET TTE ADDRESS              @Y17XAUU 63441800
         LA    R1,TRMPRFSZ        GET TTE PREFIX SIZE          @Y17XAUU 63442000
         SLR   R5,R1              POINT TO TTE PREFIX          @Y17XAUU 63442200
         CLI   TRMTYPE,TRMNSDLC   PRE SNA LINE ENTRY           @Y17XAUU 63442400
         BE    LINEFND            YES                          @Y17XAUU 63442600
         CLI   TRMTYPE,TRMSDLC    SNA LINE ENTRY               @Y17XAUU 63442800
         BNE   LINELOOP           CHECK NEXT ENTRY             @Y17XAUU 63443000
LINEFND  EQU   *                                               @Y17XAUU 63443200
         TM    TRMBYTE2,TRMRSACT  LINE STOPPED                 @Y17XAUU 63443400
         BO    STAT16             NO                           @Y17XAUU 63443600
         OI    D0(R12),TOTTDLST   YES - SHOW LINE STOPPED        S22024 63760000
         DROP  R5                                                S22024 63840000
         B     STAT16             EXIT                           S22024 63920000
STAT14   EQU   *                                                 S22024 64000000
         LR    R5,R7              COPY RLN                       S22024 64080000
         BCTR  R5,R0              DECREMENT BY 1                        64160000
         SR    R15,R5             GET COUNT OF LCB'S TO SCAN            64240000
         SR    R14,R14            CLEAR REG                             64320000
         IC    R14,DCBEIOBX       GET LCB SIZE                          64400000
         LR    R5,R7              GET RLN                               64480000
         MR    R4,R14             GET STARTING LCB OFFSET               64560000
         AL    R5,DCBIOBAD        POINT TO IOB OF LCB                   64640000
         DROP R9                                                        64720000
         S     R5,K32             ADJUST TO START OF LCB                64800000
         USING IEDQLCB,R5                                               64880000
         TM    LCBSTAT1,LCBFREEN+LCBRECVN+LCBSENDN  LINE STOPPED ?      64960000
         BNZ   STAT16             NO                                    65040000
         OI    D0(R12),TOTTDLST   YES - SHOW LINE STOPPED               65120000
         DROP  R5                                                       65200000
*                                                                       65280000
STAT16   EQU   *                                                        65360000
         LA    R12,D4(R12)        POINT TO NEXT ENTRY                   65440000
         B     STAT2              PROCESS NEXT ENTRY                    65520000
         DROP  R8                                                       65600000
         EJECT                                                          65680000
*                                                                       65760000
*        SET INITIAL STATUS BITS FOR LINE TEST DEVICE                   65840000
*                                                                       65920000
LINESTAT EQU   *                                                        66000000
         LA    R12,TOTTDTBL       POINT TO TEST DEVICE TABLE            66080000
         LA    R11,TOTTDEND       POINT TO END OF TABLE                 66160000
STAT20   EQU   *                                                        66240000
         CR    R12,R11            END OF TABLE                          66320000
         BE    ZERO(R3)           YES - RETURN                          66400000
         L     R7,D0(R12)         GET UCB ADDR                          66480000
         LA    R7,D0(R7)          CLEAR HI ORDER BYTE                   66560000
         LTR   R7,R7              LAST ENTRY                            66640000
         BZ    ZERO(R3)           YES - RETURN                          66720000
         TM    D0(R12),TOTTDORN   TD ON 3705                     S22024 66800000
         BO    STAT40             YES                            S22024 66880000
         SPACE                                                          66960000
         USING UCBOB,R7                                                 67040000
         MVC   WORK1(D3),UCBNAME  GET UCB NAME                          67120000
         DROP  R7                                                       67200000
         BAL   R9,LCBFIND         GET LCB ADDR                          67280000
         B     STAT24             LCB FOUND                             67360000
         B     STAT28             BYPASS LCB CHECK                      67440000
STAT24   EQU   *                                                        67520000
         L     R8,WORK1           GET LCB ADDR                          67600000
         LA    R8,D0(R8)          CLEAR HI ORDER BYTE                   67680000
         USING IEDQLCB,R8                                               67760000
         TM    LCBSTAT1,LCBFREEN+LCBRECVN+LCBSENDN LINE STOPPED         67840000
         BNZ   STAT28             NO                                    67920000
         OI    D0(R12),TOTTDLST   YES - SHOW LINE STOPPED               68000000
         DROP  R8                                                       68080000
STAT28   EQU   *                                                        68160000
         LA    R12,D4(R12)        POINT TO NEXT ENTRY                   68240000
         B     STAT20             CHECK NEXT ENTRY               S22024 68320000
         SPACE 2                                                        68400000
STAT40   EQU   *                                                 S22024 68480000
         SR    R10,R10            CLEAR REG                      S22024 68560000
         IC    R10,TOTTTBEL       MAX NAME LENGTH                S22024 68640000
         AR    R7,R10             POINT TO TTE ADDR              S22024 68720000
         MVC   TTEADDR+D1(D3),D0(R7) ALLIGN ADDR                 S22024 68800000
         L     R8,TTEADDR         TTE ADDR                       S22024 68880000
         LA    R1,TRMPRFSZ        GET TTE PREFIX SIZE          @Y17XAUU 68880800
         SLR   R8,R1              POINT TO TTE PREFIX          @Y17XAUU 68881600
         USING IEDNTRM,R8         ESTABLISH ADDRESSABILITY     @Y17XAUU 68882400
         TM    TRMLINK,TRMLACTV   LINE STOPPED                 @Y17XAUU 68883200
         BO    STAT28             NO - EXIT                      S22024 69120000
         OI    D0(R12),TOTTDLST   YES - SHOW LINE STOPPED        S22024 69200000
         DROP  R8                                                S22024 69280000
         B     STAT28             CHECK NEXT ENTRY               S22024 69360000
         EJECT                                                          69440000
PLUG     EQU   *                                                 S22024 69520000
*        SET UP TEST DEVICE TABLE                                       69600000
         LA    R7,TOTTDTBL        POINT TO TEST DEVICE TABLE            69680000
         LA    R8,TOTTDTBL+D40    END OF TD TABLE                       69760000
PLUG001  EQU   *                                                        69840000
         CR    R7,R8              TABLE FILLED?                         69920000
         BE    TDTLON             ERROR - MORE THAN TEN ENTRIES  S22024 70000000
         L     R12,D0(R7)         GET NEXT ENTRY                        70080000
         LTR   R12,R12            VACANT SPACE IN TABLE?                70160000
         BZ    PLUG002            YES                                   70240000
         LA    R7,D4(R7)          NO - POINT TO NEXT SLOT               70320000
         B     PLUG001            CHECK NEXT ENTRY                      70400000
PLUG002  EQU   *                                                 S22024 70480000
         TM    TDFLG,SYM+RNTERM   TERMINAL TEST                  S22024 70560000
         BZ    PLUG008            NO                             S22024 70640000
         MVI   TRMTNT,TOTTDTRM    YES - SHOW TERMINAL TEST       S22024 70720000
         TM    TDFLG,RNTERM       TERMINAL ON RN                 S22024 70800000
         BZ    PLUG003            NO                             S22024 70880000
         OI    TRMTNT,TOTTDORN    YES - SHOW RN TERMINAL         S22024 70960000
PLUG003  EQU   *                                                 S22024 71040000
         MVC   D0(D4,R7),TRMTNT   TNT ADDR TO TD TABLE           S22024 71120000
         OI    TOTFLG10,TOTTERMS  SHOW TERMINAL TEST             S22024 71200000
         B     PLUGEND            EXIT                           S22024 71280000
PLUG008  EQU   *                  LINE ENTRY                     S22024 71360000
         LA    R14,TOTTDTBL       POINT TO TD TABLE              S22024 71400000
         TM    TDFLG,RNLINE       RN LINE TEST                   S22024 71440000
         BO    PLUG018            YES                            S22024 71520000
         MVI   WORK4,TOTTDLIN     SHOW LINE TEST                 S22024 71600000
         MVC   D0(D4,R7),WORK4    UCB ADDR TO TD TABLE           S22024 71680000
         CR    R14,R7             FIRST ENTRY                    S22024 71690000
         BE    PLUG010            YES - BYPASS MIXED CHECK       S22024 71700000
         LR    R14,R7             GET CURRENT SETTING            S22024 71710000
         S     R14,F4             LAST ENTRY ADDR                S22024 71720000
         CLI   D0(R14),TOTTDLIN   CUU TEST                       S22024 71730000
         BNE   TDERR              NO - ERROR                     S22024 71740000
PLUG010  DS    0H                 BOUNDARY ALLIGNMENT            S22024 71750000
         OI    TOTFLG06,TOTNCMFG  SET NON-CONCURRENT MODE FLAG   S22024 71760000
         B     PLUGEND            EXIT                           S22024 71840000
PLUG018  EQU   *                  RN SUB LINE                    S22024 71920000
         MVI   TRMTNT,TOTTDLIN    SHOW LINE TEST                 S22024 72000000
         OI    TRMTNT,TOTTDORN    SHOW RN LINE                   S22024 72080000
         CR    R14,R7             FIRST ENTRY                    S22024 72090000
         BE    PLUG024            YES - BYPASS MIXED CHECK       S22024 72100000
         LR    R14,R7             GET CURRENT SETTING            S22024 72110000
         S     R14,F4             LAST ENTRY ADDR                S22024 72120000
         TM    D0(R14),TOTTDORN   RN LINE TEST                   S22024 72130000
         BZ    TDERR              NO - ERROR                     S22024 72140000
PLUG024  DS    0H                 BOUNDARY ALLIGNMENT            S22024 72150000
         MVC   D0(D4,R7),TRMTNT   TNT ADDR TO TD TABLE           S22024 72160000
PLUGEND  EQU   *                                                 S22024 72240000
         BR    R9                 RETURN                         S22024 72400000
         EJECT                                                          72420000
*                                                                       72560000
LINECHK  EQU   *                                                        72640000
*                                                                       72720000
         LA    R4,TOTTDTBL        TEST DEVICE TABLE                     72800000
         LA    R7,TOTTDEND        END OF TABLE                          72880000
ALLTEST  EQU   *                                                        72960000
         CR    R4,R7              ALL ENTRIES PROCESSED                 73040000
         BE    ZERO(R11)          YES - EXIT                     S22024 73120000
         TM    D0(R4),TOTTDLIN+TOTTDORN RN LINE TEST             S22024 73200000
         BO    D0(R11)            YES - BYPASS CHECK             S22024 73280000
         TM    D0(R4),TOTTDLIN    270X LINE TEST                 S22024 73360000
         BZ    D0(R11)            NO - RETURN                    S22024 73440000
         L     R8,ZERO(R4)        GET ADDR FROM TABLE            S22024 73520000
         LA    R8,ZERO(R8)        CLEAR HI ORDER BYTE                   73600000
         STH   R8,KUCB            SAVE UCB ADDR                         73680000
         LTR   R8,R8              IS THERE AN ADDRESS                   73760000
         BZ    ZERO(R11)          NO - RETURN                           73840000
         LA    R9,CVTPTR          POINTER TO CVT                        73920000
         L     R9,ZERO(R9)        CVT ADDR                              74000000
         L     R9,ZERO(R9)        TCB ADDR                              74080000
         L     R9,FOUR(R9)        CURRENT TCB ADDR                      74160000
         L     R9,TWELVE(R9)      TIOT ADDR                             74240000
         USING TIOT,R9                                                  74320000
         LA    R9,TIOENTRY        FIRST ENTRY                           74400000
         DROP  R9                                                       74480000
         USING TIOENTRY,R9                                              74560000
GETLENGT EQU   *                                                        74640000
         SR    R3,R3              CLEAR REG 3                           74720000
         IC    R3,TIOELNGH        DD ENTRY LENGTH                       74800000
         LTR   R3,R3              ANY LENGTH ?                          74880000
         BZ    NOTFOUND           NO - ERROR                            74960000
         LA    R5,POOLSTAR-TIOESTTB DEV ENTRY LENGTH                    75040000
         DROP  R9                                                       75120000
         LR    R10,R3             SAVE LENGTH                           75200000
         SR    R3,R5              DD LENGTH - 4                         75280000
         AR    R3,R9              DEVICE                                75360000
         USING TIOESTTB,R3                                              75440000
         CLC   TIOEFSRT+ONE(TWO),KUCB ENTRY FOUND ?                     75520000
         DROP  R3                                                       75600000
         BE    FOUND              ENTRY FOUND                           75680000
         AR    R9,R10             POINT TO NEXT ENTRY                   75760000
         B     GETLENGT           CONTINUE LOOKING                      75840000
FOUND    EQU   *                                                        75920000
         LA    R4,FOUR(R4)        POINT TO NEXT LINE                    76000000
         B     ALLTEST            CHECK NEXT ENTRY                      76080000
NOTFOUND EQU   *                                                        76160000
*                                                                       76240000
*        DD CARD OMITTED                                                76320000
*                                                                       76400000
         IEDQMSG MSGID=052,FUNCT=CEC                                    76480000
         B     TDERR              GO TO PROMPTER                 S22024 76560000
         EJECT                                                          76640000
**************************************************************** S22024 76720000
*                                                              * S22024 76800000
*        ROUTINE TO DETERMINE THE TYPE OF TEST TO BE RUN --    * S22024 76880000
*        LINE OR TERMINAL. REG 10 PLUS ONE POINTS TO TD FIELD. * S22024 76960000
*                                                              * S22024 77040000
**************************************************************** S22024 77120000
TYPECHK  EQU   *                                                 S22024 77200000
         STM   R7,R11,SAVE        SAVE CALLER'S REG              S22024 77280000
         LA    R7,D0              ZERO TTE ADDR                  S22024 77360000
         TM    D1(R10),NUMER      LINE TEST                      S22024 77440000
         BO    TYPELINE           YES                            S22024 77520000
*                                                                S22024 77600000
*        FIND LENGTH OF TEST DEVICE ENTRY                        S22024 77680000
*                                                                S22024 77760000
         MVC   WORK2(D9),D1(R10)  MOVE ENTRY TO WORK AREA        S22024 77840000
         LA    R7,D9              LOOP COUNT                     S22024 77920000
         LA    R8,D0              COUNTER                        S22024 78000000
         LA    R9,WORK2           WORK AREA                      S22024 78080000
TYPELP   EQU   *                                                 S22024 78160000
         CLI   D0(R9),SLASH       END OF FIELD                   S22024 78240000
         BE    TYPEFD             YES                            S22024 78320000
         CLI   D0(R9),COMMA       END OF ENTRY                   S22024 78400000
         BE    TYPEFD             YES                            S22024 78480000
         LA    R9,D1(R9)          NEXT CHAR                      S22024 78560000
         LA    R8,D1(R8)          INCREMENT COUNTER              S22024 78640000
         BCT   R7,TYPELP          NEXT TEST                      S22024 78720000
         B     TDERR              ERROR - NAME TOO LONG          S22024 78800000
         SPACE                                                          78880000
TYPEFD   EQU   *                                                 S22024 78960000
         LTR   R8,R8              TD FIELD EMPTY                 S22024 79040000
         BZ    TDERR              YES - ERROR                    S22024 79120000
         STC   R8,LENGTH          LENGTH OF ENTRY TO PLIST       S22024 79200000
*        AN INVALID ENTRY HAS BEEN MADE IN TEST DEVICE FIELD   * S22024 79280000
         BCTR  R8,R0              LENGTH MINUS 1                 S22024 79360000
         MVC   WORK1(D8),BLANK    BLANK NAME FIELD               S22024 79440000
         EX    R8,TDEVICE         NAME TO PLIST                  S22024 79520000
         SPACE                                                          79600000
         BAL   R9,NAMESRCH        VERIFY SYMBOLIC NAME           S22024 79680000
         B     TYPRN              NORMAL RETURN                  S22024 79760000
         B     TDERR              ERROR RETURN                   S22024 79840000
         SPACE                                                          79920000
TYPRN    EQU   *                                                        80000000
         L     R7,TNTENTRY        TTE ADDR                       S22024 80080000
         USING IEDNTRM,R7                                        S22024 80160000
         LA    R9,TRMPRFSZ        GET TTE PREFIX SIZE          @Y17XAUU 80166000
         SLR   R7,R9              POINT TO TTE PREFIX          @Y17XAUU 80172000
         TM    TRMSTATE,TRMPREF   3705 MODE                    @Y17XAUU 80240000
         BZ    TYPETERM           NO                             S22024 80320000
         CLI   TRMTYPE,TRMPUNT    PU ENTRY                     @Y17XAUU 80320800
         BE    TDERR              YES - ERROR                  @Y17XAUU 80321600
         CLI   TRMTYPE,TRMLNCP    NCP ENTRY                    @Y17XAUU 80322400
         BE    TDERR              YES - ERROR                  @Y17XAUU 80323200
         CLI   TRMTYPE,TRMSSCP    SSCP ENTRY                   @Y17XAUU 80324000
         BE    TDERR              YES - ERROR                  @Y17ZAUU 80324800
         CLI   TRMTYPE,TRMSDLC    SNA LINE ENTRY               @Y17XAUU 80325600
         BE    TYPELINE           YES - PROCESS                @Y17XAUU 80326400
         CLI   TRMTYPE,TRMNSDLC   PRE SNA LINE ENTRY           @Y17XAUU 80327200
         BE    TYPELINE           YES - PROCESS                @Y17XAUU 80640000
         TM    TRMSTATE,XE0       RN TERMINAL                    S22024 80720000
         BZ    TYPETERM           YES                            S22024 80800000
         B     TDERR              ERROR EXIT                     S22024 80880000
         SPACE                                                          80960000
TYPETERM EQU   *                                                 S22024 81040000
         OI    TDFLG,SYM          SHOW TERMINAL TEST             S22024 81120000
         TM    TDFLG,LINE         LINE FLAG SET                  S22024 81200000
         BO    TDERR              YES - ERROR                    S22024 81280000
         TM    TRMSTATE,TRMPREF   3705 MODE                    @Y17XAUU 81360000
         BZ    TERM4              BRANCH                         S22024 81440000
         OI    TDFLG,RNTERM       YES - SET FLAG                 S22024 81520000
TERM4    EQU   *                                                 S22024 81600000
         LM    R7,R11,SAVE        RESTORE REG                    S22024 81680000
         BR    R9                 RETURN                         S22024 81760000
         SPACE                                                          81840000
TYPELINE EQU   *                                                 S22024 81920000
         OI    TDFLG,LINE         SHOW LINE TEST                 S22024 82000000
         TM    TDFLG,SYM          TERMINAL FLAG SET              S22024 82080000
         BO    TDERR              YES - ERROR                    S22024 82160000
         LTR   R7,R7              TTE ADDR PRESENT               S22024 82240000
         BZ    TERM4              NO - EXIT                    @Y17XAUU 82260000
         TM    TRMSTATE,TRMPREF   3705 MODE                    @Y17XAUU 82400000
         BZ    TERM8              NO                                    82480000
         OI    TDFLG,RNLINE       YES - SET FLAG                 S22024 82560000
TERM8    EQU   *                                                 S22024 82640000
         B     TERM4              RETURN                         S22024 82720000
         DROP  R7                                                S22024 82800000
TDEVICE  MVC   WORK1(D0),WORK2    GET DEVICE ENTRY               S22024 82880000
         EJECT                                                          82960000
UCBSAVE  DS    A                  UCB SAVE AREA                  S22024 83040000
SAVE     DS    5F                 SAVE AREA                      S22024 83120000
TRMTNT   DS    A                  TNT SAVE AREA                         83200000
TRMSAV1  DS    3F                 REG SAVE AREA                         83280000
TRMSAVE2 DS    F                  REG SAVE AREA                @Y17XAUU 83300000
TERNMTAB DS    A                  TERMNAME TABLE ADDR                   83360000
TNTENTRY DS    A                  TTE ADDR FOR TEST TERMINAL            83440000
WORK4    DS    F                  WORK AREA                             83520000
AVTUISV  DS    A                  ADDRESS OF BINARY SEARCH ROUTINE      83600000
WORKAREA DS    F                  WORKAREA                              83680000
TDTNT    DS    A                  SAVE AREA FOR TD TNT ADDRESS @YM08136 83720000
KUCB     DS    H                  TEST UCB ADDR SAVE AREA               83760000
         DS    0D                 BOUNDARY ALLINGMENT                   83840000
NUMBER   DC    X'0000000000000000' COUNT SAVE AREA                      83920000
NUMB     EQU   NUMBER+D3          LAST DIGIT OF COUNT                   84000000
WORK1    DS    3F                 WORK AREA                             84080000
TRMWRK   DS    CL72               TRM WORK AREA                         84160000
LCBLEN   DS    CL1                LENGTH OF LCB                         84240000
TDFLG    DC    X'00'              PROGRAM FLAG BYTE                     84320000
WORK3    DS    CL3                WORK AREA                             84400000
NO       DS    CL1                WORK AREA                             84480000
TERNMLEN DS    CL1                MAXIMUM LENGTH OF TD NAME             84560000
WORK2    DS    2D                 WORK AREA                      S22024 84640000
         SPACE                                                          84720000
PAREMLST DS    0CL8               BINARY SEARCH P-LIST                  84800000
         DS    CL1                OFFSET TO BIN. SEARCH ADDR            84880000
         DC    X'00'              FLAG BYTE                             84960000
         DC    X'00'              FLAG BYTE                             85040000
LENGTH   DS    CL1                LENGTH OF NAME                        85120000
         DC    A(WORK1)           ADDRESS OF NAME                       85200000
         SPACE                                                          85280000
         DS    0F                 BOUNDARY ALLIGNMENT                   85360000
RE       DS    0CL8               OP CONTROL P-LIST                     85440000
OCQCB    DS    F                  ADDR OF OF CONTROL QCB                85520000
         DC    X'DC'              FLAG BYTE                             85600000
         DC    XL3'00'            LINK FIELD                            85680000
VERBCODE DS    CL1                OP CONTROL COMMAND                    85760000
RELEN    DC    X'18'              P-LIST LENGTH                         85840000
RLN      DS    CL1                REL. LINE NUMBER                      85920000
RETCODE  DC    X'00'              RETURN CODE                           86000000
         DC    A(ECB)             ECB ADDR                              86080000
ADDR     DC    CL8' '             BLANK AREA                            86160000
         SPACE                                                          86240000
ECB      DS    2F                 ECB                                   86320000
         SPACE                                                          86400000
REPAREM  DC    X'0C'              FLAG BYTE                             86480000
         DC    AL3(RE)            FIRST ELEMENT                         86560000
         DC    X'80'              FLAG BYTE                             86640000
         DC    AL3(RE)            LAST ELEMENT                          86720000
CEOUT2A  DC    C'IED332I '        MSG ID                         S22024 86800000
         SPACE                                                          86880000
CEOUT2   DC    C'XXXXXXXX NOT OPENED' MSG - TEST LINE NOT OPENED        86960000
CEOUT2E  DS    0C                 END OF MSG                            87040000
REGSAVE  DS    12F                REG SAVE AREA                         87120000
K1       DC    F'1'               VALUE OF 1                            87200000
F4       DC    F'4'               VALUE OF 4                     S22024 87240000
K3       DC    F'3'               VALUE OF 3                            87280000
LCBST1AD DS    A                  LCB STATUS BYTE SAVE                  87360000
MULT     DC    8XL1'0'            WORK AREA                             87440000
TRMSLPL  DS    0F                 PARAMETER LIST FOR ACT. TERMINAL      87520000
         DC    X'0C'              FLAG BYTE                             87600000
         DC    AL3(RQELE)         FIRST REQ ELEMENT                     87680000
         DC    X'80'              FLAG BYTE                             87760000
         DC    AL3(RQELE)         LAST REQ ELEMENT                      87840000
         SPACE                                                          87920000
BLANK    DC    8X'40'             BLANK AREA                            88000000
ENDTABLE DC    X'FFFF'            END OF UCB TABLE             @G36XRUV 88040010
RNWORK   DS    C                  WORK AREA                      S22024 88080000
         SPACE                                                          88160000
*********************************************************************** 88240000
*                                                                     * 88320000
*        PARAMETER LIST FOR OPERATOR CONTROL COMMANDS                 * 88400000
*                                                                     * 88480000
*********************************************************************** 88560000
         SPACE                                                          88640000
RQELE    DS    0F                 OP CONTROL P-LIST                     88720000
RQKEY    DC    X'00'              KEY                                   88800000
RQQCBA   DC    X'000000'          QCB ADDR                              88880000
RQPRI    DC    X'DC'              PRIORITY                              88960000
RQLINK   DC    X'000000'          LINK FIELD                            89040000
RQVBCD   DC    X'00'              VERB CODE                             89120000
RQELNG   DC    X'18'              LENGTH CONSTANT                       89200000
RQRLN    DC    X'00'              RELATIVE LINE NUMBER                  89280000
RQRTCD   DC    X'00'              RETURN CODE                           89360000
RQECBA   DC    AL4(0)             ECB ADDR                              89440000
RQLADR   DC    8X'40'             LINE ADDR OR TERMINAL NAME            89520000
RQND     DS    0C                 END OF ELEMENT                 S22024 89560000
*                                                                       89600000
         SPACE                                                          89680000
TTEADDR  DC    F'0'               WORK AREA TO ALLIGN TTE ADDR          89760000
K32      DC    F'32'              VALUE OF 30                           89840000
RQMOVE   MVC   RQLADR(D1),D0(R7)  MOVE NAME TO REQUEST ELEMENT          89920000
PATCH    DC    CL200' '           IEDQWC1 PATCH AREA                    90000000
         EJECT                                                          90020000
         TLGBD                                                   S22024 90160000
         EJECT                                                          90240000
TIOT     DSECT                                                          90320000
         IEFTIOT1                                                       90400000
         EJECT                                                          90480000
         EJECT                                                          90560000
         TQCBD                                                          90640000
         EJECT                                                          90720000
         DCBD  DSORG=TX                                                 90800000
         EJECT                                                          90880000
         EJECT                                                          90960000
         TPRFD                                                          91040000
         EJECT                                                          91120000
         TLCBD                                                          91200000
         EJECT                                                          91280000
CVT      DSECT                                                          91360000
         CVT                                                            91440000
         EJECT                                                          91520000
UCB      DSECT                                                          91600000
         IEFUCBOB                                                       91680000
         EJECT                                                          91760000
         TAVTD                                                          91840000
         EJECT                                                          91920000
         TDEBD                                                          92000000
         EJECT                                                          92080000
         TTNTD                                                          92160000
         EJECT                                                          92240000
         TTRMD                                                          92320000
         EJECT                                                          92400000
         OLTCB                                                          92480000
         EJECT                                                          92560000
RESPL    RESPL                                                 @Y17XAUU 92580000
         END                                                            92640000
