         TITLE 'IEDQWC2 TRM ANALYSIS MODULE 3'                          00200020
IEDQWC2  CSECT                                                          00300022
* CHANGE ACTIVITY AS FOLLOWS:                                           00330022
*A836000                                                        SA41597 00360022
*A139200-139400,150800-151400,424900-425160,431280-432000        S22024 00365000
*A432490,432910-432960,730010-730040,743000,770460-771120        S22024 00370000
*A833100-833700,836700,856393-856396,884060-885740               S22024 00375000
*A908550,909106-909107,909195                                    S22024 00380000
*C004000,009000,712000-725000,744000                             S22024 00385000
*C813000,814000-815000,820000,832000,854040-854060               S22024 00390000
*D670000,726000,731350,735700,737700,812100-812500               S22024 00395000
**************************************************************** S22024 00400022
*                                                              *        00600022
* TITLE = TRM ANALYSIS MODULE 3                                *        00610022
*                                                              *        00620022
* MODULE NAME = IEDQWC2                                        *        00630022
*                                                              *        00640022
* DESCRIPTIVE NAME = TRM ANALYSIS MODULE 3                     *        00650022
*                                                              *        00660022
* COPYRIGHT = NONE                                             *        00670022
*                                                              *        00680022
* STATUS --                                                    *        00700022
*                                                              *        00800022
*    CHANGE LEVEL 2                                            * S22024 00900022
*                                                              *        01000022
*                                                              *        01100022
* FUNCTIONS --                                                 *        01200022
*                                                              *        01300022
*    THE PURPOSE OF THIS MODULE IS TO VERIFY THE TEST AND      *        01400022
*    OPTION FIELDS OF THE TEST REQUEST MESSAGE (TRM).          *        01500022
*                                                              *        01600022
*    THE TEST FIELD IS VERIFIED FOR VALID SYNTAX. IF AN        *        01700022
*    ERROR IS FOUND, CONTROL IS PASSED TO THE PROMPTER         *        01800022
*    MODULE (IEDQWJ).                                          *        01900022
*                                                              *        02000022
*    THE OPTION FIELD IS VERIFIED FOR VALID SYNTAX AND         *        02100022
*    REQUESTED OPTIONS ARE SET IN THE OLTCB. IF AN ERROR       *        02200022
*    IS FOUND IN THE OPTION FIELD, CONTROL IS PASSED TO        *        02300022
*    THE PROMPTER MODULE (IEDQWJ).                             *        02400022
*                                                              *        02500022
*    THIS MODULE ALSO CHECKS THE OPTION FIELD TO SEE IF        *        02600022
*    NCM WAS SPECIFIED. IF NCM WAS SPECIFIED THE MODULE        *        02700022
*    ASKS THE SYSTEM OPERATOR FOR PERMISSION TO USE THE        *        02800022
*    LINE(S) IN NCM MODE. IF PERMISSION IS NOT GRANTED, THE    *        02900022
*    CONTROL TERMINAL IS NOTIFIED AND THE TRM REJECTED.        *        03000022
*                                                              *        03100022
*                                                              *        03200022
* ENTRY POINTS --                                              *        03300022
*                                                              *        03400022
*    IEDQWC2 - CALLED BY IEDQWC1 TO ANALYZE THE TEST AND       *        03500022
*    OPTION FIELDS.                                            *        03600022
*                                                              *        03700022
*                                                              *        03800022
* INPUT --                                                     *        03900022
*                                                              *        04000022
*    REGISTERS 02,13,14,15 CONTAIN THE FOLLOWING VALUES:       *        04100022
*                                                              *        04200022
*    02 - OLTCB POINTER                                        *        04300022
*    13 - CALLER'S SAVE AREA ADDRESS                           *        04400022
*    14 - RETURN ADDRESS                                       *        04500022
*    15 - ENTRY POINT ADDRESS                                           04600022
*                                                              *        04700022
*                                                              *        04800022
* OUTPUT --                                                    *        04900022
*                                                              *        05000022
*    NONE                                                      *        05100022
*                                                              *        05200022
*                                                              *        05300022
* EXTERNAL REFERENCES --                                       *        05400022
*                                                              *        05500022
*    LINK TO IEDQWK (MESSAGE MODULE)                           *        05600022
*                                                              *        05700022
*                                                              *        05800022
* EXITS,NORMAL --                                              *        05900022
*                                                              *        06000022
*    XCTL TO IEDQWE (TEST CONTROL MODULE) WHENEVER             *        06100022
*    NCM IS REJECTED                                           *        06200022
*                                                              *        06300022
*                                                              *        06400022
* EXITS,ERROR --                                               *        06500022
*                                                              *        06600022
*    XCTL TO IEDQWJ (PROMPTER MODULE)                          *        06700022
*                                                              *        06800022
*                                                              *        06900022
* TABLES/WORK AREAS --                                         *        07000022
*                                                              *        07100022
*    UCB,DEB,DCB,QCB,OLTCB                                     *        07200022
*                                                              *        07300022
*                                                              *        07400022
* ATTRIBUTES --                                                *        07500022
*                                                              *        07600022
*    ENABLED, PROBLEM PROGRAM MODE, TRANSIENT                  *        07700022
*                                                              *        07800022
*                                                              *        07900022
* NOTES --                                                     *        08000022
*                                                              *        08100022
*    NONE                                                      *        08200022
*                                                              *        08300022
*********************************************************************** 08400020
         EJECT                                                          09400020
*                                                                       10300022
*              INITIALIZATION                                           11200020
*                                                                       11400020
*                                                                       11600020
D0       EQU   0                  DISP OF 0                             11608022
D1       EQU   1                  DISP OF 1                             11616022
D2       EQU   2                  DISP OF 2                             11624022
D3       EQU   3                  DISP OF 3                             11632022
D4       EQU   4                  DISP OF 4                             11640022
D8       EQU   8                  DISP OF 8                             11648022
D12      EQU   12                 DISP OF 12                            11656022
D16      EQU   16                 DISP OF 16                            11664022
D17      EQU   17                 DISP OF 17                            11672022
D20      EQU   20                 DISP OF 20                            11680022
D24      EQU   24                 DISP OF 24                            11688022
D40      EQU   40                 DISP OF 40                     S22024 11689000
TRMEND   EQU   72                 MAXIMUM LENGTH OF TRM                 11690022
BLANK    EQU   X'40'              A BLANK                               11692022
RTNSFLG  EQU   X'80'              END OF TEST FIELD                     11696022
RTNDFLG  EQU   X'40'              INCLUSIVE ROUTINES                    11704022
RTNCFLG  EQU   X'20'              SEPARATE ROUTINE ENTRY                11712022
RTNNFLG  EQU   X'10'              SECOND PASS FLAG                      11720022
RTNIFLG  EQU   X'08'              INCLUSIVE RTN LOOP FLAG               11728022
SLASH    EQU   X'61'              SLASH                                 11736022
COMMA    EQU   X'6B'              COMMA                                 11744022
DASH     EQU   X'60'              DASH                                  11752022
F0       EQU   X'F0'              EBCDIC 0                              11760022
F9       EQU   X'F9'              EBCDIC 9                              11768022
INCLUS   EQU   X'80'              INCLUSIVE ROUTINES                    11776022
PARMREG0 EQU   0                  REG 0                                 11900022
PARMREG1 EQU   1                  REG 1                                 12000022
R0       EQU   0                  REG 0                                 12100022
R1       EQU   1                  REG 1                                 12200022
R2       EQU   2                  REG 2                                 12300022
R3       EQU   3                  REG 3                                 12400022
R4       EQU   4                  REG 4                                 12500022
R5       EQU   5                  REG 5                                 12600022
R6       EQU   6                  REG 6                                 12700022
R7       EQU   7                  REG 7                                 12800022
R8       EQU   8                  REG 8                                 12900022
R9       EQU   9                  REG 9                                 13000022
R10      EQU   10                 REG 10                                13100022
R11      EQU   11                 REG 11                                13200022
R12      EQU   12                 REG 12                                13300022
R13      EQU   13                 REG 13                                13400022
R14      EQU   14                 REG 14                                13500022
R15      EQU   15                 REG 15                                13600022
XFF      EQU   X'FF'              MASK FIELD                            13700022
EQUAL    EQU   X'7E'              = CHAR                                13800022
END      EQU   X'80'              CONTROL BIT                           13900022
LEV0     EQU   X'F0'              EP OPTION LEVEL 0              S22024 13920022
LEV3     EQU   X'F3'              EP OPTION LEVEL 3              S22024 13940022
D7       EQU   7                  DISP OF 7                             13970022
D29      EQU   29                 DISP OF 29                            14040022
D33      EQU   33                 DISP OF 33                            14110022
D5       EQU   5                  DISP OF 5                             14180022
D9       EQU   9                  DISP OF 9                             14250022
TRMLEN   EQU   72                 TRM BUFFER SIZE                       14320022
OLTPRFX  EQU   C'T'               TEST SECTION PREFIX (DEFAULT)         14390022
KA       EQU   C'A'               CHAR A                                14460022
KZ       EQU   C'Z'               CHAR Z                                14530022
X0F      EQU   X'0F'              MASK FIELD                            14600022
TLDF     EQU   X'02'              TL DEFAULT COUNT                      14670022
ELDF     EQU   X'02'              EL DEFAULT COUNT                      14740022
F5       EQU   X'F5'              VALUE OF 5                            14810022
EXTLEN   EQU   54                 EXT BFR SIZE                          14880022
TDMAX    EQU   11                 MAX + 1 TEST DEVICE COUNT      S22024 14950010
YES      EQU   X'E8'              CHAR Y                                15020022
TYPE1CA  EQU   X'15'              UCB ID 3705 TYPE 1 CA          S22024 15080022
TYPE2CA  EQU   X'25'              UCB ID OF 3705 TYPE 2 CA       S22024 15140022
         SPACE 2                                                        15200020
         USING IEDQWC2,R15                                              15280022
         USING TOTOLTCB,R2                                              15360022
IEDQWC2  IEDHJN STARC2,HJN                                              15440022
         DROP  R15                                                      15520022
         SPACE                                                          15600022
         SAVE  (14,12)            SAVE CALLER'S REG.                    15680022
         LR    R6,R15                   LOAD BASE                       15800020
         USING IEDQWC2,R6                                               16000020
         LA    R3,TOTSAVE4        GET MY SAVE AREA ADDR                 16200022
         ST    R3,D8(R13)         SAVE IN CALLER'S SAVE                 16400022
         ST    R13,D4(R3)         SAVE CALLER'S                         16600022
         LR    R13,R3                   SET R13 TO SAVE AREA            16800020
         SPACE                                                          17060022
         MVI   TOTCROLT,BLANK     BLANK CURRENT                         17080022
         MVC   TOTCROLT+D1(D7),TOTCROLT OLT DEVICE FIELD                17090022
         MVI   TOTOLTTB,BLANK     BLANK OLT                             17100022
         MVC   TOTOLTTB+D1(D29),TOTOLTTB SUFFIX TABLE                   17110022
*                                                                       17200020
*                                                                       17400020
*              FIND THE TESTS FIELD                                     17600020
*                                                                       17800020
*                                                                       18000020
         LA    R3,TOTTRMBF        POINT TO TRM BUFFER                   18700022
         MVC   TRMWRK(TRMLEN),D0(R3) TRM TO WORK AREA                   19400022
         LA    R1,TRMWRK               SET UP POINTER                   19600020
         LA    R5,TRMWRK+TRMEND   POINT TO END OF TRM BUFFER            19700022
         LA    R10,D2             SET UP COUNTER                        19800022
FLDHUNT  EQU   *                                                        19900022
         CLI   D0(R1),SLASH       END OF FIELD                          20000022
         BE    FLDFIND                 YES BRANCH                       20200020
         LA    R1,D1(R1)          BUMP POINTER                          20400022
         CR    R1,R5              END OF BUFFER ?                       20460022
         BE    TEST1              YES - ERROR                           20520022
         B     FLDHUNT                 GO LOOK AGAIN                    20600020
FLDFIND  EQU   *                                                        20800022
         LA    R1,D1(R1)          BUMP PASS SLASH                       20900022
         BCT   R10,FLDHUNT        CHECK FOR SLASH AGAIN                 21000022
TESFLD   EQU   *                                                        21200020
*                                      R1 HAS ADDR OF TEST FIELD        21400020
         SR    R10,R10            CLEAR REG 10                          21460022
         LA    R10,TRMLEN         LENGTH OF TRM                         21520022
         MVI   TOTCROLT,OLTPRFX   INIT TEST PREFIX                      21560022
         CLI   D0(R1),KA          CHECK FOR ALPHA PREFIX                21600022
         BL    TEST1              BR LOW - ERROR                        21640022
         CLI   D0(R1),KZ          CHECK ALPHA RANGE                     21700022
         BH    TEST0              BR HIGH - CHECK FOR NUMERIC           21760022
         MVC   TOTCROLT(D1),D0(R1) PUT ALPHA IN OLT TABLE               21820022
         LA    R1,D1(R1)          INCREMENT POINTER                     21880022
TEST0    EQU   *                                                        21940022
         MVC   WORK1(D4),D0(R1)   MOVE TEST TO WORK AREA                22000022
         NC    WORK1(D4),KF0      CLEAR LOW ORDER 4 BYTES               22200022
         CLC   WORK1(D4),KF0      ALL NUMERIC?                          22400022
         BNE   TEST1                   NO BRANCH                        22600020
TEST2    EQU   *                                                        22800020
         MVC   TOTCROLT+D1(D4),D0(R1) MOVE IN NUMERIC ID                22900022
         LA    R1,D4(R1)          BUMP PASS DEVICE TYPE                 22950022
         SPACE                                                          23008022
         SR    R4,R4              CLEAR REG 4                           23016022
         LR    R5,R1              POINT TO TEST SUFFIX IN TRM           23024022
         LA    R12,TOTOLTTB       POINT TO START OF OLT SUFFIX TABLE    23084022
         SPACE                                                          23152022
TEST2E   EQU   *                                                        23160022
         CLI   D0(R1),KA          VALUE LESS THAN A                     23164022
         BL    TEST1              ERROR - NOT AN ALPHA                  23168022
         CLI   D0(R1),KZ          VALUE GREATER THAN Z                  23172022
         BH    TEST1              ERROR - NOT AN ALPHA                  23176022
         SPACE                                                          23184022
         BAL   R9,ALPCHK               CHECK FOR VALID ALPHA FIELD      23200020
         CLI   D0(R1),COMMA       COMMA DELIMITER                       23400022
         BNE   TEST4                     NO                             23600020
         TM    D1(R1),F0          YES - NEXT FIELD NUMERIC              23800022
         BNO   TEST4                       NO                           24000020
         LA    R9,NUMCHK               SET UP FOR RETURN                24200020
NUMCHK   EQU   *                       CHECK VALIDITY OF FIELD          24400020
         LA    R1,D1(R1)          BUMP PASS DELIMITER                   24600022
         SR    R10,R10                 CLEAR COUNTER                    24800020
NUMCHK1  EQU   *                                                        25000020
         CLI   D0(R1),F0          CHAR LESS THAN ZERO                   25400022
         BL    TEST1              YES - ERROR                           25800022
         CLI   D0(R1),F9          CHAR GREATER THAN NINE ?              26200022
         BH    TEST1              YES - ERROR                           26600022
         B     RTNCHK             VERIFY ROUTINE NUMBER*                27000022
TEST4    EQU   *                                                        27800020
         LA    R1,D1(R1)          BUMP PASS DELIMITER                   28000022
         LR    R5,R1              POINT TO ALPHA SUFFIX                 28100022
         BAL   R9,ALPCHK               CHECK FOR VALID ALPHA FIELD      28200020
         B     TEST4                   CONTINUE IN LOOP                 28400020
ALPCHK   EQU   *                                                        28600020
         SR    R10,R10                 CLEAR COUNTER                    28800020
ALPCHK1  EQU   *                                                        29000020
         CLI   D0(R1),SLASH       END OF TEST FIELD                     29200022
         BE    TEST6                     YES                            29400020
         CLI   D0(R1),COMMA       COMMA DELIMITER                       29600022
         BE    TEST7                     YES                            29800020
         CLI   D0(R1),DASH        HYPHEN DELIMITER                      30000022
         BE    TEST7                     YES                            30200020
         CLI   D0(R1),KA          CHAR A OR GREATER                     30400022
         BL    TEST1                     NO                             30600020
         CLI   D0(R1),KZ          CHAR Z OR LESS                        30800022
         BH    TEST1                     NO                             31000020
         LA    R10,D1(R10)        BUMP COUNTER                          31200022
         LA    R1,D1(R1)          BUMP CHAR POINTER                     31400022
         B     ALPCHK1                 CONTINUE IN LOOP                 31600020
TEST6    EQU   *                                                        31800020
         LA    R9,OPTCHK               GET EXIT ADDRESS                 32000020
TEST7    EQU   *                                                        32200020
         CH    R10,H1             ONE OR LESS CHAR                      32400022
         BL    TEST1                     NO                             32600020
         CH    R10,H3             THREE OF LESS CHAR                    32800022
         BH    TEST1                     NO                             33000020
         BCTR  R10,R0             DECREMENT FOR EX                      33001022
         EX    R10,ALPSUFX        MOVE CHAR TO SUFFIX TABLE             33002022
         LA    R12,D3(R12)        NEXT SLOT IN SUFFIX TABLE             33003022
         CLI   D0(R1),DASH        INCLUSIVE TEST                        33007022
         BNE   TEST7A             NO                                    33012022
         OI    TOTFLG03,TOTTSINC  TURN ON INCLUSIVE FLAG                33018022
         LA    R1,D1(R1)          POINT PASS DELIMITER                  33021022
         LR    R5,R1              POINT TO ALPHA SUFFIX                 33022022
         SR    R11,R11            CLEAR REG 11                          33024022
         LA    R12,TOTOLTTB       POINT TO START OF SECTION ID TABLE    33030022
TESTAA   EQU   *                                                        33036022
         MVC   WORK(D1),D0(R1)    GET NEXT FIELD                        33042022
         CLI   WORK,KA            CHECK FOR INCLUSIVE ALPHA             33051022
         BL    TEST1              BR LOW - ERROR                        33060022
         CLI   WORK,KZ            CHECK LIMIT                           33066022
         BH    TEST1              BR HIGH - ERROR                       33072022
         LA    R7,TOTOLTTB+D33    END OF TABLE                          33078022
         SPACE                                                          33079022
TESTA1   EQU   *                                                        33080022
         CR    R12,R7             END OF TABLE?                         33081022
         BE    TEST1              YES                                   33082022
         CLC   D0(D3,R12),BLK3                                          33083022
         BE    ALPCHK             YES                                   33084022
         LA    R12,D3(R12)        POINT TO NEXT SLOT                    33085022
         B     TESTA1             CHECK NEXT SLOT                       33086022
         SPACE                                                          33086322
ALPSUFX  MVC   D0(D1,R12),D0(R5)  SECT SUFFIX TO TABLE                  33086622
         SPACE                                                          33087022
TEST7A   EQU   *                                                        33192022
         BR    R9                      EXIT                             33200020
TEST1    EQU   *                                                        33400020
         OI    TOTFLG03,TOTTSTER  SET TEST ID ERROR FLAG                33600022
TEST1A   EQU   *                                                        33800022
         L     R13,D4(R13)        CALLER'S SAVE                         34000022
         LM    R14,R1,D12(R13)    CALLER'S REG                          34200022
         XCTL  (2,12),EP=IEDQWJ   ERROR EXIT                            34400022
*                                                                       34600020
*                                                                       34800020
*        CHECK OPTIONS FIELD FOR VALID OPTIONS AND TURN ON              35000020
*        OPTION BITS IN OLTCB.  R1 HAS ADDR OF SLASH                    35200020
*        PRECEEDING THE OPTION FIELD                                    35400020
*                                                                       35600020
*                                                                       35800020
OPTCHK   EQU   *                                                        36000020
         TM    TOTFLG03,TOTTSINC  INCLUSIVE TEST SECTIONS ?             36010022
         BZ    OPTCHK0            NO - CONTINUE                         36020022
         CLC   TOTOLTTB(D3),TOTOLTTB+D3 A GRT/EQ B ?                    36030022
         BNL   TEST1              YES - ERROR                           36040022
OPTCHK0  EQU   *                                                        36050022
         TM    TOTFLG03,TOTAPOER   AP OPTION ERROR ?                    36060022
         BO    OPTERR             YES                                   36120022
         LA    R1,D1(R1)          POINT PASS SLASH                      36200022
         CLI   D0(R1),SLASH       END OF FIELD                          36400022
         BE    OPTEND                  YES BRANCH                       36600020
OPTCHK1  EQU   *                                                        36800022
         CLC   D0(D2,R1),TL       TEST LOOP?                            36900022
         BE    TLOPT              YES BRANCH                            37000022
         CLC   D0(D3,R1),NTL      NO TEST LOOP?                         37100022
         BE    NTLOPT             YES BRANCH                            37200022
         CLC   D0(D2,R1),EL       ERROR LOOP?                           37300022
         BE    ELOPT              YES BRANCH                            37400022
         CLC   D0(D3,R1),NEL      NO ERROR LOOP?                        37500022
         BE    NELOPT             YES BRANCH                            37600022
         CLC   D0(D2,R1),CP       CONTROL PRINT?                        37700022
         BE    CPOPT              YES BRANCH                            37800022
         CLC   D0(D3,R1),NCP      NO CONTROL PRINT?                     37900022
         BE    NCPOPT             YES BRANCH                            38000022
         CLC   D0(D3,R1),NMI      NO MANUAL INTERVENTION?               38100022
         BE    NMIOPT             YES BRANCH                            38200022
         CLC   D0(D2,R1),MI       MANUAL INTERVENTION?                  38300022
         BE    MIOPT              YES BRANCH                            38400022
         CLC   D0(D2,R1),AP       ALTERNATE PRINTER?                    38500022
         BE    APOPT              YES BRANCH                            38600022
         CLC   D0(D3,R1),NAP      NO ALTERNATE PRINTER?                 38700022
         BE    NAPOPT             YES BRANCH                            38800022
         CLC   D0(D2,R1),EP       ERROR PRINT?                          38900022
         BE    EPOPT              YES BRANCH                            39000022
         CLC   D0(D3,R1),NEP      NO ERROR PRINT?                       39100022
         BE    NEPOPT             YES BRANCH                            39200022
         CLC   D0(D2,R1),CM       CONCURRENT MODE?                      39300022
         BE    CMOPT              YES BRANCH                            39400022
         CLC   D0(D3,R1),NCM      NON-CONCURRENT MODE?                  39500022
         BE    NCMOPT             YES BRANCH                            39600022
         CLC   D0(D3,R1),EXT      EXTERNAL DATA?                        39700022
         BE    EXTOPT             YES BRANCH                            39800022
         CLC   D0(D2,R1),BK       BREAK OPTION                   S22024 39820010
         BE    BKOPT              YES BRANCH                     S22024 39840010
         CLC   D0(D3,R1),NBK      NO BREAK OPTION                S22024 39860010
         BE    NBKOPT             YES BRANCH                     S22024 39880010
         CLC   D0(D2,R1),TR       TRACE?                                39900022
         BE    TROPT              YES BRANCH                            40000022
         CLC   D0(D3,R1),NTR      NO TRACE?                             40100022
         BE    NTROPT             YES                                   42480022
         CLC   D0(D2,R1),NP       NO PRINT OPTION                S22024 42490022
         BE    NPOPT              YES                            S22024 42500022
         CLC   D0(D3,R1),TTP      TEST PRIMARY PATH              S22024 42504000
         BE    TTPOPT             YES                            S22024 42508000
         CLC   D0(D3,R1),TAP      TEST ALTERNATE PATH            S22024 42512000
         BE    TAPOPT             YES                            S22024 42516000
*                                                                       42520022
*        OPTION FIELD IN ERROR                                          42600020
*                                                                       42800020
OPTERR   EQU   *                                                        43000022
         OI    TOTFLG03,TOTOPTER  SET OPTION ERROR BIT                  43060022
         B     TEST1A             EXIT TO PROMPTER                      43120022
         SPACE                                                          43128000
TTPOPT   DS    0H                 BOUNDARY ALLIGNMENT            S22024 43136000
         NI    $TOTFLG1,XFF-$TERMSEC TEST PRIMARY PATH           S22024 43144000
         LA    R1,D3(R1)          POINT PASS OPTION              S22024 43152000
         B     SLCHK              CHECK NEXT ENTRY               S22024 43160000
         SPACE                                                          43168000
TAPOPT   DS    0H                 BOUNDARY ALLIGNMENT            S22024 43176000
         OI    $TOTFLG1,$TERMSEC  TEST ALTERNATE PATH            S22024 43184000
         LA    R1,D3(R1)          POINT PASS OPTION              S22024 43192000
         B     SLCHK              CHECK NEXT ENTRY               S22024 43200000
         SPACE                                                          43200810
BKOPT    DS    0H                 BOUNDARY ALLINMENT             S22024 43201610
         NI    TOTFLG09,XFF-TOTNOBRK CLEAR NO BREAK FLAG         S22024 43202410
         LA    R1,D2(R1)          POINT PASS OPTION              S22024 43203210
         B     SLCHK              CHECK NEXT ENTRY               S22024 43204010
         SPACE                                                          43204810
NBKOPT   DS    0H                 BOUNDARY ALLIGNMENT            S22024 43205610
         OI    TOTFLG06,TOTNCMFG  SHOW NON CONCURRENT MODE       S22024 43206010
         OI    TOTFLG09,TOTNOBRK  SET NO BREAK FLAG              S22024 43206410
         LA    R1,D3(R1)          POINT PASS OPTION              S22024 43207210
         B     SLCHK              CHECK NEXT OPTION              S22024 43208010
         SPACE                                                          43209022
TROPT    EQU   *                                                        43218022
         OI    $OLTFLGS,$TRACE    TURN ON TRACE BIT                     43227022
         LA    R1,D2(R1)          POINT PASS OPTION                     43236022
         B     SLCHK              CHECK NEXT ENTRY                      43245022
         EJECT                                                          43249022
         SPACE                                                          43254022
NTROPT   EQU   *                                                        43263022
         NI    $OLTFLGS,XFF-$TRACE TURN OFF TRACE OPT                   43272022
         LA    R1,D3(R1)          POINT PASS OPTION                     43281022
         B     SLCHK              CHECK NEXT ENTRY                      43290022
         SPACE 2                                                        43291022
NPOPT    EQU   *                                                 S22024 43292022
         OI    TOTFLG03,TOTIMNCP  SHOW NCP OPTION                S22024 43293022
         OI    $ERROPT,$NERRPRT   SHOW NEP OPTION                S22024 43294022
         LA    R1,D2(R1)          POINT PASS OPTION              S22024 43295022
         B     SLCHK              CHECK NEXT ENTRY               S22024 43296022
         SPACE 2                                                        43300022
TLOPT    EQU   *                                                        43400020
         OI    $ERROPT,$LOOPTST   TURN ON TL FLAG                       43600022
         LA    R10,D0             SET COUNTER                           43800022
         LA    R1,2(R1)                POINT PAST TL                    44000020
         LR    R3,R1                   SAVE POINTER                     44200020
TLOPT3   EQU   *                                                        44400022
         CLI   D0(R1),COMMA       END OF ENTRY                          44500022
         BE    TLOPT1                  YES BRANCH                       44600020
         CLI   D0(R1),SLASH       END OF FIELD                          44800022
         BE    TLOPT2                  YES BRANCH                       45000020
         LA    R1,D1(R1)          BUMP POINTER                          45200022
         LA    R10,D1(R10)        BUMP COUNTER                          45400022
         B     TLOPT3                  GO LOOK AGAIN                    45600020
TLOPT1   EQU   *                                                        45800020
TLOPT1A  LTR   R10,R10                   ANY NUMBERS GIVEN?             46000020
         BZ    TLOPT4                  NO BRANCH                        46200020
         CLI   D0(R3),F0          1ST NUMERIC ZERO                      46400022
         BNE   TRM202                    NO                             46600020
         TM    D1(R3),F0          YES - IS LOOP COUNT ZERO              46800022
         BNO   OPTERR                      YES: ERROR                   47000020
TRM202   EQU   *                                                        47200020
         XC    WORK1,WORK1                                              47400020
         XC    WORK2,WORK2             CLEAR WORK AREAS                 47600020
         BCTR  R10,R0             DECREMENT COUNT                       47800022
         LA    R7,D3              SET COMPARAND                         48000022
         CR    R10,R7                   MORE THAN 4 DIGITS?             48200020
         BH    OPTERR                  YES BRANCH                       48400020
         EX    R10,MOVE                MOVE NUMERICS TO WORKAREA        48600020
         EX    R10,AND                 CLEAR NUMERICS                   48800020
         EX    R10,COMPARE             ALL VALID NUMERICS?              49000020
         BNE   OPTERR                    NO                             49200020
         LA    R7,D7              SET COUNT                             49400022
         SR    R7,R10                   SUBTRACT NO. OF DIGITS          49600020
         LA    R8,WORK2(R7)            SET UP REG FOR MOVE              49800020
         EX    R10,MOVETL              MOVE LOOP COUNT TO WORK AREA     50000020
         PACK  WORK1+D5(D3),WORK2+D4(D4) PACK NUMBER                    50200022
         OI    WORK1+D7,X0F       MAKE SURE NUMBER IS +                 50400022
         SR    R10,R10                                                  50600020
         CVB   R10,WORK1                                                50800020
         STH   R10,TOTTLCNT       PUT TL COUNT IN OLTCB                 51000022
TLOPT5   TM    TRMFLG,END              END OF FIELD?                    51200020
         BO    OPTEND                  YES BRANCH                       51400020
         LA    R1,D1(R1)          POINT PASS DELIMITER                  51600022
         B     OPTCHK1            GO EXAMINE THE NEXT OPTION FIELD      51800022
TLOPT2   EQU   *                                                        52000020
         OI    TRMFLG,END              TURN ON END FLAG                 52200020
         B     TLOPT1A            GO SEE IF TEST LOOP COUNT SPECIFIED   52400022
TLOPT4   EQU   *                                                        52600020
         LA    R10,TLDF                                                 52700022
         STH   R10,TOTTLCNT       PUT TL DEFAULT COUNT IN OLTCB         52800022
         B     TLOPT5             CHECK FOR NEXT OPTION                 52900022
         SPACE 2                                                        53100022
NTLOPT   EQU   *                                                        53200020
         NI    $ERROPT,X'FF'-$LOOPTST  TURN OFF TL FLAG                 53300022
         LA    R1,D3(R1)          POINT PAST OPTION                     53400022
         B     SLCHK              GO CHECK FOR NEXT OPTION FIELD        53600022
         SPACE 2                                                        53700022
MOVETL   MVC   D0(D0,R8),D0(R3)   MOVE TL OPTION COUNT                  53800022
MOVE     MVC   TOTWKSPC(D0),D0(R3) MOVE TL OPT COUNT                    53900022
AND      NC    TOTWKSPC(D0),MASK0 MASK OUT UNWANTED BIT                 54000022
COMPARE  CLC   TOTWKSPC(D0),MASK0 NUMERIC                               54100022
         SPACE 2                                                        54500022
NELOPT   EQU   *                                                        54560022
         NI    $ERROPT,XFF-$LOOPERR TURN OFF ERROR LOOP FLAG            54620022
         LA    R1,D3(R1)          POINT PASS OPTION                     54680022
         B     SLCHK              CHECK FOR NEXT OPTION                 54740022
NCMOPT   EQU   *                                                        54800020
         OI    TOTFLG06,TOTNCMFG  SET NON-CONCURRENT MODE FLAG          55000022
         LA    R1,D3(R1)          POINT PASS NCM                        55100022
         B     SLCHK              CHECK NEXT OPTION                     55200022
         SPACE                                                          55300022
NAPOPT   EQU   *                                                        55360022
         NI    $ERROPT,XFF-$ALTPRNT TURN OFF AP OPTION FLAG             55420022
         LA    R1,3(R1)                 POINT PASS NAP                  55480022
         SPACE 2                                                        55540022
SLCHK    EQU   *                                                        55600020
         CLI   D0(R1),SLASH       END OF FIELD                          55800022
         BE    OPTEND                  YES BRANCH                       56000020
         CLI   D0(R1),COMMA       END OF ENTRY                          56200022
         BNE   OPTERR                  OPTION FIELD ERROR               56400020
         LA    R1,D1(R1)          POINT PASS COMMA                      56600022
         B     OPTCHK1            CHECK NEXT OPTION                     56800022
         SPACE 2                                                        56900022
ELOPT    EQU   *                                                        57000020
         OI    $ERROPT,$LOOPERR   TURN ON LOOP ON ERROR FLAG            57200022
         LA    R10,D0             FIND IF NUMBER GIVEN                  57400022
         LA    R1,D2(R1)          POINT PASS EL                         57600022
         LR    R3,R1                   SAVE POINTER                     57800020
ELOPT3   EQU   *                                                        58000022
         CLI   D0(R1),COMMA       END OF ENTRY                          58100022
         BE    ELOPT1                  YES BRANCH                       58200020
         CLI   D0(R1),SLASH       END OF FIELD                          58400022
         BE    ELOPT2                  YES BRANCH                       58600020
         LA    R10,D1(R10)        BUMP COUNTER                          58800022
         LA    R1,D1(R1)          BUMP POINTER                          59000022
         B     ELOPT3                  GO LOOK AGAIN                    59200020
ELOPT1   EQU   *                                                        59400020
ELOPT1A  LTR   R10,R10                   ANY NUMBERS GIVEN?             59600020
         BZ    ELOPT4                  NO BRANCH                        59800020
         CLI   D0(R3),F0          1ST NUMERIC ZERO                      60000022
         BNE   TRM204                    NO                             60200020
         TM    D1(R3),F0          YES - AND SECOND                      60400022
         BNO   OPTERR                      LOOP COUNT IS 0              60600020
TRM204   EQU   *                                                        60800020
         XC    WORK1,WORK1                                              61000020
         XC    WORK2,WORK2             CLEAR WORK AREAS                 61200020
         BCTR  R10,R0             DECREMENT COUNT BY ONE                61400022
         LA    R7,D3              SET COMPARAND                         61600022
         CR    R10,R7                   GT 4?                           61800020
         BH    OPTERR                  YES BRANCH                       62000020
         EX    R10,MOVE                MOVE LOOP COUNT TO WORKAREA      62200020
         EX    R10,AND                 CLEAR NUMERICS                   62400020
         EX    R10,COMPARE             ALL VALID NUMERICS?              62600020
         BNE   OPTERR                    NO: GO TO PROMPTER             62800020
         LA    R7,D7              SET COUNT                             63000022
         SR    R7,R10                   SUBTRACT NO OF DIGITS           63200020
         LA    R8,WORK2(R7)            SET UP REG FOR MOVE              63400020
         EX    R10,MOVETL              MOVE LOOP COUNT TO WORK AREA     63600020
         PACK  WORK1+D5(D3),WORK2+D4(D4) PACK THE NUMBER                63800022
         OI    WORK1+D7,X0F       MAKE SURE NUMBER IS +                 64000022
         SR    R10,R10                                                  64200020
         CVB   R10,WORK1                CONVERT NUMBER                  64400020
         STH   R10,$ERRLPCT       SET LOOP ON ERROR COUNT               64600022
ELOPT5   TM    TRMFLG,END              END OF FIELD                     64800020
         BO    OPTEND                  YES BRANCH                       65000020
         LA    R1,D1(R1)          BUMP PAST DELIMITER                   65200022
         B     OPTCHK1            GO CHECK FOR NEXT OPTION              65400022
ELOPT2   EQU   *                                                        65600020
         OI    TRMFLG,END                                               65800020
         B     ELOPT1A                 TURN ON END FLAG AND BRANCH      66000020
ELOPT4   EQU   *                                                        66200020
         LA    R10,ELDF           SET EL DEFAULT COUNT                  66300022
         STH   R10,$ERRLPCT       SET LOOP ON ERROR COUNT (DEFAULT)     66400022
         B     ELOPT5             CHECK FOR NEXT OPTION                 66500022
         SPACE 2                                                        66700022
         SPACE                                                          66800022
NCPOPT   EQU   *                                                        66900022
         LA    R1,D3(R1)          BUMP POINTER                          67030022
         OI    TOTFLG03,TOTIMNCP  SET NCP INTERMEDIATE FLAG             67060022
         SPACE 2                                                        67120022
         B     SLCHK              CHECK FO NEXT OPTION                  67200022
NEPOPT   EQU   *                                                        67400020
         OI    $ERROPT,$NERRPRT   TURN ON NEP FLAG                      67600022
         LA    R1,D3(R1)          POINT PASS NEP                        67700022
         B     SLCHK              CHECK FOR NEXT OPTION                 67800022
         SPACE 2                                                        67900022
APOPT    EQU   *                                                        68000020
         LA    R1,D2(R1)          BUMP POINTER                          68400022
         LA    R9,D9              SET COUNTER                           68500022
APOPT1   EQU   *                                                        68600022
         CLI   D0(R1),SLASH       END OF FIELD                          68700022
         BE    OPTEND                  YES BRANCH                       68800020
         CLI   D0(R1),COMMA       END OF ENTRY                          69000022
         BE    APOPT2                  YES BRANCH                       69200020
         LA    R1,D1(R1)          BUMP POINTER                          69400022
         BCT   R5,APOPT1          CHECK FOR END OF AP NAME              69500022
         B     OPTERR             ERROR                                 69600022
         SPACE 2                                                        69700022
APOPT2   EQU   *                                                        69800022
         LA    R1,D1(R1)          BUMP POINTER                          69900022
         B     OPTCHK1            CHECK NEXT OPTION                     70000022
         SPACE 2                                                        70100022
CPOPT    EQU   *                                                        70200020
         NI    TOTFLG03,XFF-TOTIMNCP TURN OFF NCP INTERMED. FLG         70300022
         LA    R1,D2(R1)          BUMP POINTER                          70400022
         B     SLCHK              CHECK FOR NEXT OPTION                 70600022
         SPACE 2                                                        70700022
EPOPT    EQU   *                                                        70800020
         LA    R1,2(R1)                BUMP POINTER PAST EP             71000020
         CLI   D0(R1),COMMA       DELIMITER                      S22024 71200022
         BE    EPOPT4             YES                            S22024 71300022
         CLI   D0(R1),SLASH       DELIMITER                      S22024 71400022
         BE    EPOPT4             YES                            S22024 71500022
         SPACE                                                          71600022
         CLI   D0(R1),LEV0        LEVEL LESS THAN 0              S22024 71700022
         BL    OPTERR             YES - ERROR                    S22024 71800022
         CLI   D0(R1),LEV3        LEVEL GREATER THAN 3           S22024 71900022
         BH    OPTERR             YES - ERROR                    S22024 72000022
         SPACE                                                          72100022
         MVC   WORK1(D1),D0(R1)   LEVEL VALUE TO WORK AREA       S22024 72200022
EPOPT2   EQU   *                                                 S22024 72300022
         NI    WORK1,X0F          CLEAR UNWANTED BITS            S22024 72400022
         MVC   TOTFLG08(D1),WORK1 SET EP LEVEL FOR DPRINT        S22024 72500022
         LA    R1,D1(R1)          BUMP POINTER                          72800022
         B     SLCHK                   YES GO LOOK FOR NEXT OPTION      73000020
         SPACE                                                          73001022
EPOPT4   EQU   *                                                 S22024 73002022
         MVI   WORK1,LEV3         SET DEFAULT LEVEL              S22024 73003022
         B     EPOPT2             SET VALUE IN OLTCB             S22024 73004022
         SPACE 2                                                        73009022
CMOPT    EQU   *                                                        73018022
         NI    TOTFLG06,XFF-TOTNCMFG SHOW CONCURRENT MODE               73027022
         LA    R1,2(R1)           POINT PASS CM                         73036022
         B     SLCHK              CHECK FOR NEXT OPTION                 73045022
         SPACE 2                                                        73054022
EXTOPT   EQU   *                                                        73063022
         SR    R5,R5              INITIALIZE DATA COUNTER               73072022
         CLI   D3(R1),EQUAL       = CHAR DELIMITER                      73081022
         BNE   OPTERR             NO, ERRROR                            73090022
         LA    R15,EXTLEN         DATA COUNT LENGTH                     73099022
         LA    R4,D4(R1)          POINT TO DATA FIELD                   73108022
EXTOPT1  EQU   *                                                        73117022
         CLI   D0(R4),SLASH       / CHAR DELIMITER                      73144022
         BE    EXTOPT2            YES                                   73153022
         LA    R5,D1(R5)          INCREMENT CHAR COUNTER                73162022
         LA    R4,D1(R4)          POINT TO NEXT CHAR                    73171022
         CR    R5,R15             MAXIMUM NO. OF CHAR ?                 73180022
         BH    OPTERR             TOO MANY CHAR                         73189022
         B     EXTOPT1            CHECK NEXT CHAR                       73198022
         SPACE 2                                                        73216022
EXTOPT2  EQU   *                                                        73225022
         LTR   R5,R5                                                    73228022
         BZ    OPTERR             ERROR                                 73231022
         STC   R5,TOTEXT          MAKE COUNT FIRST CHAR. OF BUFFER      73232022
         BCTR  R5,R0              DECREMENT FOR MOVE                    73234022
         EX    R5,MOVEXT          MOVE EXT DATA TO BFR                  73243022
         LA    R1,D5(R5,R1)       POINT TO DELIMITER                    73252022
         B     SLCHK              CHECK NEXT OPTION                     73261022
         SPACE 2                                                        73270022
NMIOPT   EQU   *                                                        73279022
         NI    $OLTFLGS,XFF-$MANINTV SHOW NO MI                         73288022
         LA    R1,D3(R1)          POINT PASS NMI                        73297022
         B     SLCHK              CHECK NEXT OPTION                     73306022
         SPACE 2                                                        73315022
MIOPT    EQU   *                                                        73324022
         OI    $OLTFLGS,$MANINTV  SHOW MI                               73333022
         LA    R1,D2(R1)          POINT PASS MI                         73342022
         B     SLCHK              CHECK NEXT OPTION                     73351022
         SPACE 2                                                        73360022
         SPACE 2                                                        73369022
OPTEND   EQU   *                                                        73400020
         TM    TOTFLG06,TOTNCMFG  IS NCM REQUESTED?                     73870022
         BZ    TRM259                    NO                             74200020
         BAL   R9,RNCHK           DETERMINE IF TD ON 3705        S22024 74300022
         LA    R7,NCMMSG2         GET START OF DEVICE FLD OF MSG S22024 74400022
         LA    R9,TDMAX           MAX TEST DEV COUNT                    74600022
         LA    R8,TOTTDTBL        GET START OF TEST DEVICE FIELD        74800022
         TM    TOTFLG10,TOTTERMS  TERMINAL TEST ?                       74820022
         BO    TRMTNCM            YES - BRANCH                          74840022
         MVC   WORK3(D4),D0(R8)   UCB ADDR                              74860022
         MVI   WORK3,D0           CLEAR FLAG                            74930022
         B     TRM2506A           GET NEXT ENTRY                        75000022
TRM2506  EQU   *                                                        75200020
         MVC   WORK3(D4),D0(R8)   SAVE ENTRY                            75300022
         CLC   D0(D4,R8),K0       ANY MORE ENTRIES                      75400022
         BE    TRM2508                   NO                             75600020
         MVI   D0(R7),COMMA       SET DELIMITER                         75800022
         LA    R7,D1(R7)          BUMP PASS COMMA                       76000022
         TM    TOTFLG10,TOTTERMS  TERMINAL TEST ?                       76060022
         BO    TRMTNCM            YES - BRANCH                          76120022
TRM2506A EQU   *                                                        76200020
         BCT   R9,TRM2507              END OF TABLE?                    76400020
         B     TRM2508                   YES                            76600020
TRM2507  EQU   *                                                        76800020
         L     R12,WORK3          GET UCB ADDR                          76880022
         USING UCB,R12                                                  76960022
         MVC   D0(D3,R7),UCBNAME  UCB EBCDIC NAME                       77040022
         TM    TOTFLG10,TOTTERMS   IS THIS A TERMINAL TEST       S22024 77046022
         BO    TRM25072            YES BYPASS THIS MIX TEST      S22024 77052022
*                                  NO TEST FOR MIXED 270X / 3705 S22024 77058022
         CLI   UCBTBYT4,TYPE1CA    3704/5 TYPE 1 CA              S22024 77064022
         BE    TRM25071            YES SET PROPER BIT            S22024 77070022
         CLI   UCBTBYT4,TYPE2CA    3704/5 TYPE 2 CA              S22024 77076022
         BE    TRM25071            YES SET PROPER BIT            S22024 77082022
         OI    TOTFLG02,TOTDEV0X   CHANNEL TEST ON 2701,2,3      S22024 77088022
         B     TRM25072            CONTINUE CHECKING TCU'S       S22024 77094022
TRM25071 DS    0H                  ALIGN ON HALFWORD             S22024 77100022
         OI    TOTFLG02,TOTDEVRN   CHANNEL TEST ON 3704,5        S22024 77106022
TRM25072 DS    0H                  ALIGN ON HALFWORD             S22024 77112022
         DROP  R12                                                      77120022
         LA    R7,D3(R7)          BUMP TO NEXT FIELD                    77200022
         LA    R8,D4(R8)          POINT TO NEXT UCB ADDR                77400022
         B     TRM2506                 GO GET NEXT ENTRY                77600020
TRM2508  EQU   *                                                        77800020
         TM    TOTFLG02,TOTDEV0X+TOTDEVRN ARE BOTH TCU BITS ON   S22024 81210022
         BO    TRM25042                    YES PRINT ERROR       S22024 81220022
         TM    TOTFLG02,TOTDEVRN   IS TEST FOR 3704/3705         S22024 81230022
         BO    TRM25043            YES ASK FOR PERMISSION        S22024 81240022
*                                  NO  ASK TO USE 270X LINES     S22024 81250022
         WTO   'IED224D CAN OLT HAVE EXCLUSIVE USE OF CONTROL UNIT ON A*81300000
               DDRESS(ES) ',ROUTCDE=10,DESC=7                    S22024 81400000
TRM25041 DS    0H                  ALIGN ON HALFWORD             S22024 81500022
         XC    ECB(4),ECB              CLEAR ECB FOR WTOR               81600020
WTORNCM  WTOR  '                                                     ',*81800022
               ANSWER,3,ECB,ROUTCDE=(8,10),DESC=2                S22024 82000022
         STIMER REAL,NOANS,DINTVL=TIMOUT    SET TIMER FOR TIMEOUT       82200020
         WAIT  ECB=ECB                 WAIT FOR REPLY                   82400020
         TTIMER CANCEL                 CANCEL TIMER                     82600020
         OI    ANSWER,BLANK       XLATE ANS TO CAP                      82800022
         CLI   ANSWER,YES         YES                                   82900022
         BE    TRM259                    YES                            83100020
         IEDQMSG MSGID=051,FUNCT=CEC,LINK=YES NCM REJECTED       S22024 83200022
         B     GETOUT             EXIT                                  83300022
TRM25042 DS    0H                  ALIGN ON HALFWORD             S22024 83310022
         IEDQMSG MSGID=001,FUNCT=CEC   INVALID MIX OF TCU TYPES  S22024 83320022
         B     GETOUT              CLEAN UP AND RETURN           S22024 83330022
TRM25043 DS    0H                  ALIGN ON HALFWORD                    83340022
         WTO   'IED235D CAN OLT HAVE EXCLUSIVE USE OF 3705 ON ADDRESS(E*83350000
               S) ',ROUTCDE=10,DESC=7                            S22024 83360000
         B     TRM25041            PRINT REST OF MESSAGE         S22024 83370022
TRM259   EQU   *                                                        83400020
         L     R13,D4(R13)        CALLER'S SAVE AREA ADDR               83600022
         TM    TOTFLG02,TOTCONMD  TD ON CONC                    SA41597 83630022
         BZ    PMT260             NO                            SA41597 83660022
         LM    R14,R1,D12(R13)    CALLER'S REG                  SA41597 83670000
         XCTL  (2,12),EP=IEDQWEC  YES - EXIT TO IEDQWC          SA41597 83690022
         SPACE                                                          83720022
PMT260   EQU   *                                                SA41597 83750022
         LM    R14,R1,D12(R13)    CALLER'S REG                          83800022
         XCTL  (2,12),EP=IEDQWD   NORMAL EXIT                           84000022
         EJECT                                                          84400020
GETOUT   EQU   *                                                        84600020
         XC    TOTTDTBL(D40),TOTTDTBL CLEAR TD TABLE                    84700000
         OI    TOTFLG06,TOTOTERM  SET TERMINATE FLAG                    84800022
         L     R13,D4(R13)        CALLER'S SAVE AREA ADDR               85000022
         LM    R14,R1,D12(R13)    CALLER'S REG                          85200022
         XCTL  (2,12),EP=IEDQWE        GO TO IEDQWE                     85400020
NCMMSG2  EQU   WTORNCM+16         STARTING ADDR FOR CUU ADDR IN  S22024 85404000
*                                   MESSAGE                      S22024 85406000
         EJECT                                                          85408022
TRMTNCM  EQU   *   R8 POINTS TO TEST ENTRY                              85412022
         STM   R7,R12,TRMSAVE1    SAVE WORK REG                         85416022
         L     R9,TRMNCMCT        GET  ENTRY COUNTER                    85420022
         LA    R9,D1(R9)          INCREMENT BY ONE                      85424022
         CL    R9,TRMTEN          END OF TABLE ?                        85428022
         BH    TRMNCM1            YES                                   85432022
         ST    R9,TRMNCMCT       SAVE COUNTER                           85436022
         L     R12,D0(R8)         GET TNT ADDR                          85440022
         LA    R12,D0(R12)         CLEAR HIGH ORDER BYTE                85444022
         LTR   R12,R12            LAST ENTRY ?                          85448022
         BZ    TRMNCM1            YES - BRANCH                          85452022
         SR    R10,R10            CLEAR REG                             85456022
         IC    R10,TOTTTBEL       GET NAME LENGTH                       85460022
         AR    R12,R10            GET ADDR OF TTE ADDR                  85464022
         MVC   TTEADDR+D1(D3),D0(R12)   ALLIGN ADDRESS                  85468022
         L     R11,TTEADDR        GET TTE ADDR                          85472022
         USING IEDQTRM,R11                                              85476022
         L     R11,TRMDESTQ-D1    GET QCB ADDR                          85480022
         DROP  R11                                                      85484022
         USING IEDQQCB,R11                                              85488022
         SR    R7,R7              CLEAR REG                             85492022
         IC    R7,QCBRELLN        GET RLN                               85496022
         SLL   R7,D2              MULT BY 4                             85500022
         L     R11,QCBDCBAD-D1    GET DCB ADDR                          85504022
         DROP  R11                                                      85508022
         USING IHADCB,R11                                               85512022
         L     R11,DCBDEBAD       GET DEB ADDR                          85516022
         DROP  R11                                                      85520022
         USING DEBNMSUB,R11                                             85524022
         SR    R15,R15            CLEAR REG                             85528022
         IC    R15,DEBNMEXT       GET # OF EXTENTS                      85532022
         SLL   R15,D2             MULT BY 4                             85536022
         L     R11,DEBUCBAD-D4(R7)  GET UCB ADDR                        85540022
         ST    R11,WORK3          SAVE IT                               85544022
         LM    R7,R12,TRMSAVE1    RESTORE CALLER'S REG                  85548022
         B     TRM2507            RETURN                                85552022
TRMNCM1  EQU   *                                                        85556022
         BCTR  R7,R0              DECREMENT COUNT BY 1                  85560022
         MVI   D0(R7),BLANK       BLANK OUT CHARACTER                   85564022
         LM    R7,R12,TRMSAVE1    RESTORE CALLER'S REG                  85568022
         B     TRM2508            RETURN                                85572022
         EJECT                                                          85601022
RTNCHK   EQU   *                  SET ROUTINE MASKS IN SCT              85602022
         TM    TOTFLG03,TOTTSINC  INCLUSIVE TEST ?                      85602322
         BO    TEST1              YES - ERROR                           85602622
*                                                                       85603022
         OI    $EXECFLG,$RTNSLCT  SHOW THAT ROUTINES SELECTED           85604022
         STM   R7,R12,SAVAREA     SAVE REGISTERS                        85605022
RTN2     EQU   *                                                        85606022
         TM    RTNFLG,RTNSFLG     END OF TEST FIELD ?                   85607022
         BO    RTNEND             YES                                   85608022
         XC    RTNFLG,RTNFLG      CLEAR FLAG BYTE                       85609022
         LR    R7,R1              POINT TO FIRST DIGIT                  85610022
RTN3     EQU   *                                                        85611022
         LA    R8,D0              INIT. DIGIT COUNTER                   85612022
RTN4     EQU   *                                                        85613022
         CLI   D0(R7),SLASH       SLASH DELIMITER ?                     85614022
         BE    RTNSLH             YES                                   85615022
         CLI   D0(R7),DASH        INCLUSIVE TEST ?                      85616022
         BE    RTNDSH             YES                                   85617022
         CLI   D0(R7),COMMA       COMMA DELIMITER ?                     85618022
         BE    RTNCMA             YES                                   85619022
         CLI   D0(R7),F0          DIGIT LESS THAN 0 ?                   85620022
         BL    TEST1              YES - ERROR                           85621022
         CLI   D0(R7),F9          DIGIT GREATER THAN 9 ?                85622022
         BH    TEST1              YES - ERROR                           85623022
         LA    R7,D1(R7)          POINT TO NEXT CHAR                    85624022
         LA    R8,D1(R8)          INCREMENT CHAR COUNTER                85625022
         B     RTN4               CHECK NEXT CHAR                       85626022
RTNSLH   EQU   *                                                        85627022
         OI    RTNFLG,RTNSFLG     SHOW END OF TEST FIELD                85628022
         B     RTN6               EXIT                                  85629022
RTNDSH   EQU   *                                                        85630022
         TM    RTNFLG,RTNDFLG     INCLUSIVE ROUTINES ?                  85631022
         BO    RTN6               YES                                   85632022
         OI    RTNFLG,RTNDFLG     SHOW INCLUSIVE ROUTINES               85633022
         B     RTN6               EXIT                                  85634022
RTNCMA   EQU   *                                                        85635022
         OI    RTNFLG,RTNCFLG     SHOW SEPARATE ENTRIES                 85636022
RTN6     EQU   *                                                        85637022
         LTR   R8,R8              ANY DIGITS ?                          85638022
         BZ    TEST1              NO - ERROR                            85639022
         CL    R8,K3              THREE DIGITS OR LESS           S22024 85639322
         BH    TEST1              NO - ERROR                     S22024 85639622
         CL    R8,K3              NUMBER OF DIGITS = 3           S22024 85640010
         BNE   RTN8               NO - BYPASS MAXIMUM CHECK      S22024 85640310
         SR    R7,R8              POINT TO FIRST DIGIT           S22024 85640610
         CLC   D0(D3,R7),RTNMAX   RTN NUMBER > MAXIMUM           S22024 85640910
         BH    TEST1              YES - RTN # TOO LARGE          S22024 85641210
         AR    R7,R8              RESET POINTER                  S22024 85641510
RTN8     DS    0H                 BOUNDARY ALLIGNMENT            S22024 85641810
         BCTR  R8,R0              DECREMENT COUNT FOR EX         S22024 85642110
         EX    R8,PACK            PACK THE NUMBER                S22024 85642410
         CVB   R9,DEC             CONVERT IT TO BINARY           S22024 85642710
         TM    RTNFLG,RTNNFLG     INCLUSIVE SECOND TEST          S22024 85643010
         BO    RTN12              YES                                   85644022
         ST    R9,DIG1            SAVE NUMBER                           85645022
         TM    RTNFLG,RTNDFLG     INCLUSIVE ROUTINES ?                  85646022
         BZ    RTN15              NO                                    85647022
         OI    RTNFLG,RTNNFLG     YES - SET SECOND PASS FLAG            85648022
         LA    R1,D1(R7)          POINT PASS DELIMITER                  85649022
         LR    R7,R1              SAVE POINTER                          85650022
         B     RTN3               GO FIND UPPER LIMIT                   85651022
RTN12    EQU   *                                                        85652022
         ST    R9,DIG2            SAVE UPPER LIMIT                      85653022
         CLC   DIG1(D4),K256      NUMBER GREATER THAN MAX. ?            85654022
         BH    TEST1              YES - ERROR                           85655022
         CLC   DIG2,K256          NUMBER GREATER THAN MAX. ?            85656022
         BH    TEST1              YES - ERROR                           85657022
         CLC   DIG1(D4),DIG2      1ST NUMBER GRT/EQ TO 2ND NUMBER ?     85658022
         BNL   TEST1              YES - ERROR                           85659022
RTN15    EQU   *                  SET ROUTINE MASK BITS                 85660022
         L     R9,DIG1            GET ROUTINE NUMBER                    85661022
         CL    R9,K0              RTN NUMBER EQU ZERO                   85662022
         BE    TEST1              YES - ERROR                           85663022
         CLC   DIG1(D4),K16       SET MASK BETWEEN 1 AND 16             85664022
         BH    RTN24              NO - CHECK NEXT FIELDS                85665022
*        SET MASK FOR ROUTINES 1-16                                     85666022
         LA    R12,$RT0108        POINT TO RTN MASK FIELD               85667022
         LA    R11,TESET          POINT TO SET MASK TABLE               85668022
RTN17    EQU   *                                                        85669022
         S     R9,K8              DECREMENT BY 8                        85670022
         BNP   RTN19              IF RESULT NEG. , EXIT                 85671022
         LA    R12,D1(R12)        POINT TO SECOND BYTE                  85672022
         B     RTN19A             GO SET MASK                           85673022
RTN19    EQU   *                                                        85674022
         L     R9,DIG1            GET RTN NUMBER                        85675022
RTN19A   EQU   *                                                        85676022
         BCTR  R9,R0              DECREMENT FOR MOVE                    85677022
RTN20    EQU   *                                                        85678022
         AR    R9,R11             POINT TO MASK SETTING                 85679022
         OC    D0(D1,R12),D0(R9)  SET MASK                              85680022
RTN21    EQU   *                                                        85681022
         TM    RTNFLG,RTNIFLG     INCLUSIVE LOOP ?                      85682022
         BO    RTN22            YES                                     85683022
         LA    R7,D1(R7)          POINT PASS DELIMITER                  85684022
         LR    R1,R7              RESET TRM PTR                         85685022
RTN22    EQU   *                                                        85686022
         TM    RTNFLG,RTNDFLG     INCLUSIVE ROUTINES                    85687022
         BZ    RTN2               NO CONTINUE                           85688022
         OI    RTNFLG,RTNIFLG     SET INCLUSIVE LOOP FLAG               85689022
         CLC   DIG1(D4),DIG2      END OF INCLUSIVE SET ?                85690022
         BE    RTN2               YES CONTINUE                          85691022
         L     R9,DIG1            GET FIRST NUMBER                      85692022
         LA    R9,D1(R9)          INCREMENT BY 1                        85693022
         ST    R9,DIG1            REPLACE NUMBER                        85694022
         B     RTN15              EVALUATE THIS ROUTINE NUMBER          85695022
RTN24    EQU   *                  SET MASK FOR ROUTINES 17-256          85696022
         L     R9,DIG1            GET FIRST NUMBER                      85697022
         LA    R12,$R025032       POINT TO SECOND MASK FIELD            85698022
         LA    R8,D24             INIT COMPARAND                        85699022
         LA    R11,TESET          POINT TO SET MASK TABLE               85700022
RTN28    EQU   *                                                        85701022
         CR    R9,R8              IS FLAG IN PRIOR BYTE ?               85702022
         BNH   RTN32              YES - EXIT                            85703022
         LA    R8,D8(R8)          INCREMENT COMPARAND                   85704022
         LA    R12,D1(R12)        POINT TO NEXT MASK BYTE               85705022
         B     RTN28              CHECK NEXT BYTE                       85706022
RTN32    EQU   *                  MASK FIELD FOUNT                      85707022
         BCTR  R12,R0             ADJUST TO CORRECT BYTE                85708022
         LA    R9,D8(R9)          ADJUST RTN NUMBER                     85709022
         SR    R9,R8              ADJUST INDEX INTO MASK TABLE          85710022
         BCTR  R9,R0              DECREMENT FOR INDEX INTO MASK TABLE   85711022
         B     RTN20              GO SET MASK                           85712022
RTNEND   EQU   *                                                        85713022
         BCTR  R1,R0              ADJUST TRM POINTER                    85714022
         LM    R7,R12,SAVAREA     RESTORE REG.                          85715022
         B     OPTCHK             CHECK OPTION FIELD                    85716022
         EJECT                                                          85800020
NOANS    EQU   *                                                        86000020
         STM   R14,R12,D12(R13)   SAVE CALLER'S REG                     86200022
         LR    R4,R15                  GET MY BASE                      86400020
         USING NOANS,R4                                                 86600020
         LA    R12,TRMSAV2             GET MY SAVE                      86800020
         ST    R13,D4(R12)        SAVE HIS SAVE ADDR                    87000022
         ST    R12,D8(R13)        SAVE MY SAVE ADDR                     87200022
         LR    R13,R12                 SET SAVE POINTER                 87400020
         POST  ECB                     POST WTOR ECB                    87600020
         L     R13,D4(R13)        GET CALLER'S SAVE                     87800022
         LM    R14,R12,D12(R13)   RESTORE CALLER'S REG                  88000022
         BR    R14                     RETURN TO CALLER                 88200020
         DROP  R4                                                       88400020
         SPACE 2                                                        88406022
**************************************************************** S22024 88412022
*        ROUTINE TO DETERMINE IF TEST DEVICE IS ON A 3705.     * S22024 88418022
*        IF SO , THE NCM OPTION IS TURN OFF.                   * S22024 88424022
**************************************************************** S22024 88430022
RNCHK    EQU   *                                                 S22024 88436022
         STM   R7,R9,TRMSAVE1     SAVE REGISTERS                 S22024 88442022
         LA    R7,TOTTDTBL        POINT TO TEST DEVICE TABLE     S22024 88448022
         LA    R8,TOTTDEND        END OF TABLE                   S22024 88454022
RNCHK2   EQU   *                  S22024                                88460022
         CR    R7,R8              END OF TABLE                   S22024 88466022
         BE    RNCHKE             YES - EXIT (NO 3705 TD)        S22024 88472022
         L     R9,D0(R7)          GET TD ENTRY                   S22024 88478022
         LTR   R9,R9              ANY MORE ENTRIES               S22024 88484022
         BZ    RNCHKE             NO - EXIT (NO 3705 TD)         S22024 88490022
         SPACE                                                          88496022
         TM    D0(R7),TOTTDORN    TD ON 3705                     S22024 88502022
         BO    RNCHKNCM           YES                            S22024 88508022
         LA    R7,D4(R7)          POINT TO NEXT ENTRY            S22024 88514022
         B     RNCHK2             CHECK IT                       S22024 88520022
         SPACE                                                          88526022
RNCHKE   EQU   *                                                 S22024 88532022
         LM    R7,R9,TRMSAVE1     RESTORE REGISTERS              S22024 88538022
         BR    R9                 RETURN                         S22024 88544022
         SPACE                                                          88550022
RNCHKNCM EQU   *                  S22024                                88556022
         NI    TOTFLG06,XFF-TOTNCMFG SET CM                      S22024 88562022
         IEDQMSG MSGID=008,FUNCT=CEC NCM REJECTED                S22024 88568022
         B     TRM259             EXIT                           S22024 88574022
         EJECT                                                          88600020
WORK1    DS    D                  WORK AREA                             88800022
WORK2    DS    D                  WORK AREA                             88900022
WORK3    DS    F                  WORK AREA                             89000022
SAVAREA  DS    18F                SAVE AREA                             89100022
THREE    DC    F'3'               VALUE OF 3                            89200022
WORK     DC    F'0'               WORK AREA                             89300022
TRMFLG   DC    X'00'              CONTROL FLAG                          89400022
TRMWRK   DS    CL72               TRM BUFFER WORK AREA                  89500022
TRMSAV2  DC    18F'0'             TIMER COMPLETE SAVE AREA              90000022
TRMNCMCT DC    F'0'               TEST ENTRY COUNTER SAVE               90030022
TRMSAVE1 DS    5F                 SAVE AREA                             90060022
TRMTEN   DC    F'10'              VALUE OF TEN                          90090022
TTEADDR  DC    F'0'               WORK AREA                             90120022
NOUCB    DC    H'0'               COMPARE OPERAND                       90150022
         DS    0D                                                       90200020
TIMOUT   DC    X'F0F0F0F3F0F0F0F0' TIMER FOR TIMEOUT                    90400022
ANSWER   DC    CL3' '             REPLY BUFFER                          90500022
ECB      DC    F'0'               ECB WORD                              90600022
DEC      DC    D'0'               WORK AREA                             90810022
DIG1     DC    F'0'               WORK AREA                             90820022
DIG2     DC    F'0'               WORK AREA                             90830022
K0       DC    F'0'               VALUE OF ZERO                         90840022
K1       DC    F'1'               VALUE OF 1                            90850022
K3       DC    F'3'               VALUE OF 3                            90855022
K8       DC    F'8'               VALUE OF 8                            90860022
K16      DC    F'16'              VALUE OF 16                           90870022
K248     DC    F'248'             VALUE OF 248                          90880022
K256     DC    F'256'             VALUE OF 256                          90890022
H1       DC    H'1'               VALUE OF 1                            90892022
H3       DC    H'3'               VALUE OF 3                            90894022
MASK0    DC    4XL1'F0'           AND/COMPARAND FIELD                   90896022
BLK3     DC    3XL1'40'           COMPARAND FIELD                       90898022
RTNFLG   DC    X'00'              ROUTINE CONTROL FLAG                  90900022
TESET    DC    X'8040201008040201' SET RTN MASK TABLE                   90910022
KF0      DC    4CL1'0'            MASK FIEDL                            90910522
TTP      DC    C'TPP'             TEST PRIMARY PATH              S22024 90910600
TAP      DC    C'TAP'             TEST ALTERNATE PATH            S22024 90910700
TL       DC    C'TL'              TEST LOOP                             90911022
NTL      DC    C'NTL'             NO TEST LOOP                          90911522
EL       DC    C'EL'              ERROR LOOP                            90912022
NEL      DC    C'NEL'             NO ERROR LOOP                         90912522
CP       DC    C'CP'              CONTROL PRINT                         90913022
NCP      DC    C'NCP'             NO CONTROL PRINT                      90913522
NMI      DC    C'NMI'             NO MANUAL INPUT                       90914022
MI       DC    C'MI'              MANUAL INPUT                          90914522
AP       DC    C'AP'              ALTERNATE PRINTER                     90915022
NAP      DC    C'NAP'             NO ALTERNATE PRINTER                  90915522
EP       DC    C'EP'              ERROR PRINT                           90916022
NEP      DC    C'NEP'             NO ERROR PRINT                        90916522
CM       DC    C'CM'              CONCURRENT MODE                       90917022
NCM      DC    C'NCM'             NON-CONCURRENT MODE                   90917522
EXT      DC    C'EXT'             EXTERNAL DATA                         90918022
TR       DC    C'TR'              TRACE FUNCTION                        90918522
NTR      DC    C'NTR'             NO TRACE FUNCTION                     90919022
NBK      DC    C'NBK'             NO BREAK OPTION                S22024 90919110
BK       DC    C'BK'              BREAK OPTION                   S22024 90919210
RTNMAX   DC    C'255'             MAXIMUM VALID RTN NUMBER       S22024 90919310
NP       DC    C'NP'              NO PRINT                              90919522
PACK     PACK  DEC(8),D0(D0,R1)   CONVERT FROM ZONE TO DEC              90920022
MOVEXT   MVC   TOTEXT+D1(D1),D4(R1) MOVE EXT DATA TO OLTCB              90960022
PATCH    DC    CL200' '           MAINTENANCE AREA                      91000022
         EJECT                                                          91202022
         TQCBD                                                          91204022
         EJECT                                                          91206022
         DCBD  DSORG=TX                                                 91208022
         EJECT                                                          91210022
         TTRMD                                                          91212022
         EJECT                                                          91214022
         TDEBD                                                          91216022
         EJECT                                                          91220022
         OLTCB                                                          91240022
         EJECT                                                          91260022
         TPRFD                                                          91280022
         EJECT                                                          91300022
UCB      DSECT                                                          91320022
         IEFUCBOB                                                       91340022
         SPACE 2                                                        91360022
         END                                                            91400020
