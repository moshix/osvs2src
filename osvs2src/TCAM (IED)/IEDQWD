         TITLE 'IEDQWD - TOTE DISPATCHER MODULE'                        00070000
IEDQWD   CSECT                                                          00140000
*A000000-999999                                                @Y16X5U0 00210000
*CHANGE ACTIVITY AS FOLLOWS:                                            00280000
*A378450-378650,405250-405650,669420-669480                     SA41599 00350000
*D203850-323850                                                  S21903 00420000
*A203850-263850                                                  S21903 00490000
*C000000-999999                                                  S22024 00560000
*A269080-269880                                                  S05331 00630000
*C817000                                                         S05331 00700000
*D309000                                                         S05331 00770000
*A122300-122600,804200-804800,821700-821900,822070-823890        Y06330 00840000
*A878020-878120                                                  Y06330 00910000
*822000-823000                                                   Y06330 00980000
*D653000                                                        SA64791 01050000
*A705000,746000                                                 SA64791 01120000
*A431300-431600,833200-833800,881300-881600                    @SA69637 01190000
*D882000                                                       @ZA06159 01260000
*C742000-745000,736000-737000                                  @ZA06159 01330000
*A170000                                                       @ZA06159 01400000
*A701000,441000,705000                                         @OY12959 01470000
*A427000,431000,569000,615000,697000,820000,861000             @Y17XAUU 01540000
*C702000,8220000                                               @Y17XAUU 01610000
* A016100,800800,820400                                        @G36XRUV 01620010
* C800800                                                      @G36XRUV 01630010
*                                                                       01640010
*********************************************************************** 01680000
*                                                                     * 01750000
* MODULE NAME:  IEDQWD (TCAM,TOTE)                             @Y17XAUU 01820000
*                                                                     * 01890000
* DESCRIPTIVE NAME:  TOTE DISPATCHER                                  * 01960000
*                                                                     * 02030000
* COPYRIGHT:  'NONE'                                                  * 02100000
*                                                                     * 02170000
* STATUS:  VERSION 10.0                                        @Y17XAUU 02240000
*                                                                     * 02310000
* FUNCTION:                                                           * 02380000
*                                                                     * 02450000
*    THE PURPOSE OF THIS MODULE IS TO:                                * 02520000
*                                                                     * 02590000
*        1. SET THE NO CONTROL PRINT FLAG IN THE SCT IF 'NCP' IS      * 02660000
*           SPECIFIED IN THE TRM.                                     * 02730000
*        2. VERIFY THAT THE SYSOUT DCB IS OPEN IF 'APSYSOUT' IS       * 02800000
*           SPECIFIED IN THE TRM.                                     * 02870000
*        3. VERIFY THAT THE TEST DEVICE IS SUPPORTED - I.E. UCB       * 02940000
*           INDICATES COMMUNICATION OR GRAPHIC DEVICE                 * 03010000
*        4. EXCLUSIVELY ENQ ON TEST DEVICE TO PROTECT OTHER OLTS      * 03080000
*           FROM USING SAME DEVICES.  IF TEST DEVICE IS A REMOTE      * 03150000
*           DEVICE (I.E. SYMBOLIC NAME), A 'SHARE' ENQ IS ISSUED FOR  * 03220000
*           ITS UCB.                                                  * 03290000
*        5. VERIFY THAT TEST DEVICE IS CONFIGURED.  IF CDS INDICATES  * 03360000
*           THAT THE DEVICE IS SWITCHABLE OR SHAREABLE, THE SYSTEM    * 03430000
*           CONSOLE OPERATOR IS ASKED TO INSURE THAT THE CONTROL UNIT * 03500000
*           IS CONNECTED TO THE PROPER CPU.  IF CDS INDICATES THAT    * 03570000
*           DEVICE IS PROTECTED, THE SYSTEM CONSOLE OPERATOR IS       * 03640000
*           ASKED FOR PERMISSION TO TEST THE DEVICE.                  * 03710000
*        6. STOPS ALL TEST DEVICES TO PREVENT THEIR USE BY TCAM.      * 03780000
*                                                                     * 03850000
*    THE TRM IS CANCELLED IF:                                         * 03920000
*        1. DIAGMSG OPEN FAILS - MESSAGE IED236I                      * 03990000
*        2. DEVICE IS NOT SUPPORTED - MESSAGE IED212I                 * 04060000
*        3. EXCLUSIVE ENQ FAILS FOR TEST DEVICE - MESSAGE IED231I     * 04130000
*        4. I/O ERROR OCCURRED ON LOADING CONFIGURATION DATA - MESSAGE* 04200000
*           IED228I                                                   * 04270000
*        5. CONFIGURATION DATA SET CANNOT BE OPENED - MESSAGE IED230I * 04340000
*        6. NO CONFIGURATION DATA ('FIND' FAILED) - MESSAGE IED229I   * 04410000
*        7. CONTROL UNIT NOT CONNECTED TO PROPER CPU - MESSAGE IED226I* 04480000
*        8. SYSTEM OPERATOR WILL NOT ALLOW TEST ON PROTECTED DEVICE - * 04550000
*           MESSAGE IED329I                                           * 04620000
*        9. OPERATOR CONTROL RETURNS A BAD RETURN CODE TO STOP        * 04690000
*           LINE, STOP TERMINAL OR DEACTIVATE 3705 COMMAND - MESSAGE  * 04760000
*           IED221I                                                   * 04830000
*                                                                     * 04900000
* ENTRY POINT:  IEDQWD                                                * 04970000
*                                                              @Y17XAUU 05040000
* PURPOSE: SEE FUNCTION                                        @Y17XAUU 05110000
*                                                              @Y17XAUU 05180000
* MODULE TYPE: PROCEDURE                                       @Y17XAUU 05250000
*                                                              @Y17XAUU 05320000
* MODULE SIZE: 4K MAXIMUM                                      @Y17XAUU 05390000
*                                                              @Y17XAUU 05460000
* PROCESSOR: ASSEMBLER XF                                      @Y17XAUU 05530000
*                                                                     * 05600000
* EXTERNAL ROUTINES: IEDQTNT - FIND TTE ADDRESS                @Y17XAUU 05670000
*                                                              @Y17XAUU 05740000
* INPUT:        REGISTERS 02,13,14,15 CONTAIN THE FOLLOWING VALUES:   * 05810000
*                                                                     * 05880000
*                         02-OLTCB POINTER                            * 05950000
*                         13-SAVE AREA ADDRESS                        * 06020000
*                         14-RETURN ADDRESS                           * 06090000
*                         15-ENTRY POINT ADDRESS                      * 06160000
*                                                                     * 06230000
* MACROS: AQCTL                                                @Y17XAUU 06300000
*         CLOSE                                                @Y17XAUU 06370000
*         DELETE                                               @Y17XAUU 06440000
*         ENQ                                                  @Y17XAUU 06510000
*         FIND                                                 @Y17XAUU 06580000
*         IEDHJN                                               @Y17XAUU 06650000
*         IEDQMSG                                              @Y17XAUU 06720000
*         LINK                                                 @Y17XAUU 06790000
*         LOAD                                                 @Y17XAUU 06860000
*         OPEN                                                 @Y17XAUU 06930000
*         WAIT                                                 @Y17XAUU 07000000
*         WTO                                                  @Y17XAUU 07070000
*         WTOR                                                 @Y17XAUU 07140000
*         XCTL                                                 @Y17XAUU 07210000
*                                                              @Y17XAUU 07280000
* EXIT POINTS:  XCTL AFTER 'DISPEXIT' TO IEDQWE                       * 07350000
*                                                                     * 07420000
* TABLES/WORK AREAS:                                                  * 07490000
*                                                                     * 07560000
*    OLTCB,UCB,DEB,DCB,QCB,CDS,CVT,LCB,TTE,TNT,AVT                    * 07630000
*                                                                     * 07700000
* ATTRIBUTES:                                                         * 07770000
*                                                                     * 07840000
*       ENABLED, PROBLEM PROGRAM MODE, TRANSIENT.                     * 07910000
*                                                                     * 07980000
* NOTES: SEE BELOW                                             @Y17XAUU 08050000
*                                                              @Y17XAUU 08120000
*  DEPENDENCIES: EBCDIC CHARACTER CODE                         @Y17XAUU 08190000
*                                                              @Y17XAUU 08260000
*  RESTRICTIONS: NONE                                          @Y17XAUU 08330000
*                                                              @Y17XAUU 08400000
*  REGISTER CONVENTIONS: SEE REGISTERS ASSIGNMENT              @Y17XAUU 08470000
*                                                              @Y17XAUU 08540000
*  PATCH LABEL: PATCH                                          @Y17XAUU 08610000
*                                                                     * 08680000
*********************************************************************** 08750000
         EJECT                                                          08820000
*********************************************************************** 08890000
*********************************************************************** 08960000
*                                                                       09030000
*                                                                       09100000
*        REGISTER EQUATES                                               09170000
*                                                                       09240000
*********************************************************************** 09310000
*********************************************************************** 09380000
R0       EQU   0                       REG 0                     S99528 09450000
R1       EQU   1                       REG 1                     S99528 09520000
R2       EQU   2                       REG 2                     S99528 09590000
R3       EQU   3                       REG 3                     S99528 09660000
R4       EQU   4                       REG 4                     S99528 09730000
R5       EQU   5                       REG 5                     S99528 09800000
R6       EQU   6                       REG 6                     S99528 09870000
R7       EQU   7                       REG 7                     S99528 09940000
R8       EQU   8                       REG 8                     S99528 10010000
R9       EQU   9                       REG 9                     S99528 10080000
RSIB     EQU   9                  SIB BASE                     @Y17XAUU 10150000
R10      EQU   10                      REG 10                    S99528 10220000
R11      EQU   11                      REG 11                    S99528 10290000
R12      EQU   12                      REG 12                    S99528 10360000
R13      EQU   13                      REG 13                    S99528 10430000
R14      EQU   14                      REG 14                    S99528 10500000
R15      EQU   15                      REG 15                    S99528 10570000
PARMREG0 EQU   R0                      MSG PARM                  S99528 10640000
PARMREG1 EQU   R1                      MSG PARM                  S99528 10710000
Y        EQU   X'E8'                   YES                       S99528 10780000
TPCLASS  EQU   X'40'              TP DEVICE CLASS                       10850000
GRAPHIC  EQU   X'10'              DISPLAY DEVICE CLASS                  10920000
TYPE2260 EQU   X'03'              2260 DEVICE TYPE                      10990000
ANR      EQU   X'09'                   3270                      S99528 11060000
ANRP     EQU   X'0A'                   3284                      S99528 11130000
ANRPP    EQU   X'0B'                   3286                      S99528 11200000
DEVTBEND EQU   C' '                    BLANK                     S99528 11270000
XFF      EQU   X'FF'              MASK BYTE                    @Y17XAUU 11340000
ADRMSK   EQU   7                       ADDRESS MASK            @Y17XAUU 11410000
RELEASE  EQU   X'87'              RELEASE TERMINAL VERB CODE   @Y17XAUU 11480000
LINESTOP EQU   X'41' .       STOP LINE VERB CODE                        11550000
TERMSTRT EQU   X'45' .       START TERMINAL VERB CODE                   11620000
TERMSTOP EQU   X'47' .       STOP TERMINAL VERB CODE                    11690000
TERMNACT EQU   X'48'                   INACTIVATE TERMINAL VERB  S22024 11760000
*                                        CODE                    S22024 11830000
DEACT    EQU   X'54'                   DEACTIVATE VERB CODE      S22024 11900000
TERMHOLD EQU   X'88'                   HOLD TERMINAL VERB CODE   S22024 11970000
SWPRI    EQU   X'50'                   SWITCH TO PRIMARY         Y06330 12040000
SWBCK    EQU   X'51'                   SWITCH TO BACKUP          Y06330 12110000
LGB      EQU   X'80'                   DSORG BIT SETTING FOR LGB S22024 12180000
D0       EQU   0                       CONSTANT ZERO             S22024 12250000
D1       EQU   1                       DISP ONE                  S22024 12320000
D2       EQU   2                       DISPLACEMENT 2            S22024 12390000
D3       EQU   3                       DISP THREE                S22024 12460000
D4       EQU   4                       DISP FOUR                 S22024 12530000
D5       EQU   5                       DISPLACEMENT 5            S22024 12600000
D6       EQU   6                       DISPLACEMENT 6            S22024 12670000
D7       EQU   7                       DISPLACEMENT 7            S22024 12740000
D8       EQU   8                       DISPLACEMENT 8            S22024 12810000
D9       EQU   9                       CONSTANT DISPLACEMENT     S22024 12880000
D12      EQU   12                      DISPLACEMENT 12           S22024 12950000
D13      EQU   13                      DISPLACEMENT 13                  13020000
D16      EQU   16                      DISPLACEMENT 16           S22024 13090000
D18      EQU   18                      DISPLACEMENT 18           S22024 13160000
D19      EQU   19                      DISPLACEMENT 19           S22024 13230000
D24      EQU   24                      DISPLACEMENT 24           S22024 13300000
D32      EQU   32                      DISPLACEMENT 32           S22024 13370000
D40      EQU   40                      CONSTANT DISPLACEMENT 40  S22024 13440000
D41      EQU   41                      CONSTANT DISPLACEMENT 41  S22024 13510000
D42      EQU   42                      CONSTANT DISPLACEMENT 42  S22024 13580000
TCUCLASS EQU   X'40'                   CLASS BYTE IN CDS FOR TCU S22024 13650000
D48      EQU   48                      CONSTANT DISPLACEMENT     S22024 13720000
X0F      EQU   X'0F'                   USED TO CLEAR BITS        S22024 13790000
XF0      EQU   X'F0'                   USED TO CLEAR BITS        S22024 13860000
MAINONLY EQU   X'40'                   BIT SETTING IN QCB        S22024 13930000
*                                        INDICATING MAIN         S22024 14000000
*                                        STORAGE QUEUEING ONLY   S22024 14070000
XE0      EQU   X'E0'                   USED TO CLEAR BITS        S22024 14140000
OPEN     EQU   X'10'                   BIT SETTING IN DCB IF OPENS22024 14210000
GOOD     EQU   X'00'                   GOOD RETURN CODE FROM     S22024 14280000
*                                      OPERATOR CONTROL          S22024 14350000
ALREADY  EQU   X'08'                   RETURN CODE FROM OP CNTRL S22024 14420000
*                                        INDICATING REQUEST      S22024 14490000
*                                        ALREADY DONE            S22024 14560000
X20      EQU   X'20'              USED TO FIND LCB               S22024 14630000
X44      EQU   X'44'                   BIT SETTING IN CDS        S22024 14700000
*                                        INDICATING SHARED OF    S22024 14770000
*                                        SWITCHABLE DEVICE       S22024 14840000
X80      EQU   X'80'                   BIT SETTING IN TERMINAL   S22024 14910000
*                                        ENTRY INDICATING LINE   S22024 14980000
*                                        ENTRY                   S22024 15050000
BLANK    EQU   X'40'                   BLANK CHARACTER           S22024 15120000
RN3705   EQU   X'05'                   BIT INDICATING 3705 UCB   S22024 15190000
RNUCB    EQU   X'80'                   BIT SETTING INDICATING    S22024 15260000
*                                        3705 UCB TEST           S22024 15330000
OPCKEY   EQU   X'00'                   OP CONTROL KEY FIELD      S22024 15400000
OPCPRI   EQU   X'DC'                   OP CONTROL PRIORITY       S22024 15470000
OPCRTCD  EQU   X'00'                   OP CONTROL RETURN CODE    S22024 15540000
OPCELNG  EQU   X'18'                   OP CONTROL ELEMENT LENGTH S22024 15610000
START102 EQU   X'0C'                   ACTION CODE FOR SVC 102   S22024 15680000
LAST102  EQU   X'80'                   LAST ELEMENT IN LIST      S22024 15750000
DISKQ    EQU   X'30'                    MASK FOR DISK QUEUES   @ZA06159 15820000
         EJECT                                                          15890000
*********************************************************************** 15960000
*********************************************************************** 16030000
*                                                                     * 16100000
*       SATISFY SYSTEM LINKAGE CONVENTIONS                            * 16170000
*                                                                     * 16240000
*********************************************************************** 16310000
*********************************************************************** 16380000
         USING TOTOLTCB,R2             TOTE CONTROL BLOCK        S22024 16450000
         USING IEDQWD,R4                                                16520000
         STM   R14,R12,D12(R13)        SAVE CALLER'S REGISTERS   S22024 16590000
         LR    R4,R15             SET UP BASE                           16660000
         ST    R13,TOTSAVE4+D4         POINT TO CALLERS SAVE     S22024 16730000
         LR    R12,R13                 SAVE CALLERS SAVE         S99528 16800000
         LA    R13,TOTSAVE4            POINT TO MY SAVE AREA     S22024 16870000
         ST    R13,D8(R12)             SAVE POINTER TO           S22024 16940000
*                                        DISPATCHERS SAVE AREA   S22024 17010000
IEDQWD   IEDHJN IEDQWDD,HJN                                             17080000
         EJECT                                                          17150000
*********************************************************************** 17220000
*********************************************************************** 17290000
*                                                                     * 17360000
*****          CLEAR TEST DEVICE ENTRIES IN OLTCB          ******S99528 17430000
*                                                                     * 17500000
*********************************************************************** 17570000
*********************************************************************** 17640000
         XC    TOTPRIBK(TOTSCIBK-TOTPRIBK),TOTPRIBK  CLEAR       S22024 17710000
*                                                      PRIMARY   S22024 17780000
*                                                      FIELD     S22024 17850000
         XC    TOTSCIBK(TOTTRMND-TOTSCIBK),TOTSCIBK  CLEAR       S22024 17920000
*                                                      SECONDARY S22024 17990000
*                                                      FIELD     S22024 18060000
         L     R14,TOTAVTPT            GET AVT ADDRESS         @Y17XAUU 18130000
         USING IEDQAVTD,R14            SET AVT ADDRESSABILITY  @Y17XAUU 18200000
         L     R1,AVTRNMPT             GET TTE CONVERSION RTNA @Y17XAUU 18270000
         ST    R1,TERNMTAB             SAVE IT                 @Y17XAUU 18340000
         LA    R1,AVTOPCOB             GET OPCONTROL QCB ADDR  @Y17XAUU 18410000
         STCM  R1,ADRMSK,TOTOQCBA      SAVE IT IN POST PLIST   @Y17XAUU 18480000
         DROP  R14                                             @Y17XAUU 18550000
         EJECT                                                          18620000
*********************************************************************** 18690000
*********************************************************************** 18760000
*                                                                       18830000
**             SET NO CONTROL PRINT FLAG IF REQUIRED                    18900000
*                                                                       18970000
*********************************************************************** 19040000
*********************************************************************** 19110000
DISP005  EQU   *                                                        19180000
         TM    TOTFLG03,TOTIMNCP       WAS NCP IN TRM                   19250000
         BZ    SYSOUT                  NO BRANCH                 S99528 19320000
         OI    $ERROPT,$NOCNTRL        SET NCP FLAG                     19390000
SYSOUT   EQU   *                                                 S22024 19460000
         TM    TOTFLG09,TOTAPOUT       APSYSOUT REQUESTED?       S22024 19530000
         BZ    DISP19B                 NO BRANCH                 S99528 19600000
         L     R1,TOTAPDCB             GET AP DCB                S21903 19670000
         LTR   R1,R1                   IS THERE ONE              S21903 19740000
         BNZ   DISP19B                 YES BRANCH                S21903 19810000
         IEDQMSG MSGID=050,FUNCT=CEC   AP NOT OPEN MSG           S99528 19880000
         B     CANCELL                 GO CANCEL TRM             S99528 19950000
         EJECT                                                          20020000
*********************************************************************** 20090000
*********************************************************************** 20160000
*                                                                       20230000
*        DATA PROTECTION CHECKS                                         20300000
*                                                                       20370000
*********************************************************************** 20440000
*********************************************************************** 20510000
DISP19B  EQU   *                                                        20580000
         LA    R5,TOTTDTBL             DEVICE TABLE ADDR         S99528 20650000
         MVC   SAVENT(D4),TOTTDTBL     SAVE TEST DEVICE ENTRY  @Y17XAUU 20720000
UCBADDR  EQU   *                                                 S22024 20790000
         TM    D0(R5),TOTTDORN         IS TEST ENTRY ON 3705?    S22024 20860000
         BO    TNTENTRY                YES, BRANCH               S22024 20930000
         TM    D0(R5),TOTTDTRM         IS TEST ENTRY A TERMINAL? S22024 21000000
         BO    TNTENTRY                YES, BRANCH               S22024 21070000
         L     R6,D0(R5)               GET UCB ADDRESS           S22024 21140000
         LTR   R6,R6                   LAST ENTRY?               S22024 21210000
         BZ    EXIT                    YES, BRANCH TO EXIT       S22024 21280000
         CLI   D18(R6),TPCLASS         IS IT TP DEVICE?          S22024 21350000
         BNE   TESTGR                  NO, GO TEST FOR GRAPHICS  S22024 21420000
         MVC   TOTWKSPC(D1),D19(R6)    GET CONTROL UNIT FIELD    S22024 21490000
*                                        FROM UCB                S22024 21560000
         NI    TOTWKSPC,X0F            CLEAR HIGH ORDER NIBBLE   S22024 21630000
         CLI   TOTWKSPC,RN3705         IS THIS A 3705 UCB?       S22024 21700000
         BNE   DISP22                  NO, 270X UCB - OK FOR TESTS22024 21770000
         OI    RNFLAG,RNUCB            SET BIT INDICATING RN UCB S22024 21840000
         B     DISP22                  OK FOR TEST, BRANCH       S22024 21910000
TESTGR   EQU   *                                                 S22024 21980000
         CLI   D18(R6),GRAPHIC         IS IT GRAPHIC DEVICE?     S22024 22050000
         BNE   DISP21                  NO: DEVICE NOT TESTABLE          22120000
         CLI   D19(R6),TYPE2260        IS IT 2260?               S22024 22190000
         BE    DISP22                  YES:OK FOR TEST                  22260000
         CLI   D19(R6),ANR             ANR (3270)?               S22024 22330000
         BE    DISP22                  YES BR                    S99528 22400000
         CLI   D19(R6),ANRP            ANR PRINTER (3284)?       S22024 22470000
         BE    DISP22                  YES BR                    S99528 22540000
         CLI   D19(R6),ANRPP           ANR PRINTER (3286)?       S22024 22610000
         BE    DISP22                  YES BR                    S99528 22680000
         SPACE 2                                                        22750000
*                                                                S22024 22820000
*        ISSUE DEVICE NOT SUPPORTED MESSAGE                      S22024 22890000
*                                                                S22024 22960000
         SPACE 2                                                        23030000
DISP21   EQU   *                                                        23100000
         IEDQMSG MSGID=007,FUNCT=CEC,LINK=YES  NOT SUPPORTED     S22024 23170000
         SPACE 2                                                        23240000
CANCELL  EQU   *                                                 S22024 23310000
         TM    D0(R5),TOTTDORN+TOTTDTRM  IS TEST DEVICE ON A 3705S05331 23380000
         BNZ   CANCELL1                YES, BRANCH               S05331 23450000
         L     R6,D0(R5)               GET UCB ADDRESS           S05331 23520000
         USING UCB,R6                  SET UP BASE FOR UCB       S05331 23590000
         MVC   TOTWKSPC(D1),UCBTBYT4   GET UCB TYPE FIELD        S05331 23660000
         NI    TOTWKSPC,X0F            CLEAR HIGH ORDER NIBBLE   S05331 23730000
         CLI   TOTWKSPC,RN3705         IS THIS A 3705 UCB?       S05331 23800000
         BNE   CANCELL1                NO, BYPASS CLEAR CODE     S05331 23870000
         OI    D0(R5),TOTTNIPL         SET FLAG SAYING NO IPL    S05331 23940000
         DROP  R6                      DROP UCB BASE             S05331 24010000
CANCELL1 EQU   *                                                 S05331 24080000
         OI    TOTFLG06,TOTOTERM+TOTCANCL    SET CANCEL AND      S22024 24150000
*                                              TERMINATE BITS    S22024 24220000
         OI    TOTFLG06,TOTCBOPN       SET CANCEL BEFOR OPEN     S99528 24290000
         B     EXIT                    BRANCH TO EXIT ROUTINE    S22024 24360000
         EJECT                                                          24430000
DISP22   EQU   *                                                        24500000
         USING UCB,R6                  UCB                       S99528 24570000
         MVC   RNAME(D3),UCBNAME       MOVE NAME TO PARM LIST    S22024 24640000
         DROP  R6                      UCB                       S99528 24710000
ENQ1     EQU   *                                                 S22024 24780000
         ENQ   ,MF=(E,ENQLIST)         REQUEST EXCLUSIVE USE     S22024 24850000
         LTR   R15,R15                 HAS DEVICE BEEN ASSIGNED  S22024 24920000
*                                        TO TOTE?                S22024 24990000
         BZ    DISP234                 YES BRANCH                S99528 25060000
         CLI   D3(R15),ALREADY         RETURN CODE 8?            S22024 25130000
         BE    DISP234                 OK BRANCH                 S99528 25200000
         SPACE 2                                                        25270000
***      REENTER TRM LATER: RESOURCE IN UNSHAREABLE STATE               25340000
***                                                                     25410000
         SPACE 2                                                        25480000
BUSY     EQU   *                                                 S22024 25550000
         IEDQMSG MSGID=044,FUNCT=CEC   ISSUE ERROR MESSAGE       S22024 25620000
         B     CANCELL                 BRANCH                    S99528 25690000
         EJECT                                                          25760000
**************************************************************** S22024 25830000
*                                                              * S22024 25900000
*        THE FOLLOWING CODE OPENS THE CORRECT CONFIGURATION    * S22024 25970000
*        DATA SET AND VERIFIES THAT THE TEST DEVICE IS         * S22024 26040000
*        CONFIGURED.  TESTS ARE MADE TO VERIFY THAT THE DEVICE * S22024 26110000
*        IS CONNECTED TO THE PROPER CPU IF IT IS SWITCHABLE    * S22024 26180000
*        AND TO GET PERMISSION TO TEST A PROTECTED DEVICE.     * S22024 26250000
*                                                              * S22024 26320000
**************************************************************** S22024 26390000
         SPACE 2                                                        26460000
DISP234  EQU   *                                                 S99528 26530000
         TM    D0(R5),TOTTDORN         IS TEST ENTRY ON 3705?    S22024 26600000
         BO    TERMNAME                YES, BRANCH               S22024 26670000
         TM    D0(R5),TOTTDTRM         IS TEST ENTRY A TERMINAL? S22024 26740000
         BO    TERMNAME                YES, BRANCH               S22024 26810000
         MVC   CDSNAME+D5(D3),RNAME    MOVE MEMBER NAME FOR LINE S22024 26880000
         B     MEMBFIND                BRANCH                    S99528 26950000
TERMNAME EQU   *                                                 S22024 27020000
         MVC   CDSNAME,RNAME           SYMBOLIC NAME FOR LINE    S22024 27090000
*                                        OR TERMINAL             S22024 27160000
MEMBFIND EQU   *                                                 S22024 27230000
         MVI   RNAME,BLANK             BLANK OUT                 S22024 27300000
         MVC   RNAME+D1(D7),RNAME        NAME                    S22024 27370000
         OPEN  OLT                     OPEN DATA SET CONTAINING  S22024 27440000
*                                        CONFIGURATION DATA      S22024 27510000
         TM    OLT+X'30',X'10'         OPEN OK                   S99528 27580000
         BZ    CANOTOPN                NO BRANCH                 S99528 27650000
         FIND  OLT,CDSNAME,D           SEE IF MEMBER EXIST       S99528 27720000
         LTR   R15,R15                 FIND SUCCESSFUL           S99528 27790000
         BZ    NOWLOAD                 YES BRANCH                S99528 27860000
         LA    R11,4                   CK RETURN CODE            S99528 27930000
         CR    R11,R15                 RETURN CODE EQ 4          S99528 28000000
         BE    NONAMEMG                YES BRANCH                S99528 28070000
***                                                                     28140000
***      I/O ERROR LOADING CONFIGURATION DATA                           28210000
***                                                                     28280000
         IEDQMSG MSGID=041,FUNCT=CEC                             S99528 28350000
         B     CANCELL                 GO STOP TOTE                     28420000
CANOTOPN EQU   *                  MESSAGE                        S99528 28490000
***                                                                     28560000
***      CONFIGURATION DATA SET CANNOT BE OPENED                        28630000
***                                                                     28700000
         IEDQMSG MSGID=043,FUNCT=CEC                                    28770000
         B     CANCELL            CANCEL TRM                     S99528 28840000
NONAMEMG EQU   *                                                        28910000
         TM    SAVENT,TOTTDORN               3705 RESOURCE     @Y17XAUU 28980000
         BZ    NONACON                 NO - ISSUE ERROR MSG    @Y17XAUU 29050000
         L     R1,SAVENT               GET TEST DEVICE ENTRY   @Y17XAUU 29120000
         LA    R1,D0(R1)               CLEAR FLAG BYTE         @Y17XAUU 29190000
         SLR   R14,R14                 CLEAR REG               @Y17XAUU 29260000
         IC    R14,TOTTTBEL            GET LEN OF NAME         @Y17XAUU 29330000
         AR    R1,R14                  POINT TO TTE ADDRESS    @Y17XAUU 29400000
         ICM   R1,ADRMSK,D0(R1)        GET TTE ADDRESS         @Y17XAUU 29470000
         LA    R14,TRMPRFSZ            GET TTE PREFIX SIZE     @Y17XAUU 29540000
         SLR   R1,R14                  POINT TO TTE PREFIX     @Y17XAUU 29610000
         USING IEDNTRM,R1              TTE ADDRESSABILITY      @Y17XAUU 29680000
         CLI   TRMTYPE,TRMLUNT         LU ENTRY                @Y17XAUU 29750000
         BNE   NONAM04                 YES - CHECK NEXT ENTRY  @Y17XAUU 29820000
         L     R15,TOTAVTPT            GET AVT ADDRESS         @Y17XAUU 29890000
         USING IEDQAVTD,R15            SET AVT ADDRESSABILITY  @Y17XAUU 29960000
         SLR   R11,R11                 CLEAR REGISTER          @Y17XAUU 30030000
         IC    R11,TRMCHCIN            GET INDEX INTO DCT      @Y17XAUU 30100000
         BCTR  R11,R0                  ADJUST INDEX            @Y17XAUU 30170000
         MH    R11,AVTDCTLN            TRUE OFFSET INTO DCT    @Y17XAUU 30240000
         AL    R11,AVTCSTCS            POINT TO CORRECT ENTRY  @Y17XAUU 30310000
         USING IEDDCT,R11              SET DCT ADDRESSABILITY  @Y17XAUU 30380000
         TM    DCTBYTE5,DCTL3270       3270 LU                 @ZM47850 30450010
         BO    NONACON                 YES - SEND ERROR MSG    @Y17XAUU 30520000
         B     TRMNOTRJ                BYPASS ERROR MSG        @YM08563 30550000
         DROP  R11                                             @Y17XAUU 30590000
         DROP  R15                                             @Y17XAUU 30660000
NONAM04  DS    0H                      BOUNDARY ALLIGNMENT     @Y17XAUU 30730000
         CLI   TRMTYPE,TRMSDLC         SDLC LINK               @Y17XAUU 30800000
         BE    TRMNOTRJ                YES - CHECK NEXT ENTRY  @Y17XAUU 30870000
         CLI   TRMTYPE,TRMNSDLC        NON-SDLC LINK           @Y17XAUU 30890000
         BE    TRMNOTRJ                YES - CHECK NEXT ENTRY  @Y17XAUU 30910000
         DROP  R1                                              @Y17XAUU 30940000
NONACON  DS    0H                      BOUNDARY ALLIGNMENT     @Y17XAUU 31010000
***                                                                     31080000
***      TRM REJECTED: NO CONFIGURATION DATA                            31150000
***                                                                     31220000
         IEDQMSG MSGID=042,FUNCT=CEC                             S99528 31290000
         B     CANCELL                 CANCEL TRM                S99528 31360000
NOWLOAD  EQU   *                                                 S99528 31430000
         LOAD  EPLOC=CDSNAME           CDS TO CORE             @YM08389 31460000
         LR    R11,R0                  GET CDS ADDRESS           S99528 31570000
         XC    TOTOTECB,TOTOTECB       CLEAR ECB                 S99528 31640000
         B     DEVPROT                 GO CHECK FOR DEV PROTECT  S99528 31710000
SWABLE   EQU   *                                                 S99528 31780000
         TM    D9(R11),X44             IS CONTROL UNIT SWITCHABLES22024 31850000
*                                        AND/OR SHARED?          S22024 31920000
         BZ    MSGNOTND                NO BRANCH                 S99528 31990000
         XC    TOTOTECB,TOTOTECB       CLEAR ECB                 S99528 32060000
         XC    ANSWER,ANSWER           CLEAR ANSWER              S99528 32130000
         CLI   D6(R11),TCUCLASS        IS THIS A TCU CDS?        S22024 32200000
         BNE   MOVENAME                NO, MOVE ENTIRE CDS NAME  S22024 32270000
*                                        INTO MESSAGE            S22024 32340000
         SPACE 2                                                        32410000
***                                                                     32480000
***      MESSAGE-WTO TO ASK OPERATOR TO INSURE DEVICE IS HOOKED TO THIS 32550000
***                                                                     32620000
         SPACE 2                                                        32690000
         MVI   A270XSW+D40,BLANK       BLANK OUT NAME            S22024 32760000
         MVC   A270XSW+D41(D7),A270XSW+D40  FIELD IN MESSAGE     S22024 32830000
         MVC   A270XSW+D40(D3),CDSNAME+D5   MOVE NAME INTO MSG   S22024 32900000
         B     SWABLEQ                 GO ASK THE QUESTION       S22024 32970000
MOVENAME EQU   *                                                 S22024 33040000
         MVC   A270XSW+D40(D8),CDSNAME   MOVE NAME INTO MESSAGE  S22024 33110000
SWABLEQ  EQU   *                                                 S22024 33180000
         WTOR  ,ANSWER,3,TOTOTECB,MF=(E,A270XSW)                 S99528 33250000
         DELETE EPLOC=CDSNAME          DELETE CDS                S99528 33320000
         WAIT  ECB=TOTOTECB            WAIT FOR ANSWER           S99528 33390000
         OI    ANSWER,BLANK            MAKE REPLY UPPER CASE     S22024 33460000
         CLI   ANSWER,Y                ANSWER YES                S99528 33530000
         BE    TRMNOTRJ                YES BR                    S99528 33600000
         SPACE 2                                                        33670000
***                                                              S22024 33740000
***      TRM REJECTED: C.U. NOT CONNECTED TO PROPER CPU                 33810000
***                                                              S22024 33880000
         SPACE 2                                                        33950000
         IEDQMSG MSGID=039,FUNCT=CEC                             S99528 34020000
         B     CANCELL                 BRANCH                    S99528 34090000
DEVPROT  EQU   *                                                 S99528 34160000
         TM    10(R11),X'20'           DEVICE PROTECTED?         S99528 34230000
         BO    PROTECT                 YES, BRANCH               S99528 34300000
         B     SWABLE                  NO, BRANCH                S99528 34370000
PROTECT  EQU   *                                                 S99528 34440000
         CLI   D6(R11),TCUCLASS        IS THIS A TCU CDS?        S22024 34510000
         BNE   MOVEALL                 NO, MOVE IN ENTIRE CDS    S22024 34580000
*                                        NAME                    S22024 34650000
         MVI   PROTDEV+D41,BLANK       BLANK OUT NAME FIELD      S22024 34720000
         MVC   PROTDEV+D42(D7),PROTDEV+D41  IN MESSAGE           S22024 34790000
         MVC   PROTDEV+D41(D3),CDSNAME+D5  MOVE IN CUU NAME      S22024 34860000
*                                            WITHOUT PREFIX      S22024 34930000
         B     PROTECTQ                GO ASK QUESTION           S22024 35000000
MOVEALL  EQU   *                                                 S22024 35070000
         MVC   PROTDEV+41(8),CDSNAME   MOVE NAME INTO MESSAGE    S99528 35140000
PROTECTQ EQU   *                                                 S22024 35210000
         WTOR  ,ANSWER,3,TOTOTECB,MF=(E,PROTDEV)                 S99528 35280000
         WAIT  ECB=TOTOTECB            WAIT FOR ANSWER           S99528 35350000
         OI    ANSWER,X'40'            MAKE REPLY UPPER CASE     S99528 35420000
         CLI   ANSWER,Y                'YES' REPLY?              S99528 35490000
         BE    SWABLE                  IF SO BRANCH              S99528 35560000
         MVC   DEVPRONA,CDSNAME        MOVE NAME TO MESSAGE      S99528 35630000
         IEDQMSG FUNCT=(CEC,PRT),OTBUF=PROTMSG,OTCNT=64,               C35700000
               PREG0=R0,PREG1=R1,RET=CANCELL                     S99528 35770000
MSGNOTND EQU   *                                                 S99528 35840000
         DELETE EPLOC=CDSNAME          DELETE CDS                S99528 35910000
TRMNOTRJ EQU   *                                                 S22024 35980000
         L     R6,D0(R5)               GET TEST DEVICE ENTRY     S22024 36050000
         BAL   R12,STOPDEV             GO STOP TEST DEVICE       S22024 36120000
         TM    D0(R5),TOTTDORN         IS TEST ENTRY ON 3705?    S22024 36190000
         BO    UCBLOOK                 YES, GO FIND 3705 UCB     S22024 36260000
         TM    D0(R5),TOTTDTRM         IS TEST ENTRY A TERMINAL? S22024 36330000
         BO    UCBLOOK                 YES, GO FIND UCB FOR LINE S22024 36400000
         LA    R5,4(R5)                GET NEXT UCB              S99528 36470000
         LA    R7,TOTTDEND             GET ADDRESS OF END OF     S22024 36540000
*                                        TABLE                   S22024 36610000
         CR    R5,R7                   END OF TABLE              S99528 36680000
         BNE   UCBADDR                 NO GO GET NEXT ENTRY      S22024 36750000
         B     EXIT                    YES, BRANCH TO EXIT       S22024 36820000
         EJECT                                                          36890000
**************************************************************** S22024 36960000
*                                                              * S22024 37030000
*        THIS SECTION OF CODE PROCESSES A TEST ENTRY THAT IS   * S22024 37100000
*        A SYMBOLIC ENTRY - I.E. A TERMINAL ON A 270X OR A     * S22024 37170000
*        LINE OR TERMINAL ON A 3705.                           * S22024 37240000
*                                                              * S22024 37310000
**************************************************************** S22024 37380000
         SPACE 2                                                        37450000
TNTENTRY EQU   *                                                 S22024 37520000
         L     R6,D0(R5)               GET ADDRESS OF TNT        S22024 37590000
         LTR   R6,R6                   LAST ENTRY IN TABLE?      S22024 37660000
         BZ    EXIT                    YES, BRANCH TO EXIT       S22024 37730000
         TM    D0(R5),TOTTDLIN         IS TEST DEVICE A LINE?    S22024 37800000
         BO    ENQONE                  YES, BYPASS LINE ENQ      S22024 37870000
         TM    D0(R5),TOTTDORN         IS TERMINAL ON A 3705?    S22024 37940000
         BNO   ENQONE                  NO, BYPASS SEARCH FOR     S22024 38010000
*                                        LINE NAME               S22024 38080000
         SR    R3,R3                   CLEAR REGISTER 3          S22024 38150000
         IC    R3,TOTTTBEL             GET MAXIMUM NAME LENGTH   S22024 38220000
         LR    R11,R6                  SAVE TNT ADDRESS          S22024 38290000
         AR    R11,R3                  GET ADDR OF TTE ADDR      S22024 38360000
         MVC   TTEADDR+D1(D3),D0(R11)  MOVE TERMINAL ENTRY ADDR  S22024 38430000
         L     R8,TTEADDR              LOAD TERMINAL ENTRY ADDR  S22024 38500000
         LA    R9,TRMPRFSZ             GET TTE PREFIX SIZE     @Y17XAUU 38570000
         SLR   R8,R9                   POINT TO TTE PREFIX     @Y17XAUU 38640000
         USING IEDNTRM,R8              SET TTE ADDRESSABILITY  @Y17XAUU 38710000
         TM    TRMBYTE2,TRMGPACT       GEN POLL ACTIVE         @Y17XAUU 38780000
         BO    IED278I                 YES BRANCH              @SA69637 38850000
         L     R12,TOTAVTPT            GET AVT ADDRESS         @Y17XAUU 38920000
         USING IEDQAVTD,R12            SET AVT ADDRESSABILITY  @Y17XAUU 38990000
LINELOOP EQU   *                                               @Y17XAUU 39060000
         LH    R1,TRMCOHRT             GET COHORT POINTER      @Y17XAUU 39130000
         STH   R1,OFFSET               SAVE IT                 @Y17XAUU 39200000
         L     15,AVTRNMPT             TTCIN TO TTE CONVERSION @Y17XAUU 39270000
*                                      ROUTINE ADDRESS         @Y17XAUU 39340000
         BALR  R14,R15                 GET TTE ADDRESS         @Y17XAUU 39410000
         LR    R8,R1                   ET TTE ADDRESS          @Y17XAUU 39480000
         LA    R1,TRMPRFSZ             GET TTE PREFIX SIZE     @Y17XAUU 39550000
         SLR   R8,R1                   POINT TO TTE PREFIX     @Y17XAUU 39620000
         CLI   TRMTYPE,TRMNSDLC        PRE SNA LINE ENTRY      @Y17XAUU 39690000
         BE    LINEFND                 YES                     @Y17XAUU 39760000
         CLI   TRMTYPE,TRMSDLC         SNA LINE ENTRY          @Y17XAUU 39830000
         BNE   LINELOOP                NO - CHECK NEXT ENTRY   @Y17XAUU 39900000
LINEFND  EQU   *                                               @Y17XAUU 39970000
         L     R1,AVTRNMPT             GET TERMNAME TABLE ADDR @Y17XAUU 40040000
         DROP  R12                                             @Y17XAUU 40110000
         USING IEDQTNTD,R1             SET TNT ADDRESSABILITY  @Y17XAUU 40180000
         LA    R1,TNTFIRST             GET ADDRESS OF FIRST    @Y17XAUU 40250000
*                                      ENTRY                   @Y17XAUU 40320000
         DROP  R1                                              @Y17XAUU 40390000
         LA    R7,D3                   GET LEN OF TTE ADDRESS  @Y17XAUU 40460000
         AR    R7,R3                   GET LEN ON TNT ENTRY    @Y17XAUU 40530000
         LH    R11,OFFSET              GET LINE TTCIN          @Y17XAUU 40600000
         BCTR  R11,R0                  ADJUST OFFSET           @Y17XAUU 40670000
         MR    R10,R7                  GET OFFSET TO LINE TNT  @Y17XAUU 40740000
         AR    R1,R11                  GET LINE TNT ADDRESS    @Y17XAUU 40810000
         LR    R6,R1                   COPY TNT ADDRESS        @Y17XAUU 40880000
         BCTR  R3,R0                   DECREMENT COUNT BY 1      S22024 40950000
         CLI   TRMTYPE,TRMSDLC         SNA LINK                @Y17XAUU 41020000
         BNE   LN004                   NO - SET ENQ PLIST      @Y17XAUU 41090000
         LA    R1,ENQLIST1             ENQ SHARED ON SNA LINK  @Y17XAUU 41160000
         B     LN008                   ENQ LINE                @Y17XAUU 41230000
LN004    DS    0H                      BOUNDARY ALLIGNMENT     @Y17XAUU 41300000
         LA    R1,ENQLIST              ENQ EXCLU ON PRE SNA    @Y17XAUU 41370000
*                                      LINK                    @Y17XAUU 41440000
LN008    DS    0H                      BOUNDARY ALLIGNMENT     @Y17XAUU 41510000
         LA    R8,TNTNAME              GET TNT POINTER           S22024 41580000
         EX    R3,TNTMOVE              MOVE NAME                 S22024 41650000
         MVC   RNAME(D8),TNTNAME       MOVE NAME INTO ENQ LIST   S22024 41720000
         ENQ   ,MF=(E,(1))             ENQ 3705 COMM LINE      @Y17XAUU 41790000
         MVI   RNAME,BLANK             BLANK OUT                 S22024 41860000
         MVC   RNAME+D1(D7),RNAME        NAME FIELD              S22024 41930000
         LTR   R15,R15                 ASSIGNED OK?              S22024 42000000
         BZ    ENQONE                  YES, CONTINUE             S22024 42070000
         CLI   D3(R15),ALREADY         ALREADY DONE BY TASK      S22024 42140000
         BNE   BUSY                    NO, BAD RETURN, BUSY      S22024 42210000
ENQONE   EQU   *                                                 S22024 42280000
         SR    R3,R3                   CLEAR REG                 S99528 42350000
         IC    R3,TOTTTBEL             GET NAME LENGTH           S99528 42420000
         TM    OLT+D48,OPEN            IS CDS DCB ALREADY OPEN?  S22024 42490000
         BO    NOMOVE                  BRANCH AROUND MOVE OF NAMES22024 42560000
         MVC   OLT+40(8),CDSLIB        NEW NAME DD               S99528 42630000
NOMOVE   EQU   *                                                 S22024 42700000
         BCTR  R3,0                    DECREMENT FOR EX          S99528 42770000
TNTADDR  L     R6,0(R5)                GET TNT ADDR              S99528 42840000
         LA    R8,TNTNAME              TNT POINTER               S99528 42910000
         EX    R3,TNTMOVE              MOVE NAME                 S99528 42980000
         MVC   RNAME(8),TNTNAME        MOVE NAME TO DCB          S99528 43050000
         B     ENQ1                    BRANCH                    S99528 43120000
         EJECT                                                          43190000
**************************************************************** S22024 43260000
*                                                              * S22024 43330000
*        THIS ROUTINE FINDS THE UCB FOR A GIVEN TERMNAME TABLE * S22024 43400000
*        ENTRY.                                                * S22024 43470000
*                                                              * S22024 43540000
**************************************************************** S22024 43610000
         SPACE 2                                                        43680000
UCBLOOK  EQU   *                                                 S22024 43750000
         LR    R9,R6                   SAVE POINTER              S22024 43820000
         SR    R10,R10                 CLEAR REG                 S99528 43890000
         IC    R10,TOTTTBEL            GET NAME LENGTH           S99528 43960000
         AR    R9,R10                  TTE ADDRESS               S99528 44030000
         MVC   TTEADDR+1(3),0(R9)      ALLINE ADDRESS            S99528 44100000
         L     R8,TTEADDR              GET TTE ADDRESS           S99528 44170000
         USING IEDQTRM,R8              TTE                       S99528 44240000
         L     R9,TRMDESTQ-D1          GET QCB ADDR              S22024 44310000
         USING IEDQQCB,R9              SET UP ADDRESSIBILITY FOR S22024 44380000
*                                        QCB                     S22024 44450000
         SR    R7,R7                   CLEAR REGISTER 7          S22024 44520000
         TM    TRMSTATE,TRMPREF        IS THIS A 3705 TERMINAL?@Y17XAUU 44590000
         BZ    GETRLN                  NO, GO GET RLN FROM QCB   S22024 44660000
         LA    R7,D1                   SET RLN TO 1 FOR 3705     S22024 44730000
         B     MULTRLN                 GO MULTIPLY RLN BY 4      S22024 44800000
GETRLN   EQU   *                                                 S22024 44870000
         IC    R7,QCBRELLN             GET RLN                   S22024 44940000
MULTRLN  EQU   *                                                 S22024 45010000
         SLL   R7,2                    MULT BY 4                 S99528 45080000
         L     R8,QCBDCBAD-1           GET DCB ADDRESS           S99528 45150000
         DROP  R8                      DROP TERMINAL ENTRY BASE  S22024 45220000
         DROP  R9                      DROP QCB BASE             S22024 45290000
         USING IHADCB,R8               DCB                       S99528 45360000
         TM    DCBDSORG,LGB            IS THIS A LGB?            S22024 45430000
         BZ    DCBFIND                 NO, A DCB, BRANCH         S22024 45500000
         DROP  R8                      DROP DCB BASE             S22024 45570000
         L     1,TTEADDR               GET TTE ADDRESS         @Y17XAUU 46620000
         L     R12,TOTAVTPT            GET AVT ADDRESS         @Y17XAUU 46690000
         USING IEDQAVTD,R12            SET AVT ADDRESSABILITY  @Y17XAUU 46760000
         BAL   R14,NCPTTE              GET NCP TTE ADDRESS     @Y17XAUU 46830000
*                                                              @Y17XAUU 46900000
*        ON RETURN R1 CONTAINS ADDRESS OF NCP TTE PREFIX       @Y17XAUU 46970000
*                                                              @Y17XAUU 47040000
         USING IEDNTRM,R1              SET TTE ADDRESSABILITY  @Y17XAUU 47110000
         L     R1,TRMDESTQ-D1          GET QCB ADDRESS         @Y17XAUU 47180000
         DROP  R1                                              @Y17XAUU 47250000
         USING IEDQQCB,R1              SET QCB ADDRESSABILITY  @Y17XAUU 47320000
         L     R8,QCBDCBAD-D1          GET 3705 DCB ADDRESS    @Y17XAUU 47390000
         DROP  R1                                              @Y17XAUU 47460000
DCBFIND  EQU   *                                                 S22024 48440000
         USING IHADCB,R8               SET UP BASE REG FOR DCB   S22024 48510000
         TM    DCBOFLGS,X'10'          DCB OPEN                  S99528 48580000
         BZ    NOLINEOP                NO, BRANCH                S22024 48650000
         ST    R8,DCBADDS              SAVE DCB ADDRESS          S99528 48720000
         L     R8,DCBDEBAD             GET DEB ADDRESS           S99528 48790000
         DROP  R8                      DCB                       S99528 48860000
         USING DEBNMSUB,R8             DEB                       S99528 48930000
         SR    R15,R15                 CLEAR REG                 S99528 49000000
         IC    R15,DEBNMEXT            GET # OF EXTENTS          S99528 49070000
         ST    R15,NOOFEXTS            SAVE NUMBER               S99528 49140000
         SLL   R15,2                   MULT BY 4                 S99528 49210000
         CR    R15,R7                  LINE OPEN                 S99528 49280000
         BL    NOLINEOP                NO, BRANCH                S22024 49350000
         L     R8,DEBUCBAD-4(R7)       GET UCB ADDRESS           S99528 49420000
         USING UCB,R8                  UCB                       S99528 49490000
         MVC   RNAME(3),UCBNAME        MOVE NAME TO P-LIST       S99528 49560000
         DROP  R8                      UCB                       S99528 49630000
         ENQ   ,MF=(E,ENQLIST1)        UCB NAME                  S99528 49700000
         MVI   RNAME,X'40'             BLANK OUT                 S99528 49770000
         MVC   RNAME+1(7),RNAME        NAME                      S99528 49840000
         LTR   R15,R15                 ASSIGNED OK               S99528 49910000
         BZ    BUMPPTR                 YES BRANCH                S99528 49980000
         CLI   3(R15),X'08'            ALREADY DONE BY TASK      S99528 50050000
         BE    BUMPPTR                 OK BRANCH                 S99528 50120000
         B     BUSY                    BRANCH                    S99528 50190000
BUMPPTR  EQU   *                                                 S99528 50260000
         LA    R5,4(R5)                BUMP DEV TABLE PTR        S99528 50330000
         LA    R7,TOTTDEND             END OF TABLE ADDRESS      S99528 50400000
         CR    R5,R7                   END OF TABLE              S99528 50470000
         BNE   TNTENTRY                NO, GO GET NEXT ENTRY     S22024 50540000
         B     EXIT                    GET OUT                   S22024 50610000
*                                                                S22024 50680000
*        TRM REJECTED - SIZE OF DATA TO BE TRANSFERRED IS        S22024 50750000
*        GREATER THAN MAXIMUM DATA SIZE THE 3705 CAN HANDLE      S22024 50820000
*                                                                S22024 50890000
DATAERR  EQU   *                                                 S22024 50960000
         IEDQMSG MSGID=013,FUNCT=CEC,RET=CANCELL,PREG0=R0,PREG1=R1      51030000
*                                                                S22024 51100000
*        TRM REJECTED - TEST LINE NOT OPEN                       S22024 51170000
*                                                                S22024 51240000
NOLINEOP EQU   *                                                 S22024 51310000
         IEDQMSG MSGID=038,FUNCT=CEC,RET=CANCELL,PREG0=R0,PREG1=R1      51380000
         EJECT                                                          51450000
*********************************************************************** 51520000
*                                                                     * 51590000
*       EXIT ROUTINE                                                  * 51660000
*                                                                     * 51730000
*********************************************************************** 51800000
         SPACE 2                                                        51870000
EXIT     EQU   *                                                 S22024 51940000
         TM    OLT+X'30',X'10'         DCB OPEN                  S99528 52010000
         BZ    DISPEXIT                NO BRANCH                 S99528 52080000
         CLOSE OLT                     LOT2LIB OR CDSLIB         S99528 52150000
DISPEXIT EQU   *                                                        52220000
         L     R13,4(R13)           TRANSFER CONTROL                    52290000
         L     R14,12(R13)          TO TEST CONTROL                     52360000
         XCTL  (2,12),EP=IEDQWE     MODULE                              52430000
         EJECT                                                          52500000
************************************************************** @Y17XAUU 52570000
*        ROUTINE TO FIND NCP TTE ADDRESS. INPUT: REG 1 =     * @Y17XAUU 52640000
*        TERMINAL TTE ADDRESS. OUTPUT: REG 1 = NCP TTE       * @Y17XAUU 52710000
*        ADDRESS. RETURN TO CALLER VIA REG 14.               * @Y17XAUU 52780000
************************************************************** @Y17XAUU 52850000
NCPTTE   EQU   *                                               @Y17XAUU 52920000
         ST    R14,TRMSAVE2            SAVE RETURN ADDRESS     @Y17XAUU 52990000
         LR    R8,R1                   GET TERMINAL TTE ADDRESS@Y17XAUU 53060000
         LA    R1,TRMPRFSZ             GET TTE PREFIX SIZE     @Y17XAUU 53130000
         SLR   R8,R1                   POINT TO TTE PREFIX     @Y17XAUU 53200000
         USING IEDNTRM,R8              SET TTE ADDRESSABILITY  @Y17XAUU 53270000
NCPLOOP  EQU   *                                               @Y17XAUU 53340000
         LH    R1,TRMCOHRT             GET COHORT POINTER      @Y17XAUU 53410000
         L     15,AVTRNMPT             TTCIN TO TTE CONVERSION @Y17XAUU 53480000
*                                      ROUTINE ADDRESS         @Y17XAUU 53550000
         BALR  R14,R15                 FIND TTE ADDRESS        @Y17XAUU 53620000
         LR    R8,R1                   GET TTE ADDRESS         @Y17XAUU 53690000
         LA    R1,TRMPRFSZ             GET TTE PREFIX SIZE     @Y17XAUU 53760000
         SLR   R8,R1                   POINT TO TTE PREFIX     @Y17XAUU 53830000
         CLI   TRMTYPE,TRMLNCP         NCP ENTRY               @Y17XAUU 53900000
         BNE   NCPLOOP                 NO - CHK NEXT ENTRY     @Y17XAUU 53970000
         LR    R1,R8                   SAVE NCP TTE ADDRESS    @Y17XAUU 54040000
         L     R14,TRMSAVE2            STORE RETURN ADDRESS    @Y17XAUU 54110000
         BR    R14                     RETURN TO CALLER        @Y17XAUU 54180000
         DROP  R8                                              @Y17XAUU 54250000
         DROP  R12                RELEASE AVT BASE             @YM07721 54260000
         EJECT                                                          54320000
**************************************************************** S22024 54390000
*                                                              * S22024 54460000
*        THIS ROUTINE STOPS THE TEST DEVICE.  IF THE DEVICE IS * S22024 54530000
*        A TERMINAL, A 'STOP TERMINAL' OPERATOR CONTROL COMMAND* S22024 54600000
*        IS ISSUED.  IF THE DEVICE IS A 3705, A 'DEACTIVATE'   * S22024 54670000
*        COMMAND IS ISSUED.  IF THE DEVICE IS A LINE, A 'STOP  * S22024 54740000
*        LINE' COMMAND IS ISSUED.                              * S22024 54810000
*                                                              * S22024 54880000
**************************************************************** S22024 54950000
         SPACE 2                                                        55020000
STOPDEV  EQU   *                                                 S22024 55090000
         STM   R5,R6,WORKAREA          SAVE REGISTERS            S22024 55160000
         L     R3,TOTAVTPT             GET ADDRESS OF AVT        S22024 55230000
         USING IEDQAVTD,R3             SET UP ADDRESSIBILITY     S22024 55300000
*                                        FOR AVT                 S22024 55370000
         LA    R1,AVTOPCOB             GET OPERATOR CONTROL      S22024 55440000
*                                        QCB ADDRESS             S22024 55510000
         ST    R1,TOTOKEY              PUT ADDRESS INTO ELEMENT  S22024 55580000
         MVI   TOTOPRI,OPCPRI          SET OP CONTROL PRIORITY   S22024 55650000
         MVI   TOTOKEY,OPCKEY          SET KEY FIELD TO ZERO     S22024 55720000
         MVI   TOTOELNG,OPCELNG        SET ELEMENT LENGTH        S22024 55790000
         XC    TOTOLINK,TOTOLINK       CLEAR LINK FIELD          S22024 55860000
         MVI   TOTORTCD,OPCRTCD        ZERO OUT RETURN CODE FLD  S22024 55930000
         MVI   TOTOLADR,BLANK          MOVE BLANK INTO NAME FLD  S22024 56000000
         MVC   TOTOLADR+D1(D7),TOTOLADR  BLANK OUT FIELD         S22024 56070000
         XC    TOTOTECB,TOTOTECB       CLEAR ECB                 S22024 56140000
         LA    R1,TOTOTECB             GET ECB ADDRESS           S22024 56210000
         ST    R1,TOTOECBA             PUT ECB ADDRESS INTO      S2024 56280000
*                                        ELEMENT                 S22024 56350000
         TM    D0(R5),TOTTDORN         IS TEST DEVICE ON 3705?   S22024 56420000
         BO    RNDEVICE                YES, BRANCH AROUND DEB    S22024 56490000
*                                        SEARCH                  S22024 56560000
         TM    D0(R5),TOTTDTRM         IS TEST DEVICE TERMINAL?  S22024 56630000
         BO    RNDEVICE                BRANCH TO STOP TERMINAL   S22024 56700000
         MVC   TOTOLADR(D3),D13(R6)    MOVE UCB NAME INTO OP     S22024 56770000
*                                        CONTROL ELEMENT         S22024 56840000
         L     R1,AVTTCB               GET TCAM TCB ADDRESS      S22024 56910000
         L     R1,D8(R1)               GET DEB CHAIN ADDRESS     S22024 56980000
         USING DEBNMSUB,R1             SET UP ADDRESSIBILITY FOR S22024 57050000
*                                        DEB                     S22024 57120000
STOPDEV1 EQU   *                                                 S22024 57190000
         LA    R1,D0(R1)               CLEAR HIGH ORDER BYTE     S22024 57260000
         SR    R10,R10                 CLEAR LOOP COUNTER        S22024 57330000
         IC    R10,DEBNMEXT            INITIALIZE LOOP COUNTER   S22024 57400000
*                                        TO NUMBER OF EXTENTS    S22024 57470000
         LA    R8,DEBUCBAD             GET UCB CHAIN ADDRESS     S22024 57540000
         L     R11,DEBDEBAD            GET ADDRESS OF NEXT DEB   S22024 57610000
         L     R9,DEBDCBAD             GET DCB ADDRESS           S22024 57680000
         DROP  R1                      DROP DEB BASE REGISTER    S22024 57750000
         USING IHADCB,R9               SET UP ADDRESSIBILITY FOR S22024 57820000
*                                        DCB                     S22024 57890000
         TM    DCBDSORG+D1,X44         IS THIS A TCAM DEB?       S22024 57960000
         BZ    STOPDEV3                NO: GET NEXT DEB          S22024 58030000
         LA    R7,D1                   INITIALIZE RELATIVE LINE  S22024 58100000
         DROP  R9                      DROP DCB BASE             S22024 58170000
*                                        NUMBER COUNTER TO ONE   S22024 58240000
STOPDEV2 EQU   *                                                 S22024 58310000
         L     R9,D0(R8)               GET UCB ADDRESS           S22024 58380000
         LA    R9,D0(R9)               CLEAR HIGH ORDER BYTE     S22024 58450000
         LA    R6,D0(R6)               CLEAR HIGH ORDER BYTE FOR S22024 58520000
*                                        COMPARE                 S22024 58590000
         CR    R6,R9                   CORRECT UCB FOUND?        S22024 58660000
         BE    STOPDEV4                YES, END OF SEARCH        S2024 58730000
         LA    R7,D1(R7)               BUMP RELATIVE LINE NUMBER S22024 58800000
         LA    R8,D4(R8)               GET NEXT UCB ADDRESS      S22024 58870000
         BCT   R10,STOPDEV2            LOOP TILL END OF UCB CHAINS22024 58940000
STOPDEV3 EQU   *                                                 S22024 59010000
         LR    R1,R11                  POINT R1 TO NEXT DEB      S22024 59080000
         LA    R11,D0(R11)             CLEAR HIGH BYTE           S22024 59150000
         LTR   R11,R11                 IS THTER ANOTHER          S22024 59220000
         BZ    D0(R12)                 NO BRANCH                 S22024 59290000
         B     STOPDEV1                GET NEXT UCB CHAIN        S22024 59360000
STOPDEV4 EQU   *                                                 S22024 59430000
         LM    R5,R6,WORKAREA          RESTORE REGISTERS 5 & 6   S22024 59500000
         STC   R10,TOTORLN             PUT RELATIVE LINE NUMBER  S22024 59570000
*                                        INTO OP CONTROL ELEMENT S22024 59640000
         TM    RNFLAG,RNUCB            IS THIS AN RN UCB TEST?   S22024 59710000
         BNO   STOPLINE                NO, GO ISSUE STOP LINE    S22024 59780000
*                                        COMMAND                 S22024 59850000
         MVI   TOTOVBCD,DEACT          MOVE DEACTIVATE VERB CODE S22024 59920000
*                                        INTO OP CONTROL ELEMENT S22024 59990000
         B     POSTELEM                GO POST ELEMENT           S22024 60060000
STOPTERM EQU   *                                                 S22024 60130000
         L     R8,TTEADDR              GET TTE ADDRESS           S22024 60200000
         LA    R10,TRMPRFSZ            GET TTE PREFIX SIZE     @Y17XAUU 60270000
         SLR   R8,R10                  GET TTE PREFIX ADDRESS  @Y17XAUU 60340000
         USING IEDNTRM,R8              SET TTE ADDRESSABILITY  @Y17XAUU 60410000
         L     R10,TRMDESTQ-D1         GET QCB ADDRESS         @OY12959 60480000
         USING IEDQQCB,R10             SET QCB ADDRESSABILITY  @OY12959 60550000
         MVC   TOTWKSPC(D1),QCBDSFLG   GET QCB FLAG BYTE       @OY12959 60620000
         DROP  R10                                             @OY12959 60690000
         TM    TRMSTATE,TRMPREF        TEST DEVICE ON A 3705   @Y17XAUU 60760000
         BNO   NOT3705                 NO, GO FIND LCB           S22024 60830000
         TM    TRMBYTE0,TRMINPUT       TERM CAPABLE OF INPUT   @OY12959 60900000
         BZ    HOLDTERM                NO - OUTPUT ONLY        @OY12959 60970000
         TM    TRMBYTE0,TRMDIAL        IS TERMINAL DIAL?       @Y17XAUU 61040000
         BNO   STOPBOTH                NO, GO ISSUE STOP TERM    S22024 61110000
*                                        COMMAND                 S22024 61180000
HOLDTERM EQU   *                                                 S22024 61250000
         TM    TOTWKSPC,DISKQ          DISK QUEUE              @OY12959 61320000
         BZ    D0(R12)                 NO - MAIN STORAGE       @OY12959 61390000
         CLC   AVTAS(D4),AVTFZERO      IS HOLD IN THE SYSTEM?   SA64791 61460000
         BE    D0(R12)                 NO, DO NOT ISSUE HOLD    SA64791 61530000
         MVI   TOTOVBCD,TERMHOLD       SET VERB CODE TO HOLD     S22024 61600000
*                                        TERMINAL                S22024 61670000
         B     POSTELEM                GO POST ELEMENT TO OP     S22024 61740000
*                                        CONTROL                 S22024 61810000
NOT3705  EQU   *                                                 S22024 61880000
         L     R10,TRMDESTQ-D1         GET QCB ADDRESS           S22024 61950000
         USING IEDQQCB,R10             SET UP ADDRESSIBILITY FOR S22024 62020000
*                                        QCB                     S22024 62090000
         DROP  R8                      DROP TTE BASE             S22024 62160000
         MVC   TOTWKSPC(D1),QCBDSFLG   GET QCB FLAG BYTE         S22024 62230000
         NI    TOTWKSPC,XF0            CLEAR LOW ORDER NIBBLE    S22024 62300000
         L     R7,QCBDCBAD-D1          GET DCB ADDRESS           S22024 62370000
         USING IHADCB,R7               SET UP ADDRESSIBILITY FOR S22024 62440000
*                                      DCB                       S22024 62510000
         SR    R9,R9                   CLEAR REGISTER 9          S22024 62580000
         IC    R9,QCBRELLN             GET RELATIVE LINE NUMBER  S22024 62650000
         DROP  R10                     DROP QCB BASE             S22024 62720000
         SR    R10,R10                 CLEAR REGISTER 10         S22024 62790000
         IC    R10,DCBEIOBX            GET LCB SIZE FROM DCB     S22024 62860000
         MR    R8,R10                  GET STARTING LCB OFFSET   S22024 62930000
         AL    R9,DCBIOBAD             GET STARTING ADDRESS OF   S22024 63000000
*                                        LCB                     S22024 63070000
         LA    R10,X20                 GET DECREMENT FOR LCB     S22024 63140000
*                                      START                     S22024 63210000
         SR    R9,R10                  GET ADDRESS OF LCB        S22024 63280000
         USING IEDQLCB,R9              SET UP ADDRESSIBILITY FOR S22024 63350000
*                                        LCB                     S22024 63420000
         TM    LCBSTAT2,LCBDIAL        IS THIS A DIAL LCB?       S22024 63490000
         BNO   CHKMO                   NO, GO SEE IF MAIN STORAGES22024 63560000
*                                        ONLY QUEUING            S22024 63630000
         TM    TOTWKSPC,DISKQ           DISK QUEUES?           @ZA06159 63700000
         BNZ   HOLDTERM                 GO ISSUE HOLD CMD      @ZA06159 63770000
         B     D0(R12)                 TERMINAL IS DIAL AND WITH S22024 63840000
*                                        MO QUEUING SO NO OP     S22024 63910000
*                                        CONTROL COMMAND ISSUED  S22024 63980000
CHKMO    EQU   *                                                 S22024 64050000
         L     R8,DCBDEBAD             GET DEB ADDRESS         @OY12959 64120000
         CLI   DEBOPATB-DEBNMSUB(R8),D3 OUTPUT ONLY            @OY12959 64190000
         BE    HOLDTERM                YES                     @OY12959 64260000
         TM    TOTWKSPC,DISKQ           DISK QUEUES?           @ZA06159 64330000
         BZ    INACT                    ONLY INACTIVATE TERM   @ZA06159 64400000
STOPBOTH EQU   *                                                 S22024 64470000
         CLC   AVTAS(D4),AVTFZERO      IS HOLD IN THE SYSTEM?   SA64791 64540000
         BE    INACT                   NO, DO NOT ISSUE HOLD    SA64791 64610000
         DROP  R3                      DROP AVT BASE REGISTER   SA64791 64680000
         MVI   TOTOVBCD,TERMSTOP       GET STOP TERMINAL VERB    S22024 64750000
*                                        CODE (V OFFTP,B)        S22024 64820000
         B     POSTELEM                GO POST ELEMENT TO OP     S22024 64890000
*                                        CONTROL                 S22024 64960000
INACT    EQU   *                                                 S22024 65030000
         MVI   TOTOVBCD,TERMNACT       GET INACTIVATE VERB CODE  S22024 65100000
*                                        (V OFFTP,E)             S22024 65170000
         B     POSTELEM                GO POST ELEMENT TO OP     S22024 65240000
*                                        CONTROL                        65310000
         DROP  R9                      DROP LCB BASE             S22024 65380000
         DROP  R7                      DROP DCB BASE             S22024 65450000
RNDEVICE EQU   *                                                 S22024 65520000
         LR    R9,R6                   SAVE TNT ADDRESS          S22024 65590000
         SR    R10,R10                 CLEAR REGISTER 10         SI2024 65660000
         IC    R10,TOTTTBEL            GET MAXIMUM NAME LENGTH   S22024 65730000
         BCTR  R10,R0                  DECREMENT COUNT BY 1      S22024 65800000
         EX    R10,SYMMOVE             GO MOVE NAME INTO P-LIST  S22024 65870000
         LA    R10,D1(R10)             RESTORE LENGTH OF NAME    S22024 65940000
         AR    R9,R10                  GET TERMINAL ENTRY ADDR   S22024 66010000
         MVC   TTEADDR+D1(D3),D0(R9)  SAVE TTE ADDRESS           S22024 66080000
         L     R8,TTEADDR              GET TTE ADDRESS           S22024 66150000
         LR    R10,R8                  COPY TTE ADDRESS        @Y17XAUU 66220000
         USING IEDQTRM,R8              SET UP ADDRESSIBILITY FOR S22024 66290000
*                                        TERMINAL ENTRY          S22024 66360000
         L     R8,TRMDESTQ-D1          GET QCB ADDRESS           S22024 66430000
         DROP  R8                      DROP TTE BASE             S22024 66500000
         USING IEDQQCB,R8              SET UP ADDRESSIBLITY FOR  S22024 66570000
*                                      QCB                       S22024 66640000
         MVC   TOTORLN(D1),QCBRELLN    GET RELATIVE LINE NUMBER  S22024 66710000
         TM    D0(R5),TOTTDTRM         IS DEVICE A TERMINAL?     S22024 66780000
         BO    BACKUP                  YES, BYPASS INACTIVATE- @YM08136 66800000
*                                      ALREADY DONE BY QWC1/QWJ         66820000
STOPLINE EQU   *                                                 S22024 66920000
         MVI   TOTOVBCD,LINESTOP       MOVE STOP LINE VERB CODE  S22024 66990000
*                                      INTO ELEMENT              S22024 67060000
         TM    D0(R5),TOTTDORN         IS DEVICE ON A 3705?      S22024 67130000
         BNO   POSTELEM                NO, DO NOT GET GROUP NAME S22024 67200000
         LA    R1,TRMPRFSZ             GET TTE PREFIX SIZE     @XM05679 67207010
         SLR   R10,R1                  POINT TO TTE PREFIX     @XM05679 67214010
         USING IEDNTRM,R10             SET TTE ADDRESSABILITY  @XM05679 67221010
         CLI   TRMTYPE,TRMNSDLC        NON SDLC LINK           @XM05679 67228010
         BE    POSTE                   YES                     @XM05679 67235010
         MVI   TOTOVBCD,TERMHOLD       SET HOLD TERM VERB CODE @XM05679 67242010
         B     POSTELEM                GO ISSUE COMMAND        @XM05679 67249010
POSTE    EQU   *                                               @XM05679 67256010
         L     R8,QCBLGBAD-D1          GET LGB ADDRESS TO GET    S22024 67270000
         DROP  R8                      LINE GROUP NAME           S22024 67340000
         USING IEDNLGB,R8              FOR STOP LINE ON 3705     S22024 67410000
         MVC   TOTOLADR(D8),LGBNAME    GROUP NAME TO PLIST     @Y17XAUU 67440000
         DROP  R8                                              @Y17XAUU 68110000
POSTELEM EQU   *                                                 S22024 68180000
         LA    R1,TOTPLIST             GET ADDRESS OF OP CONTROL S22024 68250000
*                                        PARAMETER LIST          S22024 68320000
         ST    R1,ELEM1                STORE ADDRESS IN 1ST WORD S22024 68390000
*                                        OF SVC 102 POST LIST    S22024 68460000
         ST    R1,ELEM2                STORE ADDRESS INTO 2ND    S22024 68530000
*                                        WORD OF SVC 102 POSTLISTS22024 68600000
         MVI   ELEM1,START102          MOVE IN ACTION CODE       S22024 68670000
         MVI   ELEM2,LAST102           MOVE IN LAST ELEMENT      S22024 68740000
*                                        INDICATOR               S22024 68810000
         LA    R1,SLPL                 GET ADDRESS OF OPERATOR   S22024 68880000
*                                        CONTROL PARAMETER LIST  S22024 68950000
         TM    TOTFLG04,TOTCLOSE       TCAM CLOSE DOWN IN        S22024 69020000
*                                        PROGRESS?               S22024 69090000
         BO    EXIT                    YES, BRANCH TO EXIT       S2024 69160000
         AQCTL                         ISSUE OP CONTROL COMMAND  S22024 69230000
         WAIT  ECB=TOTOTECB            WAIT FOR FUNCTION         S22024 69300000
         LM    R5,R6,WORKAREA          RESTORE REGISTERS 5 & 6   S22024 69370000
         CLI   TOTOVBCD,SWPRI          SW TO PRIMARY             Y06330 69440000
         BE    SWCHECK                 YES BRANCH                Y06330 69510000
         CLI   TOTOVBCD,SWBCK          SW REQUEST                Y06330 69580000
         BE    SWCHECK                 YES BRANCH                Y06330 69650000
         CLI   TOTORTCD,GOOD           WAS REQUEST SUCCESSFUL?   S22024 69720000
         BE    BACKUP                  YES, GO SEE IF DEVICE IS  S22024 69790000
*                                        IN BACKUP MODE          S22024 69860000
         CLI   TOTORTCD,ALREADY        ALREADY STOPPED?          S22024 69930000
         BE    BACKUP                  YES, GO SEE IF DEVICE IS  S22024 70000000
*                                        IN BACKUP MODE          S22024 70070000
         CLI   TRMTYPE,TRMSDLC         SDLC LINK               @Y17XAUU 70140000
         BNE   STOPERR                 NO - WRITE ERROR MSG    @Y17XAUU 70210000
         MVI   TOTOVBCD,RELEASE        SET RELEASE TERM VERB CD@Y17XAUU 70280000
         XC    TOTORTCD,TOTORTCD       CLEAR RETURN CODE       @Y17XAUU 70350000
         XC    TOTOLINK(D3),TOTOLINK   CLEAR LINK FIELD        @Y17XAUU 70420000
         XC    TOTOTECB(D4),TOTOTECB   CLEAR ECB               @Y17XAUU 70490000
         LA    R1,TOTOTECB             GET ECB ADDRESS         @Y17XAUU 70560000
         ST    R1,TOTOECBA             PUT ECB ADDRESS IN PLIST@Y17XAUU 70630000
         LA    R1,SLPL                 GET PLIST ADDRESS       @Y17XAUU 70700000
         AQCTL                         RELEASE THE TERMINALS   @Y17XAUU 70770000
*                                      ON THE SDLC LINK        @Y17XAUU 70840000
         WAIT  ECB=TOTOTECB            WAIT FOR COMPLETION     @Y17XAUU 70910000
         DROP  R10                                             @YM07444 70980000
STOPERR  DS    0H                      BOUNDARY ALLIGNMENT     @Y17XAUU 71050000
         SPACE 2                                                        71120000
***                                                              S22024 71190000
***      SEND STOP DEVICE FAILED MESSAGE                         S22024 71260000
***                                                              S22024 71330000
         MVC   DEVSTOP,TOTOLADR        MOVE NAME INTO MESSAGE    S22024 71400000
         IEDQMSG FUNCT=CEC,OTBUF=STOPFAIL,OTCNT=55,PREG0=R0,PREG1=R1,  *71470000
               RET=CANCELL1                                             71540000
         SPACE 1                                                        71610000
BACKUP   EQU   *                                                 S22024 71680000
         L     R8,TTEADDR              GET TTE ADDRESS           S22024 71750000
         LA    R1,TRMPRFSZ             GET TTE PREFIX SIZE     @Y17XAUU 71820000
         SLR   R8,R1                   POINT TO TTE PREFIX     @Y17XAUU 71890000
         USING IEDNTRM,R8              SET TTE ADDRESSABILITY  @Y17XAUU 71960000
         TM    TRMSTATE,TRMPREF        3705 RESOURCE           @Y17XAUU 72030000
         BNO   D0(R12)                 NO, RETURN TO CALLER      S22024 72100000
         CLI   TRMTYPE,TRMSDLC         SDLC LINK TEST          @Y17XAUU 72170000
         BE    LUCHK                   YES - SCAN LU'S         @Y17XAUU 72240000
         TM    $TOTFLG1,$TERMSEC       TRM REQUEST TEST IN       Y06330 72310000
*                                        BACKUP MODE (IE.TAP)    Y06330 72380000
         BO    IED272I                 YES, GO ISSUE ERROR MSG   Y06330 72450000
         TM    TRMBYTE1,TRMSWBCK       IS TERMINAL IN SWITCHED @Y17XAUU 72520000
*                                        BACKUP MODE?            Y06330 72590000
         BZ    D0(R12)                 NO, NO COMMAND NEEDED     Y06330 72660000
         MVI   TOTOVBCD,SWPRI          MOVE SWITCH TO PRIMARY    Y06330 72730000
*                                        VERB CODE IN P-LIST     Y06330 72800000
         DROP  R8                                              @Y17XAUU 72870000
CLRFIELD EQU   *                                                 Y06330 72940000
         MVI   TOTOKEY,OPCKEY          CLEAR KEY                 Y06330 73010000
         MVI   TOTORTCD,OPCRTCD        CLEAR RT CODE             Y06330 73080000
         XC    TOTOTECB,TOTOTECB       CLEAR ECB                 Y06330 73150000
         XC    TOTOLINK,TOTOLINK       CLEAR LINK FIELD          Y06330 73220000
         OI    D0(R5),TOTTSWPM         INITIAL STATUS IS BACKUP  Y06330 73290000
         B     POSTELEM                GO TO OP CONTROL          Y06330 73360000
SWCHECK  EQU   *                                                 Y06330 73430000
         CLI   TOTORTCD,GOOD           REQUEST SUCESSFUL         Y06330 73500000
         BE    D0(R12)                 YES RETURN                Y06330 73570000
         MVC   TERMINAL(D8),TOTOLADR   NAME TO MSG               Y06330 73640000
         CLI   TOTOVBCD,SWPRI          VERB SW TO PRIMARY        Y06330 73710000
         BNE   IED240I                 NO BRANCH                 Y06330 73780000
         MVC   BACKUPP(D7),PRIMARY     PROCESS MSG               Y06330 73850000
IED240I  EQU   *                                                 Y06330 73920000
         IEDQMSG FUNCT=CEC,OTBUF=BCKUPFAL,OTCNT=52,PREG0=R0,PREG1=R1,  C73990000
               RET=CANCELL             CAN NOT MAKE SW REQUEST   Y06330 74060000
         SPACE 2                                                        74130000
***      ISSUE MESSAGE SAYING BACKUP TEST NOT YET SUPPORTED      Y06330 74200000
***      ISSUE MESSAGE SAYING BACKUP TEST NOT YT                        74270000
IED272I  EQU   *                                                 Y06330 74340000
         IEDQMSG MSGID=014,FUNCT=CEC,PREG0=R0,                   Y06330*74410000
               PREG1=R1,RET=CANCELL                              Y06330 74480000
         BO    NOTRM                   YES, CANCEL TRM           S22024 74550000
         B     D0(R12)                 NO, RETURN TO CALLER      S22024 74620000
*                                                                S22024 74690000
*        TEST DEVICE IN SWITCHED BACKUP MODE - TRM CANCELLED     S22024 74760000
*                                                                S22024 74830000
NOTRM    EQU   *                                                 S22024 74900000
         IEDQMSG MSGID=012,FUNCT=CEC,RET=CANCELL,PREG0=R0,PREG1=R1      74970000
SYMMOVE  MVC   TOTOLADR(D0),D0(R9)     MOVE SYMBOLIC NAME TO     S22024 75040000
*                                        OPERATOR CONTROL PARM   S22024 75110000
*                                        LIST                    S22024 75180000
IED278I  EQU   *                       IED278I                 @SA69637 75250000
***      IED278I TRM CANCELLED - TEST DEVICE IS BEING GEN POLLEDSA69637 75320000
         IEDQMSG FUNCT=CEC,OTBUF=GPOLLREJ,OTCNT=59,PREG0=R0,           C75390000
               PREG1=R1,RET=CANCELL    REJ TRM                 @SA69637 75460000
         EJECT                                                          75530000
LUCHK    DS    0H                      BOUNDARY ALLIGNMENT     @Y17XAUU 75600000
************************************************************** @Y17XAUU 75670000
*                                                            * @Y17XAUU 75740000
*        VERIFY ALL LU'S ON THE SDLC LINK ARE NOT IN SESSION * @Y17XAUU 75810000
*        IF ANY ARE IN SESSION TERMINATE TRM PROCESSING AND  * @Y17XAUU 75880000
*        TURN OFF TRMSTOTE FLAG IN EACH LU TTE AND LINE TTE. * @Y17XAUU 75950000
*        ISSUE RELEASE FOR SDLC LINK.                        * @Y17XAUU 76020000
*                                                            * @Y17XAUU 76090000
************************************************************** @Y17XAUU 76160000
         L     R14,TOTAVTPT            GET AVT ADDRESS         @Y17XAUU 76230000
         USING IEDQAVTD,R14            SET AVT ADDRESSABILITY  @Y17XAUU 76300000
         L     R14,AVTSAVTP            GET SAVT ADDRESS        @Y17XAUU 76370000
         DROP  R14                                             @Y17XAUU 76440000
         USING IEDNSVTD,R14            SET SAVT ADDRESSABILITY @Y17XAUU 76510000
         MVC   SSCPTCIN(D2),SAVTSCPT   SAVE SSCT TTCIN         @Y17XAUU 76580000
         DROP  R14                                             @Y17XAUU 76650000
         SPACE                                                          76720000
         L     R1,TTEADDR              GET LINE TTE ADDRESS    @Y17XAUU 76790000
         LA    R8,TRMPRFSZ             GET TTE PREFIX SIZE     @Y17XAUU 76860000
         SLR   R1,R8                   POINT TO TTE PREFIX     @Y17XAUU 76930000
         USING IEDNTRM,R1              SET TTE ADDRESSABILITY  @Y17XAUU 77000000
         LH    R1,TRMSUBST             GET SUBSTRUCT POINTER   @Y17XAUU 77070000
         LTR   R1,R1                   ANY TERMINALS ON LINE   @Y17XAUU 77140000
         BZ    LUSTOP                  GO ISSUE STOPLINE       @Y17XAUU 77210000
         SPACE                                                          77280000
LULOOP   DS    0H                      BOUNDARY ALLIGNMENT     @Y17XAUU 77350000
         L     R15,TERNMTAB            GET TTE CONVERSION RTNA @Y17XAUU 77420000
         BALR  R14,R15                 GO FIND TTE ADDRESS     @Y17XAUU 77490000
         SLR   R1,R8                   POINT TO TTE PREFIX     @Y17XAUU 77560000
         CLI   TRMTYPE,TRMSDLC         END OF CHAIN            @Y17XAUU 77630000
         BE    LUSTOP                  YES - GO ISSUE STOPLINE @Y17XAUU 77700000
         ICM   RSIB,ADRMSK,TRMSIBPT    GET SIB ADDRESS         @Y17XAUU 77770000
         BZ    LURL08                  NO SESSION ACTIVE       @Y17XAUU 77840000
         USING IEDSIBD,RSIB            SET SIB ADDRESSABILITY  @Y17XAUU 77910000
         CLC   SSCPTCIN(D2),SIBINDEX   SSCP-LU SESSION ONLY    @Y17XAUU 77980000
         BNE   LURLSE                  NO - ERROR PROCESSING   @Y17XAUU 78050000
LURL08   DS    0H                      BOUNDARY ALLIGNMENT     @Y17XAUU 78120000
         LH    R1,TRMCOHRT             GET COHORT POINTER      @Y17XAUU 78190000
         B     LULOOP                  CHECK NEXT ENTRY        @Y17XAUU 78260000
LUSTOP   DS    0H                      BOUNDARY ALLIGNMENT     @Y17XAUU 78330000
         MVI   TOTOVBCD,LINESTOP       SET STOPLINE VERB CODE  @Y17XAUU 78400000
         XC    TOTORTCD(D1),TOTORTCD   CLEAR RETURN CODE       @Y17XAUU 78470000
         XC    TOTOLINK(D3),TOTOLINK   CLEAR LINK FIELD        @Y17XAUU 78540000
         XC    TOTOTECB(D4),TOTOTECB   CLEAR ECB               @Y17XAUU 78610000
*                                                              @ZM46755 78617010
*        SET LGBNAME IN PARM LIST                              @ZM46755 78624010
         L     R8,TRMDESTQ-D1          QCB ADDR                @ZM46755 78631010
         USING IEDQQCB,R8                                      @ZM46755 78638010
         L     R8,QCBLGBAD-D1          LGB ADDR                @ZM46755 78645010
         DROP  R8                                              @ZM46755 78652010
         USING IEDNLGB,R8                                      @ZM46755 78659010
         MVC   TOTOLADR(D8),LGBNAME    GROUP NAME TO PLIST     @ZM46755 78666010
         DROP  R8                                              @ZM46755 78673010
         LA    R1,SLPL                 POINT TO PLIST          @Y17XAUU 78680000
         AQCTL                         ISSUE STOPLINE          @Y17XAUU 78750000
         WAIT  ECB=TOTOTECB            WAIT FOR COMPLETION     @Y17XAUU 78820000
         CLI   TOTORTCD,GOOD           GOOD RETURN             @ZM46755 78850010
         BE    D0(R12)                 YES, CHECK NEXT ENTRY   @ZM46755 78890010
         SPACE                                                          78960000
LURLSE   DS    0H                      BOUNDARY ALLIGNMENT     @Y17XAUU 79030000
         MVC   DEVSTOP,TOTOLADR        MOVE NAME TO MESSAGE    @Y17XAUU 79100000
*        STOP FAILED FOR TEST DEVICE                           @Y17XAUU 79170000
         IEDQMSG FUNCT=CEC,OTBUF=STOPFAIL,OTCNT=55             @Y17XAUU 79240000
         L     R1,TTEADDR              GET LINE TTE ADDRESS    @Y17XAUU 79310000
         LA    R8,TRMPRFSZ             GET TTE PREFIX SIZE     @Y17XAUU 79380000
         SLR   R1,R8                   POINT TO TTE PREFIX     @Y17XAUU 79450000
         USING IEDNTRM,R1              SET TTE ADDRESSABILITY  @Y17XAUU 79520000
         LH    R1,TRMSUBST             GET SUBSTRUCT POINTER   @Y17XAUU 79590000
         LTR   R1,R1                   ANY TERMINALS ON LINE   @Y17XAUU 79660000
         BZ    LURLSEND                NO - ISSUE RELEASE      @Y17XAUU 79730000
LULOOP1  DS    0H                      BOUNDARY ALLIGNMENT     @Y17XAUU 79800000
         L     R15,TERNMTAB            GET TTE CONVERSION RTNA @Y17XAUU 79870000
         BALR  R14,R15                 GO FIND TTE ADDRESS     @Y17XAUU 79940000
         SLR   R1,R8                   POINT TO TTE PREFIX     @Y17XAUU 80010000
         L     R14,TRMBYTE2            WORD CONTAINS TRMSTOTE  @G36XRUV 80080010
CSLOOP1  DS    0H                                              @G36XRUV 80090010
         LR    R15,R14                 COPY                    @G36XRUV 80100010
         N     R15,OFFSTOTE            TURN OF TOTE BIT IN REG @G36XRUV 80110010
         CS    R14,R15,TRMBYTE2        RESET TRMSTOTE          @G36XRUV 80120010
         BNZ   CSLOOP1                 BR IF WORD ALTERED      @G36XRUV 80130010
         CLI   TRMTYPE,TRMSDLC         END OF CHAIN            @Y17XAUU 80150000
         BE    LURLSEND                YES - ISSUE RELEASE     @Y17XAUU 80220000
         LH    R1,TRMCOHRT             GET COHORT POINTER      @Y17XAUU 80290000
         B     LULOOP1                 CHECK NEXT ENTRY        @Y17XAUU 80360000
         DROP  R1                                              @Y17XAUU 80430000
LURLSEND DS    0H                      BOUNDARY ALLIGNMENT     @Y17XAUU 80500000
         MVI   TOTOVBCD,RELEASE        SET RELEASE VERB CODE   @Y17XAUU 80570000
         XC    TOTORTCD(D1),TOTORTCD   CLEAR RETURN CODE       @Y17XAUU 80640000
         XC    TOTOLINK(D3),TOTOLINK   CLEAR LINK FIELD        @Y17XAUU 80710000
         XC    TOTOTECB(D4),TOTOTECB   CLEAR ECB FOR WAIT      @Y17XAUU 80780000
         LA    R1,SLPL                 POINT TO PLIST          @Y17XAUU 80850000
         AQCTL                         POST REQUEST            @Y17XAUU 80920000
         WAIT  ECB=TOTOTECB            WAIT FOR COMPLETION     @Y17XAUU 80990000
         SPACE                                                          81060000
         B     CANCELL1                CANCEL TRM              @Y17XAUU 81130000
         EJECT                                                          81200000
         DS    0F                                                       81270000
TERNMTAB DS    A                       SAVE AREA               @Y17XAUU 81340000
EIGHTSAV DC    AL4(0)                  SAVE REG EIGHT            S99528 81410000
ENQLIST  ENQ   (QNAME,RNAME,E,8,STEP),RET=USE,MF=L                      81480000
ENQLIST1 ENQ   (QNAME,RNAME,S,8,STEP),RET=USE,MF=L                      81550000
QNAME    DC    CL8'SYSZTOTE'           MAJOR NAME              @Y17XAUU 81620000
RNAME    DC    8CL1' '                 MINOR NAME                S99528 81690000
***                                                                     81760000
***                                    PL FOR SVC 102                   81830000
SLPL     DS    0F                                                S99528 81900000
ELEM1    DS    F                       POINTER TO 1ST ELEMENT    S22024 81970000
ELEM2    DS    F                       POINTER TO LAST ELEMENT   S22024 82040000
OFFSTOTE DS    0F                      TURNS OFF TRMSTOTE W/C&S@G36XRUV 82050010
         DC    XL1'FF'                                         @G36XRUV 82060010
         DC    AL1(255-TRMSTOTE)                               @G36XRUV 82070010
         DC    XL2'FFFF'                                       @G36XRUV 82080010
         DS    0D                                                S99528 82110000
CDSNAME  DC    CL8'G0000000'           CDSNAME                   S99528 82180000
DCBADDS  DC    A(0)                    DCB SAVE AREA             S99528 82250000
NOOFEXTS DC    A(0)                    NUMBER EXTENTS SAVE AREA  S99528 82320000
RESTORE  DC    X'00'                   FLAG                      S99528 82390000
NFIVESIX EQU   X'80'                   DO NOT RESTORE            S99528 82460000
CLEARFLG EQU   X'00'                   CLEAR                     S99528 82530000
OLT      DCB   DDNAME=OLTLIB,DSORG=PO,MACRF=(R,W),LRECL=256,RECFM=U,   X82600000
               BLKSIZE=256                                       S99528 82670000
         DS    0F                                                S99528 82740000
CDSLIB   DC    CL8'CDSLIB  '           DDNAME                    S99528 82810000
TNTNAME  DC    CL8'        '           TNT NAME                  S99528 82880000
TNTMOVE  MVC   0(0,R8),0(R6)           MOVE TNT NAME             S99528 82950000
         DS    0F                                                S99528 83020000
TTEADDR  DC    A(0)                    TTE ADDRESS               S99528 83090000
TRMSAVE2 DS    F                       REGISTER SAVE AREA      @Y17XAUU 83160000
RNFLAG   DC    X'00'                   FLAG BYTE                 S22024 83230000
SSCPTCIN DS    H                       SSCP TTCIN SAVE AREA    @Y17XAUU 83300000
ONE      DC    H'1'                    CONSTANT 1                S22024 83370000
OFFSET   DS    H                       TERMNAME TABLE OFFSET     S22024 83440000
RSIDSAVE DS    H                       RSID SAVE AREA            S22024 83510000
WORKAREA DS    2F                      REGISTER SAVE AREA        S22024 83580000
A270XSW  WTOR  'IED148D IS C. U. FOR DEVICE XXXXXXXX CONNECTED ONLY TO *83650000
               THIS SYSTEM?',ANSWER,3,,MF=L  DEVICE SWITCHED OR  S22024 83720000
*                                              SHARED MESSAGE    S22024 83790000
ANSWER   DC    X'000000'               YES OR NO                 S99528 83860000
PROTDEV  WTOR  'IED328D CAN PROTECTED DEVICE          BE TESTED?',     *83930000
               ANSWER,3,,MF=L                                    S99528 84000000
PROTMSG  DC    CL64'IED329I SYSTEM OPERATOR WILL NOT ALLOW TEST ON PROT*84070000
               ECTED DEVICE '          MESSAGE                   S22024 84140000
DEVPRONA DC    CL8'        '           NAME FOR MESSAGE                 84210000
*  MESSAGE ISSUED WHEN BAD RETURN CODE RECEIVED FROM OP CONTROL  S22024 84280000
STOPFAIL DC    CL47'IED221I TRM CANCELLED - STOP FAILED FOR DEVICE '    84350000
DEVSTOP  DC    CL8'        '           NAME FOR MESSAGE          S22024 84420000
BCKUPFAL EQU   *                                                 Y06330 84490000
         DC    C'IED240I TERMINAL'     MESSAGE                   Y06330 84560000
TERMINAL DC    C'XXXXXXXX'             TERMINAL NAME             Y06330 84630000
         DC    C'CANNOT BE SWITCHED TO'  MESSAGE                 Y06330 84700000
BACKUPP  DC    C'BACK UP'              MESSAGE                   Y06330 84770000
PRIMARY  DC    C'PRIMARY'              MESSAGE                   Y06330 84840000
SAVENT   DS    F                  TNT ADDRESS SAVE AREA        @Y17XAUU 84910000
BTUSIZE  DC    H'14'                   SIZE OF BTU               S22024 84980000
HDRSIZE  DC    H'31'                   SIZE OF HEADER PAD        S22024 85050000
DATASIZE DC    H'512'                  MAXIMUM DATA SIZE         S22024 85120000
OLTTCBSZ DC    H'23'                   SIZE OF OLTTCB            S22024 85190000
INITSTAT DS    F                       TEST DEVICE TABLE ENTRY  SA41599 85260000
*                                        SAVE AREA (INITIAL     SA41599 85330000
*                                        STATUS IN FIRST BYTE)  SA41599 85400000
GPOLLREJ DC    C'IED278I TRM CANCELLED - TEST DEVICE IS BEING GENERAL PC85470000
               OLLED'                  MESSAGE                 @SA69637 85540000
         EJECT                                                          85610000
         TDCTD                                                 @Y17XAUU 85680000
         EJECT                                                          85750000
         OLTCB                         TOTE CONTROL BLOCK        S22024 85820000
         EJECT                                                          85890000
         TLGBD                         LINE GROUP CONTROL BLOCK  S22024 85960000
*                                                                       86030000
DCHBNAME EQU   7                                                        86100000
         EJECT                                                          86170000
UCB      DSECT                                                          86240000
         IEFUCBOB                                                       86310000
         EJECT                                                          86380000
         TAVTD                                                          86450000
         EJECT                                                          86520000
         TTNTD                                                          86590000
         EJECT                                                          86660000
         TTRMD                                                          86730000
         EJECT                                                          86800000
         TPRFD                                                          86870000
         EJECT                                                          86940000
         TLCBD                                                          87010000
         EJECT                                                          87080000
DCBDSECT DCBD  DSORG=TX                                                 87150000
         EJECT                                                          87220000
CVT      DSECT                                                          87290000
         CVT                                                            87360000
         EJECT                                                          87430000
         TQCBD                                                          87500000
         EJECT                                                          87570000
         TDEBD                                                          87640000
         EJECT                                                          87710000
         TSIBD                                                 @Y17XAUU 87780000
         END                                                            87850000
