         TITLE 'IEDQWF1 - TOTE MVM DEALLOCATION ROUTINE'                00090007
IEDQWF1  CSECT                                                          00180007
         SPACE 2                                                        00270007
* CHANGE ACTIVITY AS FOLLOWS:                                           00360007
*A000000-999999                                                  Y06335 00450007
* A004500,288000,291600,575100,675900,719100,733500,829800     @G36XRUV 00460010
* C013500,288900,576000,628200,734400                          @G36XRUV 00470010
* D290700,292500,735300                                        @G36XRUV 00480010
*                                                                       00490010
         SPACE 2                                                        00540007
***************************************************************         00630007
*                                                             *         00720007
* MODULE NAME = IEDQWF1                                       *         00810007
*                                                             *         00900007
* DESCRIPTIVE NAME = TOTE MVM DEALLOCATION ROUTINE            *         00990007
*                                                             *         01080007
* COPYRIGHT = NONE                                            *         01170007
*                                                             *         01260007
* STATUS = CHANGE LEVEL 10                                    *@G36XRUV 01300010
*                                                             *         01440007
* FUNCTION = THE PURPOSE OF THIS MODULE IS TWOFOLD:           *         01530007
*                                                             *         01620007
*            A. TO TAKE DEVICES AWAY FROM TCAM AND CONDITION  *         01710007
*               THEM FOR TEST RUNNING UNDER OLTEP.            *         01800007
*                                                             *         01890007
*            B. TO RETURN DEVICES BACK TO TCAM IN THE SAME    *         01980007
*               INITIAL CONDITION THAT THEY WERE IN BEFORE    *         02070007
*                                                             *         02160007
*               FUNCTION ONE IS INITIATED WHEN A TRM IN THE   *         02250007
*               FOLLOWING FORMAT IS ENTERED:                  *         02340007
*                                                             *         02430007
*               SYSCON/TD/TOTE//                              *         02520007
*                                                             *         02610007
*               FUNCTION TWO IS INITIATED WHEN THE OPERATOR   *         02700007
*               RESPONDS TO A WTOR TELLING TOTE TO RETURN ALL *         02790007
*               SUBCHANNELS BACK TO TCAM                      *         02880007
*                                                             *         02970007
*               IN THE FORMAT ABOVE, 'TD' REPRESENTS THE      *         03060007
*               SUBCHANNEL ADDRESS(ES) TO BE TAKEN AWAY       *         03150007
*               FROM TCAM.                                    *         03240007
*                                                             *         03330007
*            IN ORDER TO ACCOMPLISH THE FIRST FUNCTION, TOTE  *         03420007
*            WILL EVALUATE THE TEST FIELD OF THE TRM          *         03510007
*            SCANNING ON THE KEYWORD 'TOTE'.  TOTE              *       03600007
*            WILL EVALUATE ALL ENTRIES IN THE TEST DEVICE     *         03690007
*            FIELD CHECKING TO VERIFY THAT ALL THE SUBCHANNEL *         03780007
*            ADDRESSES ARE ALLOCATED TO TCAM VIA A TIOT       *         03870007
*            SEARCH. IF ALL DEVICES DO NOT BELONG TO TCAM     *         03960007
*            THE REQUEST FOR DEALLOCATION WILL BE REJECTED.   *         04050007
*                                                             *         04140007
*            IF ALL DEVICES BELONG TO TCAM, THEN TOTE WILL    *         04230007
*                                                             *         04320007
*            A. REQUEST AUTHORIZATION FROM THE SYSTEM OPERATOR*         04410007
*               TO TAKE EXCLUSIVE USE OF THE SPECIFIED SUB-   *         04500007
*               CHANNELS. IF THE REQUEST IS REJECTED THE TRM  *         04590007
*               IS REJECTED.                                  *         04680007
*                                                             *         04770007
*            B. SAVE THE INITIAL STATUS OF ALL SUB-CHANNELS   *         04860007
*               SPECIFIED.                                    *         04950007
*                                                             *         05040007
*            C. TURN OFF THE BIT (UCBNALOC) IN EACH UCB WHICH *         05130007
*               SAYS THAT THE SUB-CHANNEL IS ALLOCATED TO     *         05220007
*               TCAM (SRTESTAT,SRTEALOC).                     *         05310007
*                                                             *         05400007
*            D. TURN ON THE OFFLINE BIT IN THE UCB FOR EACH   *         05490007
*               SUB-CHANNEL (SRTESTAT,SRTEONLI).              *         05580007
*                                                             *         05670007
*            E. ISSUE A STOPLINE TO ALL DEVICES (EXCEPT FOR   *         05760007
*               A 370X, IN WHICH A DEACTIVATE IS ISSUED).     *         05850007
*                                                             *         05940007
*            NOTE: SYSCON MUST ALWAYS BE SPECIFIED AS THE     *         06030007
*                  CONTROL TERMINAL.                          *         06120007
*                                                             *         06210007
*            A WTOR IS ISSUED AND OLTEP CAN BE INVOKED. A     *         06300007
*            RESPONSE OF 'TOTE' TO THE WTOR WILL INVOKE       *         06390007
*            FUNCTION TWO.                                              06480007
*                                                             *         06570007
*                                                             *         06660007
*            WHEN THE REQUEST IS FOR REALLOCATION             *         06750007
*            OF TCAM DEVICES TOTE WILL RETURN ALL DEVICES TO  *         06840007
*            THEIR ORIGINAL STATUS AND FREE UP ALL WORK AREAS *         06930007
*                                                             *         07020007
* ENTRY POINTS = IEDQWF1                                      *         07110007
*                                                             *         07200007
* INPUT =                                                     *         07290007
*                                                             *         07380007
*         REGISTERS 02, 13, 14, 15 CONTAIN THE FOLLOWING      *         07470007
*         VALUES:                                             *         07560007
*                                                             *         07650007
*         02 - OLTCB POINTER                                  *         07740007
*                                                             *         07830007
*         13 - SAVE AREA ADDRESS                              *         07920007
*                                                             *         08010007
*         14 - RETURN ADDRESS                                 *         08100007
*                                                             *         08190007
*         15 - ENTRY POINT ADDRESS                            *         08280007
*                                                             *         08370007
* OUTPUT =                                                    *         08460007
*                                                             *         08550007
*         NONE                                                *         08640007
*                                                             *         08730007
* EXTERNAL REFERENCES =                                       *         08820007
*                                                             *         08910007
*         NONE                                                *         09000007
*                                                             *         09090007
* EXITS,NORMAL                                                *         09180007
*                                                             *         09270007
*                                                             *         09360007
* EXITS,ERROR                                                 *         09450007
*                                                             *         09540007
*                                                             *         09630007
*                                                             *         09720007
* TABLES/WORK AREAS =                                         *         09810007
*                                                             *         09900007
*         OLTCB, AVT, TNT, TTE, QCB, PARAMETER LIST           *         09990007
*                                                             *         10080007
* ATTRIBUTES =                                                *         10170007
*                                                             *         10260007
*         ENABLED, PROBLEM PROGRAM MODE, TRANSIENT            *         10350007
*                                                             *         10440007
* NOTES =                                                     *         10530007
*                                                             *         10620007
*         NONE                                                *         10710007
*                                                             *         10800007
***************************************************************         10890007
         EJECT                                                          10980007
***************************************************************         11070007
*                                                             *         11160007
*        E Q U A T E S                                        *         11250007
*                                                             *         11340007
***************************************************************         11430007
         SPACE                                                          11520007
R0       EQU   0                  REG 0                                 11610007
R1       EQU   1                  REG 1                                 11700007
R2       EQU   2                  REG 2                                 11790007
R3       EQU   3                  REG 3                                 11880007
R4       EQU   4                  REG 4                                 11970007
R5       EQU   5                  REG 5                                 12060007
R6       EQU   6                  REG 6                                 12150007
R7       EQU   7                  REG 7                                 12240007
R8       EQU   8                  REG 8                                 12330007
R9       EQU   9                  REG 9                                 12420007
R10      EQU   10                 REG 10                                12510007
R11      EQU   11                 REG 11                                12600007
R12      EQU   12                 REG 12                                12690007
R13      EQU   13                 REG 13                                12780007
R14      EQU   14                 REG 14                                12870007
R15      EQU   15                 REG 15                                12960007
BASE     EQU   12                 BASE REGISTER                         13050007
PARMREG0 EQU   R0                 MSG REG                               13140007
PARMREG1 EQU   R1                 MSG REG                               13230007
         SPACE                                                          13320007
D0       EQU   0                  DISP OF 0                             13410007
D1       EQU   1                  DISP OF 1                             13500007
D2       EQU   2                  DISP OF 2                             13590007
D3       EQU   3                  DISP OF 3                             13680007
D4       EQU   4                  DISP OF 4                             13770007
D5       EQU   5                  DISP OF 5                             13860007
D6       EQU   6                  DISP OF 6                             13950007
D7       EQU   7                  DISP OF 7                             14040007
D8       EQU   8                  DISP OF 8                             14130007
D9       EQU   9                  DISP OF 9                             14220007
D10      EQU   10                 DISP OF 10                            14310007
D11      EQU   11                 DISP OF 11                            14400007
D12      EQU   12                 DISP OF 12                            14490007
D13      EQU   13                 DISP OF 13                            14580007
D14      EQU   14                 DISP OF 14                            14670007
D15      EQU   15                 DISP OF 15                            14760007
D16      EQU   16                 DISP OF 16                            14850007
D17      EQU   17                 DISP OF 17                            14940007
D18      EQU   18                 DISP OF 18                            15030007
D19      EQU   19                 DISP OF 19                            15120007
D20      EQU   20                 DISP OF 20                            15210007
D24      EQU   24                 DISP OF 24                            15300007
D28      EQU   28                 DISP OF 28                            15390007
D32      EQU   32                 DISP OF 32                            15480007
D36      EQU   36                 DISP OF 36                            15570007
D40      EQU   40                 DISP OF 40                            15660007
D43      EQU   X'43'              DISP OF 43                            15750007
D44      EQU   44                 DISP OF 44                            15840007
D48      EQU   48                 DISP OF 48                            15930007
D53      EQU   53                 DISP OF 53                            16020007
D72      EQU   72                 DISP OF 72                            16110007
         SPACE                                                          16200007
XDC      EQU   X'DC'              PRIORITY                              16290007
X18      EQU   X'18'              LENGTH                                16380007
X0C      EQU   X'0C'              START FLAG                            16470007
X80      EQU   X'80'              END FLAG                              16560007
X00      EQU   X'00'              ZERO RT CODE FROM OPCONTROL           16650007
X08      EQU   X'08'              EIGHT RT CODE OPCONTROL               16740007
X44      EQU   X'44'              TCAM DEB ID                           16830007
STOP     EQU   X'41'              STOP LINE VERB                        16920007
START    EQU   X'40'              START LINE VERB                       17010007
ACTIV    EQU   X'53'              ACTIVATE 370X VERB                    17100007
DEACT    EQU   X'54'              DEACTIVATE 370X VERB                  17190007
IPL      EQU   X'52'              IPL 370X VERB                         17280007
BLK      EQU   X'40'              BLANK                                 17370007
ALREADY  EQU   X'08'              RETURN CODE FROM ENQ                  17460007
XFF      EQU   X'FF'              MASK SETTING                          17550007
YES      EQU   X'E8'              Y OR YES                              17640007
NALLOC   EQU   X'F7'              MASK                                  17730007
OFFLIN   EQU   X'7F'              MASK                                  17820007
XF0      EQU   X'F0'              MASK SETTING                          17910007
ONALLOC  EQU   X'88'              UCB ONLINE AND ALLOC FLAGS            18000007
KA       EQU   X'C1'              CHAR A                                18090007
ACTVBCD  EQU   X'46'              ACTIVATE COMMAND                      18180007
ACTRC    EQU   X'08'              INVITATION LIST ACTIVE RT CD          18270007
INACT    EQU   X'48'              INACTIVATE RETURN CODE                18360007
INACTRC  EQU   X'08'              ALREADY INACT RT CD                   18450007
MORE     EQU   X'80'              MASK BYTE                             18540007
END      EQU   X'7F'              MASK BYTE                             18630007
INCLUS   EQU   X'20'              MASK BYTE                             18720007
ADDONE   EQU   X'10'              MASK BYTE                             18810007
ADDOFF   EQU   X'EF'              MASK BYTE                             18900007
ALLOFF   EQU   X'00'              MASK BYTE                             18990007
NOINC    EQU   X'DF'              MASK FIELD                            19080007
BLANK    EQU   X'40'              BLANK CHAR                            19170007
TDMAX    EQU   256                MAX TD                                19260007
KF       EQU   X'C6'              CHAR F                                19350007
F9       EQU   X'F9'              CHAR 9                                19440007
F0       EQU   X'F0'              CHAR 0                                19530007
XC0      EQU   X'C0'              MASK SETTING                          19620007
ZERO     EQU   0                  0 VALUE                               19710007
FOUR     EQU   4                  FOUR VALUE                            19800007
TWELVE   EQU   12                 12 VALUE                              19890007
TRMAX    EQU   72                 TRM BUFFER LENGTH                     19980007
ACVT     EQU   16                 POINTER TO CVT ADDRESS                20070007
SLASH    EQU   X'61'              SLASH CHAR                            20160007
COMMA    EQU   X'6B'              COMMAS CHAR                           20250007
DASH     EQU   X'60'              DASH CHAR                             20340007
RQINIT   EQU   X'0C'              START OF LIST                         20430007
RQEND    EQU   X'80'              END OF LIST                           20520007
NEG      EQU   4                  NEGATIVE TEST                         20610007
X0F      EQU   X'0F'              MASK SETTING                          20700007
TCU3705  EQU   X'05'              3705 UCB                              20790007
ENQLOOP  EQU   10                 ENQ RETRY COUNT                       20880007
         EJECT                                                          20970007
         USING IEDQWF1,R15                                              21060007
IEDQWF1  IEDHJN STARF1,HJN                                              21150007
         SPACE                                                          21240007
         SAVE  (14,12)            SAVE CALLER'S REGISTERS               21330007
         SPACE                                                          21420007
         DROP  R15                                                      21510007
         LR    BASE,R15           SET BASE                              21600007
         USING IEDQWF1,BASE                                             21690007
         USING TOTOLTCB,R2                                              21780007
         LA    R3,TOTSAVE4        M4 SAVE AREA                          21870007
         ST    R3,D8(R13)         SAVE IN CALLER'S SAVE AREA            21960007
         ST    R13,D4(R3)         SAVE MY SAVE AREA ADDRESS             22050007
         LR    R13,R3             SET UP SAVE AREA REG                  22140007
         SPACE 2                                                        22230007
         BAL   R11,OLTACT         SEND ON LINE TEST ACT MSG             22320007
START1   BAL   R11,BLDTBL         BUILD UCB TABLE                       22410007
         BAL   R11,ALLOC          VERIFY UCB'S ALLOC TO TCAM            22500007
         BAL   R11,AUTHNCM        REQUEST NCM MODE                      22590007
         BAL   R11,INITSTAT       SAVE INITIAL STATUS                   22680007
         BAL   R11,CONDIT         CONDITION UCB'S                       22770007
         B     POST               WAIT UNTIL OLTEP IS FINISHED          22860007
         EJECT                                                          22950007
****************************************************************        23040007
*                                                              *        23130007
*        SEND ON LINE TESTING ACTIVE MESSAGE                   *        23220007
*                                                              *        23310007
****************************************************************        23400007
OLTACT   DS    0H                 BOUNDARY ALLIGNMENT            Y06335 23490007
         IEDQMSG MSGID=002,FUNCT=CEC                                    23580007
****************************************************************        23670007
         MVC   TRMCTID(D2),TOTOLTID CONTROL TERMINAL ID                 23760007
         ST    R2,TMID+D16        PUT OLTCB ADDR IN MSG        @YA12402 23850010
         TCONV FROM=TMID+D16,TO=TMID+D8,COUNT=D4,TYPE=HE                23940007
         MVC   TMID+16(4),TMID+21  MOVE OLTCB ADDRESS          @YA12402 24030010
****************************************************************        24120007
         SPACE                                                          24210007
         IEDQMSG FUNCT=CEC,OTBUF=TMID,OTCNT=TMIDE-TMID                  24300007
         SPACE                                                          24390007
         BR    R11                RETURN                                24480007
#EXIT    L     R15,$TABLE          TO BE REMOVED BEFORE SHIP            24570007
         MVC   TRMCTID(D2),TOTOLTID                                     24660007
         L     R15,28(R15)         TO BE REMOVED BEFORE SHIP            24750007
         BR    R15                 TO BE REMOVED BEFORE SHIP            24840007
         EJECT                                                          24930007
***************************************************************         25020007
*                                                             *         25110007
*        ROUTINE TO BUILD A TABLE FOR ALL SUBCHANNEL ADDRESSES*         25200007
*        ENTERED IN THE TEST DEVICE FIELD. A MAXIMUM OF 256   *         25290007
*        SUBCHANNEL ADDRESSES MAY BE ENTERED. IF MORE THAN    *         25380007
*        256 SUBCHANNELS ARE SPECIFIED, AN ERROR MSG IS       *         25470007
*        WRITTEN AND THE TRM IS REJECTED. A 256 4-BYTE TABLE  *         25560007
*        IS ALLOCATED. THE ENTRIES IN THE TABLE HAVE THE      *         25650007
*        FOLLOWING FORMAT:                                    *         25740007
*                                                             *         25830007
*              BYTE 0   - RESERVED FOR INITIAL STATUS         *         25920007
*                                                             *         26010007
*              BYTE 1   - RESERVED                            *         26100007
*                                                             *         26190007
*              BYTE 2-3 - UCB ADDRESS                         *         26280007
*                                                             *         26370007
*        LINKAGE -  BAL  R11,BLDTBL                           *         26460007
*                                                             *         26550007
*                                                             *         26640007
***************************************************************         26730007
         SPACE                                                          26820007
BLDTBL   DS    0H                 BOUNDARY ALLIGNMENT                   26910007
         SPACE                                                          27000007
         STM   R3,R10,SAVE1       SAVE CALLER'S REG                     27090007
         MVI   TDFLG,D0           CLEAR CONTROL FLAG                    27180007
         LA    R3,TOTTRMBF        POINT TO TRM BUFFER                   27270007
         LA    R3,D7(R3)          POINT TO FIRST CUU                    27360007
         L     R4,ACVT(R0)        CVT ADDR                              27450007
         USING CVT,R4                                                   27540007
         L     R4,CVTILK2         PICK UP 2 BYTE UCB TABLE ADDR         27630007
         ST    R4,UCBSAVE         SAVE IT                               27720007
         DROP  R4                                                       27810007
         LA    R5,TABLE-D4        ADDR OF TD TABLE-4                    27900007
         LA    R10,TDMAX          GET MAX NO OF TEST DEVS               27990007
BLD04    DS    0H                 BOUNDARY ALLIGNMENT                   28080007
         LA    R6,D0              INITIALIZE ENTRY COUNTER              28170007
BLD05    EQU   *                  LOOP ENTRY                            28260007
         CLI   D0(R3),F0                IS FIRST CHAR A ZERO?  @YA12402 28270010
         BNE   DIGIT3                   NO                     @YA12402 28280010
         TM    D3(R3),XC0               IS 4TH CHAR ALPHANUM?  @YA12402 28290010
         BNO   DIGIT3                   NO                     @YA12402 28300010
         LA    R3,D1(R3)                ADJUST FOR LEADING ZERO@YA12402 28310010
DIGIT3   EQU   *                                               @YA12402 28320010
         MVC   WORK4+D1(D4),D0(R3) GET LOWER CUU (EBCDIC)               28350007
         BAL   R14,CONVERT        CONVERT IT TO HEX                     28440007
BLD08    DS    0H                 BOUNDARY ALLIGNMENT                   28530007
         L     R8,UCBSAVE         ADDR OF UCB PTRS                      28620007
         USING UCB,R7                                                   28710007
BLD0C    DS    0H                 BOUNDARY ALLIGNMENT                   28800007
         SLR   R7,R7              CLEAR                        @G36XRUV 28830010
         ICM   R7,3,D0(R8)        UCB ADDR                              28860010
         LA    R8,D2(R8)          POINT TO NEXT ENTRY                   28980007
         BZ    BLD0C              PADDING IGNORE                        29160007
         CLM   R7,3,ENDTABLE      Q-END OF TABLE               @G36XRUV 29190010
         BE    ERROR1             Y- ERROR                     @G36XRUV 29220010
         CLC   WORK1(D2),UCBCHA   UCB FOUND                             29340007
         BNE   BLD0C              NO - CHECK NEXT ENTRY                 29430007
         CLI   UCBTBYT3,UCB3COMM  CLASS EQ COMMUNICATION DEVICE         29520007
         BE    BLD14              YES - CONTINUE                        29610007
         CLI   UCBTBYT3,UCB3DISP  CLASS EQ DISPLAY                      29700007
         BE    BLD14              YES - CONTINUE                        29790007
         SPACE                                                          29880007
         IEDQMSG MSGID=007,FUNCT=CEC CLASS NOT SUPT                     29970007
         B     RETURN             TERMINATE                             30060007
         SPACE                                                          30150007
BLD14    DS    0H                 BOUNDARY ALLIGNMENT                   30240007
         TM    SRTESTAT,SRTEALOC  ALLOCATED TO TCAM                     30330007
         BZ    NOTFOUND           NO - TERMINATE                        30420007
         TM    SRTESTAT,SRTEONLI  UCB ONLINE (LINE OPENED)     @Y17XAUU 30421000
         BO    BLD16              YES - CONTINUE               @Y17XAUU 30422000
*        INVALID TEST DEVICE ENTRY - TEST LINE NOT OPENED      @Y17XAUU 30423000
         IEDQMSG MSGID=038,FUNCT=CEC WRITE ERROR MESSAGE       @Y17XAUU 30424000
         B     RETURN1            TERMINATE TRM PROCESSING     @Y17XAUU 30425000
BLD16    DS    0H                 BOUNDARY ALLIGNMENT          @Y17XAUU 30426000
         LA    R5,D4(R5)          NEXT ENTRY SLOT                       30510007
         LA    R6,D1(R6)          INCREMENT ENTRY COUNTER               30600007
         CR    R6,R10             MORE THAN 256 ENTRIES                 30690007
         BH    ERROR3             YES - ERROR                           30780007
         STH   R7,D2(R5)          ENTRY TO TABLE                        30870007
         MVC   WORK2(D1),UCBTBYT4 TCU TYPE TO WORK AREA                 30960007
         NI    WORK2,X0F          CLEAR UNWANTED BITS                   31050007
         CLI   WORK2,TCU3705      3705 TCU                              31140007
         BNE   BLD18              NO                                    31230007
         OI    D0(R5),RNCHAN      YES - SHOW 3705 ENTRY                 31320007
BLD18    DS    0H                 BOUNDARY ALLIGNMENT                   31410007
         TM    TDFLG,INCLUS       INCLUSIVE TEST                        31500007
         BO    BLD34              YES - CONTINUE                        31590007
         CLI   D3(R3),SLASH       END OF FIELD                          31680007
         BE    BLDRET             YES - EXIT                            31770007
         CLI   D3(R3),COMMA       ANOTHER ENTRY                         31860007
         BE    BLD20              YES - CONTINUE                        31950007
         CLI   D3(R3),DASH        INCLUSIVE SUBCHAN                     32040007
         BE    BLD24              YES                                   32130007
         B     ERROR1             NO - INVALID DELIMITER                32220007
         SPACE                                                          32310007
BLD20    DS    0H                 BOUNDARY ALLIGNMENT                   32400007
         NI    TDFLG,XFF-INCLUS   CLEAR INCLUSIVE FLAG                  32490007
         LA    R3,D4(R3)          POINT TO NEXT CUU                     32580007
         B     BLD05              CONTINUE                              32670007
         SPACE                                                          32760007
BLD24    DS    0H                 BOUNDARY ALLIGNMENT                   32850007
         LR    R1,R3              SAVE CUU POINTER                      32940007
         LA    R3,D4(R3)          POINT PASS DASH                       33030007
         MVC   BIN1(D2),WORK1     SAVE LOWER BOUND                      33120007
         CLI   D0(R3),F0                IS FIRST CHAR ZERO?    @YA12402 33130010
         BNE   MOVE3                    NO                     @YA12402 33140010
         TM    D3(R3),XC0               IS 4TH CHAR ALPHANUM?  @YA12402 33150010
         BNE   MOVE3                    NO                     @YA12402 33160010
         LA    R3,D1(R3)                ADJUST FOR LEADING ZERO@YA12402 33170010
MOVE3    EQU   *                                               @YA12402 33180010
         MVC   WORK4+D1(D4),D0(R3) GET UPPER CUU                        33210007
         BAL   R14,CONVERT        CONVERT IT TO HEX                     33300007
         MVC   BIN3(D2),WORK1     SAVE IT                               33390007
BLD30    DS    0H                 BOUNDARY ALLIGNMENT                   33480007
         CLC   D0(D3,R1),D0(R3)   VALID LOWER/UPPER LIMITS              33570007
         BNL   ERROR1             NO - ERROR                            33660007
         OI    TDFLG,INCLUS       SHOW INCLUSIVE CUU                    33750007
BLD34    DS    0H                 BOUNDARY ALLIGNMENT                   33840007
         LH    R7,BIN1            GET CURRENT CUU VALUE                 33930007
         LA    R7,D1(R7)          INCREMENT TO NEXT CUU                 34020007
         CH    R7,BIN3            PROCESSING COMPLETE                   34110007
         BH    BLD40              YES - EXIT                            34200007
         STH   R7,BIN1            SAVE IT                               34290007
         STH   R7,WORK1           SET COMPARAND                         34380007
         B     BLD08              VERIFY CUU ENTRY                      34470007
         SPACE                                                          34560007
BLD40    DS    0H                 BOUNDARY ALLIGNMENT                   34650007
         CLI   D3(R1),SLASH       END OF FIELD                 @YA12402 34740010
         BE    BLDRET             YES - EXIT                            34830007
         LA    R3,D4(R1)          POINT TO SECOND CUU                   34920007
         CLI   D3(R1),COMMA       DELIMITER                    @YA12402 35010010
         BE    BLD20              YES                                   35100007
         B     ERROR1             NO - ERROR                            35190007
         SPACE                                                          35280007
BLDRET   DS    0H                 BOUNDARY ALLIGNMENT                   35370007
         LM    R3,R10,SAVE1       RESTORE REGS                          35460007
         BR    R11                RETURN                                35550007
         EJECT                                                          35640007
***************************************************************         35730007
*                                                             *         35820007
*        ROUTINE TO CONVERT FROM EBCDIC TO HEX.               *         35910007
*        INPUT EQU THREE BYTES IN 'WORK4+1'                   *         36000007
*        OUTPUT EQU TWO BYTES IN 'WORK1'                      *         36090007
*        RETURN EQU 'BR  R14   '                              *         36180007
*                                                             *         36270007
***************************************************************         36360007
CONVERT  DS    0H                 BOUNDARY ALLIGNMENT                   36450007
         STM   R3,R8,SAVE2        SAVE CALLER'S REGS                    36540007
         LA    R3,WORK4+D1        ADDR OF INPUT                         36630007
         LA    R4,D3              SET LOOP COUNT                        36720007
CONV08   DS    0H                 BOUNDARY ALLIGNMENT                   36810007
         CLI   D0(R3),KA          LESS THAN 'A'                         36900007
         BL    ERROR1             YES - ERROR                           36990007
         CLI   D0(R3),KF          NOT GREATER THAN'F'                   37080007
         BNH   CONV10             YES - VALID                           37170007
         CLI   D0(R3),F0          LESS THAN '0'                         37260007
         BL    ERROR1             YES - ERROR                           37350007
         CLI   D0(R3),F9          GREATER THAN '9'                      37440007
         BH    ERROR1             YES - ERROR                           37530007
CONV10   DS    0H                 BOUNDARY ALLIGNMENT                   37620007
         LA    R3,D1(R3)          POINT TO NEXT CHAR                    37710007
         BCT   R4,CONV08          CHECK IT                              37800007
         CLI   D0(R3),SLASH       END OF TD FIELD                       37890007
         BE    CONV18             YES                                   37980007
         CLI   D0(R3),DASH        INCLUSIVE DELIMITER                   38070007
         BE    CONV18             YES                                   38160007
         CLI   D0(R3),COMMA       MORE ENTRIES                          38250007
         BNE   ERROR1             NO - ERROR                            38340007
CONV18   DS    0H                 BOUNDARY ALLIGNMENT                   38430007
         LA    R3,WORK4+D1        ADDR OF INPUT                         38520007
         LA    R4,D3              SET LOOP COUNT                        38610007
         LA    R7,XLATE           ADDR OF XLATE TABLE                   38700007
CONV20   DS    0H                 BOUNDARY ALLIGNMENT                   38790007
         TM    D0(R3),XF0         NUMERIC                               38880007
         BNO   CONV24             NO                                    38970007
         NI    D0(R3),X0F         CLEAR ZONE                            39060007
         B     CONV28             CONTINUE                              39150007
CONV24   DS    0H                 BOUNDARY ALLIGNMENT                   39240007
         NI    D0(R3),X0F         CLEAR ALPHA ZONE                      39330007
         SR    R6,R6              CLEAR REG                             39420007
         IC    R6,D0(R3)          GET 'ALPHA CHAR'             @YA12402 39460010
         AR    R6,R7              POINT TO HEX VALUE                    39510007
         MVC   D0(D1,R3),D0(R6)   REPLACE WITH HEX VALUE                39600007
CONV28   DS    0H                 BOUNDARY ALLIGNMENT                   39690007
         LA    R3,D1(R3)          POINT TO NEXT CHAR                    39780007
         BCT   R4,CONV20          PROCESS IT                            39870007
         MVI   WORK4,D0           PREPARE TO PACK                       39960007
         MVI   WORK4+D4,D0        PREPARE TO PACK                       40050007
         PACK  PACK1(D3),WORK4(D5) PACK IT                              40140007
         MVC   WORK1(D2),PACK1    PASS IT BACK                          40230007
         LM    R3,R8,SAVE2        RESTORE REGS                          40320007
         BR    R14                RETURN                                40410007
         SPACE                                                          40500007
ERROR1   DS    0H                 BOUNDARY ALLIGNMENT                   40590007
         WTO   'IED269I ERROR IN TEST DEVICE FIELD',ROUTCDE=10,DESC=7   40680007
         OI    TOTFLG06,TOTTERMS  SET TERMINATE FLAG                    40770007
         B     RETURN             EXIT                                  40860007
         DROP  R7                 UCB                                   40950007
         SPACE 2                                                        41040007
ERROR3   DS    0H                 BOUNDARY ALLIGNMENT                   41130007
         WTO   'IED273I ERROR - MORE THAN 256 TEST DEVICES ENTERED',ROU*41220007
               TCDE=10,DESC=7                                           41310007
         B     RETURN             EXIT                                  41400007
         EJECT                                                          41490007
***************************************************************         41580007
*                                                             *         41670007
*                                                             *         41760007
*        ROUTINE TO VERIFY THAT SUBCHANNELS ARE ALLOCATED TO  *         41850007
*        TCAM VIA TIOT SEARCH. THE 256 WORD TEST DEVICE       *         41940007
*        TABLE IS SEARCHED. IF ALL ARE NOT ALLOCATED TO TCAM  *         42030007
*        THE TRM IS REJECTED                                  *         42120007
*                                                             *         42210007
***************************************************************         42300007
ALLOC    DS    0H                 BOUNDARY ALLIGNMENT                   42390007
         LA    R4,TABLE           TEST DEVICE TABLE                     42480007
         LA    R7,TABLEND         END OF TABLE                          42570007
ALLTEST  DS    0H                 BOUNDARY ALLIGNMENT            Y06335 42660007
         CR    R4,R7              ALL ENTRIES PROCESSED                 42750007
         BE    ZERO(R11)          YES - EXIT                            42840007
         L     R8,ZERO(R4)        GET ADDR FROM TABLE                   42930007
         LA    R8,ZERO(R8)        CLEAR HI ORDER BYTE                   43020007
         STH   R8,KUCB            SAVE UCB ADDRESS                      43110007
         LTR   R8,R8              IS THERE AN ADDRESS                   43200007
         BZ    ZERO(R11)          NO - RETURN                           43290007
         LA    R9,CVTPTR          POINTER TO CVT                        43380007
         L     R9,ZERO(R9)        CVT ADDR                              43470007
         L     R9,ZERO(R9)        TCB ADDR                              43560007
         L     R9,FOUR(R9)        CURRENT TCB ADDR                      43650007
         L     R9,TWELVE(R9)      TIOT ADDR                             43740007
         USING TIOT,R9                                                  43830007
         LA    R9,TIOENTRY        FIRST ENTRY                           43920007
         DROP  R9                                                       44010007
         USING TIOENTRY,R9                                              44100007
GETLENGT DS    0H                 BOUNDARY ALLIGNMENT            Y06335 44190007
         SR    R3,R3              CLEAR REG 3                           44280007
         IC    R3,TIOELNGH        DD ENTRY LENGTH                       44370007
         LTR   R3,R3              ANY LENGTH ?                          44460007
         BZ    NOTFOUND           NO - ERROR                            44550007
         LA    R5,POOLSTAR-TIOESTTB DEV ENTRY LENGTH                    44640007
         DROP  R9                                                       44730007
         LR    R10,R3             SAVE LENGTH                           44820007
         SR    R3,R5              DD LENGTH - 4                         44910007
         AR    R3,R9              DEVICE                                45000007
         USING TIOESTTB,R3                                              45090007
         CLC   TIOEFSRT+D1(D2),KUCB  ENTRY FOUND                        45180007
         DROP  R3                                                       45270007
         BE    FOUND              ENTRY FOUND                           45360007
         AR    R9,R10             POINT TO NEXT ENTRY                   45450007
         B     GETLENGT           CONTINUE LOOKING                      45540007
FOUND    DS    0H                 BOUNDARY ALLIGNMENY            Y06335 45630007
         LA    R4,FOUR(R4)        POINT TO NEXT LINE                    45720007
         B     ALLTEST            CHECK NEXT ENTRY                      45810007
NOTFOUND DS    0H                 BOUNDARY ALLIGNMENT            Y06335 45900007
         WTO   'IED274I ERROR - TEST DEVICE NOT ALLOCATED TO TCAM',ROUT*45990007
               CDE=10,DESC=7                                            46080007
         B     RETURN             GO TO PROMPTER                        46170007
         EJECT                                                          46260007
***************************************************************         46350007
*                                                             *         46440007
*        ROUTINE TO ASK SYSTEM OPERATOR FOR EXCLUSIVE USE     *         46530007
*        OF SUBCHANNELS ENTERED IN TEST DEVICE FIELD.         *         46620007
*                                                             *         46710007
***************************************************************         46800007
AUTHNCM  DS    0H                 BOUNDARY ALLIGNMENT                   46890007
         STM   R3,R10,SAVE1       SAVE CALLER'S REGS                    46980007
         LA    R3,TOTTRMBF+D7     START OF TEST DEVICE FIELD            47070007
         LA    R4,D0              INITIALIZE CHAR COUNTER               47160007
AUTH04   DS    0H                 BOUNDARY ALLIGNMENT                   47250007
         CLI   D0(R3),SLASH       END OF FIELD                          47340007
         BE    AUTH08             YES                                   47430007
         LA    R4,D1(R4)          INCREMENT CHAR COUNTER                47520007
         LA    R3,D1(R3)          POINT TO NEXT CHAR                    47610007
         B     AUTH04             CHECK IT                              47700007
         SPACE                                                          47790007
AUTH08   DS    0H                 BOUNDARY ALLIGNMENT                   47880007
         LA    R3,TOTTRMBF+D7     RESET TD FIELD POINTER                47970007
         BCTR  R4,R0              DECREMENT COUNT FOR EX                48060007
         EX    R4,CUUMOVE         NAME TO MESSAGE                       48150007
         WTO   'IED224D CAN OLT HAVE EXCLUSIVE USE OF CONTROL UNIT ON A*48240007
               DDRESS(ES) ',ROUTCDE=10,DESC=7                           48330007
         SPACE                                                          48420007
         XC    ECB(D4),ECB        CLEAR ECB                             48510007
         SPACE                                                          48600007
WTORNCM  WTOR  '                                                     ',*48690007
               ANSWER,3,ECB,ROUTCDE=(8,10),DESC=2                       48780007
NCMMSG2  EQU   WTORNCM+D16        PLACE FOR CUU'S                       48870007
         STIMER REAL,NOANS,DINTVL=TIMOUT SET TIMER FOR TIMEOUT          48960007
         WAIT  ECB=ECB            WAIT FOR REPLY                        49050007
         TTIMER CANCEL            CANCEL TIMER                          49140007
         OI    ANSWER,BLANK       XLATE TO CAPS                         49230007
         CLI   ANSWER,YES         ANSWER YES                            49320007
         BNE   AUTH0C             NO - REJECT TRM                       49410007
         LM    R3,R10,SAVE1       RESTORE CALLER'S REGS                 49500007
         BR    R11                RETURN                                49590007
         SPACE                                                          49680007
CUUMOVE  MVC   NCMMSG2(D0),D0(R3) CUU'S TO MSG                          49770007
         SPACE                                                          49860007
AUTH0C   DS    0H                 BOUNDARY ALLIGNMENT                   49950007
         IEDQMSG MSGID=051,FUNCT=CEC ALLOW ONLY CONCURRENT MODE         50040007
         B     RETURN             RETURN                                50130007
         SPACE                                                          50220007
         EJECT                                                          50310007
NOANS    DS    0H                 BOUNDARY ALLIGNMENT                   50400007
         STM   R14,R12,D12(R13)   SAVE CALLER'S REGS                    50490007
         LR    R4,R15             MY BASE                               50580007
         USING NOANS,R4                                                 50670007
         LA    R12,TOTSAVE1       MY SAVE AREA                          50760007
         ST    R13,D4(R12)        SAVE HIS SAVE ADDR                    50850007
         ST    R12,D8(R13)        SAVE MY SAVE ADDR                     50940007
         LR    R13,R12            SET SAVE SAVE POINTER                 51030007
         POST  ECB                POST WTOR ECB                         51120007
         L     R13,D4(R13)        CALLER'S SAVE                         51210007
         LM    R14,R12,D12(R13)   RESTORE CALLER'S REGS                 51300007
         SR    R15,R15            RETURN CODE REG                       51390007
         BR    R14                RETURN TO CALLER                      51480007
         DROP  R4                                                       51570007
         EJECT                                                          51660007
***************************************************************         51750007
*     A. ROUTINE TO TAKE SUBCHAN ADDRESSES ENTERED IN THE     *         51840007
*        TEST DEVICE FIELD AWAY FROM TCAM.                    *         51930007
*                                                             *         52020007
*        1. IF THE CUU IS FOR A 370X A DEACTIVATE IS ISSUED.  *         52110007
*                                                             *         52200007
*        2. IF THE CUU IS FOR A 270X OR 32XX A STOPLINE IS    *         52290007
*           ISSUED.                                           *         52380007
*                                                             *         52470007
*        NOTE- IF THE RETURN CODE IS OTHER THAN X'00' OR X'08'*         52560007
*        FOR ANY DEACTIVATE OR STOPLINE THE TRM IS REJECTED.  *         52650007
*                                                             *         52740007
*     B. EXAMINE THE RETURN CODE FROM THE STOPLINE OR DEACT-  *         52830007
*                                                             *         52920007
*        IVATE TO SAVE THE INITIAL STATUS OF THE DEVICE.      *         53010007
*     C. ENQ FOR EXCLUSIVE CONTROL FOR ALL TEST DEVICES.      *         53100007
*                                                             *         53190007
*        NOTE- IF ANY ENQ FAILS THE TRM IS REJECTED.          *         53280007
*                                                             *         53370007
*     D. IF ENTERED FOR CLEANUP  RETURNS DEVICES TO TCAM      *         53460007
*                                                             *         53550007
*        1. IF THE TEST DEVICE IS A 370X ISSUE AN IPL.        *         53640007
*                                                             *         53730007
*        2. IF THE INITIAL STATUS WAS STOPPED CLEAR THE       *         53820007
*           LCBCPA FIELD.                                     *         53910007
*                                                             *         54000007
*        3. IF THE INITIAL STATUS WAS STARTED ISSUE           *         54090007
*           EITHER ACTIVATE(370X) OR STARTLINE                *         54180007
*                                                             *         54270007
*        4. DEQ ALL TEST DEVICES                              *         54360007
*                                                             *         54450007
*                                                             *         54540007
*                                                             *         54630007
*                                                             *         54720007
*                                                             *         54810007
*                                                             *         54900007
***************************************************************         54990007
INITSTAT EQU   *                  ROUTINE ENTRY                         55080007
         STM   R3,R10,SAVE1       SAVE WORK REGS                        55170007
         TM    CTLFLG,CLEANUP     ENTRY FOR CLEANUP                     55260007
         BO    INIT05             YES BRANCH                            55350007
         MVI   TOTOPRI,XDC        PRIORITY OF ELEMENT                   55440007
         MVI   TOTOELNG,X18       LENGTH OF ELEMENT                     55530007
         LA    R3,TOTPLIST        GET OP CONTROL P LIST                 55620007
         ST    R3,SLPL            ADDRESS AND STORE IN                  55710007
         ST    R3,SLPL+D4         ELEMENT TWICE                         55800007
         MVI   SLPL,X0C           START FLAG                            55890007
         MVI   SLPL+D4,X80        END FLAG                              55980007
         MVI   TOTOLADR,BLK       BLANK OUT                             56070007
         MVC   TOTOLADR+D1(D7),TOTOLADR  NAME                           56160007
         LA    R3,TOTOTECB        GET ECB ADDRESS                       56250007
         ST    R3,TOTOECBA        PUT IN P LIST                         56340007
         L     R3,TOTAVTPT        GET AVT ADDRESS                       56430007
         USING IEDQAVTD,R3        AVT                                   56520007
         LA    R3,AVTOPCOB        GET OP CONTROL QCB ADDRESS            56610007
         DROP  R3                 AVT                                   56700007
         ST    R3,TOTOKEY         PUT IN P LIST                         56790007
         SPACE                                                          56880007
INIT05   EQU   *                  CONTINUE                              56970007
         LA    R3,TABLE           TABLE ADDRESS                         57060007
         LA    R4,TABLEND         END OF TABLE ADDRESS                  57150007
         SPACE                                                          57240007
INIT10   EQU   *                  REENTRY FOR LOOP                      57330007
         CR    R3,R4              ALL ENTRIES PROCSEEED                 57420007
         BE    INIT90             YES BRANCH                            57510007
         SLR   R5,R5              CLEAR                        @G36XRUV 57540010
         ICM   R5,3,D2(R3)        GET ENTRY FROM TABLE                  57570010
*                                 UCB ADDRESSES                         57690007
         LTR   R5,R5              IS ENTRY FILLED IN                    57780007
         BZ    INIT90             NO BRANCH                             57870007
         USING UCBOB,R5           UCB                                   57960007
         OI    CTLFLG,RLNSRCH     INDICATE RLN SEARCH                   58050007
         BAL   R14,INIT45         GO FIND RLN                           58140007
         STC   R7,TOTORLN         RLN TO P LIST                         58230007
         NI    CTLFLG,XFF-RLNSRCH TURN OFF FLAG                         58320007
         MVC   RNAME(D3),UCBNAME  NAME TO ENQ OR DEQ                    58410007
         MVC   TOTOLADR(D3),UCBNAME  NAME FOR OPCONTROL                 58500007
         TM    CTLFLG,CLEANUP     ENTERED FOR CLEANUP                   58590007
         BO    INIT15             YES BRANCH                            58680007
         ENQ   ,MF=(E,ENQLIST)    REQUEST EXCLUSIVE USE                 58770007
         LTR   R15,R15            OK                                    58860007
         BZ    INIT15             YES BRANCH                            58950007
         CLI   D3(R15),ALREADY    ALREADY FROM THIS TASK                59040007
         BE    INIT15             YES BRANCH                            59130007
*        SEND ERROR MSG AND CANCEL TRM                                  59220007
         XC    D0(D4,R3),D0(R3)   CLEAR FAILLING ENTRY FORM TABLE       59310007
         OI    CTLFLG,CLEANUP     TURN ON CLEANUP FLAG                  59400007
         IEDQMSG MSGID=044,FUNCT=CEC,RET=INIT05                         59490007
         SPACE                                                          59580007
INIT15   EQU   *                  ENQ OK                                59670007
         TM    D0(R3),RNCHAN      TEST DEVICE ON 370X                   59760007
         BO    INIT30             YES BRANCH                            59850007
         TM    CTLFLG,CLEANUP     CLEANUP                               59940007
         BO    INIT40             YES BRANCH                            60030007
         MVI   TOTOVBCD,STOP      VERB TO STOPLINE                      60120007
         SPACE                                                          60210007
INIT20   EQU   *                  SET FOR OP CONTROL                    60300007
         XC    TOTOLINK,TOTOLINK  CLEAR LINK FIELD                      60390007
         XC    TOTOTECB,TOTOTECB  CLEAR ECB                             60480007
         LA    R1,SLPL            ADDRESS OF P LIST                     60570007
         AQCTL                    POST ELEMENT                          60660007
         WAIT  ECB=TOTOTECB       WAIT FOR COMPLEATION                  60750007
         CLI   TOTOVBCD,IPL       WAS LAST OPERATION IPL                60840007
         BE    INIT70             YES BRANCH                            60930007
         CLI   TOTORTCD,X00       WAS REQUEST PERFORMED                 61020007
         BE    INIT75             YES BRANCH                            61110007
         CLI   TOTORTCD,X08       WAS REQUEST NO-OPED                   61200007
         BE    INIT80             YES BRANCH                            61290007
         TM    CTLFLG,CLEANUP     CLEANUP                               61380007
         BZ    INIT85             NO BRANCH                             61470007
         MVC   INIT90+D43(D3),UCBNAME MOVE NAME TO MSG                  61560007
         WTO   'IED154I TOTE CANNOT RETURN DEVICE          TO ORIGINAL *61650007
               STATUS',ROUTCDE=10,DESC=7                                61740007
         SPACE                                                          61830007
INIT23   EQU   *                  DEQ                                   61920007
         DEQ   ,MF=(E,DEQLIST)    DEQ ALL DEVICES                       62010007
         SPACE                                                          62100007
         SPACE                                                          62190007
INIT25   EQU   *                  BUMP TABLE                            62280007
         LA    R3,D4(R3)          ADDRESS POINTER                       62370007
         B     INIT10             AND CONTINUE THRU TABLE               62460007
         SPACE                                                          62550007
INIT30   EQU   *                  370X PROCESSING                       62640007
         TM    CTLFLG,CLEANUP     CLEANUP                               62730007
         BO    INIT45             YES BRANCH                   @G36XRUV 62770010
         MVI   TOTOVBCD,DEACT     VERB TO DEACTIVE 370X                 62910007
         B     INIT20             GO DEACT 370X                         63000007
         SPACE                                                          63090007
INIT35   EQU   *                  370X CLEANUP                          63180007
         MVI   TOTOVBCD,IPL       IPL 370X VERB                         63270007
         B     INIT20             GO IPL                                63360007
         SPACE                                                          63450007
         SPACE                                                          63540007
INIT40   EQU   *                  NOT 370X CLEANUP                      63630007
         TM    D0(R3),INITSTOP    TEST DEVICE INITIALLY STOPPED         63720007
         BO    INIT45             YES BRANCH                            63810007
         MVI   TOTOVBCD,START     VERB TO START LINE                    63900007
         B     INIT20             GO START LINE                         63990007
         SPACE                                                          64080007
         SPACE                                                          64170007
INIT45   EQU   *                  RETURN INITIALLY STOPPED              64260007
*                                 DEVICE BY CLEARING LCBCPA             64350007
         L     R6,TOTAVTPT        GET AVT ADDRESS                       64440007
         USING IEDQAVTD,R6        AVT                                   64530007
         L     R6,AVTTCB          GET TCAM TCB ADDRESS                  64620007
         DROP  R6                 AVT                                   64710007
         USING IEDQTCB,R6         TCB                                   64800007
         L     R6,TCBDEB          GET BED CHAIN ADDRESS                 64890007
         DROP  R6                 TCB                                   64980007
         SPACE                                                          65070007
INIT50   EQU   *                  DEB SEARCH                            65160007
         SR    R7,R7              CLEAR REG                             65250007
         USING DEBNMSUB,R6        DEB                                   65340007
         IC    R7,DEBNMEXT        INITIALIZE TO NUMBER OF               65430007
*                                 EXTENTS                               65520007
         LA    R8,DEBUCBAD        UCB CHAIN ADDRESS                     65610007
         L     R9,DEBDEBAD        GET NEXT DEB ADDRESS                  65700007
         L     R1,DEBDCBAD        GET DCB ADDRESS                       65790007
         USING IHADCB,R1          DCB                                   65880007
         TM    DCBDSORG+D1,X44    TCAM DEB                              65970007
         BZ    INIT60             NO GET NEXT DEB                       66060007
         LA    R15,D1             INIT RLN COUNTER                      66150007
         SPACE                                                          66240007
INIT55   EQU   *                  UCB COMPARE                           66330007
         DROP  R6                 DEB                                   66420007
         L     R6,D0(R8)          GET UCB ADDRESS                       66510007
         LA    R6,D0(R6)          CLEAR HI BYTE                         66600007
         CR    R6,R5              CORRECT UCB FOUND                     66690007
         BE    INIT65             YES BRANCH                            66780007
         LA    R8,D4(R8)          GET NEXT UCB ADDRESS                  66870007
         LA    R15,D1(R15)        BUMP RLN                              66960007
         BCT   R7,INIT55          LOOP TILL END OF UCB CHAIN            67050007
         SPACE                                                          67140007
INIT60   EQU   *                  GET NEXT DEB.                         67230007
         LR    R6,R9              IN CHAIN                              67320007
         B     INIT50             AND CONTINUE SEARCH                   67410007
         SPACE                                                          67500007
INIT65   EQU   *                  NOW FIND LCB                          67590007
         TM    CTLFLG,RLNSRCH     RLN SEARCH                            67680007
         BO    D0(R14)            YES RETURN                            67770007
         TM    0(R3),RNCHAN       Q-3705                       @ZM46824 67800010
         BO    INIT92             Y-GO TURN OFF TRMSTOTE       @ZM46824 67830010
         SR    R6,R6              CLEAR REG                             67860007
         IC    R6,DCBEXLST        GET LCB LENGTH                        67950007
         LR    R7,R15             GET RLN                               68040007
         MR    R6,R6              RLN TIMES LCB LENGTH                  68130007
         L     R6,DCBIOBAD        GET DUMMY UOB ADDRESS                 68220007
         LA    R6,D0(R6,R7)       GET IOB ADDRESS                       68310007
         LA    R7,LCBFLAG1-IEDQLCB GET OFFSET OT LCB START              68400007
         SR    R6,R7              SUBSTRACT FROM IOB ADDRESS            68490007
         USING IEDQLCB,R6         LCB                                   68580007
         DROP  R1                 DCB                                   68670007
         MVI   LCBCPA,X00         CLEAR TOTE INDICATOR                  68760007
         DROP  R6                 LCB                                   68850007
         B     INIT23             GO DEQ RESOURCE                       68940007
         SPACE                                                          69030007
INIT70   EQU   *                  AFTER IPL                             69120007
         TM    D0(R3),INITSTOP    370X INITIALLY DEACTIVE               69210007
         BO    INIT23             YES BRANCH GO DEQ                     69300007
         MVI   TOTOVBCD,ACTIV     VERB TP ACTIVATE                      69390007
         B     INIT20             GO ACTIVATE                           69480007
         SPACE                                                          69570007
INIT75   EQU   *                  ZERO RETURN FROM OPCONTROL            69660007
         TM    CTLFLG,CLEANUP     CLEANUP                               69750007
         BO    INIT23             YES GO DEQ                            69840007
         B     INIT25             NO GO CONTINUE THRU TABLE             69930007
         SPACE                                                          70020007
INIT80   EQU   *                  8 RETURN FROM OP CONRROL              70110007
         TM    CTLFLG,CLEANUP     CLEANUP                               70200007
         BO    INIT23             YES GO DEQ                            70290007
         OI    D0(R3),INITSTOP    INDICATE DEVICE INITIALLY             70380007
*                                 STOPPED                               70470007
         B     INIT25             GO CONTINUE THRU TABLE                70560007
         SPACE                                                          70650007
INIT85   EQU   *                  CANNOT STOP DEVICE                    70740007
*                                 CANCELL TRM                           70830007
         MVC   DEVSTOP(D3),UCBNAME NAME TO MESSAGE                      70920007
         IEDQMSG FUNCT=CEC,OTBUF=STOPFAIL,OTCNT=55,PREG0=R0,PREG1=R1    71010007
         XC    D4(D4,R3),D4(R3)   CLEAR FAILING ENTRY FROM TABLE        71100007
         OI    CTLFLG,CLEANUP     SET CLEAN UP FLAG                     71190007
         OI    CTLFLG,INITCLUP    SET ERROR FLAG                        71280007
         B     INIT05             GO CLEAN UP                           71370007
         SPACE                                                          71460007
INIT90   EQU   *                  EXIT                                  71550007
         TM    CTLFLG,INITCLUP    ERROR RETURN                          71640007
         BO    RETURN             YES - TERMINATE                       71730007
         LM    R3,R10,SAVE1       RESTORE REGS                          71820007
         B     D0(R11)            RETURN                                71910007
         SPACE 1                                               @G36XRUV 71912010
INIT92   DS    0H                 TURN OFF TRMSTOTE FOR NCP    @G36XRUV 71914010
         LA    R6,0(R1)           COPY DCB ADDRESS             @G36XRUV 71916010
         L     R9,TOTAVTPT        GET AVT ADDR                 @G36XRUV 71918010
         USING IEDQAVTD,R9                                     @G36XRUV 71920010
         L     R9,AVTRNMPT        GET TNT ADDR                 @G36XRUV 71922010
         DROP  R9                                              @G36XRUV 71924010
         USING IEDQTNTD,R9                                     @G36XRUV 71926010
         LA    R5,TNTFIRST        GET FIRST ENTRY IN TABLE     @G36XRUV 71928010
         SLR   R7,R7              CLEAR                        @G36XRUV 71930010
         IC    R7,TNTENLEN        LENGTH OF NAME FIELD         @G36XRUV 71932010
         DROP  R9                                              @G36XRUV 71934010
         USING IEDTNTA,R5         BASE FOR ADDR FIELD          @G36XRUV 71936010
TNTLOOP  DS    0H                                              @G36XRUV 71938010
         AR    R5,R7              BUMP PAST NAME FIELD         @G36XRUV 71940010
         ICM   R8,7,TNTTRMAD      GET TTE ADDR                 @G36XRUV 71942010
         LA    R9,TRMPRFSZ        PREFIX SIZE                  @G36XRUV 71944010
         SLR   R8,R9              POINT TO TTE PREFIX          @G36XRUV 71946010
         USING IEDNTRM,R8                                      @G36XRUV 71948010
         CLI   TRMTYPE,TRMLNCP    Q-IS THIS A LOCAL NCP ENTRY  @G36XRUV 71950010
         BNE   NXTTNT             N-GET NEXT TNT ENTRY         @G36XRUV 71952010
         L     R9,TRMDESTQ-1      GET QCB ADDR                 @G36XRUV 71954010
         USING IEDQQCB,R9                                      @G36XRUV 71956010
         CLM   R6,7,QCBDCBAD      Q-IS QCB FOR TEST DEVICE DCB @G36XRUV 71958010
         DROP  R9                                              @G36XRUV 71960010
         BE    DCBMATCH           Y-CORRECT TTE FOUND          @G36XRUV 71962010
NXTTNT   DS    0H                                              @G36XRUV 71964010
         LA    R5,L'TNTTRMAD(R5)  GET NEXT TNT ENTRY           @G36XRUV 71966010
         B     TNTLOOP                                         @G36XRUV 71968010
DCBMATCH DS    0H                                              @G36XRUV 71970010
         NI    TRMBYTE1,X'FF'-TRMSTOTE RESET TOTE BIT          @G36XRUV 71972010
         B     INIT35             GO IPL                       @G36XRUV 71974010
         DROP  R8                                              @G36XRUV 71976010
         DROP  R5                                              @G36XRUV 71978010
         EJECT                                                          72000007
***************************************************************         72090007
*                                                             *         72180007
*        ROUTINE TO TURN OFF THE ALLOCATED AND TURN ON THE    *         72270007
*        OFFLINE BITS IN THE UCB FOR EVERY ENTRY IN THE TEST  *         72360007
*        DEVICE TABLE.                                        *         72450007
*                                                             *         72540007
***************************************************************         72630007
CONDIT   DS    0H                 BOUNDARY ALLIGNMENT                   72720007
         USING UCB,R8                                                   72810007
         STM   R3,R10,SAVE1       SAVE CALLER'S REGS                    72900007
         LA    R3,TABLE           START OF TD TABLE                     72990007
         LA    R5,TABLEND         END OF TABLE                          73080007
DEALLOC  DS    0H                 BOUNDARY ALLIGNMENT                   73170007
         CR    R3,R5              END OF TABLE                          73260007
         BE    DEAL04             YES                                   73350007
         SLR   R8,R8              CLEAR                        @G36XRUV 73380010
         ICM   R8,3,D2(R3)        UCB ADDR FOR ENTRY           @G36XRUV 73410010
         BZ    DEAL04             YES                                   73620007
         MVC   UCBWORK(D4),D0(R8) MOVE UCB TO WORK AREA                 73710007
         TM    CTLFLG,CLEANUP     CLEANUP                               73800007
         BO    DEAL10             YES - RESET UCB'S                     73890007
         NI    UCBWORK+D3,NALLOC  TURN OFF ALLOCATION FLAG              73980007
         NI    UCBWORK+D3,OFFLIN  TURN ON OFFLINE FLAG                  74070007
         ST    R8,TOT102A         TARGET ADDRESS TO PLIST               74160007
         LA    R1,TOT102          POINT TO PLIST                        74250007
         AQCTL MOVE UCB BACK                                            74340007
         LA    R3,D4(R3)          POINT TO NEXT ENTRY                   74430007
         B     DEALLOC            CONTINUE THRU TABLE                   74520007
DEAL04   DS    0H                 BOUNDARY ALLIGNMENT                   74610007
         LM    R3,R10,SAVE1       RESTORE CALLER'S REGS                 74700007
         BR    R11                RETURN                                74790007
         SPACE                                                          74880007
DEAL10   DS    0H                 BOUNDARY ALLIGNMENT                   74970007
         TM    SRTESTAT,SRTEALOC  UCB ALLOCATED                         75060007
         BZ    DEAL18             NO - CONTINUE                         75150007
DEAL14   DS    0H                 BOUNDARY ALLIGNMENT                   75240007
         DEQ   (QNAMEE,RNAMEE,2,SYSTEM),RET=HAVE DEQ                    75330007
*                                 ALL UCB RESOURCES                     75420007
         B     POST04             ISSUE WTOR                            75510007
*                                                                       75600007
DEAL18   DS    0H                 BOUNDARY ALLIGNMENT                   75690007
         TM    UCBFL5,UCBNALOC    UCB ALLOCATED                         75780007
         BO    DEAL14             YES - - ISSUE DEQ                     75870007
*                                                                       75960007
         DROP  R8                                                       76050007
         OI    UCBWORK+D3,ONALLOC RESET UCB                             76140007
         ST    R8,TOT102A         TARGET ADDRESS TO PLIST               76230007
         LA    R1,TOT102          POINT TO PLIST                        76320007
         AQCTL                    MOVE UCB BACK                         76410007
         LA    R3,D4(R3)          POINT TO NEXT ENTRY                   76500007
         B     DEALLOC            CONTINUE THRU TABLE                   76590007
         EJECT                                                          76680007
***************************************************************         76770007
*                                                             *         76860007
*        ROUTINE TO WAIT UNTIL SUBCHANNEL(S) ARE RETURNED     *         76950007
*        TO TOTE. ALL SUBCHANNELS ARE THEN REALLOCATED TO TCAM*         77040007
*        AND RETURNED TO THEIR INITIAL STATUS.                *         77130007
*                                                             *         77220007
***************************************************************         77310007
POST     DS    0H                 BOUNDARY ALLIGNMENT                   77400007
POST04   DS    0H                 BOUNDARY ALLIGNMENT                   77490007
         XC    ECB(D4),ECB        CLEAR ECB                             77580007
         WTO   'IED275D REPLY ''TOTE'' TO RETURN TO TCAM SUBCHANNELS ',*77670007
               ROUTCDE=10,DESC=7                                        77760007
         MVC   POSTMSG4(D53),NCMMSG2 GET CUU'S                          77850007
WTORPOS8 WTOR  '                                                     ',*77940007
               INBUF,4,ECB,ROUTCDE=(8,10),DESC=2                        78030007
POSTMSG4 EQU   WTORPOS8+D16       PLACE FOR CUU'S                       78120007
         SPACE                                                          78210007
         WAIT  ECB=ECB            WAIT FOR REPLY                        78300007
         SPACE                                                          78390007
         OC    INBUF(D4),CAP      INSURE CAPITALIZATION                 78480007
         CLC   INBUF(D4),TOTE     REALLOCATION REQUEST                  78570007
         BNE   POST04             NO                                    78660007
*                                                                       78750007
*        RETURN SUBCHANNELS TO TCAM                                     78840007
*                                                                       78930007
         OI    CTLFLG,CLEANUP     SHOW CLEANUP                          79020007
         LA    R4,ENQLOOP         SET ENQ RETRY COUNT                   79110007
POST0C   DS    0H                 BOUNDARY ALLIGNMENT                   79200007
         ENQ   (QNAMEE,RNAMEE,E,2,SYSTEM),RET=HAVE ENQ                  79290007
*                                 ALL UCB RESOURCES                     79380007
         LTR   R15,R15            ENQ SUCCESSFUL                        79470007
         BZ    POST08             YES                                   79560007
*                                                                       79650007
         STIMER WAIT,DINTVL=TIME  WAIT 5 SECONDS                        79740007
*                                                                       79830007
         BCT   R4,POST0C          RETRY ENQ                             79920007
         B     POST04             ISSUE WTOR AGAIN                      80010007
POST08   DS    0H                 BOUNDARY ALLIGNMENT                   80100007
         BAL   R11,CONDIT         RESET UCB'S                           80190007
         BAL   R11,INITSTAT       RETURN LINES TO TCAM                  80280007
RETURN   DS    0H                 BOUNDARY ALLIGNMENT                   80370007
         DEQ   (QNAMEE,RNAMEE,2,SYSTEM),RET=HAVE DEQ                    80460007
*                                 ALL UCB RESOURCES                     80550007
RETURN1  DS    0H                 BOUNDARY ALLIGNMENT          @Y17XAUU 80570000
         OI    TOTFLG06,TOTTERMS  SET TERMINATE FLAG                    80640007
         SPACE                                                          80730007
         IEDQMSG MSGID=016,FUNCT=CEC,LINK=YES OLT ENDED                 80820007
         SPACE                                                          80910007
         L     R13,D4(R13)        CALLER'S SAVE ADDR                    81000007
         LM    R14,R12,D12(R13)   RESTORE CALLER'S REGS                 81090007
         SR    R15,R15            CLEAR RETURN CODE REG                 81180007
         BR    R14                RETURN TO MOTHER                      81270007
         EJECT                                                          81360007
STOPFAIL DC    CL47'IED221I TRM CANCELLED - STOP FAILED FOR DEVICE '    81450007
*        MSG IED221I IS SELF-EXPLANATORY                         Y06335 81540007
DEVSTOP  DC    CL8'        '      NAME FOR MESSAGE                      81630007
QNAME    DC    CL8'SYSZTOTE'       MAJOR ELEMENT                 Y06335 81720007
RNAME    DC    8CL1' '            MINOR ELEMENT                         81810007
DEQLIST  DEQ   (QNAME,RNAME,8,STEP),RET=HAVE,MF=L                       81900007
ENQLIST  ENQ   (QNAME,RNAME,E,8,STEP),RET=USE,MF=L                      81990007
CTLFLG   DC    XL1'0'             CONTROL FLAG                          82080007
RNCHAN   EQU   X'80'              3705 MODE                             82170007
INITSTOP EQU   X'40'              LINE ALREADY STOPPED OR DEACT         82260007
CLEANUP  EQU   X'20'              CLEAN UP ENTRY                        82350007
RLNSRCH  EQU   X'10'              RLN SEARCH FLAG                       82440007
INITCLUP EQU   X'01'              ERROR OCCURRED ON STOP                82530007
*                                                                       82620007
*                                                                       82710007
INBUF    DC    XL4'0'             INPUT BUFFER                          82800007
TOTE     DC    CL4'TOTE'          CHAR CONSTANT                         82890007
CAP      DC    X'40404040'        BLANK CHARS                           82980007
ENDTABLE DC    X'FFFF'            END OF UCB TABLE             @G36XRUV 83020010
*                                                                       83070007
*                                                                       83160007
*                                                                       83250007
*        PARAMETER LIST FOR SVC 102                   *                 83340007
         DS    0F                 F-WORD ALLIGNMENT                     83430007
SLPL     DC    X'0C'              START                                 83520007
         DC    AL3(0)             ADDRESS OF FIRST                      83610007
         DC    X'80'              FLAG END                              83700007
         DC    AL3(0)             ADDRESS OF LAST                       83790007
*        SVC 102 MOVE DATA PARAMETER LIST                               83880007
         DS    0F                 BOUNDARY ALLIGNMENT                   83970007
TOT102   DC    X'08'              FLAG FOR DATA MOVE                    84060007
         DC    AL3(UCBWORK)       DATA ADDRESS                          84150007
TOT102A  DC    X'00'              RESERVED                              84240007
         DC    AL3(0)             TARGET ADDR                           84330007
         DC    X'80'              LAST WORD FLAG                        84420007
         DC    AL3(LENGADDR)      LENGTH                                84510007
UCBWORK  DC    AL4(0)             WORK AREA                             84600007
LENGADDR DC    H'04'              LENGTH OF DATA TO MOVE                84690007
PACK1    DC    D'0'               PACK WORK AREA                        84780007
BIN1     DC    F'0'               LOWER BOUND INCLUS CUU                84870007
BIN3     DC    F'0'               UPPER BOUND INCLUS CUU                84960007
TABLE    DC    256F'0'            TEST DEVICE TABLE                     85050007
TABLEND  DS    0C                 END OF TABLE                          85140007
UCBSAVE  DS    A                  UCB SAVE AREA                         85230007
KUCB     DS    H                  TEST UCB ADDR SAVE AREA               85320007
         DS    0D                 BOUNDARY ALLINGMENT                   85410007
TDFLG    DC    X'00'              PROGRAM FLAG BYTE                     85500007
WORK1    DS    3F                 WORK AREA                             85590007
WORK2    DS    2D                 WORK AREA                             85680007
         SPACE                                                          85770007
         DS    0F                 BOUNDARY ALLIGNMENT                   85860007
ECB      DS    2F                 ECB                                   85950007
         SPACE                                                          86040007
F4       DC    F'4'               VALUE OF 4                            86130007
MULT     DC    8XL1'0'            WORK AREA                             86220007
TTEADDR  DC    F'0'               WORK AREA TO ALLIGN TTE ADDR          86310007
PATCH    DC    CL50' '            IEDQWF1 PATCH AREA                    86400007
SAVE1    DC    8F'0'              SUBRTN SAVE AREA                      86490007
SAVE2    DC    6F'0'              REGS. SAVE AREA                       86580007
ANSWER   DS    CL3                INPUT BUFFER                          86670007
TIMOUT   DC    X'F0F0F0F3F0F0F0F0' TIMER FOR TIMEOUT                    86760007
TIME     DC    X'F0F0F0F0F0F5F0F0' TIMER FOR ENQ                        86850007
QNAMEE   DC    C'SYSIEFSD'        MAJOR NAME                            86940007
RNAMEE   DC    C'Q4'              MINOR NAME                            87030007
         DS    0F                                                       87120007
WORK4    DS    XL5                WORK AREA                             87210007
XLATE    DC    X'000A0B0C0D0E0F'  XLATE TABLE                           87300007
*        MSG IED335I IS SELF-EXPLANATORY                         Y06335 87390007
TMID     DC    C'IED335I                   ***CONTROL TERMINAL ID IS' * 87480007
         DC    X'40'              BLANK CHAR                            87570007
TRMCTID  DC    CL5'XX***'         MESSAGE TO PRINT CT ID                87660007
TMIDE    DS    0C                 END OF MESSAGE                        87750007
         EJECT                                                          87840007
         TLGBD                                                          87930007
         EJECT                                                          88020007
TIOT     DSECT                                                          88110007
         IEFTIOT1                                                       88200007
         EJECT                                                          88290007
         TQCBD                                                          88380007
         EJECT                                                          88470007
         TTCBD                                                          88560007
         EJECT                                                          88650007
         DCBD  DSORG=TX                                                 88740007
         EJECT                                                          88830007
         TPRFD                                                          88920007
         EJECT                                                          89010007
         TLCBD                                                          89100007
         EJECT                                                          89190007
CVT      DSECT                                                          89280007
         CVT   LIST =YES                                                89370007
         EJECT                                                          89460007
UCB      DSECT                                                          89550007
         IEFUCBOB LIST=YES                                              89640007
         EJECT                                                          89730007
         TAVTD                                                          89820007
         EJECT                                                          89910007
         TDEBD                                                          90000007
         EJECT                                                          90090007
         TTNTD                                                          90180007
         EJECT                                                          90270007
         TTRMD                                                          90360007
         EJECT                                                          90450007
         RESPL                                                          90540007
         EJECT                                                          90630007
         OLTCB                                                          90720007
         SPACE 2                                                        90810007
         END                                                            90900007
