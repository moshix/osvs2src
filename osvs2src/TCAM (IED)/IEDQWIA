         TITLE 'IEDQWIA - CONFIGURATOR ADD   SCHEDULER'                 00200020
IEDQWIA  CSECT                                                          00220000
*CHANGE ACTIVITY AS FOLLOWS:                                            00230000
*A168000,224000,414000,438000,548000,574000,592000               A41585 00240000
*C238000,244000,744000                                           A41585 00260000
*D486000-512000,518000                                           A41585 00280000
*A002300,003230-003290,003320-003380,003410-003470,003500-003590 S22024 00282000
*A003620,004250,007430-007490,007520-007550,046300,225200-225900 S22024 00284000
*A247000,289700-290140,297600-298440,412100,418400,437300-437800 S22024 00286000
*A456400-457100,623200,641350-641550,647450-647650               S22024 00288000
*C003200,004000,005700,240000,278100,285400-285800,324900        S22024 00290000
*C327600,348480,349480,354480,412000,437200,461200,462800,546000 S22024 00292000
*C623000,630150,630250,630400,630850,630950,631200,631300,641250 S22024 00294000
*D002860-002920,012500,438800,567000,651000-653000               S22024 00296000
*C465200                                                         S05331 00297000
*A545300-545600,550090-550900,647550                             S05331 00298000
*C648660,648570                                                  Y06330 00298154
*A297980-298000,298210,402200-402600                            SA64779 00298254
*C298000                                                        SA64779 00298354
*A225900,326700,327600,347480,348480                           @YA12402 00298458
*C650500                                                       @OY20528 00298586
**************************************************************** S99528 00300022
*                                                              * S99528 00310022
* TITLE:                                                       * S22024 00320000
*                                                              * S22024 00323000
*    'IEDQWIA - TOTE CONFIGURATOR ADD SCHEDULER'               * S22024 00326000
*                                                              * S22024 00329000
* MODULE NAME:                                                 * S22024 00332000
*                                                              * S22024 00335000
*    IEDQWIA                                                   * S22024 00338000
*                                                              * S22024 00341000
* DESCRIPTIVE NAME:                                            * S22024 00344000
*                                                              * S22024 00347000
*    TOTE CONFIGURATOR ADD SCHEDULER                           * S22024 00350000
*                                                              * S22024 00353000
* COPYRIGHT:                                                   * S22024 00356000
*                                                              * S22024 00359000
*    'NONE'                                                    * S22024 00362000
*                                                              * S99528 00370022
* STATUS:                                                      * S99528 00380022
*                                                              * S99528 00390022
*    CHANGE LEVEL 5                                            * S05331 00400000
*                                                              * S99528 00410022
* FUNCTION:                                                    * S99528 00420022
*                                                              * S22024 00425000
*    THIS MODULE HANDLES THE ADDITION OF CONFIGURATION DATA TO * S99528 00430022
*    THE LOCAL AND REMOTE CONFIGURATION DATA SETS.             * S99528 00440022
*                                                              * S99528 00450022
*    FOR ADD REQUESTS, THE MODULE PROMPTS FOR THE LINE ADDRESS * S99528 00460022
*    OR SYMBOLIC TERMINAL NAME.  FOR A LINE ADDRESS, IEDQWI5U  * S99528 00470022
*    IS LOADED TO DETERMINE IF THERE IS A VALID UCB.  VALID    * S99528 00480022
*    UCB'S ARE CHECKED FOR A DEVICE CLASS OF 10 OR 40. IEDQWIA * S99528 00490022
*    THEN CHECKS TO DETERMINE IF THE LINE HAS ALREADY BEEN     * S99528 00500022
*    CONFIGURED.  IF NOT, IEDQWI7 IS LOADED TO DETERMINE THE   * S99528 00510022
*    ADAPTER TYPE AND ITS FEATURES.  THIS INFORMATION IS PASSED* S99528 00520022
*    TO A UNIT CONFIGURATOR, WHICH PROMPTS FOR ADDITIONAL DATA * S99528 00530022
*    NEEDED AND BUILDS A CDS ENTRY IN THE OLTCB.  IEDQWIA THEN * S99528 00540022
*    WRITES THE CDS ENTRY IN LOCAL PDS AND UPDATES THE PDS     * S99528 00550022
*    DIRECTORY.  THIS MODULE THEN PROMPTS TO DETERMINE IF THERE* S99528 00560022
*    ARE MORE ADDITIONS.  IF NOT, CONTROL IS TRANSFERRED       * S22024 00570000
*    TO THE TOTE CONFIGURATOR SCHEDULER (IEDQWI).              * S99528 00580022
*                                                              * S99528 00590022
*    FOR TERMINAL ADDITIONS, IEDQWI8 IS LOADED TO DETERMINE IF * S99528 00600022
*    THE SYMBOLIC NAME IS A VALID TCAM TERMINAL. IF THE NAME   * S99528 00610022
*    IS VALID, THE REMOTE DATA SET IS CHECKED TO SEE IF THE    * S99528 00620022
*    TERMINAL HAS ALREADY BEEN CONFIGURED.  IF NOT, IEDQWI9 IS * S99528 00630022
*    LOADED TO DETERMINE THE TERMINAL AND LINE FEATURES. THIS  * S99528 00640022
*    INFORMATION IS THEN PASSED TO A UNIT CONFIGURATOR, WHICH  * S99528 00650022
*    PROMPTS FOR ADDITIONAL DATA NEEDED AND BUILDS A CDS ENTRY * S99528 00660022
*    IN THE OLTCB.  IEDQWIA THEN WRITES THE CDS ENTRY IN THE   * S99528 00670022
*    REMOTE PDS AND UPDATES THE DIRECTORY.                     * S99528 00680022
*                                                              * S99528 00690022
*    FOR CHANGE REQUESTS, THIS MODULE RECEIVES CONTROL FOR THE * S99528 00700022
*    DELETE SCHEDULER (IEDQWID).  IT THEN FOLLOWS THE PROCEDURE* S99528 00710022
*    DESCRIBED ABOVE FOR VALID LINE ADDRESSES AND TERMINALS.   * S99528 00720022
*    WHEN THERE ARE NO MORE CHANGES, CONTROL IS TRASFERRED TO  * S99528 00730022
*    IEDQWI.  OTHERWISE CONTROL IS TRANSFERRED TO IEDQWID.     * S99528 00740022
*                                                              * S22024 00743000
*    IF AN ADD OR CHANGE FUNCTION IS REQUESTED FOR A CDS       * S22024 00746000
*    EXTENSION, THE SYMBOLICALLY NAMED CDS IS PLACED IN THE    * S22024 00749000
*    LOCAL CDS LIBRARY.                                        * S22024 00752000
*                                                              * S22024 00755000
* ENTRY POINTS:                                                * S99528 00760022
*                                                              * S99528 00770022
*         IEDQWIA - RECEIVES CONTROL FROM IEDQWI VIA A 'XCTL'  * S99528 00780022
*                   WHEN AN 'ADD' FUNCTION IS REQUESTED;       * S99528 00790022
*                                                              * S99528 00800022
*                 - RECEIVES CONTROL FROM IEDQWID VIA A 'XCTL' * S99528 00810022
*                   WHEN A 'CHANGE' FUNCTION IS REQUESTED.     * S99528 00820022
*                                                              * S99528 00830022
* INPUT:                                                       * S99528 00840022
*                                                              * S99528 00850022
*    THE FOLLOWING REGISTERS ARE USED AS INPUT:                * S99528 00860022
*                                                              * S99528 00870022
*    02 - OLTCB POINTER;                                       * S99528 00880022
*    13 - SAVE AREA ADDRESS;                                   * S99528 00890022
*    15 - ENTRY POINT ADDRESS/RETURN CODE.                     * S99528 00900022
*                                                              * S99528 00910022
*    THE FOLLOWING OLTCB FIELD ARE USED AS INPUT:              * S99528 00920022
*                                                              * S99528 00930022
*    CDSWORK - 256 BYTE AREA TO CREATE CNFG RECORDS FOR ADD;   * S99528 00940022
*            - 256 BYTE AREA CONTAINING CDS RECORD FOR CHANGE; * S99528 00950022
*    CDSINPUT-  80 BYTE AREA TO PASS INFO BETWEEN MODULES;     * S99528 00960022
*    CDSBLDL -  40 BYTE AREA USED AS BLDL LIST FOR PDS;        * S99528 00970022
*    CDSCESD -  56 BYTE AREA CONTAINING CDS CESD RECORD;       * S99528 00980022
*    CDSCNTL -  20 BYTE AREA CONTAINING CDS CNTL RECORD;       * S99528 00990022
*    CDSFNFLG- FUNCTION FLAG: X'02' ADD;                       * S99528 01000022
*                             X'16' CHANGE TERMINAL;           * S99528 01010022
*                             X'26' CHANGE LINE;               * S99528 01020022
*    CDSRETFL- RETURN CODE: X'00' VALID                        * S99528 01030022
*                           X'01' INVALID                      * S99528 01040022
*    TOTINBUF- 80 BYTE AREA FOR INPUT MESSAGES;                * S99528 01050022
*    TOTOTBUF- 80 BYTE AREA FOR OUTPUT MESSAGES;               * S99528 01060022
*    TOTSAVES- SAVE AREA FOR USE BY THIS MODULE.               * S99528 01070022
*                                                              * S99528 01080022
* OUTPUT:                                                      * S99528 01090022
*                                                              * S99528 01100022
*    THE FOLLOWING REGISTERS ARE USED FOR OUTPUT:              * S99528 01110022
*                                                              * S99528 01120022
*    02 - OLTCB POINTER;                                       * S99528 01130022
*    05 - UCB ADDRESS;                                         * S99528 01140022
*    13 - SAVE AREA ADDRESS;                                   * S99528 01150022
*    15 - ENTRY POINT ADDRESS.                                 * S99528 01160022
*                                                              * S99528 01170022
*    THE FOLLOWING OLTCB FIELDS ARE USED FOR OUTPUT:           * S99528 01180022
*                                                              * S99528 01190022
*    CDSWORK - 256 BYTE AREA TO CREATE CDS RECORD FOR ADD;     * S99528 01200022
*            - 256 BYTE AREA CONTAINING CDS RECORD FOR CHANGE; * S99528 01210022
*    CDSINPUT-  80 BYTE AREA CONTAINING LINE/TERMINAL DATA;    * S99528 01220022
*    CDSRETFL- RETURN CODE: X'00' VALID                        * S99528 01230022
*                           X'01' INVALID                      * S99528 01240022
* EXTERNAL ROUTINES:                                           * S99528 01260022
*                                                              * S99528 01270022
*         IEDQWID - CHANGE/DELETE SCHEDULER                    * S99528 01280022
*         IEDQWI5U- TCU/ADAPTER TYPE MODULE                    * S99528 01290022
*         IEDQWI7 - LINE TYPE MODULE                           * S99528 01300022
*         IEDQWI8 - TERMINAL VERIFICATION MODULE               * S99528 01310022
*         IEDQWI9 - TERMINAL FEATURES MODULE                   * S99528 01320022
*         IEDQWK  - MESSAGE MODULE                             * S99528 01330022
*                                                              * S99528 01340022
* EXITS, NORMAL:                                               * S99528 01350022
*         IEDQWI1 - XCTL AFTER 'EXIT' WHEN ADD/CHANGE COMPLETE * S99528 01360022
*         IEDQWID - XCTL AFTER 'CHAGMORE' FOR MORE CHANGES     * S99528 01370022
*         IEDQWI5U- BALR AFTER 'ADAPTYPE' FOR LINE ADD         * S99528 01380022
*         IEDQWI7 - BALR AFTER 'LINETYPE' FOR LINE ADD/CHNG    * S99528 01390022
*         IEDQWI8 - BALR AFTER 'VALIDTER' FOR TERMINAL ADD     * S99528 01400022
*         IEDQWI9 - BALR AFTER 'TERMTYPE' FOR TERMINAL ADD/CHNG* S99528 01410022
*         UNIT CONFG - BALR AFTER 'GETMOD42' FOR TERMINAL      * S99528 01420022
*                    - BALR AFTER 'GETMOD40' FOR LINES         * S99528 01430022
*                                                              * S99528 01440022
* EXITS, ERROR                                                 * S99528 01450022
*                                                              * S99528 01460022
*         IEDQWI1 - XCTL AFTER 'EXIT' FOR CONFG TERMINATION    * S99528 01470022
*         ERROR RECOVERY - RETURN AFTER 'BADCDS' FOR SYNDAD RET* S99528 01480022
*                                                              *        01490022
* TABLES/WORK AREAS:                                           *        01500022
*                                                              *        01510022
*    CDSWORK - WORK AREA USED TO PASS INFO BETWEEN MODULES AND *        01520022
*              CREATE CDS RECORDS.                             *        01530022
*                                                              *        01540022
* CHARACTER CODE DEPENDENCY:                                   *        01550022
*                                                              *        01560022
*    NONE.                                                     *        01570022
*                                                              *        01580022
* ATTRIBUTES:                                                  * S99528 01582022
*                                                              * S99528 01584022
*    ENABLED, PROBLEM PROGRAM MODE, TRANSIENT                  * S99528 01586022
*                                                              * S99528 01588022
* NOTES:                                                       *        01590022
*                                                              *        01600022
*    NONE                                                      *        01610022
*                                                              *        01620022
**************************************************************** S99528 01630022
         EJECT                                                          04630000
**************************************************************** S99528 11900022
*                                                              * S99528 12000022
*         R E G I S T E R   E Q U A T E S                      * S99528 12100022
*                                                              * S99528 12200022
**************************************************************** S99528 12300022
         SPACE                                                          12400022
PARMREG0 EQU   0                       PARAMETER REGISTER        S99528 12500022
PARMREG1 EQU   1                       PARAMETER REGISTER        S99528 12600022
R1       EQU   1                       WORK REGISTER           @ZM47904 12650000
R2       EQU   2                       OLTCB POINTER             S99528 12700022
CDSINREG EQU   4                       CDS WORK AREA POINTER     S99528 12800022
UCBREG   EQU   5                       UCB POINTER               S99528 12900022
WORKREG5 EQU   5                       WORK REGISTER             S99528 13000022
WORKREG6 EQU   6                       WORK REGISTER             S99528 13100022
BASREG   EQU   8                       IEDQWIA BASE REGISTER     S99528 13200022
RETURN   EQU   9                       RETURN ADDRESS            S99528 13300022
SAVEAREA EQU   13                      SAVE AREA POINTER         S99528 13400022
R14      EQU   14                      RETURN ADDRESS            S99528 13500022
RTRM     EQU   14                      TTE BASE                @ZM47904 13550000
RETADDR  EQU   14                      REG 14                    S99528 13600022
SAVEADDR EQU   15                      SAVE AREA POINTER         S99528 13700022
RETCODE  EQU   15                      RETURN CODE               S99528 13800022
ENTRYPT  EQU   15                      ENTRY PT ADDRESS          S99528 13900022
         EJECT                                                          14000022
**************************************************************** S99528 14100022
*                                                              * S99528 14200022
*                 O F F S E T   E Q U A T E S                  * S99528 14300022
*                                                              * S99528 14400022
**************************************************************** S99528 14500022
         SPACE                                                          14600022
CURUCB   EQU   0                       OFFSET TO CURRENT UCB     S99528 14700022
NEXTLOC  EQU   1                       OFFSET TO NEXT BYTE       S99528 14800022
NXTUCB   EQU   2                       OFFSET TO NEXT UCB        S99528 14900022
LEN      EQU   2                       LENGTH OF UNIT ADDR FLD   S99528 15000022
CUUADR   EQU   2                       OFFSET TO UNIT ADDRESS    S99528 15100022
UNITLEN  EQU   3                       LENGTH OF UNIT ADDR       S99528 15200022
LISTLEN  EQU   4                       LEN OF MEMBER NAME        S99528 15300022
CUUPTR   EQU   4                       PTR TO UNIT ADDR IN UCB   S99528 15400022
PREVSAVE EQU   4                       OFFSET TO PREV SAVE       S99528 15500022
FRSTINST EQU   12                      OFFSET TO FIRST EXEC INST S99528 15600022
UCBLNADR EQU   13                      OFFSET TO LINE ADR IN UCB S99528 15700022
UCBDEVCL EQU   18                      OFFSET TO DEVICE CLASS    S99528 15800022
UCBADTYP EQU   19                      OFFSET TO ADAPTER TYPE    S99528 15900022
OPENFLAG EQU   48                      OFFSET TO DCB OPEN FLAGS  S99528 16000022
INPUTLEN EQU   78                      LEN OF CONFIG DATA (CDS)  S99528 16100022
CVT      EQU   16                      PTR TO CVT                S99528 16200022
UCBPTR   EQU   X'28'                   OFFSET TO UCB             S99528 16300022
OWN      EQU   4                       OFFSET TO NEXT SAVE       S99528 16400022
UAPTR    EQU   5                       PTR TO UNIT ADDR IN OLTCB S99528 16500022
CDS40DCB EQU   7                       LOCAL DATA SET DCB PTR    S99528 16600022
CDS42DCB EQU   7                       REMOTE DATA SET DCB PTR   S99528 16700022
CALLERS  EQU   8                       OFFSET TO PREV SAVE       S99528 16800022
NAMELEN  EQU   8                       LENGTH OF TERMINAL NAME   S99528 16900022
HIGHORDR EQU   8                       SHIFT CNT FOR HIGH ORDER  S99528 17000022
MODSIZE  EQU   10                      MODULE SIZE               S99528 17100022
AVAILABL EQU   12                      CORE AVAILABLE FOR MODULE S99528 17200022
CDSLEN   EQU   255                     LEN OF CDS MEMBER         S99528 17300022
RNCLASS  EQU   X'44'                   3705 RESOURCE CLASS     @ZM47904 17350000
**************************************************************** S99528 17400022
*                                                              * S99528 17500022
*            E Q U A T E S   F O R   C O M P A R S I O N S     * S99528 17600022
*                                                              * S99528 17700022
**************************************************************** S99528 17800022
         SPACE                                                          17900022
GOODOPEN EQU   X'10'                   TEST FOR GOODOPEN         S99528 18000022
CHANGE   EQU   X'06'                   TEST FOR CHANGE FUNCTN    S99528 18100022
CHANLINE EQU   X'26'                   TEST FOR CHANGE LINE      S99528 18200022
GRAPHCLS EQU   X'10'                   GRAPHICS DEVICE           S99528 18300022
TCUCLASS EQU   X'40'                   TRANSMISSION CONTROL      S99528 18400022
TERMCLAS EQU   X'42'                   TERMINALS                 S99528 18500022
NO       EQU   X'D5'                   NO RESPONSE               S99528 18600022
YES      EQU   X'E8'                   YES RESPONSE              S99528 18700022
NUMENTRY EQU   X'F0'                   NUMERIC ENTRY (LINE)      S99528 18800022
ZERO     EQU   X'00'                   VALID RETURN CODE         S99528 18900022
EXITFLG  EQU   X'01'                   INVALID RETURN            S99528 19000022
         SPACE                                                          19100022
BYTE3    EQU   3                       3 BYTE MOVE COUNT         S99528 19200022
LEFTCLR  EQU   X'0F'                   MASK TO CLEAR LEFT BITS   S99528 19300022
DATALEN  EQU   X'2D'                   PDS DIR USER DATA LEN     S99528 19400022
USERTTRC EQU   X'2D'                   USER TTRC                 S99528 20400022
CDSDPMSK EQU   X'40'                   DEVICE PROTECT BIT        S99528 21100022
CDSSTDBS EQU   X'80'                   RFT CONFIG FLAG           S99528 21800022
LASTTERM EQU   X'01'              LAST TERMINAL ON LINE FLAG     A41585 22500000
L8       EQU   8                       LENGTH CONSTANT           S22024 22520000
CONCSELF EQU   X'E0'                   CONCENTRATOR ENTRY NAMED  S22024 22540000
SPECIAL  EQU   X'F0'                   SPECIAL CONFIG RUN  -     S22024 22560000
*                                        ADD/CHANGE TO LOCAL CDS S22024 22580000
XFF      EQU   X'FF'               HEXADECIMAL CONSTANT          S22024 22590000
BLANK    EQU   X'40'                    BLANK CHARACTER        @YA12402 22592058
D1       EQU   1                        CONSTANT 1             @YA12402 22594058
D3       EQU   3                        CONSTANT 3             @YA12402 22596058
D4       EQU   4                        CONSTANT 4             @YA12402 22598058
         EJECT                                                          22600020
**************************************************************** S99528 22800022
*                                                              * S99528 23000022
*            I N I T I A L I Z A T I O N                       * S99528 23200022
*                                                              * S99528 23400022
**************************************************************** S99528 23600022
         SPACE                                                          23800022
         SAVE  (14,12)                 SAVE CALLER'S REGISTERS   S22024 24000000
         LR    BASREG,ENTRYPT          SET UP BASE REG           S99528 24200022
         USING IEDQWIA,BASREG                                    S99528 24400022
         USING TOTOLTCB,R2                                       S99528 24600022
IEDQWIA  IEDHJN IEDQWIAA,HJN           SET DATE AND MODULE NAME  S22024 24700000
         LA    SAVEADDR,TOTSAVE5       ADDR OF NEXT SAVE         S99528 24800022
         ST    SAVEADDR,CALLERS(SAVEAREA)   STORE IN PREV SAVE   S99528 25000022
         ST    SAVEAREA,OWN(SAVEADDR)  STORE PREV IN NEXT SAVE   S99528 25200022
         LR    SAVEAREA,SAVEADDR       STORE SAVE AREA ADDR      S99528 25400022
         TM    CDSFNFLG,CHANGE         CHANGE FUNCTION SPECIFIED S99528 25600022
         BO    PROCHANG                BRANCH TO CHANGE PROCEDUR S99528 26200022
         EJECT                                                          26800022
**************************************************************** S99528 26900022
*                                                              * S99528 26970022
*            A D D   S C H E D U L E R   L O G I C             * S99528 27040022
*                                                              * S99528 27110022
**************************************************************** S99528 27180022
         SPACE                                                          27250022
PROCADD  EQU   *                       CLEAR CDS AREA            S99528 27320022
         MVI   CDSREC,ZERO             ZERO OUT FIRST LOCATION   S99528 27390022
         MVC   CDSREC+NEXTLOC(CDSLEN),CDSREC ZERO OUT REST       S99528 27460022
         MVC   CDSINPUT(INPUTLEN),CDSREC     ZERO OUT WORK AREA  S99528 27530022
*                            ENTER A LINE ADDR.OR TERMINAL NAME  S99528 27600022
         IEDQMSG MSGID=103,FUNCT=REP,INBUF=CEMSG,INCNT=8,        S99528X27670022
               LINK=YES                                          S99528 27740022
         TM    TOTINBUF,NUMENTRY       IS ENTRY A LINE ADDRESS?  S22024 27810000
         BO    ADDLINE                 YES  GO ADD LINE PROCED   S99528 27880022
*                                      NO   CHECK FOR VALID TERM S99528 27950022
         EJECT                                                          28110022
**************************************************************** S99528 28120022
*                                                              * S99528 28180022
*        T E R M I N A L   V A L I D I T Y   C H E C K         * S99528 28240022
*                                                              * S99528 28300022
**************************************************************** S99528 28360022
         SPACE                                                          28420022
VALIDTER EQU   *                       CHECK TCAM TABL FOR NAME  S99528 28480022
         MVC   CDSSYMBL(NAMELEN),TOTINBUF  MOVE NAME TO WORKAREA S22024 28540000
         MVC   CDSCESNM(NAMELEN),TOTINBUF  MOVE ESDID TO CESD    S22024 28580000
*                                           RECORD               S22024 28620000
         LOAD  EP=IEDQWI8              LOAD VERIFICATION MODULE  S99528 28660022
         LR    ENTRYPT,PARMREG0        GET ENTRYPT ADDR          S99528 28720022
         BALR  RETURN,ENTRYPT          GO SEARCH TCAM TABLE      S99528 28780022
         DELETE EP=IEDQWI8             DELETE MODULE             S99528 28840022
         CLI   CDSRETFL,ZERO           WAS SYMBOLIC NAME VALID   S99528 28900022
         BE    GOODNAME                YES  GO CHECK IN CDS PDS  S99528 28960022
         CLI   CDSRETFL,SPECIAL    IS THIS A SPECIAL SYMBOLIC TO S22024 28970000
*                                  LOCAL CDS ADD/CHANGE          S22024 28980000
         BE    GOODNAM1            YES                           S22024 28990000
         CLI   CDSRETFL,CONCSELF       WAS CONCENTRATOR CONFIG   S22024 28996000
*                                        REQUESTED?              S22024 29002000
         BE    CHKFNFLG                YES, INVALID REQUEST - NO S22024 29008000
*                                        CONFIG ALLOWED          S22024 29014000
BADNAME  EQU   *                       INVALID TERMINAL NAME     S99528 29020022
         SPACE                                                          29080022
         IEDQMSG MSGID=132,FUNCT=CEC,RET=CHKFNFLG                S99528 29140022
         EJECT                                                          29300022
**************************************************************** S99528 29400022
*                                                              * S99528 29490022
*   C H E C K   F O R   T E R M I N A L   N A M E   I N   P D S* S99528 29580022
*                                                              * S99528 29670022
**************************************************************** S99528 29760022
GOODNAM1 DS    0H                  ALIGN FOR INSTRUCTION         S22024 29766000
         OPEN  (CDS40,(INPUT))     OPEN LOCAL CDS DATA SET       S22024 29772000
         LA    CDS40DCB,CDS40      GET DCB ADDR                  S22024 29778000
         TM    OPENFLAG(CDS40DCB),GOODOPEN TEST FOR GOOD OPEN    S22024 29784000
         BZ    OPENERR             ERROR ON OPEN BRANCH          S22024 29790000
*                                                                S22024 29796000
         TM    CDSFNFLG,CHANGE         CHANGE FUNCTION SPECIFIED Y06330 29798005
         BO    SPEXT              YES, BRANCH                   SA64779 29800054
         FIND  CDS40,CDSSYMBL,D    SEARCH PDS FOR NAME           S22024 29802000
         LTR   RETCODE,RETCODE     IS NAME IN PDS ALREADY        S22024 29808000
         BZ    DUPCDS              YES  DO NOT ADD               S22024 29814000
*                                  CONTINUE TO ADD               S22024 29820000
SPEXT    EQU   *                                                SA64779 29821054
         CLI   CDSCFLGS,SPECIAL   IS THIS A NCP CDS RUN?         S22024 29822000
         BE    GOODNAM3           YES, BRANCH                    S22024 29824000
         MVC   MODNAME(L8),RNCONFIG MOVE IN SPECIAL UNIT CONFIG  S22024 29826000
GOODNAM2 EQU   *                                                 S22024 29829000
         CLOSE CDS40               CLOSE DATA SET JUST OPENED    S22024 29832000
*                                   NAME FOR BLDL                S22024 29838000
         B     BLDL40              SEE IF U.C. MODULE EXISTS     S22024 29844000
GOODNAM3 EQU   *                                                 S22024 29844700
         MVC   MODNAME(L8),NCPCONFG  MOVE NCP CDS MODULE NAME    S22024 29845400
*                                      INTO BLDL LIST            S22024 29846100
         MVC   CDSTERM(L'NCPCDSNM),NCPCDSNM LET UNIT CONFIG KNOW S22024 29846800
*                                           THIS IS AN NCPCDS RUNS22024 29847500
         MVI   CDSCFLGS,ZERO      CLEAR CDS FLAGS                S22024 29848200
         B     GOODNAM2           BRANCH                         S22024 29848900
         SPACE                                                          29850022
GOODNAME EQU   *                       IS DEVICE ALREADY CNFGED  S99528 29940022
         OPEN  (CDS42,(INPUT))         OPEN REMOTE DATA SET      S99528 30030022
         LA    CDS42DCB,CDS42          GET DCB ADDR              S99528 30120022
         TM    OPENFLAG(CDS42DCB),GOODOPEN  TEST FOR GOOD OPEN   S99528 30210022
         BZ    OPENERR                 BRANCH IF OPEN ERROR      S99528 30300022
         SPACE                                                          30390022
         FIND  CDS42,CDSSYMBL,D        SEARCH PDS FOR NAME       S99528 30480022
         LTR   RETCODE,RETCODE         IS NAME ALREADY IN PDS    S99528 30570022
         BZ    DUPCDS                  YES  DO NOT ADD           S99528 30660022
         CLOSE CDS42                   CLOSE REMOTE DATA SET     S99528 30750022
         B     TERMPREP                BRANCH TERMINAL PREPROCES S99528 30840022
         SPACE                                                          30930022
DUPCDS   BXH   RETCODE,WORKREG5,TERMPREP BR ON HI TO TERMINAL    S99528 31020022
*                                          PREPROCESSOR          S99528 31060022
*                                      ALREADY CONFIG, REQ CHANG S99528 31110022
         IEDQMSG MSGID=146,FUNCT=CEC,RET=CHKFNFLG                S99528 31200022
         EJECT                                                          31400022
**************************************************************** S99528 31500022
*                                                              * S99528 31590022
*          L I N E   V A L I D I T Y   C H E C K               * S99528 31680022
*                                                              * S99528 31770022
**************************************************************** S99528 31860022
         SPACE                                                          31950022
ADDLINE  EQU   *                       CHECK IF VALID UCB EXISTS S99528 32040022
UCBLOOK  L     WORKREG5,CVT(PARMREG0)  PICK UP CVT POINTER       S99528 32130022
         L     WORKREG6,UCBPTR(WORKREG5) PTR TO 2 BYTE UCB TBLE  S99528 32220022
UCBLOOK1 LH    UCBREG,CURUCB(WORKREG6) LOAD UCB ADDRESS          S99528 32310022
         LA    WORKREG6,NXTUCB(WORKREG6) POINT TO NEXT UCB ADDR  S99528 32400022
         LTR   UCBREG,UCBREG           IS THERE A UCB ADDRESS?   S22024 32490000
         BZ    UCBLOOK1                PADDING  IGNORE ENTRY     S99528 32580022
         BC    CUUPTR,UCBEND           END OF LIST               S99528 32670022
         CLI   TOTINBUF+D3,BLANK        IS 4TH CHAR BLANK?     @YA12402 32680058
         BE    DIGIT3                   YES                    @YA12402 32690058
         CLI   TOTINBUF+D4,BLANK        MORE THAN FOUR CHAR    @YA12402 32700058
         BNE   UCBEND                   YES INVALID LINE ADDR  @YA12402 32710058
         CLC   TOTINBUF+D1(UNITLEN),UCBLNADR(UCBREG)           @YA12402 32720058
*                                       DOES CUU MATCH?        @YA12402 32730058
         B     UCBMATCH                 GO TAKE APPRO. BRANCH  @YA12402 32740058
DIGIT3   EQU   *                                               @YA12402 32750058
         CLC   TOTINBUF(UNITLEN),UCBLNADR(UCBREG)  DOES CUU MATCHS22024 32760000
UCBMATCH EQU   *                                               @YA12402 32800058
         BNE   UCBLOOK1                NO MATCH  CHK NEXT UCB    S99528 32850022
         CLI   UCBDEVCL(UCBREG),TCUCLASS  IS CLASS EQUAL 40      S99528 32940022
         BE    GOODUCB                 VALID DEVICE CLASS        S99528 33030022
         CLI   UCBDEVCL(UCBREG),GRAPHCLS  IS CLASS EQUAL 10      S99528 33120022
         BE    GOODUCB                 VALID DEVICE CLASS        S99528 33210022
*                                      UNSUPPORTED DEVICE TYPE   S99528 33300022
         IEDQMSG MSGID=143,FUNCT=CEC,RET=CHKFNFLG                S99528 33390022
UCBEND   EQU   *                       INVALID LINE ADDRESS      S99528 33480022
         IEDQMSG MSGID=141,FUNCT=CEC,RET=CHKFNFLG                S99528 33570022
         EJECT                                                          33840022
**************************************************************** S99528 33848022
*                                                              * S99528 33948022
*  C H E C K   F O R   L I N E   A D D R E S S   I N   P D S   * S99528 34048022
*                                                              * S99528 34148022
**************************************************************** S99528 34248022
         SPACE                                                          34348022
GOODUCB  EQU   *                       IS LINE ALREADY CUNFIGED  S99528 34448022
         MVC   CDSUNIT+CUUADR(LEN),CUUPTR(UCBREG) MOVE UA TO CDS S99528 34548022
         NI    CDSUNIT+CUUADR,LEFTCLR  CLEAR FLAG BITS           S99528 34648022
         MVC   CDSCESNM(NAMELEN),MODPREFX   PICK UP PREFIX       S99528 34748022
         CLI   TOTINBUF+D3,BLANK        IS 4TH CHAR BLANK?     @YA12402 34758058
         BE    MOVE3                    YES                    @YA12402 34768058
         MVC   CDSCESNM+UAPTR(UNITLEN),TOTINBUF+D1 ADJUST      @YA12402 34778058
*                                       FOR LEADING ZERO       @YA12402 34788058
         B     MOVEDON                  FINISHED MOVE          @YA12402 34798058
MOVE3    EQU   *                                               @YA12402 34808058
         MVC   CDSCESNM+UAPTR(UNITLEN),TOTINBUF  INSERT LINE ADDRS22024 34848000
MOVEDON  EQU   *                                               @YA12402 34898058
         MVC   CDSMEMBR(NAMELEN),CDSCESNM  MOVE NAME TO LIST     S22024 34948000
         OPEN  (CDS40,(INPUT))         OPEN LOCAL DATA SET       S99528 35048022
         LA    CDS40DCB,CDS40          GET DCB ADDR              S99528 35148022
         TM    OPENFLAG(CDS40DCB),GOODOPEN  TEST FOR GOOD OPEN   S99528 35248022
         BZ    OPENERR                 BRANCH IF OPEN ERROR      S99528 35348022
         FIND  CDS40,CDSMEMBR,D        SEARCH PDS FOR LINE       S22024 35448000
         LTR   RETCODE,RETCODE         IS LINE ALREADY IN PDS    S99528 35548022
         BZ    DUPCDS40                YES  DO NOT ADD LINE      S99528 35648022
         CLOSE CDS40                   CLOSE LOCAL DATA SET      S99528 35748022
         B     LINEPREP                GO TO LINE PREPROCESSOR   S99528 35848022
DUPCDS40 BXH   RETCODE,WORKREG5,LINEPREP  BR ON HIGH TO LINE     S99528 35948022
*                                           PREPROCESSOR         S99528 35998022
*                                      ALREADY CONFIG  REQ CHANG S99528 36048022
         IEDQMSG MSGID=146,FUNCT=CEC,RET=CHKFNFLG                S99528 36148022
         EJECT                                                          36600022
**************************************************************** S99528 36700022
*                                                              * S99528 36800022
*        C H A N G E   S C H E D U L E R   L O G I C           * S99528 36900022
*                                                              * S99528 37000022
**************************************************************** S99528 37100022
         SPACE                                                          37200022
PROCHANG EQU   *                       CHECK IF LINE OR TERMINAL S99528 37300022
         TM    CDSFNFLG,CHANLINE       IS ENTRY A LINE ADDR      S99528 37400022
         BO    ADAPTYP                 YES                       S99528 37500022
TERMTYP  EQU   *                                                 S99528 37600022
         MVC   CDSCESNM(NAMELEN),CDSSYMBL   MOVE NAME TO CESD    S99528 37700022
         B     TERMPREP                BRANCH TO TERM PREPROCESS S99528 37800022
ADAPTYP  EQU   *                                                 S99528 37900022
         MVI   CDSCLASS,TCUCLASS       MOVE CLASS TO CDS         S99528 38000022
         B     LINETYPE                GO DETERMINE LINE TYPE    S99528 38100022
         EJECT                                                          39500022
**************************************************************** S99528 39600022
*                                                              * S99528 39700022
*       A D D   T E R M I N A L   P R E P R O C E S S O R      * S99528 39800022
*                                                              * S99528 39900022
**************************************************************** S99528 40000022
         SPACE                                                          40100022
TERMPREP EQU   *                                                 S99528 40200022
         CLI   CDSRETFL,SPECIAL        IS THIS A SPECIAL SYMBOLICY06300 40220005
*                                        TO LOCAL CDS?           Y06330 40240005
         BE    GOODNAM1                YES, GO OPEN LOCAL CDS    Y06330 40260005
TERMTYPE EQU   *                                                 S99528 40400022
         LOAD  EP=IEDQWI9              LOAD MODULE TO GET CHARTC S99528 40500022
         LR    ENTRYPT,PARMREG0        GET ENTRYPT ADDRESS       S99528 40600022
         BALR  RETURN,ENTRYPT          BRANCH TO MODULE          S99528 40700022
         DELETE EP=IEDQWI9             DELETE MODULE             S99528 40800022
         CLI   CDSRETFL,ZERO           CHECK FOR VALID RETURN    S99528 40900022
         BNE   CLEANUP                 INVALID RETURN CLEANUP    S99528 41000022
CONFIG42 EQU   *                       LOAD UNIT CONFIGURATOR    S99528 41100022
         MVC   MODNAME,UNTPREFX        MOVE 'U....UCA' TO BLDL   S22024 41200000
*                                        LIST                    S22024 41210000
         TM    CDSFNFLG,CDSSTDBS       IS STD RFT FLAG ON        S99528 41230022
         BO    GET2700                 YES, GET T2700 UNIT CNFG  S99528 41260022
         MVC   MODNAME+NEXTLOC(LISTLEN),CDSTERM  MOVE TERM TYPE  S99528 41300022
BLDL42   BLDL  PARMREG0,BLDLLIST       GET ADDR OF BLDL LIST     S99528 41400022
         LTR   RETCODE,RETCODE         CHECK IF BLDL OK          S99528 41500022
         BNZ   CNFG42                  INVALID RETURN GO ANALYZE S99528 41600022
         LA    RETURN,GETMOD42         SET UP RETURN ADDRESS     S99528 41700022
         B     CHKSIZE                 CHECK IF MODULE FITS CORE S99528 41800022
GET2700  MVC   MODNAME+NEXTLOC(LISTLEN),STDRFTCF MOVE IN T2700   S99528 41830022
         NI    CDSFNFLG,XFF-CDSSTDBS TURN OFF STD BI-SYNC FLAG   S22024 41840000
         B     BLDL42                  GO GET T2700 UNIT CNFG    S99528 41860022
CNFG42   CH    RETCODE,NOTFOUND        NO  CONFIG MODULE FOUND   S99528 41900022
         BNE   IOERROR                 BECAUSE OF IO ERROR       S99528 42000022
NOMODULE EQU   *                       BECAUSE NO MODULE EXISTS  S99528 42100022
         IEDQMSG MSGID=147,FUNCT=CEC,RET=CONTPROC                S99528 42200022
         EJECT                                                   S99528 42300022
IOERROR  EQU   *                       IO ERROR                  S99528 42400022
         IEDQMSG MSGID=148,FUNCT=CEC,RET=CONTPROC                S99528 42500022
         EJECT                                                          42900022
**************************************************************** S99528 43000022
*                                                              * S99528 43080022
*      C H E C K   C O R E   N E E D E D   F O R   M O D U L E * S99528 43160022
*                                                              * S99528 43240022
**************************************************************** S99528 43320022
         SPACE                                                          43400022
         DS    0F                                                S99528 43480022
CHKSIZE  EQU   *                       WILL MODULE FIT IN CORE   S99528 43560022
         MVC   WORKAREA(BYTE3),CORENEED PLACE SIZE IN WORKAREA   S99528 43640022
         L     AVAILABL,TOTMMSPC       GET NUMBER OF BYTES OF    S22024 43720000
*                                        UNUSED CORE FROM OLTCB  S22024 43730000
         L     WORKREG6,CONFSIZE       GET MAX SIZE OF IEDQWIA   S22024 43740000
         SR    AVAILABL,WORKREG6       GET NUMBER OF BYTES       S22024 43750000
*                                        AVAILABLE FOR UNIT      S22024 43760000
*                                        CONFIGURATOR MODULES    S22024 43770000
         L     MODSIZE,WORKAREA        SAVE SIZE OF MODULE       S22024 43780000
         SRL   MODSIZE,HIGHORDR        REMOVE UNWANTED BITS      S99528 43800022
         SR    AVAILABL,MODSIZE        WILL MODULE FIT           S99528 43960022
         BNM   CORELEFT                YES  GO STORE CORELEFT    S99528 44040022
*                                      UNABLE TO LOAD MODULE     S99528 44120022
         IEDQMSG MSGID=149,FUNCT=CEC,RET=CONTPROC                S99528 44200022
         SPACE                                                          44280022
CORELEFT EQU   *                                                 S99528 44360022
         ST    AVAILABL,TOTMMSPC       STORE UNUSED CORE         S99528 44440022
         BR    RETURN                  RETURN TO CALLER          S99528 44520022
         EJECT                                                          44600022
**************************************************************** S99528 44680022
*                                                              * S99528 44760022
*     L O A D   T E R M I N A L   C O N F I G   M O D U L E    * S99528 44840022
*                                                              * S99528 44920022
**************************************************************** S99528 45000022
         SPACE                                                          45080022
GETMOD42 EQU   *                                                 S99528 45160022
         LA    CDSINREG,CDSWORK        POINT TO CDS WORK AREA    S99528 45240022
         LOAD  DE=MODNAME              GET UNIT CONFIG MODULE    S99528 45320022
         LR    ENTRYPT,PARMREG0        GET ADDR OF MODULE        S99528 45400022
         ST    PARMREG0,TOTOLTEN       SAVE ENTRY POINT ADDR     S22024 45440000
         L     ENTRYPT,FRSTINST(ENTRYPT)  GET 1ST INST ADDR      S99528 45480022
         BALR  RETADDR,ENTRYPT         BRANCH TO UNIT CONFIG     S99528 45560022
         DELETE DE=MODNAME             DELETE UNIT CONFIG MODULE S99528 45640022
         SPACE 2                                                        45641000
         L     RTRM,TERTABLE           GET TTE ADDRESS         @ZM47904 45642000
         USING IEDQTRM,RTRM            SET TTE ADDRESSABILITY  @ZM47904 45643000
         TM    TRMSTATE,TRMPREF        3705 RESOURCE           @ZM47904 45644000
         BZ    CONFIG30                NO, CONTINUE            @ZM47904 45645000
         MVI   CDSCLASS,RNCLASS        SET UP CLASS FIELD      @ZM47904 45646000
         DROP  RTRM                                            @ZM47904 45647000
CONFIG30 EQU   *                                               @ZM47904 45648000
         MVC   WORKAREA(BYTE3),CORENEED  PLACE SIZE OF MODULE    S22024 45650000
*                                          IN WORKAREA           S22024 45660000
         L     MODSIZE,WORKAREA        SAVE SIZE OF MODULE       S22024 45670000
         SRL   MODSIZE,HIGHORDR        REMOVE UNWANTED BITS      S22024 45680000
         L     AVAILABL,TOTMMSPC       GET NUMBER OF UNUSED BYTESS22024 45690000
         AR    AVAILABL,MODSIZE        ADD DELETED MODULE SIZE   S22024 45700000
         L     WORKREG6,CONFSIZE       GET MAX SIZE OF IEDQWIA   S22024 45703000
         AR    AVAILABL,WORKREG6       RESTORE INITIAL CORE SIZE S22024 45706000
         ST    AVAILABL,TOTMMSPC       UPDATE UNUSED BYTE COUNT  S22024 45710000
         CLI   CDSRETFL,ZERO           VALID RETURN              S99528 45720022
         BE    ADDCDS                  YES  WAS CHANGE SPECIFIED S99528 45800022
         SPACE                                                          45880022
CNFIGERR EQU   *                       UNIT CNFG ERROR           S99528 45960022
         IEDQMSG MSGID=125,FUNCT=REP                             S99528 46040022
         CLI   TOTINBUF,YES            WAS ANSWER YES            S22024 46120000
         BE    CHKFNFLG                YES  CHK FUNCTION FLAG    S99528 46200022
         CLI   TOTINBUF,NO             WAS ANSWER NO?            S22024 46280000
         BE    CLEANUP                 NO ANSWER RECEIVED        S99528 46360022
*                                      INVALID RESPONSE          S99528 46440022
         IEDQMSG MSGID=079,FUNCT=CEC,RET=CNFIGERR                S05331 46520000
         EJECT                                                          46800022
**************************************************************** S99528 46900022
*                                                              * S99528 47000022
*     A D D   T E R M I N A L   C O N F I G   T O   P D S      * S99528 47100022
*                                                              * S99528 47200022
**************************************************************** S99528 47300022
         SPACE                                                          47400022
ADDCDS   EQU   *                       ADD CDS ENTRY             S99528 47500022
         OPEN  (CDS42,(OUTPUT))        OPEN REMOTE DATA SET      S99528 47600022
         LA    CDS42DCB,CDS42          GET ADDR OF REMOTE DCB    S99528 47700022
         TM    OPENFLAG(CDS42DCB),GOODOPEN  TEST FOR GOOD OPEN   S99528 47800022
         BZ    OPENERR                 BRANCH FOR OPEN ERROR     S99528 47900022
         MVC   CDSCESNM(NAMELEN),CDSMEMBR   MOVE NAME TO CESD    S99528 48000022
         WRITE CDSDECB,SF,CDS42,CDSCESD,56,MF=E  WRITE CESD REC  S99528 48100022
         CHECK CDSDECB                 WAIT FOR IO COMPLETION    S99528 48200022
         NOTE  CDS42                   GET REL POSITN OF CESD    S99528 48300022
         ST    PARMREG1,CDSTTRC        PLACE POSITN IN BLDL TTRC S99528 48400022
         MVI   CDSTTRC4,DATALEN        STORE USER DATA LENGTH    S99528 48500022
         WRITE CDSDECB,SF,,CDSCNTL,20,MF=E  WRITE CNTL REC       S99528 48600022
         CHECK CDSDECB                 WAIT FOR IO COMPLETION    S99528 48700022
         TM    CDSFNFLG,CDSDPMSK       IS DEVICE PROTECT BIT ON  S99528 48720022
         BZ    WRTCDS42                NO, WRITE CDS REC AS IS   S99528 48740022
         OI    CDSSIGNL,CDSDPMSK       YES, TURN ON DEV PROTECT  S99528 48760022
WRTCDS42 EQU   *                                                        48780022
         WRITE CDSDECB,SF,,CDSREC,256,MF=E  WRITE CDS REC        S99528 48800022
         CHECK CDSDECB                 WAIT FOR IO COMPLETION    S99528 48900022
         NOTE  CDS42                   GET REL POSITN OF CDS REC S99528 49000022
         ST    PARMREG1,CDSTTRD        PLACE POSITN IN BLDL TTRD S99528 49100022
         MVI   CDSTTRD4,ZERO           ZERO OUT 4TH POSTN TTRD   S99528 49200022
         STOW  CDS42,CDSBLDL,R         UPDATE DIRECTORY          S99528 49300022
         LTR   RETCODE,RETCODE         WAS UPDATE SUCCESSFUL     S99528 49400022
         BNZ   STOWADD                 STOW ERROR ENCOUNTERED    S99528 49500022
         B     STOWREP                 SUCCESSFUL UPDATE                49600022
         EJECT                                                          52100022
**************************************************************** S99528 52200022
*                                                              * S99528 52300022
*                    L I N E   P R E P R O C E S S O R         * S99528 52400022
*                                                              * S99528 52500022
**************************************************************** S99528 52600022
LINEPREP EQU   *                                                 S99528 52700022
         MVI   CDSCLASS,TCUCLASS       MOVE CLASS TO CDS CREATIO S99528 52800022
ADAPTYPE EQU   *                                                 S99528 52900022
         LOAD  EP=IEDQWI5U             GET ADAPTER TYPE;TCU TYPE S99528 53000022
         LR    ENTRYPT,PARMREG0        GET MODULE ADDRESS        S99528 53100022
         BALR  RETURN,ENTRYPT          BRANCH TO MODULE          S99528 53200022
         DELETE EP=IEDQWI5U            DELETE MODULE             S99528 53300022
         CLI   CDSRETFL,ZERO           VALID RETURN?             S99528 53400022
         BNE   CHKFNFLG                NO                        S99528 53500022
LINETYPE EQU   *                       GET LINE TYPE             S99528 53600022
         LOAD  EP=IEDQWI7              LOAD MODULE               S99528 53700022
         LR    ENTRYPT,PARMREG0        GET MODULE ADDRESS        S99528 53800022
         BALR  RETURN,ENTRYPT          BRANCH TO MODULE          S99528 53900022
         DELETE EP=IEDQWI7             DELETE MODULE             S99528 54000022
         CLI   CDSRETFL,ZERO           VALID RETURN?             S99528 54100022
         BNE   CLEANUP                 NO; GO CLEANUP            S99528 54200022
CONFIG40 EQU   *                       GET TCU CHARACTERISTICS   S99528 54300022
         MVC   MODNAME(NAMELEN),UNTPREFX    MOVE PREFX AND BLNKS S99528 54400022
         MVC   MODNAME+NEXTLOC(LISTLEN),CDSTCUTY MOVE CNFG ID TO S99528 54500022
         CLC   MODNAME,RNCONFIG        IS CONFIG FOR 3705        S05331 54530000
         BE    RN3704                  YES BRANCH                S05331 54560000
BLDL40   BLDL  PARMREG0,BLDLLIST   DOES UNIT CONFIG EXIST        S22024 54600000
         LTR   RETCODE,RETCODE         WAS BLDL OKAY?            S99528 54700022
         BNZ   CNFG40                  GO ANALYZE RETURN CODE    S99528 54800022
         LA    RETURN,GETMOD40         SET UP RETURN ADDRESS     S99528 54900022
         B     CHKSIZE                 SEE IF MODULE WILL FIT    S99528 55000022
RN3704   EQU   *                                                 S05331 55009000
         IEDQMSG MSGID=110,FUNCT=REP   IS CONFIG FOR 3704        S05331 55018000
         CLI   TOTINBUF,YES            WAS ANSWER YES            S05331 55027000
         BE    RN3704MV                YES BRANCH                S05331 55036000
         CLI   TOTINBUF,NO             ANSWER NO                 S05331 55045000
         BE    BLDL40                  BRANCH                    S05331 55054000
         IEDQMSG MSGID=079,FUNCT=CEC,RET=RN3704   INVALID REP    S05331 55063000
RN3704MV EQU   *                       CONTROL UNIT IS 3704      S05331 55072000
         MVC   MODNAME,RNCON04         NEW CONFIG NAME           S05331 55081000
         B     BLDL40                  BRANCH                    S05331 55090000
CNFG40   CH    RETCODE,NOTFOUND        WAS UNIT CONFIG FOUND     S99528 55100022
         BNE   IOERROR                      NO; GO PRINT I/O ERR S99528 55200022
         B     NOMODULE                NO MODULE EXIST           S99528 55300022
GETMOD40 EQU   *                                                 S99528 55400022
         LA    CDSINREG,CDSWORK        POINT TO CDS WORK AREA    S99528 55500022
         LOAD  DE=MODNAME              GET UNIT CONFIG MODULE    S99528 55600022
         LR    ENTRYPT,PARMREG0        PICK UP ADDR OF UNIT CONF S99528 55700022
         ST    PARMREG0,TOTOLTEN       SAVE ENTRY POINT ADDR     S22024 55750000
         L     ENTRYPT,FRSTINST(ENTRYPT)    GET 1ST INST ADDR    S99528 55800022
         BALR  RETADDR,ENTRYPT         BRANCH TO UNIT CONFIG     S99528 55900022
         DELETE DE=MODNAME             DELETE UNIT CONFIG MODULE S99528 56000022
         MVC   WORKAREA(BYTE3),CORENEED  PLACE SIZE OF MODULE    S22024 56010000
*                                          IN WORKAREA           S22024 56020000
         L     MODSIZE,WORKAREA        SAVE SIZE OF MODULE       S22024 56030000
         SRL   MODSIZE,HIGHORDR        REMOVE UNWANTED BITS      S22024 56040000
         L     AVAILABL,TOTMMSPC       GET NUMBER OF UNUSED BYTESS22024 56050000
         AR    AVAILABL,MODSIZE        ADD DELETED MODULE SIZE   S22024 56060000
         L     WORKREG6,CONFSIZE       GET MAX SIZE OF IEDQWIA   S22024 56070000
         AR    AVAILABL,WORKREG6       RESTORE INITIAL CORE SIZE S22024 56080000
         ST    AVAILABL,TOTMMSPC       UPDATE UNUSED BYTE COUNT  S22024 56090000
         CLI   CDSRETFL,ZERO           VALID RETURN?             S99528 56100022
         BNE   CNFIGERR                NO; GO PRINT CONFIG ERROR S99528 56200022
         EJECT                                                          56600022
**************************************************************** S99528 57000022
*                                                              * S99528 57100022
*        A D D   L I N E   C O N F I G   T O   P D S           * S99528 57200022
*                                                              * S99528 57300022
**************************************************************** S99528 57400022
ADDCDSCU EQU   *                       ADD CDS ENTRY             S99528 57500022
         OPEN  (CDS40,(OUTPUT))        OPEN LOCAL DATA SET       S99528 57600022
         LA    CDS40DCB,CDS40          WAS OPEN SUCCESSFUL?      S99528 57700022
         TM    OPENFLAG(CDS40DCB),GOODOPEN   YES IF MATCH        S99528 57800022
         BZ    OPENERR                 OPEN ERROR                S99528 57900022
         WRITE CDSDECB,SF,CDS40,CDSCESD,56,MF=E  WRITE CESD RECO S99528 58000022
         CHECK CDSDECB                 WAIT FOR I/O COMPLETION   S99528 58100022
         ST    PARMREG1,CDSTTRC        PLACE POSTION IN BLDL LIS S99528 58200022
         MVI   CDSTTRC4,USERTTRC       SET UP # TTR'S AND DATA   S99528 58300022
         WRITE CDSDECB,SF,,CDSCNTL,20,MF=E  WRITE CNTL RECORD    S99528 58400022
         CHECK CDSDECB                   WAIT FOR I/O COMPLETION S99528 58500022
         TM    CDSFNFLG,CDSDPMSK       IS DEVICE PROTECT BIT ON  S99528 58520022
         BZ    WRTCDS40                NO, WRITE CDS REC AS IS   S99528 58540022
         OI    CDSSIGNL,CDSDPMSK       YES, TURN ON DEV PROTECT  S99528 58560022
WRTCDS40 EQU   *                                                        58580022
         WRITE CDSDECB,SF,,CDSREC,256,MF=E  WRITE CDS RECORD     S99528 58600022
         CHECK CDSDECB                 WAIT FOR I/O COMPLETION   S99528 58700022
         NOTE  CDS40                   GET RELATIVE POSITION     S99528 58800022
         ST    PARMREG1,CDSTTRD        PLACE POSITION IN BLDL    S99528 58900022
         MVI   CDSTTRD4,ZERO           ZERO OUT 4TH POSITION     S99528 59000022
         STOW  CDS40,CDSBLDL,R         UPDATE DIRECTORY          S99528 59100022
         LTR   RETCODE,RETCODE         WAS UPDATE SUCCESSFUL?    S99528 59200022
         BNZ   STOWADD                 STOW ERROR ENCOUNTERED    S99528 59300022
         B     STOWREP                 BR TO REPLACE             S99528 59400022
         EJECT                                                          61600022
**************************************************************** S99528 61700022
*                                                              * S99528 61750022
*        I / O   E R R O R   A N A L Y S I S   L O G I C       * S99528 61800022
*                                                              * S99528 61850022
**************************************************************** S99528 61900022
OPENERR  EQU   *                       OPEN ERROR PROCEDURE      S99528 61950022
         IEDQMSG MSGID=129,FUNCT=CEC,RET=CONTPROC                S99528 62000022
BADCDS   EQU   *                                                 S99528 62050022
         LA    SAVEAREA,TOTSAVE5       RESTORE SAVE PTR          S99528 62100022
         IEDQMSG MSGID=128,FUNCT=CEC                             S99528 62150022
         B     CLEANUP                 CLEANUP AND GET OUT       S99528 62200022
STOWADD  EQU   *                       STOW ADD ERROR PROCEDURE  S99528 62250022
         CH    RETCODE,NOSPACE         CHECK RETURN CODE - NO    S22024 62300000
*                                        SPACE                   S22024 62320000
         BL    CDSADDED                CDS ADDED                 S99528 62350022
         BH    STOW1                   I/O ERROR                 S99528 62400022
*                                      NO SPACE                  S99528 62450022
         IEDQMSG MSGID=136,FUNCT=CEC,RET=CLEANUP                 S99528 62500022
STOWREP  EQU   *                                                 S99528 62550022
         IEDQMSG  MSGID=115,FUNCT=CEC,RET=CDSADDED               S99528 62600022
CDSADDED EQU   *                       CDS ENTRY ADDED           S99528 62650022
         IEDQMSG MSGID=116,FUNCT=CEC,RET=CHKFNFLG                S99528 62700022
STOW1    EQU   *                                                 S99528 62750022
         IEDQMSG MSGID=135,FUNCT=CEC,RET=CLEANUP                 S99528 62800022
STOWDEL  EQU   *                       STOW DELETE ERROR PROCEDU S99528 62850022
         IEDQMSG MSGID=134,FUNCT=CEC,RET=CONTPROC                S99528 62900022
         EJECT                                                          62975022
**************************************************************** S99528 62980022
*                                                              * S99528 62985022
*        TO CONTINUE OR NOT TO CONTINUE; THAT IS THE QUESTION  * S99528 62990022
*                                                              * S99528 62995022
**************************************************************** S99528 63000022
CONTPROC EQU   *                       DO YOU WISH TO CONTINUE   S99528 63005022
         IEDQMSG MSGID=125,FUNCT=REP                             S99528 63010022
         CLI   TOTINBUF,YES            CHECK FOR YES RESPONSE    S22024 63015000
         BE    CHKFNFLG                YES RESPONSE              S99528 63020022
         CLI   TOTINBUF,NO             CHECK FOR NO RESPONSE     S22024 63025000
         BE    CLEANUP                 NO RESPONSE               S99528 63030022
CONTPRC1 EQU   *                       INVALID RESPONSE          S99528 63035022
         IEDQMSG MSGID=079,FUNCT=CEC,RET=CONTPROC                S22024 63040022
CHKFNFLG EQU   *                       CHECK FUNCTION FLAG       S99528 63045022
         MVI   CDSRETFL,ZERO           RESET RETURN FLAG         S99528 63050022
         CLOSE CDS40                   CLOSE LOCAL DATA SET      S99528 63055022
         CLOSE CDS42                   CLOSE REMOTE DATA SET     S99528 63060022
         TM    CDSFNFLG,CHANGE         WHAT FUNCTION SPECIFIED   S99528 63065022
         BO    CHAGMORE                SEE IF MORE CHANGES       S99528 63070022
ADDMORE  EQU   *                       ARE THERE MORE ADDITIONS  S99528 63075022
         IEDQMSG MSGID=120,FUNCT=REP                             S99528 63080022
         CLI   TOTINBUF,NO             WAS ANSWER NO?            S22024 63085000
         BE    CLEANUPA                NO, GO TO CLEANUP         S22024 63090000
         CLI   TOTINBUF,YES            WAS ANSWER YES?           S22024 63095000
         BE    PROCADD                 YES; GO TO ADD PROCEDURE  S99528 63100022
         B     CONTPRC1                INVALID RESPONSE          S99528 63105022
CHAGMORE EQU   *                       ARE THERE MORE CHANGES    S99528 63110022
         IEDQMSG MSGID=121,FUNCT=REP                             S99528 63115022
         CLI   TOTINBUF,NO             NO ANSWER?                S22024 63120000
         BE    CLEANUPA                NO, GO TO CLEANUP         S22024 63125000
         CLI   TOTINBUF,YES            YES ANSWER                S22024 63130000
         BNE   CONTPRC1                INVALID RESPONSE          S99528 63135022
         L     SAVEAREA,PREVSAVE(SAVEAREA) ADDR.OF CALLERS SAVE S99528  63140022
         LM    R14,R2,12(SAVEAREA)     RESTORE REGS 14-02        S99528 63145022
         XCTL  (2,12),EP=IEDQWID                                 S99528 63150022
CLEANUP  EQU   *                       TURN ON CLEAN UP FLAG     S99528 63155022
         MVI   CDSRETFL,EXITFLG                                  S99528 63160022
CLEANUPA EQU   *                                                 S22024 63162000
         CLOSE CDS42                   CLOSE REMOTE DATA SET     S99528 63165022
         CLOSE CDS40                   CLOSE LOCAL DATA SET      S99528 63170022
EXIT     EQU   *                                                 S99528 63175022
         L     SAVEAREA,PREVSAVE(SAVEAREA)  RESTORE CALLERS      S99528 63176022
         LM    R14,R2,12(SAVEAREA)     RESTORE REGS 14-02        S99528 63177022
         XCTL  (2,12),EP=IEDQWI1       TRANSFER CNTL TO IEDQWI1  S99528 63180022
         EJECT                                                          63210022
**************************************************************** S99528 63215022
*                                                              * S99528 63285022
*        BLDLLIST; CONSTANTS; PATCH AREA; ETC                  * S99528 63355022
*                                                              * S99528 63425022
**************************************************************** S99528 63495022
         SPACE 1                                                 S99528 63565022
         DS    0F                                                S99528 63635022
BLDLLIST DC    XL2'0001'               NUMBER OF LIST ENTRIES    S99528 63705022
         DC    XL2'003A'                    LENGTH OF EACH ENTRY S99528 63775022
MODNAME  DC    XL8'0'                       MODULE ID            S99528 63845022
         DC    XL16'0'                      ADDITIONAL DIRECTORY S99528 63915022
CORENEED DC    XL3'0'                       MAIN STORAGE NEEDED  S99528 63985022
         DC    XL31'0'                      ADDITIONAL DIRECTORY S99528 64055022
CONFSIZE DC    F'2560'                 MAXIMUM SIZE OF IEDQWIA INS22024 64125000
*                                        BYTES                   S22024 64135000
NOSPACE  DC    X'000C'                 RETURN CODE FROM STOW     S22024 64145000
*                                        IF NO SPACE IN DIRECTORYS22024 64155000
BLANKS   DC    CL8'        '                BLANKS               S99528 64195022
MODPREFX DC    CL8'G0000000'                LOCAL CDS PREFIX     S99528 64265022
UNTPREFX DC    CL8'U    UCA'           UNIT CONFIG PREFIX,SUFFIX S99528 64335022
STDRFTCF DC    CL4'2700'               STD RFT UNIT CONFIG       S99528 64365022
NOTFOUND DC    X'0004'                      NO MODULE TEST MASK  S99528 64405022
         DS    0F                                                S99528 64475022
WORKAREA DS    CL10                         WORK AREA            S99528 64545022
         DS    0F                                                S99528 64615022
PATCH    DS    CL100                        MAINTENANCE AREA     S99528 64685022
RNCONFIG DC    C'U3705UCA'         NAME OF SPECIAL MODULE FOR    S22024 64745000
RNCON04  DC    C'U3704UCA'             NAME FOR 3704 CONFIG      S05331 64755000
*                                  ADD SYMBOLIC NAME TO LOCAL CDSS22024 64765000
NCPCONFG DC    C'U3700UCA'        NAME OF CONFIG MODULE FOR NCP  S22024 64775000
*                                   CDS                          S22024 64785000
NCPCDSNM DC    C'NCP '            NAME TO INDICATE THIS IS AN    S22024 64795000
*                                   NCPCDS CONFIG RUN            S22024 64805000
         EJECT                                                          64827022
*********************************************************************** 64830022
*                                                                     * 64833022
*        L I S T   F O R M   O F   W R I T E ;  D C B ' S             * 64836022
*                                                                     * 64839022
*********************************************************************** 64842022
         SPACE                                                          64845022
         WRITE CDSDECB,SF,MF=L                                          64848022
         SPACE                                                          64851022
CDS40    DCB   DDNAME=OLTLIB,DSORG=PO,MACRF=(R,W),                     X64854022
               RECFM=U,                                          Y06330*64857005
               SYNAD=BADCDS                                             64860022
CDS42    DCB   DDNAME=CDSLIB,DSORG=PO,MACRF=(R,W),                     X64863022
               RECFM=U,                                          Y06330*64866005
               SYNAD=BADCDS                                             64869022
         EJECT                                                          64900022
         TTRMD                                                 @ZM47904 64930000
         EJECT                                                          64960000
         OLTCB CONFG=YES                                                65000022
TERTABLE DS    F                                               @OY20528 65050086
         END                                                            65400022
         END                                                            74600020
