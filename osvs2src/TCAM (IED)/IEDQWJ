         TITLE 'IEDQWJ TRM PROMPTER MODULE 1'                           00070000
IEDQWJ   CSECT                                                          00140000
*A000000-999999                                                @Y16X5U0 00210000
* CHANGE ACTIVITY AS FOLLOWS:                                           00280000
*A453200                                                        SA41597 00350000
*A209300-209600                                                 SA41606 00420000
*A291000,303000,339000                                          SA41608 00490000
*A135070-135990,136640-136650,136650,136674-136681,357080-361720 S22024 00560000
*A374860-375400,379200-379800,443100-443600,458195,458305        S22024 00630000
*A458372-458378,459430-459450,462147-462203,463757-463806        S22024 00700000
*A516700,521500,523500,524600-525200                             S22024 00770000
*C004200,146000-147000,151000,157000,169000,192000,200000        S22024 00840000
*C200000-203200,231000,239800,241000-249000,255000-256000,265000 S22024 00910000
*C269000,275000-276200,279000-280000,284000,287000,294000,       S22022 00980000
*C296000,298000,302000,305000,311000-311800,313200,315000-316000 S22024 01050000
*C321000-322000,324000,327000,331012,331690,331700,333600,       S22024 01120000
*C334000-335000,338000,340000-340500,347000,348000,350000 369800 S22024 01190000
*C373000-373600,378700,383000-384000,388000,394000,396000,424000 S22024 01260000
*C424032,424040,424056,429100-429108,429140,429456,429472        S22024 01330000
*C429572-429972,430072-430672,437000-437200,43800,441000-442000  S22024 01400000
*C445000-445500,451600-456400,458240-458310-458320               S22024 01470000
*C458440-458449,459430-459450,460670-460730,460740-460800        S22024 01540000
*C460810-460820,479000-479500,526720-526850                      S22024 01610000
*D257000,291000,292500,462280                                    S22024 01680000
*A135090-135110,381070-381840,523700                             S05331 01750000
*D331224-333800                                                  S05331 01820000
*A245000,249600,254000                                         @YA12402 01890000
*A360120,360170,374920,375130,445500,458373,458442,460740      @Y17XAUU 01960000
*A462161,516720,516780                                         @Y17XAUU 02030000
*C360778,360820,361370                                         @Y17XAUU 02100000
* A021000,111300,114800,287700,543900,547400,549500,812700     @G36XRUV 02110010
* C180600,544600                                               @G36XRUV 02120010
* D546700,548100,550200-553000                                 @G36XRUV 02130010
*                                                                       02140010
         USING IEDQWJ,R15                                      @YA12402 02170000
*                                                                       02240000
IEDQWJ   IEDHJN STARJ,HJN                                               02310000
*                                                                       02380000
         SPACE 2                                                        02450000
**************************************************************** S99528 02520000
*                                                              *        02590000
* MODULE NAME = IEDQWJ (TCAM,TOTE)                             @Y17XAUU 02660000
*                                                              *        02730000
* DESCRIPTIVE NAME = TRM PROMPTER MODULE 1                     *        02800000
*                                                              *        02870000
* COPYRIGHT = NONE                                             *        02940000
*                                                              *        03010000
* STATUS --                                                    * S99528 03080000
*                                                              * S99528 03150000
*    VERSION 10.0                                              @Y17XAUU 03220000
*                                                              * S99528 03290000
* FUNCTIONS --                                                 * S99528 03360000
*    THE PURPOSE OF THIS MODULE IS TO ANALYZE THE OLTCB FLAG   * S99528 03430000
*    BYTES TO DETERMINE WHY THE PROMPTER WAS CALLED.           * S99528 03500000
*                                                              * S99528 03570000
*    IF THE IEDQWJ MODULE IS CALLED AS THE RESULT OF A PROMPT  * S99528 03640000
*    REQUEST, THE OPERATOR AT THE CONTROL TERMINAL WILL BE     * S99528 03710000
*    PROMPTED FOR THE 'TEST DEVICE' FIELD OF THE TRM. WHEN     * S99528 03780000
*    A VALID 'TEST DEVICE' FIELD IS ENTERED, CONTROL IS        * S99528 03850000
*    TRANSFERRED TO IEDQWJ1.                                   * S99528 03920000
*                                                              * S99528 03990000
*    IF ENTRY TO IEDQWJ IS THE RESULT OF ERRONEOUS INFORMATION * S99528 04060000
*    IN THE TRM, THE OPERATOR AT THE CONTROL TERMINAL IS GIVEN * S99528 04130000
*    THE OPTION OF RE-ENTERING THE TRM OR BEING PROMPTED. IF   * S99528 04200000
*    PROMPTING IS SELECTED, THIS MODULE WILL CHECK TO SEE IF   * S99528 04270000
*    THE ERROR WAS IN THE 'TEST DEVICE' FIELD OR THE AP TERM   * S99528 04340000
*    OPTION OF THE TRM. IF THE ERROR WAS IN NEITHER OF THESE   * S99528 04410000
*    FIELDS, CONTROL IS TRANSFERRED TO IEDQWJ1. OTHERWISE,     * S99528 04480000
*    THIS MODULE PROMPTS FOR THE 'TEST DEVICE' FIELD AND THEN  * S99528 04550000
*    TRANSFERS CONTROL TO IEDQWJ1 TO PROMPT FOR 'TESTS' AND    * S99528 04620000
*    'OPTIONS' FIELDS                                          * S99528 04690000
*                                                              * S99528 04760000
*    WHEN ENTRY IS FROM A PROMPT REQUEST, THE CE IS PROMPTED   * S99528 04830000
*    FOR EACH OF THE TRM FIELDS EXCEPT THE CONTROL TERMINAL.   * S99528 04900000
*    WHEN ENTRY IS THE RESULT OF AN ERROR IN TRYING TO         * S99528 04970000
*    DETERMINE IF AP TERM IS SPECIFIED, THEN THE CE IS PROMPTED* S99528 05040000
*    FOR ONLY THE OPTION FIELD.                                * S99528 05110000
*                                                              * S99528 05180000
*    ALL VALIDITY CHECKING PERFORMED ON A NORMAL TRM IS        * S99528 05250000
*    PERFORMED BY THIS MODULE.                                 * S99528 05320000
*                                                              * S99528 05390000
*    THIS MODULE ONLY PROMPTS FOR THE TEST DEVICE FIELD AND    * S99528 05460000
*    THEN TRANSFERS CONTROL TO IEDQWJ1 TO PROMPT FOR TESTS AND * S99528 05530000
*    OPTIONS FIELD.                                            * S99528 05600000
*                                                              @Y17XAUU 05670000
* PURPOSE -- SEE FUNCTION                                      @Y17XAUU 05740000
*                                                              @Y17XAUU 05810000
* LINKAGE -- XCTL'ED TO FROM IEDQWB1                           @Y17XAUU 05880000
*                                                              @Y17XAUU 05950000
* MODULE TYPE -- PROCEDURE                                     @Y17XAUU 06020000
*                                                              @Y17XAUU 06090000
* MODULE SIZE -- MAXIMUM 4K                                    @Y17XAUU 06160000
*                                                              @Y17XAUU 06230000
* PROCESSOR -- ASSEMBLE XF                                     @Y17XAUU 06300000
*                                                              @Y17XAUU 06370000
* MACROS -- AQCTL,IEDHJN,IEDQMSG,WAIT,WTO,XCTL                 @Y17XAUU 06440000
*                                                              * S99528 06510000
* ENTRY POINTS --                                              * S99528 06580000
*    IEDQWJ                                                    @Y17XAUU 06650000
*                                                              * S99528 06720000
* INPUT --                                                     * S99528 06790000
*    REGISTERS 02,13,14,15 CONTAIN THE FOLLOWING VALUES        * S99528 06860000
*                                                              * S99528 06930000
*    02 - OLTCB BASE POINTER                                   * S99528 07000000
*    13 - SAVE AREA ADDRESS                                    * S99528 07070000
*    14 - RETURN ADDRESS                                       * S99528 07140000
*    15 - ENTRY POINT ADDRESS                                  * S99528 07210000
*                                                              * S99528 07280000
* OUTPUT --                                                    * S99528 07350000
*    SAME AS INPUT                                             @Y17XAUU 07420000
*                                                              * S99528 07490000
* EXITS,NORMAL --                                              * S99528 07560000
*    XCTL TO IEDQWJ1 TO CONTINUE BUILDING TRM.                 * S99528 07630000
*                                                              * S99528 07700000
* EXITS,ERROR --                                               * S99528 07770000
*    XCTL TO IEDQWE TO TERMINATE TRM                           * S99528 07840000
*                                                              * S99528 07910000
* EXTERNAL REFERENCES --                                       * S99528 07980000
*    IEDQWK - MESSAGE MODULE                                   * S99528 08050000
*    AVTUI - TCAM BINARY SEARCH MODULE                         * S99528 08120000
*                                                              * S99528 08190000
* ATTRIBUTES --                                                * S99528 08260000
*    ENABLED, PROBLEM ROGRAM MODE, TRANSIENT                   * S99528 08330000
*                                                              * S99528 08400000
* NOTES -- SEE BELOW                                           @Y17XAUU 08470000
*                                                              @Y17XAUU 08540000
*  DEPENDENCIES --EBCDIC CODE CHARACTER SET                    @Y17XAUU 08610000
*                                                              @Y17XAUU 08680000
*  RESTRICTIONS -- NONE                                        @Y17XAUU 08750000
*                                                              @Y17XAUU 08820000
*  REGISTER CONVENTIONS -- SEE REGISTER ASSIGNMENTS            @Y17XAUU 08890000
*                                                              @Y17XAUU 08960000
*  PATCH LABEL -- PATCH                                        @Y17XAUU 09030000
*                                                              * S99528 09100000
**************************************************************** S99528 09170000
         EJECT                                                          09240000
*                                                                       09310000
*              INITIALIZATION                                           09380000
*                                                                       09450000
*                                                                       09520000
R0       EQU   0                  REG 0                          S99528 09590000
R1       EQU   1                  REG 1                          S99528 09660000
R2       EQU   2                  REG 2                          S99528 09730000
R3       EQU   3                  REG 3                          S99528 09800000
R4       EQU   4                  REG 4                          S99528 09870000
R5       EQU   5                  REG 5                          S99528 09940000
R6       EQU   6                  REG 6                          S99528 10010000
R7       EQU   7                  REG 7                          S99528 10080000
R8       EQU   8                  REG 8                                 10150000
R9       EQU   9                  REG 9                          S99528 10220000
R10      EQU   10                 REG 10                         S99528 10290000
R11      EQU   11                 REG 11                         S99528 10360000
R12      EQU   12                 REG 12                         S99528 10430000
R13      EQU   13                 REG 13                         S99528 10500000
R14      EQU   14                 REG 14                         S99528 10570000
R15      EQU   15                 REG 15                         S99528 10640000
ADRMSK   EQU   7                  ADDRESS MASK                 @YM08136 10710000
COMMA    EQU   X'6B'              COMMA                          S22024 10780000
SWITCHB  EQU   X'96'              SWITCHED BI-SYNC               S05331 10850000
SWITCHS  EQU   X'90'              SWITCHED START/STOP            S05331 10920000
ACVT     EQU   16                 CVT POINTER                    S22024 10990000
A1060    EQU   X'52'              1060 UCB TYPE                  S22024 11060000
PASS1    EQU   X'01'              TEST DEVICE FIRST PASS CHECK   S22024 11130000
ADUCBMSK EQU   3                  MASK FOR UCB ADDRESS         @G36XRUV 11160010
YES      EQU   X'E8'              POSITIVE RESPONSE                     11200000
NO       EQU   X'D5'              NEGATIVE RESPONSE                     11270000
LGBA     EQU   X'80'              LGB MAP                        S22024 11340000
SLASH    EQU   X'61'              SLASH                          S22024 11410000
X0F      EQU   X'0F'              MASK FIELD                     S22024 11480000
XF0      EQU   X'F0'              MASK FIELD                   @G36XRUV 11500010
X09      EQU   X'09'              USED FOR 3270 LOCAL CHECK    @G36XRUV 11520010
OPEN     EQU   X'10'              DCB OPEN                       S22024 11550000
XE0      EQU   X'E0'              MASK SETTING                   S22024 11620000
TCU3705  EQU   X'05'              3705 CHECK                     S22024 11690000
LINE     EQU   X'01'              LINE TEST                      S22024 11760000
RNTERM   EQU   X'08'              RN TERMINAL                    S22024 11830000
RNLINE   EQU   X'04'              RN LINE                        S22024 11900000
RNCHAN   EQU   X'02'              RN SUBCHAN                     S22024 11970000
*                                                                S22024 12040000
NUMER    EQU   X'F0'              NUMERIC ENTRY                  S22024 12110000
TRMLEN   EQU   72                 TRM BUFFER LENGTH              S22024 12180000
RQINIT   EQU   X'0C'              START OF LIST                  S22024 12250000
RQEND    EQU   X'80'              END OF LIST                    S22024 12320000
D0       EQU   0                  DISPLACEMENT OF 0                     12390000
D1       EQU   1                  DISPLACEMENT OF 1                     12460000
D2       EQU   2                  DISPLACEMENT OF 2                     12530000
D3       EQU   3                  DISPLACEMENT OF 3                     12600000
D4       EQU   4                  DISPLACEMENT OF 4                     12670000
D5       EQU   5                  DISPLACEMENT OF 5                     12740000
D6       EQU   6                  DISPLACEMENT OF 6                     12810000
D7       EQU   7                  DISPLACEMENT OF 7                     12880000
D8       EQU   8                  DISPLACEMENT OF 8                     12950000
D9       EQU   9                  DISPLACEMENT OF 9                     13020000
D10      EQU   10                 DISPLACEMENT OF 10                    13090000
D11      EQU   11                 DISPLACEMENT OF 11                    13160000
D12      EQU   12                 DISPLACEMENT OF 12                    13230000
D13      EQU   13                 DISPLACEMENT OF 13                    13300000
D14      EQU   14                 DISPLACEMENT OF 14                    13370000
D15      EQU   15                 DISPLACEMENT OF 15                    13440000
D16      EQU   16                 DISPLACEMENT OF 16                    13510000
D17      EQU   17                 DISPLACEMENT OF 17                    13580000
D18      EQU   18                 DISPLACEMENT OF 18                    13650000
D19      EQU   19                 DISPLACEMENT OF 19                    13720000
D20      EQU   20                 DISPLACEMENT OF 20                    13790000
D25      EQU   25                 DISP OF 25                     S22024 13860000
D72      EQU   72                 DISP OF 72                     S22024 13930000
DCBNIDLE EQU   X'02'              3705 ACTIVE                    S22024 14000000
*                                                                       14070000
         SPACE                                                          14140000
INACT    EQU   X'48'              INACTIVATE VERB CODE           S22024 14210000
INACTRC  EQU   X'08'              TERM ALREADY INACTIVE RC       S22024 14280000
ZERO     EQU   0                  VALUE OF 0                     S99528 14350000
ONE      EQU   1                  VALUE OF 1                     S99528 14420000
EIGTH    EQU   8                  VALUE OF 8                     S99528 14490000
TWELVE   EQU   12                 VALUE OF 12                    S99528 14560000
TRMSOH   EQU   X'04'              BI-SYNC DEVICE                 S99528 14630000
TCAMDEB  EQU   X'44'              DEB BELONGS TO TCAM FLAG       S22024 14700000
TRM9S    EQU   X'08'              START-STOP DEVICE              S99528 14770000
PARMREG0 EQU   0                  PARAMETER REG 0                S99528 14840000
PARMREG1 EQU   1                  PARAMETER REG 1                S99528 14910000
X80      EQU   X'80'              MASK FIELD                     S99528 14980000
X40      EQU   X'40'              MASK FIELD                     S99528 15050000
D24      EQU   24                 DISP OF 24                     S99528 15120000
D32      EQU   32                 DISP OF 32                     S99528 15190000
D40      EQU   40                 DISP OF 40                     S99528 15260000
TWO      EQU   2                  DISP OF TWO                           15330000
FOUR     EQU   4                  DISP OF FOUR                          15400000
ACTRTCD  EQU   X'08'              INV. LIST INIT ACTIVE                 15470000
TERMACTV EQU   X'46'              OP CONTROL ACTIVATE VERB CODE         15540000
XFF      EQU   X'FF'              MASK FIELD                            15610000
TDLIM    EQU   10                 MAXIMUM TEST DEVICE ENTRIES           15680000
BLANK    EQU   X'40'              BLANK SPACE                           15750000
         SPACE 2                                                        15820000
         SAVE  (14,12)            SAVE CALLER'S REG              S99528 15890000
         LR    R6,R15                   LOAD BASE                       15960000
         DROP  R15                                                      16030000
         USING IEDQWJ,R6                                                16100000
         USING TOTOLTCB,R2                                              16170000
         LA    R3,TOTSAVE4        SAVE AREA ADDR                 S99528 16240000
         ST    R3,D8(R13)         STORE IN CALLER'S SAVE         S22024 16310000
         ST    R13,D4(R3)         SAVE CALLER'S                  S22024 16380000
         LR    R13,R3                   SET R13 TO SAVE AREA            16450000
         L     R10,ACVT(R0)       CVT ADDR                       S22024 16520000
         USING CVT,R10                                                  16590000
         L     R3,AVTCVTPT(R10)        PICK UP TCAM DISP ADDR           16660000
         L     R4,CVTILK2              PICK UP 2 BYTE UCB POINTER       16730000
         ST    R4,UCBSAVE              SAVE IT                          16800000
         DROP  R10                                                      16870000
         L     R10,D0(R3)         AVT ADDR                       S22024 16940000
         USING IEDQAVTD,R10                                             17010000
         L     R3,AVTRNMPT             PICK UP ADDR OF TERMNAME TABLE   17080000
         ST    R3,TERNMTAB             SAVE IT                          17150000
         USING IEDQTNTD,R3                                              17220000
         IC    R4,TNTENLEN             PICK UP ENTRY LENGTH             17290000
         STC   R4,TERNMLEN             SAVE IT                          17360000
         DROP  R3                                                       17430000
         MVC   PAREMLST(D1),AVTBSX SET UP FOR BINARY SEARCH      S99528 17500000
         L     R3,AVTMSGS-D1      GET VCON TABLE ADDR            S99528 17570000
         L     R3,D8(R3)          ADDR OF A1 ROUTINE             S99528 17640000
         ST    R3,AVTUISV                                               17710000
         LA    R3,AVTOPCOB             PICK UP OP CONTROL QCB ADDR      17780000
         DROP  R10                                                      17850000
         ST    R3,OCQCB                SAVE IT                          17920000
         SR    R4,R4                                                    17990000
         ICM   R4,ADUCBMSK,TOTCTUCB GET CT UCB ADDR            @G36XRUV 18060010
         USING UCB,R4                                                   18130000
         CLI   UCBTBYT1,A1060     1060 EQU CT                    S22024 18200000
         DROP  R4                                                       18270000
*                                                                       18340000
*                                                                       18410000
*                                                                       18480000
         BNE   PMT090             NO                             S99528 18550000
         IEDQMSG MSGID=091,FUNCT=CEC,LINK=YES NO PROMPTING ON 106099528 18620000
         B     GETOUT               & ABORT                             18690000
PMT090   EQU   *                                                        18760000
         TM    TOTFLG03,TOTTDFER  ENTRY FROM TD ERROR            S99528 18830000
         BO    TDROUT                  YES BRANCH                       18900000
         TM    TOTFLG03,TOTTSTER  ENTRY FROM TEST ERRROR         S99528 18970000
         BO    TROUT                   YES BRANCH                       19040000
         TM    TOTFLG03,TOTOPTER  ENTRY FROM OPTION ERROR        S99528 19110000
         BO    OPTROUT                 YES BRANCH                       19180000
         TM    TOTFLG03,TOTAPOER  AP OPTION ERROR                S99528 19250000
         BO    OPTROUT            YES - BRANCH                          19320000
*                                                                       19390000
*                                                                       19460000
*              CALL FROM TRM PROMPT REQUEST                             19530000
*                                                                       19600000
*                                                                       19670000
START    EQU   *                                                        19740000
         IEDQMSG MSGID=090,FUNCT=CEC TRM PROMPTER RUNNING        S99528 19810000
TDSTART  EQU   *                                                        19880000
         NI    TOTFLG06,XFF-TOTNCMFG CLEAR NCM FLAG              S99528 19950000
         LA    R3,TOTTRMBF        POINT TO TRM BUFFER            S99528 20020000
         ST    R3,TRMSAVE                                               20090000
         MVC   TRMWRK,D0(R3)      TRM TO WORK AREA               S22024 20160000
         LA    R4,TRMWRK               SET POINTER                      20230000
*                                                                       20300000
*              FIND TEST DEVICE FIELD                                   20370000
*                                                                       20440000
FLDFIND  CLI   0(R4),C'/'              END OF CT FIELD?                 20510000
         BE    TDFLD                   YES BRANCH                       20580000
         LA    R4,D1(R4)          BUMP POINTER                   S22024 20650000
         B     FLDFIND                 GO LOOK AGAIN                    20720000
TDFLD    EQU   *                                                 S22024 20790000
         LA    R4,D1(R4)          POINT PASS SLASH               S22024 20860000
         NI    TDFLG,XFF-SYM      CLEAR SYMBOLIC ENTRY FLAG      S22024 20930000
         NI    TOTFLG10,XFF-TOTTERMS CLEAR TERMINAL TD FLAG      S22024 21000000
         B     TESTDEV            GO EXAMINE TEST DEVICE FIELD   S99528 21070000
TDROUT   EQU   *                                                        21140000
         IEDQMSG MSGID=089,FUNCT=CEC ERROR IN TEST DEVICE FIELD  S99528 21210000
         BAL   R9,PRMCONT         GO SEE IF CE WANTS PROMPTING   S99528 21280000
*                                   CONTINUED                    S99528 21350000
         XC    TOTTDTBL(D40),TOTTDTBL CLEAR DEVICE TABLE         S99528 21420000
         NI    TOTFLG03,XFF-TOTOPTER CLEAR OPTION ERR FLAG      SA41606 21490000
         NI    TOTFLG03,XFF-TOTAPOER CLEAR AP OPTION ERR FLAG   SA41606 21560000
         B     TDSTART            CONTINUE PROCESSING            S99528 21630000
TROUT    EQU   *                                                        21700000
         IEDQMSG MSGID=088,FUNCT=CEC ERROR IN TEST FIELD                21770000
         BAL   R9,PRMCONT         CONTINUE PROMPTING ?           S99528 21840000
         B     TDDONE1            NO - EXIT                      S99528 21910000
OPTROUT  EQU   *                                                        21980000
         IEDQMSG MSGID=087,FUNCT=CEC ERROR IN OPTION FIELD       S99528 22050000
         BAL   R9,PRMCONT         CONTINUE PROMPTING ?           S99528 22120000
         B     TDDONE1            EXIT TO QWJ1                          22190000
TESTDEV  EQU   *                                                        22260000
*                                                                       22330000
*        R4 POINTS TO TEST DEVICE FIELD IN TRM WORK                     22400000
*                                                                       22470000
         LA    R7,ONE             INCREMENT VALUE                S22024 22540000
         A     R7,NUMBER                                                22610000
         ST    R7,NUMBER                                                22680000
         LA    R7,TDLIM           SET COMPARAND LIMIT                   22750000
         C     R7,NUMBER               IS NUMBER GT 9?                  22820000
         BNL   TD1                     NO BRANCH                        22890000
         B     TDERR                   YES GO TO ERROR ROUTINE          22960000
TD1      EQU   *                                                        23030000
         NI    TDFLG,XFF-RNTERM-RNLINE CLEAR INTERMEDIATE FLAGS  S22024 23100000
*        ENTER NEXT TEST DEVICE                                  S99528 23170000
         IEDQMSG MSGID=085,FUNCT=REP,INBUF=CEIN,INCNT=8          S99528 23240000
         CLI   CEIN,BLANK         ANY REPLY                      S22024 23310000
         BE    TDERR1               NO                                  23380000
         BAL   R9,TYPECHK         DETERMINE TYPE OF TEST         S22024 23450000
         TM    TDFLG,RNTERM+RNLINE+SYM SYMBOLIC ENTRY            S22024 23520000
         BM    TDSYM              YES                            S22024 23590000
         CLI   CEIN,NUMER               IS FIRST CHAR A ZERO?  @YA12402 23660000
         BNE   DIGIT3                   NO                     @YA12402 23730000
         CLI   CEIN+D3,BLANK            IS 4TH CHAR BLANK?     @YA12402 23800000
         BE    DIGIT3                   YES                    @YA12402 23870000
         MVC   WORK1(D3),CEIN+D1        MOVE CUU TO WORK AREA  @YA12402 23940000
         CLI   CEIN+D4,BLANK            END OF ENTRY?          @YA12402 24010000
         BNE   TDERR1                   NO - ERROR             @YA12402 24080000
         B     FINDUCB                  GO FIND UCB ADDR       @YA12402 24150000
         SPACE 2                                               @YA12402 24220000
DIGIT3   EQU   *                                               @YA12402 24290000
         MVC   WORK1(D3),CEIN     MOVE CUU TO WORK AREA          S22024 24360000
         CLI   CEIN+D3,BLANK      END OF ENTRY ?                        24430000
         BNE   TDERR1             NO - ERROR                            24500000
FINDUCB  EQU   *                                               @YA12402 24570000
         BAL   R9,UCBLOOK              GO CHECK UCB ENTRY               24640000
         B     CUUOK                   BRANCH AROUND ERROR RETURN       24710000
         B     TDERR1                  CUU CANNOT BE FOUND              24780000
CUUOK    EQU   *                                                        24850000
         BAL   R9,PLUG                 GO PLUG LINE ADDR TABLE          24920000
         CLI   CEIN,NUMER               IS FIRST CHAR A ZERO?  @YA12402 24990000
         BNE   MOVE3                    NO                     @YA12402 25060000
         CLI   CEIN+D3,BLANK            IS 4TH CHAR BLANK?     @YA12402 25130000
         BE    MOVE3                    YES                    @YA12402 25200000
         MVC   D0(D4,R4),CEIN           GET CUU                @YA12402 25270000
         LA    R4,D4(R4)                BUMP TRM PTR           @YA12402 25340000
         B     ASKAGN1                  GO ASK AGAIN           @YA12402 25410000
         SPACE 2                                               @YA12402 25480000
MOVE3    EQU   *                                               @YA12402 25550000
         MVC   D0(D3,R4),WORK1    MOVE CUU TO TRM WORK AREA      S22024 25620000
         LA    R4,D3(R4)          BUMP TRM POINTER               S22024 25690000
ASKAGN1  EQU   *                                                        25760000
         IEDQMSG MSGID=084,FUNCT=REP,INBUF=CEIN,INCNT=8 MORE TD  S99528 25830000
         SPACE 2                                                        25900000
*                                                                       25970000
ASKAGN2  EQU   *                                                        26040000
*                                                                       26110000
         SPACE                                                          26180000
         CLI   CEIN,YES           YES - MORE ENTRIES             S22024 26250000
         BE    YESMORE            YES                            S99528 26320000
         CLI   CEIN,NO            NO                             S22024 26390000
         BE    NOMORE             NO                             S99528 26460000
         IEDQMSG MSGID=083,FUNCT=REP,INBUF=CEIN,INCNT=8 MORE TD  S99528 26530000
         SPACE                                                          26600000
         B     ASKAGN2            CHECK RESPONSE                        26670000
YESMORE  EQU   *                                                 S22024 26740000
         MVI   D0(R4),COMMA       INSERT COMMA                   S22024 26810000
         LA    R4,D1(R4)          BUMP TRM POINTER               S22024 26880000
         B     TESTDEV            GET NEXT DEVICE                S99528 26950000
NOMORE   EQU   *                                                        27020000
         MVI   D0(R4),SLASH       CLOSE FIELD                    S22024 27090000
         LA    R4,D1(R4)          BUMP TRM POINTER               S22024 27160000
         B     TDDONE             EXIT TO IEDQWJ1                       27230000
TDERR    EQU   *                                                        27300000
         IEDQMSG MSGID=082,FUNCT=CEC ALREADY HAVE 10 TEST DEV    S22024 27370000
         BCTR  R4,D0              POINT TO PLACE TO CLOSE FLIED  S99528 27440000
         MVI   D0(R4),SLASH       CLOSE FIELD                    S22024 27510000
         LA    R4,1(R4)                POINT BACK TO NEXT FIELD         27580000
         B     TDDONE             EXIT TO IEDQWJ1                S99528 27650000
TDERR1   EQU   *                                                        27720000
         CLI   NUMBER+D3,ONE      ERROR ON FIRST PASS           SA41608 27790000
         BNE   TDERR2A            NO                            SA41608 27860000
         NI    TDFLG,XFF-SYM-LINE CLEAR CONTROL FLAGS            S22024 27930000
TDERR2A  EQU   *                                                SA41608 28000000
         IEDQMSG MSGID=081,FUNCT=CEC INVALID TEST DEVICE ENTRY   S99528 28070000
TDERR3   EQU   *                                                 S22024 28140000
         SPACE                                                          28210000
         IEDQMSG MSGID=057,FUNCT=REP,INBUF=CEIN,INCNT=8 CONTIN P S22024 28280000
         CLI   CEIN,YES           YES                            S22024 28350000
         BE    TD1                     YES BRANCH                       28420000
         CLI   CEIN,NO            NO                             S22024 28490000
         BE    GETOUT                  YES BRANCH                       28560000
         IEDQMSG MSGID=079,FUNCT=CEC INVALID RESPONSE            S99528 28630000
         SPACE                                                          28700000
         B     TDERR1             CONTINUE?                      S22024 28770000
GETOUT1  DS    0H                                              @G36XRUV 28790010
         IEDQMSG MSGID=094,FUNCT=CEC                           @G36XRUV 28810010
GETOUT   EQU   *                                                        28840000
         OI    TOTFLG06,TOTOTERM  SET TERMINATE FLAG             S22024 28910000
         L     R13,4(R13)              PICK UP CALLERS SAVE             28980000
         LM    R14,R1,12(R13)          RESTORE REGS                     29050000
         XCTL  (2,12),EP=IEDQWE                                         29120000
TDSYM    EQU   *                                                        29190000
         LA    R10,CEIN                                                 29260000
         LA    R5,D8              SET LIMIT                      S22024 29330000
         LA    R3,D0              COUNTER                        S22024 29400000
TDSYM3   EQU   *                                                        29470000
         CLI   D0(R10),BLANK      END OF NAME                    S22024 29540000
         BE    TDSYM1                  YES BRANCH                       29610000
         LA    R10,D1(R10)        BUMP POINTER                   S22024 29680000
         LA    R3,D1(R3)          BUMP COUNTER                   S22024 29750000
         CR    R3,R5                   HAVE I LOOKED AT 8 POSITIONS     29820000
         BE    TDSYM1                  YES BRANCH                       29890000
         B     TDSYM3                  NO LOOK AGAIN                    29960000
TDSYM1   EQU   *                                                        30030000
         MVI   WORK1,BLANK        PAD WORK AREA                  S22024 30100000
         MVC   WORK1+1(D7),WORK1  WITH BLANKS                    S22024 30170000
         STC   R3,LENGTH               SET UP BINARY SEARCH             30240000
         LA    R14,TRMWRK+D72     SET LIMIT                      S22024 30310000
         LR    R15,R4             CURRENT TRM SETTING            S22024 30380000
         AR    R15,R3             NEW SETTING                    S22024 30450000
         CR    R15,R14            ENTRY TOO LONG                 S22024 30520000
         BNL   TOOLONG            YES - ERROR                    S22024 30590000
         BCTR  R3,R0              DECREMENT FOR MOVE             S22024 30660000
         EX    R3,MOVE                 MOVE NAME TO WORK AREA           30730000
         B     TDSYM4             VERIFY NAME                    S99528 30800000
MOVE     MVC   WORK1(D0),CEIN     GET SYMBOLIC NAME              S22024 30870000
TDSYM4   BAL   R9,NAMESRCH             GO FIND NAME IN TCAM             30940000
         B     TDSYM5                  BRANCH AROUND ERROR RETURN       31010000
         B     TDERR1             ERROR                          S99528 31080000
TDSYM5   EQU   *                                                        31150000
         EX    R3,MOVE1                MOVE NAME TO TRMWRK              31220000
         LA    R4,D1(R3,R4)       BUMP TRM POINTER               S22024 31290000
         BAL   R9,UCBFIND         GO GET UCB                            31360000
         BAL   R9,PLUG            PUT LINE ADDRESS IN TABLE             31430000
         B     ASKAGN1              NO                           S22024 31500000
MOVE1    MVC   D0(D0,R4),CEIN     MOVE ENTRY TO TRM              S22024 31570000
TDDONE   EQU   *                                                        31640000
         L     R4,TRMSAVE              GET ADDR OF TRM BUFFER           31710000
         MVC   D0(TRMLEN,R4),TRMWRK MOVE MESSAGE BACK TO BUFFER  S22024 31780000
TDDONE1  EQU   *                                                        31850000
         BAL   R11,LINECHK        VERIFY THAT TEST LINES OPENED  S99528 31920000
         BAL   R3,TERMSTAT        CHECK INIT STATUS OF TEST DEVICES     31990000
*                                                               SA41608 32060000
         L     R13,D4(R13)        GET CALLER'S SAVE AREA ADDR           32130000
*        LINE OR TERMINAL. LOCATION 'CEIN' POINTS TO THE       * S22024 32200000
         LM    R14,R1,D12(R13)    RESTORE REG                    S22024 32270000
         XCTL  (2,12),EP=IEDQWJ1                                        32340000
         EJECT                                                          32410000
TOOLONG  DS    0H                 BOUNDARY ALLIGNMENT            S22024 32480000
         IEDQMSG MSGID=060,FUNCT=CEC ENTRY TOO LONG              S22024 32550000
         SPACE                                                          32620000
         B     GETOUT             TERMINATE PROMPT               S22024 32690000
         EJECT                                                          32760000
PRMCONT  EQU   *                                                        32830000
         ST    R9,REGSAVE              SAVE R9                          32900000
PRMCON1  EQU   *                                                 S99528 32970000
         IEDQMSG MSGID=076,FUNCT=REP,INBUF=CEIN,INCNT=8 PROMPTED S22024 33040000
         CLI   CEIN,YES           YES                            S22024 33110000
         BE    PRMCONT1                YES BRANCH                       33180000
         CLI   CEIN,NO            NO                             S22024 33250000
         BE    GETOUT                  YES BRANCH                       33320000
         IEDQMSG MSGID=079,FUNCT=CEC INVALID RESPONSE            S99528 33390000
         SPACE                                                          33460000
         B     PRMCON1            CONTINUE PROMPTING?            S99528 33530000
         SPACE                                                          33600000
PRMCONT1 EQU   *                                                        33670000
         L     R9,REGSAVE              RESTORE R9                       33740000
         BR    R9                      RETURN                           33810000
         EJECT                                                          33880000
**************************************************************** S22024 33950000
*                                                              * S22024 34020000
*        ROUTINE TO DETERMINE THE TYPE OF TEST TO BE RUN --    * S22024 34090000
*        TEST DEVICE ENTRY.                                    * S22024 34160000
*                                                              * S22024 34230000
**************************************************************** S22024 34300000
TYPECHK  STM   R7,R11,SAVE        SAVE CALLER'S REG              S22024 34370000
         LA    R7,D0              ZERO TTE ADDR                  S22024 34440000
         LA    R10,CEIN           INPUT BUFFER                   S22024 34510000
         TM    D0(R10),NUMER      LINE TEST                      S22024 34580000
         BO    TYPELINE           YES                            S22024 34650000
*                                                              * S22024 34720000
*        FIND LENGTH OF TEST DEVICE ENTRY                      * S22024 34790000
*                                                              * S22024 34860000
         MVC   WORK2(D9),D0(R10)  MOVE ENTRY TO WORK AREA        S22024 34930000
         LA    R7,D9              LOOP COUNT                     S22024 35000000
         LA    R8,D0              COUNTER                        S22024 35070000
         LA    R9,WORK2           WORK AREA                      S22024 35140000
TYPELP   EQU   *                                                 S22024 35210000
         CLI   D0(R9),BLANK       END OF FIELD                   S22024 35280000
         BE    TYPEFD             YES                            S22024 35350000
         LA    R9,D1(R9)          NEXT CHAR                      S22024 35420000
         LA    R8,D1(R8)          INCREMENT COUNTER              S22024 35490000
         BCT   R7,TYPELP          NEXT TEST                      S22024 35560000
         B     TDERR1             ERROR - NAME TOO LONG          S22024 35630000
         SPACE                                                          35700000
TYPEFD   EQU   *                                                 S22024 35770000
         LTR   R8,R8              TD ENTRY BLANK                 S22024 35840000
         BZ    TDERR              YES - ERROR                    S22024 35910000
         STC   R8,LENGTH          LENGTH OF ENTRY TO PLIST       S22024 35980000
         BCTR  R8,R0              LENGTH MINUS 1                 S22024 36050000
         MVC   WORK1(D8),XBLANK   BLANK NAME FIELD               S22024 36120000
         EX    R8,TDEVICE         NAME TO PLIST                  S22024 36190000
         SPACE                                                          36260000
         BAL   R9,NAMESRCH        VERIFY SYMBOLIC NAME           S22024 36330000
         B     TYPRN              NORMAL RETURN                  S22024 36400000
         B     TDERR1             ERROR RETURN                   S22024 36470000
         SPACE                                                          36540000
TYPRN    EQU   *                                                        36610000
         L     R7,TNTENTRY        TTE ADDR                       S22024 36680000
         USING IEDNTRM,R7                                        S22024 36750000
         LA    R9,TRMPRFSZ        GET TTE PREFIX SIZE          @Y17XAUU 36820000
         SLR   R7,R9              POINT TO TTE PREFIX          @Y17XAUU 36890000
         TM    TRMSTATE,TRMPROC   VERIFY NOT PROCESS ENTRY     @Y17XAUU 36960000
         BNZ   TYPETERM           BR, NOT 3705 RESOURCE        @Y17XAUU 37030000
         TM    TRMSTATE,TRMPREF   3705 RESOURCE                @Y17XAUU 37100000
         BZ    TYPETERM           NO                             S22024 37170000
         CLI   TRMTYPE,TRMPUNT    PU ENTRY                     @Y17XAUU 37240000
         BE    TDERR1             YES - ERROR                  @Y17XAUU 37310000
         CLI   TRMTYPE,TRMLNCP    NCP ENTRY                    @Y17XAUU 37380000
         BE    TDERR1             YES - ERROR                  @Y17XAUU 37450000
         CLI   TRMTYPE,TRMSSCP    SSCP ENTRY                   @Y17XAUU 37520000
         BE    TDERR1             YES - ERROR                  @Y17XAUU 37590000
         CLI   TRMTYPE,TRMSDLC    SNA LINE ENTRY               @Y17XAUU 37660000
         BE    TYPELINE           YES - PROCESS                @Y17XAUU 37730000
         CLI   TRMTYPE,TRMNSDLC   PRE SNA LINE ENTRY           @Y17XAUU 37800000
         BE    TYPELINE           YES - PROCESS                @Y17XAUU 37870000
         TM    TRMSTATE,XE0       RN TERMINAL                    S22024 37940000
         BZ    TYPETERM           YES                            S22024 38010000
         B     TDERR1             ERROR EXIT                     S22024 38080000
         SPACE                                                          38150000
TYPETERM EQU   *                                                 S22024 38220000
         TM    TDFLG,LINE         LINE FLAG SET                  S22024 38290000
         BO    TDERR1             ERROR - MIXED TD               S22024 38360000
         OI    TDFLG,SYM          SHOW TERMINAL TEST             S22024 38430000
         TM    TRMSTATE,TRMPREF   3705 MODE                    @Y17XAUU 38500000
         BO    TERM0              YES - BYPASS CHECK             S22024 38570000
         TM    TRMSTATE,XE0       TERMINAL ENTRY                 S22024 38640000
         BNZ   TDERR1             NO - ERROR                            38710000
TERM0    DS    0H                 BOUNDARY ALLIGNMENT            S22024 38780000
         TM    TRMSTATE,TRMPREF   3705 MODE                    @Y17XAUU 38850000
         BZ    TERM4              BRANCH                         S22024 38920000
         OI    TDFLG,RNTERM       YES - SET FLAG                 S22024 38990000
TERM4    EQU   *                                                 S22024 39060000
         LM    R7,R11,SAVE        RESTORE REG                    S22024 39130000
         BR    R9                 RETURN                         S22024 39200000
         SPACE                                                          39270000
TYPELINE EQU   *                                                 S22024 39340000
         TM    TDFLG,SYM          TERMINAL FLAG SET              S22024 39410000
         BO    TDERR1             ERROR MIXED TEST DEV           S22024 39480000
         OI    TDFLG,LINE         SHOW LINE TEST                 S22024 39550000
         LTR   R7,R7              TTE ADDR PRESENT               S22024 39620000
         BZ    TERM4              NO - EXIT                      S22024 39690000
         TM    TRMSTATE,TRMPREF   3705 MODE                    @Y17XAUU 39760000
         BZ    TERM4              NO                             S22024 39830000
         OI    TDFLG,RNLINE       YES - SET FLAG                 S22024 39900000
TERM8    EQU   *                                                 S22024 39970000
         B     TERM4              RETURN                         S22024 40040000
         DROP  R7                                                S22024 40110000
TDEVICE  MVC   WORK1(D0),WORK2    GET DEVICE ENTRY               S22024 40180000
         EJECT                                                          40250000
*                                                                       40320000
*                                                                       40390000
*        ROUTINE TO FIND UCB ADDR AFTER ENTRY IN TERMINAL TABLE HAS     40460000
*             BEEN FOUND                                                40530000
*                                                                       40600000
*                                                                       40670000
UCBFIND  EQU   *                                                        40740000
         L     R8,TNTENTRY             R8 NOW HAS ADDR OF TERM TAB ENT  40810000
         USING IEDQTRM,R8                                               40880000
         L R8,TRMDESTQ-D1         QCB ADDR                       S22024 40950000
         DROP  R8                                                       41020000
         USING IEDQQCB,R8                                               41090000
         SR    R7,R7                   GET RELATIVE                     41160000
         IC    R7,QCBRELLN          RELATIVE LINE NUMBER                41230000
         SLL   R7,D2              MULT BY 4                      S22024 41300000
         L     R8,QCBDCBAD-D1     DCB ADDR                       S22024 41370000
         DROP  R8                                                       41440000
         USING IHADCB,R8                                                41510000
         TM    DCBDSORG,LGBA      LGB VS. DCB                    S22024 41580000
         BZ    UCB0X              NO                             S22024 41650000
         L     R1,TNTENTRY        GET TERMINAL TTE ADDRESS     @Y17XAUU 41720000
         BAL   R14,NCPTTE         GET NCP TTE ADDRESS          @Y17XAUU 41790000
*                                                              @Y17XAUU 41860000
*        ON RETURN R1 CONTAINS ADDRESS OF NCP TTE PREFIX       @Y17XAUU 41930000
*                                                              @Y17XAUU 42000000
         USING IEDNTRM,R1         SET TTE ADDRESSABILITY       @Y17XAUU 42070000
         TM    TRMBYTE2,TRMRSACT  3705 ACTIVE                  @Y17XAUU 42140000
         BZ    UCB0X1             NO                           @Y17XAUU 42210000
         TM    TRMBYTE2,TRMINPG   ACT/DEACT IN PROGRESS        @Y17XAUU 42280000
         BO    UCB0X1             YES - ERROR                  @Y17XAUU 42350000
         ST    R1,NCPSAVE         SAVE NCP TTE ADDRESS         @Y17XAUU 42420000
         L     R1,TRMDESTQ-D1     GET QCB ADDRESS              @Y17XAUU 42490000
         DROP  R1                                              @Y17XAUU 42560000
         USING IEDQQCB,R1         SET QCB ADDRESSABILITY       @Y17XAUU 42630000
         L     R8,QCBDCBAD-D1     GET 3705 DCB ADDRESS         @Y17XAUU 42700000
         DROP  R1                                              @Y17XAUU 42770000
         ST    R8,DCBSAVE         SAVE 3705 DCB ADDRESS        @Y17XAUU 42840000
         LA    R7,D4              SET RLN EQU 1                  S22024 42910000
         B     UCB0X              CHECK FOR DCB OPEN           @Y17XAUU 42980000
UCB0X1   EQU   *                                               @Y17XAUU 43050000
         IC    R7,LENGTH          LENGTH OF INVALID ENTRY        S22024 43120000
         SR    R4,R7              RESET TRM POINTER              S22024 43190000
         NI    TDFLG,XFF-RNTERM-RNLINE CLEAR INTERMEDIATE FLAGS  S22024 43260000
         IEDQMSG MSGID=010,FUNCT=CEC MSG                         S22024 43330000
         B     TDERR2A            ERROR EXIT                     S22024 43400000
UCB0X    EQU   *                                                 S22024 43470000
         TM    DCBOFLGS,OPEN      DCB OPEN                       S22024 43540000
         BZ    NOOPEN                  NO BRANCH                        43610000
         L     R8,DCBDEBAD        GET DEB ADDRESS                       43680000
         DROP  R8                                                       43750000
         USING DEBNMSUB,R8                                              43820000
         SR    R15,R15                                                  43890000
         IC    R15,DEBNMEXT       GET NUMBER OF EXTENTS                 43960000
         SLL   R15,D2             MULT BY 4                             44030000
         CR    R15,R7             IS DESIRED LINE OPENED?               44100000
         BL    NOOPEN               NO                                  44170000
         L     R8,DEBUCBAD-D4(R7) UCB ADDR                       S22024 44240000
         USING UCB,R8                                                   44310000
         MVC   WORK1(D3),UCBNAME  UCB ID IN EBCDIC               S22024 44380000
         MVC   WORK2(D2),UCBCHA   UCB ID IN HEX                  S22024 44450000
         CLI   UCBTBYT3,UCB3COMM  COMMUNICATION DEVICE           S05331 44520000
         BNE   UCB08              NO - BYPASS SWT CHECK          S05331 44590000
         TM    UCBTBYT2,SWITCHS   SWITCHED START/STOP            S05331 44660000
         BNZ   UCB04              YES                            S05331 44730000
         MVN   WORKAREA(D1),UCBTBYT1 IS TERMINAL                 S05331 44800000
         MVZ   WORKAREA(D1),UCBTBYT4 SWITCHED                    S05331 44870000
         XI    WORKAREA,SWITCHB      BI-SYNC                     S05331 44940000
         BNZ   UCB08              NO                             S05331 45010000
UCB04    DS    0H                 BOUNDARY ALLIGNMENT            S05331 45080000
         OI    TOTFLG04,TOTTTSWT  SET SWITCHED TD FLAG           S05331 45150000
         OI    TOTFLG06,TOTNCMFG  SET NCM OPTION                 S05331 45220000
UCB08    DS    0H                 BOUNDARY ALLIGNMENT            S05331 45290000
         DROP  R8                                                       45360000
         MVI   WORK2+D2,D0        CLEAR UNUSED BYTE              S22024 45430000
         NI    WORK2,X0F          CLEAR UNWANTED BITS            S22024 45500000
         BR    R9                      RETURN                           45570000
NOOPEN   EQU   *                                                        45640000
         SR    R4,R3                   REMOVE CURRENT                   45710000
         BCTR  R4,R0              DEVICE FROM                    S22024 45780000
         EX    R3,CLEAR                  WORK AREA                      45850000
         IEDQMSG MSGID=038,FUNCT=CEC TEST LINE NOT OPENED        S99528 45920000
         B     TDERR3             ERROR                          S22024 45990000
*                                                                       46060000
CLEAR    XC    D0(D0,R4),D0(R4)   CLEAR WORK AREA                S22024 46130000
*                                                                       46200000
         EJECT                                                          46270000
*              ROUTINE TO SEARCH TERMNAME TABLE. R3 HAS ADDR OF         46340000
*              START OF TABLE. WORK1 HAS NAME IN IT. R2 HAS LENGTH      46410000
*                                                                       46480000
NAMESRCH EQU   *                                                        46550000
         LA    R1,PAREMLST              SET R1                          46620000
         L     R15,AVTUISV                                              46690000
         LH    R0,TWO(R1)         LOAD CHAR STRING LEN           S99528 46760000
         L     R1,FOUR(R1)        LOAD ADDR OF CHARS             S99528 46830000
         BAL   R14,FOUR(R15)      BRANCH TO SCAN ROUTINE         S99528 46900000
         LTR   R15,R15                                                  46970000
         BZ    D4(R9)             NAME NOT FOUND                 S22024 47040000
         SPACE                                                          47110000
         STM   R7,R9,TRMSAV1      SAVE REG 7-9                          47180000
         L     R8,TERNMTAB        SET START OF TABLE                    47250000
         USING IEDQTNTD,R8                                              47320000
         LA    R7,TNTFIRST        POINT TO FIRST ENTRY IN TABLE         47390000
         SR    R9,R9              CLEAR REG 9                           47460000
         IC    R9,TNTENLEN        GET MAX. LENGTH OF NAME FIELD         47530000
         LA    R9,D3(R9)          GET LENGTH OF 1 ENTRY          S22024 47600000
         DROP  R8                                                       47670000
         BCTR  R15,R0             DECREMENT ENTRY REL. POSITION  S22024 47740000
         MR    R8,R15             GETDISP. TO ENTRY DESIRED             47810000
         AR    R7,R9              GET DESIRED TNT ADDRESS               47880000
         ST    R7,TRMTNT          SAVE IT                               47950000
         LA    R1,D1(R15)         RESTORE ENTRY REL. POSITION    S22024 48020000
         LM    R7,R9,TRMSAV1      RESTORE REG 7-9                       48090000
         SPACE                                                          48160000
         SPACE                                                          48230000
         L     R15,TERNMTAB                                             48300000
         BALR  R14,R15            GET TERMINAL ENTRY ADDR        S99528 48370000
         ST    R1,TNTENTRY                                              48440000
         USING IEDQTRM,R1                                        S22024 48510000
         TM    TRMDSORG,TRMLGB    LGB RATHER THAN A TTE          S22024 48580000
         BO    D4(R9)             YES - ERROR - NOT A TERMINAL   S22024 48650000
         L     R1,TRMDESTQ-D1     DEST. QCB ADDR                 S22024 48720000
         DROP  R1                                                S22024 48790000
         USING IEDQQCB,R1                                        S22024 48860000
         LA    R1,D0(R1)            CLEAR HI ORDER BYTE          S22024 48930000
         TM    QCBFLAG,QCBTSSES   TSO TERMINAL                  SA61759 49000000
         BO    TRMTSO             YES - ERROR EXIT               S22024 49070000
         BR    R9                 RETURN                         S99528 49140000
         SPACE                                                          49210000
TRMTSO   DS    0H                 BOUNDARY ALLIGNMENT            S22024 49280000
         IEDQMSG MSGID=011,FUNCT=CEC TSO TEST DEVICE             S22024 49350000
         B     GETOUT             TERMINATE TRM                  S22024 49420000
         EJECT                                                          49490000
LINECHK  EQU   *                                                        49560000
*                                                                       49630000
         LA    R4,TOTTDTBL        TEST DEVICE TABLE                     49700000
         LA    R7,TOTTDEND        END OF TABLE                          49770000
ALLTEST  EQU   *                                                        49840000
         CR    R4,R7              ALL ENTRIES PROCESSED                 49910000
         BE    D0(R11)            YES - EXIT                     S22024 49980000
         TM    D0(R4),TOTTDLIN+TOTTDORN RN LINE TEST             S22024 50050000
         BO    D0(R11)            YES - BYPASS CHECK             S22024 50120000
         TM    D0(R4),TOTTDLIN    270X LINE TEST                 S22024 50190000
         BZ    D0(R11)            NO - RETURN                    S22024 50260000
         L     R8,ZERO(R4)        GET ADDR FROM TABLE                   50330000
         LA    R8,ZERO(R8)        CLEAR HI ORDER BYTE                   50400000
         STH   R8,KUCB            SAVE UCB ADDR                         50470000
         LTR   R8,R8              IS THERE AN ADDRESS                   50540000
         BZ    D0(R11)            NO - RETURN                    S22024 50610000
         LA    R9,CVTPTR          POINTER TO CVT                        50680000
         L     R9,ZERO(R9)        CVT ADDR                              50750000
         L     R9,ZERO(R9)        TCB ADDR                              50820000
         L     R9,FOUR(R9)        CURRENT TCB ADDR                      50890000
         L     R9,TWELVE(R9)      TIOT ADDR                             50960000
         USING TIOT,R9                                                  51030000
         LA    R9,TIOENTRY        FIRST ENTRY                           51100000
         DROP  R9                                                       51170000
         USING TIOENTRY,R9                                              51240000
GETLENGT EQU   *                                                        51310000
         SR    R3,R3              CLEAR REG 3                           51380000
         IC    R3,TIOELNGH        DD ENTRY LENGTH                       51450000
         LTR   R3,R3              ANY LENGTH ?                          51520000
         BZ    NOTFOUND           NO - ERROR                            51590000
         LA    R5,POOLSTAR-TIOESTTB DEV ENTRY LENGTH                    51660000
         DROP  R9                                                       51730000
         LR    R10,R3             SAVE LENGTH                           51800000
         SR    R3,R5              DD LENGTH - 4                         51870000
         AR    R3,R9              DEVICE                                51940000
         USING TIOESTTB,R3                                              52010000
         CLC   TIOEFSRT+ONE(TWO),KUCB UCB ENTRY FOUND ?                 52080000
         DROP  R3                                                       52150000
         BE    FOUND              ENTRY FOUND                           52220000
         AR    R9,R10             POINT TO NEXT ENTRY                   52290000
         B     GETLENGT           CONTINUE LOOKING                      52360000
FOUND    EQU   *                                                        52430000
         LA    R4,FOUR(R4)        POINT TO NEXT LINE                    52500000
         B     ALLTEST            GO SEE IF ALL ENTRIES HAVE BEENS99528 52570000
*                                   PROCESSED                    S99528 52640000
NOTFOUND EQU   *                                                        52710000
         IEDQMSG MSGID=052,FUNCT=CEC                                    52780000
*                                                                       52850000
         IEDQMSG MSGID=081,FUNCT=CEC ERROR IN TEST DEV FIELD     S22024 52920000
*                                                                       52990000
PRMEND   EQU   *                                                 S22024 53060000
         IEDQMSG MSGID=057,FUNCT=REP,INBUF=CEIN,INCNT=8 CONTIN P S22024 53130000
         CLI   CEIN,YES           YES                            S22024 53200000
         BE    PRMEND1            YES - BRANCH                   S22024 53270000
         CLI   CEIN,NO            NO                             S22024 53340000
         BE    GETOUT             YES - BRANCH                   S22024 53410000
         IEDQMSG MSGID=079,FUNCT=CEC INVALID RESPONSE            S22024 53480000
         B     PRMEND             ASK AGAIN                      S22024 53550000
PRMEND1  EQU   *                                                 S22024 53620000
         XC    TOTTDTBL(D40),TOTTDTBL  CLEAR TEST DEV TABLE      S22024 53690000
         B     TDSTART            BEGIN PROMPTING                S22024 53760000
         EJECT                                                          53830000
*                                                                S22024 53900000
*              ROUTINE TO LOOK UP UCB ENTRY                             53970000
*                                                                       54040000
*                                                                       54110000
UCBLOOK  EQU   *                                                        54180000
         L     R8,UCBSAVE               PICK UP ADDR OF UCB PTRS        54250000
         USING UCB,R7                                                   54320000
UCBLOOK1 EQU   *                                                 S22024 54390000
         SR    R7,R7              CLEAR                        @G36XRUV 54420010
         ICM   R7,ADUCBMSK,D0(R8) LOAD UCB ADDR                @G36XRUV 54460010
         ST    R7,WORK4           SAVE UCB ADDR                         54530000
         LA    R8,D2(R8)          POINT TO NEXT ENTRY            S22024 54600000
         BZ    UCBLOOK1                 PADDING IGNORE                  54740000
         CLM   R7,ADUCBMSK,ENDTABLE Q-END OF TABLE REACHED     @G36XRUV 54760010
         BE    UCBEND             Y-GO SETUP ERROR RETURN      @G36XRUV 54780010
         CLC   WORK1(D3),UCBNAME  MATCH                          S22024 54880000
         BNE   UCBLOOK1                 NO GO LOOK AGAIN                54950000
*********************************************************************** 54952010
*        THE FOLLOWING CODE IS MVS UNIQUE. IT CHECKS FOR 3270  @G36XRUV 54954010
*        LOCAL AND 3705 USING THE UCB. IF THE DEVICE IS EITHER,@G36XRUV 54956010
*        IT IS AN ERROR. NOTE: THE MEANINGS OF THE UCB BITS MAY@G36XRUV 54958010
*        CHANGE IN THE FUTURE NECESSITATING CHANGES TO THIS    @G36XRUV 54960010
*        CODE.                                                 @G36XRUV 54962010
*********************************************************************** 54964010
         MVC   WORK2(D1),UCBTBYT4       MOVE TYPE TO WORK AREA @G36XRUV 54966010
         TM    UCBDVCLS,UCB3DISP        Q-GRAPHICS DEVICE      @G36XRUV 54968010
         BNO   NCPCHK                   N-CHECK FOR NCP        @G36XRUV 54970010
         TM    WORK2,XF0                Q-ANY HI BITS ON       @G36XRUV 54972010
         BNZ   NCPCHK                   N-NOT 3270             @G36XRUV 54974010
         CLI   WORK2,X09                Q-IN 3270 RANGE        @G36XRUV 54976010
         BL    NCPCHK                   N-CHECK FOR NCP        @G36XRUV 54978010
         B     GETOUT1                  3270 LOCAL - ERROR     @G36XRUV 54980010
NCPCHK   DS    0H                                              @G36XRUV 54982010
         NI    WORK2,X0F                CLEAR HI BITS          @G36XRUV 54984010
         CLI   WORK2,TCU3705            3705?                  @G36XRUV 54986010
         BNER  R9                       RETURN                 @G36XRUV 54988010
         B     GETOUT1                  3705 - ERROR           @G36XRUV 54990010
         EJECT                                                          54992010
*              ROUTINE TO SEARCH TERMNAME TABLE. R3 HAS ADDR OF         54994010
*              START OF TABLE. WORK1 HAS NAME IN IT. R2 HAS LENGTH      54996010
*                                                                       54998010
UCBEND1  EQU   *                                                 S22024 55370000
         BR    R9                       GOOD RETURN                     55440000
UCBEND   EQU   *                                                 S22024 55510000
         B     D4(R9)             ERROR RETURN                   S22024 55580000
         EJECT                                                          55650000
************************************************************** @Y17XAUU 55720000
*        ROUTINE TO FINE NCP TTE ADDRESS. INPUT: REG 1 =     * @Y17XAUU 55790000
*        TERMINAL TTE ADDRESS. OUTPUT: = REG 1 = NCP TTE PREFIX@Y17XAUU 55860000
*        ADDRESS. RETURN TO CALLER VIA REG 14.               * @Y17XAUU 55930000
************************************************************** @Y17XAUU 56000000
NCPTTE   EQU   *                                               @Y17XAUU 56070000
         ST    R14,TRMSAVE2       SAVE RETURN ADDRESS          @Y17XAUU 56140000
         LA    R8,TRMPRFSZ        GET TTE PREFIX SIZE          @Y17XAUU 56210000
         SLR   R1,R8              POINT TO TTE PREFIX          @Y17XAUU 56280000
         USING IEDNTRM,R1         SET TTE ADDRESSABILITY       @Y17XAUU 56350000
NCPLOOP  EQU   *                                               @Y17XAUU 56420000
         LH    R1,TRMCOHRT        GET COHORT POINTER           @Y17XAUU 56490000
         LTR   R1,R1              ENTRY IN HIERARCHY           @YM07415 56560000
         BZ    UCB0X1             NO - ERROR RETURN            @YM07415 56630000
         L     R15,TERNMTAB       TTCIN TO TTE CONVERSION      @Y17XAUU 56700000
*                                 ROUTINE ADDRESS              @Y17XAUU 56770000
         BALR  R14,R15            FIND TTE ADDRESS             @Y17XAUU 56840000
         SLR   R1,R8              POINT TO TTE PREFIX          @Y17XAUU 56910000
         CLI   TRMTYPE,TRMLNCP    NCP ENTRY                    @Y17XAUU 56980000
         BNE   NCPLOOP            NO - CHECK NEXT ENTRY        @Y17XAUU 57050000
         L     R14,TRMSAVE2       RESTORE RETURN ADDRESS       @Y17XAUU 57120000
         BR    R14                RETURN TO CALLER             @Y17XAUU 57190000
         DROP  R1                                              @Y17XAUU 57260000
         EJECT                                                          57330000
*        SET UP TEST DEVICE TABLE                                       57400000
PLUG     EQU   *                                                        57470000
         LA    R7,TOTTDTBL        POINT TO TEST DEVICE TABLE     S99528 57540000
         LA    R8,TOTTDTBL+D40    POINT TO END OF TABLE          S99528 57610000
PLUG001  EQU   *                                                 S99528 57680000
         CR    R7,R8              TABLE FILLED                   S99528 57750000
         BE    TDERR              YES - TOO MANY ENTRIES         S99528 57820000
         L     R12,D0(R7)         GET NEXT ENTRY                 S99528 57890000
         LTR   R12,R12            VACANT SPACE IN TABLE          S99528 57960000
         BZ    PLUG002            YES                            S99528 58030000
         LA    R7,D4(R7)          NO - POINT TO NEXT SLOT        S99528 58100000
         B     PLUG001            GET NEXT ENTRY                 S99528 58170000
PLUG002  EQU   *                                                 S22024 58240000
         TM    TDFLG,SYM+RNTERM   TERMINAL TEST                  S22024 58310000
         BZ    PLUG008            NO                             S22024 58380000
         MVI   TRMTNT,TOTTDTRM    YES - SHOW TERMINAL TEST       S22024 58450000
         TM    TDFLG,RNTERM       TERMINAL ON RN                 S22024 58520000
         BZ    PLUG003            NO                             S22024 58590000
         OI    TRMTNT,TOTTDORN    YES - SHOW RN TERMINAL         S22024 58660000
PLUG003  EQU   *                                                 S22024 58730000
         MVC   D0(D4,R7),TRMTNT   TNT ADDR TO TD TABLE           S22024 58800000
         OI    TOTFLG10,TOTTERMS  SHOW TERMINAL TEST             S22024 58870000
         B     PLUGEND            EXIT                           S22024 58940000
PLUG008  EQU   *                  LINE ENTRY                     S22024 59010000
         LA    R14,TOTTDTBL       POINT TO TD TABLE              S22024 59080000
         TM    TDFLG,RNLINE       RN LINE TEST                   S22024 59150000
         BO    PLUG018            YES                            S22024 59220000
         MVI   WORK4,TOTTDLIN     SHOW LINE TEST                 S22024 59290000
         CR    R14,R7             FIRST ENTRY                    S22024 59360000
         BE    PLUG010            YES - BYPASS MIXED CHECK       S22024 59430000
         LR    R14,R7             GET CURRENT SETTINT            S22024 59500000
         S     R14,F4             LAST ENTRY ADDR                S22024 59570000
         CLI   D0(R14),TOTTDLIN   CUU TEST                       S22024 59640000
         BNE   TDERR1             NO - ERROR                     S22024 59710000
PLUG010  DS    0H                 BOUNDARY ALLIGNMENT            S22024 59780000
         MVC   D0(D4,R7),WORK4    UCB ADDR TO TD TABLE           S22024 59850000
         OI    TOTFLG06,TOTNCMFG  SET NON-CONCURRENT MODE FLAG   S22024 59920000
         B     PLUGEND            EXIT                           S22024 59990000
PLUG018  EQU   *                  RN SUB LINE                    S22024 60060000
         MVI   TRMTNT,TOTTDLIN    SHOW LINE TEST                 S22024 60130000
         OI    TRMTNT,TOTTDORN    SHOW RN LINE                   S22024 60200000
         CR    R14,R7             FIRST ENTRY                    S22024 60270000
         BE    PLUG024            YES - BYPASS MIXED CHECK       S22024 60340000
         LR    R14,R7             GET CURRENT SETTING            S22024 60410000
         S     R14,F4             LAST ENTRY ADDR                S22024 60480000
         TM    D0(R14),TOTTDORN   RN LINE TEST                   S22024 60550000
         BZ    TDERR1             NO - ERROR                     S22024 60620000
PLUG024  DS    0H                 BOUNDARY ALLIGNMENT            S22024 60690000
         MVC   D0(D4,R7),TRMTNT   TNT ADDR TO TD TABLE           S22024 60760000
PLUGEND  EQU   *                                                 S22024 60830000
         BR    R9                 RETURN                         S22024 60900000
         EJECT                                                          60970000
*                                                                       61040000
*        ROUTINE TO DETERMINE INITIAL STATUS OF                         61110000
*        TERMINAL TEST DEVICES                                          61180000
*                                                                       61250000
TERMSTAT EQU   *                                                        61320000
         TM    TOTFLG10,TOTTERMS  TERMINAL TEST ?                       61390000
         BZ    LINESTAT           NO - LINE TEST                        61460000
         LA    R12,TOTTDTBL       POINT TO TEST DEVICE TABLE            61530000
         LA    R11,TOTTDEND       POINT TO END OF TABLE                 61600000
STAT2    EQU   *                                                        61670000
         CR    R12,R11            END OF TABLE ?                        61740000
         BE    ZERO(R3)           YES - RETURN                          61810000
         L     R7,D0(R12)         GET TNT ADDR                          61880000
         LA    R7,D0(R7)          CLEAR HI ORDER BYTE                   61950000
         LTR   R7,R7              LAST ENTRY ?                          62020000
         BZ    ZERO(R3)           YES - RETURN                          62090000
         ST    R7,TDTNT           SAVE TD TNT ADDRESS          @YM08136 62160000
         MVI   RQLADR,BLANK                                             62230000
         MVC   RQLADR+D1(D7),RQLADR                                     62300000
         SR    R10,R10            CLEAR REG                             62370000
         IC    R10,TOTTTBEL       GET MAX NAME LENGTH                   62440000
         LR    R9,R10             SAVE LENGTH                           62510000
         BCTR  R9,R0              DECREMENT FOR EX                      62580000
         EX    R9,RQMOVE          MOVE NAME TO REQ. ELEMENT             62650000
         AR    R7,R10             POINT TO TTE ADDR                     62720000
         MVC   TTEADDR+D1(D3),D0(R7) ALLIGN ADDR                        62790000
         L     R8,TTEADDR         GET TTE ADDR                          62860000
         LA    R1,TRMPRFSZ        GET TTE PREFIX SIZE          @Y17XAUU 62930000
         SLR   R8,R1              POINT TO TTE PREFIX          @Y17XAUU 63000000
         USING IEDNTRM,R8                                      @Y17XAUU 63070000
         CLI   TRMTYPE,TRMLUNT    LU ENTRY                     @Y17XAUU 63140000
         BE    STAT16             YES - BYPASS INIT STATUS     @Y17XAUU 63210000
         L     R8,TRMDESTQ-D1     GET QCB ADDR                          63280000
         DROP  R8                                                       63350000
         USING IEDQQCB,R8                                               63420000
         MVC   RQRLN(D1),QCBRELLN SAVE RLN IN OP CONTROL PLIST          63490000
         TM    QCBSTAT,QCBTRMHO   TERMINAL INITIALLY HELD ?             63560000
         BZ    STAT6              NO                                    63630000
         OI    D0(R12),TOTTDTHD   SHOW INIT HELD                        63700000
STAT6    EQU   *                                                        63770000
         L     R9,TOTAVTPT        GET AVT ADDR                          63840000
         TM    TOTFLG04,TOTTTSWT  TEST DEVICE SWITCHED ?                63910000
         BO    STAT12             YES - TERMINAL ACTIVE          S22024 63980000
*                                                                       64050000
*        IF THE TEST ENTRY IS AN NCP PRE SNA RESOURCE AND      @YM08136 64120000
*        EQUAL TO THE CONTROL TERMINAL OR ALTERNATE PRINTER    @YM08136 64190000
*        BYPASS ISSUING AN INACTIVATE FOR THE RESOURCE.        @YM08136 64260000
*                                                                       64330000
         SLR   R1,R1              CLEAR REGISTER               @YM08136 64400000
         ICM   R1,ADRMSK,TOTCRTNT+D1 GET CT TNT ADDRESS        @YM08136 64470000
         BZ    CHKAP              CHECK AP IF CT NOT TERMINAL  @YM08136 64540000
         CL    R1,TDTNT           CT EQU TD                    @YM08136 64610000
         BE    CHKTYPE            YES - CHECK FOR PRE SNA TERM @YM08136 64680000
CHKAP    EQU   *                                               @YM08136 64750000
         SLR   R1,R1              CLEAR REG                    @YM08136 64820000
         ICM   R1,ADRMSK,TOTARTNT+D1 GET AP TNT ADDRESS        @YM08136 64890000
         BZ    CHKEND             GO - INACTIVATE RESOURCE     @YM08136 64960000
         CL    R1,TDTNT           AP EQU TD                    @YM08136 65030000
         BNE   CHKEND             NO - GO INACTIVATE RESOURCE  @YM08136 65100000
CHKTYPE  EQU   *                                               @YM08136 65170000
         L     R1,TTEADDR         GET TTE ADDRESS              @YM08136 65240000
         LA    R15,TRMPRFSZ       GET TTE PREFIX SIZE          @YM08136 65310000
         SLR   R1,R15             POINT TO TTE PREFIX          @YM08136 65380000
         USING IEDNTRM,R1         SET TTE ADDRESSABILITY       @YM08136 65450000
         CLI   TRMTYPE,TRMPSNA    NCP PRE SNA TERMINAL         @YM08136 65520000
         BE    STAT12             YES - PROCESS NEXT TD ENTRY  @YM08136 65590000
CHKEND   EQU   *                                               @YM08136 65660000
         LA    R1,TOTOTECB        GET ECB ADDR                          65730000
         ST    R1,RQECBA          PUT IN REQ ELEMENT                    65800000
         L     R5,TOTAVTPT        GET AVT ADDR                          65870000
         USING IEDQAVTD,R5                                              65940000
         LA    R14,AVTOPCOB       GET OP CONTROL QCB ADDR               66010000
         DROP  R5                                                       66080000
         ST    R14,RQQCBA-D1      PUT IN QCB ADDR                       66150000
         MVI   RQVBCD,TERMACTV    SET ACTIVATE VERB CODE                66220000
         MVI   RQVBCD,INACT       INACTIVATE VERB CODE           S22024 66290000
         XC    RQLINK(D3),RQLINK  CLEAR LINK FIELD                      66360000
         XC    TOTOTECB(D4),TOTOTECB CLEAR ECB                          66430000
         MVC   TOTPLIST(RQND-RQELE),RQELE ELEMENT TO OLTCB       S22024 66500000
         LA    R1,TOTPLIST        ADDR OF ELEMENT                S22024 66570000
         ST    R1,TRMSLPL         PUT IN PLIST                   S22024 66640000
         ST    R1,TRMSLPL+D4      PUT IN PLIST                   S22024 66710000
         MVI   TRMSLPL,RQINIT     SET INITIAL ELEMENT FLAG       S22024 66780000
         MVI   TRMSLPL+D4,RQEND   SET LAST ELEMENT FLAG          S22024 66850000
         LA    R1,TRMSLPL         ADDR OF PLIST                  S22024 66920000
*                                                                       66990000
         AQCTL                    ISSUE ACTIVATE COMMAND                67060000
         WAIT  ECB=TOTOTECB                                             67130000
*                                                                       67200000
         MVC   RQRTCD(D1),TOTORTCD RETURN CODE                   S22024 67270000
         CLI   RQRTCD,INACTRC     INIT INACTIVE                  S22024 67340000
         BNE   STAT12             NO - ACTIVE                    S22024 67410000
STAT10   EQU   *                                                        67480000
         OI    D0(R12),TOTTDIAC   SHOW THAT LIST INACTIVE               67550000
STAT12   EQU   *                  FIND LCB ADDR                         67620000
         L     R9,QCBDCBAD-D1     GET DCB ADDR                          67690000
         USING IHADCB,R9                                                67760000
         TM    DCBDSORG,LGBA      LGB VS. DCB                    S22024 67830000
         BZ    STAT13             NO                             S22024 67900000
         DROP  R9                                                S22024 67970000
         L     R9,DCBSAVE         GET 3705 DCB ADDRESS         @Y17XAUU 68040000
         USING IHADCB,R9                                         S22024 68110000
STAT13   EQU   *                                                 S22024 68180000
         L     R7,DCBDEBAD        GET DEB ADDR                          68250000
         USING DEBNMSUB,R7                                              68320000
         SR    R15,R15            CLEAR REG                             68390000
         IC    R15,DEBNMEXT       GET DEB NUMBER OF EXTENTS             68460000
         DROP  R7                                                       68530000
         SR    R7,R7              CLEAR REG                             68600000
         IC    R7,QCBRELLN        GET RLN                        S22024 68670000
         TM    D0(R12),TOTTDORN   TD ON 3705                     S22024 68740000
         BZ    STAT14             NO                             S22024 68810000
         L     R5,NCPSAVE         GET NCP TTE ADDRESS          @Y17XAUU 68880000
         USING IEDNTRM,R5         SET TTE ADDRESSABILITY       @Y17XAUU 68950000
         TM    TRMBYTE2,TRMRSACT  NCP ACTIVE                   @Y17XAUU 69020000
         BZ    STAT16             NO - EXIT                    @Y17XAUU 69090000
         OI    D0(R12),TOTTDLST   YES - SHOW LINE STOPPED        S22024 69160000
         DROP  R5                                                S22024 69230000
         B     STAT16             EXIT                           S22024 69300000
STAT14   EQU   *                                                 S22024 69370000
         LR    R5,R7              COPY RLN                       S22024 69440000
         BCTR  R5,R0              DECREMENT BY 1                        69510000
         SR    R15,R5             GET COUNT OF LCB'S TO SCAN            69580000
         SR    R14,R14            CLEAR REG                             69650000
         IC    R14,DCBEIOBX       GET LCB SIZE                          69720000
         LR    R5,R7              GET RLN                               69790000
         MR    R4,R14             GET STARTING LCB OFFSET               69860000
         AL    R5,DCBIOBAD        POINT TO IOB OF LCB                   69930000
         DROP R9                                                        70000000
         S     R5,K32             ADJUST TO START OF LCB                70070000
         USING IEDQLCB,R5                                               70140000
         TM    LCBSTAT1,LCBFREEN+LCBRECVN+LCBSENDN  LINE STOPPED ?      70210000
         BNZ   STAT16             NO                                    70280000
         OI    D0(R12),TOTTDLST   YES - SHOW LINE STOPPED               70350000
         DROP  R5                                                       70420000
*                                                                       70490000
STAT16   EQU   *                                                        70560000
         LA    R12,D4(R12)        POINT TO NEXT ENTRY                   70630000
         B     STAT2              PROCESS NEXT ENTRY                    70700000
         DROP  R8                                                       70770000
         EJECT                                                          70840000
LINESTAT EQU   *   SET STATUS BITS FOR LINE ENTRIES                     70910000
         LA    R12,TOTTDTBL       POINT TO TEST DEVICE TABLE            70980000
         LA    R11,TOTTDEND       POINT TO END OF TABLE                 71050000
STAT20   EQU   *                                                        71120000
         CR    R12,R11            END OF TABLE                          71190000
         BE    ZERO(R3)           YES - RETURN                          71260000
         L     R7,D0(R12)         GET UCB ADDR                          71330000
         LA    R7,D0(R7)          CLEAR HI ORDER BYTE                   71400000
         LTR   R7,R7              LAST ENTRY                            71470000
         BZ    ZERO(R3)           YES - RETURN                          71540000
         TM    D0(R12),TOTTDORN   TD ON 3705                     S22024 71610000
         BO    STAT40             YES                            S22024 71680000
         SPACE                                                          71750000
         USING UCBOB,R7                                                 71820000
         MVC   WORK1(D3),UCBNAME  GET UCB NAME                          71890000
         DROP  R7                                                       71960000
         BAL   R9,LCBFIND         GET LCB ADDR                          72030000
         B     STAT24             LCB ADDR FOUND                        72100000
         B     STAT28             BYPASS LCB CHECK                      72170000
STAT24   EQU   *                                                        72240000
         L     R8,WORK1           GET LCB ADDR                          72310000
         LA    R8,D0(R8)          CLEAR HI ORDER BYTE                   72380000
         USING IEDQLCB,R8                                               72450000
         TM    LCBSTAT1,LCBFREEN+LCBRECVN+LCBSENDN LINE STOPPED         72520000
         BNZ   STAT28             NO                                    72590000
         OI    D0(R12),TOTTDLST   YES - SHOW LINE STOPPED               72660000
         DROP R8                                                        72730000
STAT28   EQU   *                                                        72800000
         LA    R12,D4(R12)        POINT TO NEXT ENTRY                   72870000
         B     STAT20             CHECK NEXT ENTRY                      72940000
         SPACE 2                                                        73010000
STAT40   EQU   *                                                 S22024 73080000
         SR    R10,R10            CLEAR REG                      S22024 73150000
         IC    R10,TOTTTBEL       MAX NAME LENGTH                S22024 73220000
         AR    R7,R10             POINT TO TTE ADDR              S22024 73290000
         MVC   TTEADDR+D1(D3),D0(R7) ALLIGN ADDR                 S22024 73360000
         L     R8,TTEADDR         TTE ADDR                       S22024 73430000
         USING IEDNTRM,R8         SET TTE ADDRESSABILITY       @Y17XAUU 73500000
         LA    R1,TRMPRFSZ        GET TTE PREFIX SIZE          @Y17XAUU 73570000
         SLR   R8,R1              POINT TO TTE PREFIX          @Y17XAUU 73640000
         TM    TRMLINK,TRMLACTV   LINE ACTIVE                  @Y17XAUU 73710000
         BO    STAT28             YES - EXIT                   @Y17XAUU 73780000
         OI    D0(R12),TOTTDLST   YES - SHOW LINE STOPPED        S22024 73850000
         DROP  R8                                                S22024 73920000
         B     STAT28             CHECK NEXT ENTRY               S22024 73990000
         EJECT                                                          74060000
*                                                                S22024 74130000
*        FIND LCB ADDR FOR LINE ENTRY IN TEST DEVICE TABLE.             74200000
*        THE UCB NAME IS PASSED TO THIS ROUTINE.                        74270000
*        THE LCB ADDRESS IS RETURN TO THE CALLER                        74340000
*                                                                       74410000
LCBFIND  EQU   *                                                        74480000
         STM   R1,R12,REGSAVE     SAVE CALLER'S REG                     74550000
NOUCBAD  EQU   *                                                        74620000
         L     R1,D16(R0)         GET CVT ADDR                          74690000
         L     R1,AVTCVTPT(R1)    GET TCAM DISP ADDR                    74760000
         L     R1,D0(R1)          GET AVT ADDR                          74830000
         USING IEDQAVTD,R1                                              74900000
         L     R1,AVTTCB          GET TCB ADDR                          74970000
         DROP  R1                                                       75040000
         L     R1,D8(R1)          GET DEB CHAIN ADDR                    75110000
AGAIN    EQU   *                                                        75180000
         SR    R3,R3              CLEAR REG                             75250000
         IC    R3,D16(R1)         PICK UP NUMBER OF EXTENTS             75320000
         LA    R5,D32(R1)         GET UCB ADDR CHAIN                    75390000
         L     R4,D24(R1)         DCB ADDR                       S99528 75460000
         USING IHADCB,R4                                         S22024 75530000
         TM    DCBDSORG,LGBA      LGB VS. DCB                    S22024 75600000
         BZ    HERE0              NO                             S22024 75670000
         L     R4,DCBSAVE         GET 3705 DCB ADDRESS         @Y17XAUU 75740000
HERE0    EQU   *                                                 S22024 75810000
         L     R12,D4(R1)         GET ADDR OF NEXT DEB                  75880000
         TM    DCBDSORG+D1,TCAMDEB TCAM DEB                             75950000
         BZ    HERE1              NO - BRANCH                           76020000
         MVC   LCBLEN(D1),DCBEIOBX GET LCB SIZE                         76090000
         LA    R8,D1              SET UP COUNTER                        76160000
HERE     EQU   *                                                        76230000
         L     R9,D0(R5)          PICK UP UCB ADDR                      76300000
         CLC   WORK1(D3),D13(R9)  CUU MATCH                             76370000
         BE    THERE              YES - BRANCH                          76440000
         LA    R8,D1(R8)          BUMP COUNTER                          76510000
         LA    R5,D4(R5)          BUMP UCB ADDR POINTER                 76580000
         BCT   R3,HERE            GO LOOK AGAIN                         76650000
HERE1    EQU   *                                                        76720000
         LA    R12,D0(R12)        CLEAR HI ORDER BYTE                   76790000
         LTR   R12,R12            ANY MORE DEBS                         76860000
         BZ    BADRET             NO - BRANCH                           76930000
         LR    R1,R12             SET R1 TO NEXT DEB                    77000000
         B     AGAIN              GO LOOK AT NEXT DEB                   77070000
BADRET   EQU   *                                                        77140000
         LM    R1,R12,REGSAVE     RESTORE REG                           77210000
         B     D4(R9)             RETURN                                77280000
THERE    EQU   *                                                        77350000
         USING UCB,R9                                            S22024 77420000
         MVC   RNWORK(D1),UCBTBYT4 TCU TYPE BYTE                 S22024 77490000
         NI    RNWORK,X0F         CLEAR UNWANTED BITS            S22024 77560000
         CLI   RNWORK,TCU3705     3705 TCU                       S22024 77630000
         BNE   THERE2             NO                             S22024 77700000
         LA    R8,D1              SET RLN EQU 1                  S22024 77770000
         DROP  R9                                                S22024 77840000
THERE2   EQU   *                                                 S22024 77910000
         STC   R8,RLN             SAVE RLN                              77980000
         STC   R8,MULT+D3         SET UP THE MULTIPLIER                 78050000
         L     R8,DCBIOBAD        PICK UP LCB IOB ADDR                  78120000
         SR    R10,R10            CLEAR REG                             78190000
         SR    R11,R11            CLEAR REG                             78260000
         IC    R11,LCBLEN         SET R3 TO SIZE OF LCB                 78330000
         M     R10,MULT           GET DISPLACEMENT                      78400000
         LA    R8,D0(R11,R8)      POINT TO CORRECT LCB                  78470000
         S     R8,K32             LCB ADDR                              78540000
         ST    R8,WORK1           SAVE LCB ADDR                         78610000
         LM    R1,R12,REGSAVE     RESTORE REG                           78680000
         BR    R9                 RETURN                                78750000
         EJECT                                                          78820000
         DROP  R4                                                       78890000
CEOUT2   DC    C'XXXXXXXX NOT OPENED' LINE NOT OPENED MSG        S99528 78960000
CEOUT2E  DS    0C                 END OF MSG                     S99528 79030000
UCBSAVE  DS    A                  UCB ADDR SAVE AREA             S99528 79100000
MULT     DC    XL4'0'             WORK AREA                      S99528 79170000
TNTENTRY DS    A                  ADDR OF TERNNAME TABE          S99528 79240000
TRMTNT   DS    A                  TNT ADDR                       S99528 79310000
TRMSAV1  DS    3F                 REG SAVE AREA                  S99528 79380000
TDTNT    DS    A                  SAVE AREA FOR TD TNT ADDRESS @YM08136 79450000
TERNMTAB DS    A                  TERMINAL TABLE ADDR            S99528 79520000
AVTUISV  DS    A                  BINARY SEARCH RTN ADDR                79590000
F4       DC    F'4'               VALUE OF 4                     S22024 79660000
         DS    0D                 BOUNDARY ALLIGNMENT                   79730000
NUMBER   DC    X'0000000000000000' COUNTER                       S99528 79800000
         DS    0F                 ALLIGNMENT                            79870000
WORK4    DS    F                  WORK AREA                             79940000
WORK1    DC    XL8'0'             TERMINAL NAME                         80010000
WORK2    DC    XL12'0'            WORK AREA                      S22024 80080000
SAVE     DS    5F                 SAVE AREA                      S22024 80150000
TRMSAVE  DS    F                  SAVE AREA                             80220000
TRMWRK   DS    CL72               TRM WORK BUFFER                       80290000
TRMWRKE  DS    0C                 END OF TRM BUFFER                     80360000
ANSWER   DS    CL4                INPUT BUFFER                          80430000
         DS    0F                 ALLIGNMENT                            80500000
PAREMLST DS    0CL8               BINARY SRCH P-LIST                    80570000
         DS    CL1                BINARY OFFSET                         80640000
         DC    X'00'              FLAG BYTE                             80710000
         DC    X'00'              FLAG BYTE                             80780000
LENGTH   DS    CL1                LENGTH OF TERMINAL NAME               80850000
         DC    A(WORK1)           ADDR OF TERMINAL NAME                 80920000
         DS    0F                 ALLIGNMENT                            80990000
RE       DS    0CL8               OP CONTROL P-LIST                     81060000
OCQCB    DS    F                  QCB ADDR                              81130000
         DC    X'DC'              FLAG                                  81200000
         DC    XL3'0'             LINK FIELD                            81270000
ENDTABLE DC    XL2'FFFF'          END OF UCB TABLE             @G36XRUV 81300010
VERBCODE DC    X'41'              COMMAND                               81340000
RELEN    DC    X'18'              LENGTH OF ELEMENT                     81410000
RLN      DS    CL1                RELATIVE LINE NUMBER                  81480000
RETCODE  DC    X'00'              RETURN CODE                           81550000
         DC    A(ECB)             ECB ADDR                              81620000
ECB      DC    2F'0'              ECB                                   81690000
REPAREM  DC    X'0C'              FIRST ELEMENT                         81760000
         DC    AL3(RE)            ADDR OF ELEMENT                       81830000
         DC    X'80'              LAST ELEMENT                          81900000
         DC    AL3(RE)            ADDR OF LAST ELEMENT                  81970000
REGSAVE  DS    12F                REG SAVE AREA                         82040000
         SPACE                                                          82110000
*********************************************************************** 82180000
*                                                                     * 82250000
*        PARAMETER LIST FOR OPERATOR CONTROL COMMANDS                 * 82320000
*                                                                     * 82390000
TRMSLPL  DS    0F                 PARAMETER LIST FOR ACT. TERMINAL      82460000
         DC    X'0C'              FIRST ELEMENT                         82530000
         DC    AL3(RQELE)         ADDR OF FIRST ELEMENT                 82600000
         DC    X'80'              LAST ELEMENT                          82670000
         DC    AL3(RQELE)         ADDR OF LAST ELEMENT                  82740000
*********************************************************************** 82810000
         SPACE                                                          82880000
RQELE    DS    0F                 OP CONTROL REQUEST ELEMENT            82950000
RQKEY    DC    X'00'              KEY                                   83020000
RQQCBA   DC    X'000000'          QCB ADDR                              83090000
RQPRI    DC    X'DC'              PRIORITY                              83160000
RQLINK   DC    X'000000'          LINK FIELD                            83230000
RQVBCD   DC    X'00'              VERB CODE                             83300000
RQELNG   DC    X'18'              LENGTH CONSTANT                       83370000
RQRLN    DC    X'00'              RELATIVE LINE NUMBER                  83440000
RQRTCD   DC    X'00'              RETURN CODE                           83510000
RQECBA   DC    AL4(0)             ECB ADDR                              83580000
RQLADR   DC    8X'40'             LINE ADDR OR TERMINAL NAME            83650000
RQND     DS    0C                 END OF ELEMENT                 S22024 83720000
*                                                                       83790000
         SPACE                                                          83860000
NCPSAVE  DS    F                  SAVE AREA                    @Y17XAUU 83930000
DCBSAVE  DS    F                  SAVE AREA                    @Y17XAUU 84000000
TTEADDR  DC    F'0'               WORK AREA TO ALLIGN TTE ADDR          84070000
TRMSAVE2 DS    F                  REGISTER SAVE AREA           @Y17XAUU 84140000
K32      DC    F'32'              VALUE OF 30                           84210000
RQMOVE   MVC   RQLADR(D0),D0(R7) MOVE NAME TO REQ ELEMENT               84280000
LCBLEN   DS    CL1                LCB LENGTH                     S99528 84350000
TERNMLEN DS    CL1                LENGTH OF TERMINAL NAME               84420000
TDFLG    DC    X'00'              CONTOOL BYTE                   S99528 84490000
TRMFLG   DC    X'00'              CONTROL BYTE                          84560000
TDFLGG   DC    X'00'              CONTROL BYTE                          84630000
RNWORK   DS    C                  WORK AREA                      S22024 84700000
SYM      EQU   X'40'              TERMINAL TEST FLAG                    84770000
KUCB     DC    H'0'               TEST UCB SAVE AREA                    84840000
XBLANK   DC    8XL1'40'           BLANK WORK AREA                S22024 84910000
WORKAREA DC    XL1'0'             WORK AREA                      S05331 84980000
PATCH    DS    CL200              IEDQWJ PATCH AREA                     85050000
         EJECT                                                          85120000
         TLGBD                                                   S22024 85190000
         EJECT                                                          85260000
         TLCBD                                                          85330000
         EJECT                                                          85400000
TIOT     DSECT                                                          85470000
         IEFTIOT1                                                       85540000
         EJECT                                                          85610000
         SPACE 4                                                        85680000
         TQCBD                                                          85750000
         EJECT                                                          85820000
         DCBD  DSORG=TX                                                 85890000
         EJECT                                                          85960000
         TTRMD                                                          86030000
         EJECT                                                          86100000
         TSCBD                                                          86170000
         EJECT                                                          86240000
         TPRFD                                                          86310000
         EJECT                                                          86380000
CVT      DSECT                                                          86450000
         CVT                                                            86520000
         EJECT                                                          86590000
UCB      DSECT                                                          86660000
         IEFUCBOB                                                       86730000
         EJECT                                                          86800000
         TAVTD                                                          86870000
         EJECT                                                          86940000
         TDEBD                                                          87010000
         EJECT                                                          87080000
         TTNTD                                                          87150000
         EJECT                                                          87220000
RESPL    RESPL                                                 @Y17XAUU 87290000
         EJECT                                                          87360000
         OLTCB                                                   S22024 87430000
CEIN     EQU   TOTINBUF           INPUT BUFFER                   S22024 87500000
         END                                                            87570000
