         TITLE 'IEDQWJ2 TRM PROMPTER MODULE 3'                          00080000
IEDQWJ2  CSECT                                                          00160000
*A000000-999999                                                @Y16X5U0 00240000
* CHANGE ACTIVITY AS FOLLOWS:                                           00320000
*C353630                                                         S21903 00400000
*D532830-532900                                                 SA51078 00480000
*C532340-532410                                                 SA51078 00560000
*D417500,575300-575600                                           S21903 00640000
*A404000,533320                                                 SA41597 00720000
*C532690                                                        SA41597 00800000
*D534860-535140                                                 SA41597 00880000
*A211700,525550                                                 SA41607 00960000
*A250500                                                        SA41610 01040000
*C531430                                                        SA41611 01120000
*C000000-999999                                                  S22024 01200000
*A108300-108600,287190-287910,300000-300300,494140-494820        S05331 01280000
*A813700-814000,838850-839550                                    S05331 01360000
*C287100,696600,786600,806400                                    S05331 01440000
*D269100                                                         S05331 01520000
*A157100-157200,571600,571665-572200,572600-573000              SA61759 01600000
*A838300                                                         Y06330 01680000
*D839700                                                         Y06330 01760000
*C646600                                                       @SA70654 01840000
*A171900,429300,433800,435000,435300,441900,554400,636300      @Y17XAUU 01920000
*A638100,739800,742500,823800,838950,848700,909900,938700      @Y17XAUU 02000000
* A020000,454400                                               @G36XRUV 02006010
* C211200,455200                                               @G36XRUV 02012010
*THIS IS A DUMMY APAR TO CORRECT FICHE FLAGGING PROBLEM        @OZ19773 02032010
*                                                                       02060010
         USING IEDQWJ2,R15                                              02080000
*                                                                       02160000
IEDQWJ2  IEDHJN START,HJN                                               02240000
*                                                                       02320000
**************************************************************** S99528 02400000
*                                                              * S99528 02480000
* MODULE NAME = IEDQWJ2 (TCAM,TOTE)                            @Y17XAUU 02560000
*                                                              *        02640000
* DESCRIPTIVE NAME = TRM PROMPTER MODULE 3                     *        02720000
*                                                              *        02800000
* COPYRIGHT = NONE                                             *        02880000
*                                                              *        02960000
* STATUS --                                                    * S99528 03040000
*                                                              * S99528 03120000
*    VERSION 10.0                                              @Y17XAUU 03200000
*                                                              * S99528 03280000
* FUNCTION --                                                  * S99528 03360000
*    THE PURPOSE OF THIS MODULE IF TO PROMPT FOR THE ALTERNATE * S99528 03440000
*    PRINTER TERMINAL.                                         * S99528 03520000
*                                                              * S99528 03600000
*    THE CE IS PROMPTED FOR THE AP LOCATION. AP LOCATION       * S99528 03680000
*    CAN BE SYSOUT, SYSCON, OR ANY TCAM TERMINAL WITH A        * S99528 03760000
*    PRINTER. IF THE ENTRY IS NOT SYSCON OR SYSOUT IT IS       * S99528 03840000
*    VERIFIED TO BE A VALID TCAM TERMINAL.                     * S99528 03920000
*                                                              * S99528 04000000
*    IF NON-CONCURRENT MODE WAS SELECTED, THE SYSTEM OPERATOR  * S99528 04080000
*     IS ASKED FOR EXCLUSIVE USE OF THE NECESSARY LINES.       * S99528 04160000
*                                                              * S99528 04240000
* ENTRY POINT --                                               * S99528 04320000
*                                                              * S99528 04400000
*    IEDQWJ2                                                   @Y17XAUU 04480000
*                                                              @Y17XAUU 04560000
* PURPOSE -- SEE FUNCTION                                      @Y17XAUU 04640000
*                                                              @Y17XAUU 04720000
* LINKAGE -- XCTL'ED TO FROM IEDQWJ1                           @Y17XAUU 04800000
*                                                              @Y17XAUU 04880000
* MODULE TYPE -- PROCEDURE                                     @Y17XAUU 04960000
*                                                              @Y17XAUU 05040000
* MODULE SIZE -- 4K MAXIMUM                                    @Y17XAUU 05120000
*                                                              @Y17XAUU 05200000
* PROCESSOR -- ASSEMBLER XF                                    @Y17XAUU 05280000
*                                                              @Y17XAUU 05360000
* MACROS -- IEDHJN,AQCTL,LINK,BLDL,LOAD,XCTL,IEDQMSG,WTOR,     @Y17XAUU 05440000
*           STIMER,TTIMER,WAIT                                 @Y17XAUU 05520000
*                                                              * S99528 05600000
* INPUT --                                                     * S99528 05680000
*                                                              * S99528 05760000
*    REGISTERS 02,13,14,15 CONTAIN THE FOLLOWING VALUES:       * S99528 05840000
*                                                              * S99528 05920000
*         02 - OLTCB POINTER                                   * S99528 06000000
*         13 - SAVE AREA ADDRESS                               * S99528 06080000
*         14 - RETURN ADDRESS                                  * S99528 06160000
*         15 - ENTRY POINT ADDRESS                             * S99528 06240000
*                                                              * S99528 06320000
* OUTPUT --                                                    * S99528 06400000
*                                                              * S99528 06480000
*    NONE                                                      * S99528 06560000
*                                                              * S99528 06640000
* EXTERNAL REFERENCES --                                       * S99528 06720000
*                                                              * S99528 06800000
*    AVTUI - TCAM BINARY SEARCH                                * S99528 06880000
*    IEDQWK - MESSAGE MODULE                                   * S99528 06960000
*                                                              * S99528 07040000
* EXITS,NORMAL --                                              * S99528 07120000
*                                                              * S99528 07200000
*    IEDQWD - CONTINUE TRM PROCESSING                          * S99528 07280000
*                                                              * S99528 07360000
* EXITS,ERROR --                                               * S99528 07440000
*                                                              * S99528 07520000
*    IEDQWE - TERMINATE TRM REQUEST                            * S99528 07600000
*                                                              * S99528 07680000
* TABLES/WORK AREAS --                                         * S99528 07760000
*                                                              * S99528 07840000
*    OLTCB, CVT, UCB, AVT, TERNAME TABLE.                      * S99528 07920000
*                                                              * S99528 08000000
* ATTRIBUTES --                                                * S99528 08080000
*                                                              * S99528 08160000
*    ENABLED, PROBLEM PROGRAM MODE, TRANSIENT                  * S99528 08240000
*                                                              * S99528 08320000
* NOTES -- SEE BELOW                                           @Y17XAUU 08400000
*                                                              * S99528 08480000
*  DEPENDENCIES -- EBCDIC CODE CHARACTER SET                   @Y17XAUU 08560000
*                                                              @Y17XAUU 08640000
*  RESTRICTIONS -- NONE                                        @Y17XAUU 08720000
*                                                              @Y17XAUU 08800000
*  REGISTER CONVENTIONS -- SEE REGISTER ASSIGNMENT             @Y17XAUU 08880000
*                                                              @Y17XAUU 08960000
*  PATCH LABEL -- PATCH                                        @Y17XAUU 09040000
*                                                              * S99528 09120000
**************************************************************** S99528 09200000
         EJECT                                                          09280000
**************************************************************** S99528 09360000
*                                                              * S99528 09440000
*        EQUATES                                               * S99528 09520000
*                                                              * S99528 09600000
**************************************************************** S99528 09680000
RNLINE   EQU   X'80'              RN LINE CHECK                  S22024 09760000
         SPACE                                                          09840000
R0       EQU   0                  REGISTER 0                     S99528 09920000
R1       EQU   1                  REGISTER 1                     S99528 10000000
R2       EQU   2                  OLTCB ADDRESS                  S99528 10080000
R3       EQU   3                  REGISTER 3                     S99528 10160000
R4       EQU   4                  REGISTER 4                     S99528 10240000
R5       EQU   5                  REGISTER 5                     S99528 10320000
R6       EQU   6                  BASE REGISTER                  S99528 10400000
R7       EQU   7                  REGISTER 7                     S99528 10480000
R8       EQU   8                  REGISTER 8                     S99528 10560000
R9       EQU   9                  REGISTER 9                     S99528 10640000
R10      EQU   10                 REGISTER 10                    S99528 10720000
R11      EQU   11                 REGISTER 11                    S99528 10800000
R12      EQU   12                 REGISTER 12                    S99528 10880000
R13      EQU   13                 SAVE AREA ADDRESS              S99528 10960000
R14      EQU   14                 RETURN ADDRESS                 S99528 11040000
R15      EQU   15                 ENTRY POINT ADDRESS            S99528 11120000
PARMREG0 EQU   0                  MSG PARAMETER REGISTER 0       S99528 11200000
PARMREG1 EQU   1                  MSG PARAMETER REGISTER 1       S99528 11280000
DIS      EQU   8                  DISP OF 8                      S99528 11360000
*                                                                S99528 11440000
DEQFLG   EQU   X'01'              DEQ REQUEST FLAG               S05331 11520000
ENQFLG   EQU   X'83'              ENQ REQUEST FLAG               S05331 11600000
LGBA     EQU   X'80'              LGB MAP                        S22024 11680000
TYPE1CA  EQU   X'15'              UCB ID 3705 TYPE 1 CA          S22024 11760000
TYPE2CA  EQU   X'25'              UCB ID OF 3705 TYPE 2 CA       S22024 11840000
HOLD     EQU   X'88'              HOLD VERB CODE                        11920000
HELDN    EQU   X'04'              HOLD MODE                     SA41607 12000000
X0F      EQU   X'0F'              POSITIVE MASK                  S22024 12080000
SUCES    EQU   X'FF'              REQUEST SUCCESSFUL             S22024 12160000
ACVT     EQU   16                 POINTER TO CUT ADDR            S22024 12240000
TRMLEN   EQU   72                 LENGTH OF TRM BUFFER           S22024 12320000
SLASH    EQU   X'61'              SLASH                          S22024 12400000
COMMA    EQU   X'6B'              COMMA                          S22024 12480000
TDMAX    EQU   11                 MAX+1 TEST DEVICE COUNT        S22024 12560000
RNTERM   EQU   X'E0'              TERMINAL ATTACHED TO RN (OFF)  S22024 12640000
YES      EQU   X'E8'              POSITIVE RESPONSE              S22024 12720000
NO       EQU   X'D5'              NEGATIVE RESPONSE              S22024 12800000
RESDP    EQU   X'20'              DEVICE PROTECTED               S22024 12880000
CAP      EQU   X'40'              CAPITALIZATION BIT             S22024 12960000
OPEN     EQU   X'10'              DCB OPEN FLAG                  S22024 13040000
LAST     EQU   X'80'              LAST ENTRY                     S22024 13120000
INITEST  EQU   128                INIT BIT TO TEST               S22024 13200000
XFF      EQU   X'FF'              MASK SETTING                          13280000
X14      EQU   X'14'              DISP OF 20                            13360000
X40      EQU   X'40'              A BLANK CHAR                          13440000
RQINIT   EQU   X'0C'              START OF LIST                  S22024 13520000
RQEND    EQU   X'80'              END OF LIST                    S22024 13600000
D17      EQU   17                 DISP OF 17                            13680000
XE0      EQU   X'E0'              QCB MASK SETTING                      13760000
TWO      EQU   2                  DISP OF TWO                           13840000
FOUR     EQU   4                  DISP OF FOUR                          13920000
ACTVBCD  EQU   X'46'              OP CTL ACTIVATE CMMD                  14000000
ACTRTCD  EQU   X'08'              INVITE LIST ALREADY ACTIVE RT CODE    14080000
BLANK    EQU   X'40'              A BLANK CHAR.                         14160000
D0       EQU   0                  DISP OF 0                             14240000
D1       EQU   1                  DISP OF 1                             14320000
D2       EQU   2                  DISP OF 2                             14400000
D3       EQU   3                  DISP OF 3                             14480000
D4       EQU   4                  DISP OF 4                             14560000
D5       EQU   5                  DISP OF 5                             14640000
D6       EQU   6                  DISP OF 6                             14720000
D7       EQU   7                  DISP OF 7                             14800000
D8       EQU   8                  DISP OF 8                             14880000
D9       EQU   9                  DISP OF 9                             14960000
D10      EQU   10                 DISP OF 10                            15040000
D11      EQU   11                 DISP OF 11                            15120000
D12      EQU   12                 DISP OF 12                            15200000
D13      EQU   13                 DISP OF 13                            15280000
D14      EQU   14                 DISP OF 14                            15360000
D15      EQU   15                  DISP OF 15                           15440000
D16      EQU   16                 DISP OF 16                            15520000
D19      EQU   25                 DISP OF 25                     S22024 15600000
DCBNIDLE EQU   X'02'              3705 ACTIVE                    S22024 15680000
D20      EQU   20                 DISP OF 20                            15760000
D22      EQU   22                 DISP OF 22                            15840000
D24      EQU   24                 DISP OF 24                            15920000
D28      EQU   28                 DISP OF 28                            16000000
D32      EQU   32                 DISP OF 32                            16080000
D40      EQU   40                 DISP OF 40                     S22024 16160000
X60      EQU   X'60'              MASK FIELD                    SA61759 16240000
TSONLY   EQU   X'40'              TSO ONLY SYSTEM CHECK         SA61759 16320000
         EJECT                                                          16400000
         SPACE 2                                                        16480000
**************************************************************** S99528 16560000
*                                                              * S99528 16640000
*        PERFORM INITIALIZATION                                * S99528 16720000
*                                                              * S99528 16800000
**************************************************************** S99528 16880000
         SPACE 1                                                        16960000
         SAVE  (14,12)            SAVE CALLER'S REGISTERS        S99528 17040000
         LR    R6,R15                   LOAD BASE                       17120000
         DROP  R15                                                      17200000
         USING IEDQWJ2,R6                                               17280000
         USING TOTOLTCB,R2                                       S22024 17360000
         LA    R3,TOTSAVE4        PICK UP SAVE AREA ADDRESS      S99528 17440000
         ST    R3,D8(R13)         STORE IN CALLER'S SAVE         S22024 17520000
         ST    R13,D4(R3)         SAVE CALLER'S                  S22024 17600000
         LR    R13,R3                   SET R13 TO SAVE AREA            17680000
         L     R10,TOTAVTPT       GET AVT ADDRESS              @Y17XAUU 17760000
         USING IEDQAVTD,R10                                             17840000
         L     R3,AVTRNMPT             PICK UP ADDR OF TERMNAME TABLE   17920000
         ST    R3,TERNMTAB             SAVE IT                          18000000
         MVC   PAREMLST(D1),AVTBSX SET UP FOR BINARY SEARCH      S22024 18080000
         L     R3,AVTMSGS-D1      VCON TABLE ADDR                S22024 18160000
         L     R3,D8(R3)          ADDR OF A1 ROUTINE             S22024 18240000
         ST    R3,AVTUISV         SAVE ADDRESS OF A1             S99528 18320000
         DROP  R10                                             @Y17XAUU 18400000
         LA    R3,TOTTRMBF        POINT TO TRM BUFFER            S99528 18480000
         ST    R3,TRMSAVE         SAVE ADDRESS OF TRM BUFFER     S99528 18560000
         MVC   TRMWRK(TRMLEN),D0(R3) TRM TO WORK AREA            S22024 18640000
         OI    TOTFLG09,TOTPRECT  SET AP = CT FLAG              SA41610 18720000
         LA    R3,D3              SET COUNTER                    S22024 18800000
         LA    R4,TRMWRK               SET POINTER                      18880000
FLDHUNT  EQU   *                                                        18960000
         CLI   D0(R4),SLASH       END OF FIELD                   S22024 19040000
         BE    FLDFIND                 YES BRANCH                       19120000
         LA    R4,D1(R4)          BUMP POINTER                   S22024 19200000
         B     FLDHUNT                 NO GO LOOK AGAIN                 19280000
FLDFIND  EQU   *                                                        19360000
         LA    R4,D1(R4)          BUMP PAST SLASH                S22024 19440000
         BCT   R3,FLDHUNT         GO EXAMINE NEXT CHARACTER      S99528 19520000
*                                                                       19600000
*        R4 ADDRESS OF OPTION FIELD                                     19680000
*                                                                       19760000
APHUNT   EQU   *                                                        19840000
         TM    $ERROPT,$ALTPRNT   AP OPTION SET                  S22024 19920000
         BZ    EXIT               NO EXIT                        S22024 20000000
         CLC   D0(D2,R4),AP       AP OPTION                      S22024 20080000
         BE    APFIND                  YES BRANCH                       20160000
         CLI   D0(R4),SLASH       END OF FIELD                   S22024 20240000
         BE    EXIT                      YES                            20320000
         LA    R4,D1(R4)          NO - BUMP POINTER              S22024 20400000
         B     APHUNT                  GO LOOK AGAIN                    20480000
APFIND   EQU   *                                                        20560000
         LR    R3,R4                   SAVE POINTER                     20640000
         MVC   SAVE(D20),D2(R4)   MOVE REST OF TRM TO SAVE       S22024 20720000
APFIND1  EQU   *                                                        20800000
         OC    TOTAPUCB(D2),TOTAPUCB INVALID AP                  S22024 20880000
         BZ    PMT204                      NO                           20960000
         SR    R8,R8              CLEAR REGISTER 8               S99528 21040000
         ICM   R8,3,TOTAPUCB      GET UCB ADDRESS FOR AP       @G36XRUV 21120010
         USING UCB,R8                                                   21200000
         MVI   RNAME,X40          BLANK NAME                     S99528 21280000
         MVC   RNAME+D1(D7),RNAME FIELD                          S99528 21360000
         MVC   RNAME(D3),UCBNAME  MOVE RESOURCE NAME TO PLIST    S22024 21440000
         DROP  R8                                                       21520000
         DEQ   ,MF=(E,DEQLIST)    ISSUE DEQ                             21600000
PMT204   EQU   *                                                        21680000
         NI    TOTAPFLG,XFF-TOTAPORN CLR AP ON 3705 FLAG         S22024 21760000
         IEDQMSG MSGID=056,FUNCT=CEC,LINK=YES  ALT PRINTER LOCATION     21840000
         SPACE                                                          21920000
         IEDQMSG MSGID=055,FUNCT=REP,INBUF=CEIN,INCNT=10  VALID AP      22000000
APFIND2  EQU   *                                                 S22024 22080000
         CLC   CEIN(D6),SYSOUTA   SYSOUT                         S22024 22160000
         BE    SYSOUT                  YES BRANCH                       22240000
         CLC   CEIN(D6),SYSCONA   SYSTEM CONSOLE                 S22024 22320000
         BE    SYSCON             YES, BRANCH                    S99528 22400000
*                                                                       22480000
*        FIND END OF NAME                                               22560000
*                                                                       22640000
         LA    R5,9                    SET UP COMPARAND                 22720000
         LA    R4,CEIN                 SET UP POINTER                   22800000
         LA    R10,0                    SET UP COUNTER                  22880000
ENDHUNT  EQU   *                                                        22960000
         CLI   D0(R4),BLANK       END OF ENTRY                   S22024 23040000
         BE    ENDFIND                 YES BRANCH                       23120000
         LA    R10,D1(R10)        NO - BUMP POINTER              S22024 23200000
         CR    R5,R10                   GT 8?                           23280000
         BE    ERR1                    YES BRANCH                       23360000
         LA    R4,D1(R4)          BUMP POINTER                   S22024 23440000
         B     ENDHUNT            FIND END OF AP NAME            S99528 23520000
ENDFIND  EQU   *                                                        23600000
         LTR   R10,R10            WAS A NAME ENTERED?                   23680000
         BZ    ERR2                 NO                                  23760000
         STC   R10,LENGTH               SET UP BINARY SEARCH            23840000
         BCTR  R10,R0             DECREMENT FOR MOVE             S22024 23920000
         MVI   WORK1,X40          BLANK NAME                     S99528 24000000
         MVC   WORK1+D1(D7),WORK1 FIELD                          S99528 24080000
         EX    R10,NAMOVE         GO MOVE NAME INTO WORK AREA    S99528 24160000
         MVC   TOTAPNAM(D8),WORK1 MOVE AP NAME TO OLTCB          S22024 24240000
         BAL   R9,NAMESRCH        VERIFY AP NAME                 S99528 24320000
         B     NAMEOK                  BRANCH AROUND ERROR RETURN       24400000
         B      ERR2              ERROR EXIT                     S99528 24480000
NAMOVE   MVC   WORK1(D0),CEIN     AP NAME TO WORK AREA           S22024 24560000
NAMEOK   EQU   *                                                        24640000
         BAL   R9,DEVCHK          VERIFY AP TERMINAL             S22024 24720000
         MVC   TOTARTNT(D4),TRMTNT SAVE REAL AP TNT ADDR                24800000
         BAL   R9,UCBFIND              GET ALTERNATE PRINTER UCB ADR    24880000
         STH   R8,TOTAPUCB        SAVE IN OLTCB                         24960000
         BAL   R9,DUMMYTNT        REQUEST DUMMY ENTRIES          S22024 25040000
         BAL   R9,LCBSCAN         FIND AP LCB ADDR                      25120000
         ST    R11,TOTAPLCB-1     PUT LCB ADDR IN OLTCB                 25200000
         MVC   TOTAPRLN(D1),TRMRLN AP RLN                        S22024 25280000
         USING UCB,R8                                                   25360000
         MVI   RNAME,X40          BLANK NAME                     S99528 25440000
         MVC   RNAME+D1(D7),RNAME FIELD                          S99528 25520000
         MVC   RNAME(3),UCBNAME        PUT RESOURCE NAME IN PARM LIST   25600000
         ENQ   ,MF=(E,ENQLIST)         REQUEST USE OF RESOURCE          25680000
         LTR   R15,R15                 IS RESOURCE ASSIGNED?            25760000
         BZ    PMT2404                   YES                            25840000
         CLI   D3(R15),D8         RESOURCE ALREADY ASSIGNED      S22024 25920000
         BE    PMT2404                   YES                            26000000
PMT2400  EQU   *                                                        26080000
         IEDQMSG MSGID=054,FUNCT=CEC  TERMINAL IN USE MESSAGE    S99528 26160000
         BAL   R7,CONT                 CONTINUE PROMPTING?              26240000
         B     PMT2704                   YES                            26320000
PMT2404  EQU   *                                                        26400000
*                                                                       26480000
*        ENQ AP SYMBOLIC NAME                                           26560000
*                                                                       26640000
         MVC   RNAME(D8),CEIN     AP NAME TO ENQUEUE LIST        S99528 26720000
         ENQ   ,MF=(E,ENQLIST)    REQUEST USE OF RESULT                 26800000
*                                                                       26880000
         LTR   R15,R15            REQUEST ENQ'ED ?                      26960000
         BZ    PMT2404            YES                                   27040000
         CLI   D3(R15),D8         ALREADY ENQ'ED ?                      27120000
         BE    PMT2080            YES                            S05331 27200000
*        DEQ AP UCB NAME                                         S05331 27280000
         MVI   ENQLIST+D2,DEQFLG  SET DEQ FLAG                   S05331 27360000
         MVI   RNAME,X40          BLANK NAME                     S05331 27440000
         MVC   RNAME+D1(D7),RNAME FIELD                          S05331 27520000
         DEQ   ,MF=(E,ENQLIST)    DEQ AP UCB NAME                S05331 27600000
         MVI   ENQLIST+D2,ENQFLG  RESTORE ENQ FLAG               S05331 27680000
         B     PMT2400            ERROR EXIT                     S05331 27760000
         DROP  R8                                                S05331 27840000
PMT2080  DS    0H                 BOUNDARY ALLIGNMENT            S05331 27920000
         BAL   R9,RNLINET         CHECK FOR RN TERM FOR L ENQ    S22024 28000000
*                                                                       28080000
         OI    TOTFLG09,TOTPRECT  ASSUME AP EQU CT               S22024 28160000
         SR    R5,R5              CLEAR REG 5                           28240000
         IC    R5,LENGTH          GET LENGTH OF AP NAME                 28320000
         BCTR  R5,R0              DECREMENT FOR COMPARE                 28400000
         EX    R5,CTEQUAP         CT = AP                               28480000
         BE    PMT2086                   YES                            28560000
         NI    TOTFLG09,XFF-TOTPRECT CORRECT OPTION              S22024 28640000
         OI    TOTFLG09,TOTAPTRM  AP EQU TERMINAL FLAG           S22024 28720000
         BAL   R9,DEVPRT          CHECK FOR DEVICE PROTECT       S22024 28800000
PMT2086  EQU   *                                                        28880000
         EX    R10,MOVE                 MOVE TERM TO TRM                28960000
DMOVE    EQU   *                                                        29040000
         LA    R10,D1(R10)        RESTORE COUNT                  S22024 29120000
         LA    R3,2(R10,R3)             POINT TO END OF TERM NAME       29200000
         MVC   D0(D20,R3),SAVE    RESTORE TRM                    S22024 29280000
         L     R3,TRMSAVE             L PICK UP BUFFER IN OLTCB         29360000
         MVC   D0(TRMLEN,R3),TRMWRK TRM TO OLTCB                 S22024 29440000
EXIT     EQU   *                                                        29520000
         TM    TOTFLG06,TOTNCMFG  NCM REQUESTED                  S22024 29600000
         BZ    PMT259                    NO                             29680000
         BAL   R9,RNCHK           DETERMINE IF TD ON 3705        S22024 29760000
         LA    R7,NCMMSG2         GET START OF DEVICE FLD OF MSG S22024 29840000
         LA    R9,TDMAX                                          S22024 29920000
         LA    R8,TOTTDTBL        GET START OF TEST DEVICE TABLE        30000000
         TM    TOTTDTBL,TOTTDTRM  TERMINAL TEST                         30080000
         BO    TRMTNCM            YES - BRANCH                          30160000
         MVC   WORK3(D4),D0(R8)   UCB ADDR                       S22024 30240000
         MVI   WORK3,D0           CLEAR FLAG BYTE                       30320000
         B     PMT2506A           CHECK NEXT ENTRY               S99528 30400000
PMT2506  EQU   *                                                        30480000
         MVC   WORK3(D4),D0(R8)   SAVE ENTRY                            30560000
         CLC   D0(D4,R8),K0       ANY MORE ENTRIES               S22024 30640000
         BE    PMT2508                   NO                             30720000
         MVI   D0(R7),COMMA       MOVE COMMA TO MSG              S22024 30800000
         LA    R7,D1(R7)          POINT PASS COMMA               S22024 30880000
         TM    TOTFLG10,TOTTERMS  TERMINAL TEST ?                       30960000
         BO    TRMTNCM            YES - BRANCH                          31040000
PMT2506A EQU   *                                                        31120000
         BCT   R9,PMT2507              END OF TABLE?                    31200000
         B     PMT2508                   YES                            31280000
PMT2507  EQU   *                                                        31360000
         L     R5,WORK3           GET UCB ADDR                          31440000
         MVC   D0(D3,R7),D13(R5)  MOVE NEXT LINE ADDR TO MSG     S22024 31520000
         USING UCB,R5                                            S22024 31600000
         TM    TOTFLG10,TOTTERMS   IS THIS A TERMINAL TEST       S22024 31680000
         BO    TRM25072            YES BYPASS THIS MIX TEST      S22024 31760000
*                                  NO TEST FOR MIXED 270X / 3705 S22024 31840000
         CLI   UCBTBYT4,TYPE1CA    3704/5 TYPE 1 CA              S22024 31920000
         BE    TRM25071            YES SET PROPER BIT            S22024 32000000
         CLI   UCBTBYT4,TYPE2CA    3704/5 TYPE 2 CA              S22024 32080000
         BE    TRM25071            YES SET PROPER BIT            S22024 32160000
         OI    TOTFLG02,TOTDEV0X   CHANNEL TEST ON 2701,2,3      S22024 32240000
         B     TRM25072            CONTINUE CHECKING TCU'S       S22024 32320000
TRM25071 DS    0H                  ALIGN ON HALFWORD             S22024 32400000
         OI    TOTFLG02,TOTDEVRN   CHANNEL TEST ON 3704,5        S22024 32480000
         DROP  R5                                                S22024 32560000
TRM25072 DS    0H                 ALIGN ON HALFWORD              S22024 32640000
         LA    R8,D4(R8)          BUMP TO NEXT TEST DEVICE       S22024 32720000
         LA    R7,D3(R7)          BUMP TO NEXT ENTRY OF MSG      S22024 32800000
         B     PMT2506            GET NEXT ENTRY                        32880000
PMT2508  EQU   *                                                        32960000
         TM    TOTFLG02,TOTDEV0X+TOTDEVRN ARE BOTH TCU BITS ON   S22024 33040000
         BO    TRM25042                    YES PRINT ERROR       S22024 33120000
         TM    TOTFLG02,TOTDEVRN   IS TEST FOR 3704/3705         S22024 33200000
         BO    TRM25043            YES ASK FOR PERMISSION        S22024 33280000
*                                  NO  ASK TO USE 270X LINES     S22024 33360000
         WTO   'IED224D CAN OLT HAVE EXCLUSIVE USE OF CONTROL UNIT ON A*33440000
               DDRESS(ES) ',ROUTCDE=10,DESC=7                    S22024 33520000
TRM25041 DS    0H                  ALIGN ON HALFWORD             S22024 33600000
         XC    ECB(D4),ECB        CLEAR ECB FOR WTOR             S22024 33680000
WTORNCM  WTOR  '                                                     ',*33760000
               ANSWER,3,ECB,ROUTCDE=(8,10),DESC=2                S22024 33840000
NCMMSG2  EQU   WTORNCM+D16        LINE TO MESSAGE                S22024 33920000
         STIMER REAL,NOANS,DINTVL=TIMOUT    SET TIMER FOR TIMEOUT       34000000
         WAIT  ECB=ECB                 WAIT FOR REPLY                   34080000
         TTIMER CANCEL                 CANCEL TIMER                     34160000
         OI    ANSWER,BLANK       XLATE TO CAPS                  S22024 34240000
         CLI   ANSWER,YES         YES                            S22024 34320000
         BE    PMT259                    YES                            34400000
         IEDQMSG MSGID=051,FUNCT=CEC    ALLOW ONLY CONCURRENT MODE      34480000
         SPACE                                                          34560000
         B     GETOUT             GO EXIT TO IEDQWE FOR TERMINATION     34640000
TRM25042 DS    0H                  ALIGN ON HALFWORD             S22024 34720000
         IEDQMSG MSGID=001,FUNCT=CEC   INVALID MIX OF TCU TYPES  S22024 34800000
         B     GETOUT              CLEAN UP AND RETURN           S22024 34880000
TRM25043 DS    0H                  ALIGN ON HALFWORD                    34960000
         WTO   'IED235D CAN OLT HAVE EXCLUSIVE USE OF 3705 ON ADDRESS(E*35040000
               S) ',ROUTCDE=10,DESC=7                            S22024 35120000
         B     TRM25041            PRINT REST OF MESSAGE         S22024 35200000
PMT259   EQU   *                                                        35280000
         L     R13,D4(R13)        CALLER'S SAVE                  S22024 35360000
         TM    TOTFLG02,TOTCONMD  TD ON CONC                    SA41597 35440000
         BZ    PMT260             NO                            SA41597 35520000
         LM    R14,R1,D12(R13)    CALLER'S REG                  SA41597 35600000
         XCTL  (2,12),EP=IEDQWEC  YES - EXIT TO IEDQWC          SA41597 35680000
         SPACE                                                          35760000
PMT260   EQU   *                                                SA41597 35840000
         L     R14,D12(R13)       RESTORE REG 14                 S22024 35920000
         XCTL  (2,12),EP=IEDQWD   XFER CONTROL TO DISPATCHER     S22024 36000000
SYSOUT   EQU   *                                                        36080000
         MVC   D2(D6,R3),SYSOUTA  SYSOUT TO TRM                  S22024 36160000
         NI    TOTFLG09,XFF-TOTPRECT CLEAR PRINTER = CT FLAG     S22024 36240000
         OI    TOTFLG09,TOTAPOUT  SET PRINTER = SYSOUT FLAG      S22024 36320000
         LA    R10,5              PUT 5 INTO REGISTER 10                36400000
         B     DMOVE              MOVE TRM TO OLTCB              S99528 36480000
SYSCON   EQU   *                                                        36560000
         MVC   D2(D6,R3),SYSCONA  SYSCON TO TRM                  S22024 36640000
         OI    TOTFLG09,TOTAPCON  ALT PRINTER EQU SYSCON       @YM08408 36720000
         OI    TOTFLG09,TOTPRECT  ASSUME PRINTER EQU CT          S22024 36800000
         TM    TOTFLG09,TOTCTCON  CT EQU SYSCON                  S22024 36880000
         BO    SYSCON2            YES, BRANCH                    S99528 36960000
         NI    TOTFLG09,XFF-TOTPRECT CLEAR PRT EQU CT FLAG       S22024 37040000
SYSCON2  EQU   *                                                        37120000
         LA    R10,D5             EXECUTE COUNT                  S22024 37200000
         B     DMOVE              MOVE TRM TO OLTCB                     37280000
MOVE     MVC   D2(D0,R3),CEIN     MOVE AP NAME                   S22024 37360000
ERR2     EQU   *                                                        37440000
         IEDQMSG MSGID=046,FUNCT=CEC  INVALID AP                 S99528 37520000
         BAL   R7,CONT                 GO SEE IF TO CONTINUE            37600000
         B     APFIND1                 YES GO ASK AGAIN                 37680000
ERR1     EQU   ERR2               INVALID AP                     S22024 37760000
PMT2704  EQU   *                                                        37840000
         IEDQMSG MSGID=048,FUNCT=REP,INBUF=CEIN,INCNT=10 ENTER OPTION   37920000
         CLC   CEIN(D3),NAP       NAP OPTION                     S22024 38000000
         BE    NEWNAP                  YES BRANCH                       38080000
         B     APFIND2            GO FIND AP OPTION                     38160000
NEWNAP   EQU   *                                                        38240000
         MVC   D0(D3,R3),NAP      MOVE NAP TO TRM                S22024 38320000
         MVC   D3(D20,R3),SAVE    RESTORE TRM                    S22024 38400000
         MVC   TOTTRMBF(TRMLEN),TRMWRK TRM TO OLTCB              S22024 38480000
         B     EXIT               CONTINUE PROCESSING            S99528 38560000
CONT     EQU   *                                                        38640000
         IEDQMSG MSGID=057,FUNCT=REP,INBUF=CEIN,INCNT=3  CONTINUE?      38720000
         SPACE                                                          38800000
         CLI   CEIN,YES           YES                            S22024 38880000
         BCR   8,R7               YES                                   38960000
         CLI   CEIN,NO            NO                             S22024 39040000
         BE    GETOUT                  YES LEAVE                        39120000
         IEDQMSG MSGID=079,FUNCT=CEC  INVALID RESPONSE           S99528 39200000
         SPACE                                                          39280000
         B     CONT               GO SEE IF CE WANTS TO CONTINUE?       39360000
         EJECT                                                          39440000
**************************************************************** S22024 39520000
*        ROUTINE TO FIND THE SYMBOLIC NAME OF THE RN LINE      * S22024 39600000
*        FOR THE TERMINAL ATTACHED TO THE RN.                  * S22024 39680000
**************************************************************** S22024 39760000
RNLINET  EQU   *                                                 S22024 39840000
         STM   R7,R11,TRMSAVE2    SAVE CALLER'S REG              S22024 39920000
         L     R11,TNTENTRY       TTE ADDR                       S22024 40000000
         USING IEDNTRM,R11                                       S22024 40080000
         LA    R7,TRMPRFSZ        GET TTE PREFIX SIZE          @Y17XAUU 40160000
         SLR   R11,R7             POINT TO TTE PREFIX          @Y17XAUU 40240000
         TM    TRMSTATE,TRMPREF   3705 RESOURCE                @Y17XAUU 40320000
         BZ    RNLINEND           NO                             S22024 40400000
         TM    TRMSTATE,XE0       RN TERMINAL                    S22024 40480000
         BNZ   RNLINEND           NO                             S22024 40560000
         LH    R7,TRMTTCIN        GET TERMINAL TTCIN           @Y17XAUU 40640000
         STH   R7,TOTAROFF        AP TTCIN                     @Y17XAUU 40720000
         OI    TOTAPFLG,TOTAPORN  AP ON 3705                     S22024 40800000
         L     R4,TOTAVTPT        GET AVT ADDRESS              @Y17XAUU 40880000
         USING IEDQAVTD,R4        SET AVT ADDRESSABILITY       @Y17XAUU 40960000
         L     R4,AVTSAVTP        GET SAVT ADDRESS             @Y17XAUU 41040000
         DROP  R4                                              @Y17XAUU 41120000
         USING IEDNSVTD,R4        SET SAVT ADDRESSABILITY      @Y17XAUU 41200000
         L     R15,SAVTTNTX       TTCIN TO NETWORK ADDR RTN    @Y17XAUU 41280000
         DROP  R4                                              @Y17XAUU 41360000
         LH    R1,TRMTTCIN        GET TERMINAL TTCIN           @Y17XAUU 41440000
         BALR  R14,R15            CALL CONVERSION ROUTINE      @Y17XAUU 41520000
         STH   R15,TOTARSID       SAVE NETWORK ADDRESS         @YM07278 41600000
         L     R10,TRMQCB         GET QCB ADDR                   S22024 41680000
         USING IEDQQCB,R10                                       S22024 41760000
         L     R10,QCBLGBAD-D1    LGB ADDR                       S22024 41840000
         LA    R10,D0(R10)        CLEAR HIGH ORDER BYTE          S22024 41920000
         DROP  R10                                               S22024 42000000
         USING IEDNLGB,R10                                       S22024 42080000
         MVC   TOTAPRNL(D8),LGBNAME SAVE LINE GROUP NAME         S22024 42160000
         DROP  R10                                             @Y17XAUU 42240000
CHKTTE   DS    0H                 FIND LINE TNT ENTRY          @Y17XAUU 42320000
         LH    R1,TRMCOHRT        GET TTCIN OF NEXT ENTRY      @Y17XAUU 42400000
         LR    R9,R1              SAVE TTCIN                   @Y17XAUU 42480000
         L     R15,TERNMTAB       TTCIN TO TTE CONVERSION      @Y17XAUU 42560000
*                                 ROUTINE ADDRESS              @Y17XAUU 42640000
         BALR  R14,R15            FIND TTE ADDRESS             @Y17XAUU 42720000
         LR    R11,R1             GET TTE ADDRESS              @Y17XAUU 42800000
         LA    R1,TRMPRFSZ        GET TTE PREFIX SIZE          @Y17XAUU 42880000
         SLR   R11,R1             POINT TO TTE PREFIX          @Y17XAUU 42960000
         CLI   TRMTYPE,TRMNSDLC   PRE SNA LINE ENTRY           @Y17XAUU 43040000
         BE    LINETTE            YES                          @Y17XAUU 43120000
         CLI   TRMTYPE,TRMSDLC    SNA LINE ENTRY               @Y17XAUU 43200000
         BNE   CHKTTE             NO - CHECK NEXT ENTRY        @Y17XAUU 43280000
LINETTE  DS    0H                 FIND LINE SYMBOLIC NAME      @Y17XAUU 43360000
         BCTR  R9,R0              DECREMENT FOR MULTIPLY       @Y17XAUU 43440000
         L     R1,TERNMTAB        SET TNT BASE                 @Y17XAUU 43520000
         USING IEDQTNTD,R1        SET TNT ADDRESSABILITY       @Y17XAUU 43600000
         SLR   R8,R8              CLEAR REG                    @Y17XAUU 43680000
         IC    R8,TNTENLEN        LENGTH OF NAME               @Y17XAUU 43760000
         LA    R8,D3(R8)          TOTAL LEN OF A TNT ENTRY     @Y17XAUU 43840000
         MR    R8,R8              OFFSET TO LINE TNT ENTRY     @Y17XAUU 43920000
         LA    R10,TNTFIRST(R9)   LINE TNT ADDRESS             @Y17XAUU 44000000
         DROP  R1                                              @Y17XAUU 44080000
         DROP  R11                                             @Y17XAUU 44160000
         SPACE                                                          44240000
*                                                                S22024 44320000
*        ENQUEUE THE RN LINE SHARED                              S22024 44400000
*                                                                S22024 44480000
RN0C     EQU   *                                                        44560000
         SR    R9,R9              CLEAR REG                      S22024 44640000
         IC    R9,TOTTTBEL        MAX NAME LENGTH                S22024 44720000
         BCTR  R9,R0              DECREMENT FOR EXECUTE          S22024 44800000
         EX    R9,RNENQ           MOVE RN LINE NAME TO ENQ LIST  S22024 44880000
         SPACE                                                          44960000
         ENQ   ,MF=(E,ENQLIST)    ENQ RN LINE                    S22024 45040000
         LTR   R15,R15            WAS IT ASSIGNED                S05331 45120000
         BZ    RNLINEND           YES                            S05331 45200000
         CLI   D3(R15),D8         WAS IT PREVIOUSLY ASSIGNED     S05331 45280000
         BE    RNLINEND           YES                            S05331 45360000
*        DEQ AP TERMINAL NAME AND UCB NAME                       S05331 45440000
         SR    R8,R8              CLEAR                        @G36XRUV 45480010
         ICM   R8,3,TOTAPUCB      AP UCB ADDR                  @G36XRUV 45520010
         LA    R7,TOTAPNAM        ADDR OF AP NAME                S05331 45600000
         USING UCB,R8                                            S05331 45680000
         MVI   ENQLIST+D2,DEQFLG  SET DEQ FLAG                   S05331 45760000
         MVC   RNAME(D8),D0(R7)   GET TERMINAL NAME              S05331 45840000
         DEQ   ,MF=(E,ENQLIST)    DEQ IT                         S05331 45920000
         MVI   RNAME,X40          BLANK NAME                     S05331 46000000
         MVC   RNAME+D1(D7),RNAME FIELD                          S05331 46080000
         MVC   RNAME(D3),UCBNAME  GET UCB NAME                   S05331 46160000
         DEQ   ,MF=(E,ENQLIST)    DEQ IT                         S05331 46240000
         MVI   ENQLIST+D2,ENQFLG  RESORE ENQ FLAG                S05331 46320000
         B     PMT2400            ERROR EXIT                     S05331 46400000
         DROP  R8                                                S05331 46480000
         SPACE                                                          46560000
RNLINEND EQU   *                                                 S22024 46640000
         LM    R7,R11,TRMSAVE2    RESTORE REG                    S22024 46720000
         BR    R9                 RETURN                         S22024 46800000
RNENQ    MVC   RNAME(D0),D0(R10)  MOVE RN LINE NAME TO ENQ LIST         46880000
         EJECT                                                          46960000
GETOUT   EQU   *                                                        47040000
         OI    TOTFLG06,TOTOTERM  TERMINATE FLAG                 S22024 47120000
         L     R13,D4(R13)        CALLER'S SAVE                  S22024 47200000
         L     R14,D12(R13)       RETURN ADDR                    S22024 47280000
         XCTL  (2,12),EP=IEDQWE        GO TO IEDQWE                     47360000
         EJECT                                                          47440000
NOANS    EQU   *                                                        47520000
         STM   R14,R12,D12(R13)   SAVE CALLER'S REG              S22024 47600000
         LR    R4,R15                  GET MY BASE                      47680000
         USING NOANS,R4                                                 47760000
         LA    R12,TOTSAVE1       MY SAVE AREA                   S22024 47840000
         ST    R13,D4(R12)        SAVE HIS SAVE ADDR             S22024 47920000
         ST    R12,D8(R13)        SAVE MY SAVE ADDR              S22024 48000000
         LR    R13,R12                 SET SAVE POINTER                 48080000
         POST  ECB                     POST WTOR ECB                    48160000
         L     R13,D4(R13)        CALLER'S SAVE                  S22024 48240000
         LM    R14,R12,D12(R13)   RESTORE REGISTERS              S22024 48320000
         SR    R15,R15            CLEAR RETURN CODE REG          S22024 48400000
         BR    R14                     RETURN TO CALMLER                48480000
         DROP  R4                                                       48560000
         SPACE 2                                                        48640000
**************************************************************** S22024 48720000
*        ROUTINE TO DETERMINE IF TD IS ON A 3705. IF SO ,      * S22024 48800000
*        THE NCM OPTION IS TURNOFF.                            * S22024 48880000
**************************************************************** S22024 48960000
RNCHK    EQU   *                                                 S22024 49040000
         STM   R7,R9,TRMSAVE1     SAVE REGISTERS                 S22024 49120000
         LA    R7,TOTTDTBL        POINT TO TEST DEVICE TABLE     S22024 49200000
         LA    R8,TOTTDEND        END OF TABLE                   S22024 49280000
RNCHK2   EQU   *                                                 S22024 49360000
         CR    R7,R8              END OF TABLE                   S22024 49440000
         BE    RNCHKE             YES - EXIT (NO 3705 TD)        S22024 49520000
         L     R9,D0(R7)          GET TD ENTRY                   S22024 49600000
         LTR   R9,R9              ANY MORE ENTRIES               S22024 49680000
         BZ    RNCHKE             NO - EXIT (NO 3705 TD)         S22024 49760000
         SPACE                                                          49840000
         TM    D0(R7),TOTTDORN    TD ON 3705                     S22024 49920000
         BO    RNCHKNCM           YES                            S22024 50000000
         LA    R7,D4(R7)          POINT TO NEXT ENTRY            S22024 50080000
         B     RNCHK2             CHECK IT                       S22024 50160000
         SPACE                                                          50240000
RNCHKE   EQU   *                                                 S22024 50320000
         LM    R7,R9,TRMSAVE1     RESTORE REGISTERS                     50400000
         BR    R9                 RETURN                         S22024 50480000
         SPACE                                                          50560000
RNCHKNCM EQU   *                                                 S22024 50640000
         NI    TOTFLG06,XFF-TOTNCMFG SET CM                      S22024 50720000
         IEDQMSG MSGID=008,FUNCT=CEC NCM REJECTED                S22024 50800000
         B     PMT259             EXIT                           S22024 50880000
         EJECT                                                          50960000
*              ROUTINE TO SEARCH TERMNAME TABLE. R3 HAS ADDR OF         51040000
*              START OF TABLE. WORK1 HAS NAME IN IT. R2 HAS LENGTH      51120000
*                                                                       51200000
NAMESRCH EQU   *                                                        51280000
         LA    R1,PAREMLST              SET R1                          51360000
         L     R15,AVTUISV        GET ADDRESS OF A1                     51440000
         LH    R0,TWO(R1)         LOAD CHAR STRING LEN                  51520000
         L     R1,FOUR(R1)        LOAD ADDR OF CHARS                    51600000
         BAL   R14,FOUR(R15)      BRANCH TO SCAN ROUTINE                51680000
         LTR   R15,R15                                                  51760000
         BZ    D4(R9)             NAME NOT FOUND                 S22024 51840000
         STH   R15,TRMTTCIN       SAVE TTCIN                   @Y17XAUU 51920000
         SPACE                                                          52000000
         STM   R7,R9,TRMSAV1      SAVE REG 7-9                          52080000
         L     R8,TERNMTAB        GET START OF TABLE                    52160000
         USING IEDQTNTD,R8                                              52240000
         LA    R7,TNTFIRST        POINT TO FIRST ENTRY IN TABLE         52320000
         SR    R9,R9              CLEAR REG 9                           52400000
         IC    R9,TNTENLEN        GET MAX. LENGTH OF NAME FIELD         52480000
         LA    R9,D3(R9)          LENGTH OF ONE ENTRY            S22024 52560000
         DROP  R8                                                       52640000
         BCTR  R15,R0             DECREMENT ENTRY REL POSITION   S22024 52720000
         MR    R8,R15             GET DISPLACEMENT TO ENTRY DESIRED     52800000
         AR    R7,R9              GET DESIRED TNT ADDRESS               52880000
         ST    R7,TRMTNT          SAVE IT                               52960000
         LA    R1,D1(R15)         RESTORE ENTRY REL POSITION     S22024 53040000
         STH   R15,TOTAROFF       SAVE AP REAL TTCIN           @Y17XAUU 53120000
         LM    R7,R9,TRMSAV1      RESTORE REG 7-9                       53200000
         SPACE                                                          53280000
         L     R15,TERNMTAB       GET ADDRESS OF TERMNAME TABLE         53360000
         BALR  R14,R15            GO SEARCH TABLE                       53440000
         ST    R1,TNTENTRY        SAVE TERMINAL ENTRY ADDRESS           53520000
         USING IEDQTRM,R1                                       SA61759 53600000
         TM    TRMDSORG,TRMLGB    LGB RATHER THAN A TTE          S22024 53680000
         BO    D4(R9)             YES - ERROR - NOT A TERMINAL   S22024 53760000
         L     R14,TOTAVTPT       GET AVT ADDRESS               SA61759 53840000
         USING IEDQAVTD,R14                                     SA61759 53920000
         MVC   WRKFLG(D1),AVTBIT1 GET ENVIRONMENTAL FLAG        SA61759 54000000
         NI    WRKFLG,X60         CLEAR UNWANTED BITS           SA61759 54080000
         CLI   WRKFLG,TSONLY      TSO ONLY SYSTEM               SA61759 54160000
         BE    TRMTSO             YES - TERMINATE TRM           SA61759 54240000
         DROP  R14                                              SA61759 54320000
         L     R1,TRMDESTQ-D1     DEST. QCB ADDR                SA61759 54400000
         DROP  R1                                               SA61759 54480000
         USING IEDQQCB,R1                                       SA61759 54560000
         TM    QCBFLAG,QCBTSSES   TSO TERMINAL                  SA61759 54640000
         BO    TRMTSO             YES - TERMINATE TRM           SA61759 54720000
         TM    QCBDSFLG,QCBREUS+QCBNREUS+QCBCORE  ARE THERE     SA61759 54800000
*                                 ANY QUEUES USED               SA61759 54880000
         BZ    TRMTSO             NO - TERMINATE                SA61759 54960000
         DROP  R1                                               SA61759 55040000
         BR    R9                 RETURN TO CALLER                      55120000
TRMTSO   DS    0H                 BOUNDARY ALLIGNMENT           SA61759 55200000
         IEDQMSG MSGID=011,FUNCT=CEC                            SA61759 55280000
         B     GETOUT             EXIT TO CLEANUP               SA61759 55360000
         EJECT                                                          55440000
TRMTNCM  EQU   *   R8 POINTS TO TEST ENTRY                              55520000
         OI    TOTFLG10,TOTTERMS  INSURE TER. FLAG SET           S22024 55600000
         STM   R7,R12,TRMSAVE1    SAVE WORK REG                         55680000
         L     R9,TRMNCMCT        GET  ENTRY COUNTER                    55760000
         LA    R9,D1(R9)          INCREMENT BY ONE                      55840000
         CL    R9,TRMTEN          END OF TABLE ?                        55920000
         BH    TRMNCM1            YES                                   56000000
         ST    R9,TRMNCMCT       SAVE COUNTER                           56080000
         L     R12,D0(R8)         GET TNT ADDR                          56160000
         LA    R12,D0(R12)         CLEAR HIGH ORDER BYTE                56240000
         LTR   R12,R12            LAST ENTRY ?                          56320000
         BZ    TRMNCM1            YES - BRANCH                          56400000
         SR    R10,R10            CLEAR REG                             56480000
         IC    R10,TOTTTBEL       GET NAME LENGTH                       56560000
         AR    R12,R10            GET ADDR OF TTE ADDR                  56640000
         MVC   TTEADDR+D1(D3),D0(R12)   ALLIGN ADDRESS                  56720000
         L     R11,TTEADDR        GET TTE ADDR                          56800000
         USING IEDQTRM,R11                                              56880000
         L     R11,TRMDESTQ-D1    GET QCB ADDR                          56960000
         DROP  R11                                                      57040000
         USING IEDQQCB,R11                                              57120000
         SR    R7,R7              CLEAR REG                             57200000
         IC    R7,QCBRELLN        GET RLN                               57280000
         SLL   R7,2               MULT BY 4                             57360000
         L     R11,QCBDCBAD-D1    GET DCB ADDR                          57440000
         DROP  R11                                                      57520000
         USING IHADCB,R11                                               57600000
         L     R11,DCBDEBAD       GET DEB ADDR                          57680000
         DROP  R11                                                      57760000
         USING DEBNMSUB,R11                                             57840000
         SR    R15,R15            CLEAR REG                             57920000
         IC    R15,DEBNMEXT       GET # OF EXTENTS                      58000000
         SLL   R15,D2             MULT BY 4                             58080000
         L     R11,DEBUCBAD-D4(R7)  GET UCB ADDR                        58160000
         ST    R11,WORK3          SAVE IT                               58240000
         LM    R7,R12,TRMSAVE1    RESTORE CALLER'S REG                  58320000
         B     PMT2507            RETURN                                58400000
TRMNCM1  EQU   *                                                        58480000
         BCTR  R7,R0              DECREMENT R7 BY 1                     58560000
         MVI   D0(R7),BLANK       BLANK OUT FIRST BYTE                  58640000
         LM    R7,R12,TRMSAVE1    RESTORE CALLER'S REG                  58720000
         B     PMT2508            RETURN                                58800000
         DROP  R11                                               S22024 58880000
         EJECT                                                          58960000
**************************************************************** S22024 59040000
*                                                              * S22024 59120000
*        ROUTINE TO VERIFY THAT THE SYMBOLIC NAME ENTERED      * S22024 59200000
*        AS THE ALTERNATE PRINTER IS A DEVICE AS OPPOSED TO    * S22024 59280000
*        A SUB CHANNEL HUNG OFF THE RN.                        * S22024 59360000
*                                                              * S22024 59440000
**************************************************************** S22024 59520000
DEVCHK   EQU   *                                                 S22024 59600000
         STM   R7,R11,TRMSAVE2    SAVE REGISTERS                 S22024 59680000
         L     R11,TNTENTRY       TTE ADDR                       S22024 59760000
         USING IEDNTRM,R11                                       S22024 59840000
         LA    R7,TRMPRFSZ        GET TTE PREFIX SIZE          @Y17XAUU 59920000
         SLR   R11,R7             POINT TO TTE PREFIX          @Y17XAUU 60000000
         TM    TRMSTATE,TRMPROC   VERIFY NOT PROCESS ENTRY     @Y17XAUU 60080000
         BO    DEVCHK8            PROCESS ENTRY - EXIT         @Y17XAUU 60160000
         TM    TRMSTATE,TRMPREF   3705 RESOURCE                @Y17XAUU 60240000
         BZ    DEVCHKE            NO - RETURN                    S22024 60320000
         CLI   TRMTYPE,TRMPUNT    PU ENTRY                     @Y17XAUU 60400000
         BE    DEVCHK8            YES - ERROR                  @Y17XAUU 60480000
         CLI   TRMTYPE,TRMLNCP    NCP ENTRY                    @Y17XAUU 60560000
         BE    DEVCHK8            YES - ERROR                  @Y17XAUU 60640000
         CLI   TRMTYPE,TRMSSCP    SSCP ENTRY                   @Y17XAUU 60720000
         BE    DEVCHK8            YES - ERROR                  @Y17XAUU 60800000
         TM    TRMSTATE,RNTERM    TERMINAL ATTACHED TO RN        S22024 60880000
         BZ    DEVCHKE            YES                            S22024 60960000
*                                                              * S22024 61040000
*        AN INVALID ENTRY HAS BEEN MADE IN THE AP FIELD        * S22024 61120000
*                                                              * S22024 61200000
DEVCHK8  DS    0H                 BOUNDARY ALLIGNMENT            S22024 61280000
         LM    R7,R11,TRMSAVE2    CALLER'S REGISTERS             S22024 61360000
         B     ERR2               NOTIFY OF ERROR                S22024 61440000
         SPACE                                                          61520000
DEVCHKE  EQU   *                                                 S22024 61600000
         TM    TRMSTATE,TRMPREF   3705 RESOURCE                @Y17XAUU 61680000
         BO    DEVCHKED           YES - BYPASS CHECK             S22024 61760000
         TM    TRMSTATE,XE0       TERMINAL ENTRY                 S22024 61840000
         BZ    DEVCHKED                 YES, VALID TERMINAL    @SA70654 61920000
         MVC   WRKFLG(D1),TRMSTATE      GET FLAG BYTE          @SA70654 62000000
         NI    WRKFLG,XE0               CLEAR UNWANTED FLAGS   @SA70654 62080000
         CLI   WRKFLG,RNLINE            270X DIAL TERMINAL     @SA70654 62160000
         BZ    DEVCHK8                  NO, ERROR              @SA70654 62240000
DEVCHKED DS    0H                 BOUNDARY ALLIGNMENT            S22024 62320000
         LM    R7,R11,TRMSAVE2    CALLER'S REGISTERS             S22024 62400000
         BR    R9                 RETURN TO CALLER               S22024 62480000
         DROP  R11                                                      62560000
         EJECT                                                          62640000
**************************************************************** S22024 62720000
*                                                              * S22024 62800000
*        ROUTINE TO LOAD CDS RECORD FOR ALTERNATE PRINTER TO   * S22024 62880000
*        DETERMINE IF THE DEVICE PROTECT FEATURE IS SET. IF    * S22024 62960000
*        EITHER THE RECORD IS NOT FOUND OR THE OPTION IS SET   * S22024 63040000
*        THE SYSTEM OPERATOR WILL BE REQUESTED TO GIVE         * S22024 63120000
*        AUTHORIZATION FOR USE OF THE TERMINAL.                * S22024 63200000
*                                                              * S22024 63280000
**************************************************************** S22024 63360000
DEVPRT   EQU   *                                                 S22024 63440000
         STM   R4,R5,WORK4        SAVE REGISTERS                 S22024 63520000
         ST    R7,WORK4+D8        SAVE REG                       S22024 63600000
         SPACE                                                          63680000
         TM    TOTFLG09,TOTPRECT  AP EQU CT                      S22024 63760000
         BO    D0(R9)             YES - BYPASS CHECK             S22024 63840000
         TM    TOTFLG09,TOTAPCON+TOTAPOUT AP EQU SYSTEM DEVICE   S22024 63920000
         BNZ   D0(R9)             YES - BYPASS CHECK             S22024 64000000
         SPACE                                                          64080000
         MVC   READNAME(D8),TOTAPNAM AP NAME TO BLDL PLIST       S22024 64160000
*                                                              * S22024 64240000
*        GET AND EVALUATE CDS RECORD.                          * S22024 64320000
*                                                              * S22024 64400000
         BLDL  0,BLDLLIST         BUILD DIR. ENTRY POINT LIST    S22024 64480000
         SPACE                                                          64560000
         LTR   R15,R15            BLDL SUCCESSFULLY              S22024 64640000
         BZ    CDSLOAD            YES                            S22024 64720000
         CH    R15,H4             RECORD FOUND                   S22024 64800000
         BE    CDSDVP             NO                             S22024 64880000
*                                                              * S22024 64960000
*        ASSUME I/O ERROR                                      * S22024 65040000
*                                                              * S22024 65120000
         IEDQMSG MSGID=041,FUNCT=CEC                             S22024 65200000
         SPACE                                                          65280000
CDSERR   EQU   *                                                 S22024 65360000
         LM    R4,R5,WORK4        CALLER'S REG                   S22024 65440000
         L     R7,WORK4+D8        CALLER'S REG                   S22024 65520000
         B     ERR2               REPORT ERROR                   S22024 65600000
         SPACE                                                          65680000
CDSLOAD  EQU   *                                                 S22024 65760000
         LOAD  DE=READNAME        LOAD THE ENTRY                 S22024 65840000
         SPACE                                                          65920000
         LR    R8,R0              ENTRY POINT ADDR               S22024 66000000
         MVC   DVTEST,D10(R8)     SAVE FLAG BYTE                 S22024 66080000
         DELETE DE=READNAME       DELETE THE ENTRY               S22024 66160000
         SPACE                                                          66240000
         TM    DVTEST,RESDP       DEVICE PROTECTED               S22024 66320000
         BZ    CDSEND             NO - RETURN                    S22024 66400000
CDSDVP   EQU   *                                                 S22024 66480000
         MVC   DEVNAM(D8),READNAME AP NAME TO MSG                S22024 66560000
         MVC   MSG+D16(D8),READNAME AP NAME TO MSG               S22024 66640000
         SPACE                                                          66720000
         WTO   'IED213D CAN ON LINE TEST USE PROTECTED DEVICE',        *66800000
               ROUTCDE=10,DESC=7                                        66880000
         SPACE                                                          66960000
         XC    ECB(D4),ECB        CLEAR ECB                      S22024 67040000
         SPACE                                                          67120000
MSG      WTOR  '         (YES OR NO)',ANSWER,3,                        *67200000
               ECB,ROUTCDE=(8,10),DESC=2                                67280000
         SPACE                                                          67360000
         STIMER REAL,NOANS,DINTVL=TIMOUT TIMER FOR TIMEOUT       S22024 67440000
         SPACE                                                          67520000
         WAIT  ECB=ECB            WAIT FOR REPLY                 S22024 67600000
         SPACE                                                          67680000
         TTIMER CANCEL            CANCEL TIMER                   S22024 67760000
         SPACE                                                          67840000
         OI    ANSWER,CAP         XLATE TO CAP                   S22024 67920000
         CLI   ANSWER,YES         YES RESPONSE                   S22024 68000000
         BE    CDSEND             YES - RETURN                   S22024 68080000
         SPACE                                                          68160000
         MVC   REJMSG+D8(REJECTE-REJECT),REJECT MSG TO PLIST     S22024 68240000
REJMSG   WTO   '                                                       *68320000
                               ',ROUTCDE=10,DESC=7               S22024 68400000
         SPACE                                                          68480000
         B     GETOUT             TERMINATE TRM                  S22024 68560000
         SPACE                                                          68640000
CDSEND   EQU   *                                                        68720000
         LM    R4,R5,WORK4        RESTORE REG                    S22024 68800000
         L     R7,WORK4+8         RESTORE REG                    S22024 68880000
         BR    R9                 RETURN                         S22024 68960000
         EJECT                                                          69040000
*                                                                       69120000
*                                                                       69200000
*        ROUTINE TO FIND UCB ADDR AFTER ENTRY IN TERMINAL TABLE HAS     69280000
*        BEEN FOUND                                                     69360000
*                                                                       69440000
*                                                                       69520000
UCBFIND  EQU   *                                                        69600000
         L     R8,TNTENTRY        GET ADDRESS OF TERMINAL ENTRY  S99528 69680000
         USING IEDQTRM,R8                                               69760000
         L     R8,TRMDESTQ-D1     QCB ADDR                       S22024 69840000
         DROP  R8                                                       69920000
         USING IEDQQCB,R8                                               70000000
         SR    R7,R7                   GET RELATIVE                     70080000
         IC    R7,QCBRELLN          RELATIVE LINE NUMBER                70160000
         STC   R7,TRMRLN          SAVE AP RLN                           70240000
         SLL   R7,D2              MULT BY FOUR                   S22024 70320000
         L     R8,QCBDCBAD-D1     DCB ADDR                       S22024 70400000
         DROP  R8                                                       70480000
         USING IHADCB,R8                                                70560000
         TM    DCBDSORG,LGBA      LGB VS. DCB                    S22024 70640000
         BZ    UCB0X              NO                             S22024 70720000
         DROP  R8                                                S22024 70800000
         L     R1,TNTENTRY        GET TERMINAL TTE ADDRESS     @Y17XAUU 70880000
         BAL   R14,NCPTTE         GET NCP TTE ADDRESS          @Y17XAUU 70960000
*                                                              @Y17XAUU 71040000
*        ON RETURN R1 CONTAINS ADDRESS OF NCP TTE PREFIX       @Y17XAUU 71120000
*                                                              @Y17XAUU 71200000
         USING IEDNTRM,R1         SET TTE ADDRESSABILITY       @Y17XAUU 71280000
         TM    TRMBYTE2,TRMRSACT  3705 ACTIVE                  @Y17XAUU 71360000
         BO    UCBNACT            YES- ERROR                   @Y17XAUU 71440000
         TM    TRMBYTE2,TRMINPG   ACT/DEACT IN PROGRESS        @Y17XAUU 71520000
         BZ    UCBNACT            NO - ERROR                   @Y17XAUU 71600000
         L     R1,TRMDESTQ-D1     GET QCB ADDRESS              @Y17XAUU 71680000
         DROP  R1                                              @Y17XAUU 71760000
         USING IEDQQCB,R1         SET QCB ADDRESSABILITY       @Y17XAUU 71840000
         L     R8,QCBDCBAD-D1     GET 3705 DCB ADDRESS         @Y17XAUU 71920000
         DROP  R1                                              @Y17XAUU 72000000
         LA    R7,D4              RLN EQU 1                      S22024 72080000
         B     UCB0X              CHECK DCB FOR OPEN           @Y17XAUU 72160000
UCBNACT  EQU   *                                               @Y17XAUU 72240000
         IEDQMSG MSGID=010,FUNCT=CEC MSG                         S22024 72320000
         OI    TOTFLG09,TOTPRECT  CT EQU AP                      S22024 72400000
         B     ERR1               ERROR EXIT                     S22024 72480000
UCB0X    EQU   *                                                 S22024 72560000
         USING IHADCB,R8                                         S22024 72640000
         TM    DCBOFLGS,OPEN      DCB OPENED                     S22024 72720000
         BZ    NOOPEN                  NO BRANCH                        72800000
         L     R8,DCBDEBAD        GET DEB ADDRESS                       72880000
         DROP  R8                                                       72960000
         USING DEBNMSUB,R8                                              73040000
         SR    R15,R15            CLEAR REGISTER 15                     73120000
         IC    R15,DEBNMEXT       GET NUMBER OF EXTENTS                 73200000
         SLL   R15,D2             MULT BY FOUR                   S22024 73280000
         CR    R15,R7             IS DESIRED LINE OPENED?               73360000
         BL    NOOPEN               NO                                  73440000
         L     R8,DEBUCBAD-D4(R7) UCB ADDR                       S22024 73520000
         USING UCB,R8                                                   73600000
         MVC   WORK1(3),UCBNAME        MOVE UCB ID IN EBCDIC            73680000
         MVC   WORK2(2),UCBCHA         MOVE UCB ID IN HEX               73760000
         DROP  R8                                                       73840000
         MVI   WORK2+D2,D0        CLEAR UNUSED BYTE              S22024 73920000
         NI    WORK2,X0F          INSURE POSITIVE                S22024 74000000
         BR    R9                      RETURN                           74080000
NOOPEN   EQU   *                                                        74160000
         SPACE                                                          74240000
         IEDQMSG MSGID=004,FUNCT=CEC AP LINE NOT OPENED                 74320000
         B     ERR2                    REPORT INVALID TERMINAL NAME     74400000
         EJECT                                                          74480000
**************************************************************** S22024 74560000
*        ROUTINE TO GO TO IEDQWB2 TO CALCULATE THE AMOUNT OF   * S22024 74640000
*        OF CORE NEEDED TO BUILD DUMMY ENTRIES FOR A SPECIFIED * S22024 74720000
*        REMOTE TERMINAL. CONTROL IS PASS TO IEDQWB TO ATTAIN  * S22024 74800000
*        THE ACTUAL CORE.  CONTROL IS THEN RETURNED TO IEDQWB2 * S22024 74880000
*        TO COPY THE ENTRIES.                                  * S22024 74960000
**************************************************************** S22024 75040000
DUMMYTNT EQU   *                                                 S22024 75120000
         STM   R7,R11,TRMSAVE2    SAVE REGISTERS                 S22024 75200000
         MVI   TRMRQFLG,APREQ     SHOW AP REQUEST                S22024 75280000
         LA    R12,KTRM           PASS PARAMETERS                S22024 75360000
         XC    TRMFLG01(D1),TRMFLG01 CLEAR CONTROL FLAG          S22024 75440000
*                                                                S22024 75520000
         LINK  EP=IEDQWB2         CALCULATE CORE                 S22024 75600000
         CL    R15,ERRCD8         SNA LU FAILURE               @XM05678 75620010
         BE    DUMFAILU           YES                          @XM05678 75640010
         LTR   R15,R15            REQUEST SUCCESSFUL             S22024 75680000
         BNZ   DUMFAIL            NO - ERROR                     S22024 75760000
         TM    TRMFLG01,TRM3705   3705 MODE                      S22024 75840000
         BO    DUMOUT             YES - EXIT                     S22024 75920000
         TM    TRMFLG01,TRMCTEAP  CT EQU AP                      S22024 76000000
         BO    DUMOUT2            YES, BRANCH                    S05331 76080000
*                                                                S22024 76160000
         L     R10,TOTRESPL       ADDR OF TOTE RES. CTL BLK      S22024 76240000
         USING RESPL,R10                                         S22024 76320000
         XC    TOTOTECB(D4),TOTOTECB CLEAR ECB                   S22024 76400000
         POST  RESTECB1           POST REQUEST TO IEDQWB         S22024 76480000
         WAIT  ECB=TOTOTECB       WAIT FOR REQUEST TO BE HONORED S22024 76560000
*                                                                S22024 76640000
         CLI   TOTWKSPC,XFF       REQUEST SUCCESSFUL             S22024 76720000
         BE    DUMFAIL            NO - ERROR                     S22024 76800000
*                                                                S22024 76880000
         OI    TRMFLG01,TRMQWB3   SHOW SECOND PASS               S22024 76960000
         LA    R12,KTRM           PASS PARAMETERS                S22024 77040000
         LINK  EP=IEDQWB2         COPY ENTRIES                   S22024 77120000
         LTR   R15,R15            REQUEST SUCCESSFUL             S22024 77200000
         BNZ   DUMFAIL            NO - ERROR                     S22024 77280000
*                                                                S22024 77360000
DUMOUT   EQU   *                                                 S22024 77440000
         LM    R7,R11,TRMSAVE2    RESTORE REGISTERS              S22024 77520000
         BR    R9                 RETURN                         S22024 77600000
         SPACE                                                          77610010
DUMFAILU EQU   *                                               @XM05678 77620010
         IEDQMSG MSGID=093,FUNCT=CEC                           @XM05678 77630010
         B     DUMEND             TERMINATE TRM                @XM05678 77640010
         SPACE 2                                                        77680000
DUMFAIL  EQU   *                                                        77760000
         WTO   'IED215I OLT REQUEST REJECTED, UNABLE TO ALLOCATE RESOUR*77840000
               CES FOR CT/AP',ROUTCDE=10,DESC=7                         77920000
         SPACE                                                          78000000
DUMEND   EQU   *                                                        78080000
         NI    TRMFLG01,XFF-TRMCTEAP CLEAR CT EQU AP FLAG        S22024 78160000
         L     R13,D4(R13)        RESTORE CALLERS SAVE AREA ADDRESS     78240000
         LM    R14,R12,12(R13)    RESTORE CALLER'S REG                  78320000
         SR    R15,R15            CLEAR REG                             78400000
         BR    R14                RETURN                                78480000
DUMOUT2  EQU   *                                                 S05331 78560000
         NI    $ERROPT,XFF-$ALTPRNT  SHOW NO AP                  S05331 78640000
         OI    TOTFLG09,TOTPRECT  SET FLAG INDICATING CT EQU AP  S05331 78720000
         LM    R7,R11,TRMSAVE2    RESTORE CALLER'S REGISTERS     S05331 78800000
         B     EXIT               BYPASS AP PROCESSING           S05331 78880000
         EJECT                                                          78960010
LCBSCAN  EQU   *                                                        79200000
         STM   R10,R12,TRMSAVE1   SAVE REG 10-12                        79280000
         STM   R5,R9,TRMSAVE2     SAVE REG 5-9                          79360000
         L     R5,TRMQCB          GET CT QCB ADDRESS                    79440000
         USING IEDQQCB,R5                                               79520000
         LA    R5,D0(R5)          CLR HI ORDER BYTE              S22024 79600000
         L     R9,QCBDCBAD-D1     DCB ADDR                       S22024 79680000
         USING IHADCB,R9                                                79760000
         TM    DCBDSORG,LGBA      LGB VS DCB                     S22024 79840000
         BZ    LCB0X              NO                             S22024 79920000
         DROP  R9                                                S22024 80000000
         L     R1,TNTENTRY        GET TERMINAL TTE ADDRESS     @Y17XAUU 80080000
         BAL   R14,NCPTTE         FIND NCP TTE ADDRESS         @Y17XAUU 80160000
         USING IEDNTRM,R1         SET TTE ADDRESSABILITY       @Y17XAUU 80240000
         L     R9,TRMDESTQ-D1     CB ADDRESS                   @Y17XAUU 80320000
         DROP  R1                                              @Y17XAUU 80400000
         USING IEDQQCB,R9         SET QCB ADDRESSABILITY       @Y17XAUU 80480000
         L     R9,QCBDCBAD-D1     GET 3705 DCB ADDRESS         @Y17XAUU 80560000
         DROP  R9                                              @Y17XAUU 80640000
         USING IHADCB,R9                                         S22024 80720000
LCB0X    DS    0H                 BOUNDARY ALLIGNMENT            S22024 80800000
         L     R7,DCBDEBAD        GET DEB ADDR                          80880000
         USING DEBNMSUB,R7                                              80960000
         SR    R8,R8              CLEAR REG 8                           81040000
         IC    R8,DEBNMEXT        GET DEB NUMBER OF EXTENTS             81120000
         DROP  R7                                                       81200000
         SR    R7,R7              CLEAR REG 7                           81280000
         IC    R7,QCBRELLN        GET QCB'S STARTING RLN                81360000
         TM    TRMFLG01,TRM3705   3705 MODE                      S22024 81440000
         BZ    LCB04              NO                             S22024 81520000
         LA    R7,D1              SET RLN EQU 1                  S22024 81600000
LCB04    DS    0H                 BOUNDARY ALLIGNMENT            S22024 81680000
         DROP  R5                                                       81760000
         LR    R5,R7              COPY RLN FOR NEXT TEST                81840000
         BCTR  R5,R0              RLN MINUS 1                    S22024 81920000
         SR    R8,R5              GET COUNT OF LCB'S TO SCAN            82000000
         SR    R12,R12            CLEAR REG 12                          82080000
         IC    R12,DCBEIOBX       GET LCB SIZE                          82160000
         LR    R11,R7             SAVE QCB'S STARTING RLN               82240000
         MR    R10,R12            GET STARTING LCB OFFSET               82320000
         AL    R11,DCBIOBAD       POINT TO IOB OF LCB                   82400000
         S     R11,K32            ADJUST TO START OF LCB         Y06330 82480000
         DROP  R9                                                       82560000
         TM    TRMFLG01,TRM3705   3705 MODE?                     S05331 82640000
         BZ    MODE0X             NO, BRANCH                     S05331 82720000
         L     R8,TNTENTRY        GET TERMINAL ENTRY ADDRESS     S05331 82800000
         LA    R1,TRMPRFSZ        GET TTE PREFIX SIZE          @Y17XAUU 82880000
         SLR   R8,R1              POINT TO TTE PREFIX          @Y17XAUU 82960000
         USING IEDNTRM,R8         SET TTE ADDRESSABILITY       @Y17XAUU 83040000
LINELOOP EQU   *                                               @Y17XAUU 83120000
         LH    R1,TRMCOHRT        GET COHORT POINTER           @Y17XAUU 83200000
         L     15,TERNMTAB        TTCIN TO TTE CONVERSION      @Y17XAUU 83280000
*                                 ROUTINE ADDRESS              @Y17XAUU 83360000
         BALR  R14,R15            FIND TTE ADDRESS             @Y17XAUU 83440000
         LR    R8,R1              GET TTE ADDRESS              @Y17XAUU 83520000
         LA    R1,TRMPRFSZ        GET TTE PREFIX SIZE          @Y17XAUU 83600000
         SLR   R8,R1              POINT TO TTE PREFIX          @Y17XAUU 83680000
         CLI   TRMTYPE,TRMNSDLC   PRE SNA LINE ENTRY           @Y17XAUU 83760000
         BE    LINEFND            YES                          @Y17XAUU 83840000
         CLI   TRMTYPE,TRMSDLC    SNA LINE ENTRY               @Y17XAUU 83920000
         BNE   LINELOOP           NO - CHECK NEXT ENTRY        @Y17XAUU 84000000
LINEFND  EQU   *                                               @Y17XAUU 84080000
         TM    TRMLINK,TRMLACTV   LINE STOPPED                 @Y17XAUU 84160000
         BZ    LCBSSC             NO, BRANCH                   @Y17XAUU 84240000
         OI    TOTAPDFL,TOTAPLST  SHOW LINE INTIALLY STOPPED     S05331 84320000
         B     LCBSSC             BRANCH                         S05331 84400000
MODE0X   EQU   *                                                 S05331 84480000
         USING IEDQLCB,R11                                              84560000
         TM    LCBSTAT1,LCBFREEN+LCBRECVN+LCBSENDN LINE STOPPED         84640000
         BNZ   LCBSSC             NO                                    84720000
         OI    TOTAPDFL,TOTAPLST  SHOW CT INIT STOPPED                  84800000
LCBSSC   EQU   *                                                        84880000
         LM    R5,R9,TRMSAVE2     RESTORE REG 5-9                       84960000
         L     R10,TRMSAVE1       RESTORE REG 10                        85040000
         L     R12,TRMSAVE1+D8    RESTORE REG 12                        85120000
         BR    R9                 RETURN TO CALLER                      85200000
         DROP  R11                                                      85280000
         DROP  R8                                              @Y17XAUU 85360000
         EJECT                                                          85440000
************************************************************** @Y17XAUU 85520000
*        ROUTINE TO FIND NCP TTE ADDRESS. INPUT: REG 1 =     * @Y17XAUU 85600000
*        TERMINAL TTE ADDRESS. OUTPUT: REG 1 = NCP TTE       * @Y17XAUU 85680000
*        ADDRESS. RETURN TO CALLER VIA REG 14.               * @Y17XAUU 85760000
************************************************************** @Y17XAUU 85840000
NCPTTE   EQU   *                                               @Y17XAUU 85920000
         ST    R14,TRMSAVE2       SAVE RETURN ADDRESS          @Y17XAUU 86000000
         LA    R8,TRMPRFSZ        GET TTE PREFIX SIZE          @Y17XAUU 86080000
         SLR   R1,R8              POINT TO TTE PREFIX          @Y17XAUU 86160000
         USING IEDNTRM,R1         ESTABLISH TTE ADDRESSABILITY @Y17XAUU 86240000
NCPLOOP  EQU   *                                               @Y17XAUU 86320000
         LH    R1,TRMCOHRT        GET COHORT POINTER           @Y17XAUU 86400000
         LTR   R1,R1              ENTRY IN HIERARCHY           @YM07415 86480000
         BZ    UCBNACT            NO - ERROR RETURN            @YM07415 86560000
         L     R15,TERNMTAB       TTCIN TO TTE CONVERSION      @Y17XAUU 86640000
*                                 ROUTINE ADDRESS              @Y17XAUU 86720000
         BALR  R14,R15            FIND TTE ADDRESS             @Y17XAUU 86800000
         SLR   R1,R8              POINT TO TTE PREFIX          @Y17XAUU 86880000
         CLI   TRMTYPE,TRMLNCP    NCP ENTRY                    @Y17XAUU 86960000
         BNE   NCPLOOP            NO - CHECK NEXT ENTRY        @Y17XAUU 87040000
         L     R14,TRMSAVE2       RESTORE RETURN ADDRESS       @Y17XAUU 87120000
         BR    R14                RETURN TO CALLER             @Y17XAUU 87200000
         DROP  R1                                              @Y17XAUU 87280000
         EJECT                                                          87360000
TRMRLN   DS    C                  RLN FOR AP                            87440000
         EJECT                                                          87520000
CEOUT2   DC    C'XXXXXXXX NOT OPENED'  MSG - LINE NOT OPENED     S99528 87600000
CEOUT2E  DS    0C                 END OF MESSAGE                        87680000
TRMWRK   DS     CL92              TRM WORK BUFFER                S99528 87760000
PATCH    DC    100XL1'40'         PATCH AREA                     S22024 87840000
WORK4    DS    4F                 SAVE AREA                             87920000
F8       DC    F'8'               VALUE OF 8                     S22024 88000000
ERRCD8   DC    F'8'               ERROR RETURN CODE            @XM05678 88040010
TRMNCMCT DC    F'0'               COUNTER SAVE AREA                     88080000
TRMTEN   DC    F'10'              VALUE OF TEN                          88160000
TTEADDR  DC    F'0'               WORK AREA                             88240000
WORK3    DC    F'0'               WORK AREA                             88320000
NOUCB    DC    H'0'               COMPARE OPERAND                       88400000
H4       DC    H'4'               VALUE OF 4                     S22024 88480000
K32      DC    F'32'              VALUE OF 32                    S22024 88560000
WORK1    DC    XL8'0'             PLACE FOR AP NAME              S99528 88640000
WORK2    DC    XL8'0'             PLACE FOR AP NAME              S99528 88720000
SAVE     DS    CL20               WORK AREA                      S99528 88800000
UCBSAVE  DS    A                  ADDRESS OF AP UCB              S99528 88880000
TRMSAVE  DS    F                  ADDRESS OF TRM BUFFER          S99528 88960000
TERNMLEN DS    CL1                LENGTH OF AP NAME              S99528 89040000
AVTUISV  DS    A                  ADDRESS OF BINARY SEARCH RTN   S99528 89120000
PAREMLST DS    0CL8               BINARY SEARCH P-LIST           S99528 89200000
         DS    CL1                OFFSET TO BINARY SEARCH        S99528 89280000
         DC    X'00'              FLAG BYTE                      S99528 89360000
         DC    X'00'              FLAG BYTE                      S99528 89440000
LENGTH   DS    CL1                LENGTH OF SYMBOLIC NAME        S99528 89520000
         DC    A(WORK1)           ADDRESS OF NAME                S99528 89600000
K0       DC    F'0'               VALUE OF 0                     S22024 89680000
         DS    0D                 ALIGNMENT                      S99528 89760000
TIMOUT   DC    X'F0F0F0F3F0F0F0F0'  TIMER WTOR                   S99528 89840000
ECB      DC    F'0'               ECB                            S99528 89920000
ANSWER   DC    CL3' '             INPUT BUFFER                   S99528 90000000
**************************************************************** S22024 90080000
*        THE FOLLOWING MESSAGE IS ISSUED WHEN OPERATOR WILL    * S22024 90160000
*        NOT ALLOW OLT TO USE PROTECTED DEVICE                 * S22024 90240000
**************************************************************** S22024 90320000
REJECT   DC    C'IED345I '                                       S22024 90400000
         DC    C'TRM REJECTED - OLT CAN NOT USE PROTECTED DEVICE' MSG   90480000
SPACE    DC    X'40'              SPACE                          S22024 90560000
DEVNAM   DC    8XL1'40'           DEVICE NAME                    S22024 90640000
REJECTE  DS    0C                 END OF MESSAGE                 S22024 90720000
         SPACE                                                          90800000
BLDLLIST DS    0F                 BLDL P-LIST                    S22024 90880000
         DC    XL2'0001'          NUMBER OF LIST ENTRIES         S22024 90960000
         DC    XL2'003A'          LENGTH OF EACH ENTRY           S22024 91040000
READNAME DC    8XL1'40'           TERMINAL NAME                  S22024 91120000
         DC    XL16'0'            ADDITIONAL DIRECTORY INFO      S22024 91200000
CORNEED  DC    XL3'0'             CORE NEEDED FOR ENTRY          S22024 91280000
         DC    XL31'0'            ADDITIONAL DIRECTORY INFO      S22024 91360000
         SPACE                                                          91440000
ENQLIST  ENQ   (QNAME,RNAME,S,8,STEP),RET=USE,MF=L ENQUEUE PL    S99528 91520000
QNAME    DC    CL8'SYSZTOTE'      MAJOR QCB SUBTASK NAME       @Y17XAUU 91600000
RNAME    DC    8CL1' '            RESOURCE NAME                  S99528 91680000
DEQLIST  DEQ   (QNAME,RNAME,8,STEP),RET=HAVE,MF=L  DEQUEUE P-LISTS99528 91760000
TRMTTCIN DS    H                  TTCIN SAVE AREA              @Y17XAUU 91840000
         SPACE                                                          91920000
CTEQUAP  CLC   TOTCTNAM(D1),TOTAPNAM CT = AP ?                          92000000
         SPACE 2                                                        92080000
**************************************************************** S22024 92160000
KTRM     DS    0F                 PARAMETER LIST PASSED TO QWB2  S22024 92240000
TERNMTAB DS    A                  TERMNAME TABLE ADDRESS         S22024 92320000
TNTENTRY DS    A                  TERMNAME ENTRY ADDRESS         S22024 92400000
TRMQCB   DS    A                  CT/AP QCB ADDRESS              S22024 92480000
TRMTNT   DS    A                  CT/AP TNT ADDRESS              S22024 92560000
TRMSAVE1 DS    3F                 REGISTERS SAVE AREA            S22024 92640000
TRMSAVE2 DS    5F                 REGISTERS SAVE AREA            S22024 92720000
TRMSAV1  DS    3F                 REGISTERS SAVE AREA            S22024 92800000
REGSAVE  DS    F                  WORK AREA                      S22024 92880000
F32      DC    F'32'              VALUE OF 32                    S22024 92960000
KPQCB    DS    A                  TRUE P-QCB ADDRESS           @YM08027 93040000
KMQCB    DS    A                  DUMMY M-QCB ADDRESS          @YM08027 93120000
CONCTTE  DS    A                  TRUE CONC TERM TTE ADDRESS   @YM08027 93200000
KDRQ     DS    A                  TRUE DRQ ADDRESS             @YM08027 93280000
KPQCBSZ  DS    H                  P-QCB SIZE                   @YM08027 93360000
KMQCBSZ  DS    H                  M-QCB SIZE                   @YM08027 93440000
KDRQSZ   DS    H                  DRQ SIZE                     @YM08027 93520000
TTETSZ   DS    CL1                CONC TERM TTE SIZE           @YM08027 93600000
TTECSZ   DS    CL1                CONC TTE SIZE                @YM08027 93680000
TRMRQFLG DS    CL1                DUMMY TNT REQUEST FLAG         S22024 93760000
CTREQ    EQU   X'80'              CT REQUEST                   @Y17XAUU 93840000
APREQ    EQU   X'40'              AP REQUEST                   @Y17XAUU 93920000
PRREQ    EQU   X'20'              PRIMARY TD REQUEST           @Y17XAUU 94000000
SCREQ    EQU   X'10'              SECONDARY TD REQUEST         @Y17XAUU 94080000
TRMFLG01 DS    CL1                CONTROL FLAG                   S22024 94160000
CONC     EQU   X'80'              TERMINAL ATTACHED TO CONC      S22024 94240000
TRMSPAS  EQU   X'40'              PROCESS CONC TTE               S22024 94320000
TRMQWB3  EQU   X'20'              SECOND PASS FUNCTION           S22024 94400000
TRMDELY  EQU   X'08'              QCB IN TIME DELAY QUEUE        S22024 94480000
TRM3705  EQU   X'04'              3705 MODE                      S22024 94560000
TRMCTEAP EQU   X'02'              CT EQU AP                      S22024 94640000
WRKFLG   DS    CL1                WORK AREA                      S22024 94720000
**************************************************************** S22024 94800000
         SPACE 2                                                        94880000
DVTEST   DS    CL1                FLAG SAVE AREA (CDS+10)        S22024 94960000
AP       DC    C'AP'              ALTERNATE PRINTER OPT          S22024 95040000
SYSOUTA  DC    C'SYSOUT'          SYSTEM OUTPUT DEVICE           S22024 95120000
SYSCONA  DC    C'SYSCON'          SYSTEM CONSOLE                 S22024 95200000
NAP      DC    C'NAP'             NAP OPTION                     S22024 95280000
         EJECT                                                          95360000
         TLGBD                                                   S22024 95440000
         EJECT                                                          95520000
         TDRQD                                                          95600000
         TQCBED                                                         95680000
         EJECT                                                          95760000
         EJECT                                                          95840000
RESPL    RESPL EQUATES=YES                                              95920000
         EJECT                                                          96000000
         TQCBD                                                          96080000
         EJECT                                                          96160000
DCBDSECT DCBD  DSORG=TX                                                 96240000
         EJECT                                                          96320000
         TSCBD                                                          96400000
         EJECT                                                          96480000
         TPRFD                                                          96560000
         EJECT                                                          96640000
         TLCBD                                                          96720000
         EJECT                                                          96800000
CVT      DSECT                                                          96880000
         CVT                                                            96960000
         EJECT                                                          97040000
UCB      DSECT                                                          97120000
         IEFUCBOB                                                       97200000
         EJECT                                                          97280000
         TAVTD                                                          97360000
         EJECT                                                          97440000
         TDEBD                                                          97520000
         EJECT                                                          97600000
         TTRMD                                                          97680000
         EJECT                                                          97760000
         TTNTD                                                          97840000
         EJECT                                                          97920000
         OLTCB                                                   S22024 98000000
CEIN     EQU   TOTINBUF           INPUT BUFFER                   S22024 98080000
         EJECT                                                          98160000
         END                                                            98240000
