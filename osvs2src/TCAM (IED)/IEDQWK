         TITLE 'MESSAGE MODULE 1 - IEDQWK'                              00040022
IEDQWK   CSECT                                                          00080022
*A000000-999999                                                @Y16X5U0 00080500
* CHANGE ACTIVITY AS FOLLOWS:                                    S22024 00083000
*A148000,671200,688000                                          SA41592 00086022
*D674800-675200                                                 SA41592 00092022
*A471800,952020                                                 SA41593 00098022
*C479000-480200,486200-487400,493400-494600,500600,927000       SA41593 00104022
*D682000-682800                                                 SA41593 00110022
*C666700,666742-666746                                          SA41609 00113022
*A665440-665460                                                 SA41613 00116022
*A000830,001280-001920,020600-020800,665210-665280               S22024 00117000
*C007600,376000                                                  S22024 00118000
*D424000                                                         S22024 00119000
*A671220-671240                                                 SA64778 00120054
*A512000,520000,207200,671500                                  @Y17XAUU 00121000
*C356000,358000,656000,664000                                  @Y17XAUU 00122000
*   TOTE ALIAS                                                 @OY13283 00123010
****************************************************************        00124054
*                                                              * S22024 00128000
* MODULE NAME = IEDQWK (TCAM,TOTE)                             @Y17XAUU 00152000
*                                                              * S22024 00160000
* DESCRIPTIVE NAME = MESSAGE MODULE 1                          * S22024 00168000
*                                                              * S22024 00176000
* COPYRIGHT = NONE                                             * S22024 00184000
*                                                              * S22024 00192000
* STATUS --                                                    *        00200022
*    VERSION 10.0                                              @Y17XAUU 00280000
*                                                              *        00360022
* FUNCTIONS --                                                 *        00440022
*    THE PURPOSE OF THIS MODULE IS TO PROVIDE BOTH INPUT AND   *        00520022
*    OUTPUT COMMUNICATION BETWEEN TOTE AND THE OPERATOR.       *        00600022
*                                                              *        00680022
*    IEDQWK PERFORMS A XCTL TO THE SUBMODULE IEDQWL, IEDQWL1,  * S22024 00760000
*    IEDQWL2, OR IEDQWL3 TO MOVE MESSAGES AND BYTES TO THE     *        00840022
*    OLTCB IF A MESSAGE ID IS GIVEN IN THE PARAMETER LIST      *        00920022
*    PASSED. IF THE ADDRESS OF THE OUTPUT BUFFER AND BYTE      *        01000022
*    COUNT IS GIVEN IN THE PARAMETER LIST, IEDQWK PERFORM      *        01080022
*    THE MOVE.                                                 *        01160022
*                                                              *        01240022
*    THE MODULE THEN PERFORM A LINK TO THE ACCESS MANAGER,     *        01320022
*    IEDQWO, TO PRINT THE MESSAGE. IF INPUT IS EXPECTED FROM   *        01400022
*    A REMOTE TERMINAL, A WAIT IS PERFORMED AND THE INPUT DATA *        01480022
*    IS MOVE FROM THE TCAM BUFFER INTO THE OLTCB.              *        01560022
*                                                              *        01640022
*    RETURN IS MADE TO THE CALLING MODULE VIA REGISTER 14.     *        01720022
*                                                              *        01800022
* ENTRY POINTS --                                              *        01880022
*    IEDQWK - CALLED BY ANY TOTE MODULE (EXCEPT TOTE SERVICE   *        01960022
*    MODULES) REQUIRING MESSAGE COMMUNICATION.                 *        02040022
*                                                              * S22024 02060000
*    IEDQWK1 - ENTRY POINT FROM ALL IEDQWL SUBMODULES          * S22024 02080000
*                                                              *        02120022
* INPUT                                                        *        02200022
*    REGISTERS 01,02,13,14,15 CONTAIN THE FOLLOWING VALUES:    *        02280022
*                                                              *        02360022
*    01 - MESSAGE PARAMETER LIST ADDRESS                       *        02440022
*    02 - OLTCB BASE POINTER                                   *        02520022
*    13 - CALLER'S SAVE AREA ADDRESS                           *        02600022
*    14 - RETURN ADDRESS                                       *        02680022
*    15 - IEDQWK ENTRY POINT ADDRESS                           *        02760022
*                                                              *        02840022
* OUTPUT --                                                    *        02920022
*    THE MESSAGE INPUT BUFFER IN THE OLTCB CONTAINS A REPLY    *        03000022
*    IF ONE IS EXPECTED.                                       *        03080022
*                                                              *        03160022
* EXTERNAL REFERENCES --                                       *        03240022
*    IEDQWL  - TOTE MESSAGE SUB-MODULE 1                       *        03320022
*    IEDQWL1 - TOTE MESSAGE SUB-MODULE 2                       *        03400022
*    IEDQWL2 - TOTE MESSAGE SUB-MODULE 3                       *        03480022
*    IEDQWL3 - TOTE MESSAGE SUB-MODULE 4                       *        03560022
*    IEDQWO  - TOTE ACCESS MODULE                              *        03640022
*                                                              *        03720022
* EXITS,NORMAL --                                              *        03800022
*    CONTROL IS RETURNED TO THE CALLING MODULE.                *        03880022
*                                                              *        03960022
* EXITS,ERROR --                                               *        04040022
*    NONE                                                      *        04120022
*                                                              *        04200022
* TABLES/WORK AREAS --                                         *        04280022
*    OLTCB, TCAM BUFFERS, MESSAGE PARAMETER LIST, LCB, SCB     *        04360022
*    AVT, QCB                                                  *        04440022
*                                                              *        04520022
* ATTRIBUTES --                                                *        04600022
*    ENABLED, PROBLEM PROGRAM MODE, TRANSIENT                  *        04680022
*                                                              *        04760022
* NOTES --                                                     *        04840022
*    NONE                                                      *        04920022
*                                                              *        05000022
****************************************************************        05080022
         EJECT                                                          05200022
*                                                              *        05600022
*        E Q U A T E S                                         *        05800022
*                                                              *        06000022
R0       EQU   0                  REG 0                                 06200022
R1       EQU   1                  REG 1                                 06400022
R2       EQU   2                  REG 2                                 06600022
R3       EQU   3                  REG 3                                 06800022
R4       EQU   4                  REG 4                                 07000022
R5       EQU   5                  REG 5                                 07200022
R6       EQU   6                  REG 6                                 07400022
R7       EQU   7                  REG 7                                 07600022
R8       EQU   8                  REG 8                                 07800022
R9       EQU   9                  REG 9                                 08000022
R10      EQU   10                 REG 10                                08200022
R11      EQU   11                 REG 11                                08400022
R12      EQU   12                 REG 12                                08600022
R13      EQU   13                 REG 13                                08800022
R14      EQU   14                 REG 14                                09000022
R15      EQU   15                 REG 15                                09200022
         SPACE                                                          09400022
D0       EQU   0                  DISP OF 0                             09600022
D1       EQU   1                  DISP OF 1                             09800022
D2       EQU   2                  DISP OF 2                             10000022
D3       EQU   3                  DISP OF 3                             10200022
D4       EQU   4                  DISP OF 4                             10400022
D5       EQU   5                  DISP OF 5                             10600022
D6       EQU   6                  DISP OF 6                             10800022
D7       EQU   7                  DISP OF 7                             11000022
D8       EQU   8                  DISP OF 8                             11200022
D9       EQU   9                  DISP OF 9                             11400022
D10      EQU   10                 DISP OF 10                            11600022
D11      EQU   11                 DISP OF 11                            11800022
D12      EQU   12                 DISP OF 12                            12000022
D13      EQU   13                 DISP OF 13                            12200022
D14      EQU   14                 DISP OF 14                            12400022
D15      EQU   15                 DISP OF 15                            12600022
D16      EQU   16                 DISP OF 16                            12800022
D17      EQU   17                 DISP OF 17                            13000022
D18      EQU   18                 DISP OF 18                            13200022
D19      EQU   19                 DISP OF 19                            13400022
D20      EQU   20                 DISP OF 20                            13600022
D24      EQU   24                 DISP OF 24                            13800022
D28      EQU   28                 DISP OF 28                            14000022
D32      EQU   32                 DISP OF 32                            14200022
D36      EQU   36                 DISP OF 36                            14400022
D40      EQU   40                 DISP OF 40                            14600022
D80      EQU   80                 DISP OF 80                            14800022
TPOSTA   EQU   X'0C'              FIRST ELEMENT                 SA41592 14850022
TPOSTE   EQU   X'80'              END OF REQ. ELEMENT           SA41592 14900022
TRMTERM  EQU   X'10'              SEC. CONTROL TERMINAL         SA41592 14950022
         SPACE                                                          15000022
*                                                                       18400020
MULTDROP EQU   X'10'              MULTIDROP LINE FLAG                   19400022
ANR      EQU   X'1E'              ANR LOCAL                             19800022
XF0      EQU   X'F0'              LCB FLAG MASK                         20200022
         SPACE 2                                                        20230022
XFF      EQU   X'FF'              MASK FIELD                            20260022
CANCEL   EQU   X'14'              CANCEL MSG ID                         20290022
MSPTR    EQU   X'80'              MSG ADDR PROVIDED                     20320022
L49      EQU   49                 COMPARE VALUE                         20350022
L79      EQU   79                 COMPARE VALUE                         20380022
L99      EQU   99                 COMPARE VALUE                         20410022
L150     EQU   150                COMPARE VALUE                         20440022
D79      EQU   79                 DISP OF 79                            20470022
BLANK    EQU   X'40'              BLANK CHAR                            20500022
KA       EQU   X'C1'              CHAR A                                20530022
CVT      EQU   16                 CVT ADDR LOC                          20560022
RQPOST   EQU   X'0C'              POST FLAG                             20590022
RQEND    EQU   X'80'              LAST ELEMENT FLAG                     20620022
CARR     EQU   X'10'              DPRINT CARR CONTROL                   20650022
MULBUF   EQU   X'14'              MULTIPLE BUFFER PREFIX         S22024 20720000
LUTYPE   EQU   X'1C'              LU INPUT                     @Y17XAUU 20760000
         EJECT                                                          20800020
         USING IEDQWK,R15                                               22400022
         USING TOTOLTCB,R2                                              23200022
         SPACE                                                          24000022
IEDQWK   IEDHJN STARK,HJN                                               24800022
         SPACE                                                          25600022
         SAVE  (14,12)            SAVE CALLER'S REG                     26400022
         SPACE                                                          27200022
         DROP  R15                                                      28000022
         LR    R4,R15             RESET BASE REGISTER                   28800022
         USING IEDQWK,R4                                                29600022
         LA    R15,TOTSAVE1       GET ADDR OF MY SAVE AREA              32800022
         ST    R13,D4(R15)        SAVE CALLER'S SAVE AREA ADDR          33400022
         ST    R15,D8(R13)        SAVE MY SAVE AREA ADDR                34000022
         LR    R13,R15            SAVE IT AGAIN                         34600022
         SPACE                                                          35240022
         LR    R10,R1             GET PARAMETER LIST ADDRESS            35280022
         USING PLIST,R10                                                35320022
         ST    R0,TOTSMGRT        SAVE RETURN PTR               SA41593 35340022
         SPACE                                                          35360022
         SPACE                                                          35400022
         NI    TOTFLG07,XFF-TOTMSCEC-TOTMSREP-TOTMSPRT-TOTMSSRC         35600000
*                                 CLEAR FUNCTION FLAGS         @Y17XAUU 35610000
         LH    R5,D2(R1)          GET FLAG BITS                         35660022
         SRL   R5,D12             ADJUST FOR OLTCB FLAG BYTE            35720022
         STC   R5,FLAG            PUT IN WORK AREA                      35780022
         OC    TOTFLG07(D1),FLAG  SET FTN FLAG                          35900022
*                                                                       36000020
         TM    TOTFLG06,TOTNPERR  HAS A PERMANENT RRROR OCCURED?        36800022
         BO    EMSG00               NO                           S22024 37600000
         NI    TOTFLG07,XFF-TOTMSPRT CLR PRINT FLAG                     38600022
         CLI   MSGID+D1,CANCEL    CANCEL MSG REQUEST                    39500022
         BE    EMSG00             YES - SEND IT                         40400022
         B     EMSG02             NO - RETURN TO CALLER                 41300022
EMSG00   EQU   *                                                        45600020
         XC    TOTOTBUF(D80),TOTOTBUF CLEAR OUTPUT BFR                  46400022
         TM    MSGID,MSPTR        MSG ADDR PROVIDED IN P-LIST           46490022
         BZ    EMSG00A            NO - CALL SUBMODULE                   46580022
         SR    R6,R6              CLEAR REG 6                           46640022
         IC    R6,MSGCT1          GET MESSAGE LENGTH                    46700022
         MVC   OUTMSG(D4),MSGADR-D1 PUT MSG ADDR ON F-WD BNDY           46760022
         L     R7,OUTMSG          GET MSG ADDR                          46820022
         STC   R6,TOTOTCNT        PUT BYTE COUNT INTO OLTCB             46880022
         BCTR  R6,R0              DECREMENT COUNT FOR EX                46940022
         EX    R6,MSGMOVE         MOVE MESSAGE TO OLTCB                 47000022
         B     EMSG00M            EXIT TO SEND MESSAGE                  47060022
         SPACE 2                                                        47120022
EMSG00A  EQU   *                                                        47180022
         L     R13,D4(R13)        RESTORE SAVE AREA POINTER     SA41593 47200022
         LM    R14,R1,D12(R13)    RESTORE REG 14-1              SA41593 47220022
         SR    R5,R5              CLEAR REG 5                           47240022
         SR    R6,R6              CLEAR REG 6                           47300022
         LH    R5,MSGID           GET MESSAGE ID                        47360022
         LA    R6,L49             SET COMPARAND                         47420022
         CLR   R5,R6              GO IEDQWL ?                           47480022
         BH    EMSG00C            NO - CONTINUE CHECK                   47540022
         SPACE                                                          47600022
*                                                                       47660022
*        LINK TO IEDQWL SUBMODULE TO GET MESSAGE                        47720022
*                                                                       47780022
EMSG00B  EQU   *                                                        47840022
         XCTL  (2,12),EP=IEDQWL   GET MESSAGE                   SA41593 47900022
         SPACE 2                                                        48080022
EMSG00C  EQU   *                                                        48140022
         LA    R6,L79             SET COMPARAND                         48200022
         CLR   R5,R6              GO TO IEDQWL1 ?                       48260022
         BH    EMSG00E            NO - CONTINUE CHECK                   48320022
         SPACE                                                          48380022
*                                                                       48440022
*        LINK TO IEDQWL1 SUBMODULE TO GET MESSAGE                       48500022
*                                                                       48560022
         XCTL  (2,12),EP=IEDQWL1  GET MESSAGE                   SA41593 48620022
         SPACE 2                                                        48800022
EMSG00E  EQU   *                                                        48860022
         LA    R6,L99             SET COMPARAND                         48920022
         CLR   R5,R6              GO TO IEDQWL2 ?                       48980022
         BH    EMSG00H            NO - CONTINUE CHECK                   49040022
         SPACE                                                          49100022
*                                                                       49160022
*        LINK TO IEDQWL2 SUBMODULE TO GET MESSAGE                       49220022
*                                                                       49280022
         XCTL  (2,12),EP=IEDQWL2  GET MESSAGE                   SA41593 49340022
         SPACE 2                                                        49520022
EMSG00H  EQU   *                                                        49580022
         LA    R6,L150            SET COMPARAND                         49640022
         CLR   R5,R6              GO TO IEDQWL3 ?                       49700022
         BH    EMSG032            NO - MSG NOT FOUND - RETURN           49760022
         SPACE                                                          49820022
*                                                                       49880022
*        LINK TO IEDQWL3 SUBMODULE TO GET MESSAGE                       49940022
*                                                                       50000022
         XCTL  (2,12),EP=IEDQWL3  GET MESSAGE                   SA41593 50060022
         SPACE 2                                                        50064022
IEDQWK1  EQU   *                  RETURN POINT FROM L'S MOD     SA41593 50068022
         ENTRY IEDQWK1                                          SA41593 50072022
         DROP  R4                                               SA41593 50076022
         USING IEDQWK1,R15                                      SA41593 50080022
         SAVE  (14,12),,IEDQWK1   SAVE REG                      SA41593 50084022
         L     R4,ENTRYPT         IEDQWK ENTRY POINT            SA41593 50088022
         DROP  R15                                              SA41593 50092022
         USING IEDQWK,R4                                        SA41593 50096022
         LA    R15,TOTSAVE1       GET ADDR OF MY SAVE AREA      SA41593 50100022
         ST    R13,D4(R15)        SAVE CALLER'S SAVE AREA ADDR  SA41593 50104022
         ST    R15,D8(R13)        SAVE MY SAVE AREA ADDR        SA41593 50108022
         LR    R13,R15            SAVE IT AGAIN                 SA41593 50112022
         SPACE 2                                                        50120022
EMSG00M  EQU   *                                                        50180022
*                                                                       50400020
         NI    TOTFLG05,XFF-TOTCECOM-TOTREPLY CLR ACCESS FLAGS          51200022
         NI    TOTFLG05,XFF-TOTPRINT-TOTSRCE  CLR ACCESS FLAGS @Y17XAUU 51600000
*                                                                       52000020
         TM    TOTFLG07,TOTMSSRC  SOURCE REQUEST               @Y17XAUU 52010000
         BZ    EMSG00P            NO - CONTINUE                @Y17XAUU 52020000
         NI    TOTFLG07,XFF-TOTMSSRC RESET SOURCE FLAG         @Y17XAUU 52030000
         OI    TOTFLG05,TOTSRCE   SEND MSG TO SOURCE FLAG      @Y17XAUU 52040000
         B     EMSG01             SEND MESSAGE                 @Y17XAUU 52050000
EMSG00P  EQU   *                                               @Y17XAUU 52060000
         TM    TOTFLG09,TOTPRECT  PRINTER EQU CONT TERMINAL             52800022
         BZ    EMSG001              NO                                  53600020
         TM    TOTFLG07,TOTMSPRT+TOTMSCEC BOTH PRINT AND CECOM          54400022
*                                   YES: IS REQUEST FOR BOTH PRINT      55200020
*                                     AND CECOM?                        56000020
         BNO   EMSG001                NO                                56800020
         NI    TOTFLG07,XFF-TOTMSPRT YES - CLR PRINT FLAG               57600022
EMSG001  EQU   *                                                        58400020
         B     EMSG022            CONTINUE PROCESSING                   58600022
EMSG008  EQU   *                                                        58800020
         TM    TOTFLG07,TOTMSCEC+TOTMSREP CECOM/REPLY                   59400022
         BZ    EMSG02                   NO                              60000020
         NI    TOTFLG05,XFF-TOTEXIOF-TOTPRINT CLR ACCESS FLAGS          60400022
         NI    TOTFLG05,XFF-TOTCECOM-TOTREPLY CLR ACCESS FLAGS          60900022
         OI    TOTFLG05,TOTCECOM  SET CECOM FLAG                        61400022
         TM    TOTFLG07,TOTMSREP  REPLY EXPECTED                        61900022
         BZ    EMSG01               NO                                  62400020
         OI    TOTFLG05,TOTREPLY  SET REPLY FLAG                        63200022
         TM    TOTFLG09,TOTCTCON  CONTROL TERMINAL = SYSCON ?           63500022
         BZ    EMSG01             NO                                    63800022
         MVI   TOTINBUF,BLANK     BLANK                                 64100022
         MVC   TOTINBUF+D1(D79),TOTINBUF INPUT BUFFER                   64400022
EMSG01   EQU   *                                                        64800020
         L     R15,TOTRESPL       GET RESPL ADDRESS            @Y17XAUU 64900000
         USING RESPL,R15          SET RESPL ADDRESSABILITY     @Y17XAUU 65000000
         L     R15,RESPLWO        GET ADDRESS OF ACCESS RTN    @Y17XAUU 65100000
         BALR  R14,R15            CALL IEDQWO TO WRITE MSG     @Y17XAUU 65200000
         DROP  R15                                             @Y17XAUU 65300000
         TM    TOTFLG09,TOTCTCON  CONTROL TERMINAL = SYSCON ?           66430022
         BO    EMSG032            YES - BRANCH                          66460022
         TM    TOTFLG05,TOTREPLY  REPLY EXPECTED ?                      66490022
         BZ    EMSG032            NO - BR                               66520022
         XC    TOTOTECB(D4),TOTOTECB CLEAR TECB                         66530022
         MVI   TOTINBUF,BLANK     BLANK                                 66536022
         MVC   TOTINBUF+D1(D79),TOTINBUF INPUT BUFFER                   66542022
         OI    TOTFLG03,TOTREPEX       TURN ON REPLY EXPECTED   SA41613 66544022
*                                        BIT                    SA41613 66546022
*                                                                       66550022
*        WAIT FOR REPLY TO COME IN                                      66580022
*                                                                       66610022
         WAIT  ECB=TOTOTECB                                             66615022
         SPACE                                                          66620022
*                                                              *        66625022
*        THE FOLLOWING CODE RETRIEVES A RESPONSE FROM A TCAM   *        66630022
*        BUFFER. THE FIRST PAIR OF CHARACTERS IN THE MESSAGE   *        66635022
*        IS THE CONTROL TERMINAL ID.                           *        66640022
*                                                              *        66645022
         L     R6,TOTOLTMQ        GET ADDR OF TCAM BFR UNIT             66650022
         USING IEDQPRF,R6                                               66655022
         LA    R3,PRFSUNIT        GET START OF FIRST BFR UNIT           66660022
         AH    R3,PRFSCAN         POINT TO MSG ID                       66665022
         LA    R7,D2              GET SIZE OF ID FIELD          SA41609 66670022
         LH    R9,PRFSIZE         GET TOTAL NUMBER OF DATA BYTES        66670822
*                                   FROM THE BUFFER                     66671622
         SH    R9,PRFSCAN         SUBTRACT RESERVE CHARACTERS TO        66672422
*                                   GET TOTAL NUMBER OF BYTES IN        66673222
*                                   THE REPLY                           66674022
         SR    R9,R7              DECREMENT DATA COUNT BY SIZE  SA41609 66674222
*                                   OF ID FIELD(2)              SA41609 66674422
         SR    R7,R7              CLEAR INMSG COUNTER           SA41609 66674622
         LR    R8,R3              GET MSG POINTER                       66675022
MSGLOOP  EQU   *                                                        66680022
         CLI   D2(R8),BLANK       END OF MESSAGE?                S99528 66685022
         BL    EXMOVE             YES                                   66690022
         LA    R7,D1(R7)          INCREMENT CHAR COUNTER                66695022
         LA    R8,D1(R8)          POINT TO NEXT CHAR                    66700022
         BCT   R9,MSGLOOP         TEST NEXT CHARACTER                   66705022
EXMOVE   EQU   *                                                        66710022
         LTR   R7,R7              ANY RESPONSE?                         66715022
         BZ    EMSG11             NO                                    66720022
         CL    R7,EIGHTY          MAXIMUM CHAR. EXCEEDED?               66725022
         BH    MAXMSG             YES  - TRUNSCATE IT                   66730022
         BCTR  R7,R0              DECREMENT FOR EX                      66735022
         B     MOVE               MOVE REPLY TO OLTCB                   66740022
MAXMSG   EQU   *                                                        66745022
         LA    R7,D79             SET MAX COUNT MINUS ONE               66750022
MOVE     EQU   *                                                        66755022
         EX    R7,RESPONSE        MOVE RESPONSE TO OLTCB IN BUF         66760022
EMSG11   EQU   *                                                        66765022
         SPACE 2                                                        66840022
*                                                                       66880022
*        POST BUFFER LCB TO TCAM (BD)                                   66920022
*                                                                       66960022
         L     R12,CVT            GET CVT ADDR                          67000022
         L     R12,AVTCVTPT(R12)  GET TCAM DISPATCHER ADDR              67040022
         L     R12,D0(R12)        GET AVT ADDR                          67080022
         USING IEDQAVTD,R12                                             67120022
         TM    AVTBIT1,AVTCLOSN   TCAM CLOSEDOWN IN PROGRESS?   SA64778 67122054
         BO    EMSG032            YES - RETURN                  SA64778 67124054
         LA    R5,AVTBFRTB        BFR RETURN QCB ADDR           SA41592 67126022
         ST    R5,WORK2           SAVE IT                       SA41592 67132022
         CLI   PRFKEY,TRMTERM     REQUEST FROM A SECONDARY      SA41592 67138022
*                                 OPERATOR CONTROL TERMINAL     SA41592 67144022
         BE    EMSGSCT            YES - BRANCH                  SA41592 67150022
         CLI   PRFKEY,LUTYPE      LU RESPONSE                  @Y17XAUU 67151000
         BE    EMSGSCT            YES - POST BUFFER ONLY       @Y17XAUU 67152000
         CLI   PRFKEY,MULBUF      MULTIPLE BUFFERS               S22024 67153000
         BE    EMSGSCT            YES - POST BUFFER ONLY         S22024 67156000
         SPACE                                                          67160022
         L     R7,PRFLCB-D1       GET LCB ADDR                          67200022
         USING IEDQLCB,R7                                               67240022
         MVC   LCBLSPCI(D3),TOTOLTMQ+1 PUT IN BUFFER ADDR               67280022
         MVI   LCBPRI,PRILCB      SET PRIORITY                          67320022
         L     R8,LCBSCBA-D1      GET SCB ADDR                          67360022
         LA    R8,D0(R8)          CLR HI ORDER BYTE                     67400022
         USING IEDQSCB,R8                                               67440022
         MVC   SCBDESTQ(D3),WORK2+D1 PUT IT IN SCB                      67560022
         L     R5,SCBMACR-D1      GET ADDR OF BFR HDR ENTRY             67600022
         LA    R5,D0(R5)          CLEAR HIGH ORDER BYTE                 67640022
         LA    R3,AVTINOUT        INEND/OUTEND PLIST ADDR               67720022
         ST    R3,DPARM           SAVE IT IN WORK AREA                  67730022
         MVC   SCBMACR(D3),DPARM+D1  PUT IN SCB                         67740022
         DROP  R8                                                       67750022
         L     R8,AVTMSGS-D1      VCON TABLE                            67760022
         LA    R8,D0(R8)          CLR HI ORDER BYTE                     67800022
         L     R8,D0(R8)          BD QCB ADDRESS                        67840022
         ST    R8,WORK2           SAVE QCB ADDR FOR BD                  67880022
         L     R8,LCBQCBA-D1      GET QCB ADDR                          67885022
         CLI   LCBRSKEY,ANR       TERMINAL = ANR                        67890022
         BNE   EMSG15             NO                                    67905022
         MVI   LCBTSTSW,XF0       SET LCB FLAG FOR ANR LOCAL            67910022
EMSG15   EQU   *                                                        67915022
         MVC   LCBQCBA(D3),WORK2+D1 PUT QCB ADDR IN LCB                 67920022
*                                                                       67960022
         ST    R7,TPOSTPAR        PUT LCB ADDR IN PLIST                 68000022
         ST    R7,TPOSTPAR+D4     PUT LCB ADDR IN PLIST                 68040022
         MVI   TPOSTPAR,RQPOST    SET REQUEST FLAGS                     68080022
         MVI   TPOSTPAR+D4,RQEND  SHOW END OF ELEMENT                   68120022
         LA    R1,TPOSTPAR        GET ADDR OF TPOST PLIST               68160022
*                                                                       68320022
         AQCTL                    TPOST BUFFER TO BD                    68360022
*                                                                       68400022
         SPACE 2                                                        68440022
         B     EMSG032            EXIT                                  68800022
         EJECT                                                          68900022
*************************************************************** SA41592 69000022
*        REQUEST IS FROM SECONDARY OPERATOR CONTROL TERMINAL  * SA41592 69100022
*************************************************************** SA41592 69200022
EMSGSCT  EQU   *                                                SA41592 69300022
         ST    R5,PRFKEY          QCB ADDR IN BUFFER            SA41592 69400022
         MVI   PRFPRI,PRIBFRTB    PRIORITY                      SA41592 69500022
         L     R5,TOTOLTMQ        BUFFER ADDR                   SA41592 69600022
         ST    R5,TPOSTPAR+D4     SET UP POST                   SA41592 69700022
         MVC   TPOSTPAR+D1(D3),TPOSTPAR+D5 ELEMENT              SA41592 69800022
         MVI   TPOSTPAR,TPOSTA    SHOW FIRST ELEMENT            SA41592 69900022
         MVI   TPOSTPAR+D4,TPOSTE SHOW LAST BUFFER              SA41592 70000022
         LA    R1,TPOSTPAR        POINT TO PLIST                SA41592 70100022
*                                                               SA41592 70200022
         AQCTL                    POST BUFFER                   SA41592 70300022
*                                                               SA41592 70400022
         DROP  R7                                               SA41592 70500022
         DROP  R6                                               SA41592 70600022
         DROP  R12                                              SA41592 70700022
EMSG02   EQU   *                                                        72000020
         B     EMSG032            EXIT                                  72200022
EMSG022  EQU   *                                                        72400020
         MVC   TRMBUF(D80),TOTOTBUF SAVE OUTPUT DATA             S22024 72500000
         MVC   TRMCNT(D1),TOTOTCNT SAVE DATA COUNT               S22024 72600000
         TM    TOTFLG07,TOTMSPRT  DPRINT                                72800022
         BZ    EMSG03               NO                                  73600020
         NI    TOTFLG05,XFF-TOTCECOM-TOTREPLY CLR CECOM/REPLY           74400022
         OI    TOTFLG05,TOTPRINT  SET DPRINT                            75200022
         MVZ   TOTFLG08,CARR      MOVE IN CARRIAGE CONTROL              76000022
*                                                                       76800020
         L     R15,TOTRESPL       GET RESPL ADDRESS            @Y17XAUU 76900000
         USING RESPL,R15          SET RESPL ADDRESSABILITY     @Y17XAUU 77000000
         L     R15,RESPLWO        GET ACCESS ROUTINE ADDRESS   @Y17XAUU 77100000
         BALR  R14,R15            CALL IEDQWO TO WRITE MSG     @Y17XAUU 77200000
         DROP  R15                                             @Y17XAUU 77300000
*                                                                       78400020
EMSG03   EQU   *                                                        91200020
         MVC   TOTOTBUF(D80),TRMBUF RESTORE OUTPUT DATA          S22024 91260000
         MVC   TOTOTCNT(D1),TRMCNT RESTORE DATA COUNT            S22024 91320000
         B     EMSG008            CHECK FOR CECOM                       91400022
EMSG032  EQU   *                                                        91600020
         OC    TOTINBUF(D80),BLANKS CONVERT TO UPPER CASE               91800022
         L     R13,D4(R13)        CALLER'S SAVE AREA ADDR               92100022
         L     R14,D12(R13)       CALLER'S RETURN ADDR                  92400022
         L     R0,TOTSMGRT        RESTORE REG 0                 SA41593 92700022
         LM    R1,R12,D24(R13)    CALLER'S REG                  SA41593 92800022
         BR    R14                RETURN                                93000022
         EJECT                                                          93300022
BLANKS   DC    80XL1'40'          OR FIELD                              93600022
FLAG     DC    X'00'              WORK AREA                             93900022
PATCH    DS    XL80               PATCH AREA                            94200022
TRMBUF   DS    XL80               OUTPUT MSG SAVE AREA           S22024 94500000
TRMCNT   DS    XL1                OUTPUT COUNT SAVE AREA         S22024 94800000
         SPACE 2                                                        95201022
TPOSTPAR DC    2F'0'              TPOST PLIST FOR BFR RETURN            95202022
ENTRYPT  DC    A(IEDQWK)          ENTRY POINT ADDR FOR IEDQWK   SA41593 95202522
         SPACE                                                          95203022
WORK2    DC    F'0'               WORK AREA                             95204022
DPARM    DS    F                  WORK AREA                             95205022
EIGHTY   DC    F'80'              VALUE OF EIGHTY                       95206022
OUTMSG   DC    F'0'               WORK AREA                             95208022
X0100    DC    X'0100'            MASK SETTING                          95210022
MSGMOVE  MVC   TOTOTBUF(D0),D0(R7) MOVE MESSAGE TO OUTPUT BUFFER        95213022
RESPONSE MVC   TOTINBUF(D0),D2(R3) MOVE REPLY TO INPUT BUFFER           95216022
         SPACE 4                                                        95220022
PLIST    DSECT                                                          95240022
MSGID    DS    XL2                MSG ID                                95260022
MSGFLG   DS    XL1                MSG FLAG                              95270022
MSGCT    DS    XL1                MSG IN COUNT                          95280022
MSGCT1   DS    XL1                MSG OUT COUNT                         95290022
MSGADR   DS    XL3                MSG OUTPUT ADDR                       95300022
         EJECT                                                          95341022
         TQCBD                                                          95342022
         EJECT                                                          95343022
         TPRIOR                                                         95344022
         EJECT                                                          95347022
         TLCBD                                                          95354022
         EJECT                                                          95361022
         TSCBD                                                          95368022
         EJECT                                                          95375022
         TAVTD                                                          95382022
         EJECT                                                          95389022
         EJECT                                                          95400020
         EJECT                                                          96000020
         OLTCB                                                          96800022
         EJECT                                                          97000022
         TPRFD                                                          97200022
         EJECT                                                          97260000
RESPL    RESPL                                                 @Y17XAUU 97320000
         SPACE 2                                                        97400022
         END                                                            97600020
