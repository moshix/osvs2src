         TITLE 'IEDQWM2 - TRACE - RETURN CODE MODULE'                   00200022
IEDQWM2  CSECT                                                          00400022
*A000000-999999                                                @Y16X5U0 00420010
* CHANGE ACTIVITY AS FOLLOWS:                                    S22024 00450010
*A402000,662000                                                 SA41596 00500000
*A340300,311200,517200,782000                                  @Y17XAUU 00530010
*C694000-732500                                                @Y17XAUU 00560010
         SPACE 4                                                        00600022
****************************************************************        00800022
*                                                              *        00900022
* MODULE NAME: IEDQWM2 (TCAM,TOTE)                             @Y17XAUU 01000010
*                                                              *        01100022
* DESCRIPTIVE NAME = TRACE - RETURN CODE MODULE                * S22024 01130010
*                                                              * S22024 01140010
* COPYRIGHT = NONE                                             * S22024 01150010
*                                                              * S22024 01160010
*    IEDQWM2                                                   *        01200022
*                                                              *        01300022
* STATUS:                                                      *        01400022
*                                                              *        01500022
*    VERSION 10.0                                              @Y17XAUU 01600010
*                                                              *        01700022
* FUNCTION:                                                    *        01800022
*                                                              *        01900022
*    THIS MODULE PROVIDES THE CE WITH A LIMITED TRACE FACILITY *        02000022
*    FOR OLT EXECUTION. A RETURN CODE FUNCTION IS PROVIDED TO  *        02100022
*    EVALUATE SERVICE MODULE RETURN CODES.                     *        02200022
*                                                              *        02300022
*    IF THE RETURN CODE OPTION IS SET, IEDQWM2 EXAMINES THE    *        02400022
*    RETURN CODE MASK TO DETERMINE WHETHER THE OLT SECTION     *        02500022
*    SHOULD BE TERMINATED. IF THE MASK INDICATES TERMINATION,  *        02600022
*    THE ADDRESS OF THE CLEANUP ROUTINE FOR THE OLT IS PLACED  *        02700022
*    IN REGISTER 14 (IF THE CLEAN-UP PARAMETER IS CODED IN THE *        02800022
*    IN THE INLZE MACRO FOR THE OLT). IF NO CLEANUP ADDRESS IS *        02900022
*    SPECIFIED, THE DTERM ADDRESS FOR THE OLT SECTION IS       *        03000022
*    PLACED IN REGISTER 14. IF THE MASK DOES NOT INDICATE      *        03100022
*    TERMINATION, RETURN WILL BE MADE TO THE OLT NORMALLY.     *        03200022
*                                                              *        03300022
*    THE RETURN CODE OPTION WILL ALSO PRINT A TRACE LINE AT    *        03400022
*    THE ALTERNATE PRINTER SITE. INFORMATION GIVEN IN THE      *        03500022
*    TRACE INCLUDES THE ROUTINE NUMBER, THE MACRO ID OF THE    *        03600022
*    MACRO JUST EXECUTED, THE LOCATION TO WHICH CONTROL        *        03700022
*    SHOULD NORMALLY RETURN TO IN THE OLT, AND THE RETURN      *        03800022
*    CODE. AN '*' IS PRINTED IN THE FIRST PRINT POSITION. THE  *        03900022
*    FOLLOWING IS AN EXAMPLE OF THE TRACE LINE FOR THIS        *        04000022
*    FUNCTION.                                                 *        04100022
*                                                              *        04200022
*    * RTN01, ID 37, AT 000234A4, RC 08                        *        04300022
*                                                              *        04400022
*    IN THE ABOVE EXAMPLE, ROUTINE 1 IS CURRENTLY EXECUTING.   *        04500022
*    THE CECOM MACRO WAS ISSUED. THE CECOM SERVICE MODULE SET  *        04600022
*    A RETURN CODE OF X'08'. NORMALLY CONTROL WOULD BE         *        04700022
*    RETURNED TO THE OLT AT CORE LOCATION X'000234A4'.         *        04800022
*                                                              *        04900022
*    IF THE TRACE OPTION IS SPECIFIED A TRACE LINE IS PRINTED  *        05000022
*    AT THE ALTERNATE PRINTER SITE. THIS TRACE IS THE SAME     *        05100022
*    FOR THE RETURN CODE FUNCTION EXCEPT THE '*' IS NOT        *        05200022
*    PRINTED.                                                  *        05300022
*                                                              *        05400022
*    IF BOTH OPTIONS ARE SET, ONLY THE ROUTINE FUNCTION IS     *        05500022
*    PERFORMED.                                                *        05600022
*                                                              *        05700022
*    IF NEITHER OPTION IS SET, A CHECK IS MADE FOR INCORRECT   *        05800022
*    MACRO LEVEL OR UNSUPPORTED MACRO FUNCTION. IF EITHER OF   *        05900022
*    THESE IS FOUND THE CONTROL TERMINAL IS NOTIFIED OF THE    *        06000022
*    ERROR. CONTROL IS RETURNED TO THE OLT NORMALLY. IF        *        06100022
*    NEITHER IS FOUND CONTROL IS RETURNED TO THE OLT NORMALLY. *        06200022
*                                                              *        06300022
* ENTRY POINTS:                                                *        06400022
*                                                              *        06500022
*         IEDQWM2 - CALLED BY ANY SERVICE MODULE TO EVALUATE   *        06600022
*         THE RETURN CODES AND/OR PROVIDE A TRACE OF OLT       *        06700022
*         EXECUTION.                                           *        06800022
*                                                              *        06900022
* INPUT:                                                       *        07000022
*                                                              *        07100022
*    REGISTERS 1,2,13,14,15 CONTAIN THE FOLLOWING VALUES:      *        07200022
*                                                              *        07300022
*    01-MACRO PARAMETER LIST ADDRESS                           *        07400022
*    02-SCT ADDRESS (OLTCB BASE)                               *        07500022
*    13-SAVE AREA ADDRESS                                      *        07600022
*    14-RETURN ADDRESS                                         *        07700022
*    15-ENTRY POINT ADDRESS                                    *        07800022
*                                                              *        07900022
*    THE RETCODE FIELD IN THE OLTCB CONTAINS THE RETURN CODE   *        08000022
*    FROM THE SERVICE MODULE LAST EXECUTED.                    *        08100022
*                                                              *        08200022
*    THE $RETMASK FIELD IN THE SCT CONTAINS THE MASK BIT       *        08300022
*    SETTING OF THE ROUTINE CURRENTLY EXECUTING.               *        08400022
*                                                              *        08500022
* OUTPUT:                                                      *        08600022
*                                                              *        08700022
*    PASS TRACE LINE TO IEDQWO TO BE PRINTED                   * S22024 08800010
*                                                              *        08900022
* EXTERNAL ROUTINES:                                           *        09000022
*                                                              *        09100022
*    IEDQWO - ACCESS MANAGER TO PRINT MESSAGE                  * S22024 09200010
*                                                              *        09300022
* EXITS NORMAL:                                                *        09400022
*                                                              *        09500022
*         RETURNS CONTROL TO CALLING ROUTINE  IF UNSUPPORTED   *        09600022
*         MACRO LEVEL                                          *        09700022
*                                                              @Y17XAUU 09710010
* MODULE TYPE: PROCEDURE                                       @Y17XAUU 09720010
*                                                              @Y17XAUU 09730010
* MODULE SIZE: 2K MAXIMUM                                      @Y17XAUU 09740010
*                                                              @Y17XAUU 09750010
* PROCESSOR: ASSEMBLER XF                                      @Y17XAUU 09760010
*                                                              @Y17XAUU 09770010
* MACRO: IEDHJN,SAVE                                           @Y17XAUU 09780010
*                                                              @Y17XAUU 09790010
*                                                              *        09800022
* ATTRIBUTES:                                                  *        09900022
*                                                              *        10000022
*         ENABLED, PROBLEM PROGRAM MODE, TRANSIENT             *        10100022
*                                                              *        10200022
* NOTES: SEE BELOW                                             @Y17XAUU 10300010
*                                                              @Y17XAUU 10320010
*  DEPENDENCIES: EBCDIC CHARACTER CODE                         @Y17XAUU 10340010
*                                                              @Y17XAUU 10360010
*  REGISTERS CONVENTIONS: SEE REGISTER ASSIGNMENT              @Y17XAUU 10380010
*                                                              @Y17XAUU 10400010
*  PATCH LABEL: PATCH                                          @Y17XAUU 10420010
*                                                              @Y17XAUU 10440010
*  RESTRICTIONS: NONE                                          @Y17XAUU 10460010
*                                                              *        10500022
****************************************************************        10600022
         EJECT                                                          16200022
*                                                              *        16300022
*        E Q U A T E S                                         *        16400022
*                                                              *        16500022
R0       EQU   0                  REG 0                                 16600022
R1       EQU   1                  REG 1                                 16700022
R2       EQU   2                  REG 2                                 16800022
R3       EQU   3                  REG 3                                 16900022
R4       EQU   4                  REG 4                                 17000022
R5       EQU   5                  REG 5                                 17100022
R6       EQU   6                  REG 6                                 17200022
R7       EQU   7                  REG 7                                 17300022
R8       EQU   8                  REG 8                                 17400022
R9       EQU   9                  REG 9                                 17500022
R10      EQU   10                 REG 10                                17600022
R11      EQU   11                 REG 11                                17700022
R12      EQU   12                 REG 12                                17800022
R13      EQU   13                 REG 13                                17900022
R14      EQU   14                 REG 14                                18000022
R15      EQU   15                 REG 15                                18100022
         SPACE                                                          18200022
D0       EQU   0                  DISPLACEMENT OF 0                     20000022
D1       EQU   1                  DISPLACEMENT OF 1                     20200022
D2       EQU   2                  DISPLACEMENT OF 2                     20400022
D3       EQU   3                  DISPLACEMENT OF 3                     20600022
D4       EQU   4                  DISPLACEMENT OF 4                     20800022
D5       EQU   5                  DISPLACEMENT OF 5                     21000022
D6       EQU   6                  DISPLACEMENT OF 6                     21200022
D7       EQU   7                  DISPLACEMENT OF 7                     21400022
D8       EQU   8                  DISPLACEMENT OF 8                     21600022
D9       EQU   9                  DISPLACEMENT OF 9                     21800022
D10      EQU   10                 DISPLACEMENT OF 10                    22000022
D11      EQU   11                 DISPLACEMENT OF 11                    22200022
D12      EQU   12                 DISPLACEMENT OF 12                    22400022
D13      EQU   13                 DISPLACEMENT OF 13                    22600022
D14      EQU   14                 DISPLACEMENT OF 14                    22800022
D15      EQU   15                 DISPLACEMENT OF 15                    23000022
D16      EQU   16                 DISPLACEMENT OF 16                    23200022
D17      EQU   17                 DISPLACEMENT OF 17                    23400022
D18      EQU   18                 DISPLACEMENT OF 18                    23600022
D19      EQU   19                 DISPLACEMENT OF 19                    23800022
D20      EQU   20                 DISPLACEMENT OF 20                    24000022
D24      EQU   24                 DISPLACEMENT OF 24                    24060022
D28      EQU   28                 DISPLACEMENT OF 28                    24090022
D32      EQU   32                 DISPLACEMENT OF 32                    24120022
*                                                                       24200022
ZERO     EQU   X'F0'              VALUE OF 0                            25800022
ONE      EQU   X'F1'              VALUE OF 1                            25900022
TWO      EQU   X'F2'              VALUE OF 2                            26000022
NOASK    EQU   X'40'              BLANK                                 26100022
TRASK    EQU   C'*'               ERROR INDICATOR                       26200022
BADLEV   EQU   X'04'              INCORRECT MACRO LEVEL OR FUNCTION NOT 26600022
*                                 AVAILABLE RETURN CODE                 26800022
ABORT    EQU   X'10'              ABORT ON RETURN CODE 4                27000022
RTNALL   EQU   X'FF'              ABORT OLT SECTION ON ANY BAD RET CODE 27200022
THIRTY   EQU   X'1E'              VALUE OF 30                           27400022
K80      EQU   X'80'              INITIAL BIT TESTER                    27700022
         EJECT                                                          28000022
         USING IEDQWM2,R15                                              28200022
*                                                                       28400022
IEDQWM2  IEDHJN STARM2,HJN                                              28600022
*                                                                       28800022
         DROP  R15                                                      29000022
         SPACE 2                                                        29200022
         SAVE  (14,12)            SAVE CALLER'S REGISTERS               29400022
*                                                                       29600022
         USING IEDQWM2,R4                                               29800022
         USING TOTOLTCB,R2                                              30000022
*                                                                       30200022
         LR    R4,R15             SET BASE REGISTER                     30400022
         LA    R15,TOTSAVE1       GET ADDR OF OWN SAVE AREA             30600022
         ST    R15,D8(R13)        PUT ADDR IN CALLER'S SAVE AREA        30800022
         ST    R13,D4(R15)        SAVE ADDR OF CALLER'S SAVE AREA       30900022
         LR    R13,R15            SET REG 13 TO MY SAVE AREA            31060022
         LA    R8,TOTSERV         WORK AREA ADDRESS            @Y17XAUU 31061010
         LR    R10,R8             SAVE ADDRESS                 @Y17XAUU 31062010
         LA    R9,L'TOTSERV       GET LENGTH OF WORK AREA      @Y17XAUU 31063010
         SLR   R11,R11            INIT COUNTER                 @Y17XAUU 31064010
         MVCL  R8,R10             CLEAR WORK AREA              @Y17XAUU 31065010
         MVC   TR0MSG(TRNBE-START),START  MVE DATE TO WRK AREA @Y17XAUU 31160010
         ST    R13,KSAVE3         SAVE REG 13                  @Y17XAUU 31180010
         SPACE 2                                                        31200022
*                                                                       31400022
         MVI   TOTOTBUF,NOASK     BLANK OUTPUT                          31460022
         MVC   TOTOTBUF+D1(K80),TOTOTBUF  BUFFER                        31520022
*                                                                       31600022
*                                                                       31800022
         CLI   TOTRTCOD,BADLEV    INCORRECT MACRO LEVEL OR FUNCTION NOT 32000022
*                                 SUPPORTED RETURN CODE ?               32200022
         BNE   TR008              NO - EVALUATE RETURN CODE FUNCTION    32400022
         SPACE                                                          32600022
         LA    R15,BADLEV         SET RETURN CODE FOR OLT               32800022
         BAL   R5,TRRFIND         FIND RETURN ADDR                      33400022
*                                                                       33600022
TR004    EQU   *                                                        33800022
*                                                                       34000022
         TM    TOTFLG09,TOTMACFT  UNSUPPORTED MACRO FTN ?               34010022
         BZ    TR006              NO - ASSUME UNSUPPORTED MACRO         34020022
         NI    TOTFLG09,RTNALL-TOTMACFT TURN OFF FLAG                   34030022
         MVC   TOTOTBUF(TRNBEX-TRNB),TRNB MOVE MSG TO OLTCB BUF@Y17XAUU 34033010
         LA    R5,TRNBEX-TRNB     GET MSG COUNT                @Y17XAUU 34036010
         STC   R5,TOTOTCNT        SAVE IT                               34060022
         NI    TOTFLG05,RTNALL-TOTREPLY TURN OFF REPLY FLAG             34070022
         NI    TOTFLG05,RTNALL-TOTPRINT TURN OFF PRINT FLAG             34080022
         OI    TOTFLG05,TOTCECOM  SET CECOM FLAG                        34090022
         B     TR007              GO LINK TO ACCESS MANAGER MODULE      34100022
TR006    EQU   *   UNSUPPORTED MACRO LEVEL                              34110022
         MVC   TOTOTBUF(TRNAE-TRNA),TRNA MOVE MSG TO OLTCB BFR          34200022
         LA    R5,TRNAE-TRNA      GET MSG                               34400022
         STC   R5,TOTOTCNT        SET MSG COUNT                         34800022
         NI    TOTFLG05,RTNALL-TOTREPLY   TURN OFF REPLY FLAG           34860022
         NI    TOTFLG05,RTNALL-TOTPRINT   TURN OFF PRINT FLAG           34920022
         OI    TOTFLG05,TOTCECOM  SET CECOM FLAG                        35000022
TR007    EQU   *                                                        35050022
         L     R13,KSAVE3         RESTORE SAVE AREA POINTER             35100022
         L     R15,TOTRESPL       GET RESPL ADDRESS            @Y17XAUU 35110010
         USING RESPL,R15          SET RESPL ADDRESSABILITY     @Y17XAUU 35120010
         L     R15,RESPLWO        GET ACCESS ROUTINE ADDRESS   @Y17XAUU 35130010
         BALR  R14,R15            CALL IEDQWO                  @Y17XAUU 35140010
         DROP  R15                                             @Y17XAUU 35150010
         TM    $OLTFLGS,$TRACE    TRACE SET                             35300022
         BZ    TR070              NO - RETURN                           35400022
*                                                                       35600022
         SPACE                                                          35800022
TR008    EQU   *   EVALUATE RETURN CODE FUNCTION                        36000022
*                                                                       36200022
         TM    $RETMASK,RTNALL    IS ROUTINE FUNCTION REQUESTED         36400022
         BZ    TR040              NO - CHECK FOR TRACE OPTION           36600022
*                                                                       36800022
TR015    EQU   *                                                        36860022
*                                                                       36920022
         LA    R13,TOTRTCOD       GET ADDR OF RETURN CODE               37000022
         LA    R14,TRETCD1        GET OUTPUT ADDR                       37200022
         LA    R15,D1             GET BYTE COUNT                        37400022
*                                                                       37600022
         BAL   R10,CONVERT        CONVERT TO EBCDIC                     37800022
         SPACE 2                                                        38000022
*                                                                       38200022
TR020    EQU   *    PUT MACRO ID AND ROUTINE NUMBER INTO BUFFER         38400022
*                                                                       38600022
         L     R15,TOTPARML       GET ADDRESS OF OLT PLIST     @Y17XAUU 38660010
         USING PLIST,R15          SET ADDRESSABILITY           @Y17XAUU 38720010
         MVC   TRMID(D2),PLID     MOVE ID TO MESSAGE           @Y17XAUU 38780010
         DROP  R15                                             @Y17XAUU 38840010
*                                                                       38900010
         SPACE                                                          39600022
*                                                                       39800022
         USING SPREF1,R3          SECTION PREFACE DSECT PART 1          40000022
         USING SPREF2,R9          SECTION PREFACE DSECT PART 2          40200022
         L     R3,TOTOLTEN        SECTION PREFACE BASE          SA41596 40300000
         SR    R9,R9              ZERO REG 9                            40400022
         LH    R9,RTNDISP         GET DISPLACEMENT TO ROUTINE NUMBER    40600022
         AR    R9,R3              ESTABLISH BASE REG FOR PART 2         40800022
*                                                                       41000022
         LA    R13,RTN#           GET ADDRESS OF ROUTINE NUMBER         41200022
         LA    R14,TRRTN          GET ADDRESS OF OUTPUT AREA            41400022
         LA    R15,D1             GET NUMBER OF HEX BYTES TO CONVERT    41600022
         BAL   R10,CONVERT        CONVERT ROUTINE NUMBER TO EBCDIC      41800022
*                                                                       42000022
         DROP  R3                                                       42200022
         DROP  R9                                                       42400022
*                                                                       42600022
         SPACE                                                          42800022
*                                                                       43000022
*        FIND NORMAL RETURN ADDRESS FOR OLT AND CONVERT TO EBCDIC       43200022
*                                                                       43400022
         LA    R13,TOTSMGRT       GET OLT RETURN ADDR                   44100022
         LA    R14,TRETAD         POINT TO OUTPUT BUFFER                44800022
         LA    R15,D4             SET INPUT COUNT                       45000022
         BAL   R10,CONVERT        CONVERT ADDRESS TO EBCDIC             45200022
         SPACE 2                                                        45400022
*                                                                       45600022
         MVI   TRERR,TRASK        PUT ERROR INDICATOR IN BUFFER         45800022
*                                                                       46000022
         SPACE                                                          46200022
*                                                                       46400022
TR040    EQU   *                  TRACE ENTRY                           46600022
*                                                                       46800022
         TM    $RETMASK,RTNALL    IS RETURN CODE FUNCTION SET ?         47000022
         BNZ   TR050              YES - CONTINUE PROCESSING             47200022
         TM    TRFLAG,RTNALL      HAS TRACE PROCESSING BEEN DONE ?      47400022
         BO    TR045              YES - SET UP TO EXIT                  47600022
         MVI   TRFLAG,RTNALL      SET TRACE BYPASS FLAG                 47800022
         B     TR015              PROCESS TRACE REQUEST                 48000022
         SPACE                                                          48200022
*                                                                       48400022
TR045    EQU   *                                                        48600022
*                                                                       48800022
         MVI   TRERR,NOASK        BLANK ERROR INDICATOR                 49000022
*                                                                       49400022
         SPACE 2                                                        49600022
*                                                                       49800022
TR050    EQU   *   DETERMINE WHERE TO RETURN TO CALLER                  50000022
         BAL   R5,TRRFIND         FIND RETURN ADDR                      50200022
TR060    EQU   *                                                        50400022
*                                                                       50600022
         SPACE                                                          50800022
         MVC   TOTOTBUF(TR0END-TR0MSG),TR0MSG MOVE MSG TO OLTCB BFR     51000022
         LA    R5,TR0END-TR0MSG   GET MSG                               51200022
         STC   R5,TOTOTCNT        SET MSG COUNT                         51600022
         NI    TOTFLG05,RTNALL-TOTCECOM TURN OFF CECOM                  51620022
         NI    TOTFLG05,RTNALL-TOTREPLY  TURN OFF REPLY                 51640022
         L     R13,KSAVE3         RESTORE MY SAVE AREA ADDR             51660022
         OI    TOTFLG05,TOTPRINT  SET PRINT FLAG                        51720022
         SPACE                                                          51800022
         USING RESPL,R5           SET RESPL ADDRESSABILITY     @Y17XAUU 51808010
         L     R5,TOTRESPL        GET RESPL ADDRESS            @Y17XAUU 51816010
         L     15,RESPLWO         GET ADDRESS OF ACCESS MANAGER@Y17XAUU 51824010
         BALR  R14,R15            PRINT MESSAGE                @Y17XAUU 51832010
         DROP  R5                                              @Y17XAUU 51840010
         SPACE 2                                                        51900022
TR070    EQU   *                                                        51950022
         SR    R15,R15            CLEAR REG 15                          52000022
         IC    R15,TOTRTCOD       RESTORE RETURN CODE                   52050022
         L     R13,KSAVE3         RESTORE MY SAVE AREA PTR              52100022
         L     R13,D4(R13)        GET CALLER'S SAVE AREA PTR            52150022
         L     R14,D12(R13)       RESTORE RETURN ADDR                   52200022
         L     R0,TOTWKSPC        RESTORE REG 0 (MORECORE)              52250022
         LM    R2,R12,D28(R13)    RESTORE REGS                          52270022
         BR    R14                RETURN                                52300022
         EJECT                                                          52400022
*        H E X  T O  E B C D I C  C O N V E R T                       * 52600022
*                                                                     * 52800022
*              CALL SEQ - R13 = INPUT ADDRESS                         * 53000022
*                         R14 = OUTPUT ADDRESS                        * 53200022
*                         R15 = INPUT BYTE COUNT                      * 53400022
*                                                                     * 53600022
*                         BAL R10,CONVERT                             * 53800022
*                                                                     * 54000022
CONVERT  EQU   *                                                        54200022
*                                                                       54400022
         STM   R5,R6,KSAVE2       SAVE WORK REGISTERS                   54600022
         SPACE                                                          54800022
         AR    R14,R15            ADD COUNT TO OUTPUT ADDRESS           55000022
         AR    R14,R15            ADD IT AGAIN                          55200022
         AR    R13,R15            ADD COUNT TO INPUT ADDRESS            55400022
         SR    R5,R5              CLEAR REG 5                           55600022
         SR    R6,R6              CLEAR REG 6                           55800022
         SPACE                                                          56000022
*                                                                       56200022
CONV1    EQU   *                                                        56400022
*                                                                       56600022
         S     R14,TWO#           GET ADDRESS OF LAST BYTE OF OUTPUT    56800022
         BCTR  R13,R0             GET ADDR OF LAST BYTE OF INPUT        57000022
         IC    R6,D0(R13)         GET HEX BYTE                          57200022
         LR    R5,R6              PUT IT IN REG 5                       57400022
         SRL   R6,4               GET BITS 0-3 IN REG 6                 57600022
         N     R5,FIF#            GET BITS 4-7 IN REG 5                 57800022
         IC    R6,KEBCD(R6)       CONVERT BITS 0-3 TO EBCDIC CHAR       58000022
         IC    R5,KEBCD(R5)       CONVERT BITS 4-7 TO EBCDIC CHAR       58200022
         STC   R6,D0(R14)         PUT 1ST CHAR IN OUTPUT                58400022
         STC   R5,D1(R14)         PUT 2ND CHAR IN OUTPUT                58600022
         BCT   R15,CONV1          GET NEXT HEX BYTE                     58800022
*                                                                       59000022
         LM    R5,R6,KSAVE2       RESTORE WORK REGISTERS                59200022
         L     R13,KSAVE3         RESTORE SAVE REG                      59300022
         BR    R10                RETURN TO CALLER                      59400022
         EJECT                                                          59500022
         SPACE 2                                                        59600022
*                                                                       59800022
*        ROUTINE TO DETERMINE WHETHER OR NOT                            60000022
*        TO TERMINATE THE OLT.  THIS ROUTINE                            60200022
*        PLACES THE CORRECT RETURN ADDRESS IN                           60400022
*        REGISTER 14.                                                   60600022
*                                                                       60800022
*        LINKAGE  BAL R5,TRRFIND                                        61000022
*                                                                       61200022
TRRFIND  EQU   *                                                        61400022
         STM   R5,R8,KSAVE2       SAVE WORK REGISTERS                   61600022
         L     R13,KSAVE3         RESTORE MY SAVE AREA ADDR             61700022
         TM    $RETMASK,RTNALL    IS RETURN CODE FTN SET ?              61800022
         BZ    TRR0K              NO - RETURN NORMALLY                  62000022
         LA    R7,D8              SET LOOP COUNT                        62200022
         LA    R5,KTERM           GET ADDR OF RETURN CODE TABLE         62400022
         LA    R6,K80             SET BIT TO TEST INITIAL               62600022
TRR0B    EQU   *                                                        62800022
         CLC   D0(D1,R5),TOTRTCOD RETURN CODE MATCH ?                   63000022
         BE    TRR0H              YES - CHECK BIT                       63200022
         LA    R5,D1(R5)          POINT TO NEXT CODE                    63400022
         SRL   R6,1               SET TO TESTEST NEXT BIT               63600022
         BCT   R7,TRR0B           TEST NEXT RETURN CODE                 63800022
         B     TRR0K              NO MATCH - RETURN NORMALLY            64000022
TRR0H    EQU   *                                                        64200022
         EX    R6,EXRTCOD         TERMINATE OLT ?                       64400022
         BZ    TRR0K              NO - RETURN NORMALLY                  64600022
*                                                                       64800022
*        RETURN TO OLT CLEANUP/DTERM                                    65000022
*                                                                       65200022
         NI    $OLTFLGS,RTNALL-$RETCODE SET RETURN CODE TO 0 (DTERM)    65400022
         OI    $OLTFLGS,$CLEANUP  SET CLEANUP FLAG TO 1 (CLEANUP)       65600022
         MVI   TRERR,TRASK        SHOW TERMINATE ON BAD RC              65800022
*                                                                       66000022
         L     R14,TOTOLTEN       GET OLT ENTRY POINT                   66200022
         L     R14,D12(R14)       ADDR OF FIRST EX INSTR        SA41596 66300000
         LA    R14,THIRTY(R14)    POINT TO DESIRED ENTRY POINT          66400022
         ST    R14,TOTSMGRT       SET UP OLT RETURN ADDR                66550022
         SR    R15,R15            CLEAR REG 15                          66600022
         IC    R15,TOTRTCOD       GET RETURN CODE                       66800022
*                                                                       67000022
         B     TRREND             RETURN TO CALLER                      67200022
*                                                                       67400022
TRR0K    EQU   *   RETURN NORMALLY                                      67600022
*                                                                       68200022
TRREND   EQU   *                                                        68400022
         SR    R15,R15            CLEAR REG 15                          68420022
         IC    R15,TOTRTCOD       GET RETURN CODE                       68440022
         LM    R5,R8,KSAVE2       RESTORE CALLER'S REGISTERS            68500022
         BR    R5                 RETURN                                68600022
         EJECT                                                          68800022
*                                                                       69000022
*        C O N S T A N T S  A N D  F L A G S                            69200022
*                                                                       69400022
START    DS    0H                 START OF DATA AREA           @Y17XAUU 69500010
TR0MSGX  DS    0C                 TRACE LINE BUFFER            @Y17XAUU 69600010
TRERRX   DC    C' '               ERROR INDICATOR              @Y17XAUU 69800010
         DC    C' '               BLANK SPACE                           70000022
         DC    C'RTN'             ROUTINE                               70200022
TRRTNX   DS    2C                 ROUTINE NUMBER               @Y17XAUU 70400010
         DC    C','               DELIMITER                             70600022
         DC    C' ID '            IDENTITY                              70800022
TRMIDX   DS    2C                 MACRO ID                     @Y17XAUU 71000010
         DC    C','               DELIMITER                             71200022
         DC    C' AT '            LOCATION OF                           71400022
TRETADX  DS    8C                 RETURN ADDRESS IN OLT        @Y17XAUU 71600010
         DC    C','               DELIMITER                             71800022
         DC    C' RC '            RETURN CODE                           72000022
TRETCD1X DS    C                  FIRST DIGIT OF RETURN CODE   @Y17XAUU 72200010
TRETCD2X DS    C                  SECOND DIGIT OF RETURN CODE  @Y17XAUU 72300010
TR0ENDX  DS    0C                 END OF TRACE BUFFER          @Y17XAUU 72400010
TRNAX    DS    0C                 START OF MSG A               @Y17XAUU 72500010
         DC    C'IED337I '        MSG ID                         S22024 72900010
         DC    C'MACRO NOT SUPPORTED' ERROR MESSAGE                     73000022
TRNAEX   DS    0C                 END OF MSG A                 @Y17XAUU 73200010
TRNBX    DS    0C                 START OF MSG B               @Y17XAUU 73230010
         DC    C'IED336I '        MSG ID                         S22024 73270010
         DC    C'MACRO FUNCTION NOT SUPPORTED'   ERROR MESSAGE          73300022
TRNBE    DS    0C                 END OF MSG B                          73350022
FOUR     DC    F'4'               VALUE OF FOUR                         73400022
EIGHT    DC    F'8'               VALUE OF EIGHT                        73600022
TWO#     DC    F'2'               VALUE OF 2                            74200022
FIF#     DC    F'15'              VALUE OF 15                           74300022
KTERM    DC    X'8040201008040201' RETURN CODE TABLE                    74600022
KEBCD    DC    C'0123456789ABCDEF' HEX TO EBCDIC CONVERSION TABLE       74800022
EXRTCOD  TM    $RETMASK,D0        IS TERMINATE BIT SET ?                75200022
         SPACE                                                          75250022
         DS    0F                 BOUNDARY ALLIGNMENT                   75300022
PATCH    DC    100XL1'40'         PATCH AREA                            75350022
         SPACE 4                                                        75400022
PLIST    DSECT                                                          75600022
         DS    CL1                CONTROL PROGRAM FLAGS                 75800022
         DS    AL1                MACRO LEVEL                           76000022
PLID     DS    CL2                MACRO ID                              76200022
         SPACE 2                                                        76400022
SPREF1   DSECT                                                          76600022
         DS    CL8                OLT ROOT MODULE ID                    76800022
         DS    CL2                LEVEL                                 77000022
RTNDISP  DS    AL2                DISPLACEMENT TO ROUTINE NUMBER        77200022
         SPACE 2                                                        77400022
SPREF2   DSECT                                                          77600022
RTN#     DS    XL1                CURRENT ROUTINE NUMBER                77800022
         EJECT                                                          78000022
         OLTCB                                                          78200022
KSAVE1   DS    F                  SAVE AREA                    @Y17XAUU 78206010
KSAVE2   DS    4F                 SUBROUTINES SAVE AREA        @Y17XAUU 78212010
KSAVE3   DS    F                  SAVE AREA                    @Y17XAUU 78218010
TR0MSG   DS    0C                 TRACE LINE BUFFER            @Y17XAUU 78224010
TRERR    DC    C' '               ERROR INDICATOR                       78230010
         DC    C' '               BLANK SPACE                           78236010
         DC    C'RTN'             ROUTINE                               78242010
TRRTN    DS    2C                 ROUTINE NUMBER                        78248010
         DC    C','               DELIMITER                             78254010
         DC    C' ID '            IDENTITY                              78260010
TRMID    DS    2C                 MACRO ID                              78266010
         DC    C','               DELIMITER                             78272010
         DC    C' AT '            LOCATION OF                           78278010
TRETAD   DS    8C                 RETURN ADDRESS IN OLT                 78284010
         DC    C','               DELIMITER                             78290010
         DC    C' RC '            RETURN CODE                           78296010
TRETCD1  DS    C                  FIRST DIGIT OF RETURN CODE            78302010
TRETCD2  DS    C                  SECOND DIGIT OF RETURN CODE           78308010
TR0END   DS    0C                 END OF TRACE BUFFER                   78314010
TRNA     DS    0C                 START OF MSG A                        78320010
         DC    C'IED337I '        MSG ID                         S22024 78326010
         DC    C'MACRO NOT SUPPORTED' ERROR MESSAGE                     78332010
TRNAE    DS    0C                 END OF MSG A                          78338010
TRNB     DS    0C                 START OF MSG B                        78344010
         DC    C'IED336I '        MSG ID                         S22024 78350010
         DC    C'MACRO FUNCTION NOT SUPPORTED'   ERROR MESSAGE          78356010
TRNBEX   DS    0C                 END OF MSG B                 @Y17XAUU 78362010
TRFLAG   DC    XL1'0'             FLAG BYTE                    @Y17XAUU 78365010
         EJECT                                                          78368010
RESPL    RESPL                                                 @Y17XAUU 78374010
         END                                                            78380010
