         TITLE 'TOTE EXIO SERVICE MODULE - IEDQWN'                      00060000
IEDQWN   CSECT                                                          00120000
*A000000-999999                                                @Y16X5U0 00180000
*CHANGE ACTIVITY AS FOLLOWS:                                            00240000
* THIS MODULE IS BEING RESEQUENCED AS OF TCAM 10.0             @Y17XAUU 00300000
* THE FOLLOWING APARS HAVE BEEN INCORPORATED INTO IT:          @Y17XAUU 00360000
* SA64784, OY12988                                             @Y17XAUU 00420000
* A004200,214200,217200,246600,294600,300000,316200,350400     @G36XRUV 00430010
* C214800,217800,247200,295200,300600,316800,351000            @G36XRUV 00440010
*                                                                       00450010
*********************************************************************** 00480000
*                                                                     * 00540000
*                                                                     * 00600000
* MODULE NAME --                                                      * 00660000
*                                                                     * 00720000
*    IEDQWN   (ALIAS IEDQW35) (TCAM,TOTE)                      @Y17XAUU 00780000
*                                                                     * 00840000
* DESCRIPTIVE NAME --                                                 * 00900000
*                                                                     * 00960000
*    TOTE EXIO SERVICE MODULE                                         * 01020000
*                                                                     * 01080000
* COPYRIGHT --                                                        * 01140000
*                                                                     * 01200000
*    'NONE'                                                           * 01260000
*                                                                     * 01320000
* STATUS --                                                           * 01380000
*                                                                     * 01440000
*    VERSION 10.0                                              @Y17XAUU 01500000
*                                                                     * 01560000
* FUNCTIONS --                                                        * 01620000
*                                                                     * 01680000
*    THE PURPOSE OF THIS MODULE IS TO INITIATE I/O OPERATIONS.  ON    * 01740000
*    ENTRY IEDQWN CHECKS TO SEE IF A MACRO OF LEVEL 2 OR GREATER WAS  * 01800000
*    ISSUED.  IF NOT, A BAD RETURN CODE IS SET AND THE EXIT           * 01860000
*    ROUTINE IS ENTERED.                                              * 01920000
*                                                                     * 01980000
*    A CHECK IS THEN MADE TO SEE IF ANY UNSUPPORTED FUNCTION WAS      * 02040000
*    REQUESTED.  IF IT IS, A BAD RETURN CODE IS SET AND THE EXIT      * 02100000
*    ROUTINE IS ENTERED.                                              * 02160000
*                                                                     * 02220000
*    IEDQWN THEN DETERMINES IF THE REQUEST IS FOR THE PRIMARY         * 02280000
*    OR SECONDARY TEST DEVICE.  A BIT IS SET IN THE OLTCB INDICATING  * 02340000
*    WHICH TERMINAL IS BEING USED AND THE ADDRESS OF THE REQUIRED     * 02400000
*    I/O CONTROL BLOCKS (IOBLOCKS) IS OBTAINED.                       * 02460000
*                                                                     * 02520000
*    NEXT, AN EXAMINATION IS MADE TO SEE IF AN ATTENTION INTERRUPT    * 02580000
*    IS EXPECTED.  IF IT IS, THE CCW CHAIN IS SCANNED TO VERIFY IT    * 02640000
*    IS VALID AND THE IOB IS SET UP TO HANDLE THE ATTENTION           * 02700000
*    INTERRUPT.  IF THE LAST CCW IN THE CHAIN IS NOT A NO-OP,         * 02760000
*    A BAD RETURN CODE IS SET AND THE EXIT ROUTINE IS ENTERED.        * 02820000
*                                                                     * 02880000
*    THE LINE FOR THE REQUESTED TEST DEVICE IS STOPPED VIA OPERATOR   * 02940000
*    CONTROL.  IF THIS STOP LINE FAILS, A BAD RETURN CODE IS SET AND  * 03000000
*    THE EXIT ROUTINE IS ENTERED.                                     * 03060000
*                                                                     * 03120000
*    IEDQWN DETERMINES IF THE LINE BEING USED NEEDS TO BE ENABLED.    * 03180000
*    IF THE TEST DEVICE IS A LINE (CUU ADDRESS), THEN NO LINE         * 03240000
*    CONNECTION IS REQUIRED.  IF THE TEST DEVICE IS A TERMINAL,       * 03300000
*    THE LINE IS ENABLED IF NECESSARY.  IF THE ENABLE FAILS, A BAD    * 03360000
*    RETURN CODE IS SET AND THE EXIT ROUTINE IS ENTERED.              * 03420000
*                                                                     * 03480000
*    NEXT, THE IOB IS SET UP.  THE IOB IS CLEARED. THEN THE IOB       * 03540000
*    UNRELATED FLAG IS SET, THE CHANNEL PROGRAM ADDRESS IS INSERTED,  * 03600000
*    X'FF' IS SET IN THE RESTART ADDRESS AND THE CHANNEL PROGRAM      * 03660000
*    IS INSPECTED AND CHAINING FLAGS ARE SET AS DETERMINED BY CCW     * 03720000
*    FLAG BITS.                                                       * 03780000
*                                                                     * 03840000
*    THE DCB FLAGS ARE SET TO BYPASS ERP'S AND THE PERMANENT ERROR    * 03900000
*    FLAG IS CLEARED.  THE ADDRESS OF THE IOB IS PLACED IN THE DCB.   * 03960000
*    THE ADDRESS OF THE DCB AND ECB ARE PUT INTO THE IOB.  THE        * 04020000
*    EXCP IS ISSUED AND A GOOD RETURN CODE IS SET BEFORE EXIT.        * 04080000
*                                                                     * 04140000
*    IN THE EXIT ROUTINE, IF THE TRACE FUNCTION IS INDICATED IN THE   * 04200000
*    OLTCB, IEDQWN XCTL'S TO IEDQWM2 (TRACE MODULE).  IF NO TRACE     * 04260000
*    IS REQUESTED, CONTROL IS RETURNED TO IEDQWA VIA BR 14.           * 04320000
*    IF THE TEST DEVICE IS ON A 3705 (IE '$TDATBLK' BIT IS ON   S22024* 04380000
*    IN THE SCT), IEDQWN EXAMINES THE CCW CHAIN TO SEE WHAT     S22024* 04440000
*    COMMAND WAS REQUESTED.  IF IT IS A 'READ' CCW, A GOOD      S22024* 04500000
*    RETURN CODE IS SET AND THE EXIT ROUTINE IS ENTERED.  IF IT S22024* 04560000
*    IS A 'WRITE' CCW, BUFFER UNITS ARE REQUESTED FROM THE      S22024* 04620000
*    TCAM BUFFER UNIT POOL, THE DATA IS MOVED INTO THE UNITS,   S22024* 04680000
*    AND THE BUFFER IS POSTED DIRECTLY TO THE OUTPUT WRITER QCB S22024* 04740000
*    FOR THE RELATED 3705 LCB.  THE EXIT ROUTINE IS THEN        S22024* 04800000
*    ENTERED.                                                   S22024* 04860000
*                                                                     * 04920000
* ENTRY POINT --                                                      * 04980000
*                                                                     * 05040000
*    IEDQWN - CALLED BY OLT SERVICE MANAGER ROUTINE IN IEDQWA         * 05100000
*                                                              @Y17XAUU 05160000
* PROCESSOR -- ASSEMBLER XF                                    @Y17XAUU 05220000
*                                                              @Y17XAUU 05280000
* MODULE TYPE -- PROCEDURE                                     @Y17XAUU 05340000
*                                                              @Y17XAUU 05400000
* LINKAGE -- BALR REG14,REG15 FROM IEDQWA                      @Y17XAUU 05460000
*                                                              @Y17XAUU 05520000
* MODULE SIZE __ SEE ASSEMBLER LISTING                         @Y17XAUU 05580000
*                                                                     * 05640000
* INPUT --                                                            * 05700000
*                                                                     * 05760000
*    REGISTERS 01,02,13,14,15 CONTAIN THE FOLLOWING VALUES:           * 05820000
*                                                                     * 05880000
*         01 - PARAMETER LIST ADDRESS                                 * 05940000
*         02 - OLTCB ADDRESS                                          * 06000000
*         13 - SAVE AREA ADDRESS                                      * 06060000
*         14 - RETURN ADDRESS                                         * 06120000
*         15 - ENTRY POINT ADDRESS                                    * 06180000
*                                                                     * 06240000
* OUTPUT --                                                           * 06300000
*                                                                     * 06360000
*    REGISTER 15 CONTAINS ONE OF THE FOLLOWING RETURN CODE VALUES:    * 06420000
*                                                                     * 06480000
*         X'00' - EXCP ISSUED                                         * 06540000
*         X'04' - FACILITY NOT AVAILABLE                              * 06600000
*         X'08' - DEVICE NOT PRIMARY, GRABBED OR DATA PROTECTED       * 06660000
*               - DEVICE ALREADY IN OPERATION FROM PRECEDING EXIO     * 06720000
*               - TECB ADDRESS NOT GIVEN                              * 06780000
*               - ATTENTION WAS SPECIFIED AND CCW LIST DOES NOT       * 06840000
*                   END IN NO-OP. (OS ONLY)                           * 06900000
*               - CCW CHAIN DID NOT START WITH ONE OF THE       S22024* 06960000
*                 FOLLOWING COMMANDS:                           S22024* 07020000
*                      WRITE                                    S22024* 07080000
*                      WRITE BREAK                              S22024* 07140000
*                      READ                                     S22024* 07200000
*         X'0C' - DATA PROTECTION ERROR IN CCW LIST OPERATION         * 07260000
*         X'10' - PROCESSED ALL PARAMETERS EXCEPT SENSE               * 07320000
*         X'14' - LINE CONNECTION FAILED                              * 07380000
*                                                                     * 07440000
* EXTERNAL ROUTINES --                                                * 07500000
*                                                                     * 07560000
*    NONE                                                             * 07620000
*                                                                     * 07680000
* EXITS,NORMAL --                                                     * 07740000
*                                                                     * 07800000
*    IF TRACE FUNCTION SPECIFIED, 'XCTL' TO IEDQWM2                   * 07860000
*    OTHERWISE, RETURN TO IEDQWA VIA BR 14.                           * 07920000
*                                                                     * 07980000
* EXITS,ERROR --                                                      * 08040000
*                                                                     * 08100000
*    NONE                                                             * 08160000
*                                                                     * 08220000
* TABLES/WORK AREAS --                                                * 08280000
*                                                                     * 08340000
*    OLTCB,TECB,IOB,DCB,ECB,IOBLOCKS,AVT,UCB                          * 08400000
*                                                                     * 08460000
* ATTRIBUTES --                                                       * 08520000
*                                                                     * 08580000
*    ENABLED, PROBLEM PROGRAM MODE, RESIDENT RE-ENTRANT        @Y17XAUQ 08640000
*                                                              @Y17XAUU 08700000
* NOTES -- SEE BELOW                                           @Y17XAUU 08760000
*                                                              @Y17XAUU 08820000
*  RESTRICTIONS -- NONE                                        @Y17XAUU 08880000
*                                                              @Y17XAUU 08940000
*  DEPENDENCIES -- EBCDIC CHARACTER CODE                       @Y17XAUU 09000000
*                                                              @Y17XAUU 09060000
*  PATCH LABEL -- PATCH                                        @Y17XAUU 09120000
*                                                              @Y17XAUU 09180000
*  REGISTERS CONVENTION -- SEE REGISTERS ASSIGNMENT            @Y17XAUU 09240000
*                                                                     * 09300000
*********************************************************************** 09360000
         SPACE 2                                                        09420000
         EJECT                                                          09480000
*********************************************************************** 09540000
*                                                                     * 09600000
*        REGISTER EQUATES                                             * 09660000
*                                                                     * 09720000
*********************************************************************** 09780000
         SPACE 2                                                        09840000
R0       EQU   0                  WORK REGISTER                         09900000
R1       EQU   1                  ADDRESS OF PARAMETER LIST             09960000
R2       EQU   2                  ADDRESS OF OLTCB                      10020000
R3       EQU   3                  WORK REGISTER                         10080000
R4       EQU   4                  BASE REGISTER                         10140000
R5       EQU   5                  ADDRESS OF TTECB                      10200000
R6       EQU   6                  WORK REGISTER                         10260000
R7       EQU   7                  ADDRESS OF IOBLOCKS                   10320000
R8       EQU   8                  WORK REGISTER                         10380000
R9       EQU   9                  WORK REGISTER                         10440000
R10      EQU   10                 WORK REGISTER                         10500000
R11      EQU   11                 ADDRESS OF PARAMETER LIST PASSED      10560000
*                                   BY THE OLT                          10620000
R12      EQU   12                 WORK REGISTER                         10680000
R13      EQU   13                 SAVE AREA ADDRESS                     10740000
R14      EQU   14                 RETURN ADDRESS                        10800000
R15      EQU   15                 ENTRY POINT ADDRESS                   10860000
         EJECT                                                          10920000
**************************************************************** S22024 10980000
*        MODULE EQUATES                                        * S22024 11040000
**************************************************************** S22024 11100000
         SPACE 2                                                        11160000
OLTCB    EQU   X'01'              BIT SETTING INDICATING THAT    S22024 11220000
*                                   CDS INFORMATION IS IN OLTCB  S22024 11280000
X01      EQU   X'01'              BIT SETTING INDICATING LINE    S22024 11340000
*                                   CONNECTION IS REQUIRED       S22024 11400000
X40      EQU   X'40'              BIT SETTING IN CDS INDICATING  S22024 11460000
*                                   ENTRY IS FOR A LINE          S22024 11520000
SENSENO  EQU   X'40'              BIT SETTING INDICATING THAT    S22024 11580000
*                                   SENSE=NO WAS SPECIFIED       S22024 11640000
*                                   IN THE MACRO                 S22024 11700000
ATTNIN   EQU   X'80'              ATTENTION IN OPTION FLAG       S22024 11760000
LINESTRT EQU   X'40'              VERB CODE FOR START LINE       S22024 11820000
LINESTOP EQU   X'41'              VERB CODE FOR STOP LINE        S22024 11880000
TERMSTRT EQU   X'45'              VERB CODE FOR START TERMINAL   S22024 11940000
TERMSTOP EQU   X'47'              VERB CODE FOR STOP TERMINAL    S22024 12000000
INACT    EQU   X'48'              VERB CODE FOR INACTIVATE     @YM08136 12030000
FLAG     EQU   X'42'              IOB FLAGS                      S22024 12060000
ENABLCMD EQU   X'27'              ENABLE COMMAND                 S22024 12120000
DIALCMD  EQU   X'29'              DIAL COMMAND                   S22024 12180000
SLI      EQU   X'20'              SLI BIT SETTING                S22024 12240000
TYPEIII  EQU   X'82'              TYPE III IBM                   S22024 12300000
TCU2702  EQU   X'02'              2702 TCU                       S22024 12360000
SWITCHED EQU   X'90'              UCB INDICATION OF DIAL LINE    S22024 12420000
AUTOCALL EQU   X'80'              AUTOCALL INDICATION IN UCB     S22024 12480000
CCSLI    EQU   X'60'              COMMAND CHAIN AND SLI          S22024 12540000
CLEAR    EQU   X'00'              USED TO CLEAR FIELDS           S22024 12600000
GOOD     EQU   X'00'              GOOD RETURN CODE               S22024 12660000
ALREADY  EQU   X'08'              RETURN CODE FROM OPERATOR      S22024 12720000
*                                   CONTROL IF LINE ALREADY      S22024 12780000
*                                   STOPPED                      S22024 12840000
TIC      EQU   X'08'              TIC COMMAND                    S22024 12900000
SDAII    EQU   X'90'              SDA II                         S22024 12960000
NOOP     EQU   X'03'              NO-OP COMMAND                  S22024 13020000
CMMDCH   EQU   X'40'              COMMAND CHAIN                  S22024 13080000
NORMAL   EQU   X'7F'              NORMAL ECB COMPLETION          S22024 13140000
BUFSIZE  EQU   X'80'              BUFFER SIZE SPECIFIED          S22024 13200000
DIAL     EQU   X'40'              DIAL TEST                      S22024 13260000
TSG      EQU   X'E0'              GROUP, SINGLE OR TERMINAL      S22024 13320000
UNREL    EQU   X'02'              IOB UNRELATED FLAG             S22024 13380000
CHAINDAT EQU   X'80'              DATA CHAINING FLAG                    13440000
CHAINCMD EQU   X'40'              COMMAND CHAINING FLAG          S22024 13500000
CCWTIC   EQU   X'08'              TRANSFER IN CHANNEL CODE       S22024 13560000
BYPERPS  EQU   X'0C'              BYPASS ERROR RECOVERY          S22024 13620000
*                                   PROCEDURES FLAG              S22024 13680000
PERMERR  EQU   X'C0'              PERMANENT ERROR FLAGS          S22024 13740000
X02      EQU   X'02'              FLAG SETTING                   S22024 13800000
X0F      EQU   X'0F'              USED TO CLEAR BITS             S22024 13860000
XF0      EQU   X'F0'              USED TO MAKE DIAL DIGITS EBCDICS22024 13920000
XFF      EQU   X'FF'              USED IN CLEARING FLAGS         S22024 13980000
X3F      EQU   X'3F'              USED TO CLEAR FLAG             S22024 14040000
ZERO     EQU   0                  RETURN CODE AND DISPLACEMENT   S22024 14100000
ONE      EQU   1                  CONSTANT DISPLACEMENT          S22024 14160000
TWO      EQU   2                  CONSTANT DISPLACEMENT          S22024 14220000
THREE    EQU   3                  CONSTANT DISPLACEMENT          S22024 14280000
FOUR     EQU   X'04'              RETURN CODE AND DISPLACEMENT   S22024 14340000
SIX      EQU   6                  CONSTANT DISPLACEMENT          S22024 14400000
SEVEN    EQU   7                  DISPLACEMENT 7                 S22024 14460000
EIGHT    EQU   8                  RETURN CODE AND DISPLACEMENT   S22024 14520000
NINE     EQU   9                  CONSTANT DISPLACEMENT          S22024 14580000
TEN      EQU   10                 RETURN CODE USED WHEN SENSE    S22024 14640000
*                                   BYPASS IS NOT AVAILABLE      S22024 14700000
ELEVEN   EQU   11                 CONSTANT DISPLACEMENT          S22024 14760000
TWELVE   EQU   12                 CONSTANT DISPLACEMENT          S22024 14820000
FOURTEEN EQU   X'14'              RETURN CODE FOR LINE CONNECT-  S22024 14880000
*                                   ION FAILED                   S22024 14940000
D19      EQU   19                 CONSTANT DISPLACEMENT          S22024 15000000
TWENTY   EQU   20                 CONSTANT DISPLACEMENT          S22024 15060000
THIRTY2  EQU   32                 CONSTANT                       S22024 15120000
D100     EQU   X'64'              CONSTANT DISPLACEMENT          S22024 15180000
BRPRI    EQU   X'E4'              PRIORITY OF ERB POSTED TO BUFFES22024 15240000
*                                  REQUEST                       S22024 15300000
OUTPRI   EQU   X'E0'              PRIORITY USED TO POST TO       S22024 15360000
*                                  OUTPUT WRITER                 S22024 15420000
CODE     EQU   X'0C'              SVC 102 ACTION CODE            S22024 15480000
ENDLIST  EQU   X'80'              LAST WORD INDICATION IN SVC 102S22024 15540000
X08      EQU   X'08'              LENGTH OF DISTANCE BETWEEN     S22024 15600000
*                                  BUFFER START AND BTU          S22024 15660000
DC       EQU   X'80'              DATA CHAIN BIT SETTING IN CCW  S22024 15720000
READ     EQU   X'02'              READ COMMAND CODE IN CCW       S22024 15780000
WRITE    EQU   X'01'              WRITE COMMAND CODE IN CCW      S22024 15840000
WRITEBK  EQU   X'09'              WRITE BREAK COMMAND            S22024 15900000
RSRESET  EQU   X'93'              RESTART RESET CMDCODE IN CCW @Y17XAUQ 15960000
WRSTART0 EQU   X'31'              WRITE START 0 CMDCODE IN CCW @Y17XAUQ 16020000
RDSTART0 EQU   X'32'              READ START 0 CMDCODE IN CCW  @Y17XAUQ 16080000
HOLD     EQU   X'88'              OPCNTL HOLD VERB CODE        @Y17XAUQ 16140000
CCWLNGTH EQU   8                  LENGTH OF CCW                @Y17XAUQ 16200000
DEFSPON  EQU   X'80'              DEFINITE RESPONSE FLAG       @Y17XAUU 16230000
FORMAT   EQU   X'08'              FORMAT INDICATOR             @ZM47554 16240010
RN3705   EQU   X'05'              BIT SETTING INDICATING 3705 UCBS22024 16260000
OPCKEY   EQU   X'00'              OP CONTROL KEY FIELD           S22024 16320000
OPCPRI   EQU   X'DC'              OP CONTROL PRIORITY            S22024 16380000
OPCRTCD  EQU   X'00'              OP CONTROL RETURN CODE FIELD   S22024 16440000
OPCELNG  EQU   X'18'              OP CONTROL ELEMENT LENGTH      S22024 16500000
DISREG2  EQU   28                                                       16560000
         EJECT                                                          16620000
         USING IEDQWN,R15                                               16680000
IEDQWN   IEDHJN IEDQWNN,HJN       SET MODULE IDENTIFIER AND HJN  S99528 16740000
*********************************************************************** 16800000
*                                                                     * 16860000
*        PERFORM INITIALIZATION                                       * 16920000
*                                                                     * 16980000
*********************************************************************** 17040000
         SPACE 1                                                        17100000
EXIO00   EQU   *                                                        17160000
         DROP  R15                                                      17220000
         USING EXIOLIST,R11       ESTABLISH ADDRESSIBILITY FOR   S99528 17280000
*                                   EXIO PARAMETER LIST          S99528 17340000
         USING TOTOLTCB,R2        ESTABLISH ADDRESSIBILITY FOR   S99528 17400000
*                                   OLTCB                        S99528 17460000
         USING IEDQWN,R4          SET UP BASE REGISTER           S99528 17520000
         USING TTECB,R5           SET UP ADDRESSIBILITY FOR      S99528 17580000
*                                   TEST EVENT CONTROL BLOCK     S99528 17640000
         USING IOBLOCKS,R7        SET UP ADDRESSIBLITY FOR       S99528 17700000
*                                   IOBLOCKS                     S99528 17760000
         STM   R14,R12,TWELVE(R13) SAVE CALLER'S REGISTERS       S99528 17820000
         LR    R4,R15              SET UP BASE.                         17880000
         ST    R13,TOTSAVE1+FOUR  SAVE BACKWARD POINTER          S99528 17940000
         LA    R5,TOTSAVE1        SAVE ADDRESS OF SAVE AREA      S99528 18000000
         ST    R5,EIGHT(R13)      PUT ADDRESS OF SAVE AREA INTO  S99528 18060000
*                                  SAVE AREA                     S99528 18120000
         LR    R13,R5             GET ADDRESS OF SAVE AREA       S99528 18180000
         NI    TOTFLG07,XFF-TOTPRIEX-TOTSECEX CLEAR DEVICE FLAGS S99528 18240000
         LR    R11,R1             PUT PARAMETER LIST ADDRESS     S99528 18300000
*                                   INTO REGISTER 11             S99528 18360000
         SPACE 1                                                        18420000
         CLI   XIOLEVEL,X02       CORRECT MACRO LEVEL?           S99528 18480000
         BNL   EX100              YES,CONTINUE                   S99528 18540000
         SPACE 1                                                        18600000
         LA    R15,FOUR           NO, SET FUNCTION NOT AVAILABLE S99528 18660000
*                                  RETURN CODE.                  S99528 18720000
         B     EXIT               RETURN TO CALLER                      18780000
         EJECT                                                          18840000
*********************************************************************** 18900000
*                                                                     * 18960000
*        DETERMINE IF DEVICE REQUESTED FOR EXIO IS THE PRIMARY        * 19020000
*        OR SECONDARY TEST DEVICE AND SET UP IOBLOCKS CONTROL         * 19080000
*        BLOCK BASE                                                   * 19140000
*                                                                     * 19200000
*********************************************************************** 19260000
         SPACE 2                                                        19320000
EX100    EQU   *                                                        19380000
         LA    R6,LCBCPA          SAVE ADDR OF CHANNEL PGM     @ZM47553 19400010
         ST    R6,LCBSIOCC          AREA                       @ZM47553 19420010
         MVC   LCBCPA(CCWLNGTH),QCBCPA MOVE CCW INTO DSECT     @Y17XAUQ 19440000
         CLC   XIOCDSA(FOUR),ZEROADDR  IS CDS ADDRESS EQUAL TO 0?S99528 19500000
         BE    PRIMARY            YES,GO SET UP FOR PRIMARY      S99528 19560000
*                                  DEVICE                        S99528 19620000
         L     R6,XIOCDSA         GET ADDRESS OF CONFIGURATION   S99528 19680000
*                                   DATA FOR DEVICE              S99528 19740000
         TM    TOTTDTBL,TOTTDTRM  IS THE TEST DEVICE A TERMINAL? S99528 19800000
         BO    TERMTEST           YES, CONTINUE                  S22024 19860000
         TM    TOTTDTBL,TOTTDLIN+TOTTDORN  IS THE TEST DEVICE A  S22024 19920000
*                                            COMM LINE ON A 3705?S22024 19980000
         BNO   LINETEST           NO, THEN TEST IS FOR A LINE    S22024 20040000
TERMTEST EQU   *                                                 S22024 20100000
         SR    R8,R8              CLEAR REGISTER 8               S99528 20160000
         IC    R8,TOTTTBEL        GET LENGTH OF NAME FIELD IN    S99528 20220000
*                                  TERMNAME TABLE ENTRY          S99528 20280000
         BCT   R8,LABEL           DECREMENT LENGTH BY ONE        S99528 20340000
LABEL    EQU   *                                                 S99528 20400000
         L     R5,TOTTNTPR        GET TNT ADDRESS OF PRIMARY     S99528 20460000
*                                  DEVICE                        S99528 20520000
         EX    R8,COMPARE         GO COMPARE SYMBOLIC NAMES      S99528 20580000
         BE    PRIMARYA           IF THE SAME, SET UP PRIMARY    S99528 20640000
*                                 IOB                            S99528 20700000
         L     R5,TOTSRTNT        GET TNT ADDRESS OF SECONDARY   S99528 20760000
*                                  DEVICE                        S99528 20820000
         EX    R8,COMPARE         GO COMPARE SYMBOLIC NAMES      S99528 20880000
         BE    SECOND             IF EQUAL, GO SET UP SECONDARY  S99528 20940000
*                                  IOB                           S99528 21000000
ERROR    EQU   *                                                 S99528 21060000
         LA    R15,EIGHT          DEVICE NOT PRIMARY OR SECONDARYS99528 21120000
*                                 TECB ADDRESS NOT GIVEN         S99528 21180000
*                                 CCW CHAIN FOR ATTENTION IS NOT S99528 21240000
*                                  ENDED WITH A NO-OP            S99528 21300000
         B     EXIT               BRANCH TO EXIT                 S99528 21360000
LINETEST EQU   *                                                 S99528 21420000
         SR    R5,R5              CLEAR                        @G36XRUV 21450010
         ICM   R5,3,TOTPRUCB      GET PRIMARY UCB ADDRESS      @G36XRUV 21480010
         MVC   UCBAREA,FOUR(R5)   STORE UNIT ADDRESS             S99528 21540000
         NI    UCBAREA,X3F        CLEAR HIGH ORDER HALF BYTE     S99528 21600000
         CLC   UCBAREA,TWO(R6)    COMPARE UNIT NAMES             S99528 21660000
         BE    PRIMARYA           IF EQUAL, SET UP PRIMARY IOB   S99528 21720000
         SR    R5,R5              CLEAR                        @G36XRUV 21750010
         ICM   R5,3,TOTSCUCB      GET SECONDARY UCB ADDRESS    @G36XRUV 21780010
         MVC   UCBAREA,FOUR(R5)   STORE UNIT ADDRESS             S99528 21840000
         NI    UCBAREA,X3F        CLEAR HIGH ORDER HALF BYTE     S99528 21900000
         CLC   UCBAREA,TWO(R6)    COMPARE UNIT NAMES             S99528 21960000
         BE    SECOND             IF EQUAL, SET UP SECONDARY IOB S99528 22020000
         B     ERROR              IF NOT, ERROR CONDITION        S99528 22080000
PRIMARY  EQU   *                                                 S99528 22140000
         MVI   SWITCH,OLTCB       INDICATE THAT OLTCB CONTAINS   S99528 22200000
*                                   CDS INFORMATION              S99528 22260000
PRIMARYA EQU   *                                                 S99528 22320000
         OI    TOTFLG07,TOTPRIEX  SET PRIMARY DEVICE FLAG        S99528 22380000
         LA    R7,TOTPRIBK        SET UP FOR PRIMARY             S99528 22440000
         MVI   IOB,CLEAR          CLEAR OUT                      S99528 22500000
         MVC   IOB+ONE(DCB-IOB-ONE),IOB CLEAR IOB FIELD        @OY12988 22560000
         OI    IOBFLG4,IOBPRI     INDICATE PRIMARY IOB           S99528 22620000
         L     R6,OLTLCBA-ONE     GET ADDRESS OF 3705 LCB        S22024 22680000
         ST    R6,LCBADDR         SAVE LCB ADDRESS               S22024 22740000
         B     EX110              BRANCH AROUND SECONDARY SET UP S99528 22800000
SECOND   EQU   *                                                 S99528 22860000
         OI    TOTFLG07,TOTSECEX  SET SECONDARY DEVICE FLAG      S99528 22920000
         LA    R7,TOTSCIBK        SET UP FOR SECONDARY           S99528 22980000
         MVI   IOB,CLEAR          CLEAR OUT                      S99528 23040000
         MVC   IOB+ONE(DCB-IOB-ONE),IOB CLEAR IOB FIELD        @OY12988 23100000
         OI    IOBFLG4,IOBSEC     INDICATE SECONDARY IOB         S99528 23160000
         L     R6,OLTLCBA-ONE     GET ADDRESS OF3705 LCB         S22024 23220000
         ST    R6,LCBADDR         SAVE LCB ADDRESS               S22024 23280000
         EJECT                                                          23340000
**************************************************************** S99528 23400000
*                                                              * S99528 23460000
*              STOP LINE ROUTINE                               * S99528 23520000
*                                                              * S99528 23580000
**************************************************************** S99528 23640000
         SPACE 1                                                        23700000
EX110    EQU   *                                                 S99528 23760000
         TM    $TOTFLG1,$TDATBLK  IS THIS A 3705 EXIO REQUEST?   S22024 23820000
         BO    EX3705             YES, BRANCH TO 3705 CODE       S22024 23880000
         TM    TOTFLG09,TOTNOBRK+TOTLNCON  ARE NO BREAK AND LINE S22024 23940000
*                                            CONNECTION DONE     S22024 24000000
*                                            BITS ON?            S22024 24060000
         BO    LINECONN           YES, BYPASS STOP LINE          S22024 24120000
         MVI   TOTOVBCD,LINESTOP  MOVE IN STOP LINE VERB CODE    S22024 24180000
*                                                                S99528 24240000
         L     R6,TOTAVTPT        GET ADDRESS OF AVT             S99528 24300000
         USING IEDQAVTD,R6                                       S99528 24360000
         LA    R10,AVTOPCOB        GET POINTER TO OP CNTRL QCB   S99528 24420000
         ST    R10,TOTOKEY        PUT IN PARAMETER LIST          S22024 24480000
         MVI   TOTOKEY,OPCKEY     ZERO OUT KEY FIELD             S22024 24540000
         DROP  R6                                                S99528 24600000
         MVC   TOTORLN,OLTTCRLN   MOVE IN RELATIVE LINE NUMBER   S22024 24660000
         SR    R6,R6              CLEAR                        @G36XRUV 24690010
         ICM   R6,3,OLTUCBA       GET ADDRESS OF UCB           @G36XRUV 24720010
         USING UCB,R6                                            S99528 24780000
         MVC   TOTWKSPC(ONE),D19(R6)  GET CONTROL UNIT FIELD     S22024 24840000
*                                       FROM UCB                 S22024 24900000
         NI    TOTWKSPC,X0F       CLEAR HIGH ORDER NIBBLE        S22024 24960000
         CLI   TOTWKSPC,RN3705    IS THIS A 3705 UCB?            S22024 25020000
         BE    LINECONN           YES, BYPASS STOPLINE           S22024 25080000
         MVI   TOTOLADR,X40       MOVE BLANK INTO NAME FIELD     S22024 25140000
         MVC   TOTOLADR+ONE(SEVEN),TOTOLADR  BLANK OUT FIELD     S22024 25200000
         MVC   TOTOLADR(THREE),UCBNAME  GET UNIT NAME            S22024 25260000
         DROP  R6                                                S99528 25320000
         LA    R1,TOTOTECB         GET TOTE ECB                  S99528 25380000
         ST    R1,TOTOECBA        PUT IN PARAMETER LIST          S22024 25440000
         XC    TOTOLINK(THREE),TOTOLINK  CLEAR REQUEST ELEMENT   S22024 25500000
*                                          LINK FIELD            S22024 25560000
         MVI   TOTOPRI,OPCPRI     SET OP CONTROL PRIORITY TO DC  S22024 25620000
         MVI   TOTORTCD,OPCRTCD   CLEAR RETURN CODE FIELD        S22024 25680000
         MVI   TOTOELNG,OPCELNG   SET ELEMENT LENGTH TO X'18'    S22024 25740000
         LA    R1,TOTPLIST        GET ADDRESS OF OP CONTROL      S22024 25800000
*                                   PARAMETER LIST               S22024 25860000
         ST    R1,ELEM1           SAVE IT IN 1ST WORD OF POST    S22024 25920000
*                                   LIST                         S22024 25980000
         ST    R1,ELEM2           SAVE IT IN SECOND WORD OF      S22024 26040000
*                                   SVC 102 POST LIST            S22024 26100000
         MVI   ELEM1,CODE         SET SVC 102 START CODE         S22024 26160000
         MVI   ELEM2,ENDLIST      SET SVC 102 END CODE           S22024 26220000
         LA    R1,SLPL            POINT R1 TO PARAMETER LIST     S22024 26280000
         XC    TOTOTECB(FOUR),TOTOTECB CLEAR TOTE ECB            S99528 26340000
         AQCTL                     POST ELEMENT TO OPERATOR CNTL S99528 26400000
*                                                                S99528 26460000
         WAIT  ECB=TOTOTECB                                      S99528 26520000
*                                                                S99528 26580000
         CLI   TOTORTCD,GOOD      WAS STOP LINE SUCCESSFUL?      S22024 26640000
         BE    LINECONN           YES, BRANCH                    S99528 26700000
         CLI   TOTORTCD,ALREADY   WAS THE LINE ALREADY STOPPED?  S22024 26760000
         BE    LINECONN           YES, STOPLINE SUCCESSFUL       S99528 26820000
         LA    R15,FOURTEEN       SET RETURN CODE TO INDICATE    S99528 26880000
*                                  LINE CONNECTION FAILED        S99528 26940000
         B     EXIT               RETURN TO CALLER               S99528 27000000
         EJECT                                                   S99528 27060000
**************************************************************** S99528 27120000
*                                                              * S99528 27180000
*        DETERMINE IF THE LINE NEEDS TO BE ENABLED.  IF THE    * S99528 27240000
*        TEST DEVICE IS A LINE, THIS ROUTINE IS BYPASSED. IF   * S99528 27300000
*        THE TEST DEVICE IS A TERMINAL, THE LINE IS ENABLED IF * S99528 27360000
*        NECESSARY.                                            * S99528 27420000
*                                                              * S99528 27480000
**************************************************************** S99528 27540000
LINECONN EQU   *                                                 S99528 27600000
         CLI   SWITCH,OLTCB       IS CDS INFORMATION CONTAINED   S99528 27660000
*                                   IN THE OLTCB?                S99528 27720000
         BNE   GETCDS             NO, GO GET CDS ADDRESS         S99528 27780000
         LA    R9,$PDEVADR        GET STARTING ADDRESS OF CDS    S99528 27840000
*                                   INFORMATION IN OLTCB         S99528 27900000
         B     TESTCONN           GO,DETERMINE IF CONNECTION     S99528 27960000
*                                    IS REQUIRED                 S99528 28020000
GETCDS   EQU   *                                                 S99528 28080000
         L     R9,XIOCDSA         GET ADDRESS OF CDS             S99528 28140000
TESTCONN EQU   *                                                 S99528 28200000
         CLI   SIX(R9),X40        IS THE TEST DEVICE A LINE?     S99528 28260000
         BE    SETUP              YES, NO LINE CONNECTION      @OY12988 28320000
*                                   IS REQUIRED                  S99528 28380000
         TM    NINE(R9),X01       NO, IS LINE CONNECTION         S99528 28440000
*                                   REQUIRED?                    S99528 28500000
         BZ    SETUP              NO, BRANCH                            28560000
         TM    TOTFLG09,TOTNOBRK+TOTLNCON  ARE NO BREAK AND LINE S22024 28620000
*                                            CONNECTION DONE     S22024 28680000
*                                            BITS ON?            S22024 28740000
         BO    SETUP              YES, BYPASS LINE CONNECTION    S22024 28800000
         XC    ECBOLT,ECBOLT           CLEAR ECB                 S99528 28860000
         LA    R3,IOB                  GET IOB ADDRESS           S99528 28920000
         ST    R3,DCBIOBAD             PUT IN DCB                S99528 28980000
         LA    R3,DCB                  GET DCB ADDRESS           S99528 29040000
         ST    R3,IOBDCBAD             PUT IN IOB                S99528 29100000
         LA    R3,ECBOLT               GET ECB ADDRESS           S99528 29160000
         ST    R3,IOBECBAD             PUT IN IOB                S99528 29220000
         LA    R3,LCBCPA               GET CCW ADDRESS           S99528 29280000
         ST    R3,IOBCCWAD             PUT IN IOB                S99528 29340000
         MVI   IOBFLG1,FLAG       SET IOB FLAGS TO DATA CHAINING S99528 29400000
*                                  AND UNRELATED ERROR           S99528 29460000
         SR    R8,R8              CLEAR                        @G36XRUV 29490010
         ICM   R8,3,OLTUCBA       SET UCB ADDRESS              @G36XRUV 29520010
         USING UCB,R8             SET UP ADDRESSIBILITY FOR UCB  S99528 29580000
         TM    UCBTBYT3,UCB3DISP       DISPLAY?                  S99528 29640000
         BO    SETUP              YES, NO LINE CONNECTION        S99528 29700000
*                                   REQUIRED                     S99528 29760000
         DROP  R8                 DROP UCB BASE                  S99528 29820000
*                                                                       29880000
PAS3     EQU   *                                                        29940000
         OI    DCBIFLGS,BYPERPS   BYPASS ERPS                    S99528 30000000
         SR    R6,R6              CLEAR                        @G36XRUV 30030010
         ICM   R6,3,OLTUCBA            GET UCB ADDRESS         @G36XRUV 30060010
*                                                                       30120000
CPBUILD  EQU   *                                                        30180000
*                                                                       30240000
         L     R15,LCBSIOCC       GET ADDRESS OF CHANNEL COMMAND S99528 30300000
*                                   AREA IN LCB                  S99528 30360000
         LA    R15,FOUR(R15)      PREPARE TO BUILD SECOND CCW    S99528 30420000
         EJECT                                                          30480000
*********************************************************************** 30540000
*                                                                     * 30600000
*        BUILD A DIAL COMMAND FOR DIAL LINES                          * 30660000
*                                                                     * 30720000
*********************************************************************** 30780000
         USING UCB,R6                                            S99528 30840000
         TM    UCBTYP+ONE,SWITCHED     IS THIS A DIAL UCB?       S22024 30900000
         BZ    NODIAL                  NO, BRANCH                S22024 30960000
         TM    UCBTYP+THREE,TCU2702    IS UCB FOR 2701 OR 2703?  S22024 31020000
         BNO   NODIAL                  NO, GO GET SAD COMMAND    S22024 31080000
*                                        FOR 2702                S22024 31140000
*                                                                       31200000
*                                                                       31260000
*                                                                       31320000
DIALBLD  EQU   *                                                        31380000
*                                                                       31440000
         TM    UCBTYP+THREE,SDAII    SDA II?                     S99528 31500000
         BO    SETBISCP                YES BR                    S99528 31560000
         BAL   R8,GETDIGTS             GO SEARCH TTE FOR DIAL DIGS99528 31620000
         SR    R6,R6              CLEAR                        @G36XRUV 31650010
         ICM   R6,3,OLTUCBA       GET UCB ADDRESS              @G36XRUV 31680010
         L     R8,DIALADDR             ADDRESS OF DIAL DIGEST    S99528 31740000
         MVC   ELEVEN(ONE,R15),ZERO(R8) PUT NUMBER IN CCW        S99528 31800000
         LA    R8,ONE(R8)         BUMP PAST NO OF DIGITS         S99528 31860000
         ST    R8,FOUR(R15)       STORE IN CCW                   S99528 31920000
         MVC   EIGHT(ONE,R15),SILI  SET SILI BIT                 S99528 31980000
         MVI   FOUR(R15),DIALCMD  PUT DIAL COMMAND INTO CCW      S99528 32040000
         B     STARTLIN           GO START LINE                         32100000
         EJECT                                                          32160000
*********************************************************************** 32220000
*                                                                     * 32280000
*        IF 2702 SET UP CORRECT SAD COMMAND                           * 32340000
*                                                                     * 32400000
*********************************************************************** 32460000
NODIAL   EQU   *                                                 S99528 32520000
         TM    UCBTYP+THREE,TCU2702  2702 TCU?                   S99528 32580000
         BO    NOT2702                 BRANCH IF NOT 2702        S99528 32640000
         IC    R3,UCBTYP+ONE           GET FEATURE BYTE FROM UCB S99528 32700000
         N     R3,ANDMASK         CLEAR UNWANTED BITS                   32760000
         IC    R3,SADCODE(R3)     INSERT ACTUAL SAD COMMAND             32820000
         STC   R3,FOUR(R15)       STORE IN CPA                   S99528 32880000
         MVC   EIGHT(FOUR,R15),NOP BUILD REST OF COMMAND         S99528 32940000
         LA    R15,EIGHT(R15)     BUMP POINTER TO NEXT CCW       S99528 33000000
         TM    UCBTYP+ONE,SWITCHED  IS UCB FOR A DIAL LINE       S22024 33060000
         BZ    NOT2702            NO, BRANCH EVEN THOUGH A 2702  S22024 33120000
         OI    ZERO(R15),CCSLI    TURN ON CC AND SLI IN PREVIOUS S99528 33180000
*                                  CCW                           S99528 33240000
         B     DIALBLD            EXIT TO BUILD DIAL CCW                33300000
         EJECT                                                          33360000
*********************************************************************** 33420000
*                                                                     * 33480000
*        SET CORRECT COMMANDS FOR 2701 AND 2703                       * 33540000
*                                                                     * 33600000
*********************************************************************** 33660000
NOT2702  EQU   *                                                        33720000
*                                                                       33780000
         CLI   UCBTYP+THREE,TYPEIII  TEST FOR 2701 WITH IBM III  S22024 33840000
         BNE   ENABLE0            NO, CONTINUE LINE CONNECTION   S22024 33900000
         LA    R15,GOOD           LINE ALREADY CONDITION         S99528 33960000
         B     SETUP              BRANCH, NO LINE CONNECTION REQUIRED   34020000
ENABLE0  EQU   *                                                        34080000
         TM    UCBTYP+THREE,SDAII SDA II                         S99528 34140000
         BO    SETBISCP                YES BRANCH                S99528 34200000
*                                                                       34260000
*        BUILD AN ENABLE COMMAND IF NOT A DIAL                          34320000
*                                                                       34380000
ENABLEA  EQU   *                                                        34440000
*                                                                       34500000
         MVC   FOUR(ONE,R15),ENABLE  SET COMMAND CODE FOR ENABLE S99528 34560000
         MVC   EIGHT(FOUR,R15),NOP  SET UP REST OF CCW           S99528 34620000
         OI    ZERO(R15),CCSLI    TURN ON CC AND SLI             S99528 34680000
         B     STARTLIN           EXIT TO ENABLE LINE            S99528 34740000
*                                                                       34800000
TSTRESTR EQU   *                                                        34860000
*                                                                       34920000
* BUILD CHANNEL PGM FOR BI-SYNC DEVICE                                  34980000
         BAL   R8,GETDIGTS        GO SEARCH TTE FOR DIAL DIGITS  S99528 35040000
         SR    R6,R6              CLEAR                        @G36XRUV 35070010
         ICM   R6,3,OLTUCBA       GET UCB ADDRESS              @G36XRUV 35100010
         L     R8,DIALADDR        ADDRESS IF DIAL DIGITS         S99528 35160000
         MVC   ELEVEN(ONE,R15),ZERO(R8)  PUT NUMBER IN CCW       S99528 35220000
         LA    R8,ONE(R8)         BUMP PAST NO OF DIGITS         S99528 35280000
         OI    EIGHT(R15),SLI     TURN ON SLI IN THIS CCW        S99528 35340000
         OI    ZERO(R15),CCSLI    TURN ON CC AND SLI IN PRIOR CCWS99528 35400000
         ST    R8,FOUR(R15)       PUT ADDR IN CCW                S99528 35460000
         MVI   FOUR(R15),DIALCMD  PUT DIAL COMMAND IN CCW        S99528 35520000
         B     STARTLIN           EXIT TO ENABLE LINE            S99528 35580000
         EJECT                                                          35640000
*********************************************************************** 35700000
*                                                                     * 35760000
*        THIS ROUTINE BUILDS THE CHANNEL PROGRAM FOR A                * 35820000
*        BINARY SYNCHRONOUS DEVICE                                    * 35880000
*                                                                     * 35940000
*********************************************************************** 36000000
SETBISCP EQU   *                                                        36060000
         L     R3,OLTRLTNT        GET ADDRESS OF TERMNAME TABLE  S99528 36120000
*                                   ENTRY                        S99528 36180000
         SR    R10,R10            CLEAR REGISTER 10                     36240000
         IC    R10,TOTTTBEL       GET NAME LENGTH                S99528 36300000
         AR    R10,R3             GET ADDRESS OF TERMINAL ENTRY  S99528 36360000
         MVC   TNTENTRY+ONE(THREE),ZERO(R10) MOVE ADDRESS TO     S99528 36420000
*                                              PROPER BOUNDARY   S99528 36480000
         L     R8,TNTENTRY        GET ADDR OF TERM TABLE ENTRY          36540000
         L     R8,ZERO(R8)        GET QCB ADDRESS                S99528 36600000
         SR    R9,R9              CLEAR REGISTER 9               S99528 36660000
         IC    R9,THIRTY2(R8)     GET RLN                        S99528 36720000
         SLL   R9,2               MULTIPLY BY 4                  S99528 36780000
         L     R8,THIRTY2(R8)     GET DCB ADDRESS                S99528 36840000
         LA    R3,X'38'(R9,R8)    GET ADDR OF SETMODE BYTE              36900000
         L     R8,OLTUCBA         GET UCB ADDRESS                S99528 36960000
*                                                                       37020000
SETMODEA EQU   *                                                 S99528 37080000
*                                                                       37140000
         ST    R3,FOUR(R15)       PUT ADDRESS OF MODE BYTE IN CCWS99528 37200000
         MVC   FOUR(ONE,R15),SETMODE PUT IN SET MODE COMMAND     S99528 37260000
         MVC   EIGHT(FOUR,R15),NOP  BUILD REST OF CCW            S99528 37320000
         OI    ZERO(R15),CMMDCH   TURN ON COMMAND CHAIN          S99528 37380000
         LA    R15,EIGHT(R15)     INCREMENT CPA POINTER          S99528 37440000
         MVC   FOUR(ONE,R15),ENABLE  SET COMMAND CODE FOR ENABLE S99528 37500000
         MVC   EIGHT(FOUR,R15),NOP  SET UP REST OF CCW           S99528 37560000
         OI    ZERO(R15),CCSLI    TURN ON CC AND SLI             S99528 37620000
         TM    UCBTYP+ONE,SWITCHED     SWITCHED DEVICE?         SA64784 37680000
         BNZ   TSTRESTR                YES, BRANCH              SA64784 37740000
         B     STARTLIN           EXIT TO ENABLE LINE                   37800000
*                                                                       37860000
         EJECT                                                          37920000
**************************************************************** S22024 37980000
*                                                              * S22024 38040000
*        ISSUE EXCP TO ESTABLISH LINE CONNECTION WITH THE      * S22024 38100000
*        TEST DEVICE                                           * S22024 38160000
*                                                              * S22024 38220000
**************************************************************** S22024 38280000
         SPACE 2                                                        38340000
*                                                                       38400000
EXCP     EQU   *                                                        38460000
*                                                                       38520000
         LA    R10,THREE                                         S99528 38580000
         TM    UCBTYP+ONE,SDAII   SET LOOP COUNT                 S99528 38640000
         BZ    NORMX                   SWITCHED?                 S99528 38700000
         TM    UCBTYP+ONE,AUTOCALL DOES UCB INDICATE AUTOCALL?   S22024 38760000
         BO    NORMX              YES, BRANCH                    S22024 38820000
         MVI   FOUR(R15),ENABLCMD CHANGE COMMAND FROM DIAL TO    S22024 38880000
*                                   ENABLE                       S22024 38940000
         MVC   DIALLINE(THREE),UCBNAME  MOVE LINE NAME INTO MSG  S22024 39000000
         L     R8,DIALADDR        GET ADDRESS OF DIAL DIGITS     S22024 39060000
         SR    R3,R3              CLEAR REGISTER 3               S22024 39120000
         IC    R3,ZERO(R8)        GET NUMBER OF DIAL DIGITS      S22024 39180000
         LTR   R3,R3              ARE THERE ANY DIAL DIGITS?    SA64784 39240000
         BZ    DIALMSG            NO, GO ISSUE MSG WITHOUT DIAL SA64784 39300000
*                                   DIGITS                      SA64784 39360000
EBCDIC   EQU   *                                                 S22024 39420000
         LA    R8,ONE(R8)         BUMP TO NEXT DIAL DIGIT        S22024 39480000
         OI    ZERO(R8),XF0       CONVERT DIGIT TO EBCDIC        S22024 39540000
         BCT   R3,EBCDIC          GO CONVERT NEXT DIGIT          S22024 39600000
         L     R8,DIALADDR        GET ADDR OF START OF DIAL DIGITS22024 39660000
         IC    R3,ZERO(R8)        GET NUMBER OF DIAL DIGITS      S22024 39720000
         BCT   R3,MOVEDIG         DECREMENT COUNT FOR EXECUTE    S22024 39780000
MOVEDIG  EQU   *                                                 S22024 39840000
         EX    R3,MOVEDIAL        MOVE DIAL DIGITS INTO MESSAGE  S22024 39900000
DIALMSG  WTO   'IED158A     DIAL                     '  MANUAL   S22024 39960000
*                                                       DIAL MSG S22024 40020000
DIALLINE EQU   DIALMSG+16         LINE FOR MANUAL DIAL           S22024 40080000
DIALNUM  EQU   DIALMSG+25         DIAL DIGITS FOR MANUAL DIAL    S22024 40140000
*                                                                       40200000
NORMX    EQU   *                                                        40260000
         EXCP  IOB                     ENABLE                    S99528 40320000
         WAIT  ECB=ECBOLT              WAIT FOR COMPLEATION      S99528 40380000
*                                                                       40440000
         CLI   ECBOLT,NORMAL      NORMAL COMPLETION?             S99528 40500000
         BE    EXCPOK             YES                                   40560000
         XC    ECBOLT(FOUR),ECBOLT   CLEAR ECB                   S99528 40620000
         XC    IOBSNS(TWO),IOBSNS CLEAR SENSE BYTES IN IOB       S99528 40680000
         XC    IOBCSW(EIGHT),IOBCSW   CLEAR CHANNEL STATUS WORD  S99528 40740000
         BCT   R10,NORMX               RETRY OPERATION           S99528 40800000
         LA    R15,FOURTEEN       SET RETURN CODE INDICATING     S99528 40860000
*                                   LINE CONNECTION FAILED       S99528 40920000
         B     EXIT               GET OUT                        S99528 40980000
EXCPOK   EQU   *                                                        41040000
*                                                                       41100000
         OI    TOTFLG09,TOTLNCON  SET LINE CONNECTION DONE BIT   S22024 41160000
         BR    R9                 RETURN                                41220000
*                                                                       41280000
MOVEDIAL MVC   DIALNUM(ZERO),ONE(R8)   MOVE DIAL DIGITS INTO     S22024 41340000
*                                        MANUAL DIAL MESSAGE     S22024 41400000
         EJECT                                                          41460000
*********************************************************************** 41520000
*                                                                     * 41580000
*       THIS ROUTINE FINDS DIAL DIGITS FOR AUTO CALL LINES            * 41640000
*                                                                     * 41700000
*********************************************************************** 41760000
GETDIGTS L     R1,OLTRLTNT             GET REAL TNT ENTRY        S99528 41820000
         SR    R10,R10            CLEAR REGISTER 10              S99528 41880000
         IC    R10,TOTTTBEL       GET NAME LENGTH                S99528 41940000
         AR    R10,R1             GET TTE ADDRESS                S99528 42000000
         MVC   ALINETTE+ONE(THREE),ZERO(R10)  MOVE ADDRESS TO    S99528 42060000
*                                             BOUNDARY           S99528 42120000
         L     R10,ALINETTE       GET TTE ADDRESS                S99528 42180000
         USING IEDQTRM,R10        ESTABLISH ADDRESSIBILITY FOR   S99528 42240000
*                                   TERMINAL TABLE ENTRY         S99528 42300000
         TM    TRMDEVFL,DIAL           DIAL DIGITS PRESENT?      S99528 42360000
         BNO   NODIALL                 NO DIGITS BRANCH          S99528 42420000
         TM    TRMSTATE,TSG            GROUP,SINGLE OR TERMINAL ?S99528 42480000
         BM    NODIALL                 NEITHER BRANCH            S99528 42540000
         L     R1,ALINETTE             GET TTE ADDRESS           S99528 42600000
         TM    TRMSTATE,TRMOPTFN       OPTION FIELD PRESENT?     S99528 42660000
         BO    ADDOPTS                 YES BRANCH                S99528 42720000
         AH    R1,NOOPT                POINT PAST OPTIONS        S99528 42780000
         B     DEVDEP                  BRANCH AROUND ADDOPTIONS  S99528 42840000
ADDOPTS  AH    R1,OPTIONS              POINT PAST OPTIONS        S99528 42900000
         SR    R6,R6                   CLEAR R6                  S99528 42960000
         IC    R6,TRMOPNO              GET # OF OPTION BYTES     S99528 43020000
         AR    R1,R6                                             S99528 43080000
DEVDEP   EQU   *                                                 S99528 43140000
         TM    TRMDEVFL,BUFSIZE        BUFFER SIZE DEV DEPENDENT S99528 43200000
         BNO   DIALDIGT                NO BRANCH                 S99528 43260000
         IC    R6,TRMOPT               GET LENGTH OF BUFSIZE FIELS99528 43320000
         AR    R1,R6                   BUMP AROUND BUFSIZE FIELD S99528 43380000
DIALDIGT EQU   *                                                 S99528 43440000
         ST    R1,DIALADDR             SAVE ADDRESS OF DIAL DIGITS99528 43500000
         B     ZERO(R8)           RETURN                         S99528 43560000
NODIALL  EQU   *                                                 S99528 43620000
         LA    R15,FOURTEEN       INSERT RETURN CODE TO INDICATE S99528 43680000
*                                   LINE CONNECTION FAILED       S99528 43740000
*                                  NO DIAL DIGITS OR INVALID     S99528 43800000
         B     EXIT               GET OUT                        S99528 43860000
         DROP  R10                DROP TERMINAL TABLE ENTRY BASE S99528 43920000
         EJECT                                                          43980000
*********************************************************************** 44040000
*                                                                     * 44100000
*        ISSUE EXCP FOR LINE ENABLING                                 * 44160000
*                                                                     * 44220000
*********************************************************************** 44280000
STARTLIN EQU   *                                                        44340000
*                                                                       44400000
         BAL   R9,EXCP            GO ENABLE LINE                        44460000
         EJECT                                                          44520000
*********************************************************************** 44580000
*                                                                     * 44640000
*        EXECUTE THE CHANNEL PROGRAM PASSED BY THE OLT                * 44700000
*                                                                     * 44760000
*********************************************************************** 44820000
         SPACE 2                                                        44880000
SETUP    EQU   *                                                 S99528 44940000
         L     R5,XIOTECBA        GET TECB ADDRESS AND STORE IT  S99528 45000000
         LTR   R5,R5              IS THE TECB ADDRESS GIVEN?     S99528 45060000
         BZ    ERROR              NO, BRANCH TO ERROR EXIT       S99528 45120000
         ST    R5,TECBADDR         IN THE IOBLOCKS FIELD         S99528 45180000
*                                                                       45240000
         XC    ECBOLT(FOUR),ECBOLT  CLEAR ECB                           45300000
*                                                                       45360000
*        CLEAR I/O BLOCK & SET IT UP FOR EXCP                           45420000
*                                                                       45480000
         MVI   IOB,CLEAR          CLEAR OUT THE                         45540000
         MVC   IOB+ONE(DCB-IOB),IOB IOB                                 45600000
         SPACE 2                                                        45660000
**************************************************************** S99528 45720000
*                                                              * S99528 45780000
*        SET UP IOB IF ATTENTION INTERRUPT IS EXPECTED         * S99528 45840000
*                                                              * S99528 45900000
**************************************************************** S99528 45960000
         SPACE 1                                                        46020000
         TM    XIOFLAG,ATTNIN     IS AN ATTENTION INTERRUPT      S99528 46080000
*                                   EXPECTED?                    S99528 46140000
         BZ    SETBIT             NO, BYPASS SET UP              S99528 46200000
         L     R5,XIOCCWA         GET ADDRESS OF CCW'S           S99528 46260000
         SR    R6,R6              CLEAR REG 6                    S99528 46320000
         IC    R6,XIOCCWC         INSERT CCW COUNT               S99528 46380000
LOOP00   EQU   *                                                 S99528 46440000
         CLI   ZERO(R5),NOOP      IS IT A NO-OP?                 S99528 46500000
         BE    LOOP01             YES, GO BRANCH                 S99528 46560000
         CLI   ZERO(R5),TIC       NO, IS IT A TIC?               S99528 46620000
         BNE   LOOP03             NO, GO BRANCH                  S99528 46680000
         LA    R5,ZERO(R5)        YES, A TIC - GET NEXT CCW      S99528 46740000
LOOP04   EQU   *                                                 S99528 46800000
         BCT   R6,LOOP00          DECREMENT CCW COUNT            S99528 46860000
         B     ERROR              WAS THAT THE LAST CCW?         S99528 46920000
*                                 IF YES, ERROR CONDITION        S99528 46980000
LOOP01   EQU   *                                                 S99528 47040000
         BCT   R6,LOOP02          DECREMENT CCW COUNT            S99528 47100000
LOOP02   EQU   *                                                 S99528 47160000
         DS    0H                 NO-OP WAS FOUND BUT,           S99528 47220000
         LTR   R6,R6              IS IT THE LAST CCW?            S99528 47280000
         BZ    LOOPEND            YES, ALL IS OK                 S99528 47340000
*                                                                S99528 47400000
LOOP03   EQU   *                                                 S99528 47460000
         LA    R5,EIGHT(R5)       BUMP TO NEXT CCW               S99528 47520000
         B     LOOP04             LOOP TO SEARCH AGAIN           S99528 47580000
*                                                                S99528 47640000
LOOPEND  EQU   *                                                 S99528 47700000
         OI    IOBFLG4,IOBATTN    SET BIT IN IOB INDICATING THAT S99528 47760000
*                                    AN ATTENTION IS EXPECTED    S99528 47820000
         SPACE 2                                                        47880000
SETBIT   EQU   *                                                 S99528 47940000
*                                                                       48000000
         TM    TOTFLG07,TOTPRIEX  IS THE TEST DEVICE PRIMARY?    S99528 48060000
         BZ    SECOND1            NO, CHECK FOR SECONDARY        S99528 48120000
         OI    IOBFLG4,IOBPRI     YES, INDICATE PRIMARY IOB      S99528 48180000
         B     PRIIOB             BYPASS SECONDARY SETUP         S99528 48240000
SECOND1  EQU   *                                                 S99528 48300000
         OI    IOBFLG4,IOBSEC     INDICATE SECONDARY IOB         S99528 48360000
PRIIOB   EQU   *                                                 S99528 48420000
         OI    IOBFLG1,UNREL      SET UNRELATED FLAG                    48480000
         OI    IOBRSTAD,XFF       PUT X'FFFFFF'                         48540000
         MVC   IOBRSTAD+ONE(TWO),IOBRSTAD  IN RESTART ADDRESS           48600000
*                                                                       48660000
         SR    R10,R10            CLEAR R10                             48720000
         IC    R10,XIOCCWC        GET NUMBER OF CCW'S            S99528 48780000
         SPACE 1                                                        48840000
         L     R8,XIOCCWA         GET CHANNEL PROGRAM ADDRESS    S99528 48900000
         ST    R8,IOBCCWAD         AND STORE IT IN IOBLOCKS      S99528 48960000
*                                                                       49020000
XIO003   EQU   *                                                 S22024 49080000
         CLI   ZERO(R8),CCWTIC    IS IT TRANSFER IN CHANNEL?            49140000
         BNE   XIO004               NO                                  49200000
         L     R8,ZERO(R8)          YES, GET TIC ADDRESS                49260000
         B     XIO007             GO PREPARE TO ISSUE EXCP              49320000
*                                                                       49380000
XIO004   EQU   *                                                        49440000
         TM    FOUR(R8),CHAINDAT  IS DATA CHAINING SET IN CCW?          49500000
         BZ    XIO005               NO                                  49560000
         OI    IOBFLG1,CHAINDAT     YES: SET IOB DATA CHAINING FLAG     49620000
*                                                                       49680000
XIO005   EQU   *                                                        49740000
         TM    FOUR(R8),CHAINCMD  IS COMMAND CHAINING SET IN CCW?       49800000
         BZ    XIO006               NO                                  49860000
         OI    IOBFLG1,CHAINCMD     YES: SET IOB COMMAND CHAINING FLAG  49920000
*                                                                       49980000
XIO006   EQU   *                                                        50040000
         LA    R8,EIGHT(R8)       GET NEXT CCW                          50100000
*                                                                       50160000
XIO007   EQU   *                                                        50220000
         BCT   R10,XIO003         LOOP UNTIL LAST CCW IS CHECKED        50280000
*                                                                       50340000
*        SET UP DCB FOR EXCP                                            50400000
*                                                                       50460000
         OI    DCBIFLGS,BYPERPS   SET DCB FLAGS TO BYPASS ERPS          50520000
         NI    DCBIFLGS,XFF-PERMERR  CLEAR PERMANENT ERROR FLAGS        50580000
*                                                                       50640000
         LA    R3,IOB             GET ADDRESS OF IOB             S99528 50700000
         ST    R3,DCBIOBAD        STORE ADDRESS IN DCB           S99528 50760000
         LA    R3,DCB             GET ADDRESS OF DCB             S99528 50820000
         ST    R3,IOBDCBAD        STORE ADDRESS IN IOB           S99528 50880000
         LA    R3,ECBOLT          GET ADDRESS OF ECB             S99528 50940000
         ST    R3,IOBECBAD        STORE ADDRESS IN IOB           S99528 51000000
*                                                                       51060000
XIO002A  EQU   *                                                        51120000
*                                                                       51180000
         LA    R1,IOB             PUT IOB ADDRESS IN R1                 51240000
*                                                                       51300000
         EXCP  (1)                ISSUE EXCP                            51360000
*                                                                       51420000
         TM    XIOFLAG,SENSENO    WAS SENSE=NO SPECIFIED?        S99528 51480000
         BNO   GOODRET            NO, GO SET GOOD RETURN CODE    S99528 51540000
         LA    R15,TEN            SET RETURN CODE INDICATING     S99528 51600000
*                                   THAT EXIO WAS EXECUTED BUT   S99528 51660000
*                                   SENSE BYPASS NOT AVAILABLE   S99528 51720000
         B     EXIT               RETURN TO CALLER               S99528 51780000
         EJECT                                                          51840000
**************************************************************** S22024 51900000
*                                                              * S22024 51960000
*        THIS ROUTINE HANDLES AN EXIO REQUEST FOR A TERMINAL   * S22024 52020000
*        OR LINE ON A 3705.                                    * S22024 52080000
*                                                              * S22024 52140000
**************************************************************** S22024 52200000
         SPACE 2                                                        52260000
EX3705   EQU   *                                                 S22024 52320000
         L     R5,XIOCCWA         GET ADDRESS OF CCW CHAIN       S22024 52380000
         USING CCW,R5             ESTABLISH ADDRESSIBILITY       S22024 52440000
*                                  FOR CCW                       S22024 52500000
         ST    R5,OLTCCWA         SAVE ADDR OF FIRST CCW       @Y17XAUQ 52560000
         CLI   CCWCMD,READ        IS THIS A READ CCW?            S22024 52620000
         BNE   WRITECCW           NO, GO CHECK FOR WRITE CCW     S22024 52680000
         B     GOODRET            GO SET GOOD RETURN CODE & EXIT S22024 52740000
WRITECCW EQU   *                  ESTABLISH BRANCH POINT       @Y17XAUQ 52800000
         CLI   CCWCMD,RSRESET     IS IT A RESTART RESET        @Y17XAUQ 52860000
         BNE   ERROR              NO: A BAD CCW STRING         @Y17XAUQ 52920000
BUMPCCW  LA    R5,CCWLNGTH(R5)    YES: BUMP TO NEXT CCW        @Y17XAUQ 52980000
         CLI   CCWCMD,RDSTART0    IS IT A READ START0          @Y17XAUQ 53040000
         BE    BUMPCCW            YES, BUMP OVER               @Y17XAUQ 53100000
         CLI   CCWCMD,WRSTART0    IS IT A WRITE START0         @Y17XAUQ 53160000
         BE    BUMPCCW            YES, BUMP OVER               @Y17XAUQ 53220000
         ST    R5,OLTCCWA         SAVE ADDR OF THIS CCW        @Y17XAUQ 53280000
         CLI   CCWCMD,READ        IS IT A READ CCW             @Y17XAUQ 53340000
         BE    GOODRET            YES, SET GOOD RETURN & EXIT  @Y17XAUQ 53400000
         CLI   CCWCMD,WRITE       IS IT A WRITE CCW            @Y17XAUQ 53460000
         BE    EX3705A            YES - CONTINUE               @Y17XAUQ 53520000
         CLI   CCWCMD,WRITEBK     IS IT A WRITE BREAK          @YM07991 53580000
         BNE   ERROR              NO - ERROR                   @YM07991 53640000
         EJECT                                                          53700000
**************************************************************** S22024 53760000
*                                                              * S22024 53820000
*        THE FOLLOWING CODE HANDLES THE REQUEST FOR A BUFFER   * S22024 53880000
*        FROM THE TCAM BUFFER UNIT POOL.  THE ERB IS BUILT AND * S22024 53940000
*        POSTED TO THE BUFFER REQUEST QCB VIA SVC 102.         * S22024 54000000
*                                                              * S22024 54060000
**************************************************************** S22024 54120000
         SPACE 2                                                        54180000
EX3705A  EQU   *                                                 S22024 54240000
         BAL   R8,RSIDCHK         GO VERIFY RSID IN BTU          S22024 54300000
         LA    R12,TOTWKSPC       GET ADDRESS OF WORKSPACE       S22024 54360000
         USING DUMMYLCB,R12                                      S22024 54420000
         MVI   ERBSTAT,X02        STATUS OF ERB SET TO THAT OF   S22024 54480000
*                                  AN APPLICATION PROGRAM        S22024 54540000
         XC    ERBCHAIN(THREE),ERBCHAIN  ERBCHAIN IS ZEROED OUT  S22024 54600000
*                                        BEFORE REQUEST IS POSTEDS22024 54660000
         MVI   ERBCNT1,ONE         ONLY 1 BUFFER IS REQUESTED    S22024 54720000
         L     R3,TOTAVTPT        GET AVT ADDRESS                S22024 54780000
         USING IEDQAVTD,R3        ESTABLISH ADDRESSIBILITY       S22024 54840000
         SR    R8,R8              CLEAR REGISTER 8               S22024 54900000
         LA    R8,AVTHDRSZ        GET SIZE OF HEADER PREFIX    @Y17XAUQ 54960000
         STH   R8,PRFXSIZE        SAVE IT FOR CCW BUFFER TO    @YM08005 55020000
*                                 TCAM BUFFER MOVE             @Y17XAUQ 55080000
         LH    R8,AVTKEYLE        GET UNIT SIZE FROM AVT         S22024 55140000
         STH   R8,UNITSIZE        STORE UNIT SIZE                S22024 55200000
         L     R6,AVTDELAD        GET DUMMY ELEMENT ADDRESS      S22024 55260000
         ST    R6,ELCHNQCB-ONE    PLACE DUMMY ELEMENT IN FIRST   S22024 55320000
*                                  WORD OF QCB                   S22024 55380000
         LA    R6,AVTBFREB        GET ADDRESS OF BUFFER REQUEST  S22024 55440000
*                                  QCB                           S22024 55500000
         ST    R6,ERBQCB-ONE      ADDRESS OF BUFFER REQUEST QCB  S22024 55560000
*                                  IS PUT IN 1ST WORD OF ERB     S22024 55620000
         DROP  R3                 DROP AVT                       S22024 55680000
         L     R6,OLTCCWA         GET FIRST WRITE CCW          @YM08005 55740000
         L     R6,ZERO(R6)        GET @ OF DATA TO LOOK AT THE          55800000
*                                 TRANSMISSION HEADER(TH)      @YM08005 55860000
         USING OLLTFID1,R6                                     @YM08005 55920000
         SLR   R9,R9              CLEAR REG                    @YM08005 55980000
         ICM   R9,3,OLLTDCF       GET DATA COUNT FIELD FROM THE         56040000
*                                 THE TH                       @YM08005 56100000
         AH    R9,PRFXSIZE        BUMP COUNT BY PREFIX SIZE    @YM08005 56160000
         LA    R3,OLLTRHLG        GET LENGTH OF RH             @YM08005 56220000
         SR    R9,R3              DECREMENT NEEDED SIZE        @YM08005 56280000
         STH   R9,BUFDATLN        SAVE DATA COUNT FOR BUF PREFIX        56340000
*                                 BETWEEN CUA AND BTU TOTAL             56400000
*                                 SIZE                         @YM08005 56460000
         DROP  R6                                              @YM08005 56520000
         SR    R8,R8              CLEAR REGISTER 8               S22024 56580000
         LH    R10,UNITSIZE       GET SIZE OF UNIT               S22024 56640000
         DR    R8,R10             DETERMINE NUMBER OF UNITS      S22024 56700000
*                                  NEEDED                        S22024 56760000
         AH    R9,ONEMORE         ADD ONE TO REQUESTED UNITS     S22024 56820000
         STC   R9,ERBCNT2         PUT REQUIRED NUMBER OF UNITS   S22024 56880000
*                                  INTO ERB                      S22024 56940000
         STC   R9,UNITUSED        SAVE # OF UNITS IN THIS BUF  @Y17XAUQ 57000000
         MVI   QCB0SFLG,X02       QCB IDENTIFICATION BYTE        S22024 57060000
         LA    R9,DUMQCB          GET ADDRESS OF DUMMY QCB TO    S22024 57120000
*                                  WHICH BUFFER IS POSTED        S22024 57180000
         ST    R9,RCQCBLCB        STORE QCB ADDRESS IN LCB       S22024 57240000
         ST    R9,QCBPTR          LAST WORD OF QCB POINTS TO     S22024 57300000
*                                  FIRST WORD OF DUMMY QCB       S22024 57360000
         XC    STAT1LCB(TWO),STAT1LCB  CLEAR LCB STATUS BYTES    S22024 57420000
         MVI   ERBPRI,BRPRI       SET ERB PRIORITY TO X'E4'      S22024 57480000
         LA    R1,ERBLCB          GET ADDRESS OF ERB             S22024 57540000
         ST    R1,ELPT1-ONE       ADDRESS OF ERB PUT IN PARM LISTS22024 57600000
         ST    R1,ELPT2-ONE       ADDRESS OF ERB PUT IN PARM LISTS22024 57660000
         MVI   ACTCODE,CODE       SET ACTION CODE IN PARM LIST   S22024 57720000
         MVI   LASTWD,ENDLIST     INDICATE LAST WORD OF PARM LISTS22024 57780000
         LA    R1,PARMLIST        PLACE ADDRESS OF SVC 102'S PARMS22024 57840000
*                                  LIST INTO REG 1               S22024 57900000
         XC    ECBO(FOUR),ECBO    CLEAR ECB                      S22024 57960000
         AQCTL                    ISSUE SVC 102                  S22024 58020000
         WAIT  ECB=ECBO           WAIT FOR BUFFER TO BE RETURNED S22024 58080000
         SPACE 2                                                        58140000
*        THE FOLLOWING CODE INITIALIZES THE SCB                * S22024 58200000
         SPACE 2                                                        58260000
         LA    R6,SCB             GET SCB ADDRESS                S22024 58320000
         ST    R6,SCBALCB-ONE     PUT SCB ADDRESS INTO LCB       S22024 58380000
         XC    STATESCB(ONE),STATESCB  CLEAR SCB STATUS BYTE     S22024 58440000
         MVC   DESTQSCB(THREE),OLTQCBA  PUT QCB ADDRESS INTO SCB S22024 58500000
         EJECT                                                          58560000
**************************************************************** S22024 58620000
*                                                              * S22024 58680000
*        THE FOLLOWING CODE MOVES THE DATA FROM THE CCW CHAIN  * S22024 58740000
*        INTO THE BUFFER UNITS                                 * S22024 58800000
*                                                              * S22024 58860000
**************************************************************** S22024 58920000
         SPACE 2                                                        58980000
         L     R3,ERBCHAIN-ONE    GET STARTING ADDRESS OF BUFFER S22024 59040000
         LA    R6,TWELVE(R3)      GET ADDRESS OF FIRST BYTE      S22024 59100000
*                                   IN BUFFER                    S22024 59160000
         AH    R6,PRFXSIZE        LEAVE SPACE FOR PREFIX       @Y17XAUN 59220000
         LH    R8,UNITSIZE        GET SIZE OF BUFFER UNIT      @Y17XAUQ 59280000
         SH    R8,PRFXSIZE        DECREMENT SPACE USED FOR PFX @Y17XAUQ 59340000
         L     R7,CCWADDR-ONE     GET ADDRESS OF DATA TO BE MOVEDS22024 59460000
         LH    R9,CCWCOUNT        GET NUMBER OF BYTES TO BE MOVEDS22024 59520000
*                                  INTO BUFFER                   S22024 59580000
         SR    R3,R3              CLEAR REG                    @Y17XAUQ 59640000
         LA    R3,OLLTRHLG+OLLTTHLG GET LENGTH OF TH/RH        @YM08055 59700000
         SR    R9,R3              SUBTRACT IT FROM COUNT       @Y17XAUQ 59760000
         AR    R7,R3              BUMP DATA POINTER OVER RH    @Y17XAUQ 59820000
EX370510 EQU   *                                               @Y17XAUU 59850000
         L     R3,ERBCHAIN-ONE    RESTORE REG                  @Y17XAUQ 59880000
         CR    R8,R9              IS UNIT SIZE GREATER THAN DATA S22024 59940000
*                                  SIZE IN CCW?                  S22024 60000000
         BL    EX370560           NO,BRANCH                      S22024 60060000
EX370530 EQU   *                                                 S22024 60120000
         BCTR  R9,ZERO            DECREMENT COUNT BY ONE         S22024 60180000
         EX    R9,MOVE            GO MOVE DATA INTO BUFFER       S22024 60240000
         LA    R9,ONE(R9)         RESTORE COUNT                  S22024 60300000
         SR    R8,R9              GET NUMBER OF BYTES LEFT       S22024 60360000
*                                  IN UNIT                       S22024 60420000
         LTR   R8,R8              WAS UNIT SIZE=DATA SIZE?       S22024 60480000
         BZ    EX370540           YES, GO GET ADDRESS OF NEXT    S22024 60540000
*                                  UNIT                          S22024 60600000
         LA    R6,ZERO(R9,R6)     CALCULATE ADDRESS OF NEXT BYTE S22024 60660000
*                                  IN BUFFER TO HAVE DATA        S22024 60720000
*                                  INSERTED                      S22024 60780000
         B     EX370550           BRANCH AROUND UNIT SET UP      S22024 60840000
EX370540 EQU   *                                                 S22024 60900000
         L     R3,EIGHT(R3)       GET ADDRESS OF NEXT UNIT       S22024 60960000
         LA    R6,TWELVE(R3)      GET ADDRESS OF BYTE IN BUFFER  S22024 61020000
*                                  TO HAVE NEXT INSERTED BYTE    S22024 61080000
EX370550 EQU   *                                                 S22024 61140000
         TM    CCWFLAG,DC         IS CCW DATA CHAINED?           S22024 61200000
         BNO   EX370570           NO, END OF WRITE DATA          S22024 61260000
         LA    R5,EIGHT(R5)       GET ADDRESS OF NEXT CCW        S22024 61320000
         CLI   CCWCMD,TIC         IS IT A TIC CCW?               S22024 61380000
         BE    EX370555           YES , PROCESS NEXT CCW       @Y17XAUU 61440000
         L     R7,CCWADDR-ONE     GET ADDRESS OF NEXT CCW      @Y17XAUU 61450000
         LH    R9,CCWCOUNT        GET DATA BYTE COUNT          @Y17XAUU 61460000
         B     EX370510           GO MOVE DATA                 @Y17XAUU 61470000
EX370555 EQU   *                                               @Y17XAUU 61480000
         L     R5,CCWADDR-ONE     YES,GET ADDRESS OF NEXT CCW    S22024 61500000
         L     R7,CCWADDR-ONE     GET CCW ADDRESSS             @Y17XAUU 61520000
         LH    R9,CCWCOUNT        GET DATA BYTE COUNT          @Y17XAUU 61540000
         B     EX370510           GO MOVE DATA                   S22024 61560000
EX370560 EQU   *                                                 S22024 61620000
         BCTR  R8,ZERO            DECREMENT UNIT COUNT BY ONE    S22024 61680000
         EX    R8,MOVE            GO MOVE DATA INTO BUFFER       S22024 61740000
         LA    R8,ONE(R8)         RESTORE BYTE COUNT             S22024 61800000
         SR    R9,R8              GET NUMBER OF BYTES LEFT TO    S22024 61860000
*                                  BE MOVED                      S22024 61920000
         L     R3,EIGHT(R3)       GET ADDRESS OF NEXT UNIT       S22024 61980000
         LA    R6,TWELVE(R3)      GET ADDRESS OF BYTE IN BUFFER  S22024 62040000
*                                  TO MOVE NEXT INSERTED BYTE    S22024 62100000
         LA    R7,ZERO(R8,R7)     GET STARTING ADDRESS OF NEXT   S22024 62160000
*                                  BYTE TO BE MOVED              S22024 62220000
         LH    R8,UNITSIZE        GET UNIT SIZE                  S22024 62280000
         CR    R8,R9              CAN REMAINING CCW COUNT FIT    S22024 62340000
*                                  INTO ONE BUFFER UNIT          S22024 62400000
         BL    EX370560           NO, GO MOVE DATA INTO UNIT     S22024 62460000
         B     EX370530           YES,GO MOVE DATA INTO BUFFER   S22024 62520000
         EJECT                                                          62580000
**************************************************************** S22024 62640000
*                                                              * S22024 62700000
*        THE FOLLOWING SECTION OF CODE POSTS THE BUFFER        * S22024 62760000
*        DIRECTLY TO THE SSCP MESSAGE HANDLER (OUTPUT SIDE) *  @Y17XAUQ 62820000
*        AFTER BUILDING THE PROPER PREFIX AND NEGATIVE      *  @Y17XAUQ 62880000
*        PREFIX TO THE BUFFER                               *  @Y17XAUQ 62940000
*                                                           *  @Y17XAUQ 63000000
*                                                              * S22024 63060000
**************************************************************** S22024 63120000
         SPACE 2                                                        63180000
EX370570 EQU   *                                                 S22024 63240000
         L     R3,ERBCHAIN-ONE    GET ADDRESS OF FIRST BUFFER    S22024 63300000
*                                  UNIT                          S22024 63360000
         USING IEDQPRF,R3         ESTABLISH ADDRESSABILITY TO  @Y17XAUQ 63420000
*                                 BUFFER PREFIX                @Y17XAUQ 63480000
         L     R5,TOTAVTPT        GET POINTER TO AVT           @Y17XAUQ 63540000
         USING IEDQAVTD,R5        ESTABLISH ADDRESSABILITY     @Y17XAUQ 63600000
         L     R5,AVTSAVTP        GET ADDR OF SAVT             @Y17XAUQ 63660000
         DROP  R5                 FREE REG                     @Y17XAUQ 63720000
         USING IEDNSVTD,R5        ESTAB ADDRABILITY TO SAVT    @Y17XAUQ 63780000
         LA    R8,SAVTSCPQ        GET SSCP OUTBOUND QUEUE      @Y17XAUN 63840000
         ST    R8,PRFQCBA-ONE     STORE IN UCA FOR LATER POST  @Y17XAUQ 63900000
         SR    R8,R8              CLEAR REG                    @Y17XAUQ 63960000
         LA    R1,REQELMNT        GET ADDR OF REQ ELEMENT FIELD@Y17XAUQ 64020000
         STCM  R1,7,PRFLINK       PUT ELEMENT ADDR IN LINK FELD@Y17XAUQ 64080000
         MVI   PRFPRI,PRIDESTQ    SET DESTINATION QUEUE PRTY   @Y17XAUQ 64140000
         MVC   PRFNBUNT,UNITUSED  SET # OF UNITS IN THIS BUF   @Y17XAUQ 64200000
         STCM  R8,7,PRFLCB        CLEAR POINTER TO LCB         @Y17XAUQ 64260000
         LH    R8,SAVTSCPT        USE SSCP TTCIN AS ORIGIN     @Y17XAUQ 64320000
         STH   R8,PRFSRCE         SOURCE NOW INDICATES SSCP    @Y17XAUQ 64380000
         LH    R8,BUFDATLN        GET SAVED OLLT/OLTT DATASIZE @Y17XAUQ 64440000
         STH   R8,PRFSIZE         STORE IT IN PREFIX           @Y17XAUQ 64500000
         XC    PRFISIZE,PRFISIZE  ZERO OUT # OF RESERVES       @Y17XAUQ 64560000
         NI    PRFSTAT1,PRFNLSTF  MARK BUFFER LAST AND         @Y17XAUQ 64620000
         NI    PRFSTAT1,PRFNHDRF  MARK BUFFER HEADER           @Y17XAUQ 64680000
         MVC   PRFDEST,TGDAFHAR   MOVE TARGET DAF INTO DEST    @Y17XAUQ 64740000
         NC    PRFDEST,SAVTSUBM   MASK OFF ALL BUT SUBAREA     @Y17XAUQ 64800000
*                                 USING SUBAREA MASK IN SAVT   @Y17XAUQ 64860000
         LH    R1,PRFDEST         LOAD NA OF NCP PS INTO REG   @Y17XAUQ 64920000
         L     R15,SAVTNAX        GET @ OF NA TO TTCIN CONVERS @Y17XAUQ 64980000
         BALR  R14,R15            GO CONVERT NA TO TTCIN       @Y17XAUQ 65040000
         LTR   R15,R15            IS CONVERT GOOD              @Y17XAUQ 65100000
         BZ    RSIDCHK0           NO EXIT                      @Y17XAUQ 65160000
         STH   R15,PRFDEST        PUT NCP PS DEST IN PREFIX    @YM08054 65220000
         MVI   PRFTIC,X08         MOVE TIC INTO LINK FIELD     @Y17XAUQ 65280000
         DROP  R5                 FREE REGISTER                @Y17XAUQ 65340000
         EJECT                                                 @Y17XAUQ 65400000
************************************************************** @Y17XAUQ 65460000
*                                                            * @Y17XAUQ 65520000
*        NOW WE WILL FILL IN THE NEGATIVE PREFIX             * @Y17XAUQ 65580000
*                                                            * @Y17XAUQ 65640000
************************************************************** @Y17XAUQ 65700000
         LA    R1,PRF1LEN         GET LENGTH OF NEG PREFIX     @Y17XAUQ 65760000
         DROP  R3                 FREE REG                     @Y17XAUQ 65820000
         SR    R3,R1              BUMP BACK OVER NEG PREFIX    @Y17XAUQ 65880000
         USING IEDPF1,R3          ESTAB ADDRESSABILITY         @Y17XAUQ 65940000
         MVC   PRF1RH,RHHOLDAR    MOVE RH INTO NEG PREFIX      @Y17XAUQ 66000000
         XC    PRF1FLG1,PRF1FLG1  CLEAR OUT FLAG               @Y17XAUQ 66060000
         OI    PRF1FLG1,PRF1FIDI  SET FID1 INDICATION          @Y17XAUQ 66120000
         OI    PRF1FLG1,PRF1PTRI  TELL HIM SEQ# POINTER        @Y17XAUQ 66180000
*                                 FIELD IS PRESENT             @Y17XAUQ 66240000
         OI    PRF1RH+1,DEFSPON   SET DEFINITE RESPONSE        @Y17XAUU 66260000
         NI    PRF1RH+1,XFF-X'10'                                       66280000
         OI    PRF1RH,FORMAT      SET FORMAT INDICATOR         @ZM47554 66290010
         CLI   PRISECS#,PRISEQ#   WORKING WITH PRIMARY DEVICE  @Y17XAUQ 66300000
         BNE   SETSEQSC           NO GET SET FOR SECONDARY SEQ @Y17XAUQ 66360000
         LA    R8,TOTPRSN         GET PRI SEQ# SAVE AREA       @ZM47554 66420010
         B     SETSEQ             CONTINUE                     @Y17XAUQ 66480000
SETSEQSC LA    R8,TOTSCSN         GET SEC SEQ# SAVE AREA       @ZM47554 66540010
SETSEQ   DS    0H                 ESTAB BRANCH POINT           @Y17XAUQ 66600000
         ST    R8,PRF1SEQP        TELL HIM WHERE TO PUT SEQ#   @Y17XAUQ 66660000
POST     EQU   *                                                 S22024 66720000
         MVI   REQPRI,REQPRIE3    MOVE PRIORITY INTO ELEMENT   @Y17XAUQ 66780000
         LA    R0,TOTWAWRK        GET ADDR IF 'QWA WORK AREA   @Y17XAUQ 66840000
         L     R1,ERBCHAIN-ONE    PUT ADDR OF BUFFER IN REG    @Y17XAUQ 66900000
         ICM   R1,8,REQKEY        SET PROPER KEY               @Y17XAUQ 66960000
         LA    R10,DUMQCB-DUMMYLCB GET DISP OF THE QCB         @Y17XAUN 67020000
         AR    R10,R0             POINT TO QCB ADDR IN WORK    @Y17XAUN 67080000
*                                 AREA                         @Y17XAUN 67140000
         ST    R10,REQQCB         PUT QCB ADDRESS IN WORKAREA  @Y17XAUN 67200000
         L     R5,TOTRESPL        GET ADDR OF TOTES PARM LIST  @Y17XAUQ 67260000
         USING RESPL,R5           ESTABLISH ADDRESSABILITY     @Y17XAUQ 67320000
         L     R15,RESPLRVT       GET ADDR OF TOTE'S POST/WAIT @Y17XAUQ 67380000
         LR    R5,R4              COPY MODULE BASE REG         @XM05825 67400010
         L     R4,TOTAVTPT        GET TCAM AVT ADDRESS         @XM05825 67420010
         BALR  R14,R15            GO TO IEDQWA POST WAIT ROUTIN@Y17XAUQ 67440000
         LR    R4,R5              RESTORE BASE REG             @XM05825 67470010
         DROP  R5                 FREE REGISTER                @Y17XAUQ 67500000
*                                                              @Y17XAUQ 67560000
GOODRET  EQU   *                                                 S99528 67620000
         LA    R15,ZERO           SET GOOD RETURN CODE           S99528 67680000
         EJECT                                                          67740000
*********************************************************************** 67800000
*                                                                     * 67860000
*        EXIT ROUTINE                                                 * 67920000
*                                                                     * 67980000
*********************************************************************** 68040000
         SPACE 2                                                        68100000
EXIT     EQU   *                                                 S99528 68160000
         STC   R15,TOTRTCOD       PUT RETURN CODE INTO OLTCB     S99528 68220000
         TM    $OLTFLGS,$TRACE    WAS TRACE FUNCTION SPECIFIED?  S99528 68280000
         BO    TRACE              YES, GO TO IEDQWM2             S99528 68340000
         TM    $RETMASK,XFF       ANY RETURN CODES SET?                 68400000
         BZ    NOTRACE            NORMAL EXIT                    S99528 68460000
         CLI   TOTRTCOD,ZERO      IS RETURN CODE ZERO?           S99528 68520000
         BNE   TRACE              NO, GO TO IEDQWM2              S99528 68580000
NOTRACE  EQU   *                                                 S99528 68640000
         L     R13,FOUR(R13)      GET CALLER'S SAVE ADDRESS      S99528 68700000
         L     R14,TWELVE(R13)    GET RETURN ADDRESS             S99528 68760000
         LM    R0,R12,TWENTY(R13) RESTORE CALLERS REGISTERS      S99528 68820000
         BR    R14                RETURN TO CALLER               S99528 68880000
TRACE    L     R13,FOUR(R13)      GET CALLER'S SAVE ADDRESS      S99528 68940000
         L     R14,TWELVE(R13)    GET HIS RETURN ADDRESS         S99528 69000000
         USING RESPL,R5          SETUP ADDRESSABILITY TO RESPL @Y17XAUQ 69060000
         L     R5,TOTRESPL        LOAD ADDR OF RESPL           @Y17XAUQ 69120000
         L     R15,RESPLM2        GET ADDR OF IEDQWM2          @Y17XAUQ 69180000
         LM    R2,R12,DISREG2(R13)                                      69240000
         BR    R15                GO TO IEDQWM2                @Y17XAUQ 69300000
         DROP  R5                                              @Y17XAUQ 69360000
         EJECT                                                          69420000
**************************************************************** S22024 69480000
*                                                              * S22024 69540000
*        VERIFY THAT THE DAF OF THE TEST DEVICE IMBEDDED IN *  @Y17XAUQ 69600000
*        THE RU IS FOR EITHER THE PRIMARY OR SECONDARY TEST *  @Y17XAUQ 69660000
*        DEVICE.  ALSO INSURE THAT THE RU IS MARKED NETWORK *  @Y17XAUQ 69720000
*        SERVICES AND MAINTENANCE SERVICES.  IF EITHER IS   *  @Y17XAUQ 69780000
*        NOT TRUE ISSUE MESSAGE TO CONTROL TERMINAL AND SET *  @Y17XAUQ 69840000
*        RETURN CODE = 8.                                   *  @Y17XAUQ 69900000
*                                                              * S22024 69960000
**************************************************************** S22024 70020000
         SPACE 2                                                        70080000
RSIDCHK  EQU   *                                                 S22024 70140000
         L     R6,OLTCCWA         GET VALIDIFIED CCW           @Y17XAUQ 70200000
         L     R6,ZERO(R6)        GET ADDRESS OF DATA          @Y17XAUQ 70260000
         USING OLLTFID1,R6        ESTAB ADDRABILITY            @Y17XAUQ 70320000
         CLI   OLLTPRFX,CD1NETS   IS THIS A VALID NET SERVICES @Y17XAUQ 70380000
         BNE   RSIDCHK0           NO TAKE ERROR EXIT           @Y17XAUQ 70440000
         CLI   OLLTPRFX+1,CD1MAINT IS IT MAINTENANCE SERVICES  @Y17XAUQ 70500000
         BNE   RSIDCHK0           NO TAKE ERROR EXIT           @Y17XAUQ 70560000
         CLI   OLLTREQ,CD1EX      IS IT EXECUTE TEST REQUEST   @Y17XAUQ 70620000
         BNE   RSIDCHK0           NO: PRINT ERROR AND EXIT     @Y17XAUQ 70680000
         CLC   OLLTTDEV,TOTPRSID  TARGET DAF = PRIMARY         @Y17XAUQ 70740000
         BE    RSIDCHKC           YES, CONTINUE                @Y17XAUQ 70800000
         CLC   OLLTTDEV,TOTSRSID  TARGET DAF = SECONDARY       @Y17XAUQ 70860000
         BE    RSIDCHKD           YES, CONTINUE                @Y17XAUQ 70920000
*                                 NEITHER PRI/SEC PRINT ERROR  @Y17XAUQ 70980000
         NI    TOTFLG05,XFF-TOTPRINT-TOTREPLY-TOTCECOM  TURN OFF S22024 71040000
*                                                         ACCESS S22024 71100000
*                                                         FLAGS  S22024 71160000
         OI    TOTFLG05,TOTCECOM  SET CECOM FLAG                 S22024 71220000
         MVI   TOTOTCNT,ERRORMSG  GET LENGTH OF ERROR MESSAGE    S22024 71280000
         MVC   TOTOTBUF(ERRORMSG),EXIOER  MOVE ERROR MSG INTO    S22024 71340000
*                                           OUTPUT BUFFER        S22024 71400000
         USING RESPL,R5          ESTAB ADDRESSABILITY TO RESPL @Y17XAUQ 71460000
RSIDCHK1 L     R5,TOTRESPL        LOAD ADDR OF RESPL           @Y17XAUQ 71520000
         L     R15,RESPLWO        GET ADDR OF IEDQWO           @Y17XAUQ 71580000
         BALR  R14,R15            GO TO IEDQWO                 @Y17XAUQ 71640000
         DROP  R5                 FREE ADDR'Y REG              @Y17XAUQ 71700000
*                                                              @Y17XAUQ 71760000
         LA    R15,EIGHT          SET RETURN CODE INDICATING     S22024 71820000
*                                   DEVICE NOT PRIMARY OR        S22024 71880000
*                                   SECONDARY                    S22024 71940000
         B     EXIT               GO TO EXIT ROUTINE           @Y17XAUN 72000000
         EJECT                                                          72060000
*                                                              @Y17XAUQ 72120000
RSIDCHK0 DS    0H                 ESTABLISH BRANCH POINT       @Y17XAUQ 72180000
         NI    TOTFLG05,XFF-TOTPRINT-TOTREPLY-TOTCECOM         @Y17XAUQ 72240000
*                                 TURN OFF ACCESS FLAGS        @Y17XAUQ 72300000
         OI    TOTFLG05,TOTCECOM  SET CECOM FLAG               @Y17XAUQ 72360000
         MVI   TOTOTCNT,ERRMSG2   GET LENGTH OF ERROR MSG      @Y17XAUQ 72420000
         MVC   TOTOTBUF(ERRMSG2),EXIOER2 MOVE ERR MSG TO BUFFR @Y17XAUQ 72480000
         B     RSIDCHK1           GO PRINT MSG                 @Y17XAUQ 72540000
RSIDCHKC DS    0H                 ESTAB BRANCH POINT           @Y17XAUQ 72600000
         MVI   PRISECS#,PRISEQ#   INDICATE PRI SEQ# TO BE SAVE @Y17XAUQ 72660000
         B     RSIDCHK2           CONTINUE                     @Y17XAUQ 72720000
RSIDCHKD DS    0H                 ESTAB BRANCH POINT           @Y17XAUQ 72780000
         MVI   PRISECS#,SECSEQ#   INDICATE SEC SEQ# TO BE SAVE @Y17XAUQ 72840000
RSIDCHK2 DS    0H                 ESTABLISH BRANCH POINT       @Y17XAUQ 72900000
         MVC   RHHOLDAR,OLLTRHF1  MOVE OLLT/OLTT RH TO SAVAREA @Y17XAUQ 72960000
         MVC   TGDAFHAR,OLLTTDEV  PLACE TARGET IN HOLD AREA    @Y17XAUQ 73020000
         TM    $TOTFLG1,$CTEQTT   IS CT ON SAME LINE AS TSTDEV @Y17XAUQ 73080000
         BZ    RSIDCHK3           NO - CHECK AP                @YM08136 73088000
         CLC   TOTCRTNT+ONE(THREE),OLTRLTNT+ONE CONTROL        @YM08136 73096000
*                                 TERMINAL EQU TEST DEVICE     @YM08136 73104000
         BNE   RSIDCHK3           NO - CHECK AP                @YM08136 73112000
         MVC   OLTTCOFF(TWO),TOTCTOFF SET UP DUMMY TTCIN       @YM08136 73120000
         B     RSIDCHK4           CHECK FOR TEST START         @YM08136 73128000
RSIDCHK3 TM    TOTFLG01,TOTAPTST  IS AP ON SAME LINE AS TSTDEV @Y17XAUQ 73200000
         BZR   R8                 NO - CONTINUE                @YM08136 73208000
         CLC   TOTARTNT+ONE(THREE),OLTRLTNT+ONE ALTERNATE      @YM08136 73216000
*                                 PRINTER EQU TEST DEVICE      @YM08136 73224000
         BNER  R8                 NO - CONTINUE                @YM08136 73232000
         MVC   OLTTCOFF(TWO),TOTAPOFF SET UP DUMMY TTCIN       @YM08136 73240000
         B     RSIDCHK8           CHECK FOR START OF TEST      @YM08136 73248000
*                                                              @Y17XAUQ 73380000
RSIDCHK4 DS    0H                 ESTAB BRANCH POINT           @Y17XAUQ 73440000
         USING OLLTFID1,R6        ESTAB ADDRESSABILITY         @Y17XAUQ 73500000
         TM    OLLTCMOD,CD0TC     IS CONTACT ON IN MODIFIER    @Y17XAUN 73560000
         BO    RSIDCHK7           YES,SET INTEST SESSION:OLTCB @Y17XAUQ 73620000
RSIDCHK5 TM    OLLTCMOD,CD0TD     IS DISCONNECT ON IN MODIFIER @Y17XAUN 73680000
         BO    RSIDCHK6           YES, SET TEST SESS PENDG END @Y17XAUQ 73740000
         DROP  R6                 FREE REG                     @Y17XAUQ 73800000
         B     RSIDCHK3           CONTINUE                     @Y17XAUQ 73860000
*                                                              @Y17XAUQ 73920000
RSIDCHK7 DS    0H                 ESTAB BRANCH POINT           @Y17XAUQ 73980000
         OI    TOTFLG02,TOTTSST   TURN ON TEST SESSION STARTED @Y17XAUQ 74040000
         MVI   TOTOVBCD,HOLD      SET HOLD VERB CODE           @YM08136 74050000
         BAL   R14,OPCTL          HOLD CT QUEUE                @YM08136 74060000
         MVI   TOTOVBCD,INACT     SET INACT VERB CODE          @YM08136 74070000
         BAL   R14,OPCTL          INACTIVATE TEST DEVICE       @YM08136 74080000
         B     RSIDCHK5           CONTINUE                     @Y17XAUQ 74820000
*                                                              @Y17XAUQ 74880000
RSIDCHK6 DS    0H                 ESTABLISH BRANCH POINT       @Y17XAUQ 74940000
         OI    TOTFLG02,TOTTTSPE  SET TEST SESSION PENDING END @Y17XAUQ 75000000
         B     RSIDCHK3           CONTINUE                     @Y17XAUQ 75060000
*                                                              @Y17XAUQ 75120000
RSIDCHK8 DS    0H                 ESTABLISH BRANCH POINT       @Y17XAUQ 75180000
         L     R6,OLTCCWA         GET VALIDIFIED CCW           @Y17XAUQ 75240000
         L     R6,ZERO(R6)        GET ADDRESS OF DATA          @Y17XAUQ 75300000
         USING OLLTFID1,R6        ESTAB ADDRESSABILITY         @Y17XAUQ 75360000
         TM    OLLTCMD,CD0TC      IS CMD TEST WITH CONTACT     @Y17XAUQ 75420000
         BO    RSIDCHK9           YES, GO SET IN TEST SESS ON  @Y17XAUQ 75480000
RSIDCHKA TM    OLLTCMD,CD0TD      IS CMD TEST WITH DISCONTACT  @Y17XAUQ 75540000
         BO    RSIDCHKB           YES, SET TEST SESS PENDG END @Y17XAUQ 75600000
         DROP  R6                 FREE REG                     @Y17XAUQ 75660000
         B     ZERO(R8)           RETURN                       @Y17XAUQ 75720000
*                                                              @Y17XAUQ 75780000
RSIDCHK9 DS    0H                 ESTAB BRANCH POINT           @Y17XAUQ 75840000
         OI    TOTFLG02,TOTTSST   TURN ON TEST SESS STARTED    @Y17XAUQ 75900000
         MVI   TOTOVBCD,HOLD      SET HOLD VERB CODE           @YM08136 75910000
         BAL   R14,OPCTL          HOLD AP QUEUE                @YM08136 75920000
         MVI   TOTOVBCD,INACT     SET INACTIVATE VERB CODE     @YM08136 75930000
         BAL   R14,OPCTL          INACTIVATE TEST DEVICE       @YM08136 75940000
         B     RSIDCHKA           CONTINUE                     @Y17XAUQ 76680000
*                                                              @Y17XAUQ 76740000
RSIDCHKB DS    0H                 ESTAB BRANCH POINT           @Y17XAUQ 76800000
         OI    TOTFLG02,TOTTTSPE  SET TEST SESS PENDG END      @Y17XAUQ 76860000
         B     ZERO(R8)           RETURN                       @Y17XAUQ 76920000
*                                                              @Y17XAUQ 76980000
         EJECT                                                          76981000
*                                                              @YM08136 76982000
*        ROUTINE TO INACTIVATE 3705 TERMINAL(DUMMY ENTRY)      @YM08136 76983000
*        RETURN TO CALLER VIA REGISTER 14                      @YM08136 76984000
*                                                              @YM08136 76985000
OPCTL    EQU   *                                               @YM08136 76986000
         L     R6,TOTAVTPT        GET ADDRESS OF AVT           @YM08136 76987000
         USING IEDQAVTD,R6                                     @YM08136 76988000
         LA    R10,AVTOPCOB        GET POINTER TO OP CNTRL QCB @YM08136 76989000
         ST    R10,TOTOKEY        PUT IN PARAMETER LIST        @YM08136 76990000
         MVI   TOTOKEY,OPCKEY     ZERO OUT KEY FIELD           @YM08136 76991000
         DROP  R6                                              @YM08136 76992000
         MVI   TOTOLADR,X40       BLANK OUT NAME               @YM08136 76993000
         MVC   TOTOLADR+ONE(SEVEN),TOTOLADR FIELD              @YM08136 76994000
         L     R6,OLTRLTNT        GET TD TNT ADDRESS           @YM08136 76995000
         SLR   R1,R1              CLEAR REG                    @YM08136 76996000
         IC    R1,TOTTTBEL        GET TD NAME LENGTH           @YM08136 76997000
         BCTR  R1,0               DECREMENT COUNT FOR EX       @YM08136 76998000
         EX    R1,MOVENAM         MOVE NAME TO PLIST           @YM08136 76999000
         MVC   TOTORLN,OLTTCRLN   MOVE IN RELATIVE LINE NUMBER @YM08136 77000000
         LA    R1,TOTOTECB         GET TOTE ECB                @YM08136 77001000
         ST    R1,TOTOECBA        PUT IN PARAMETER LIST        @YM08136 77002000
         OI    TOTOFLG,TOTOATC    SET C. TTCIN FLAG            @YM08136 77003000
         MVC   TOTOALTT(TWO),OLTTCOFF SET C. TTCIN IN ELEMENT  @YM08136 77004000
         XC    TOTOLINK(THREE),TOTOLINK  CLEAR REQUEST ELEMENT @YM08136 77005000
*                                          LINK FIELD          @YM08136 77006000
         MVI   TOTOPRI,OPCPRI     SET OP CONTROL PRIORITY TO DC@YM08136 77007000
         MVI   TOTORTCD,OPCRTCD   CLEAR RETURN CODE FIELD      @YM08136 77008000
         MVI   TOTOELNG,OPCELNG   SET ELEMENT LENGTH TO X'18'  @YM08136 77009000
         LA    R1,TOTPLIST        GET ADDRESS OF OP CONTROL    @YM08136 77010000
*                                   PARAMETER LIST             @YM08136 77011000
         ST    R1,ELEM1           SAVE IT IN 1ST WORD OF POST  @YM08136 77012000
*                                   LIST                       @YM08136 77013000
         ST    R1,ELEM2           SAVE IT IN SECOND WORD OF    @YM08136 77014000
*                                   SVC 102 POST LIST          @YM08136 77015000
         MVI   ELEM1,CODE         SET SVC 102 START CODE       @YM08136 77016000
         MVI   ELEM2,ENDLIST      SET SVC 102 END CODE         @YM08136 77017000
         LA    R1,SLPL            POINT R1 TO PARAMETER LIST   @YM08136 77018000
         XC    TOTOTECB(FOUR),TOTOTECB CLEAR TOTE ECB          @YM08136 77019000
         AQCTL                     POST ELEMENT TO OPERATOR CNTL@YM0813 77020000
*                                                              @YM08136 77021000
         WAIT  ECB=TOTOTECB                                    @YM08136 77022000
*                                                              @YM08136 77023000
         BR    R14                RETURN TO CALLER             @YM08136 77024000
         EJECT                                                 @Y17XAUQ 77040000
COMPARE  CLC   ZERO(ZERO,R5),TWELVE(R6)      COMPARE TERM NAME @Y17XAUQ 77100000
*                                        ENTRY WITH CDS FIELD    S99528 77160000
PATCH    DC    CL100' '           MAINTENANCE PATCH AREA         S99528 77220000
         EJECT                                                   S99528 77280000
         DS    0D                 ALIGN CCW ON DOUBLE WORD BOUNDARY     77340000
QCBCPA   EQU   *                  CHANNEL PGM AREA IN LCB      @Y17XAUQ 77400000
         CCW   X'2F',*,X'60',1    CHANNEL COMMAND WORD                  77460000
         DC    2D'0'              SIXTEEN BYTES OF ZEROES               77520000
         SPACE 4                                                        77580000
SADCODE  DC    X'13'              SAD 0                                 77640000
         DC    X'17'              SAD 1                                 77700000
         DC    X'1B'              SAD 2                                 77760000
         DC    X'1F'              SAD 3                                 77820000
NOP      DC    X'20000001'        NO-OP COMMAND FOR CCW                 77880000
ANDMASK  DC    F'3'               USED TO CLEAR FLAG BYTE               77940000
OPTIONS  DC    H'20'              DISPLACEMENT IF OPTIONS        S99528 78000000
NOOPT    DC    H'17'              DISPLACEMENT IF NO OPTIONS     S99528 78060000
SILI     DC    X'20'              SLI BIT SETTING                S99528 78120000
ENABLE   DC    X'27'              ENABLE COMMAND                 S99528 78180000
SETMODE  DC    X'23'              SET MODE COMMAND               S99528 78240000
ONEMORE  DC    H'01'              CONSTANT 1                     S22024 78300000
EIGHTLN  DC    H'08'              CONSTANT 8                     S22024 78360000
MOVE     MVC   ZERO(ZERO,R6),ZERO(R7)   MOVE DATA FROM CCW TO    S22024 78420000
*                                        BUFFER                  S22024 78480000
MOVENAM  MVC   TOTOLADR(EIGHT),ZERO(R6) MOVE NAME TO PLIST     @YM08136 78510000
ZEROLAST DC    X'00000000'        ZERO TIC FIELD                 S22024 78540000
LASTUNIT DC    X'08000002'        TIC FIELD FOR LAST BUFFER UNIT S22024 78600000
ZEROADDR DC    A(0)               ZERO ADDRESS FOR A COMPARE   @Y17XAUQ 78660000
REQKEY   DC    X'E0'              REQUEST KEY FOR POST/WAIT    @Y17XAUQ 78720000
*                                 ROUTINE IN IEDQWA            @Y17XAUQ 78780000
MSGSTART EQU   *                  START OF ERROR MESSAGE         S22024 78840000
EXIOER   DC    C'IED258I OLT ATTEMPTED I/O TO RSID NOT UNDER TEST - I/O*78900000
                NOT PERFORMED'    EXIO ERROR MESSAGE             S22024 78960000
MSGEND   EQU   *                  END OF ERROR MESSAGE           S22024 79020000
ERRORMSG EQU   MSGEND-MSGSTART    LENGTH OF ERROR MESSAGE        S22024 79080000
         EJECT                                                          79140000
VALIDTST DC    X'010301'          1ST 3 BYTES OF A VALID       @Y17XAUQ 79200000
*                                 NET SVCS / MAINT SVCS        @Y17XAUQ 79260000
*                                 EXECUTE TEXT COMMAND         @Y17XAUQ 79320000
MSG2STRT EQU   *                                               @Y17XAUQ 79380000
EXIOER2  DC    C'IED574I OLT ATTEMPTED I/O WITH INVALID DATA'  @Y17XAUQ 79440000
MSG2END  EQU   *                                               @Y17XAUQ 79500000
ERRMSG2  EQU   MSG2END-MSG2STRT   LENGTH OF ERROR MSG          @Y17XAUQ 79560000
*                                                              @Y17XAUQ 79620000
         EJECT                                                 @Y17XAUQ 79680000
CCW      DSECT                    CHANNEL COMMAND WORD           S22024 79740000
CCWCMD   DS    C                  COMMAND CODE                   S22024 79800000
CCWADDR  DS    AL3                DATA ADDRESS                   S22024 79860000
CCWFLAG  DS    C                  CCW FLAGS                      S22024 79920000
         DS    C                  UNUSED                         S22024 79980000
CCWCOUNT DS    H                  BYTE COUNT                   @Y17XAUQ 80040000
         EJECT                                                          80100000
         TCD0D                                                 @Y17XAUQ 80160000
         EJECT                                                          80220000
         TCD1D                                                 @Y17XAUQ 80280000
         DSECT                                                 @Y17XAUQ 80340000
OLLTFID1 DS    0C                 ON LINE TEST FID1 DSECT      @Y17XAUQ 80400000
OLLTTHF1 DS    XL1                TRANS HEADER FLAG1           @Y17XAUQ 80460000
OLLTTHF2 DS    XL1                TRANS HEADER FLAG2           @Y17XAUQ 80520000
OLLTDAF  DS    XL2                DAF OF NCP PHYS SVCS         @Y17XAUQ 80580000
OLLTOAF  DS    XL2                OAF OF TCAM'S SSCP           @Y17XAUQ 80640000
OLLTSEQN DS    XL2                SEQ NUMBER                   @Y17XAUQ 80700000
OLLTDCF  DS    XL2                DATA COUNT FIELD             @Y17XAUQ 80760000
OLLTTHLG EQU   10                 OLLT TH LENGTH               @Y17XAUQ 80820000
*                                                              @Y17XAUQ 80880000
*                                                              @Y17XAUQ 80940000
*                                                              @Y17XAUQ 81000000
OLLTRHF1 DS    XL1                REQ HEADER FLAG1             @Y17XAUQ 81060000
OLLTRHF2 DS    XL1                REQ HEADER FLAG2             @Y17XAUQ 81120000
OLLTRHF3 DS    XL1                REQ HEADER FLAG3             @Y17XAUQ 81180000
OLLTRHLG EQU   3                  OLLT RH LENGTH               @Y17XAUQ 81240000
*                                                              @Y17XAUQ 81300000
*                                                              @Y17XAUQ 81360000
OLLTPRFX DS    XL2                PREFIX (NET SVCS+MAINT SVCS) @Y17XAUQ 81420000
OLLTREQ  DS    XL1                REQ TYPE EXEC TST/RCD STATS  @Y17XAUQ 81480000
OLLTTDEV DS    XL2                DAF OF TEST DEVICE           @Y17XAUQ 81540000
OLLTCMD  DS    XL1                COMMAND                      @Y17XAUQ 81600000
OLLTCMOD DS    XL1                COMMAND MODIFIER             @Y17XAUQ 81660000
OLLTSYSR DS    XL1                SYSTEM RESPONSE              @Y17XAUQ 81720000
OLLTERSP DS    XL2                EXTENDED RESPONSE            @Y17XAUQ 81780000
*                                                              @Y17XAUQ 81840000
         EJECT                                                 @Y17XAUQ 81900000
*                                                              @Y17XAUQ 81960000
         TPRFD                                                 @Y17XAUQ 82020000
RESPL    RESPL                                                 @Y17XAUQ 82080000
         EJECT                                                 @Y17XAUQ 82140000
         TPRIOR                                                @Y17XAUQ 82200000
         EJECT                                                          82260000
DUMMYLCB DSECT                    DUMMY LCB                      S22024 82320000
RCQCBLCB DS    F                  ADDRESS OF THE QCB TO WHICH    S22024 82380000
*                                  REQUESTED BUFFERS ARE TO BE   S22024 82440000
*                                  POSTED                        S22024 82500000
PARMLIST DS    0F                 PARAMETER LIST FOR SVC 102     S22024 82560000
ACTCODE  DS    C                  ACTION CODE                    S22024 82620000
ELPT1    DS    AL3                ELEMENT POINTER                S22024 82680000
LASTWD   DS    C                  BYTE INDICATING LAST WORD IN   S22024 82740000
*                                  LIST                          S22024 82800000
ELPT2    DS    AL3                ELEMENT POINTER                S22024 82860000
         DS    2C                 UNUSED                         S22024 82920000
STAT1LCB DS    C                  FIRST STATUS BYTE- ALWAYS 0    S22024 82980000
STAT2LCB DS    C                  SECOND STATUS BYTE - ALWAYS 0  S22024 83040000
         DS    4C                 UNUSED                         S22024 83100000
ERBLCB   DS    0F                 START OF ERB                   S22024 83160000
ERBKEY   DS    C                  KEY FIELD - UNUSED             S22024 83220000
ERBQCB   DS    AL3                ADDRESS OF'BUFFER REQUEST' QCB S22024 83280000
ERBPRI   DS    C                  ERB PRIORITY                   S22024 83340000
ERBLINK  DS    AL3                ADDRESS OF NEXT ITEM IN THE    S22024 83400000
*                                  CHAIN IN WHICH THIS ERB       S22024 83460000
*                                  RESIDES- ALWAYS ZERO          S22024 83520000
ERBSTAT  DS    C                  STATUS BYTE                    S22024 83580000
ERBCHAIN DS    AL3                ADDRESS OF CHAIN TO BE ASSIGNEDS22024 83640000
*                                 BUFFERS-ON RETURN FROM BUFFER  S22024 83700000
*                                 REQUEST,CONTAINS ADDRESS OF    S22024 83760000
*                                 REQUESTED BUFFER               S22024 83820000
ERBCNT1  DS    C                  NUMBER OF BUFFERS REQUESTED -  S22024 83880000
*                                  ALWAYS 1                      S22024 83940000
ERBCNT2  DS    C                  NUMBER OF UNITS NEEDED IN THE  S22024 84000000
*                                  REQUESTED BUFFER              S22024 84060000
         DS    3C                 UNUSED                         S22024 84120000
SCBALCB  DS    AL3                ADDRESS OF SCB                 S22024 84180000
DUMQCB   DS    0F                 DUMMY QCB TO WHICH EMPTY BUFFERS22024 84240000
*                                  IS POSTED                     S22024 84300000
QCB0SFLG DS    C                  FLAG BYTE- ALWAYS X'02' WHICH  S22024 84360000
*                                  INDICATES A QCB               S22024 84420000
ELCHNQCB DS    AL3                ELEMENT CHAIN POINTER          S22024 84480000
ECBO     DS    F                  THE ECB ON WHICH IEDQWN WAITS  S22024 84540000
*                                  AFTER REQUESTING A BUFFER     S22024 84600000
QCBPTR   DS    AL4                POINTER BACK TO FIRST WORD OF  S22024 84660000
*                                  DUMMY QCB                     S22024 84720000
SCB      DS    0F                 STATION CONTROL BLOCK          S22024 84780000
STATESCB DS    C                  STATUS BYTE - ALWAYS ZERO      S22024 84840000
DESTQSCB DS    AL3                ADDRESS OF DESTINATION QCB     S22024 84900000
         DS    48C                REMAINDER OF SCB               S22024 84960000
         EJECT                                                          85020000
UCB      DSECT                                                   S99528 85080000
         IEFUCBOB                                                S99528 85140000
         EJECT                                                          85200000
         TAVTD                                                   S99528 85260000
         EJECT                                                          85320000
         TTRMD                                                   S99528 85380000
         EJECT                                                          85440000
         TQCBD                                                 @Y17XAUQ 85500000
         EJECT                                                          85560000
         OLTCB                                                          85620000
************************************************************** @Y17XAUQ 85680000
*                                                            * @Y17XAUQ 85740000
*        PARAMETER LIST FOR SVC 102                          * @Y17XAUQ 85800000
*                                                            * @Y17XAUQ 85860000
************************************************************** @Y17XAUQ 85920000
*                                                              @Y17XAUQ 85980000
SLPL     DS    0F                 ALIGN ON FULLWORD            @Y17XAUQ 86040000
ELEM1    DS    F                  POINTER TO FIRST ELEMENT     @Y17XAUQ 86100000
ELEM2    DS    F                  POINTER TO SECOND ELEMENT    @Y17XAUQ 86160000
*                                                              @Y17XAUQ 86220000
*                                                              @Y17XAUQ 86280000
LCBSIOCC DS    AL4                ADDR OF CHANNEL PGM AREA     @Y17XAUQ 86340000
         DS    0D                 ALIGN ON DOUBLE WORD         @Y17XAUQ 86400000
LCBCPA   EQU   *                  CHANNEL PGM AREA START       @Y17XAUQ 86460000
         DS    CL8                CHANNEL COMMAND WORD         @Y17XAUQ 86520000
         DS    CL8                EIGHT BYTES OF ZEROS         @Y17XAUQ 86580000
         DS    CL8                EIGHT BYTES OF ZEROS         @Y17XAUQ 86640000
*                                                              @Y17XAUQ 86700000
TRMSLPL  DS    0F                 PARAMETER LIST FOR HOLD      @Y17XAUQ 86760000
TRMSSLST DS    XL1                START OF LIST INDICATOR      @Y17XAUQ 86820000
TRMSREL1 DS    AL3                ADDR OF REQ ELEMENT          @Y17XAUQ 86880000
TRMSELST DS    XL1                END OF LIST INDICATOR        @Y17XAUQ 86940000
TRMSREL2 DS    AL3                ADDR OF REQ ELEMENT          @Y17XAUQ 87000000
         EJECT                                                 @Y17XAUQ 87060000
************************************************************** @Y17XAUQ 87120000
*                                                            * @Y17XAUQ 87180000
*        REQUEST ELEMENT LIST TO USE IEDQWA'S POST/WAIT      * @Y17XAUQ 87240000
*                                                            * @Y17XAUQ 87300000
************************************************************** @Y17XAUQ 87360000
REQELMNT DS    0F                 ADDR OF REQ ELEMENT          @Y17XAUQ 87420000
REQQCB   DS    F                  QCB ADDRESS                  @Y17XAUQ 87480000
REQPRI   DS    C                  PRIORITY OF REQ ELEMENT      @Y17XAUQ 87540000
REQPRIE3 EQU   X'E3'              PRIORITY FOR POST/WAIT@Y17XAUQ        87600000
REQLINK  DS    AL3                LINK FIELD                   @Y17XAUQ 87660000
         EJECT                                                          87720000
TNTENTRY DS    A                  ADDR OF TERMINAL ENTRY       @Y17XAUQ 87780000
DIALADDR DS    F                  POINTER TO DIAL DIGITS       @Y17XAUQ 87840000
ALINETTE DS    A                  ALIGNED TTE ADDR             @Y17XAUQ 87900000
*                                                              @Y17XAUQ 87960000
LCBADDR  DS    F                  ADDR OF 3705 LCB             @Y17XAUQ 88020000
*                                                              @Y17XAUQ 88080000
PRFXSIZE DS    H                  SIZE OF PREFIX               @Y17XAUQ 88140000
UNITSIZE DS    H                  UNIT SIZE                    @Y17XAUQ 88200000
UCBAREA  DS    H                  UCB UNIT NAME                @Y17XAUQ 88260000
SWITCH   DS    XL1                SWITCH BYTE                  @Y17XAUQ 88320000
PRISECS# DS    XL1                INDICATES PRI/SEC            @Y17XAUQ 88380000
PRISEQ#  EQU   X'80'              TEST DEV                     @Y17XAUQ 88440000
SECSEQ#  EQU   X'40'              SEQ NO                       @Y17XAUQ 88500000
UNITUSED DS    XL1                # OF UNITS IN BUFFER         @Y17XAUQ 88560000
BUFDATLN DS    H                  SAVE AREA FOR OLLT/OLTT      @Y17XAUQ 88620000
*                                 DATA COUNT MINUS RH LENGTH   @Y17XAUQ 88680000
*                                 TO BE PUT IN BUFFER PREFIX   @Y17XAUQ 88740000
TGDAFHAR DS    XL2                TARGET DAF HOLD AREA         @Y17XAUQ 88800000
RHHOLDAR DS    XL3                RH HOLD AREA                 @Y17XAUQ 88860000
         EJECT                                                          88920000
         IOBLOCKS                                                       88980000
         EJECT                                                          89040000
         TTECB                                                          89100000
         EJECT                                                          89160000
EXIOLIST DSECT                                                          89220000
XIOTRMG  DS    XL1                CONTROL PROGRAM FLAGS          S99528 89280000
XIOLEVEL DS    XL1                MACRO LEVEL                    S99528 89340000
XIOIDNT  DS    XL2                MACRO IDENTIFICATION           S99528 89400000
XIOTECBA DS    A                  ADDRESS OF TECB                S99528 89460000
XIOCDSA  DS    A                  ADDRESS OF CDS                 S99528 89520000
XIOCCWA  DS    A                  ADDRESS OF CCW                 S99528 89580000
XIOCCWC  DS    XL1                NUMBER OF CCW'S                S99528 89640000
XIOFLAG  DS    XL1                FLAG BYTE                      S99528 89700000
         END                                                            89760000
