QWP      TITLE 'IEDQWP - TOTE DPRINT MODULE (1 OF 3)'                   00080022
IEDQWP   CSECT                                                          00160022
*A000000-999999                                                @Y16X5U0 00165010
* CHANGE ACTIVITY AS FOLLOWS:                                    S22024 00180000
*A077600,094100,130200                                          SA41596 00200000
*A079600,103290,328000,416810,478100,520000                    @Y17XAUU 00210010
*C487000-4885000                                               @Y17XAUU 00220010
IEDQW39  EQU   *                                                 S99528 00240022
         ENTRY IEDQW39                                                  00320022
         USING IEDQWP,R15                                               00400022
         SPACE                                                          00480022
IEDQWP   IEDHJN STARP,HJN         MODULE ID                      S99528 00560022
         SPACE 4                                                        00640022
**************************************************************** S99528 00720022
*                                                                       00816000
* MODULE NAME = IEDQWP (TCAM,TOTE)                             @Y17XAUU 00824010
*                                                              * S22024 00832000
* DESCRIPTIVE NAME = TOTE DPRINT MODULE 1                      * S22024 00840000
*                                                              * S22024 00848000
* COPYRIGHT = NONE                                             * S22024 00856000
*                                                              * S22024 00864000
* STATUS --                                                    * S99528 00880022
*    VERSION 10.0                                              @Y17XAUU 00960010
*                                                              * S99528 01040022
* FUNCTIONS --                                                 * S99528 01120022
*    THE PURPOSE OF THIS ROUTINE IS TO SERVICE THE DPRINT MACRO* S99528 01200022
*    BY FORMATTING THE OUTPUT MESSAGES.                        @Y17XAUU 01220010
*                                                              * S99528 01360022
*    THE CALLING ROUTINE'S DPRINT PARAMETER LIST IS EXAMINED.  * S99528 01440022
*    IF A HEADER ANDOR DESCRIPTION LINES ARE REQUIRED, THE     * S99528 01520022
*    LINES ARE FORMATTED ONE AT A TIME AND IEDQWO (ACCESS      * S99528 01600022
*    MANAGER) IS CALLED TO ROUTE THE FORMATTED LINES TO THE    * S99528 01680022
*    PROPER OUTPUT DEVICE.                                     * S99528 01760022
*                                                              * S99528 01840022
*    IF RESULTS ARE REQUIRED, THE CAW, CCW, AND CC LINES ARE   * S99528 01920022
*    FORMATTED AND PASSED TO IEDQWO. CONTROL IS THEN           * S99528 02000022
*    TRANSFERRED TO IEDQWP1 (DPRINT SERVICE MODULE 1) TO       * S99528 02080022
*    CONTINUE PROCESSING THE DPRINT MACRO.                     * S99528 02160022
*                                                              * S99528 02240022
*    IF NO RESULTS LINES ARE REQUIRED, THE COMMENT LINES ARE   * S99528 02320022
*    FORMATTED (IF REQUIRED) AND PASSED TO IEDQWO. CONTROL IS  * S99528 02400022
*    THEN RETURNED TO THE CALLING ROUTINE.                     * S99528 02480022
*                                                              * S99528 02560022
*    AT THE COMPLETION OF THIS ROUTINE REGISTER 15 WILL        * S99528 02640022
*    CONTAIN A RETURN CODE OF 0.                               * S99528 02720022
*                                                              * S99528 02800022
* ENTRY POINTS --                                              * S99528 02880022
*    IEDQWP - CALLED WHEN A DPRINT MACRO IS ISSUED BY THE OLT. * S99528 02960022
*                                                              @Y17XAUU 02960410
* PURPOSE -- SEE FUNCTION                                      @Y17XAUU 02960810
*                                                              @Y17XAUU 02961210
* LINKAGE -- BALR R14,R15 FROM IEDQWA                          @Y17XAUU 02961610
*                                                              @Y17XAUU 02962010
* MODULE TYPE -- PROCEDURE                                     @Y17XAUU 02962410
*                                                              @Y17XAUU 02962810
* MODULE SIZE -- 2K MAXIMUM                                    @Y17XAUU 02963210
*                                                              @Y17XAUU 02963610
* PROCESSOR -- ASSEMBLER                                       @Y17XAUU 02964010
*                                                              @Y17XAUU 02964410
* MACROS -- IEDHJN,SAVE                                        @Y17XAUU 02964810
*                                                              * S99528 03040022
* INPUT --                                                     * S99528 03120022
*    REGISTERS 01,02,03,13,14,15 CONTAIN THE FOLLOWING VALUES: * S99528 03200022
*                                                              * S99528 03280022
*    01 -DPRINT PARAMETER LIST ADDR                            * S99528 03360022
*    02 - OLTCB POINTER                                        * S99528 03440022
*    03 - SECTION PREFACE ADDRESS                              * S99528 03520022
*    13 - SAVE AREA ADDRESS                                    * S99528 03600022
*    14 - RETURN ADDRESS                                       * S99528 03680022
*    15 - ENTRY POINT ADDRESS                                  * S99528 03760022
*                                                              * S99528 03840022
* OUTPUT --                                                    * S99528 03920022
*    NONE                                                      * S99528 04000022
*                                                              * S99528 04080022
* EXTERNAL REFERENCES --                                       * S99528 04160022
*    IEDQWO - ACCESS MANAGER - TO ROUTE OUTPUT MESSAGE LINE    * S99528 04240022
*                                                              * S99528 04320022
* EXITS,NORMAL --                                              * S99528 04400022
*    BR   TO IEDQWP1 OR RETURN TO CALLER                       * S99528 04480010
*                                                              * S99528 04560022
* EXITS,ERROR --                                               * S99528 04640022
*    NONE                                                      * S99528 04720022
*                                                              * S99528 04800022
* TABLES/WORK AREAS --                                         * S99528 04880022
*    OLTCB, SECTION PREFACE                                    * S99528 04960022
*                                                              * S99528 05040022
* ATTRIBUTES --                                                * S99528 05120022
*    ENABLED,PROBLEM PROGRAM MODE, RESIDENT, REENTRANT         @Y17XAUU 05200010
*                                                              * S99528 05280022
* NOTES -- SEE BELOW                                           @Y17XAUU 05360010
*                                                              @Y17XAUU 05361010
*  DEPENDENCIES --                                             @Y17XAUU 05362010
*                                                              @Y17XAUU 05363010
*    EBCDIC CHARACTER CODE                                     @Y17XAUU 05364010
*                                                              @Y17XAUU 05365010
*    MAX NO. OF BYTES IN A DESCRIPTION LINE OR COMMENT         * S99528 05440022
*    LINE(MSGE) IS 80. LINES OF GREATER LENGTH ARE TRUNCATED.  * S99528 05520022
*                                                              * S99528 05600022
*    MAX NO. OF SENSE BYTES IS 20. IFNO. OF BYTES IS           * S99528 05680022
*    GREATER, PRINT LINE IS TRUNCATED.                         * S99528 05760022
*                                                              @Y17XAUU 05761010
*  RESTRICTIONS -- NONE                                        @Y17XAUU 05762010
*                                                              @Y17XAUU 05763010
*  REGISTERS CONVENTION -- SEE REGISTERS ASSIGNMENT            @Y17XAUU 05764010
*                                                              @Y17XAUU 05765010
*  PATCH LABEL -- PATCH                                        @Y17XAUU 05766010
*                                                              * S99528 05840022
**************************************************************** S99528 05920022
         EJECT                                                 * S99528 06000022
*                                                              * S99528 06080022
*        EQUATES                                               * S99528 06160022
*                                                              * S99528 06240022
R0       EQU   0                  REG 0                        * S99528 06320022
R1       EQU   1                  REG 1                        * S99528 06400022
R2       EQU   2                  REG 2                        * S99528 06480022
R3       EQU   3                  REG 3                        * S99528 06560022
R4       EQU   4                  REG 4                        * S99528 06640022
R5       EQU   5                  REG 5                        * S99528 06720022
R6       EQU   6                  REG 6                        * S99528 06800022
R7       EQU   7                  REG 7                        * S99528 06880022
R8       EQU   8                  REG 8                        * S99528 06960022
R9       EQU   9                  REG 9                        * S99528 07040022
R10      EQU   10                 REG 10                       * S99528 07120022
R11      EQU   11                 REG 11                       * S99528 07200022
R12      EQU   12                 REG 12                       * S99528 07280022
R13      EQU   13                 REG 13                       * S99528 07360022
R14      EQU   14                 REG 14                       * S99528 07440022
R15      EQU   15                 R15                          * S99528 07520022
         SPACE                                                          07600022
BYPASS   EQU   X'80'              CC PRINTED FLAG                S99528 07680022
XC6      EQU   X'C6'              EBCDIC F                       S99528 07760022
D0       EQU   0                  DISP OF 0                      S22024 07770000
D1       EQU   1                  DISP OF 1                      S22024 07780000
D2       EQU   2                  DISP OF 2                      S22024 07790000
D8       EQU   8                  DISP OF 8                      S22024 07791010
D11      EQU   11                 DISP OF 11                     S22024 07792010
D27      EQU   27                 DISP OF 27                     S22024 07793010
D37      EQU   37                 DISP OF 37                     S22024 07794010
D44      EQU   44                 DISP OF 44                     S22024 07795010
D46      EQU   46                 DISP OF 46                     S22024 07796010
D4       EQU   4                  DISP OF 4                      S22024 07800000
D28      EQU   28                 DISP OF 28                     S22024 07810000
PDESC    EQU   X'80'              DESCRIPTION LINES PRESENT FLG  S22024 07820000
XFF      EQU   X'FF'              MASK ALL                       S22024 07830000
D3       EQU   3                  DISP OF 3                      S22024 07834000
D6       EQU   6                  DISPLACEMENT OF 6              S22024 07838000
D14      EQU   14                 DISP OF 14                     S22024 07842000
D17      EQU   17                 DISP OF 17                     S22024 07846000
D23      EQU   23                 DISP OF 23                     S22024 07850000
D33      EQU   33                 DISP OF 33                     S22024 07854000
D9       EQU   9                  DISP OF 9                     SA41596 07860000
DASH     EQU   X'60'              DASH CHAR                     SA41596 07960000
DISREG2  EQU   28                 DISPLACEMENT TO REG 2        @Y17XAUU 07990010
         EJECT                                                          08030010
         DROP  R15                                                      08200022
         USING IEDQWP,R4                                                08300022
         USING TOTOLTCB,R2                                              08400022
         USING SPREF1,R3          SECTION PREFACE DSECT PART 1          08460022
         USING SPREF2,R9          SECTION PREFACE DSECT PART 2          08530022
         SPACE                                                          08600020
         SAVE  (14,12)                                                  08700022
         LR    R4,R15             SET BASE REG.                         08800020
         LA    R15,TOTSAVE1       GET ADDR OF OWN SAVE AREA             08900022
         ST    R15,8(R13)         PUT ADDR IN CALLER'S SAVE AREA.       09000020
         SPACE                                                          09100020
         ST    R13,4(R15)         SAVE ADDR OF CALLER'S SAVE AREA.      09200020
         LR    R13,R15            SET REG 13 TO MY SAVE                 09230022
         SPACE                                                          09270022
         CLI   1(R1),X'02'        CORRECT MACRO LEVEL ?                 09340022
         BNE   DPR004             NO.                                   09410022
         L     R3,TOTOLTEN        SECTION PREFACE BASE          SA41596 09430000
         MVC   TOTSERV(END-START),START SET UP WORK AREA       @Y17XAUU 09435010
         SPACE                                                          09450022
         L     R12,4(R1)          GET ADDR OF DPRINT CONTROL WORD.      09500020
         SR    R9,R9                                                    09520022
         LH    R9,RTNDISP         GET DISPLACEMENT                      09540022
         AR    R9,R3              ESTABLISH BASE REG                    09560022
         ST    R9,PREFDS          SAVE ADDRESS                          09580022
         BAL   R10,DPRCLR         FILL PRINT BUFFER WITH BLANKS.        09600020
         SPACE                                                          09610000
         LA    R10,EPINDX         EP MASK CHECK FIELD ADDR       S22024 09620000
         SR    R14,R14            CLEAR INDEX REG                S22024 09630000
         IC    R14,TOTFLG08       GET LEVEL CNTL FLAG (BITS 4-7) S22024 09640000
         SLL   R14,D28            CLEAR                          S22024 09650000
         SRL   R14,D28            UNWANTED BITS                  S22024 09660000
         AR    R10,R14            POINT TO EP LEVEL CTL FLAG     S22024 09670000
         MVC   EPSAVE(D1),D0(R10) SAVE IT                        S22024 09680000
         SPACE                                                          09700020
         TM    0(R12),X'02'       IS THIS AN ERROR PRINT ?              09800020
         BZ    DPR005             BRANCH IF NO.                         09900020
         OI    $ERROPT,$ASTERIK   TURN ON FLAG TO PRINT '*'      S22024 09950010
         SPACE                                                          10000020
         TM    $ERROPT,$NERRPRT   NO ERROR PRINT                 S22024 10100000
         BO    DPR500             BRANCH IF YES - SKIP PRINT - RETURN.  10200020
         B     DPR007             BRANCH.                               10300020
         SPACE                                                          10305022
DPR004   EQU   *                                                        10310022
         LA    R15,4              SET FUNCT. NOT AVAIL. RET CODE        10320022
         STC   R15,TOTRTCOD       SAVE RETURN CODE                      10322022
         L     R13,4(R13)         GET CALLER'S SAVE AREA ADDR           10324022
         L     R14,12(R13)        RESTORE REG 14                        10326022
         L     R1,24(R13)         RESTORE REG 1                         10329022
         SPACE                                                          10390022
         USING RESPL,R5           SET RESPL ADDRESSABILITY     @Y17XAUU 10390110
         L     R5,TOTRESPL        GET RESPL ADDRESS            @Y17XAUU 10390210
         L     R15,RESPLM2        GET TRACE ROUTINE ADDRESS    @Y17XAUU 10390310
         LM    R2,R12,DISREG2(R13) RESTORE REGISTERS           @Y17XAUU 10390410
         BR    R15                EXIT TO TRACE ROUTINE        @Y17XAUU 10390510
         DROP  R5                                              @Y17XAUU 10390610
         SPACE                                                          10400020
DPR005   EQU   *                                                 S22024 10500000
         TM    $ERROPT,$NOCNTRL   NO CONTROL PRINT               S22024 10550000
         BO    DPR500             BRANCH IF YES - SKIP PRINT - RETURN.  10600020
         EJECT                                                          10650022
         SPACE 2                                                        10700020
*********************************************************************** 10800020
*        FORMS CONTROL                                                * 10900020
*********************************************************************** 11000020
         SPACE                                                          11100020
DPR007   SR    R7,R7              CLEAR R7.                             11200020
         IC    R7,0(R12)          GET FORMS CONTROL BITS.               11300020
         SRL   R7,5               POSITION BITS TO                      11400020
         SLL   R7,4                LOWER ORDER.                         11500020
         STC   R7,WRK             STORE IN WORK LOCATION                11600020
         OC    TOTFLG08(D1),WRK   FORM CONTROL BITS              S22024 11700000
         SPACE 2                                                        11800020
*********************************************************************** 11900020
*        HEADER                                                       * 12000020
*********************************************************************** 12100020
         SPACE                                                          12200020
         TM    0(R12),X'10'       PRINT HEADER ?                        12300020
         BZ    DPR030             BRANCH IF NO.                         12400020
         SPACE                                                          12500020
         TM    0(R12),X'02'       ERROR HEADER ?                        12600020
         BZ    DPR010             BRANCH IF NO.                         12700020
         MVI   PB,C'*'            PREFIX '*' ON HEADER.                 12800020
         SPACE                                                          12900020
DPR010   EQU   *                                                        12960022
         MVC   PB+1(8),TOTCROLT   GET SECTION ID                        13020022
         MVI   PB+D9,DASH         INSERT A DASH                 SA41596 13060000
         SPACE                                                          13100020
         MVC   PB+10(2),LEVEL     GET OLT LEVEL                         13300022
         SPACE                                                          13600020
         MVC   PB+D14(D3),DPRTN   PUT 'RTN' IN PRINT BUFFER      S22024 13700000
         L     R9,PREFDS                                                13750022
         SR    R7,R7              CLEAR R7.                             13800020
         IC    R7,RTN#            GET ROUTINE NUMBER.                   13900020
         CVD   R7,WRK             CONVERT TO DECIMAL.                   14000020
         SPACE                                                          14100020
         LA    R13,WRK+6          GET ADDR OF RTN NO.                   14200020
         LA    R14,WRK            GET OUTPUT ADDR.                      14300020
         LA    R15,2              GET COUNT                             14400020
         BAL   R10,DPRCNV         CONVERT RTN NO. TO EBCDIC.            14500020
         MVC   PB+18(3),WRK       PUT RTN NO. IN PRINT BUFFER.          14600020
         LA    R7,$PDEVADR        CDS BASE                       S22024 14620010
         USING CDSADR,R7                                         S22024 14640010
         TM    CDSFLG,SNPRES+CASNPRES SYMBOLIC NAME PRESENT      S22024 14660010
         BO    DPR017             YES                            S22024 14680010
         SPACE                                                          14700020
         LA    R13,9(R12)         GET ADDR OR DEVICE ADDR. ***********  14800022
         CLC   D0(D2,R13),H0      DEVICE ADDR SUPPLIED           S22024 15000000
         BNE   DPR015             BRANCH IF YES.                        15100020
         SPACE                                                          15200020
         L     R13,12(R1)         GET TECB ADDR                         15300022
         LTR   R13,R13            TECB ADDR GIVEN                       15400022
         BZ    DPR020             NO                                    15500022
         LA    R13,10(R13)        POINT TO DEVICE ADDR                  15600022
         CLC   D0(D2,R13),H0      DEVICE ADDR SUPPLIED           S22024 15800000
         BE    DPR020             BRANCH IF NO.                         15900020
DPR015   EQU   *                                                        15970020
         MVC   PB+D23(D3),DPDEV   PUT 'DEV' IN PRINT BUFFER      S22024 16040000
         LA    R14,PB+27          GET OUTPUT ADDR FOR CONVERT.          16110020
         LA    R15,2              GET COUNT.                            16200020
         BAL   R10,DPRCNV         CONVERT DEV ADDR TO EBCDIC.           16300020
         B     DPR020             CHECK FOR REFNUM               S22024 16310010
         SPACE                                                          16320010
DPR017   DS    0H                 BOUNDARY ALLIGNMENT            S22024 16330010
         MVC   PB+D23(D3),DPDEV   PUT 'DEV' IN PRINT BUF         S22024 16340010
         MVC   PB+D27(D8),CONFGNM SYMBOLIC NAME TO HEADER        S22024 16350010
         DROP  R7                                                S22024 16360010
         SPACE                                                          16400020
DPR020   TM    0(R12),X'01'       IS A REFNUM TO BE PRINTED.            16500020
         BZ    DPR025             BRANCH IF NO.                         16600020
         SPACE                                                          16700020
         MVC   PB+D37(D6),DPREF   PUT 'REFNUM' IN PRINT BUFFER   S22024 16800010
         L     R9,PREFDS                                                16850022
         MVC   WRK(1),REFNUM      MOVE 1ST 2 DIGITS TO WORK AREA.       16900020
         MVC   WRK+1(2),7(R12)    MOVE LAST 3 DIGITS TO WORK AREA       17000022
         LA    R13,WRK            GET INPUT ADDR FOR CONVERT.           17100020
         LA    R14,WRK+8          GET OUTPUT ADDR FOR CONVERT.          17200020
         LA    R15,3              GET COUNT.                            17300020
         BAL   R10,DPRCNV         CONVERT REFNUM TO EBCDIC.             17400020
         MVC   PB+D44(D2),WRK+D8  PUT REFNUM IN PRINT BUFFER     S22024 17500010
         MVC   PB+D46(D3),WRK+D11 PUT REFNUM IN PRINT BUFFER     S22024 17570010
         DROP  R9                                                       17650022
         SPACE                                                          17700020
DPR025   BAL   R10,DPRPNT         PRINT THE HEADER.                     17800020
         SPACE 2                                                        17900020
*********************************************************************** 18000020
*        DESCRIPTION                                                  * 18100020
*********************************************************************** 18200020
         SPACE                                                          18300020
DPR030   EQU   *                                                 S22024 18400000
         TM    EPSAVE,DESC        PRINT DESCRIPTION LINE         S22024 18420000
         BZ    DPR045             BRANCH IF NO                   S22024 18440000
         TM    D2(R12),PDESC      PRINT DESCRIPTION LINE         S22024 18460000
         BZ    DPR045             BRANCH IF NO.                         18500020
         SPACE                                                          18600020
         SR    R7,R7              CLEAR R7.                             18700020
         IC    R7,16(R12)         GET NO. OF DESC. LINES.               18800022
         LTR   R7,R7              NO. LINES = 0 ?                       18900020
         BZ    DPR045             BRANCH IF YES                         19000020
         SPACE                                                          19100020
         LA    R11,60(R1)         GET ADDR OF DESC. LINE 1.             19200022
         LA    R8,23(R12)         GET ADDR OF COUNT.                    19300022
         SPACE                                                          19400020
DPR035   SR    R6,R6              CLEAR R6.                             19500020
         IC    R6,0(R8)           GET COUNT.                            19600020
         LTR   R6,R6              COUNT = 0 ?                           19700020
         BZ    DPR040             BRANCH YES.                           19800020
         LH    R5,MAXCNT          GET MAX NO. BYTES ALLOWED.            19900020
         CR    R6,R5              COUNT GREATER THAN MAX ?              20000020
         BNH   DPR037             BRANCH IF NO.                         20100020
         LR    R6,R5              SET COUNT V MAX.                      20200020
         SPACE                                                          20300020
DPR037   EQU   *                                                        20800022
         SPACE                                                          21300020
         L     R5,0(R11)          GET DESC LINE ADDR.                   21400020
         BCTR  R6,0               REDUCE COUNT FOR EXECUTE OF MVC.      21500020
         EX    R6,DPR605          MOVE DESC LINE TO PRINT BUFFER.       21600020
         BAL   R10,DPRPNT         PRINT DESCRIPTION LINE.               21700020
         SPACE                                                          21800020
DPR040   LA    R11,4(R11)         GET ADDR OF DESC LINE 2 ADDR.         21900020
         LA    R8,1(R8)           GET ADDR OF COUNT.                    22000022
         BCT   R7,DPR035          PROCESS LINE 2.                       22100020
         SPACE 2                                                        22200020
*********************************************************************** 22300020
*        RESULTS                                                      * 22400020
*********************************************************************** 22500020
         SPACE                                                          22600020
DPR045   EQU   *                                                        23200022
         TM    EPSAVE,RESULTS     TEST RESULTS LINES             S22024 23400000
         BZ    DPR085             BRANCH IF NO - EXIT TO QWP1    S22024 23600000
         SPACE 2                                                        23900020
*********************************************************************** 24000020
*        CAW  CCW  CC                                                 * 24100020
*********************************************************************** 24200020
         SPACE                                                          24300020
DPR050   TM    2(R12),X'40'       PRINT CCW ?                           24400020
         BO    DPR052             BRANCH IF YES.                        24500020
         TM    3(R12),X'04'       PRINT CONDITION CODE ?                24600020
         BZ    DPR085             BRANCH IF NO.                         24700020
         LA    R11,1              SET NO CCW'S TO PRINT.                24800020
         B     DPR070             GO PRINT CC.                          24900020
         SPACE                                                          25000020
DPR052   DS    0H                 BOUNDARY ALLIGNMENT            S22024 25100000
         MVC   PB+D1(D3),DPCAW    PUT 'CAW' IN PRINT BUFFER      S22024 25150000
         SR    R11,R11            CLEAR R11.                            25200020
         IC    R11,11(R12)        GET CCW COUNT.                        25300022
         LA    R8,1               SET R8 FOR CCW#.                      25400020
         L     R7,20(R1)                                                25500022
         SR    R5,R5              CLEAR R5.                             25600020
         IC    R5,12(R12)         GET REL. NO. OF FAILING CCW           25700022
         LA    R6,1               SET R6 = 1.                           25800020
         CR    R6,R5              IS THIS CCW = FAILING CCW ?           25900020
         BNE   DPR055             BRANCH IF NO.                         26000020
         SPACE                                                          26100020
         TM    1(R12),X'40'       CCW ERROR ?                           26200020
         BZ    DPR055             BRANCH IF NO.                         26300020
         SPACE                                                          26400020
         MVI   PB+16,C'*'         PREFIX CCW WITH '*'.                  26500020
         SPACE                                                          26600020
DPR055   EQU   *                                                        26660022
         LA    R13,20(R1)         GET ADDR PORTION OF CAW               26720022
         LA    R14,PB+6           GET OUTPUT ADR FOR CONVERT.           26800020
         LA    R15,4              GET COUNT.                            26900020
         BAL   R10,DPRCNV         CONVERT CAW TO EBCDIC.                27000020
         SPACE                                                          27100020
         NI    WRK+20,X'7F'       CLEAR CC PRINTED FLAG.                27200020
         SPACE                                                          27300020
DPR060   LR    R13,R7             GET ADR OF CCW.                       27400020
         LA    R14,WRK            GET OUTPUT ADDR FOR CONVERT.          27500020
         LA    R15,8              GET COUNT.                            27600020
         BAL   R10,DPRCNV         CONVERT CCW TO EBCDIC.                27700020
         SPACE                                                          27800020
         CR    R6,R5              IS THIS CCW = FAILING CCW ?           27900020
         BNE   DPR065             BRANCH IF NO.                         28000020
         SPACE                                                          28100020
         MVI   PB+16,C'*'         PREFIX CCW WITH '*'.                  28200020
         SPACE                                                          28300020
DPR065   DS    0H                 BOUNDARY ALLIGNMENT            S22024 28400000
         MVC   PB+D17(D3),DPCCW   PUT 'CCW' IN PRINT BUFFER      S22024 28410000
         MVC   PB+23(2),WRK       MOVE CMD CODE TO PRINT BUFFER.        28430020
         MVC   PB+26(6),WRK+2     MOVE DATA ADR TO PRINT BUFFER.        28460020
         MVC   PB+33(2),WRK+8     MOVE FLAGS TO PRINT BUFFER.           28490020
         MVC   PB+36(2),WRK+10    MOVE UNUSED TO PRINT BUFFER.          28520020
         MVC   PB+39(4),WRK+12    MOVE BYTE CNT TO PRINT BUFFER.        28550020
         SPACE                                                          28580020
         STC   R8,WRK+30          STORE CURRENT CCW #.                  28610020
         LA    R13,WRK+30         GET ADR OF INPUT.                     28640020
         LA    R14,WRK            GET OUTPUT ADR FOR CONVERT.           28670020
         LA    R15,1              GET COUNT.                            28700020
         BAL   R10,DPRCNV         CONVERT CCW # TO EBCDIC.              28730020
         SPACE                                                          28760020
         MVC   PB+20(1),WRK+1     MOVE CCW # TO PRINT BUFFER.           28790020
         CLI   WRK,C'0'           DOES CCW # HAVE LEADING 0 ?           28820020
         BE    DPR068             BRANCH IF NO.                         28850020
         MVC   PB+20(2),WRK       PUT CCW # IN PB WITHOUT LEADING 0.    28880020
DPR068   EQU   *                                                        28910020
         SPACE                                                          28940020
         BAL   R10,DPRPNT         PRINT CCW LINE.                       29100020
         SPACE                                                          29200020
DPR070   EQU   *                                                        29260022
         TM    DPFLAG,BYPASS      HAS CC BEEN PRINTED ?                 29320022
         BO    DPR075             BRANCH IF YES.                        29400020
         SPACE                                                          29500020
         OI    DPFLAG,BYPASS      SET CC PRINTED FLAG                   29600022
         TM    3(R12),X'04'       PRINT CC ?                            29700020
         BZ    DPR072             BRANCH IF NO.                         29800020
         SPACE                                                          29900020
         MVC   PB+D1(D2),DPCC     PUT 'CC' IN PRINT BUFFER       S22024 30000000
         L     R9,12(R1)          GET TECB ADDR.                        30100020
         MVC   PB+4(1),8(R9)      PUT CC IN PB.                         30300020
         CLI   PB+4,X'FF'         CC OF X'FF' ?                         30380022
         BNE   DPR072             NO - BRANCH                           30460022
         MVI   PB+4,XC6           PUT F'S IN                            30540022
         MVI   PB+5,XC6           BUFFER                                30620022
         SPACE                                                          30700020
DPR072   DS    0H                 BOUNDARY ALLIGNMENT            S22024 30800000
         C     R11,F1             ANY MORE CCW'S LEFT            S22024 30850000
         BNE   DPR075             BRANCH IF YES.                        30900020
         SPACE                                                          31000020
         TM    3(R12),X'04'       PRINT CC ?                            31100020
         BZ    DPR085             BRANCH IF NO.                         31200020
         SPACE                                                          31300020
         BAL   R10,DPRPNT         PRINT CC.                             31400020
         B     DPR085             GO PROCESS EXPD CSW.                  31500020
         SPACE                                                          31600020
DPR075   LA    R7,8(R7)           POINT TO NEXT CCW.                    31700020
         LA    R6,1(R6)           INCREMENT CCW NO.                     31800020
         LA    R8,1(R8)           INCREMENT EBCDIC CCW NO.              31900020
         BCT   R11,DPR060         GO PROCESS NEXT CCW.                  32000020
         SPACE 2                                                        32100020
*********************************************************************** 32200020
*        EXIT TO IEDQWP1                                              * 32300010
*********************************************************************** 32400020
         SPACE                                                          32500020
DPR085   EQU   *                                                        32600020
         L     R13,TOTSAVE1+D4    CALLER'S SAVE AREA             S22024 32700000
         L     R14,12(R13)        GET RETURN ADR.                       32800020
         USING RESPL,R5           SET RESPL ADDRESSABILITY     @Y17XAUU 32801010
         L     R5,TOTRESPL        GET RESPL ADDRESS            @Y17XAUU 32802010
         L     R15,RESPLP1        GET IEDQWP1 ADDRESS          @Y17XAUU 32803010
         LM    R2,R12,DISREG2(R13) RESTORE REGISTERS           @Y17XAUU 32804010
         BR    R15                EXIT TO IEDQWP1              @Y17XAUU 32805010
         DROP  R5                                              @Y17XAUU 32806010
         SPACE 2                                                        33000020
DPR500   EQU   *                                                        38000020
         SPACE 2                                                        40800020
*********************************************************************** 40900020
*        RETURN TO CALLER                                             * 41000020
*********************************************************************** 41100020
         SPACE                                                          41120022
         TM    $OLTFLGS,$TRACE    TRACE OPTION SET ?                    41140022
         BO    DPR530             YES                                   41160022
         SPACE                                                          41200020
         L     R13,TOTSAVE1+D4    CALLER'S SAVE AREA             S22024 41300000
         LM    R14,R12,12(R13)    RESTORE CALLER'S REGS.                41400020
         SR    R15,R15            CLEAR RETURN CODE REG (R15).          41500020
         BR    R14                RETURN TO CALLER.                     41600020
*                                                                       41609022
*        REQUEST IEDQWM2 TO PROVIDE TRACE FUNCTION                      41618022
*                                                                       41627022
DPR530   EQU   *                                                        41636022
         SR    R15,R15            CLEAR RETURN CODE REG                 41645022
         STC   R15,TOTRTCOD       SAVE RETURN CODE                      41654022
         L     R13,TOTSAVE1+D4    CALLER'S SAVE AREA ADDR        S22024 41663000
         L     R1,24(R13)         RESTORE REG 1                         41667022
         L     R14,12(R13)        RESTORE REG 14                        41672022
*                                                                       41681022
         USING RESPL,R5           SET RESPL ADDRESSABILITY     @Y17XAUU 41681110
         L     R5,TOTRESPL        GET RESPL ADDRESS            @Y17XAUU 41681210
         L     R15,RESPLM2        GET TRACE ROUTINE ADDRESS    @Y17XAUU 41681310
         LM    R2,R12,DISREG2(R13) RESTORE REGISTERS           @Y17XAUU 41681410
         BR    R15                EXIT TO TRACE ROUTINE        @Y17XAUU 41681510
         DROP  R5                                              @Y17XAUU 41681610
         EJECT                                                          41700020
*********************************************************************** 41800020
*        DPRCNV - HEX TO EBCDIC CONVERT                               * 41900020
*                                                                     * 42000020
*              CALL SEQ -  R13 = INPUT ADDRESS                        * 42100020
*                          R14 = OUTPUT ADDRESS                       * 42200020
*                          R15 = INPUT BYTE COUNT                     * 42300020
*                                                                     * 42400020
*                          BAL R10,DPRCNV                             * 42500020
*********************************************************************** 42600020
         SPACE                                                          42700020
DPRCNV   ST    R5,WRK+120         SAVE WORK REG R5.                     42800020
         ST    R6,WRK+124         SAVE WORK REG R6.                     42900020
         SPACE                                                          43000020
         LTR   R15,R15            COUNT = 0 ?                           43100020
         BZ    DPRCNV8            BRANCH IF YES.                        43200020
         SPACE                                                          43300020
         AR    R14,R15         ADD COUNT TO OUTPUT ADDR.                43400020
         AR    R14,R15            ADD COUNT AGAIN.                      43500020
         AR    R13,R15            ADD COUNT TO INPUT ADDR.              43600020
         SR    R5,R5              CLEAR R5.                             43700020
         SR    R6,R6              CLEAR R6.                             43800020
         SPACE                                                          43900020
DPRCNV4  DS    0H                 BOUNDAY ALLIGNMENT             S22024 44000000
         S     R14,F2             GET ADDR OF LAST BYTE OF OUTPUT       44030000
*                                                                S22024 44060000
         BCTR  R13,0              GET ADDR OF LAST BYTE OF INPUT.       44100020
         IC    R6,0(R13)          GET HEX BYTE.                         44200020
         LR    R5,R6              PUT IN R5.                            44300020
         SRL   R6,4               GET BITS 0-3 IN R6.                   44400020
         N     R5,F15             GET BITS 4-7 IN R5             S22024 44500000
         IC    R6,DPREBC(R6)      CONVERT BITS 0-3 TO EBCDIC CHAR.      44600020
         IC    R5,DPREBC(R5)      CONVERT BITS 4-7 TO EBCDIC CHAR.      44700020
         STC   R6,0(R14)          STORE 1ST EBCDIC CHAR IN OUTPUT.      44800020
         STC   R5,1(R14)          STORE 2ND EBCDIC CHAR IN OUTPUT.      44900020
         BCT   R15,DPRCNV4        GET NEXT HEX BYTE.                    45000020
DPRCNV8  L     R5,WRK+120         RESTORE WORK REG R5.                  45100020
         L     R6,WRK+124         RESTORE WORK REG R6.                  45200020
         SPACE                                                          45300020
         BR    R10                RETURN TO CALLER.                     45400020
         SPACE                                                          45500020
DPREBC   DC    C'0123456789ABCDEF' HEX TO EBCDIC CONVERT TABLE.         45600020
         EJECT                                                          45700020
*********************************************************************** 45800020
*        PRINT LINE AND FILL PRINT BUFFER WITH BLANKS                 * 45900020
**********************************************************************  46000020
         SPACE                                                          46100020
DPRPNT   EQU   *                                                        46200020
         SPACE                                                          46300020
         LA    R14,L'PB           GET LENGTH OF PRINT BUFFER.           46400020
         LA    R15,PB+79                                                46450010
         SPACE                                                          46600020
DPRPNT5  EQU   *                                                        46700020
         CLI   0(R15),C' '        IS THIS CHAR A BLANK ?                46800020
         BNE   DPRPNT10           BRANCH IF NO.                         46900020
         BCT   R14,DPRPNT8        SUBTRACT 1 FROM COUNT.                47000020
         B     DPRPNT10           BUFFER IS ALL BLANKS - SET CNT = 0.   47100020
         SPACE                                                          47200020
DPRPNT8  EQU   *                                                        47300020
         BCT   R15,DPRPNT5        CHECK NEXT CHAR.                      47400020
DPRPNT10 EQU   *                                                        47500020
         STC   R14,TOTOTCNT       OUTPUT COUNT                   S22024 47600000
         NI    TOTFLG05,XFF-TOTCECOM-TOTREPLY-TOTEXIOF           S22024 47670000
         OI    TOTFLG05,TOTPRINT  SET DPRINT FLAG                S22024 47740000
         LA    R13,TOTSAVE1       MY SAVE AREA                   S22024 47810000
         USING RESPL,R5           SET RESPL ADDRESSABILITY     @Y17XAUU 47811010
         L     R5,TOTRESPL        GET RESPL ADDRESS            @Y17XAUU 47812010
         L     R15,RESPLWO        GET I/O ROUTINE ADDRESS      @Y17XAUU 47813010
         BALR  R14,R15            CALL I/O ROUTINE             @Y17XAUU 47814010
         DROP  R5                                              @Y17XAUU 47815010
DPRCLR   MVI   PB,C' '            PUT BLANK IN PRINT BUFFER.            48000020
         MVC   PB+1(L'PB-1),PB    FILL BUFFER WITH BLANKS.              48100020
         BR    R10                RETURN.                               48200020
         EJECT                                                          48300020
         DS    0F                                                       48330022
MAXCNT   DC    H'80'              MAX NO. BYTES IN DESC AND MSGE LINE.  48400020
DPR600   MVC   PB(0),0(R11)       MOVE MSGE TO PRINT BUFFER.            48500020
DPR605   MVC   PB(0),0(R5)        MOVE DESC LINE TO PRINT BUFFER.       48600020
PATCH    DS    CL60               MAINTENANCE AREA.                     48700020
START    DS    0F *************** START OF DATA TO BE MOVED    @Y17XAUU 48703010
QREFDS   DC    F'0'               SAVE AREA                    @Y17XAUU 48706010
QPFLAG   DC    X'00'              CONTROL FLAG                 @Y17XAUU 48710010
QPSAVE   DC    XL1'0'             EP LEVEL CONTROL FIELD       @Y17XAUU 48810010
END      DS    0C *************** END OF DATA TO BE MOVED      @Y17XAUU 48840010
         SPACE                                                          48950000
EPINDX   DS    0CL4               EP MASK TABLE                  S22024 49050000
EP0      DC    X'80'              PRINTER HEADER                 S22024 49150000
EP1      DC    X'E0'              PRINT HEADER/DESC/MSG          S22024 49250000
EP2      DC    X'90'              PRINT HEADER/RESULTS           S22024 49350000
EP3      DC    X'F0'              PRINT ALL                      S22024 49450000
*                                                                S22024 49550000
HDR      EQU   X'80'              HEADER LINE                    S22024 49650000
DESC     EQU   X'40'              DESCRIPTION LINES              S22024 49750000
MSG      EQU   X'20'              MESSAGES LINES                 S22024 49850000
RESULTS  EQU   X'10'              RESULTS                        S22024 49950000
*                                                                S22024 50050000
         LTORG                                                          50600020
F1       DC    F'1'               VALUE OF 1                     S22024 50609000
F2       DC    F'2'               VALUE OF 2                     S22024 50618000
F15      DC    F'15'              VALUE OF 15                    S22024 50627000
H0       DC    H'0'               VALUE OF 0                     S22024 50636000
DPREF    DC    C'REFNUM'          CHAR CONSTANT                  S22024 50645000
DPCC     DC    C'CC'              CHAR CONSTANT                  S22024 50654000
DPRTN    DC    C'RTN'             CHAR CONSTANT                  S22024 50663000
DPDEV    DC    C'DEV'             CHAR CONSTANT                  S22024 50672000
DPCAW    DC    C'CAW'             CHAR CONSTANT                  S22024 50681000
DPCCW    DC    C'CCW'             CHAR CONSTANT                  S22024 50690000
         EJECT                                                          50700020
*********************************************************************** 50800020
*        SECTION PREFACE DUMMY SECTION                                * 50900020
*********************************************************************** 51000020
         SPACE                                                          51100020
SPREF1   DSECT                                                          51170022
SECTID   DS    CL8                OLT SECTION ID                        51240022
LEVEL    DS    CL2                OLT LEVEL                             51310022
RTNDISP  DS    AL2                DISP TO RTN NUM                       51380022
SPREF2   DSECT                                                          51450022
RTN#     DS    XL1                ROUTINE NUMBER                        51520022
         DS    XL8                FLAGES                                51590022
RM       DS    XL2                ROUTINE MASK                          51660022
         DS    XL6                PLINK MANAGEMENT                      51730022
REFNUM   DS    CL1                REFERENCE NUMBER                      51800022
         SPACE 4                                                        51810010
CDSADR   DSECT                    CDS DSECT                      S22024 51820010
CUUADDR  DS    A                  UNIT ADDR                      S22024 51830010
         DS    CL5                UNUSED                         S22024 51840010
CDSFLG   DS    CL1                FLAG                           S22024 51850010
SNPRES   EQU   X'08'              SYNBOLIC NAME PRESENT          S22024 51860010
CASNPRES EQU   X'02'              CUSTOMER ASSIGNED NAME         S22024 51870010
         DS    CL2                UNUSED                         S22024 51880010
CONFGNM  DS    CL8                SYMBOLIC NAME                  S22024 51890010
         EJECT                                                          51900020
RESPL    RESPL                                                 @Y17XAUU 51910010
         EJECT                                                          51920010
         OLTCB                                                   S22024 52000000
PREFDS   DC    F'0'               SAVE AREA                    @Y17XAUU 52005010
DPFLAG   DC    X'00'              CONTROL FLAG                 @Y17XAUU 52010010
EPSAVE   DC    X'00'              EP LEVEL CONTROL FIELD       @Y17XAUU 52015010
         SPACE 2                                                        52100000
WRK      EQU   TOTWKSPC           WORK AREA                      S22024 52200000
PB       EQU   TOTOTBUF           OUTPUT BUFFER                  S22024 52300000
         END                                                            52400020
