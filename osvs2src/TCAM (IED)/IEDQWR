QWR      TITLE 'IEDQWR - TOTE PLINK SERVICE MODULE'                     00300022
IEDQWR   CSECT                                                          00600022
*A000000-999999                                                @Y16X5U0 00601000
* CHANGE ACTIVITY AS FOLLOWS:                                    S22024 00605000
*C448200                                                        SA41594 00610000
*D442200                                                        SA41594 00620000
*A006050,008300-010700,242500-243500,447540-448140               S22024 00624000
*A625300-628600,924570-924920                                    S22024 00628000
*C015000,123000,260000,280000,448500,468500,469200,469900        S22024 00632000
*C470600,471300,472000,472700,473400-477600,859090-859100        S22024 00636000
*C859320-859330,965000                                           S22024 00640000
*D448900-449600                                                  S22024 00644000
*A244540,295000,427700,580000                                           00646000
*A244540,427700,580000,858200,865000,965000,859600             @Y17XAUU 00647000
*C881000-924500                                                @Y17XAUU 00650000
*D709000                                                       @Y17XAUU 00652000
*C381000,413000,441200,447660-447820,447540,448020             @OY12288 00652610
*C448500,451700,458000,464300,465700,472000,476200,498000      @OY12288 00653210
*A244540,580000,867000,871000                                  @OY18053 00653410
*D580070-580280                                                @OY18053 00653610
IEDQW28  EQU   *                                                        00654022
         ENTRY IEDQW28                                                  00700022
*                                                                       00710022
         USING IEDQWR,R15                                               00720022
*                                                                       00730022
IEDQW28  IEDHJN STARR,HJN                                               00732000
*                                                                       00750022
*********************************************************************** 00800022
*                                                              * S22024 00830000
* MODULE NAME = IEDQWR (TCAM,TOTE)                             @Y17XAUU 00920000
*                                                              * S22024 00950000
* DESCRIPTIVE NAME = TOTE PLINK MODULE                         * S22024 00980000
*                                                              * S22024 01010000
* COPYRIGHT = NONE                                             * S22024 01040000
*                                                              * S22024 01070000
* STATUS --                                                    * S99528 01100022
*                                                              * S99528 01300022
*    VERSION 10.0                                              @Y17XAUU 01500000
*                                                              * S99528 01700022
* FUNCTIONS --                                                 * S99528 01900022
*                                                              * S99528 02100022
*    THIS ROUTINE LOADS OR DELETES MODULES.                    * S99528 02300022
*                                                              * S99528 02500022
*    THE PLINK MACRO REQUESTS MODULES BE LOADED AND/OR DELETED * S99528 02700022
*                                                              * S99528 02900022
*    IEDQWR EXAMINES THE CALLING ROUTINE'S PLINK PARAMETER     * S99528 03100022
*    LIST. IF A DELETE IS REQUESTED, THE MODULE(S) IS(ARE)     * S99528 03300022
*    DELETED VIA A DELETE MACRO. IF A LOAD IS REQUESTED, A     * S99528 03500022
*    BLDL MACRO IS ISSUED TO VERIFY THE AVAILABILITY OF THE    * S99528 03700022
*    MODULE AND REQUIRED CORE. THE MODULE IS THEN LOADED VIA   * S99528 03900022
*    A LOAD MACRO. THE LOAD MODULE ENTRY POINT ADDRESS IS      * S99528 04100022
*    PLACED IN THE CALLING PROGRAM'S PARAMETER LIST.           * S99528 04300022
*                                                              * S99528 04500022
*    AS MODULES ARE LOADED AND DELETED, IEDQWR UPDATES MEMORY  * S99528 04700022
*    SPACE AVAILABLE TO THE CALLING PROGRAM AND ACTIVE         * S99528 04900022
*    MODULE ID'S.                                              * S99528 05100022
*                                                              * S99528 05300022
*    AT THE COMPLETION OF THIS ROUTINE, REGISTER 15 CONTAINS   * S99528 05500022
*    ONE OF THE FOLLOWING RETURN CODES:                        * S99528 05700022
*                                                              * S99528 05900022
*         X'00' - NORMAL COMPLETION OF THE PLINK FUNCTION      * S99528 06100022
*         X'08' - I/O ERROR DURING A LOAD REQUEST              * S99528 06300022
*         X'0C' - REQUESTED LOAD MODULE NOT FOUND IN LIBRARY   * S99528 06500022
*         X'10' - INSUFFICIENT MEMORY SPACE AVAILABLE          * S99528 06700022
*                                                              * S99528 06900022
* ENTRY POINT --                                               * S99528 07100022
*                                                              * S99528 07300022
*    IEDQWR - CALLED WHEN A PLINK MACRO IS ISSUED BY THE       * S99528 07500022
*             CONFIGURATOR OR UNIT TEST.                       * S99528 07700022
*                                                              * S99528 07900022
* PURPOSE -- SEE FUNCTION                                      @Y17XAUU 07900700
*                                                              @Y17XAUU 07901400
* LINKAGE -- BALR R14,R15 FROM IEDQWA                          @Y17XAUU 07902100
*                                                              @Y17XAUU 07902800
* MODULE TYPE -- PROCEDURE                                     @Y17XAUU 07903500
*                                                              @Y17XAUU 07904200
* MODULE SIZE -- 2K MAXIMUM                                    @Y17XAUU 07904900
*                                                              @Y17XAUU 07905600
* PROCESSOR -- ASSEMBLER XF                                    @Y17XAUU 07906300
*                                                              @Y17XAUU 07907000
* MACROS -- IEDHJN,DCB,RESPL,OLTCB,LOAD,DELETE,SAVE            @Y17XAUU 07907700
*                                                              @Y17XAUU 07908400
* INPUT --                                                     * S99528 08100022
*                                                              * S99528 08300022
*    REGISTERS 01,02,13,14,15 CONTAIN THE FOLLOWING VALUES:    * S99528 08500022
*                                                              * S99528 08700022
*         01 - PLINK PARAMETER LIST ADDRESS                    * S99528 08900022
*         02 - OLTCB ADDRESS                                   * S99528 09100022
*         13 - SAVE AREA ADDRESS                               * S99528 09300022
*         14 - RETURN ADDRESS                                  * S99528 09500022
*         15 - ENTRY POINT ADDRESS                             * S99528 09700022
*                                                              * S99528 09900022
* OUTPUT --                                                    * S99528 10100022
*                                                              * S99528 10300022
*    REGISTER 15 CONTAINS ONE OF THE FOLLOWING VALUES:         * S99528 10500022
*                                                              * S99528 10700022
*         X'00' - NORMAL COMPLETION                            * S99528 10900022
*         X'08' - I/O ERROR DURING LOAD                        * S99528 11100022
*         X'0C' - REQUESTED LOAD MODULE NOT FOUND IN LIBRARY   * S99528 11300022
*         X'10' - INSUFFICIENT MEMORY SPACE AVAILABLE          * S99528 11500022
*                                                              * S99528 11700022
* EXTERNAL REFERENCES --                                       * S99528 11900022
*                                                              * S99528 12100022
*    IEDQWO - ACCESS MANAGER TO PRINT MESSAGE                  * S22024 12300000
*                                                              * S99528 12500022
* EXITS,NORMAL --                                              * S99528 12700022
*                                                              * S99528 12900022
*    BR AFTER PLK050 TO IEDQWM2 FOR TRACE FUNCTION             * S99528 13100022
*                                                              * S99528 13300022
* EXITS,ERROR --                                               * S99528 13500022
*                                                              * S99528 13700022
*    XCTL TO IEDQWM2 AFTER PLK004 (INCORRECT MACRO LEVEL)      * S99528 13900022
*                                                              * S99528 14100022
* TABLE/WORK AREAS --                                          * S99528 14300022
*                                                              * S99528 14500022
*    OLTCB                                                     * S99528 14700022
*                                                              * S99528 14900022
* ATTRIBUTES --                                                * S99528 15100022
*                                                              * S99528 15300022
*    ENABLED, PROBLEM PROGRAM MODE, TRANSIENT                  * S99528 15500022
*                                                              * S99528 15700022
* NOTES -- SEE BELOW                                           @Y17XAUU 15702000
*                                                              @Y17XAUU 15704000
*  DEPENDENCIES -- EBCDIC CHARACTER CODE                       @Y17XAUU 15706000
*                                                              @Y17XAUU 15708000
*  RESTRICTIONS -- NONE                                        @Y17XAUU 15710000
*                                                              @Y17XAUU 15712000
*  REGISTERS CONVENTION -- SEE REGISTERS ASSIGNMENT            @Y17XAUU 15714000
*                                                              @Y17XAUU 15716000
*  PATCH LABEL -- PATCH                                        @Y17XAUU 15718000
*                                                              * S99528 17300022
**************************************************************** S99528 17500022
         EJECT                                                          17700022
R0       EQU   0                  REGISTER 0                     S99528 23000022
R1       EQU   1                  PARAMETER LIST ADDRESS         S99528 23080022
R2       EQU   2                  ADDRESS OF OLTCB               S99528 23160022
R3       EQU   3                  REGISTER 3                     S99528 23240022
R4       EQU   4                  BASE REGISTER                  S99528 23320022
R5       EQU   5                  REGISTER 5                     S99528 23400022
R6       EQU   6                  REGISTER 6                     S99528 23480022
R7       EQU   7                  REGISTER 7                     S99528 23560022
R8       EQU   8                  REGISTER 8                     S99528 23640022
R9       EQU   9                  REGISTER 9                     S99528 23720022
R10      EQU   10                 REGISTER 10                    S99528 23800022
R11      EQU   11                 REGISTER 11                    S99528 23880022
R12      EQU   12                 REGISTER 12                    S99528 23960022
R13      EQU   13                 SAVE AREA ADDRESS              S99528 24040022
R14      EQU   14                 RETURN ADDRESS                 S99528 24120022
R15      EQU   15                 ENTRY POINT ADDRESS            S99528 24200022
XFF      EQU   X'FF'              MASK SETTING                   S22024 24250000
BLANK    EQU   X'40'              BLANK CHAR                      22024 24300000
D79      EQU   79                 DISP OF 79                      22024 24350000
NOCOR    EQU   X'10'              CORE NOT AVAIL. RETURN CODE           24422022
LOA      EQU   X'80'              LOAD REQUEST                          24424022
DELET    EQU   X'40'              DELETE REQUEST                        24426022
D0       EQU   0                  DISP OF 0                             24428022
D1       EQU   1                  DISP OF 1                             24430022
D2       EQU   2                  DISP OF 2                             24432022
D3       EQU   3                  DISP OF 3                             24434022
D4       EQU   4                  DISP OF 4                             24436022
D5       EQU   5                  DISP OF 5                             24438022
D6       EQU   6                  DISP OF 6                             24440022
D7       EQU   7                  DISP OF 7                             24442022
D8       EQU   8                  DISP OF 8                             24444022
D9       EQU   9                  DISP OF 9                             24446022
D10      EQU   10                 DISP OF 10                            24448022
D12      EQU   12                 DISP OF 12                            24450022
D16      EQU   16                 DISP OF 16                            24452022
D20      EQU   20                 DISP OF 20                            24454022
D23      EQU   23                       DISP OF 23             @OY18053 24454310
DISREG2  EQU   28                 DISPLACEMENT TO REG 2        @Y17XAUU 24454600
ADRMSK7  EQU   7                  ADDRESS MASK                 @Y17XAUU 24455200
         DROP R15                                                       24460022
         SPACE 2                                                        24500020
         USING IEDQWR,R4                                                25200022
         USING TOTOLTCB,R2        OLTCB BASE                     S22024 26000000
         SPACE                                                          26500020
         SAVE  (14,12)                                                  26800022
*                                                                       27100022
         LR    R4,R15             LOAD BASE REG.                        27500020
         LA    R15,TOTSAVE1       MY SAVE AREA                   S22024 28000000
         ST    R15,8(R13)         PUT ADDR. IN CALLER'S SAVE AREA.      28500020
         ST    R13,4(R15)         PUT ADDR. OF CALLER'S AREA IN OWN.    29000020
         LR    R13,R15            POINT TO OWN SAVE AREA.               29500020
         SPACE                                                          30000020
         MVC   TOTSERV(END-START),START SET UP WORK AREA       @Y17XAUU 30100000
         SR    R15,R15            CLEAR RETURN CODE REG.                30500020
         LA    R5,8(R1)           GET ADDR OF CONTROL INFORMATION       30600022
         SPACE                                                          30700022
         CLI   1(R1),X'02'        LEVEL 2 MACRO ID?                     30800022
         BNE   PLK004             NO                                    30870022
         LA    R7,12(R1)          GET ADDRESS OF MODULES ID LIST        30950022
         SPACE                                                          31000022
         SPACE 2                                                        31500020
*********************************************************************** 32000020
*        DELETE                                                       * 32500020
*********************************************************************** 33000020
         SPACE                                                          33500020
         TM    0(R5),X'08'        DELETE REQUEST?                       34000022
         BZ    PLK008             BRANCH IF NO.                         34500020
         SR    R6,R6              CLEAR R6.                             35500020
         IC    R6,11(R1)          GET DELETE COUNT                      36000022
         LTR   R6,R6              IS COUNT 0 ?                          36500020
         BZ    PLK008             BRANCH IF YES.                        37000020
         SPACE                                                          37500020
PLK002   EQU   *                                                        37700022
         SR    R15,R15            CLEAR RETURN CODE REG                 37900022
         L     R9,TOTPLBKW              GET PLINK ELEM         @OY12288 38000010
         LA    R11,TOTPLNKQ       GET ADDR OF QCB                       38300022
PLK003   EQU   *                                                        38500022
         CR    R9,R11             IS QUEUE EMPTY ?                      38700022
         BE    PLK050             YES - RETURN                          38900022
*                                                                       39100022
         USING PLNKPREF,R9                                              39300022
         SR    R10,R10            CLEAR REG 10                          39500022
         LH    R10,PLNKMPTR       GET DISPLACEMENT TO PLINK PARM        39700022
*                                                                       39900022
         AR    R10,R9             GET ADDR OF QUEUE POINTERS            40100022
         USING PLNKQPTR,R10                                             40300022
         CLC   PLNKNAME(8),0(R7)  MODULE ID FOUND ?                     40500022
         BE    PLK005             YES - DELETE IT                       40700022
         DROP  R9                                                       40900022
*                                                                       41100022
         L     R9,PLNKQBKD              GET NEXT PLINK ELEM    @OY12288 41200010
         LA    R9,0(R9)           ZERO HIGH ORDER BYTE                  41500022
         B     PLK003             CHECK NEXT ELEMENT                    41700022
         SPACE                                                          41900022
         SPACE                                                          42540022
PLK004    EQU   *                                                       42610022
         LA    R15,4              SET INCORRECT MACRO LEV RET CODE      42650022
         STC   R15,TOTRTCOD       SAVE RETURN CODE                      42690022
         L     R13,4(R13)         RESTORE CALLER'S SAVE AREA ADDR       42730022
         L     R14,12(R13)        RESTORE REG 14                        42770022
         SPACE                                                          42900022
         USING RESPL,R5           SET RESPL ADDRESSABILITY     @Y17XAUU 42901000
         L     R5,TOTRESPL        GET RESPL ADDRESS            @Y17XAUU 42902000
         L     R15,RESPLM2        GET TRACE ROUTINE ADDRESS    @Y17XAUU 42903000
         LM    R2,R12,DISREG2(R13) RESTORE REGISTERS           @Y17XAUU 42904000
         BR    R15                EXIT TO TRACE ROUTINE        @Y17XAUU 42905000
         DROP  R5                                              @Y17XAUU 42906000
         SPACE                                                          43000020
PLK005   EQU   *                                                        43070022
         MVC   MODNAME(8),0(R7)   MOVE MODULE ID TO BLDL LIST           43140022
         LR    R5,R1              SAVE REG 1                            43210022
*                                                                       43280022
         BLDL  0,BLDLLIST                                               43350022
*                                                                       43420022
         LR    R1,R5              RESTORE REG 1                         43490022
*                                                                       43560022
*                                                                       43650022
         MVI   PLKFLG1,DELET      SHOW DELETE REQUEST                   43740022
         BAL   R3,COREUPD         UPDATE AVAIL CORE                     43830022
*                                                                       43920022
*        R10 IS BASE FOR ELEMENT QUEUE POINTERS                         44050022
         L     R9,PLNKQFWD              GET NEXT ELEM          @OY12288 44120010
         LA    R9,0(R9)           CLEAR HI-ORDER BYTE                   44190022
         CLC   TOTPLFWD(4),TOTPLBKW FORWARD PTR = BACKWARD PTR ?        44260022
         BNE   PLK005D            NO                                    44330022
*        ONLY ONE ELEMENT ON QUEUE                                      44400022
         ST    R11,TOTPLFWD       INIT QCB FORWARD PTR                  44470022
         ST    R11,TOTPLBKW       INIT QCB BACKWARD PTR                 44540022
         B     PLK006P            DELETE MODULE                         44610022
*                                                                       44680022
PLK005D  EQU   *                                                        44750022
         CR    R9,R11                   DELETE LAST ELEM ON Q? @OY12288 44754010
         BNE   PLK005F            NO                             S22024 44758000
*        MORE THAN ONE ELEMENT ON Q - DELETE FIRST ELEMENT       S22024 44762000
         L     R5,PLNKQBKD              ADDR OF ELEM TO DELETE @OY12288 44766010
         ST    R5,TOTPLBKW              SAVE IN QCB BACKWARD   @OY12288 44770010
         L     R5,PLNKQFWD              ELEM FORWARD           @OY12288 44774010
         ST    R5,QLAST                 SAVE IT                @OY12288 44778010
         L     R5,PLNKQBKD              ADR OF ELEM TO BE FIRST@OY12288 44782010
         USING PLNKPREF,R5                                       S22024 44786000
         SR    R10,R10            CLEAR REG                      S22024 44790000
         LH    R10,PLNKMPTR       DISP TO PLINK PARM             S22024 44794000
         AR    R10,R5             POINT TO ELEMENT Q             S22024 44798000
         MVC   PLNKQFWD(D4),QLAST       POINT TO Q             @OY12288 44802010
         DROP  R5                                                S22024 44806000
         B     PLK006P            DELETE FIRST ELENENT ON CHAIN  S22024 44810000
PLK005F  EQU   *                                                 S22024 44814000
*                                                                       44820022
         CL    R11,PLNKQBKD             DELETE LAST ELEM ON Q? @OY12288 44850010
         BNE   PLK005H            NO                                    45030022
*                                                                       45100022
         L     R5,PLNKQFWD              POINT TO FIRST ELEM    @OY12288 45170010
         ST    R5,TOTPLFWD              SET QCB FORWARD PTR    @OY12288 45240010
         DROP  R10                                                      45310022
         USING PLNKPREF,R5                                              45380022
         SR    R10,R10            CLEAR REG 10                          45450022
         LH    R10,PLNKMPTR       GET DISP TO PLINK PARM                45520022
*                                                                       45590022
         AR    R10,R5             SET BASE                              45660022
         USING PLNKQPTR,R10                                             45730022
         ST    R11,PLNKQBKD             NEXT PTR TO QCB        @OY12288 45800010
         B     PLK006P            DELETE MODULE                         45870022
*                                                                       45940022
         DROP  R5                                                       46010022
         DROP  R10                                                      46080022
*                                                                       46150022
PLK005H  EQU   *                                                        46220022
*                                                                       46290022
         USING PLNKQPTR,R10                                             46360022
         L     R5,PLNKQBKD              GET LAST ELEM ADDR     @OY12288 46430010
         ST    R5,QNEXT           SAVE IT                               46500022
         L     R5,PLNKQFWD              GET FIRST ELEM ON CHAIN@OY12288 46570010
         ST    R5,QLAST           SAVE IT                               46640022
         DROP  R10                                                      46710022
*                                                                       46780022
         USING PLNKPREF,R5                                       S22024 46850000
         SR    R10,R10            CLEAR REG                      S22024 46920000
         LH    R10,PLNKMPTR       DISP TO Q PTR                  S22024 46990000
         AR    R10,R5             POINT TO QUEUE PTR             S22024 47060000
         USING PLNKQPTR,R10                                      S22024 47130000
         MVC   PLNKQBKD(D4),QNEXT       SET TO NEXT ELEM       @OY12288 47200010
         SPACE                                                          47270000
         L     R5,QNEXT           LAST ELEMENT TO UPDATE         S22024 47340000
         SR    R10,R10            CLEAR REG                      S22024 47410000
         LH    R10,PLNKMPTR       DISP TO QUEUE PTR              S22024 47480000
         AR    R10,R5             POINT TO QUEUE PTR             S22024 47550000
         MVC   PLNKQFWD(D4),QLAST       SET FORWARD POINTER    @OY12288 47620010
         DROP  R5                                                S22024 47690000
         DROP  R10                                               S22024 47760000
         SPACE                                                          47860022
PLK006P  EQU   *                                                        47960022
         DELETE DE=MODNAME        DELETE THE MODULE                     48060022
         SPACE                                                          48500020
PLK007   LA    R7,8(R7)           POINT TO NEXT MODULE I.D.             49500020
         BCT   R6,PLK002                TRY AGAIN              @OY12288 49800010
         B     PLK050             EXIT                                  50100022
         SPACE 2                                                        50500020
*********************************************************************** 51000020
*        LOAD                                                         * 51500020
*********************************************************************** 52000020
         SPACE                                                          52500020
PLK008   EQU   *                                                        52800022
         TM    0(R5),X'80'        LOAD REQUEST ?                        53100022
         BZ    PLK050             BRANCH IF NO - RETURN.                53500020
         SPACE                                                          54000020
PLK010   L     R8,4(R1)           GET ADDR OF ENTRY POINT LIST          54700022
         SR    R6,R6              CLEAR R6.                             55500020
         IC    R6,10(R1)          GET LOAD COUNT                        56000022
         LTR   R6,R6              IS COUNT 0 ?                          56500020
         BZ    PLK050             BRANCH IF YES - RETURN.               57000020
         SPACE                                                          57500020
PLK012   MVC   MODNAME(8),0(R7)   MOVE I.D. TO BLDL LIST.               58000020
         BLDL  0,BLDLLIST               BUILD LIST             @OY18053 58000310
         LTR   R15,R15                  WAS BLDL OK?           @OY18053 58000610
         BZ    PLK016                   YES                    @OY18053 58000910
         CH    R15,H4                   RTN CODE=MOD NOT FOUND @OY18053 58001210
         BNE   PLK050                   NO, MUST BE I/O ERROR  @OY18053 58001510
         MVI   TOTOTBUF,BLANK           BLANK OUTPUT           @OY18053 58001810
         MVC   TOTOTBUF+D1(D79),TOTOTBUF     BUFFER            @OY18053 58002110
         MVC   TOTOTBUF(PLKMSGE-PLKMSG),PLKMSG MSG TO OLTCB    @OY18053 58002410
         MVC   TOTOTBUF+D23(8),MODNAME GET MODULE NAME FOR MSG @OY18053 58002710
         LA    R15,PLKMSGE-PLKMSG       MSG LENGTH TO OLTCB    @OY18053 58003010
         STC   R15,TOTOTCNT                                    @OY18053 58003310
         NI    TOTFLG05,XFF-TOTREPLY-TOTEXIOF-TOTPRINT         @OY18053 58003610
         OI    TOTFLG05,TOTCECOM        SHOW CECOM REQUEST     @OY18053 58003910
         LA    R13,TOTSAVE1             GET SAVE AREA          @OY18053 58004210
         L     R15,TOTRESPL             GET RESPL ADDRESS      @OY18053 58004510
         USING RESPL,R15                SET UP ADDRESSABILITY  @OY18053 58004810
         L     R15,RESPLWO              GET ACCESS ROUTINE ADDR@OY18053 58005110
         BALR  R14,R15                  IEDQWO TO WRITE MSG    @OY18053 58005410
         DROP  R15                                             @OY18053 58005710
         LA    R15,12                   SET RTN CODE-NO MODULE @OY18053 58006010
         B     PLK050                   RETURN                 @OY18053 58006310
PLK016   EQU   *                                               @OY18053 58006610
         LOAD  EPLOC=MODNAME           LOAD THE OLT ROUTINE    @Y17XAUU 58035000
         LR    R11,R0             GET ENTRY POINT ADDRESS      Y17XAUU  58049000
         SPACE                                                          58500020
         MVI   PLKFLG1,LOA        SHOW LOAD REQUEST                     66500022
         BAL   R3,COREUPD         UPDATE AVAIL. CORE                    67500022
         SPACE                                                          70500020
PLK020   EQU   *                                                        70700022
         SR    R15,R15            CLEAR RETURN CODE REG                 71100022
*                                                                       71300022
          L     R11,12(R11)        GET ADDRESS OF FIRST EX INSTR        71700022
         ST    R11,0(R8)          STORE IN CALLER'S LIST                71900022
         LA    R7,8(R7)           POINT TO NEXT MODULE ID               72100022
         LA    R8,4(R8)           POINT TO NEXT ENTRY                   72300022
*                                                                       72500022
         LA    R5,TOTPLNKQ        GET ADDRESS OF PLINK QCB              72700022
          L     R9,TOTPLFWD        GET NEXT PLINK QUEUE ELEMENT         72900022
         LA    R9,0(R9)           CLEAR HIGH ORDER BYTE                 73100022
*                                                                       73300022
         CR    R5,R9              IS ELEMENT THE QCB ?                  73500022
          BE    PLK024             YES - Q CHAIN IS EMPTY               73700022
*                                                                       73900022
         L     R9,TOTPLBKW        POINT TO LAST ELEMENT                 74100022
          ST    R9,PLKLAST         SAVE ADDRESS OF LAST ELEMENT         74300022
         USING PLNKPREF,R9                                              74500022
         SR    R10,R10                                                  74700022
         LH    R10,PLNKMPTR       GET DISPLACEMENT TO PLINK PARM        74900022
          AR    R10,R9             GET ADDRESS OF QUEUE POINTERS        75100022
         DROP  R9                                                       75300022
*                                                                       75500022
         USING PLNKQPTR,R10                                             75700022
         LR    R9,R0              GET ADDRESS OF ELEMENT TO BE ADDED    75900022
          ST    R9,PLNKQFWD        PUT  IT IN LAST ELEMENT              76100022
         ST    R9,TOTPLBKW        PUT IT IN QCB BACKWARD POINTER        76200022
*                                                                       76300022
         USING PLNKPREF,R9                                              76500022
         SR    R10,R10                                                  76700022
         LH    R10,PLNKMPTR       GET DISPLACEMENT TO PLINK PARM        76900022
          AR    R10,R9             GET ADDRESS OF QUEUE POINTERS        77100022
         DROP  R9                                                       77300022
*                                                                       77500022
         USING PLNKQPTR,R10                                             77700022
         ST    R5,PLNKQFWD        PLACE QCB ADDR IN FORWARD PTR         77900022
         MVC   PLNKQBKD(4),PLKLAST POINT BACK TO LAST ELEMENT           78100022
         B     PLK028             BR TO LOAD NEXT MODULE         S99528 78300022
          DROP  R10                                                     78500022
         SPACE 2                                                        78700022
PLK024   EQU   *   ADD FIRST ELEMENT                                    78900022
         LR    R9,R0              GET ADDRESS OF ELEMENT TO BE ADDED    79100022
          ST    R9,TOTPLFWD        PUT IT IN QCB FORWARD POINTER        79300022
         ST    R9,TOTPLBKW        PUT IT IN QCB BACKWARD POINTER        79500022
*                                                                       79700022
         USING PLNKPREF,R9                                              79900022
          SR    R10,R10                                                 80100022
         LH    R10,PLNKMPTR       GET DISPLACEMENT TO PLINK PARM        80300022
          AR    R10,R9             GET ADDRESS OF QUEUE POINTERS        80500022
         DROP  R9                                                       80700022
*                                                                       80900022
          USING PLNKQPTR,R10                                            81100022
         ST    R5,PLNKQFWD        PLACE QCB ADDR IN ELEMENT NEXT PTR    81300022
         ST    R5,PLNKQBKD        PLACE QCB ADDR IN ELEMENT LAST PTR    81500022
          DROP  R10                                                     81700022
PLK028   EQU   *                                                        81900022
         BCT   R6,PLK012          LOAD NEXT MODULE.                     83000020
         SPACE 2                                                        83500020
PLK050   L     R13,4(R13)         GET ADDR. OF CALLERS SAVE AREA.       84000020
         L     R14,12(R13)        RESTORE R14.                          84500020
         STC   R15,TOTRTCOD       SAVE RETURN CODE                      84550022
         TM    $OLTFLGS,$TRACE    TRACE OPTION SET ?                    84600022
         BO    PLK060             YES                                   84650022
         TM    $RETMASK,X'FF'     ANY TERMINATE BITS SET ?              84700022
         BZ    PLK055             NO - RETURN NORMALLY                  84750022
         CLI   TOTRTCOD,0         RETURN CODE OF ZERO ?                 84800022
         BNE   PLK060             NO                                    84850022
PLK055   EQU   *                                                        84900022
         LM    R0,R12,20(R13)     RESTORE CALLER'S REGS.                85000020
         BR    R14                RETURN.                               85500020
*                                                                       85580022
*        REQUEST IEDQWM2 TO PROVIDE TRACE FUNCTION                      85660022
*                                                                       85740022
PLK060   EQU   *                                                        85820022
         USING RESPL,R5           SET RESPL ADDRESSABILITY     @Y17XAUU 85821000
         L     R5,TOTRESPL        GET RESPL ADDRESS            @Y17XAUU 85822000
         L     R15,RESPLM2        GET TRACE ROUTINE ADDRESS    @Y17XAUU 85823000
         LM    R2,R12,DISREG2(R13) RESTORE REGISTERS           @Y17XAUU 85824000
         BR    R15                EXIT TO TRACE ROUTINE        @Y17XAUU 85825000
         DROP  R5                                              @Y17XAUU 85826000
         EJECT                                                          85901022
*                                                                       85902022
COREUPD  EQU   *   UPDATE AVAILABLE CORE                                85903022
*                                                                       85904022
         STM   R8,R12,PLKSAVE1    SAVE REG                              85905022
         ST    R6,PLKSAVE2        SAVE REG                              85905522
         CLI   PLKFLG1,LOA        LOAD REQUEST ?                        85906022
         BE    COR20              YES                                   85907022
*        ASSUME DELETE REQUEST                                          85908022
         MVC   TOTWKSPC(D3),CORENEED SIZE OF MODULE              S22024 85909000
         L     R6,TOTWKSPC        GET CORE SIZE                  S22024 85910000
         SRL   R6,D8              CLEAR HIGH ORDER BYTE                 85911022
         L     R11,TOTUSCOR       CURRENT CORE IN USE            S22024 85911200
         SR    R11,R6             UPDATE IT                      S22024 85911400
         ST    R11,TOTUSCOR       REPLACE IT                     S22024 85911600
         L     R9,TOTMMSPC        GET CURRENT SPACE AVAIL.              85912022
         AR    R9,R6              UPDATE AVAIL CORE                     85913022
         ST    R9,TOTMMSPC        SAVE NEW VALUE                        85914022
         AR    R11,R9             GET TOTAL OF CORE IN USE AND   S22024 85914500
*                                   CORE AVAILABLE               S22024 85914700
         S     R11,K8192          SUBTRACT DEFAULT VALUE OF 8K   S22024 85914900
         LTR   R11,R11            HAS ANY CORE BEEN OBTAINED     S22024 85915100
*                                   FROM RESPL?                  S22024 85915300
         BNP   COR16              NO - BRANCH                    S22024 85915500
         SR    R8,R8              CLEAR REGISTER 8               S22024 85915700
         D     R8,K1024           DETERMINE CORE GOTTEN FROM     S22024 85915900
*                                   THE RESPL                    S22024 85916100
         LTR   R9,R9              IS IT LESS THAN 1K?            S22024 85916300
         BZ    COR16              YES - RETURN                          85917022
*                                                                       85918022
         ST    R8,TOTMMSPC        SET NEW BYTE VALUE                    85919022
         L     R8,TOTRESPL        GET ADDR OF RES. P-LIST               85920022
         USING RESPL,R8                                                 85921022
         LH    R12,RESBKTOT       GET CURRENT 1K BLOCK COUNT            85922022
         AR    R9,R12             UPDATE BLOCK COUNT                    85923022
         STH   R9,RESBKTOT        REPLACE BLOCK COUNT                   85924022
         DROP  R8                                                       85925022
COR16    EQU   *                                                        85926022
         L     R6,PLKSAVE2        RESTORE REG.                          85926522
         LM    R8,R12,PLKSAVE1    RESTORE REG.                          85927022
         BR    R3                 RETURN                                85928022
*                                                                       85929022
COR20    EQU   *   LOAD REQUEST                                         85930022
*                                                                       85931022
         MVC   TOTWKSPC(D3),CORENEED SIZE OF MODULE              S22024 85932000
         L     R9,TOTWKSPC        SIZE OF MODULE                 S22024 85933000
         SRL   R9,D8              CLEAR HIGH ORDER BYTE                 85934022
         LR    R11,R9             AMOUNT OF CORE TO BE TAKEN     S22024 85934500
COR24    EQU   *                                                        85935022
         CL    R9,TOTMMSPC        CORE AVAIL IN SUB-TOTAL ?             85936022
         BNH   COR32              YES                                   85937022
         L     R12,TOTRESPL       GET ADDR OF RES. P-LIST               85938022
         USING RESPL,R12                                                85939022
         LH    R8,RESBKTOT        GET CURRENT 1K BLOCK COUNT            85940022
COR28    EQU   *                                                        85941022
         LTR   R8,R8              COUNT ZERO ?                          85942022
         BZ    CORERR             YES - NOT ENOUGH CORE AVAIL.          85943022
         BCTR  R8,R0              DECREMENT COUNT                       85944022
         STH   R8,RESBKTOT        UPDATE AVAIL. CORE                    85945022
         L     R10,TOTMMSPC       GET SUB-TOTAL COUNT                   85946022
         A     R10,K1024          ADD 1K TO SUB TOTAL                   85947022
         ST    R10,TOTMMSPC       UPDATE SUB-TOTAL                      85948022
         B     COR24              MAKE ANOTHER  CHECK                   85949022
         DROP  R12                                                      85950022
*                                                                       85951022
COR32    EQU   *                  ENOUGH CORE - UPDATE SUB-TOTAL        85952022
*                                                                       85953022
         L     R12,TOTMMSPC       GET SUB TOTAL                         85954022
         A     R11,TOTUSCOR       UPDATE CORE IN USE BY THIS OLT S22024 85954300
         ST    R11,TOTUSCOR       REPLACE IT                     S22024 85954600
         SR    R12,R9             SUBTRACT MODULE SIZE                  85955022
         ST    R12,TOTMMSPC       REPLACE SUB TOTAL                     85956022
         B     COR16              RETURN                                85957022
*                                                                       85958022
CORERR   EQU   *   CORE NOT AVAILABLE                                   85959022
*                                                                       85960022
         DELETE DE=MODNAME        DELETE THE PLINK ROUTINE     @Y17XAUU 85960300
*                                 JUST LOADED                  @Y17XAUU 85960600
         LA    R15,NOCOR          SET NOT ENOUGH CORE RET. CODE         85961022
         LM    R8,R12,PLKSAVE1    RESTORE REG.                          85962022
         B     PLK050             EXIT                                  85963022
         EJECT                                                          85973022
         SPACE 2                                                        86000020
PATCH    DS    CL50               MAINTENANCE AREA.                     86500020
K1024    DC    F'1024'            VALUE OF 1K                  @Y17XAUU 86600000
K8192    DC    F'8192'            VALUE OF 8K                  @Y17XAUU 86700000
H4       DC    H'4'                     CONSTANT OF FOUR       @OY18053 86750010
PLKMSG   DS    0C                       START OF MSG           @OY18053 86800010
         DC    C'IED214I '              MSGID                  @OY18053 86850010
         DC    C'OLT SUB MODULE '       PART 1 OF MSG          @OY18053 86900010
PLKNAM   DC    8XL1'40'                 MODULE NAME            @OY18053 86950010
         DC    C' NOT FOUND IN LIBRARY'  PART 2 OF MSG         @OY18053 87000010
PLKMSGE  DS    0C                       END OF MSG             @OY18053 87050010
         SPACE                                                          87500022
START    DS    0F *************** DATA TO BE MOVE TO WORK AREA @Y17XAUU 87600000
QLDLLIST DS    0F                 BLDL P-LIST                  @Y17XAUU 87700000
         DC    XL2'0001'          NUMBER OF LIST ENTRIES                88700022
         DC    XL2'003A'          LENGTH OF EACH ENTRY                  89300022
QODNAME  DC    8XL1'40'           MODULE I. D.                 @Y17XAUU 89600000
         DC    XL16'0'            ADDITIONAL DIRECTORY INFO             90500022
QORENEED DC    XL3'0'             MAIN STORAGE NEEDED FOR MOD  @Y17XAUU 90800000
         DC    XL31'0'            ADDITIONAL DIRECTORY INFO             91700022
QLKLAST  DS    F                  SAVE AREA                    @Y17XAUU 91750000
QQNEXT   DS    F                  SAVE AREA                    @Y17XAUU 91800000
QQLAST   DS    F                  SAVE AREA                    @Y17XAUU 91850000
QLKSAVE1 DS    5F                 SAVE AREA 1                  @Y17XAUU 91900000
QLKSAVE2 DS    F                  SAVE AREA 2                  @Y17XAUU 91950000
QLKFLG1  DC    X'00'              CONTROL FLAG 1               @Y17XAUU 92000000
END      DS    0C *************** END OF DATA TO BE MOVE       @Y17XAUU 92050000
         SPACE 2                                                        95550022
PLNKPREF  DSECT                                                         95600022
PLNKNAME  DS    CL8                MODULE ID                            95650022
         DS    CL2                LEVEL                          S99528 95700022
PLNKMPTR DS    CL2                DISPLACEMENT TO QUEUE POINTERS        95750022
          SPACE 2                                                       95800022
PLNKQPTR DSECT                                                          95850022
PLNKQFWD  DS    F                  POINTER TO NEXT ELEMENT              95900022
PLNKQBKD DS    F                  POINTER TO LAST ELEMENT               95950022
         EJECT                                                          95960022
RESPL    RESPL EQUATES=YES                                              95970022
         EJECT                                                          96000020
         OLTCB                                                   S22024 96500000
BLDLLIST DS    0F                 BLDL PLIST                   @Y17XAUU 96500500
         DC    XL2'0001'          NUMBER OF LIST ENTRY         @Y17XAUU 96501000
         DC    XL2'003A'          LENGTH OF EACH ENTRY         @Y17XAUU 96501500
MODNAME  DC    8XL1'40'           MODULE ID                    @Y17XAUU 96502000
         DC    XL16'0'            ADDITIONAL DIRECTORY INFO    @Y17XAUU 96502500
CORENEED DC    XL3'0'             SIZE OF MODULE               @Y17XAUU 96503000
         DC    XL31'0'            ADDITIONAL DIRECTORY INFO    @Y17XAUU 96503500
PLKLAST  DS    F                  SAVE AREA                    @Y17XAUU 96504000
QNEXT    DS    F                  SAVE AREA                    @Y17XAUU 96504500
QLAST    DS    F                  SAVE AREA                    @Y17XAUU 96505000
PLKSAVE1 DS    5F                 SAVE AREA                    @Y17XAUU 96505500
PLKSAVE2 DS    F                  SAVE AREA                    @Y17XAUU 96506000
PLKFLG1  DC    X'00'              CONTROL FLAG                 @Y17XAUU 96506500
         SPACE                                                          96600022
MODINDX  EQU   TOTWKSPC                                                 96700022
MODINDXE EQU   TOTWKSPC+X'6E'                                           96800022
         END                                                            97000020
