         TITLE 'IEDQWS-WAITIO SERVICE ROUTINE'                          00090000
IEDQWS   CSECT                                                          00180000
*A000000-999999                                                @Y16X5U0 00270000
* CHANGE ACTIVITY AS FOLLOWS:                                    S22024 00360000
* THIS MODULE HAS BEEN RESEQUENCED AS OF TCAM 10.0             @Y17XAUU 00450000
* A004500,479700,483300,671400,675900,943200                   @G36XRUV 00470010
* C480600,484200                                               @G36XRUV 00490010
*                                                                       00510010
*********************************************************************** 00540000
* DESCRIPTIVE NAME: WAITIO SERVICE ROUTINE                       S22024 00630000
*                                                                S22024 00720000
* MODULE NAME: IEDQWS  ALIAS IEDQW36 (TCAM,TOTE)               @Y17XAUU 00810000
*                                                                S22024 00900000
* STATUS:  VERSION 10.0                                        @Y17XAUU 00990000
*                                                                     * 01080000
* FUNCTIONS:                                                          * 01170000
*                                                                     * 01260000
*       THE PURPOSE OF THIS ROUTINE IS TO CAUSE THE ON-LINE TEST      * 01350000
*       ROUTINE TO WAIT UNTIL THE INITIATED I/O EVENT HAS BEEN        * 01440000
*       COMPLETED, AT WHICH TIME THE FINAL CSW AND SENSE DATA         * 01530000
*       (IF UNIT CHECK) ARE STORED IN THE TECB.                       * 01620000
*                                                                     * 01710000
*        IF POLL IS REQUESTED A BRANCH TO IEDQWK IS ISSUED.  * @Y17XAUQ 01800000
*        IEDQWK SENDS THE MESSAGE ' MACRO FUNCTION NOT AVAIL'* @Y17XAUQ 01890000
*       TO THE CONTROL TERMINAL AND A X'04' RETURN CODE IS RETURNED   * 01980000
*       TO THE OLT.                                                   * 02070000
*                                                                     * 02160000
*       IF POLL IS NOT REQUESTED A WAIT TIME INTERVAL IS SET.  THE    * 02250000
*       MAIN ROUTINE THEN DETERMINES HOW MANY EVENTS MUST BE          * 02340000
*       COMPLETED BEFORE CONTINUING.  IF THE WAIT TIMES OUT, CONTROL  * 02430000
*       WILL BE RETURNED TO THE CALLING ROUTINE WITH AN ERROR         * 02520000
*       INDICATOR.                                                    * 02610000
*                                                                     * 02700000
*       AFTER THE WAIT TIME HAS ELAPSED, CONTROL IS PASSED TO THE     * 02790000
*       TIMER COMPLETION ROUTINE, WHICH DETERMINES IF THE             * 02880000
*       ECB HAS BEEN POSTED COMPLETE.  IF THE ECB HAS BEEN            * 02970000
*       POSTED COMPLETE, CONTROL IS RETURNED TO THE CALLING PRO-      * 03060000
*       GRAM.                                                         * 03150000
*                                                                     * 03240000
*        WAITIO OPERATION IF THE TEST DEVICE IS CONNECTED THRU   S22024 03330000
*        A 3705 RUNNING IN NATIVE MODE:                          S22024 03420000
*        1. WAIT AFTER A WRIGHT OPERATION-                       S22024 03510000
*              THE WRITE IS ASSUMED TO HAVE GONE CORRECTLY AND   S22024 03600000
*        CONTROL IS RETURNED TO THE OLTT.                        S22024 03690000
*        2. WAIT AFTER A READ OPERATION-                         S22024 03780000
*              ABUFFER WILL BE POSTED TO TOTE FROM TCAM WITH     S22024 03870000
*              THE EXPECTED DATA. AT THE TIME IEDQWS GETS THE    S22024 03960000
*              BUFFER IT WILL HAVE A TCAM BUFFER PREFIX AND THE  S22024 04050000
*              BTU WILL BE IN THE LCB. THE BTU AND THE DATA IN   S22024 04140000
*              THE BUFFER WILL BE MOVED INTO THE AREA POINTED    S22024 04230000
*              TO BY THE OLTT,S CCW STRUNG AS IF AN EXCP HAD     S22024 04320000
*              BEEN DONE.  THE ONLY THING POSTED IN THE TECB     S22024 04410000
*              WILL BE A COMPUTED RESIDULE COUNT WHICH WILL BE   S22024 04500000
*              THE DIFFERENCE BETWEEN THE TOTAL DATA EXPECTED    S22024 04590000
*              AND THE TOTAL DATA RECEIVED. THE BUFFER IS THEN   S22024 04680000
*              RETURNED TO TCAM AND CONTROL RETURNED TO THE      S22024 04770000
*              OLTT.                                             S22024 04860000
*                                                                S22024 04950000
*       AT THE COMPLETION OF THIS ROUTINE, ONE OF THE FOLLOWING       * 05040000
*       RETURN CODES IS PLACED IN REGISTER 15:                        * 05130000
*                                                                     * 05220000
*       X'00' - NORMAL COMPLETION OF WAITIO FUNCTION                  * 05310000
*                                                                     * 05400000
*       X'08' - THE WAIT TIMED OUT.                                   * 05490000
*                                                                     * 05580000
* PROCESSOR: ASSEMBLE XF                                       @Y17XAUU 05670000
*                                                              @Y17XAUU 05760000
* MODULE TYPE: PROCEDURE                                       @Y17XAUU 05850000
*                                                              @Y17XAUU 05940000
* LINKAGE: BALR REG14,REG15 FROM IEDQWA                        @Y17XAUU 06030000
*                                                              @Y17XAUU 06120000
* MODULE SIZE: SEE ASSEMBLER LISTING                           @Y17XAUU 06210000
*                                                              @Y17XAUU 06300000
* ENTRY POINT:                                                        * 06390000
*                                                                     * 06480000
*       IEDQWS - CALLED WHEN A WAITIO MACRO IS ISSUED BY AN           * 06570000
*       ON-LINE TEST ROUTINE.                                         * 06660000
*                                                                     * 06750000
* INPUT:        REGISTERS 01,02,13,14,15 CONTAIN THE FOLLOWING VALUES:* 06840000
*                                                                     * 06930000
*                         01-PARAMETER LIST ADDRESS                   * 07020000
*                         02-OLTCB POINTER                            * 07110000
*                         13-SAVE AREA ADDRESS                        * 07200000
*                         14-RETURN ADDRESS REGISTER                  * 07290000
*                         15-ENTRY POINT ADDRESS                      * 07380000
*                                                                     * 07470000
*                                                                     * 07560000
* OUTPUT:       REGISTERS 15 CONTAIN THE FOLLOWING VALUES:            * 07650000
*                                                                     * 07740000
*                         15-RETURN CODE:                             * 07830000
*                            X'00' NORMAL COMPLETION                  * 07920000
*                            X'08' TIMEOUT                            * 08010000
*                                                                     * 08100000
*                                                                     * 08190000
* EXTERNAL ROUTINE:                                                   * 08280000
*                                                                     * 08370000
*       IEDQWK - TO OUTPUT 'MACRO FUNCTION NOT AVAILABLE'             * 08460000
*       MESSAGE                                                       * 08550000
*                                                                     * 08640000
* EXIT POINTS:    BR AFTER 'NOPECB4'  TO IEDQWA                       * 08730000
*                                                                     * 08820000
* TABLES/WORK AREAS:                                                  * 08910000
*                                                                     * 09000000
*       OLTCB, IOBLOCKS, TECB, UCB                                    * 09090000
*                                                                     * 09180000
* ATTRIBUTES:                                                         * 09270000
*                                                                     * 09360000
*        ENABLED, PROBLEM PROGRAM MODE, RESIDENT, RE-ENTRANT*  @Y17XAUQ 09450000
*                                                                       09540000
* COPYRIGHT='NONE'                                               S22024 09630000
*                                                                S22024 09720000
* NOTES: SEE BELOW                                             @Y17XAUU 09810000
*                                                              @Y17XAUU 09900000
*  DEPENDENCIES: EBCDIC CHARACTER CODE                         @Y17XAUU 09990000
*                                                              @Y17XAUU 10080000
*  REGISTERS CONVENTION: SEE REGISTERS ASSIGNMENT              @Y17XAUU 10170000
*                                                              @Y17XAUU 10260000
*  PATCH LABEL: PATCH                                          @Y17XAUU 10350000
*                                                              @Y17XAUU 10440000
*  RESTRICTIONS: NONE                                          @Y17XAUU 10530000
*                                                              @Y17XAUU 10620000
*********************************************************************** 10710000
         SPACE 4                                                        10800000
         EJECT                                                          10890000
R0       EQU   0                       REG 0                     S99528 10980000
R1       EQU   1                       REG 1                     S99528 11070000
R2       EQU   2                       REG 2                     S99528 11160000
R3       EQU   3                       REG 3                     S99528 11250000
R4       EQU   4                       REG 4                     S99528 11340000
R5       EQU   5                       REG 5                     S99528 11430000
R6       EQU   6                       REG 6                     S99528 11520000
R7       EQU   7                       REG 7                     S99528 11610000
R8       EQU   8                       REG 8                     S99528 11700000
R9       EQU   9                       REG 9                     S99528 11790000
R10      EQU   10                      REG 10                    S99528 11880000
R11      EQU   11                      REG 11                    S99528 11970000
R12      EQU   12                      REG 12                    S99528 12060000
R13      EQU   13                      REG 13                    S99528 12150000
R14      EQU   14                      REG 14                    S99528 12240000
R15      EQU   15                      REG 15                    S99528 12330000
PARMREG0 EQU   R0                      MSG PARM0                 S99528 12420000
PARMREG1 EQU   R1                      MSG PARM1                 S99528 12510000
ZEROO    EQU   0                       ZERO                      S99528 12600000
ONE      EQU   1                       ONE                       S99528 12690000
FOUR     EQU   4                       DISPLACEMENT              S99528 12780000
TWO      EQU   2                       DISPLACEMENT              S99528 12870000
TWELVE   EQU   12                      DISPLACEMENT              S99528 12960000
X3F      EQU   X'3F'                   CLEAR FLAGS               S99528 13050000
XFF      EQU   X'FF'                   CLEAR FLAGS               S22024 13140000
CCM      EQU   X'30'                   CONDITION CODE MASK       S99528 13230000
CC3      EQU   X'30'                   CONDITION CODE MASK       S99528 13320000
ZEROZ    EQU   X'00'                   HEX ZERO                  S99528 13410000
XF0      EQU   X'F0'                   LOCAL ANR FLAG            S22024 13500000
START    EQU   X'0C'                   SVC 102 P LIST START      S22024 13590000
ANR      EQU   X'1E'                   ANR TEST                  S22024 13680000
X8       EQU   X'08'                   TIME OUT                  S22024 13770000
X80      EQU   X'80'                   SECOND ENTRY              S22024 13860000
D0       EQU   0                       ZERO                      S22024 13950000
D1       EQU   1                       ONE                       S22024 14040000
D2       EQU   2                       TWO                       S22024 14130000
D3       EQU   3                       THREE                     S22024 14220000
D4       EQU   4                       FOUR                      S22024 14310000
D5       EQU   5                       FIVE                      S22024 14400000
D8       EQU   8                       EIGHT                     S22024 14490000
D10      EQU   10                      TEN                       S22024 14580000
D14      EQU   14                      FOURTEEN                  S22024 14670000
TIC      EQU   X'08'                   COMMAND CODE TIC          S22024 14760000
DC       EQU   X'80'                   DATA CHAIN                S22024 14850000
READ     EQU   X'02'                   READ CCW                  S22024 14940000
BUFFEND  EQU   X'00'                   DUMMY END CHECK           S22024 15030000
DISREG2  EQU   28                      DISPLACEMENT TO REG 2   @Y17XAUU 15120000
         EJECT                                                          15210000
         USING IEDQWS,R15              FOR BR AROUND HJN         S99528 15300000
IEDQWS   IEDHJN IEDQWSS,HJN            NAME AND HJN              S99528 15390000
         DROP  R15                                                      15480000
         USING IEDQWS,R4                                                15570000
         USING TOTOLTCB,R2             TOTE CONTROL BLOCK        S22024 15660000
         USING TTECB,R5                                                 15750000
         USING IOBLOCKS,R7                                              15840000
*                                                                       15930000
* S T A N D A R D  L I N K A G E * * *                                  16020000
*                                                                       16110000
         STM   R14,R12,12(R13)    SAVE CALLER'S REG                     16200000
         LR    R4,R15             ESTABLISH BASE REG                    16290000
         ST    R13,TOTSAVE1+D4         SAVE CALLER SAVE ADDR     S22024 16380000
         LR    R12,R13            SAVE IT HERE TOO                      16470000
         LA    R13,TOTSAVE1            MY SAVE ADDRESS           S22024 16560000
         ST    R13,8(R12)         SAVE ADDR OF MY SAVE IN HIS SAVE      16650000
*                                                                       16740000
*                                                                       16830000
         NI    TOTFLG07,X'FF'-TOTPRIEX CLEAR                     S99528 16920000
         NI    TOTFLG07,X'FF'-TOTSECEX WAITIO FLASG              S99528 17010000
         ST    R1,@PARM1               SAVE PARM ADDRESS         S99528 17100000
         LA    R3,12(R1)               GET FLAGS                 S99528 17190000
         TM    0(R3),X'1F'             REQUEST FOR UNSUPPORED FUNCTION? 17280000
         BC    5,NOPECB4               YES BRANCH                S99528 17370000
         L     R5,4(R1)                TECB ADDR                 S99528 17460000
         LTR   R5,R5                   VALIV                     S99528 17550000
         BZ    PRIMARIE                NO BR                     S99528 17640000
         USING WAITIO,R1               PARM LIST                 S99528 17730000
         CLC   WIOCDS,ZEROADDR         CDS ADDRESS PRESENT       S99528 17820000
         BE    PRIMARIE                NO BRANCH                 S99528 17910000
         L     R6,WIOCDS               GET CDS ADDRESS           S99528 18000000
         TM    TOTTDTBL,TOTTDORN       TEST DEV ON RN            S22024 18090000
         BO    SYMNAME                 YES BRANCH                S22024 18180000
         TM    TOTTDTBL,TOTTDTRM       TEST DEVICE TERMINAL      S99528 18270000
         BZ    LINETEST                NO BRANCH                 S99528 18360000
SYMNAME  EQU   *                                                 S22024 18450000
         SR    R8,R8                   CLEAR REG                 S99528 18540000
         IC    R8,TOTTTBEL             GET LENGTH OF NAME        S99528 18630000
         BCTR    R8,ZEROO              DECREMENT FOR COMPARE     S99528 18720000
         L     R7,TOTTNTPR             GET TNT ADDR PRIMARYE     S99528 18810000
         EX    R8,COMPARE              COMPARE NAMES             S99528 18900000
         BE    PRIMARIE                IF SAME BRANCH            S99528 18990000
         L     R7,TOTSRTNT             GET TNT ADDR SECONDARY    S99528 19080000
         EX    R8,COMPARE              COMPARE NAMES        Y    S99528 19170000
         BE    SECONDAY                IF SAME BRANCH            S99528 19260000
         B     ERRCON                  DEVICE NOT PRI OR SEC     S99528 19350000
LINETEST LH    R7,TOTPRUCB             GET PRIMARY UCB ADDRESS   S99528 19440000
         MVC   UCBAREA,FOUR(R7)        GET UNIT NAME             S99528 19530000
         NI    UCBAREA,X3F             CLEAR HI NIBBLE           S99528 19620000
         CLC   UCBAREA,TWO(R6)         PRIMARY WAIT              S99528 19710000
         BE    PRIMARIE                YES RRANCH                S99528 19800000
         LH    R7,TOTSCUCB             SECONDARY UCB ADDR        S99528 19890000
         MVC   UCBAREA,FOUR(R7)        GET NNIT ADDRESSDR        S99528 19980000
         NI    UCBAREA,X3F             CLEAR HI NIBBLE           S99528 20070000
         CLC   UCBAREA,TWO(R6)         SECONDARY WAIT            S99528 20160000
         BE    SECONDAY                YES BRANCH                S99528 20250000
         B     ERRCON                  DEVICE NOT PRI OR SEC     S99528 20340000
         DROP  R1                      WAITIO                    S99528 20430000
SECONDAY LA    R7,TOTSCIBK             SECONDARY ADDRESSIBILITY  S99528 20520000
         OI    TOTFLG07,TOTSECEX       WAIT FOR SECONDARY        S99528 20610000
**                                     BLOCKS                           20700000
         B     UCBADDR                 BRANCH                           20790000
ERRCON   MVI   TOTRTCOD,X'0C'          SET RETURN CODE                  20880000
         B     NOPECB4                 BRANCH                           20970000
PRIMARIE EQU   *                                                        21060000
         LA    R7,TOTPRIBK             GET ADDRESS OF PRIMARY CONTROL   21150000
         OI    TOTFLG07,TOTPRIEX       WAIT FOR PRIMARY          S99528 21240000
UCBADDR  EQU   *                                                        21330000
         LTR   R5,R5                   TECB ADDRESS ZERO         S22024 21420000
         BZ    STALL                   IF SO JUST WAIT           S22024 21510000
         TM    $TOTFLG1,$TDATBLK       TEST DEVICE ON RN         S22024 21600000
         BO    RNTEST                  YES RR                    S22024 21690000
WAITIOE  EQU   *                       WAIT ENTRY 270X           S22024 21780000
         USING IOBLOCKS,R7                                              21870000
         L     R10,OLTUCBA             GET UCB ADDRESS                  21960000
         SRL   R10,16                  UCB ADDRESS               S99528 22050000
         LTR   R10,R10                 IS THERE ONE                     22140000
         BZ    ERRCON                  NO BRANCH                        22230000
         LTR   R5,R5                   TECB ADDRESS              S99528 22320000
         BP    PURTST                  YES BRANCH                S99528 22410000
STALL    OI    TOTFLG05,TOTTMOUT       FOURCE TIMEOUT            S22024 22500000
         XC    ECBOLT,ECBOLT           CLEAR ECB                 S99528 22590000
PURTST   TM    0(R3),X'20'             PURGE REQUEST             S99528 22680000
         BO    PURGE                   YES BRANCH                       22770000
**       IF POLL REQUEST BRANCH TO POLL ROUTINE                         22860000
RNPOLL   EQU   *                       ENTRY FOR 3705 POLL REQ   S22024 22950000
         TM    0(R3),X'40'             POLL REQUESTED?                  23040000
         BO    POLLREQ                 YES BRANCH                S99528 23130000
**       ASSUME WAIT=YES                                                23220000
         SPACE 4                                                        23310000
*                                                                       23400000
* S E T  I N T E R V A L  T I M E R  F O R  W A I T                     23490000
*                                                                       23580000
NOPOLL   L     R9,0(R3)           GET TIME INTERVAL                     23670000
         LA    R8,0               CLEAR WORK REG                        23760000
         SLL   R9,8                    CLEAR HI BYTE             S99528 23850000
         SRL   R9,16                             BYTES TO ZEROS         23940000
         D     R8,SIXTY           CONVERT TIME TO MINUTES AND SECONDS   24030000
         CVD   R8,SECON           CONVERT THE SECONDS TO DECIMAL        24120000
         CVD   R9,MINUTE          CONVERT THE MINUTES TO DECIMAL        24210000
         UNPK  SPACE(3),MINUTE+6(2)    UNPACK MINUTES                   24300000
         OI    SPACE+2,X'F0'      GET RID OF SIGN                       24390000
         MVC   TOTWAITI+2(2),SPACE+1   MOVE TO WAIT PARM                24480000
         UNPK  SPACE(3),SECON+6(2)     UNPACK SECONDS                   24570000
         OI    SPACE+2,X'F0'           CLEAR SIGN                       24660000
         MVC   TOTWAITI+4(2),SPACE+1   MOVE TO WAIT PARM                24750000
         LH    R8,ZERO                 GET HEX ZERO                     24840000
         STH   R8,TOTWAITI             PAD THE                          24930000
         STH   R8,TOTWAITI+6           OUTER FOUR BYTES                 25020000
         ST    R2,TOLTCBA              SAVE OLTCB ADDRESS               25110000
         ST    R7,TOLTCBB              SAVE ADDR FOR POST      @Y17XAUQ 25200000
         MVC   TIMEAREA(TIMEITLG),TIMEIT  MOVE EXIT CODE TO    @Y17XAUQ 25290000
*                                         OLTCB(NON RE ENTRANT)@Y17XAUQ 25380000
*                                                                       25470000
         STIMER REAL,TIMEAREA,DINTVL=TOTWAITI ISSUE TIMER MACRO@Y17XAUQ 25560000
*                                                              @Y17XAUQ 25650000
         LA    R6,ECBOLT               GET ADDRESS OF ECB               25740000
         ST    R6,TOTWECBA             STORE IN P-LIST                  25830000
         LTR   R5,R5                   TECB ADDRESS ZERO         S22024 25920000
         BZ    WAIT                    YES BRANCH                S22024 26010000
         B     PRIM                    BRANCH                           26100000
         SPACE 2                                                        26190000
*                                * * *                                  26280000
TTOUT    MVI   TOTRTCOD,X8             SET TIMEOUT TR CODE       S22024 26370000
         LTR   R5,R5                   TECB ADDRESS ZERO         S22024 26460000
         BZ    STALLOUT                YES BRANCH                S22024 26550000
         TM    $TOTFLG1,$TDATBLK       TEST DEVICE ON RN         S22024 26640000
         BO    RNTMOUT                 YES BRANCH                S22024 26730000
         CLI   IOBSIOCD,CC3            CC EQUAL 3                S99528 26820000
         BE    CC3BR                   YES BRANCH                S99528 26910000
         B     TOUTREST                BRANCH                    S22024 27000000
RNTMOUT  NI    TOTFLG05,X'FF'-TOTTMOUT CLEAR TIMEOUT FLAG        S22024 27090000
STALLOUT EQU   *                                                 S22024 27180000
         XC    ECBOLT,ECBOLT           CLEAR ECB                 S22024 27270000
         B     OUT                     RETURN                    S22024 27360000
*                                                                       27450000
*                                                                       27540000
* W A I T  F O R  P R I M A R Y  O N L Y  E N T R A N C E               27630000
*                                                                       27720000
PRIM     NI    IOBSIOCD,CCM            CLEAR ALL BUT CC          S99528 27810000
         CLI   IOBSIOCD,CC3            CC EQUAL 3                S99528 27900000
         BE    TIMEND                  YES BRANCH                S99528 27990000
         TM    $TOTFLG1,$TDATBLK       TEST DEVICE ON RN         S22024 28080000
         BO    QCHECK                  YES BRANCH                S22024 28170000
WAIT     EQU   *                                                 S22024 28260000
         WAIT  1,ECB=ECBOLT            EXIO COMPLETE             S99528 28350000
TIMEND  TTIMER CANCEL                                                   28440000
         TM    TOTFLG05,TOTTMOUT       DID WAIT TIME OUT         S22024 28530000
         BO    TTOUT              YES - EXIT                            28620000
         TM    $TOTFLG1,$TDATBLK       TEST DEVICE ON RN         S22024 28710000
         BO    RNREAD                  YES BRANCH                S22024 28800000
CC3BR    MVI   TOTRTCOD,ZEROZ          SET NORMALE RT CODE       S22024 28890000
TOUTREST EQU   *                                                 S22024 28980000
         L     R10,OLTUCBA             GET UCB ADDRESS                  29070000
         SRL   R10,16                  UCB ADDRESS               S99528 29160000
         BAL   R14,PRESULT             EXIT TO REPORT RESULTS           29250000
NOPECB4  EQU   *                                                        29340000
         TM    TOTFLG07,TOTPRIEX       PRIMARY DEVICE            S99528 29430000
         BZ    SECTEST                 NO BRANCH                 S99528 29520000
         LA    R1,ONE                  PRIMARY PARM              S99528 29610000
         BAL   R12,TOTUCB00            TEST UNALLOCATE           S99528 29700000
         B     OUT                     RETURN                    S99528 29790000
SECTEST  TM    TOTFLG07,TOTSECEX       SECONDARY DEVICE          S99528 29880000
         BZ    OUT                     NO RRANCH                 S99528 29970000
         LA    R1,TWO                  SECONDARY RARP            S99528 30060000
         BAL   R12,TOTUCB00            TEST UNALLOCATE           S99528 30150000
OUT      EQU   *                       UNALLOCATE RETURN         S99528 30240000
         NI    TOTFLG05,XFF-TOTTMOUT   CLEAR TIMEOUT FLG         S22024 30330000
         L     R13,4(R13)         GET CALLER'S SAVE ADR                 30420000
         L     R14,12(R13)        GET RETURN ADDRESS                    30510000
         SR    R15,R15                                                  30600000
         IC    R15,TOTRTCOD            GET RETURN CODE           S22024 30690000
         TM    $OLTFLGS,$TRACE         TRACN FUNCTION            S99528 30780000
         BO    M2                      YES BRANCH                S99528 30870000
         TM    $RETMASK,X'FF'          RETURN FUNCTION           S99528 30960000
         BZ    RETURN                  NO BRANCH                 S99528 31050000
         CLI   TOTRTCOD,0              RETURN CODE ZERO          S99528 31140000
         BNE   M2                      NO BRANCH                 S99528 31230000
RETURN   EQU   *                                                 S99528 31320000
         LM    R0,R12,20(R13)     RESTORE REMAINING REGS                31410000
         BR    R14                RETURN TO CALLER'S PROG               31500000
*                                                                       31590000
* F U N C T I O N  N O T  S U P P O R T E D                             31680000
*                                                                       31770000
M2       EQU   *                                                 S99528 31860000
         USING RESPL,R5           ESTAB ADDRESSABILITY         @Y17XAUQ 31950000
         L     R5,TOTRESPL        GET ADDR OF RESPL            @Y17XAUQ 32040000
         L     R15,RESPLM2        GET ADDR OF IEDQWM2          @Y17XAUQ 32130000
         LM    R2,R12,DISREG2(R13) RESTORE CALLER'S REG        @Y17XAUN 32220000
         BR    R15                GO TO IEDQWM2                @Y17XAUQ 32310000
         DROP  R5                 FREE REG                     @Y17XAUQ 32400000
QCHECK   EQU   *                                                 S22024 32490000
         L     R3,OLTBUFA              GET POINTER TO BUFFER     S22024 32580000
         LTR   R3,R3                   IS THERE ONE              S22024 32670000
         BZ    WAIT                    NO BRANCH                 S22024 32760000
         CLI   D0(R3),BUFFEND          IS THIS THE DUMMY END     S22024 32850000
         BE    WAIT                    YES BRANCH                S22024 32940000
         B     TIMEND                  GO PROSSES BUFFER         S22024 33030000
*                                                                     * 33120000
**   THIS ROUTINE GETS THE RESULT OF THE I/O OPERATION AND PASSES    ** 33210000
**   THE RESULTS TO THE OLT                                          ** 33300000
*                                                                     * 33390000
PRESULT  EQU   *                                                        33480000
         NI    IOBFLG4,X'FF'-IOBCSWNV  TURN OFF NOT VALID FLAG   S99528 33570000
         USING TTECB,R5                TECB ADDRESSABILITY       S99528 33660000
         SR    R8,R8                   CLEAR REG                 S99528 33750000
         IC    R8,TECBFDCT             GET NUMBER OF EVENT BLOCKSS99528 33840000
         SR    R3,R3                   CLEAR REG                 S99528 33930000
         IC    R3,TECBEVOC             NUMBER OF EVENTS OCCURRED S99528 34020000
         CR    R3,R8                   COMPARE NUMBER USED WITH  S99528 34110000
*                                      NUMBER OF BLOCKS          S99528 34200000
         BL    NXTENT                  IF ANY LEFT GO FIND IT    S99528 34290000
NONELEFT LA    R3,1(R3)                ADD ONE TO EVENTS OCCURREDS99528 34380000
         STC   R3,TECBEVOC             STORE IN TECB             S99528 34470000
CLEARECB XC    ECBOLT,ECBOLT           CLEAR ECB                 S99528 34560000
         TM    TOTFLG05,TOTTMOUT       TIME OUT OCCURE           S22024 34650000
         BO    RESLTND                 YES BRANCH                S22024 34740000
         TM    IOBFLG4,IOBCSWNV        NOT VALID SET             S99528 34830000
         BO    PRESULT                 YES BRANCH                S99528 34920000
RESLTND  EQU   *                                                 S22024 35010000
         B     0(R14)                  RETURN                    S99528 35100000
***      FIND NEXT AVAILABLE EVENT ENTRY                                35190000
NXTENT   EQU   *                       NEXT EVENT ENTRY          S99528 35280000
         SR    R11,R11                 CLEAR REG                 S99528 35370000
         IC    R11,TECBFDLN            GET LENGTH OF FIELD       S99528 35460000
         MR    R10,R3                  LENGTH OF ALL EVENT BLOCKS 99528 35550000
         LA    R11,8(R11)              ADD LENGTH OF FIXED AREA   99528 35640000
         LR    R10,R5                  GET TECB ADDRESS           99528 35730000
         AR    R10,R11                 POINT TO FIRST FREE EVENT  99528 35820000
*                                      BLOCK                      99528 35910000
         TM    $TOTFLG1,$TDATBLK       TEST DEVICE ON RN         S22024 36000000
         BO    RESAVE                  GO TO SAVE RESIDULE COUNT S22024 36090000
         IC    R6,IOBSIOCD             GET CC                    S99528 36180000
         SLL   R6,26                   CLEAR ALL                 S99528 36270000
         SRL   R6,30                   OUT BUT C C               S99528 36360000
         STC   R6,IOBSIOCD             RETURN TO IOB             S99528 36450000
         MVC   0(1,R10),IOBSIOCD       MOVE CONDITION CODE FROM  S99528 36540000
*                                      IOB                       S99528 36630000
         OI    0(R10),X'F0'            CONVERT TO EBCDIC         S99528 36720000
         L     R1,OLTUCBA              GET UCB ADDRESS           S99528 36810000
         SRL   R1,16                   UCB ADDRESS               S99528 36900000
         USING UCB,R1                  UCB ADDRESSIBILITY        S99528 36990000
         MVC   2(2,R10),UCBCHA         MOVE IN I/O ADDRESS       S99528 37080000
         CLI   IOBSIOCD,X'00'          CONDITION CODE EQ 0       S99528 37170000
         BE    ZEROCC                  YES BRANCH                S99528 37260000
         CLI   IOBSIOCD,X'01'          CONDITION CODE EQ 1       S99528 37350000
         BE    ONECC                   YES BRANCH                S99528 37440000
***                                    ASSUME CONDITION CODE 3   S99528 37530000
NOUSEDEV LA    R3,1(R3)                BUMP NUMBER OF BLOCKS USEDS99528 37620000
CONTSAVE STC   R3,TECBEVOC             SAVE EVENTS USED COUNT    S99528 37710000
         B     UNITCKTS                GO CHECK FOR UNIT CK      S99528 37800000
RESAVE   STH   R9,D10(R10)             POST REDISULE COUNT       S22024 37890000
         B     NOUSEDEV                GO BUMP EVENT BLOXKS USED S22024 37980000
ONECC    EQU   *                                                 S99528 38070000
         TM    IOBFLG4,IOBCSWV         SECOND CSW VALID          S99528 38160000
         BZ    MOVECSW                 NO BRANCH                 S99528 38250000
         NI    IOBFLG4,X'FF'-IOBCSWV   TURN OFF FLAG             S99528 38340000
         OI    IOBFLG4,IOBCSWNV        TURN ON NOT VALID         S99528 38430000
         MVC   5(7,R10),IOBCSWS        CSW TO TECB               S99528 38520000
         B     NOUSEDEV                BRANCH                    S99528 38610000
MOVECSW  MVC   5(7,R10),IOBCSW1        MOVE CSW TO EVENT BLK     S99528 38700000
         B     NOUSEDEV                BUMP NUMBER EVENTS USED   S99528 38790000
ZEROCC   EQU   *                                                 S99528 38880000
         TM    OLTFLAG2,OLTLV3IO       WAS EXIO LEVEL 3          S99528 38970000
         BO    LEVEL3                  YES BRANCH                S99528 39060000
         OI    0(R10),X'FF'            SET CC TO FF              S99528 39150000
         B     ONECC                   GO MOVE CSW               S99528 39240000
LEVEL3   EQU   *                                                 S99528 39330000
         LA    R3,1(R3)                BUMP NUMBER EVENTS USED   S99528 39420000
         CR    R3,R8                   ANY BLOCKS LEFT           S99528 39510000
         BE    NONELEFT                NO BRANCH                 S99528 39600000
         IC    R11,TECBFDLN            GET FIELD LENGTH          S99528 39690000
         AR    R10,R11                 POINT TO NEXT FIELD ENTRY S99528 39780000
         OI    0(R10),X'FF'            SET CC TO FF CC OF 0      S99528 39870000
         USING UCB,R1                  UCB                       S99528 39960000
         MVC   2(2,R10),UCBCHA         MOVE IN I/O ADDRESS       S99528 40050000
         MVC   5(7,R10),IOBCSW1        MOVE CSW TO EVENT BLOCK   S99528 40140000
         B     CONTSAVE                GO SAVE COUNT             S99528 40230000
UNITCKTS EQU   *                                                 S99528 40320000
         TM    IOBCSW+4,X'02'          UNIT CK IN CSW            S99528 40410000
         BZ    CLEARECB                NO BRANCH                 S99528 40500000
         IC    R11,TECBFDLN            GET EVENT LENGTH          S99528 40590000
         MR    R10,R8                  LENGTH OF ALL EVENT BLOCKSS99528 40680000
         LA    R11,8(R11)              ADD LENGTH OF FIXED AREA  S99528 40770000
         LR    R10,R5                  GET TECB ADDRESS          S99528 40860000
         AR    R10,R11                 POINT TO FIRST SENSE BLOCKS99528 40950000
***                                    SENSE FIND                S99528 41040000
         IC    R3,TECBSNOC             NUMBER OF USED SENSE BLOCKS99528 41130000
         IC    R11,TECBSNCT            NUMBER OF SENSE BLOCKS    S99528 41220000
         CR    R3,R11                  ALL USED                  S99528 41310000
         BNL   BUMPSNOC                YES BRANCH                S99528 41400000
         LH    R9,TECBSNLN             SIZE OF SENSE FIELD       S99528 41490000
         MR    R8,R3                   SENSE SIZE TIMES NUMBER   S99528 41580000
*                                      USED                      S99528 41670000
         AR    R9,R10                  ADD ADDR OF FIRST SENSE   S99528 41760000
         LH    R11,TECBSNLN            SIZE OF SENSE FIELD       S99528 41850000
         MVC   1(2,R9),UCBCHA          MOVE IN I/O ADDRESS       S99528 41940000
         L     R12,SENSELN             SENSE LENGTH COMPUTE      S99528 42030000
         SR    R11,R12                 FIND LENGTH OF SENSE TO MVS99528 42120000
         EX    R11,SENSEMOV            GO MOVE SENSE             S99528 42210000
BUMPSNOC LA    R3,1(R3)                BUMP NUMBER OF USED SENSE S99528 42300000
*                                      BLOCKS                    S99528 42390000
         B     CLEARECB                BRANCH                    S99528 42480000
SENSEMOV MVC   3(0,R9),UCBSNS          MOVE UCB SENSE            S22024 42570000
***                                                              S99528 42660000
***                                    PURGE ROUTINE             S99528 42750000
***                                                              S99528 42840000
PURGE    EQU   *                       PURGE ROUTINE             S99528 42930000
         XC    QVPRGLST(PLISTLEN),QVPRGLST  CLEAR PARM LIST    @Y17XAUQ 43020000
         MVI   QVPVRFLG,PRGFLAG             MOVE IN PURGE FLAG @Y17XAUQ 43110000
         MVI   QVPDEBNO,PLSTDEB#            MOVE IN DEB NUMBER @Y17XAUQ 43200000
         MVC   QVPRGDEB+1(3),OLTDEBA+1 MOVE DEB ADDR TO P-LIST   S99528 43290000
         LA    R1,IOB                  GET IOB ADDRESS           S99528 43380000
         ST    R1,QVPRGIOB             STORE IN P-LIST           S99528 43470000
         LA    R1,QVPRGLST             GET P-LIST ADDRESS        S99528 43560000
         SVC   PURGEE                  SVC FOR PURGE             S99528 43650000
         MVI   TOTRTCOD,X'00'          SET RETURN CODE           S99528 43740000
         B     NOPECB4                 RETURN                    S99528 43830000
***                                                              S99528 43920000
***                                    POLL ROUTINE              S99528 44010000
***                                                              S99528 44100000
POLLREQ  EQU   *                       POLL REQUEST ENTRY        S99528 44190000
         TM    ECBOLT,X'80'            IS EVENT COMPLETE         S99528 44280000
         BO    EIGHTCD                 NO BRANCH                 S99528 44370000
         TM    $TOTFLG1,$TDATBLK       TEST DEVICE ON RN         S22024 44460000
         BO    RNREAD                  YES BRANCH                S22024 44550000
         BAL   R14,PRESULT             GO REPORT RESULTS         S99528 44640000
         MVI   TOTRTCOD,X'00'          SET RETURN CODE           S99528 44730000
         B     NOPECB4                 RETURN                    S99528 44820000
EIGHTCD  MVI   TOTRTCOD,X'08'          SET RETURN CODE           S99528 44910000
         B     NOPECB4                 RETURN                    S99528 45000000
**************************************************************** S99528 45090000
*                                                              * S99528 45180000
*        THIS BLOCK OF CODE IS USED TO TURN OFF THE OLTEP      * S99528 45270000
*        FLAG IN THE UCB.  THIS FLAG 'UCBNALOC' NORMALLY MEANS * S99528 45360000
*        THAT THE DEVICE IS NOT TO BE ALLOCATED.  IT IS SET BY * S99528 45450000
*        BY TOTE OR OLTEP TO ALLOW THE DEVICE TO REMAIN NOT    * S99528 45540000
*        ALLOCATED WHILE TESTING IS IN PROGRESS.               * S99528 45630000
*                                                              * S99528 45720000
*        THIS SETTING DISABLES  THE 'GRAPHIC TRAP CODE' TO     * S99528 45810000
*        ALLOW IOS TO HANDLE THE IBM 3270 IN A MANNER ACCEPT-  * S99528 45900000
*        ABLE TO THE ON-LINE TESTS.                            * S99528 45990000
*                                                              * S99528 46080000
*        THIS CODE WILL TURN THE BIT OFF IF AND ONLY IF        * S99528 46170000
*        IT IS A GRAPHIC DEVICE.'DEVICE CLASS = X'10'.         * S99528 46260000
*                                                              * S99528 46350000
*        THE FOLLOWING INPUTS ARE ASSUMED:                     * S99528 46440000
*                                                              * S99528 46530000
*              R2 = ADDRESS OF OLTCB                           * S99528 46620000
*              R4 = BASE REGISTER                              * S99528 46710000
*              R1 = 1 IF PRIMARY   UCB IS TO BE ALTERED        * S99528 46800000
*                 = 2 IF SECONDARY UCB IS TO BE ALTERED        * S99528 46890000
*                                                              * S99528 46980000
**************************************************************** S99528 47070000
TOTUCB00 DS    0H                  ENTRY POINT                   S99528 47160000
         STM   R5,R9,TOTUCBAA      SAVE REGISTERS                S99528 47250000
         SR    R5,R5               CLEAR REGISTER                S99528 47340000
         LA    R5,TUCBONE(R5)      SET UP FOR COMPARE            S99528 47430000
         CR    R5,R1               SHOULD PRIMARY UCB BE USED ?  S99528 47520000
         BE    TOTUCB01            YES  BRANCH                   S99528 47610000
         LA    R5,TUCBONE(R5)      BUMP REG TO TWO               S99528 47700000
         CR    R5,R1               SHOULD SECONDARY UCB BE USED  S99528 47790000
         BE    TOTUCB02            YES  BRANCH                   S99528 47880000
TOTUCB01 DS    0H                                                S99528 47970000
         SLR   R5,R5              CLEAR                        @G36XRUV 48010010
         ICM   R5,3,TOTPRUCB       SET UP TO ALTER PRIMARY UCB @G36XRUV 48060010
         B     TOTUCB03                PRIMARY UCB               S99528 48150000
*                                                                S99528 48240000
TOTUCB02 DS    0H                                                S99528 48330000
         SLR   R5,R5              CLEAR                        @G36XRUV 48370010
         ICM   R5,3,TOTSCUCB      SET UP TO ALTER SECONDARY UCB@G36XRUV 48420010
*                                                                S99528 48510000
TOTUCB03 DS    0H                                                S99528 48600000
         LA    R1,TOTUCBAB        GET DATA ADDRESS             @Y17XAUQ 48690000
         ST    R1,TOT102A         PUT IN PARAMTER LIST         @Y17XAUQ 48780000
         MVI   TOT102A,TOTDATMV   INDICATE THIS IS A DATA MOVE @Y17XAUQ 48870000
         LA    R1,TOTDTMVL        GET LENGTH OF MOVE           @Y17XAUQ 48960000
         STH   R1,TOTUCBAC        PUT LENGTH IN HOLD AREA      @Y17XAUQ 49050000
         LA    R1,TOTUCBAC        GET ADDRESS OF HOLD AREA     @Y17XAUQ 49140000
         ST    R1,TOT102E         PUT IT IN PARAMTER LIST      @Y17XAUQ 49230000
         MVI   TOT102E,TOTLTWFG   MOVE IN LAST WORD INDICATION @Y17XAUQ 49320000
         MVI   TOT102C,TOT2WFLG   MOVE IN 2ND WORD FLAG        @Y17XAUQ 49410000
         MVC   TOTUCBAB(LEN1),ZEROO(R5) UCB TO WORK AREA         S99528 49500000
         CLI   TOTUCBAB+TUCBCLOS,TUCBCLAS IS IT A GRAPHIC CLASS  S99528 49590000
         BNE   TOTUCB04                   NO  RETURN             S99528 49680000
*                                         YES TURN OFF UCBNALOC  S99528 49770000
*                                         IN UCB IN WORK AREA    S99528 49860000
         NI    TOTUCBAB+TUCBNALO,TUCBNALC AND OFF UCBNALOC BIT   S99528 49950000
         STH   R5,TOT102D+TUCBONE         STORE UCB ADDRESS IN @Y17XAUQ 50040000
*                                         TARGET ADDRESS         S99528 50130000
*                                                                S99528 50220000
         LA    R1,TOT102           LOAD R1 TO POINT TO PARAM LISTS99528 50310000
*                                                                S99528 50400000
         AQCTL                     ISSUE DATA MOVE SVC           S99528 50490000
TOTUCB04 DS    0H                                                S99528 50580000
         LM    R5,R9,TOTUCBAA          RESTORE REGS              S99528 50670000
         BR    R12                     RETURN                    S99528 50760000
         EJECT                                                          50850000
RNTEST   EQU   *                       WAIT FOR DEVICE ON RN     S22024 50940000
         L     R10,OLTCCWA             GET FIRST CCW ADDRESS     S22024 51030000
         USING CCW,R10                 CCW                       S22024 51120000
         CLI   COMMCODE,READ           WAIT FOR READ             S22024 51210000
         BE    RNPOLL                  YES BRANCH                S22024 51300000
         DROP  R10                     CCW                       S22024 51390000
         MVI   TOTRTCOD,ZEROZ          CLEAR RETURN CODE         S22024 51480000
         B     OUT                     GO RETURN                 S22024 51570000
         EJECT                                                          51660000
RNREAD   EQU   *                       WAIT AFTER RN READ        S22024 51750000
*                                                               *S22024 51840000
*        THE FUNCTION OF THIS ROUTINE IS TO MOVE THE DATA FROM  *S22024 51930000
*        TCAM BUFFERS AND UNITS TO THE AREA POINTED TO BY THE   *S22024 52020000
*        OLT CCW AND FREE THE BUFFERS                           *S22024 52110000
*                                                               *S22024 52200000
         SR    R1,R1                   CLEAR R1 FOR  UNIT COUNT  S22024 52290000
         L     R3,OLTBUFA              GET BUFFER ADDRESS        S22024 52380000
         LTR   R3,R3                   IS THERE A BUFFER ADDRESS Y06330 52470000
         BZ    OUT                     NO, EXIT                  Y06330 52560000
         USING CCW,R10                 CCW DESECT                S22024 52650000
         L     R8,COMMADDR-1           GET COMMAND ADDRESS       S22024 52740000
         LH    R6,BYTECNT              GET BYTE COUNT IN CCW     S22024 52830000
         SR    R9,R9                                           @Y17XAUQ 52920000
         LA    R9,OLLTTHLG+OLLTRHLG    GET LENGTH OF TRNAS NDR @Y17XAUQ 53010000
*                                      PLUS REQ/REST HEADER    @Y17XAUQ 53100000
         SR    R6,R9             SUBTRACT TH+RH LENGTH CCW CNT @Y17XAUQ 53190000
         AR    R8,R9              ADD TH+RH LENGTH TO DATA PTR @Y17XAUQ 53280000
         L     R9,TOTAVTPT             GET AVT ADDRESS           S22024 53370000
         USING IEDQAVTD,R9             AVT                       S22024 53460000
         LA    R1,AVTHDRSZ       GET HEADER BUFFER PREFIX(AVT) @Y17XAUU 53550000
         STC   R1,PRFXSIZE        STORE IT IN SAVE AREA        @Y17XAUQ 53640000
         LH    R9,AVTKEYLE             GET UNIT SIZE             S22024 53730000
         DROP  R9                                              @YM08168 53820000
         STH   R9,UNITSIZE             SAVE UNIT SIZE            S22024 53910000
         L     R9,TOTAVTPT        RE LOAD AVT POINTER          @Y17XAUQ 54000000
         USING IEDQAVTD,R9        AVT                          @YM08168 54090000
         L     R9,AVTSAVTP        GET ADDR OF SAVT             @Y17XAUQ 54180000
         DROP  R9                 FREE REG                     @Y17XAUQ 54270000
         USING IEDNSVTD,R9        ESTAB ADDRABILITY TO SAVT    @Y17XAUQ 54360000
         L     R15,SAVTTNTX       GET ADDR OF TTCIN-NA ROUTINE @Y17XAUQ 54450000
         ST    R15,TOTTNTX        SAVE ROUTINE ADDRESS         @Y17XAUU 54540000
         DROP  R9                      AVT                       S22024 54630000
         USING IEDQPRF,R3                                      @Y17XAUQ 54720000
         LH    R1,PRFSCAN         OFFSET TO DATA               @YM08168 54810000
         SLR   R14,R14            CLEAR REG                    @YM08168 54900000
         IC    R14,PRFXSIZE       GET SIZE OF PREFIX           @YM08168 54990000
         SLR   R1,R14             GET SIZE OF PAD              @YM08168 55080000
         STC   R1,PADSAV          SAVE PAD SIZE                @YM08168 55170000
         L     R9,COMMADDR-1     GET POINTER TO OLLT DATA AREA @Y17XAUQ 55260000
*                                 BUILT TH AND RH IN OLLT AREA @Y17XAUQ 55350000
         USING OLLTFID1,R9        ESTABLISH ADDRESSABILITY     @Y17XAUQ 55440000
         SR    R1,R1              CLEAR REGISTER               @Y17XAUQ 55530000
         LH    R1,PRFDEST         SET UP TTCIN OF DESTINATION  @Y17XAUQ 55620000
         BALR  R14,R15            GO GET NET ADDR              @Y17XAUQ 55710000
         STCM  R15,3,OLLTDAF      STORE NA OF DESTIN IN DAF    @Y17XAUN 55800000
         LH    R1,PRFSRCE         GET SOURCE TTCIN             @Y17XAUQ 55890000
         L     R15,TOTTNTX        RESTORE CONV RTN ADDRESS     @Y17XAUU 55980000
         BALR  R14,R15            FIND NETWORK ADDRESS         @Y17XAUQ 56070000
         STCM  R15,3,OLLTOAF      SET ORIGIN NETWORK ADDRESS   @Y17XAUQ 56160000
*                                                                       56250000
         LH    R11,PRFSIZE        GET SIZE OF DATA IN BUFFER   @Y17XAUQ 56340000
         LA    R1,AVTHDRSZ        GET SIZE OF HEADER PREFIX    @Y17XAUN 56430000
         SR    R11,R1           DECREMENT SIZE BY PREFIX LGNT  @Y17XAUQ 56520000
         LA    R1,OLLTRHLG        GET LENGTH OF RH             @Y17XAUQ 56610000
         AR    R11,R1             ADD IT TO LENGTH REQD        @Y17XAUQ 56700000
*                                                                       56790000
         SLR   R1,R1              CLEAR REG                    @YM08168 56880000
         IC    R1,PADSAV          GET PAD SIZE                 @YM08168 56970000
         SLR   R11,R1             DECREMENT BUFFER SIZE BY PAD          57060000
*                                 SIZE                         @YM08168 57150000
         STCM  R11,3,OLLTDCF      PUT LENGTH OF RH + RU IN TH  @Y17XAUN 57240000
*                                                                       57330000
         MVI   OLLTFID1,OLLTIND1  SET TH FLAG 1                @YM08088 57420000
         MVI   OLLTTHF2,OLLTIND2  SET TH FLAG 2                @YM08088 57510000
         LA    R1,PRF1LEN         GET LENGTH OF NEG BUFFER PRFX@Y17XAUQ 57600000
         SR    R3,R1              SUBTRACT IT FROM BUFFER POINT@Y17XAUQ 57690000
         DROP  R3                 FREE REG                     @Y17XAUQ 57780000
         USING IEDPF1,R3          ESTAB ADDRABILITY TO NEG PRFX@Y17XAUQ 57870000
         MVC   OLLTRHF1(OLLTRHLG),PRF1RH MOVE RH FROM NEG PRFX @Y17XAUQ 57960000
*                                 INTP OLLT BUFFER AREA        @Y17XAUQ 58050000
         MVC   OLLTSEQN,PRF1SQID MOVE SEQ NUMBER INTO OLLT AREA@Y17XAUQ 58140000
         AR    R3,R1              RETURN R3 TO BEGINNING OF    @Y17XAUQ 58230000
*                                 BUFFER                       @Y17XAUQ 58320000
         DROP  R3                 FREE REG                     @Y17XAUQ 58410000
         USING IEDQPRF,R3         ESTAB ADDRABILITY TO BUFFER  @Y17XAUQ 58500000
         LH    R9,UNITSIZE        GET SIZE OF UNIT             @Y17XAUQ 58590000
         LA    R1,AVTHDRSZ        GET SIZE OF HEADER PREFIX    @Y17XAUN 58680000
         SR    R9,R1              REG NOW HAS # OF BYTES IN    @Y17XAUQ 58770000
*                                 THIS UNIT                    @Y17XAUQ 58860000
         LA    R11,PRFSUNIT       THIS REG NOW POINTS TO FIRST @Y17XAUN 58950000
         AH    R11,PRFSCAN        DATA BYTE                    @Y17XAUN 59040000
*                                                              @Y17XAUQ 59130000
         SR    R1,R1              CLEAR REG FOR UNIT COUNT     @Y17XAUQ 59220000
UNITCKSZ EQU   *                       UNIT SIZE CHECK           S22024 59310000
         LTR   R9,R9                   IS UNIT SIZE ZERO         S22024 59400000
         BZ    GETANIT                 YES BRANCH GET ANOTHER    S22024 59490000
*                                      UNIT                      S22024 59580000
         CR    R9,R6                   IS UNITSIZE GREATER THAN  S22024 59670000
*                                      OR EQUAL TO BYTE COUNT    S22024 59760000
         BL    UNITSZSM                BRANCH IF UNITSIZE SMALL  S22024 59850000
         LTR   R6,R6                   ANY LEFT                  S22024 59940000
         BZ    ZEROLFT                 NO BRANCH                 S22024 60030000
         BCTR  R6,0                    DECREMENT FOR EX          S22024 60120000
         EX    R6,COUNTBYS             GO MOVE NUMBER OF BYTES   S22024 60210000
*                                      IN COUNT                  S22024 60300000
         LA    R6,D1(R6)               BUMP COUNT BACK           S22024 60390000
ZEROLFT  EQU   *                                                 S22024 60480000
         SR    R9,R6                   GET NUMBER BYTES FLFT IN  S22024 60570000
*                                      UNIT                      S22024 60660000
         TM    FLAGSS,DC               DATA CHAINNING ON         S22024 60750000
         BZ    ALLMOVE                 NO BRANCH                 S22024 60840000
         LA    R10,D8(R10)             GET NEXT CCW              S22024 60930000
         CLI   COMMCODE,TIC            NEW OP CODE A TIC         S22024 61020000
         BNE   NOTIC                   NO BRANCH                 S22024 61110000
         L     R10,COMMADDR-1          GET CCW WHERE TIC POINTS  S22024 61200000
NOTIC    EQU   *                       CONTINUE                  S22024 61290000
         L     R8,COMMADDR-1           GET NEW TARGET ADDRESS    S22024 61380000
         LH    R6,BYTECNT              GET NEW BYTE COUNT        S22024 61470000
         B     UNITCKSZ                GO FILL NEXT CCW AREA     S22024 61560000
UNITSZSM EQU   *                       UNIT SIZE SMALLER THAN    S22024 61650000
*                                      BYTE COUNT IN CCW         S22024 61740000
         BCTR  R9,0                    DECREMENT FOR EX          S22024 61830000
         EX    R9,COUNTBYS             MOVE UNIT SIZE LENGTH     S22024 61920000
         LA    R9,D1(R9)               BUMP BACK COUNT           S22024 62010000
         SR    R6,R9                   CCW COUNT MINUS UNITSIZE  S22024 62100000
         AR    R8,R9                   ADD INIT SIZE TO CCW ADDR S22024 62190000
*                                      THIS ROUTINE FINDS NEXT   S22024 62280000
*                                      UNIT IF THERE IS ONE      S22024 62370000
GETANIT  EQU   *                                                 S22024 62460000
         LA    R1,D1(R1)               NUMBER OF UNITS           S22024 62550000
         CLC   PRFTIC(D4),TICTWO       LAST UNIT                 S22024 62640000
         BE    ALLMOVE                 YES BRANCH                S22024 62730000
         LH    R9,UNITSIZE             GET UNIT SIZE             S22024 62820000
         L     R3,PRFTIC               GET NEXT UNIT ADDRESS     S22024 62910000
         LA    R11,PRFSUNIT            GET DATA ADDRESS          S22024 63000000
         B     UNITCKSZ                GO XCECK UNITS FOR MOVE   S22024 63090000
ALLMOVE  EQU   *                       ENTRY AFTER RN READ       S22024 63180000
         L     R3,OLTBUFA              GET BUFFER ADDRESS        S22024 63270000
         USING IEDQPRF,R3              BUFFER FREFIX             S22024 63360000
         LH    R9,PRFSIZE         GET BUFFER DATA SIZE         @Y17XAUQ 63450000
         LA    R8,OLLTRHLG        GET LENGTH OF OLLT/OLTT RH   @Y17XAUQ 63540000
         AR    R9,R8              BUMP DATA SIZE BY RH         @Y17XAUQ 63630000
         LA    R8,OLLTTHLG        GET LENGTH OF OLLT/OLTT TH   @Y17XAUQ 63720000
         AR    R9,R8              BUMP DATA+RH SIZE BY TH      @Y17XAUQ 63810000
         LA    R8,AVTHDRSZ        GET SIZE OF HEADER PREFIX    @Y17XAUN 63900000
         SR    R9,R8              SUBTRACT IT FROM DATA SIZE   @Y17XAUQ 63990000
         LR    R8,R9              PUT SIZE IN REG              @Y17XAUQ 64080000
         SR    R9,R9              CLEAR SIZE REG               @Y17XAUU 64100000
         IC    R9,PADSAV          GET PAD SIZE                 @Y17XAUU 64120000
         SR    R8,R9              ADJUST DATA SIZE             @Y17XAUU 64140000
         SPACE 3                                                        64170000
************************************************************** @Y17XAUQ 64260000
*        REGISTER 8 NOW CONTAINS                             * @Y17XAUQ 64350000
*              DATA SIZE + L'RH + L'TH - L'PREFIX            * @Y17XAUQ 64440000
*        THIS IS THE SAME AMOUNT THAT A READ CCW WOULD HAVE  * @Y17XAUQ 64530000
*        SEEN.                                               * @Y17XAUQ 64620000
************************************************************** @Y17XAUQ 64710000
         DROP  R9                      BTU                       S22024 64800000
         LTR   R1,R1                   NUMBER OF NNITS ZERO      S22024 64890000
         BNZ   FORCENOT                NO BRANCH                 S22024 64980000
         LA    R1,D1(R1)               FORCE UNITS TO ONE        S22024 65070000
FORCENOT EQU   *                                                 S22024 65160000
         STC   R1,PRFNBUNT             SET NUMBER OF UNITS IN    S22024 65250000
*                                      THIS BUFFER               S22024 65340000
         L     R10,OLTCCWA             GET CCW ADDRESS           S22024 65430000
         LH    R9,BYTECNT              GET BYTE COUNT OF FIRST   S22024 65520000
*                                      CCW                       S22024 65610000
DATACHTS TM    FLAGSS,DC               DATA CHAINNING            S22024 65700000
         BZ    RESCOUNT                NO BRANCH                 S22024 65790000
         LA    R10,D8(R10)             GET NEXT CCW              S22024 65880000
         CLI   COMMCODE,TIC            THIS CCW A TIC            S22024 65970000
         BNE   NOTICCM                 NO BRANCH                 S22024 66060000
         L     R10,COMMADDR-1          GET NEXT CCW              S22024 66150000
NOTICCM  AH    R9,BYTECNT              ADD BYTE COUNTS           S22024 66240000
         B     DATACHTS                GO GET NEXT CCW           S22024 66330000
RESCOUNT EQU   *                       COMPUTE RESIDULE COUNT    S22024 66420000
         SR    R9,R8                   TOTAL BYTE COUNT MINUS    S22024 66510000
*                                      DATA RECIEVED EQUALS      S22024 66600000
*                                      REDIDULE COUNT            S22024 66690000
         BP    RESIDCT                 IF POSTTIVE POET TECT     S22024 66780000
         SR    R9,R9                   DONT ALLOW NEGITIVE R CT  S22024 66870000
RESIDCT  EQU   *                                                 S22024 66960000
         BAL   R14,PRESULT             POST TECB                 S22024 67050000
*                                      DEQUE BUFFER FROM CHAIN   S22024 67140000
         MODESET MODE=SUP              SET TO SUPERVISOR MODE  @G36XRUV 67150010
         MODESET EXTKEY=SUPR           SET TO KEY 0            @G36XRUV 67160010
SETTSTBF DS    0H                                              @G36XRUV 67170010
         SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,REGS=USE,       @G36XRUVC67180010
               RELATED=ATTACHED-TASKS-IEDQWA1(SETTSTBF)        @G36XRUV 67190010
         L     R3,OLTBUFA              GET BUFFER ADDRESS        S22024 67230000
         L     R9,PRFLINK-D1           GET LINK FIELD AND PUT    S22024 67320000
         LA    R9,D0(R9)               CLEAR HIGH BYTE           S22024 67410000
         ST    R9,OLTBUFA              IN FIRST BUFFER ADDRESS   S22024 67500000
*                                      POINTER                   S22024 67590000
         SETLOCK RELEASE,TYPE=LOCAL,REGS=USE,                  @G36XRUVC67600010
               RELATED=ATTACHED-TASKS-IEDQWS(SETTSTBF)         @G36XRUV 67610010
         MODESET EXTKEY=TCAM           SET TO TCAM'S KEY       @G36XRUV 67620010
         MODESET MODE=PROB             SET TO PROBLEM MODE     @G36XRUV 67630010
*        POST BUFFER TO BUFFER RETURN                            S22024 67680000
         L     R12,TOTAVTPT            GET AVT ADDRESS           S22024 67770000
         USING IEDQAVTD,R12            AVT                       S22024 67860000
         LA    R5,AVTBFRTB             BFR RETURN QCB ADDR       S22024 67950000
         ST    R5,PRFKEY               QCB ADDR TO BUFFER        S22024 68040000
         MVI   PRFPRI,PRIBFRTB         PRIORITY                  S22024 68130000
         DROP  R12                     AVT                       S22024 68220000
         ST    R3,TPOSTPAR+D4          BUFFER ADDR TO P LIST     S22024 68310000
         MVC   TPOSTPAR+D1(D3),TPOSTPAR+D5  SET UP               S22024 68400000
         MVI   TPOSTPAR+D4,X80         SCV 102                   S22024 68490000
         MVI   TPOSTPAR,START          PARAMETER LIST            S22024 68580000
         LA    R1,TPOSTPAR             PUT ADDR OF P LIST IN REG S22024 68670000
         AQCTL                         ISSUE SVC 102             S22024 68760000
         EJECT                                                          68850000
************************************************************** @Y17XAUQ 68940000
*                                                            * @Y17XAUQ 69030000
*        NOW A CHECK WILL BE MADE TO SEE IF THE              * @Y17XAUQ 69120000
*        TCAM QUE WAS HELD DUE TO TESTING ON THE SAME        * @Y17XAUQ 69210000
*        LINE AS THE CONTROL TERMINAL OR ALTERNATE           * @Y17XAUQ 69300000
*        IF SO AND THIS WAIT10 BRINGS THE LINE OUT OF        * @Y17XAUQ 69390000
*        TEST SESSION THE QUEUE WILL BE RELEASED.            * @Y17XAUQ 69480000
*                                                            * @Y17XAUQ 69570000
************************************************************** @Y17XAUQ 69660000
*                                                            * @Y17XAUQ 69750000
         TM    TOTFLG02,TOTTSST+TOTTTSPE ARE TEST SESSION      @Y17XAUQ 69840000
*                                        STARTED AND TEST      @Y17XAUQ 69930000
*                                        SESSION PENDING END   @Y17XAUQ 70020000
*                                        BOTH ON               @Y17XAUQ 70110000
         BNO   GOOUT              NO NOTHING MORE TO DO-RETURN @Y17XAUQ 70200000
*                                 YES LETS RELEASE QUE IF      @Y17XAUQ 70290000
*                                 TEST WITN DISCONNECT         @Y17XAUQ 70380000
         L     R10,OLTCCWA        GET ADDRESS OF CCW           @Y17XAUQ 70470000
         USING CCW,R10            ESTAB ADDRESSABILITY         @Y17XAUQ 70560000
         CLI   COMMCODE,READ      IS COMMAND CODE A READ       @Y17XAUQ 70650000
         BNE   GOOUT              NO RETURN                    @Y17XAUQ 70740000
         L     R10,COMMADDR-1     YES NOW CHECK FOR DISCONNECT @Y17XAUQ 70830000
         USING OLLTFID1,R10       ESTAB ADDRESSABILITY         @Y17XAUQ 70920000
         CLI   OLLTPRFX,CD1NETS   IS THIS A VALID NET SERVICES @Y17XAUQ 71010000
         BNE   GOOUT              NO RETURN                    @Y17XAUQ 71100000
         CLI   OLLTPRFX+1,CD1MAINT IS IT NETWORK SERVICES      @Y17XAUQ 71190000
         BNE   GOOUT              NO RETURN                    @Y17XAUQ 71280000
         CLI   OLLTREQ,CD1RTTD    IS THIS TEST RECORD DATA     @Y17XAUN 71370000
         BNE   GOOUT              NO RETURN                    @Y17XAUQ 71460000
*                                 YES TO ALL ABOVE             @Y17XAUQ 71550000
         CLI   OLLTCMOD,CD0TD     IS COMMAND TEST WITH         @Y17XAUN 71640000
*                                 DISCONNECT                   @Y17XAUQ 71730000
         BNE   GOOUT              NO RETURN                    @Y17XAUQ 71820000
*                                 YES NOW SEE IF CMD EXECUTED  @Y17XAUQ 71910000
*                                 OK                           @Y17XAUQ 72000000
         CLI   OLLTSYSR,OLLTOKSF  PHASE 3 OK SO FAR            @Y17XAUQ 72090000
         BNE   GOOUT              NO RETURN                    @Y17XAUQ 72180000
         NI    TOTFLG02,X'FF'-TOTTSST  TURN OFF TEST SESSION   @Y17XAUQ 72270000
         NI    TOTFLG02,X'FF'-TOTTTSPE AND TEST.SESS.PEND.END  @Y17XAUQ 72360000
*                                 NOW LETS TURN OFF HELD BITS  @Y17XAUQ 72450000
*                                 IF REQD                      @Y17XAUQ 72540000
         TM    $TOTFLG1,$CTEQTT   IS CT ON SAME LINE AS TEST DV@Y17XAUQ 72630000
         BZ    GOOUT0             YES GO RELEASE               @Y17XAUQ 72720000
GOOUT1   TM    TOTFLG01,TOTAPTST  IS AP ON SAME LINE AS TEST DV@Y17XAUQ 72810000
         BZ    GOOUT              NO RETURN                    @Y17XAUQ 72900000
*                                 YES RELEASE                  @Y17XAUQ 72990000
         DS    0H                 ESTAB BRANCH POINT           @Y17XAUQ 73080000
         L     R6,TOTAPTNT        ADDR OF DUMMY TNT FOR ALT PRT@Y17XAUQ 73170000
         SR    R12,R12            CLEAR REG                    @Y17XAUQ 73260000
         ICM   R12,1,TOTTTBEL     GET TNT NAME LENGTH          @Y17XAUQ 73350000
         AR    R6,R12             BUMP POINTER TO ADDR         @Y17XAUQ 73440000
         ICM   R6,7,ZEROO(R6)     LOAD ADDR OF TTE             @Y17XAUQ 73530000
         USING IEDQTRM,R6         ESTAB ADDRESSABILITY         @Y17XAUQ 73620000
         NI    TRMSTATE,TRMHELDF  TURN OFF HOLD BIT            @Y17XAUQ 73710000
         L     R6,TRMDESTQ-ONE    GET QCB ADDRESS              @Y17XAUQ 73800000
*                                                                       73890000
         DROP  R6                 FREE REG                     @Y17XAUQ 73980000
         USING IEDQQCB,R6         ESTAB ADDRESSABILITY         @Y17XAUQ 74070000
         NI    QCBSTAT,X'FF'-QCBTRMHO TURN OFF HELD BIT ON QCB @Y17XAUQ 74160000
         DROP  R6                                              @Y17XAUQ 74250000
*                                                              @Y17XAUQ 74340000
         B     GOOUT              RETURN                       @Y17XAUQ 74430000
*                                                              @Y17XAUQ 74520000
         EJECT                                                          74610000
GOOUT0   DS    0H                 ESTAB BRANCH POINT           @Y17XAUQ 74700000
         L     R6,TOTCTTNT        ADDR OF DUMMY TNT FOR CT     @Y17XAUQ 74790000
         SR    R12,R12            CLEAR REG                    @Y17XAUQ 74880000
         ICM   R12,1,TOTTTBEL     GET TNTNAME LENGTH           @Y17XAUQ 74970000
         AR    R6,R12             BUMP POINTER TO ADDR         @Y17XAUQ 75060000
         ICM   R6,7,ZEROO(R6)     ESTAB ADDRESSABILITY         @Y17XAUQ 75150000
         USING IEDQTRM,R6         ESTAB ADDRESSABILITY         @Y17XAUQ 75240000
         NI    TRMSTATE,TRMHELDF  TURN OFF HOLD BIT            @Y17XAUQ 75330000
         L     R6,TRMDESTQ-ONE    GET QCB ADDRESS              @Y17XAUQ 75420000
*                                                              @Y17XAUQ 75510000
         B     GOOUT1             SEE IF AP NEEDS TO BE        @Y17XAUQ 75600000
*                                 RELEASED                     @Y17XAUQ 75690000
GOOUT    DS    0H                 ESTABLISH BRANCH POINE       @Y17XAUQ 75780000
*                                                                       75870000
         EJECT                                                          75960000
         MVI   TOTRTCOD,ZEROZ          SET RETURN CODE           S22024 76050000
         B     OUT                     GET OUT                   S22024 76140000
COUNTBYS MVC   0(0,R8),0(R11)          MOVE TO WHERE CCW POINTS  S22024 76230000
         EJECT                                                          76320000
*                                                                       76410000
* T I M E R  C O M P L E T I O N  R O U T I N E S                       76500000
*                                                                       76590000
TIMEIT   EQU   *                                                        76680000
         USING TIMEIT,R4                                                76770000
         STM   R14,R12,12(R13)    SAVE CALLER'S REGISTERS               76860000
         LR    R4,R15                  ADDRESSIBILITY BASE LOAD  S99528 76950000
         L     R2,TOLTCBA         LOAD ADDR OF OLTCB DSECT              77040000
         L     R7,TOLTCBB         SET UP POST REGISTER         @Y17XAUQ 77130000
         ST    R13,TOTSAVE2+D4         SAVE CALLERS SAVE ADDR    S22024 77220000
         LR    R12,R13                 GET CALLERS SAVE ADDRESS  S99528 77310000
         LA    R13,TOTSAVE2            GET MY SAVE ADDR          S22024 77400000
         ST    R13,8(R12)              SAVE IN CALLERS           S99528 77490000
         OI    TOTFLG05,TOTTMOUT       SET TIME OUT FLAG         S22024 77580000
         TM    TOTFLG07,TOTSECEX       TEST DEVICE SECONDARY     S22024 77670000
         BO    NOSET1                  YES BR                    S99528 77760000
         POST  ECBOLT,4                POST WAIT ECB                    77850000
         POST  TOTOTECB,4              POST TOTE'S ECB                  77940000
*                                                                       78030000
NOSET1   TM    TOTFLG07,TOTSECEX       TEST DEVICE SECONDARY     S22024 78120000
         BZ    NOSET2             NO - EXIT                             78210000
         POST  TOTSCECB,4              POST SECONDARY ECB        S22024 78300000
NOSET2   NI    TOTFLG07,X'FF'-TOTPRIEX TRRN OFF PRIMARY FLAG     S22024 78390000
         NI    TOTFLG07,X'FF'-TOTSECEX TURN OFF SECONDFARY FLAG  S22024 78480000
         LR    R13,R12                 RESTROE R13               S99528 78570000
         LM    R14,R12,12(R13)    RETORE CALLER'S REG                   78660000
         BR    R14                     RETURN TO THE SYSTEM      S99528 78750000
TIMEEND  DS    0H                 ESTABLISH ADDR FOR CALCULATI @Y17XAUQ 78840000
TIMEITLG EQU   TIMEEND-TIMEIT     LENGTH OF EXIT               @Y17XAUQ 78930000
*                                                              @Y17XAUQ 79020000
*                                                              @Y17XAUQ 79110000
         EJECT                                                          79200000
* C O N S T A N T S**************************************************** 79290000
         DS    0F                                                       79380000
COMPARE  CLC   ZEROO(ZEROO,R7),TWELVE(R6)  TNT CDS COMPARE       S99528 79470000
TICTWO   DC    X'08000002'             TIC TO TWO EQUALS LAST    S22024 79560000
*                                      UNIT IN A BUFFER          S22024 79650000
EIGHT    DC    F'8'                    EIGHT                     S99528 79740000
SIXTY    DC    F'60'                   SIXTY                     S99528 79830000
ZERO     DC    X'F0F0'                 HEX 0                     S99528 79920000
         DS    0F                                                       80010000
SENSELN  DC    X'00000004'             SENSE LENGH COMPUTE       S99528 80100000
PATCH    DC    CL50' '                 PATCH AREA                Y06330 80190000
**************************************************************** S99528 80280000
*                                                              * S99528 80370000
*   SAVE AREAS / CONSTANTS / EQUATED VALUES                    * S99528 80460000
*                                                              * S99528 80550000
**************************************************************** S99528 80640000
WAITIO   DSECT                         WAIT PARM LIST            S99528 80730000
WTIOMAP  DS    F                       TRANS MANAGEMENT WORD     S99528 80820000
WIOTECB  DS    F                       TECB ADDRESS              S99528 80910000
WIOCDS   DS    F                       CDS ADDRESSS              S99528 81000000
WIOFLAG  DS    XL1                     FLAGS                     S99528 81090000
*                                      BIT 0 EQUALS YES          S99528 81180000
*                                      BIT 1 EQUALS POLL         S99528 81270000
*                                      BIT 2 EQUALS PURGE        S99528 81360000
WIOTIME  DS    XL2                     TIME IN SECONDS           S99528 81450000
         OLTCB                         TOTE CONTROL BLOCK        S22024 81540000
*************************************************************  @Y17XAUQ 81630000
*                                                           *  @Y17XAUQ 81720000
*        SAVE AREAS IN OLTCB TO MAKE THIS MODULE REENTRANT  *  @Y17XAUQ 81810000
*                                                           *  @Y17XAUQ 81900000
************************************************************** @Y17XAUQ 81990000
*                                                              @Y17XAUQ 82080000
TOTUCBAA DS    5F                 REGISTER SAVE AREA           @Y17XAUQ 82170000
TOTUCBAB DS    24C                UCB COPY AREA COMMON SECTION @Y17XAUQ 82260000
TOTUCBAC DS    H                  HALF WORD LENGTH FOR SVC 102 @Y17XAUQ 82350000
TUCBCLAS EQU   X'10'              GRAPHIC DEVICE CLASS IN UCE  @Y17XAUQ 82440000
TUCBCLOS EQU   18                 OFFSET TO DEVICE CLASS       @Y17XAUQ 82530000
TUCBNALC EQU   X'FF'-X'04'        AND FIELD TO TURN OFF        @Y17XAUQ 82620000
*                                 UCBNALOC                     @Y17XAUQ 82710000
TUCBNALO EQU   1                  OFFSET TO UCBNALOC FLAG      @Y17XAUQ 82800000
TUCBZERO EQU   0                  USED AS EQU TO START OF FIELD@Y17XAUQ 82890000
TUCBONE  EQU   1                  CONSTANT USED TO BUMP REGS   @Y17XAUQ 82980000
LEN1     EQU   24                 LENGTH FOR UCB MOVE          @Y17XAUQ 83070000
*                                                              @Y17XAUQ 83160000
************************************************************** @Y17XAUQ 83250000
*                                                            * @Y17XAUQ 83340000
*        THE FOLLOWING AREA WILL BE USED TO HOLD THE STIMER  * @Y17XAUQ 83430000
*        EXIT ROUTINE SINCE IT IS DIFFICULT TO HAVE A TIMER  * @Y17XAUQ 83520000
*        EXIT IN RE_ENTRANT CODE                             * @Y17XAUQ 83610000
*                                                            * @Y17XAUQ 83700000
************************************************************** @Y17XAUQ 83790000
TIMEAREA DS    100C               SPACE TO HOLD EXIT ROUTINE   @Y17XAUQ 83880000
TOLTCBA  DS    F                  SAVE AREA FOR OLTCB ADDR     @Y17XAUQ 83970000
TOLTCBB  DS    F                  SAVE AREA FOR REG FOR POST   @Y17XAUQ 84060000
         EJECT                                                          84150000
*************************************************************  @Y17XAUQ 84240000
*                                                           *  @Y17XAUQ 84330000
*        PARAMETER LIST FOR SVC 102 DATA MOVE               *  @Y17XAUQ 84420000
*                                                           *  @Y17XAUQ 84510000
*************************************************************  @Y17XAUQ 84600000
PRFXSIZE DS    XL1                HEADER BUFFER PREFIX SIZE    @Y17XAUQ 84690000
PADSAV   DS    XL1                PAD SIZE SAVE AREA           @YM08168 84780000
*                                                              @Y17XAUQ 84870000
TOT102   DS    0F                 ALIGN ON FULL WORD           @Y17XAUQ 84960000
TOT102A  DS    XL1                FLAG FOR DATA MOVE           @Y17XAUQ 85050000
TOT102B  DS    AL3                DATA ADDRESS                 @Y17XAUQ 85140000
TOT102C  DS    XL1                2ND WORD ADDRESS             @Y17XAUQ 85230000
TOT102D  DS    AL3                TARGET ADDRESS (DYNAMIC)     @Y17XAUQ 85320000
TOT102E  DS    XL1                LAST WORD ADDRESS            @Y17XAUQ 85410000
TOT102F  DS    AL3                ADDRESS CONTAINING LENGTH    @Y17XAUQ 85500000
*                                                              @Y17XAUQ 85590000
TOTDTMVL EQU   24                 DATA MOVE LENGTH             @Y17XANQ 85680000
TOTDATMV EQU   X'08'              FLAG FOR DATA MOVE           @Y17XANQ 85770000
TOT2WFLG EQU   0                  2ND WORD FLAGS               @Y17XANQ 85860000
TOTLTWFG EQU   X'80'              LAST WORD FLAG               @Y17XANQ 85950000
*                                                              @Y17XAUQ 86040000
*                                                              @Y17XAUQ 86130000
ZEROADDR DS    A                  ZERO ADDRESS                 @Y17XANQ 86220000
UCBAREA  DS    H                  UCB NAME                     @Y17XANQ 86310000
UNITSIZE DS    H                  UNIT SIZE IN BUFFERS         @Y17XANQ 86400000
BFRTADDR DS    A                  BUFFER RETURN QCB            @Y17XANQ 86490000
TPOSTPAR DS    F                  TPOST PARAMETER              @Y17XANQ 86580000
         DS    XL1                LIST FOR                     @Y17XANQ 86670000
         DS    XL7                BUFFER RETURN                @Y17XANQ 86760000
BDQCB    DS    F                  ADDRESS OF BUFFER DISP QCB   @Y17XANQ 86850000
WORKA    DS    F                  WORK AREA                    @Y17XANQ 86940000
         DS    0F                                              @Y17XANQ 87030000
MINUTE   DS    D                  WAIT MINUTES                 @Y17XANQ 87120000
SECON    DS    D                  WAIT SECONDS                 @Y17XANQ 87210000
@PARM1   DS    F                  PARAMETER ADDRESS            @Y17XANQ 87300000
*                                                              @Y17XAUQ 87390000
EICT     DS    CL1                TIME                         @Y17XANQ 87480000
SPACE    DS    CL3                TIME                         @Y17XAUQ 87570000
*                                                              @Y17XAUQ 87660000
*                                                              @Y17XAUQ 87750000
*                                                              @Y17XAUQ 87840000
*                                                                       87930000
*                                                                       88020000
PURGEE   EQU   X'10'              PURGE SVC                    @Y17XAUQ 88110000
QVPRGLST DS    0F                 PURGE P-LIST                 @Y17XAUQ 88200000
QVPRGDEB EQU   QVPRGLST           PURGE P-LIST                 @Y17XAUQ 88290000
QVPVRFLG DS    XL1                FLAG BYTE                    @Y17XAUQ 88380000
         DS    XL3                DEB ADDR                     @Y17XAUQ 88470000
         DS    F                  TCB ADDR                     @Y17XAUQ 88560000
QVPRGIOB DS    0F                 ADDR OF IOB                  @Y17XAUQ 88650000
QVPDEBNO DS    XL1                NUMBER OF DEBS               @Y17XAUQ 88740000
         DS    XL3                IOB ADDR                     @Y17XAUQ 88830000
PRGFLAG  EQU   X'A0'              PURGE FLAG                   @Y17XAUQ 88920000
PLISTEND EQU   *                  END OF PARM LIST             @Y17XAUQ 89010000
PLISTLEN EQU   PLISTEND-QVPRGLST  LENGTH OF PARM LIST          @Y17XAUQ 89100000
PLSTDEB# EQU   1                  DEB NUMBER                   @Y17XAUQ 89190000
TOTTNTX  DS    A                  SAVE AREA                    @Y17XAUU 89280000
*********      TEST EVENT CONTROL BLOCK    **********          @Y17XAUQ 89370000
TTECB    DSECT                                                 @Y17XAUQ 89460000
TECBFDCT DS    CL1                     NUMBER OF EVENT FIELDS  @Y17XAUQ 89550000
TECBFDLN DS    CL1                     LENGTH OF EVENT FIELDS  @Y17XAUQ 89640000
TECBSNLN DS    CL2                     LENGTH OF SENSE FIELDS  @Y17XAUQ 89730000
FLAGS    DS    CL1                     FLAGS                   @Y17XAUQ 89820000
TECBSNCT DS    CL1                     NUMBER OF SENSE FIELDS           89910000
TECBSNOC DS    CL1                     NUMBER SENSES OCCURRED           90000000
TECBEVOC DS    CL1                     NUMBER EVENTS OCCURRED           90090000
UCB      DSECT                                                          90180000
         IEFUCBOB                                                       90270000
CCW      DSECT                                                   S22024 90360000
COMMCODE DS    C                       COMMAND AODE              S22024 90450000
COMMADDR DS    AL3                     ADDRESS                   S22024 90540000
FLAGSS   DS    XL2                     FLAGS                     S22024 90630000
BYTECNT  DS    H                       BYTE COUNT                S22024 90720000
         DS    20F                     PATCH AREA                S22024 90810000
         TPRIOR                        EQUATES                   S22024 90900000
         TAVTD                         AVT                       S22024 90990000
         TSCBD                         SCB                       S22024 91080000
         EJECT                                                 @Y17XAUQ 91170000
         EJECT                                                 @Y17XAUQ 91260000
         TCD0D                                                 @Y17XAUQ 91350000
         EJECT                                                 @Y17XAUQ 91440000
         TCD1D                                                 @Y17XAUQ 91530000
         EJECT                                                 @Y17XAUQ 91620000
         DSECT                                                 @Y17XAUQ 91710000
OLLTFID1 DS    0C                 ON LINE TEST FID1 DESECT     @Y17XAUQ 91800000
OLLTTHF1 DS    XL1                TRANS HEADER FLAG 1          @Y17XAUQ 91890000
OLLTIND1 EQU   X'1C'              OLLT FLAG 1 SETTING          @YM08088 91980000
OLLTTHF2 DS    XL1                TRANS HEADER FLAG 2          @Y17XAUQ 92070000
OLLTIND2 EQU   X'00'              OLLT FLAG 2 SETTING          @YM08088 92160000
OLLTDAF  DS    XL2                DAF OF NCP PHYS SERVICES     @Y17XAUQ 92250000
OLLTOAF  DS    XL2                OAF OF TCAM'S SSCP           @Y17XAUQ 92340000
OLLTSEQN DS    XL2                SEQ NUMBER                   @Y17XAUQ 92430000
OLLTDCF  DS    XL2                DATA COUNT FIELD             @Y17XAUQ 92520000
OLLTTHLG EQU   10                 OLLT TH LENGTH               @Y17XAUQ 92610000
*                                                                       92700000
*                                                                       92790000
OLLTRHF1 DS    XL1                REQ HEADER FLAG 1            @Y17XAUQ 92880000
OLLTRHF2 DS    XL1                REQ HEADER FLAG 2            @Y17XAUQ 92970000
OLLTRHF3 DS    XL1                REQ HEADER FLAG 3            @Y17XAUQ 93060000
OLLTRHLG EQU   3                  OLLT RH LENGTH               @Y17XAUQ 93150000
*                                                                       93240000
*                                                                       93330000
OLLTPRFX DS    XL2                PREFIX(NET SVCS & MAINT SVCX)@Y17XAUQ 93420000
OLLTREQ  DS    XL1                REQ TYPE EXEC TST|RCD STATIST@Y17XAUQ 93510000
OLLTTDEV DS    XL2                DAF OF TEST DEVICE           @Y17XAUQ 93600000
OLLTCMD  DS    XL1                COMMAND                      @Y17XAUQ 93690000
OLLTCMOD DS    XL1                COMMAND MODIFIER             @Y17XAUQ 93780000
OLLTSYSR DS    XL1                SYSTEM RESPONSE              @Y17XAUQ 93870000
OLLTERSP DS    XL2                EXTENDED RESPONSE            @Y17XAUQ 93960000
OLLTOKSF EQU   X'62'              SYS RESPONSE OF OK SO FAR    @Y17XAUQ 94050000
*                                 PHASE 3                               94140000
         EJECT                                                          94230000
         TPRFD                         PREFIX                    S22024 94320000
         EJECT                                                 @G36XRUV 94350010
         IHAPSA                                                @G36XRUV 94380010
         EJECT                                                 @Y17XAUQ 94410000
RESPL    RESPL                    TOTES RESIDENT PARM LIST     @Y17XAUQ 94500000
         EJECT                                                 @Y17XAUQ 94590000
         TTRMD                                                 @Y17XAUQ 94680000
         EJECT                                                 @Y17XAUQ 94770000
         TQCBD                                                 @Y17XAUQ 94860000
*                                                              @Y17XAUQ 94950000
*                                                              @Y17XAUQ 95040000
*                                                              @Y17XAUQ 95130000
IOBLOCKS IOBLOCKS                                                       95220000
         END                                                            95310000
