XA       TITLE '''IEDQXA'' - TCAM DISK MESSAGE QUEUE INITIALIZER'       00100010
IEDQXA   CSECT                                                          00120010
*A-000000-999999                                               @X02X5N0 00140010
         SPACE 2                                                        00160010
*A324000,716000                                                  A51067 00200110
*C144000                                                         A51067 00200210
*A224000,249000,675000                                           A49215 00200310
*D724000                                                         A49215 00200410
*C144000                                                         A49215 00200510
*C019000-022000,032000-033000,038000                             S21101 00201010
*D045000                                                         S21101 00202010
*C047000,052000,056000,061000,068000,084000-087000,100000-101000 S21101 00203010
*A103000                                                         S21101 00204010
*C104000-107000,118000-120000,124000,127000,144000,153000        S21101 00205010
*C160000-174000,181000-182000                                    S21101 00206010
*D186000-187000,188000                                           S21101 00207010
*C204000-205000,214000-215000,226000-227000                      S21101 00208010
*A233000                                                         S21101 00209010
*D235000                                                         S21101 00210010
*A258000                                                         S21101 00211010
*C260000-261000,264000,278000                                    S21101 00212010
*A284000,286000                                                  S21101 00213010
*C289000                                                         S21101 00214010
*A291000                                                         S21101 00215010
*C294000                                                         S21101 00216010
*A296000,298000                                                  S21101 00217010
*C299000,302000                                                  S21101 00218010
*A304000,305000,310000                                           S21101 00219010
*C311000-313000                                                  S21101 00220010
*A314000                                                         S21101 00221010
*C315000                                                         S21101 00222010
*A316000                                                         S21101 00223010
*C317000                                                         S21101 00224010
*A318000                                                         S21101 00225010
*C319000-320000                                                  S21101 00226010
*A323000,328000                                                  S21101 00227010
*C341000-342000,347000-348000                                    S21101 00228010
*D354000-356000,366000-394000,399000,400000,406000               S21101 00229010
*C407000                                                         S21101 00230010
*A411000                                                         S21101 00231010
*D422000-424000,428000-436000,446000-450000                      S21101 00232010
*C452000,457000,462000,468000,474000,479000                      S21101 00233010
*D483000-487000,489000,494000,500000,507000,521000,525000        S21101 00234010
*A526000,536000                                                  S21101 00235010
*C537000                                                         S21101 00236010
*A539000                                                         S21101 00237010
*C540000-541000,543000                                           S21101 00238010
*A544000                                                         S21101 00239010
*C545000                                                         S21101 00240010
*A546000,547000                                                  S21101 00241010
*C551000,556000-560000,564000                                    S21101 00242010
*A565000,567000                                                  S21101 00243010
*C569000,570000                                                  S21101 00244010
*A573000                                                         S21101 00245010
*C583000,588000                                                  S21101 00246010
*A593000                                                         S21101 00247010
*C594000,601000,606000,615000                                    S21101 00248010
*A626000                                                         S21101 00249010
*C627000                                                         S21101 00250010
*A629000                                                         S21101 00251010
*C631000,636000                                                  S21101 00252010
*A644000                                                         S21101 00253010
*C648000                                                         S21101 00254010
*A650000                                                         S21101 00255010
*C651000-652000                                                  S21101 00256010
*A669000                                                         S21101 00257010
*C728000,742000,770000                                           S21101 00258010
*D545500,614000,672000                                           X01004 00261010
*C119000-120000,296000,302000,589000,590000,593000               X01004 00265010
*A279060-279840,281500,296060-296420,299530-299920,300500,       X01004 00269010
*A411940-411980,516200-516600,521600,531080-531880,532300-532600,X01004 00273010
*A580080-580880,589500,590300-590600,593030-593360,594040-594440,X01004 00277010
*A600300,600640-601080,605500,608500,614900,624500,625300-625600,X01004 00281010
*A626200,626800,627600,630650-631100,637040-637800,653500,658300,X01004 00285010
*A670050-670900,672500,694100-694500,700200-700800,701200-701800,X01004 00289010
*A702040-702880,709200-709800                                    X01004 00293010
*C038000,405000,411400                                         @ZA03118 00296010
*A253000,254000,261100,684000                                  @YA11949 00296110
         EJECT                                                          00400010
*********************************************************************** 00420010
*                                                                     * 00440010
*TITLE -- 'IEDQXA' - TCAM DISK MESSAGE QUEUE INITIALIZER              * 00460010
*                                                                     * 00500010
*STATUS -- CHANGE LEVEL 8                                             * 00600010
*                                                                     * 00700010
*FUNCTION -- THIS ROUTINE CREATES ON DISK EACH KEY AND DATA RECORD    * 00800010
*   OF THE DATA SET WHICH MAY BE USED BY TCAM AS EITHER A REUSABLE    * 00900010
*   OR NON-REUSABLE MESSAGE QUEUE.  IT INSURES THAT THE FORMAT IS     * 01000010
*   COMPATIBLE WITH TCAM'S REQUIREMENTS.                              * 01100010
*                                                                     * 01200010
*ENTRY POINT -- ONLY ONE ENTRY POINT, CALLED BY JOB MANAGEMENT,       * 01300010
*        'IEDQXA' - INITIALIZE TCAM DISK MESSAGE QUEUE                * 01400010
*   CALLING SEQUENCE -                                                * 01500010
*        L     15,=V(IEDQXA)                                          * 01600010
*        BALR  14,15                                                  * 01700010
*                                                                     * 01800010
* INPUT -- PARAMETERS ARE PASSED IN A DD STATEMENT.  THERE IS ONES21101 01900010
*   DD CARD REQUIRED, DDNAME IS 'IEDQDATA'.                      S21101 02000010
*   'IEDQDATA'- DEFINES A NEW DATA SET TO BE CREATED AS AN TCAM       * 02300010
*   DISK MESSAGE QUEUE.  REQUIRED KEYWORDS ARE --                     * 02400010
*   'DSNAME=' - NAME OF DATA SET TO BE CREATED.  THIS SAME NAME IS    * 02500010
*   USED IN AN TCAM JOB JCL DEFINING THE USE OF THIS DATA SET.        * 02600010
*   'DISP=' - 'NEW' MUST BE INDICATED. 'KEEP' OR 'CATLG' MUST         * 02700010
*   ALSO BE USED.  'CATLG' IS PREFERRED.                              * 02800010
*   'SPACE=' - ALLOCATION MUST BE IN 'CYL'.  BOTH PRIMARY AND         * 02900010
*   SECONDARY AMOUNTS MUST BE SPECIFIED, USING AN IDENTICAL AMOUNT.   * 03000010
*   THE REQUEST FOR 'CONTIG' SPACE IS REQUIRED.                       * 03100010
*   'UNIT=' - THE DEVICE MUST BE 2311,2314,OR 3330.  FOR MULTIPLES21101 03200010
*   VOLUME DATA SETS, SPECIFY UNIT=(XXX,N) WHERE N IS NO. VOLUMESS21101 03300010
*   'VOLUME=' - THE SERIAL NUMBER OF EACH EXTENT IS LISTED IN THE     * 03400010
*   ORDER TO BE FORMATTED.  THE NUMBER OF VOLUMES SPECIFIED IS THE    * 03500010
*   SAME AS 'N' IN 'UNIT' (ABOVE).                                    * 03600010
*   'DCB=' - SPECIFICATION OF KEYLEN IS REQUIRED.  VALUE IS LIMITED   * 03700010
*   TO 36 TO 255 INCLUSIVE. THIS VALUE MUST BE                @ZA03118* 03800010
*   THE SAME VALUE AS CODED ON INTRO MACRO IN THE MESSAGE CONTROL     * 03900010
*   PROGRAM ASSEMBLY UNDER THE INTRO KEYWORD 'KEYLEN'.                * 04000010
*                                                                     * 04100010
*   SAMPLE JCL --                                                     * 04200010
*   //JOBNAME JOB MSGLEVEL=1                                          * 04300010
*   //STEP EXEC PGM=IEDQXA                                            * 04400010
*   //IEDQDATA DD DSNAME=DISKQ,DISP=(NEW,CATLG),                      * 04600010
*   //            DCB=(,KEYLEN=252),                             S21101 04700010
*   //            SPACE=(CYL,(20,20),,CONTIG),UNIT=(2311,2),          * 04800010
*   //            VOLUME=SER=(111111,222222)                          * 04900010
*                                                                     * 05000010
*OUTPUT -- THE IEDQDATA DATA SET IS FORMATTED.  THE CONSOLE TYPE-     * 05100010
*   WRITER AND THE PROGRAMMER'S CONSOLE CONTAIN A SERIES OF      S21101 05200010
*   MESSAGES INDICATING THE STATUS OF THE INITIALIZATION.             * 05300010
*                                                                     * 05400010
*EXTERNAL ROUTINES -- 'EXCP' IS USED TO WRITE DUMMY RECORDS TO        * 05500010
*   DISK USING 'EXCP', 'WAIT', 'OPEN', 'CLOSE', 'DCB', 'RDJFCB', S21101 05600010
*   AND 'WTO' (SVC 35) HANDLES OUTPUT TO CONSOLE.                     * 05700010
*                                                                     * 05800010
*EXITS-NORMAL -- REGISTER 15 IS ZERO.  SUCCESSFUL COMPLETION.         * 05900010
*                                                                     * 06000010
*EXITS-ERROR -- REGISTER 15 IS 4.  RESERVED FOR FUTURE DEFINITIONS21101 06100010
*   REGISTER 15 IS 8.  KEYLEN OMITTED OR INVALID                      * 06200010
*   REGISTER 15 IS 12. I/O ERROR IEDQDATA                             * 06300010
*   REGISTER 15 IS 16. ILLEGAL SPACE PARAMETERS                       * 06400010
*   REGISTER 15 IS 20. UNABLE TO OPEN                                 * 06500010
*   IN ALL CASES, THE IEDQDATA DATA SET SHOULD BE SCRATCHED           * 06600010
*   AND RECREATED                                                     * 06700010
*                                                                S21101 06800010
*TABLES/WORK AREAS -- THE JFCB IS READ INTO A LOCAL CONSTANT AREA.    * 06900010
*   THE OUTPUT BUFFER IS A GETMAINED AREA CLEARED TO ZERO.            * 07000010
*                                                                     * 07100010
*ATTRIBUTES -- REUSABLE, ENABLED, PROBLEM PROGRAM MODE, RESIDENT      * 07200010
*                                                                     * 07300010
*NOTES -- THE OPERATION OF THIS ROUTINE DEPENDS UPON AN INTERNAL      * 07400010
*   REPRESENTATION OF THE EXTERNAL CHARACTER SET WHICH IS EQUIVALENT  * 07500010
*   TO THE ONE USED AT ASSEMBLY TIME.  THE CODING HAS BEEN ARRANGED   * 07600010
*   SO THAT REDEFINITION OF 'CHARACTER' CONSTANTS, BY REASSEMBLY,     * 07700010
*   WILL RESULT IN A CORRECT MODULE FOR THE NEW DEFINITIONS.          * 07800010
*                                                                     * 07900010
*   THIS MODULE IS PUT ONTO SYS1.LINKLIB AT SYSGEN TIME.  IT IS       * 08000010
*   EXECUTED PRIOR TO STARTING TCAM TO CREATE A DISK MESSAGE          * 08100010
*   QUEUE DATA SET.                                                   * 08200010
*                                                                     * 08300010
*   MESSAGES GENERATED ON PROGRAMMER'S CONSOLE (ROUTCDE=11) ARE -S21101 08400010
*   'IED067I TCAM INITIALIZATION BEGUN' - START OF EXECUTION     S21101 08500010
*        ROUTCDE=(2,11)                                          S21101 08600010
*        PROCESSING CONTINUES.                                        * 08800010
*   'IED068I UNABLE TO OPEN IEDQDATA' - RETURN CODE 20.  READ         * 08900010
*        JFCB OF IEDQDATA UNSUCCESSFUL.  DD CARD MISSING.             * 09000010
*   'IED069I INVALID KEYLEN FOR IEDQDATA' - RETURN CODE 8.            * 09100010
*        KEYLEN PARAMETER EITHER MISSING OR TOO SMALL.                * 09200010
*   'IED070I IEDQDATA DOES NOT SPECIFY CONTIG SPACE IN CYLINDERS'     * 09300010
*        RETURN CODE 16.  SPACE MUST SPECIFY 'CYL' AND 'CONTIG'.      * 09400010
*   'IED071I UNEQUAL PRIMARY AND SECONDARY EXTENTS ON IEDQDATA'       * 09500010
*        RETURN CODE 16. PRIMARY AND SECONDARY EXTENT SIZES MUST      * 09600010
*        BE IDENTICAL.                                                * 09700010
*   'IED072I I/O ERROR ON IEDQDATA' - RETURN CODE 12.  UNABLE TO      * 09800010
*        RECOVER FROM DISK I/O ERROR ON DISK MESSAGE QUEUE DATA SET.  * 09900010
*        ROUTCDE=(2,10,11)                                       S21101 10000010
*   'IED074I TCAM INITIALIZATION COMPLETE' - RETURN CODE 0.           * 10200010
*        SUCCESSFUL COMPLETION.                                       * 10300010
*        ROUTCDE=(2,11)                                          S21101 10350010
*   'IED075I END OF EXTENT.  RECORD COUNT IS RRRRRRRR, TIME IS NNS21101 10420010
*        SEC' - GIVES TOTAL RECORD COUNT UP THRU CURRENT EXTENT.      * 10490010
*        THIS MSG APPEARS AT THE END OF INITIALIZING EACH VOLUME.S21101 10560010
*        FINAL COUNT IS FOR ENTIRE DATA SET.  INITIALIZATION     S21101 10630010
*        CONTINUES WITH NEXT EXTENT, IF ANY.                     S21101 10700010
*                                                                     * 10800010
*   EACH RECORD FORMATTED CONTAINS COUNT, KEY, AND DATA FIELDS.       * 10900010
*   COUNT FIELD HAS CCHHR ABSOLUTE ADDRESS, KEY AND DATA FIELDS ARE   * 11000010
*   AREA TO RECEIVE TCAM MESSAGE HEADERS AND TEXT INFORMATION. THE    * 11100010
*   DATA AREA HAS ONLY CERTAIN STATUS AND CHAINING INFORMATION.       * 11200010
*                                                                     * 11300010
*********************************************************************** 11320010
         EJECT                                                          11340010
*        REGISTER EQUATES                                               11360010
*                                                                       11380010
R15      EQU   15                       SCRATCH REGISTER, ENTRY ADDR    11400010
R14      EQU   14                       SCRATCH REGISTER, RETURN ADDR   11500010
R13      EQU   13                       PROGRAM BASE, SAVEAREA POINTER  11600010
R12      EQU   12                       ADDR OF SYSPRINT OR DATA DCBS   11700010
R11      EQU   11                       UNUSED                   S21101 11800010
R10      EQU   10                       RECORDS-PER-CPB COUNTER. X01004 11900010
R9       EQU   9                        CCW COUNTER.             X01004 12000010
R8       EQU   8                        ADDR OF JFCB                    12100010
R7       EQU   7                        RECORD COUNTER                  12200010
R6       EQU   6                        VOLUME COUNTER                  12300010
R5       EQU   5                        WORK REG                 S21101 12400010
R4       EQU   4                        RETURN FROM INTERNAL SUBROUTINE 12500010
R3       EQU   3                        RETURN CODE                     12600010
R2       EQU   2                        WORK REG                 S21101 12700010
R1       EQU   1                        PARAMETER PASSER                12800010
R0       EQU   0                        PARAMETER PASSER                12900010
*                                                                       13000010
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 13100010
*                                                                       13200010
         USING IHADCB,R12               DCB DSECT BASE                  13300010
         USING JFCBD,R8                 JFCB DSECT BASE                 13400010
         USING *,R15                    TEMPORARY PROGRAM BASE          13500010
*                                                                       13600010
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 13700010
*                                                                       13800010
         B     SKIP                     BRANCH AROUND CONSTANTS         13900010
*                                                                       14000010
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 14100010
*                                                                       14200010
IEDQXA   IEDHJN ,                                                S22025 14300010
SAVE     DC    18F'0'                   LINKAGE SAVEAREA                14500010
*                                                                       14600010
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 14700010
*                                                                       14800010
SKIP     EQU   *                                                        14900010
         STM   R14,R12,12(R13)          SAVE CALLER'S REGISTERS         15000010
         ST    R13,SAVE+4                                               15100010
         LA    R12,SAVE                                                 15200010
         ST    R12,MYSAVE(,R13)         EXCHANGE SAVEAREA ADDRESSS21101 15300010
         LR    R13,R12                                                  15400010
         DROP  R15                      FORGET TEMPORARY BASE           15500010
         USING SAVE,R13                 ESTABLISH PROGRAM BASE          15600010
*                                                                       15700010
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 15800010
*                                                                       15900010
         EJECT                                                          16300010
         WTO   MF=(E,MSG2)              'INITIALIZATION BEGUN'   S21101 16700010
*                                                                       17500010
         RDJFCB QUES                    READ JFCB OF IEDQDATA TO CORE   17600010
*                                                                       17700010
         CLC   JFCB(175),JFCB+1         WAS JFCB READ SUCCESSFULLY      17800010
         BNE   JFCBOK                     YES, CONTINUE PROCESSING      17900010
*                                         NO, ERROR,DD CARD MISSING     18000010
         WTO   MF=(E,MSG3)              'UNABLE TO OPEN IEDQDATA'S21101 18100010
*                                                                       18300010
         LA    R3,CODE20                SET RETURN CODE                 18400010
CLOSE    EQU   *                                                        18500010
         LR    R15,R3                   GET RETURN CODE TO R15          18900010
         L     R13,SAVE+4                                               19000010
         RETURN (14,12),T,RC=(15)       EXIT                            19100010
*                                                                       19200010
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 19300010
         EJECT                                                          19350010
*                                                                       19400010
JFCBOK   EQU   *                                                        19500010
         LA    R8,JFCB                  SET JFCB DSECT BASE             19600010
         SR    R15,R15                                                  19700010
         IC    R15,JFCKEYLE             GET KEYLEN SPECIFIED ON DD CARD 19800010
         LA    R14,PREFIXSZ             GET MINIMUM KEYLEN PERMITTED    19900010
         CR    R14,R15                  IS KEYLEN BIG ENOUGH            20000010
         BNH   KEYLENOK                   YES, CONTINUE PROCESSING      20100010
*                                         NO, ILLEGAL KEYLEN            20200010
         LA    R3,CODE8                 SET RETURN CODE                 20300010
         WTO   MF=(E,MSG4)              'INVALID KEYLEN' MSG     S21101 20400010
*                                                                       20600010
         B     CLOSE                    QUIT                            20700010
*                                                                       20800010
KEYLENOK EQU   *                                                        20900010
         TM    JFCBCTRI,CYL             DOES SPACE PARAM SAY            21000010
*                                         'CYL' AND 'CONTIG'            21100010
         BO    CYLOK                      YES, CONTINUE PROCESSING      21200010
*                                         NO, FUSS                      21300010
         WTO   MF=(E,MSG5)              'CONTIG CYL NOT SPECIFIEDS21101 21400010
*                                                                       21600010
SET16    EQU   *                                                        21700010
         LA    R3,CODE16                SET RETURN CODE                 21800010
         B     CLOSE                    GO QUIT                         21900010
*                                                                       22000010
CYLOK    EQU   *                                                        22100010
         CLC   JFCBPQTY(3),JFCBSQTY     IS PRIMARY SPACE QUANTITY       22200010
*                                         SAME AS SECONDARY QUANTITY    22300010
         BE    SPACEOK                    YES, CONTINUE PROCESSING      22400010
CYLOK1   EQU   *                                                 A49215 22450010
*                                         NO, FUSS                      22500010
         WTO   MF=(E,MSG6)              'UNEQUAL SIZE EXTENTS'   S21101 22600010
*                                                                       22800010
         B     SET16                    GO SET RETURN CODE AND QUIT     22900010
*                                                                       23000010
SPACEOK  EQU   *                                                        23100010
*                                                                       23200010
         OPEN  (QUES,(OUTPUT)),TYPE=J   OPEN IEDQDATA DATA SET          23300010
*                                                                S21101 23350010
         LA    R12,QUES                 SET IHADCB DSECT BASE TO DATA   23400010
         SR    R6,R6                                                    23600010
         IC    R6,JFCBNVOL              INITIALIZE VOLUME COUNTER       23700010
         SR    R7,R7                    CLEAR RECORD COUNTER            23800010
*                                                                       23900010
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 24000010
         EJECT                                                          24100010
*              INITIALIZE DEVICE DEPENDENT INFORMATION                  24200010
*                                  COMPUTE NUMBER OF RECORDS PER TRACK  24300010
         SPACE 2                                                        24400010
*   RECSTRK=(TRKLEN+BLKOHD-LBLKOVD)/(BLKOVD+(TOLFAC*(DATALEN+KEYLEN))   24500010
         SPACE 1                                                        24600010
         DEVTYPE IEDQDDN,DEVWD1,DEVTAB                                  24700010
         SPACE 1                                                        24800010
         MVC   KEYLEN,JFCKEYLE                                          24900010
         L     R0,JFCBSQTY    SECONDARY CYL LENGTH 3 HGH BYTES   A49215 24910010
         SRL   R0,EIGHT                GET IN LOW 3 BYTES        A49215 24920010
         MH    R0,DEVWD3B              TIMES TRACK LENGTH        A49215 24930010
         LA    R1,QUES                 DCB ADDRESS               A49215 24940010
         L     R1,44(R1)               GET DEB ADDRESS           A49215 24950010
         CH    R0,46(R1)               PRIMARY DEB VS SECOND JFCBA49215 24960010
         BNE   CYLOK1                  NOT EQUAL, - FUSS         A49215 24970010
         SPACE 1                                                        25000010
         SR    R1,R1               CLEAR REG FOR IC USE                 25100010
         LH    R0,DEVWD4A          GET MAX LENGTH                       25200010
         IC    R1,DEVWD4C          GET LBLKOHD                          25300010
         TM    DEVWD5B,DCT10H           ONLY ONE OVERHEAD      @YA11949 25320010
         BZ    USEONE                   BRANCH NO              @YA11949 25340010
         LH    R1,DEVWD4B               USE HALFWORD           @YA11949 25360010
USEONE   EQU   *                                               @YA11949 25380010
         SR    R0,R1               SUBTRACT FROM EFFECTIVE TRK LEN      25400010
         SR    R1,R1                    CLEAR REGS             @YA11949 25450010
         IC    R1,KEYLEN           GET KEY LENGTH                       25500010
         LA    R2,DATALEN(R1)      ADD KEY AND DATA LENGTHS             25600010
         TM    DEVWD5B,DEVTOL      IS TOLERANCE FACTOR USED             25700010
         BZ    INIT1               BRANCH IF NOT                        25800010
*                                                                S21101 25850010
         MH    R2,DEVWD5C          MULTIPLY BY TOLERANCE                25900010
         SRA   R2,DIVBY512         DIVIDE BY 512                 S21101 25970010
INIT1    EQU   *                                                 S21101 26040010
         IC    R1,DEVWD4B          GET BLK OVERHEAD              S21101 26110010
         TM    DEVWD5B,DCT10H           ONLY ONE OVERHEAD      @YA11949 26120010
         BZ    INIT2                    BRANCH NO              @YA11949 26130010
         LH    R1,DEVWD4B               USE HALFWORD           @YA11949 26140010
INIT2    EQU   *                                               @YA11949 26150010
         AR    R0,R1               ADD TO EFFECTIVE TRK LEN             26200010
         AR    R2,R1               ADD TO EFFECTIVE RECORD LEN          26300010
         SRDA  R0,FULLWORD         EXTEND SIGN BIT TO EVEN REG   S21101 26400010
         DR    R0,R2               DIVIDE REMAINING TRACK BY EFF LENGTH 26500010
         STH   R1,RECSTRK          SAVE NUMBER OF RECORDS PER TRACK     26600010
         MH    R1,DEVWD3B          TIMES NUMBER OF TRACKS PER CYL       26700010
         STH   R1,RECSCYL          SAVE NUMBER OF RECORDS PER CYL       26800010
         DROP  R8                                                       26900010
         LA    R8,XCB1             POINT TO ONLY XCB                    27000010
         USING XCBD,R8                                                  27100010
         SPACE 4                                                        27200010
*              CPBSIZE=176+16*(TRKS*(RECS+3))                           27300010
         SPACE 2                                                        27400010
         LH    R1,RECSTRK          GET NUMBER OF RECORDS PER TRACK      27500010
         AH    R1,C3               ADD THREE                            27600010
         MH    R1,DEVWD3B          MULTIPLY BY NUMBER OF TRACKS/CYL     27700010
         LA    R0,SIX(,R1)         ADD 6 FOR NUMBER OF CCWS      S21101 27800010
         STH   R0,NUMCCWS          STORE NUMBER OF CCWS                 27900010
         MVI   SWITCH,CLEAR             INITIALIZE SWITCHES OFF. X01004 27906010
         CLM   R0,HWDMASK,MAXCCWS       MORE THAN 180 CCW'S PER  X01004 27912010
*                                         CYLINDER               X01004 27918010
         BNH   REGULAR                  BRANCH IF NO - NO SPECIALX01004 27924010
*                                         HANDLING REQUIRED.     X01004 27930010
         LH    R1,MAXCCWS               SET R1 = 180.            X01004 27936010
         MH    R1,C16                   MULTIPLY BY WIDTH OF CCW X01004 27942010
*                                         AND DATA.              X01004 27948010
         AH    R1,C64                   ADD SIZE OF CPB PREFIX.  X01004 27954010
         OI    SWITCH,HIGHBIT           SET SWITCH TO INDICATE   X01004 27960010
*                                         SPECIAL HANDLING FOR   X01004 27966010
*                                         180 CCW'S PER EXCP.    X01004 27972010
         B     SETCPB                   GO SET UP CPB SIZE.      X01004 27978010
REGULAR  EQU   *                                                 X01004 27984010
         MH    R1,C16              MULTIPLY BY WIDTH OF CCW AND DATA    28000010
         AH    R1,C176             ADD FIXED CCWS AND CPB PREFIX        28100010
SETCPB   EQU   *                                                 X01004 28150010
         ST    R1,CPBSIZE          SAVE CPBSIZE                         28200010
         LA    R1,XCB1             POINT TO XCB FOR SUBROUTINE          28300010
         BAL   R15,INITCPB          GET FIRST CPB                       28400010
*                                                                S21101 28450010
         LA    R1,XCB1             POINT TO XCB FOR SUBROUTINE          28500010
         BAL   R15,INITCPB         GET SECOND CPB                       28600010
*                                                                S21101 28650010
LOOP     EQU   *                                                        28700010
         L     R1,DCBDEBAD         POINT TO DEB                         28800010
         LA    R1,EXDEB(,R1)       BUMP TO EXTENT PORTION OF DEB S21101 28900010
         LA    R0,XCB1             POINT TO XCB FOR SUBROUTINE          29000010
         BAL   R4,INITXCB          INITIALIZE XCB FROM DEB              29100010
*                                                                S21101 29150010
         MVC   XCBCPB1,WAITLIST    SETUP WAITLIST                       29200010
         MVC   XCBCPB2,WAITLIST+4                                       29300010
         MVI   WAITLIST+4,HIGHBIT  SET END OF WAITLIST           S21101 29400010
         L     R1,XCBCPB1          POINT TO CPB                         29500010
         XC    TRACK(CODE4),TRACK       SET TRACK AND RECORD NUM-X01004 29600010
*                                         BERS TO ZERO.          X01004 29606010
         XC    RECSCPB1(CODE4),RECSCPB1  SET THE 2 RECORDS-PER-  X01004 29612010
*                                      CPB COUNTERS TO ZERO.     X01004 29618010
         OI    SWITCH,STW               SET SWITCH TO INDICATE   X01004 29624010
*                                         1ST 3 CCW'S IN CPB WILLX01004 29630010
*                                         BE SEARCH-TIC-WRITE.   X01004 29636010
         BAL   R4,BUILDCPB              BUILD CPB AND EXCP.      X01004 29642010
*                                                                S21101 29650010
         L     R1,XCBCPB2          POINT TO CPB                         29700010
         B     RESTART             BRANCH INTO INIT LOOP                29800010
*                                                                S21101 29850010
RESTARTU EQU   *                                                 S21101 29900010
         L     R0,XCBRECS          INCR NO, RECS. INIT SO FAR    S21101 29950010
         TM    SWITCH,HIGHBIT           SPECIAL HANDLING         X01004 29953010
         BZ    ADDCYL                   BRANCH IF NO.            X01004 29956010
         CLM   R1,MASK7,XCBCPB1+ONE     DID CPB #1 OR CPB #2     X01004 29959010
*                                       COMPLETE                 X01004 29962010
         BNE   CPB2                     BRANCH IF CPB #2.        X01004 29965010
         AH    R0,RECSCPB1              ADD NUMBER OF RECORDS    X01004 29968010
*                                         (WRITE CCW'S) DONE FOR X01004 29971010
*                                         FIRST CPB.             X01004 29974010
         B     UPDATE                   GO UPDATE RECORD COUNT.  X01004 29977010
CPB2     EQU   *                                                 X01004 29980010
         AH    R0,RECSCPB2              ADD NUMBER OF RECORDS    X01004 29983010
*                                       DONE FOR SECOND CPB.     X01004 29986010
         B     UPDATE                   GO UPDATE RECORD COUNT.  X01004 29989010
ADDCYL   EQU   *                                                 X01004 29992010
         AH    R0,RECSCYL          ADD NUMBER OF RECORDS PER CYL        30000010
UPDATE   EQU   *                                                 X01004 30050010
         ST    R0,XCBRECS          SAVE COUNT FOR END OF EXTENT MSG     30100010
RESTART  EQU   *                                                 S21101 30150010
         BAL   R4,BUILDCPB              BUILD CPB AND EXCP.      X01004 30200010
*                                                                S21101 30250010
         CLC   XCBCOUNT,ZEROS      ANY CPBS STILL ACTIVE ?              30300010
         BE    DONE                NO,  END OF EXTENT                   30400010
*                                                                S21101 30450010
         WAIT  1,ECBLIST=WAITLIST                                       30500010
*                                                                S21101 30550010
         LA    R2,WAITLIST         POINT TO WAITLIST  FIND CPB JUST DON 30600010
         LH    R1,XCBCOUNT         GET ACTIVE CPB COUNT FOR DECR        30700010
         BCTR  R1,0                MINUS ONE                            30800010
         STH   R1,XCBCOUNT         SAVE COUNT                           30900010
         B     W2                  BRANCH INTO LOOP                     31000010
*                                                                S21101 31050010
W1       EQU   *                                                 S21101 31100010
         LA    R2,NEXTWORD(,R2)    POINT TO NEXT CPB POINTER     S21101 31150010
W2       EQU   *                                                 S21101 31200010
         L     R1,0(,R2)           POINT TO CPB                  S21101 31250010
         TM    0(R1),WAITBIT       WAIT COMPLETED                S21101 31300010
         BZ    W1                  NO                                   31400010
*                                                                S21101 31450010
         CLI   0(R1),NORMAL        COMPLETE OK?                  S21101 31520010
         BE    RESTARTU            YES                                  31600010
*                                                                S21101 31650010
         CLI   0(R1),PURGED        PURGED?                       S21101 31720010
         BE    RESTART             RESTART                              31800010
*                                                                S21101 31850010
         WTO   MF=(E,MSG7)              'I/O ERROR IEDQDATA' MSG S21101 31950010
*                                                                       32100010
         LA    R3,CODE12                SET RETURN CODE                 32200010
         B     CLOSDATA                 GO CLOSE BOTH DATASETS          32300010
*                                                                S21101 32350010
DONE     EQU   *                                                        32400010
         LTR   R7,R7                   FIRST TIME THROUGH        A51067 32410010
         BNP   DONE1                   YES, SKIP COMPARE         A51067 32420010
         CLC   XCBRECS,XCBRECCK        IS THIS EXTENT SAME AS LSTA51067 32430010
         BNE   CYLOK1                  NO, ERROR - SECODARY ALLOCA51067 32440010
DONE1    EQU   *                                                 A51067 32450010
         MVC   XCBRECCK,XCBRECS        SAVE THIS EXTENT FOR NEXT A51067 32460010
         A     R7,XCBRECS                                               32500010
         MVC   DCBFDAD,XCBM        SET LAST DISK ADDR USED IN DCB       32600010
         XC    DCBTRBAL,DCBTRBAL   CLEAR TRACK BALANCE                  32700010
         TIME  BIN                                                      32800010
*                                                                S21101 32850010
         S     R0,XCBTIME          SUBTRACT TIME OF XCB START           32900010
         A     R0,TIME             ADD TOTAL TIME SO FAR                33000010
         ST    R0,TIME             SAVE TOTAL                           33100010
         CVD   R0,DOUBLE           CONVERT FOR MSG                      33200010
         UNPK  WORK,DOUBLE+4(4)                                         33300010
         MVC   MSGTIME(4),WORK+2   MOVE IN TIME                         33400010
         DROP  R8                                                       33500010
*                                                                       33600010
EXTENT   EQU   *                                                        33700010
         CVD   R7,DOUBLE                CONVERT RECORD COUNTER          33800010
         UNPK  MSGCNT(8),DOUBLE                                         33900010
         MVZ   MSGCNT+7(1),MSGCNT                                       34000010
         WTO   MF=(E,MSG10)             'END OF EXTENT' MSG      S21101 34100010
*                                                                       34300010
         BCT   R6,FEOV                  WAS THAT THE LAST EXTENT        34400010
*                                         IF NOT, GO DO FEOV            34500010
*                                         IF THAT WAS LAST EXTENT,CONT  34600010
         WTO   MF=(E,MSG9)              'INITIALIZATION COMPLETE'S21101 34700010
*                                                                       34900010
         SR    R3,R3                    RETURN CODE OF ZERO             35000010
         EJECT                                                          35050010
CLOSDATA EQU   *                                                        35100010
         CLOSE (QUES)                                                   35200010
*                                                                       35300010
         B     CLOSE                    GO QUIT                         35700010
*                                                                       35800010
FEOV     EQU   *                                                        35900010
         FEOV  QUES                                                     36000010
*                                                                       36100010
         B     LOOP                                                     36200010
*                                                                       36300010
         EJECT                                                          36350010
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 36400010
*                                                                       36500010
*                       EQUATES                                         39500010
*                                                                       39600010
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 39700010
*                                                                       39800010
CYL      EQU   X'C8'                    BITS 0-1 OF JFCBCTRI ARE '11'   40100010
*                                         FOR 'CYL'.                    40200010
*                                         BIT 4 ON MEANS 'CONTIG'       40300010
DATALEN  EQU   6                        SIZE OF DATA FIELD OF RECORD    40400010
PREFIXSZ EQU   36                       MINIMUM KEYLENGTH      @ZA03118 40500010
CODE4    EQU   4                        RESERVED FOR FUTURE DEF  S21101 40600010
CODE8    EQU   8                        KEYLEN OMITTED OR INVALID       40800010
CODE12   EQU   12                       I/O ERROR IEDQDATA              40900010
CODE16   EQU   16                       ILLEGAL SPACE PARAMETERS        41000010
CODE20   EQU   20                       UNABLE TO OPEN                  41100010
MYSAVE   EQU   8                        OFFSET INTO CALLER'S SA  S21101 41104010
*                                         OF ADDR OF MY SAVEAREA S21101 41108010
TEN      EQU   10                       OFFSET TO CCHH IN UCB    S21101 41112010
CHANUM   EQU   13                       OFFSET TO CHANNEL NO.    S21101 41116010
*                                         IN UCB                 S21101 41120010
NEXTWORD EQU   4                        OFFSET TO NEXT WORD      S21101 41124010
EXDEB    EQU   32                       OFFSET INTO DEB OF EXTENTS21101 41128010
H        EQU   2                        CONDITION 'HIGH'         S21101 41132010
NOTMIXED EQU   9                        CONDITION 'NOT MIXED'    S21101 41136010
CHAINING EQU   X'40'                    IOBFLAG1 VALUE         @ZA03118 41140010
*                                       FOR CHAINING           @ZA03118 41142010
PURGED   EQU   X'44'                    ECB PURGED INDICATOR     S21101 41144010
NORMAL   EQU   X'7F'                    ECB NORMAL COMPLETION    S21101 41148010
WAITBIT  EQU   X'40'                    ECB FLAG FOR WAIT STATE  S21101 41152010
HIGHBIT  EQU   X'80'                    SIGN BIT, INDICATES END  S21101 41156010
ONE      EQU   1                        INCREMENTOR              S21101 41160010
SIZECCW  EQU   8                        BYTES PER CCW            S21101 41164010
CLEAR    EQU   0                        IMMED VALUE TO CLEAR BYTES21101 41168010
SIX      EQU   6                        NO. OF CCWS              S21101 41172010
DIVBY512 EQU   9                        SHIFT COUNT TO DIVIDE BY S21101 41176010
*                                         512                    S21101 41180010
DIVBY2   EQU   1                        SHIFT COUNT TO DIVIDE    S21101 41184010
*                                         BY 2                   S21101 41188010
FULLWORD EQU   32                       SHIFT COUNT FOR FULL REG S21101 41192010
MASK7    EQU   7                        3-BYTE CLM MASK.         X01004 41194010
FIVE     EQU   5                        HH OFFSET IN CPBSEEK.    X01004 41196010
TWO      EQU   2                        LENGTH FOR HH FIELD.     X01004 41198010
*                                                                       41200010
         EJECT                                                          41250010
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 41300010
*                                                                       41400010
*                       CONSTANTS                                       41500010
*                                                                       41600010
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 41700010
*                                                                       41800010
DOUBLE   DC    D'0'                                                     41900010
EXLST    DC    X'87',AL3(JFCB)                                          42000010
JFCB     DC    176C' '                  JFCB                            42100010
*                                                                       42500010
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 42600010
*                                                                       42700010
         EJECT                                                          43200010
QUES     DCB   DSORG=PS,                                               *43700010
               DDNAME=IEDQDATA,                                        *43800010
               MACRF=(W),                                              *43900010
               BLKSIZE=6,                                              *44000010
               RECFM=F,                                                *44100010
               EXLST=EXLST                                              44200010
*                                                                       44300010
         EJECT                                                          44350010
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 44400010
*                                                                       44500010
MSG2     WTO   'IED067I TCAM INITIALIZATION BEGUN',                    *45100010
               ROUTCDE=(2,11),DESC=4,MF=L                        S21101 45200010
IED067I  EQU   MSG2                                                     45300010
         ENTRY IED067I                                                  45400010
*                                                                       45500010
MSG3     WTO   'IED068I UNABLE TO OPEN IEDQDATA',                      *45600010
               ROUTCDE=11,DESC=4,MF=L                            S21101 45700010
IED068I  EQU   MSG3                                                     45800010
         ENTRY IED068I                                                  45900010
*                                                                       46000010
MSG4     WTO   'IED069I INVALID KEYLEN FOR IEDQDATA',                  *46100010
               ROUTCDE=11,DESC=4,MF=L                            S21101 46200010
IED069I  EQU   MSG4                                                     46300010
         ENTRY IED069I                                                  46400010
*                                                                       46500010
MSG5     WTO   'IED070I IEDQDATA DOES NOT REQUEST CONTIG SPACE IN CYLIN*46600010
               DERS',                                                  *46700010
               ROUTCDE=11,DESC=4,MF=L                            S21101 46800010
IED070I  EQU   MSG5                                                     46900010
         ENTRY IED070I                                                  47000010
*                                                                       47100010
MSG6     WTO   'IED071I UNEQUAL PRIMARY AND SECONDARY EXTENTS ON IEDQDA*47200010
               TA',                                                    *47300010
               ROUTCDE=11,DESC=4,MF=L                            S21101 47400010
IED071I  EQU   MSG6                                                     47500010
         ENTRY IED071I                                                  47600010
*                                                                       47700010
MSG7     WTO   'IED072I I/O ERROR ON IEDQDATA',                        *47800010
               ROUTCDE=(2,10,11),DESC=4,MF=L                     S21101 47900010
IED072I  EQU   MSG7                                                     48000010
         ENTRY IED072I                                                  48100010
*                                                                       48200010
MSG9     WTO   'IED074I TCAM INITIALIZATION COMPLETE',                 *48800010
               ROUTCDE=(2,11),DESC=4,MF=L                        S21101 48900010
IED074I  EQU   MSG9                                                     49000010
         ENTRY IED074I                                                  49100010
*                                                                       49200010
MSG10    WTO   'IED075I END OF EXTENT.  RECORD COUNT IS RRRRRRRR, TIME *49300010
               IS NNNN SEC',ROUTCDE=11,DESC=4,MF=L               S21101 49400010
IED075I  EQU   MSG10                                                    49500010
         ENTRY IED075I                                                  49600010
MSGCNT   EQU   MSG10+44                                                 49700010
MSGTIME  EQU   MSG10+62                                                 49800010
*                                                                       49900010
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *S21101 50000010
         EJECT                                                          50050010
         DS    0H                                                       50100010
STARTCPB EQU   *                                                        50200010
*              INITIALIZE IOB AND DATA FOR NEXT EXCP                    50300010
*              TEST IF EXTENT IS DONE, IF NOT START EXCP                50400010
         LR    R14,R1              SAVE CPB POINTER                     50500010
         USING CPBD,R14                                                 50600010
         MVI   CPBFLAG1,CHAINING   SET IOBFLAG1 FOR CHAINING     S21101 50700010
         ST    R1,CPBECBPT-1       STORE ECB PIONTER                    50800010
         MVC   CPBSTART,CPBCCW1+1       SET FIRST CCW POINTER           50900010
         LA    R0,QUES             POINT TO DCB                         51000010
         ST    R0,CPBDCBPT         SAVE DCB POINTER                     51100010
         L     R2,CPBXCB           POINT TO XCB                         51200010
         USING XCBD,R2                                                  51300010
         MVC   CPBBBCC,XCBNBBCC    GET BBCC FOR THIS CPB                51400010
         MVC   CPBSEEK(1),XCBM     GET EXTENT NUMBER                    51500010
         MVC   CPBSEEK+1(4),CPBBBCC     INIT SEEK REQUEST TO IOS        51600010
         TM    SWITCH,ENDCYL            END OF CYLINDER REACHED  X01004 51620010
         BZ    SAMECYL                  BRANCH IF NO - DON'T IN- X01004 51640010
*                                         CREMENT CYLINDER NO.   X01004 51660010
         LH    R0,XCBNCC           INCR CC                              51700010
         AH    R0,C1               ADD ONE TO CC                        51800010
         STH   R0,XCBNCC           SAVE NEW BBCC IN XCB                 51900010
         CLC   CPBCC,XCBCC         IS THIS HIGHER THAN LAST ?           52000010
         BCR   H,R4                YES, DON'T START OR INIT CPB  S21101 52060010
*                                                                S21101 52120010
SAMECYL  EQU   *                                                 X01004 52160010
         LH    R0,XCBCOUNT         GET COUNT OF ACTIVE CPBS             52200010
         AH    R0,C1               ADD ONE                              52300010
         STH   R0,XCBCOUNT         SAVE COUNT                           52400010
         CLI   CPBECB,PURGED       IS THIS A PURGED CPB          S21101 52500010
         BE    EXCP                IF SO DATA ALREADY INIT              52600010
*                                                                S21101 52650010
         L     R2,CPBCCW1          POINT TO FIRST CCW                   52700010
         DROP  R2                                                       52800010
         L     R3,CPBDATA          POINT TO ITS DATA                    52900010
         USING CCWD,R2                                                  53000010
         USING DATAD,R3                                                 53100010
         TM    SWITCH,ENDCYL            END OF CYLINDER REACHED  X01004 53108010
*                                       IN THIS CPB              X01004 53116010
         BZ    FULLCPB                  BRANCH IF NO.            X01004 53124010
         LR    R1,R9                    R1 = NUMBER OF CCW'S IN  X01004 53132010
*                                       THIS CPB.                X01004 53140010
         MH    R1,C8                    MULTIPLY BY SIZE OF CCW. X01004 53148010
         AR    R1,R2                    ADD ADDRESS OF FIRST CCW.X01004 53156010
         NI    SWITCH,FF-ENDCYL         SET END OF CYLINDER FLAG X01004 53164010
*                                         OFF.                   X01004 53172010
         B     SETLAST                  GO COMPUTE LAST CCW ADDR.X01004 53180010
         EJECT                                                          53184010
FULLCPB  EQU   *                                                 X01004 53188010
         LR    R1,R3               COMPUTE LAST CCW                     53200010
*                                                                X01004 53230010
SETLAST  EQU   *                                                 X01004 53260010
         SH    R1,C8               POINT TO LAST CCW                    53300010
         LH    R0,C8                                                    53400010
         L     R15,CPBBBCC         GET CYL ADDR                         53500010
         B     DATAU2              START UPDATE OF DATA                 53600010
*                                                                S21101 53650010
DATAU1   EQU   *                                                 S21101 53680010
         BZ    DATAU3              HANDLE TIC + SEEKHEAD TIC?    S21101 53710010
*                                                                S21101 53740010
         ST    R15,DATA            NO SET BBCC INTO DATA                53800010
         B     DATAU3              BRANCH BACK INTO LOOP                53900010
*                                                                S21101 53950010
DATAU2   EQU   *                                                 S21101 54000010
         TM    CCW,SEEKHEAD-TIC    IS THIS SEEKHEAD OR TIC CCW   S21101 54050010
         BC    NOTMIXED,DATAU1                                   S21101 54100010
*                                                                S21101 54150010
         STH   R15,DATA            NO, STORE CC INTO DATA               54200010
DATAU3   EQU   *                                                 S21101 54260010
         AR    R3,R0               BUMP DATA POINTER             S21101 54320010
         BXLE  R2,R0,DATAU2        R2=ADD  R0=INCR  R1=COMP             54400010
*                                                                S21101 54450010
EXCP     EQU   *                                                 S21101 54500010
         EXCP  CPBIOB                                                   54600010
*                                                                S21101 54650010
         BR    R4                  RETURN TO CALLER                     54700010
*                                                                S21101 54750010
         DROP  R2                                                       54800010
         DROP  R3                                                       54900010
         DROP  R14                                                      55000010
*                                                                S21101 55050010
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *S21101 55100010
*                                                                S21101 55150010
         EJECT                                                          55170010
INITXCB  EQU   *                                                        55200010
         LR    R2,R0               XCB POINTER                          55300010
         USING XCBD,R2                                                  55400010
         L     R3,0(R1)            POINT TO EXTENT UCB                  55500010
         MVC   XCBCHAN,CHANUM(R3)  GET CHANNEL NUMBER            S21101 55600010
         MVI   XCBSTAT1,CLEAR      CLEAR STATUS                  S21101 55700010
         MVI   XCBM,CLEAR          BSAM COMPATABLE               S21101 55800010
         MVC   XCBBB,NEXTWORD(R1)  GET BB                        S21101 55900010
         MVC   XCBCCHH,TEN(R1)     GET CCHH                      S21101 56000010
         MVC   XCBR,RECSTRK+1      SET LAST REC ON TRACK                56100010
         XC    XCBCOUNT,XCBCOUNT   CLEAR COUNTER                        56200010
         XC    XCBRECS,XCBRECS     CLEAR RECORDS ON EXTENT COUNTER      56300010
         MVC   XCBNBBCC,NEXTWORD(R1) GET FIRST BBCC              S21101 56400010
         TIME  BIN                                                      56500010
*                                                                S21101 56550010
         ST    R0,XCBTIME          SAVE TIME OF INIT                    56600010
         BR    R4                  RETURN TO CALLER                     56700010
*                                                                S21101 56750010
         DROP  R2                                                       56800010
*                                                                S21101 56850010
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *S21101 56900010
*                                                                S21101 56950010
         EJECT                                                          56970010
INITCPB  EQU   *                                                 S21101 57000010
         STM   R15,R6,SUBSAVE      SAVE CALLER'S REGS            S21101 57050010
         LR    R2,R1               SAVE XCB POINTER                     57100010
         L     R0,CPBSIZE          GET CPB SIZE FOR GETMAIN             57200010
         GETMAIN R,LV=(0)                                               57300010
*                                                                S21101 57350010
         ST    R1,CPBADDR          SAVE CPB ADDRESS                     57400010
         USING CPBD,R1                                                  57500010
         ST    R2,CPBXCB           SET XCB POINTER                      57600010
         MVC   WAITLIST(8),WAITLIST+4   SLIDE WAITLIST                  57700010
         XC    CPBECB,CPBECB       CLEAR ECB                            57800010
         XC    CPBIOB,CPBIOB       CLEAR IOB                            57900010
         XC    CPBRESV,CPBRESV     CLEAR UNUSED WORD                    58000010
         LM    R15,R6,SUBSAVE           RESTORE CALLER'S REGS.   X01004 58008010
         BR    R15                      RETURN TO CALLER.        X01004 58016010
*                                                                X01004 58024010
         EJECT                                                          58028010
BUILDCPB EQU   *                                                 X01004 58032010
         MVI   CPBECB,CLEAR             CLEAR ECB.               X01004 58040010
         CLC   XCBNCC-XCB(TWO,R8),XCBCC-XCB(R8)  HAVE ALL CYLIN- X01004 58048010
*                                       DERS OF EXTENT BEEN DONE X01004 58056010
         BCR   H,R4                     IF YES, RETURN IMMEDIATE-X01004 58064010
*                                       LY.  DON'T BUILD A CPB   X01004 58072010
*                                       THAT WON'T BE USED.      X01004 58080010
         STM   R15,R6,SUBSAVE           SAVE CALLER'S REGISTERS. X01004 58088010
         L     R2,CPBSIZE          COMPUTE FIXED PORTION OF CPB         58100010
         SH    R2,C64              MINUS 64                             58200010
         SRA   R2,DIVBY2           DIVIDE BY 2                   S21101 58300010
         LA    R3,CPBCCWS(R2)                                           58400010
         ST    R3,CPBDATA          SET DATA POINTER                     58500010
         LA    R2,CPBCCWS          POINT TO FIRST CCW                   58600010
         ST    R2,CPBCCW1          SAVE POINTER                         58700010
         LA    R6,SIZECCW          SET INCR VALUE IN REG         S21101 58800010
         LH    R5,TRACK                 GET CURRENT TRACK NUMBER.X01004 58900010
         LH    R4,RECORD                GET LAST RECORD NUMBER.  X01004 58950010
         MVC   CPBSEEK+FIVE(TWO),TRACK  SET HH IN CPBSEEK.       X01004 59000010
         SR    R9,R9                    SET CCW COUNT TO ZERO.   X01004 59030010
         SR    R10,R10                  SET RECORD COUNT TO ZERO.X01004 59060010
         USING CCWD,R2                                                  59100010
         USING DATAD,R3                                                 59200010
         TM    SWITCH,STW               FIRST 3 CCW'S SEARCH-TIC-X01004 59300010
*                                         WRITE                  X01004 59303010
         BO    STICBLD                  BRANCH IF YES.           X01004 59306010
         TM    SWITCH,STR               FIRST 3 CCW'S SEARCH-TIC-X01004 59309010
*                                         READ KEY AND DATA      X01004 59312010
         BNO   TESTSSTR                 BRANCH IF NO.            X01004 59315010
         LA    R0,MULTITRK(,R0)         SET MULTITRACK INDICATOR.X01004 59318010
         B     BUILDSTR                 GO BUILD SEARCH CCW.     X01004 59321010
TESTSSTR EQU   *                                                 X01004 59324010
         TM    SWITCH,SSTR              FIRST 4 CCW'S SEEK-SEARCHX01004 59327010
*                                         -TIC-READ KEY AND DATA X01004 59330010
         BO    SEEKBLD0                 BRANCH IF YES.           X01004 59333010
* DEFAULT - FIRST 4 CCW'S ARE SEEK-SEARCH-TIC-WRITE.             X01004 59336010
*                                                                S21101 59350010
SEEKBLD  EQU   *                                                 S21101 59400010
         CLM   R9,HWDMASK,MAX177        177 OR MORE CCW'S IN     X01004 59404010
*                                         CHAIN ALREADY          X01004 59408010
         BL    SEEKOK                   BRANCH IF NO TO CONTINUE X01004 59412010
*                                         CHAIN.                 X01004 59416010
         NI    SWITCH,HIGHBIT           SET PREVIOUS SWITCH OFF. X01004 59420010
         OI    SWITCH,SSTW              INDICATE NEXT CPB WILL   X01004 59424010
*                                         START WITH SEEK-SEARCH-X01004 59428010
*                                         TIC-WRITE.             X01004 59432010
         B     BREAK                    BRANCH TO COMMON CODE TO X01004 59436010
*                                         BREAK CCW CHAIN.       X01004 59440010
         EJECT                                                          59442010
SEEKOK   EQU   *                                                 X01004 59444010
         ST    R3,CCW              POINT TO DATA FOR CCW         S21101 59450010
         MVI   CCW,SEEKHEAD        SET CCW OP CODE                      59500010
         MVC   CCW2,SEEKCCW2       SETUP SECOND HALF OF CCW             59600010
         XC    DATA,DATA           CLEAR DATA                           59700010
         STH   R5,DATA3            SET HEAD NUMBER                      59800010
         AR    R2,R6               BUMP POINTER                         59900010
         AR    R3,R6               BUMP POINTER                         60000010
         LA    R9,ONE(,R9)              INCREMENT CCW COUNT.     X01004 60030010
STICBLD  EQU   *                                                 S21101 60060010
         CLM   R9,HWDMASK,MAX177        MORE THAN 177 CCW'S IN   X01004 60064010
*                                         CHAIN ALREADY          X01004 60068010
         BNH   SEARCHOK                 BRANCH IF NO TO CONTINUE X01004 60072010
*                                         CHAIN.                 X01004 60076010
SETSRCH  EQU   *                                                 X01004 60080010
         NI    SWITCH,HIGHBIT           SET PREVIOUS SWITCH OFF. X01004 60084010
         OI    SWITCH,STW               INDICATE NEXT CPB WILL   X01004 60088010
*                                         START WITH SEARCH-TIC- X01004 60092010
*                                         WRITE.                 X01004 60096010
         B     BREAK                    BRANCH TO COMMON CODE TO X01004 60100010
*                                         BREAK CCW CHAIN.       X01004 60104010
SEARCHOK EQU   *                                                 X01004 60108010
         ST    R3,CCW              SET DATA POINTER              S21101 60120010
         MVI   CCW,SEARCHID        SET CCW OP CODE                      60200010
         MVC   CCW2,SEARCH2        SET REST OF CCW                      60300010
         XC    DATA,DATA           CLEAR DATA FOR CCW                   60400010
         STH   R5,DATA2            SET HEAD NUMBER                      60500010
         STC   R4,DATA3A                SET RECORD NUMBER.       X01004 60550010
         ST    R2,CCW+SIZECCW      SET TIC ADDR FOR NEXT CCW     S21101 60600010
         AR    R2,R6               BUMP POINTERS                        60700010
         AR    R3,R6               BUMP POINTERS                        60800010
         LA    R9,ONE(,R9)              INCREMENT CCW COUNT.     X01004 60850010
         MVI   CCW,TIC             SET TIC IN CCW OP CODE               60900010
         XC    CCW2,CCW2           CLEAR REST OF TIC CCW                61000010
         XC    DATA,DATA           CLEAR TIC'S DATA FIELD               61100010
         AR    R2,R6               BUMP POINTER                         61200010
         AR    R3,R6               BUMP POINTER                         61300010
         LA    R9,ONE(,R9)              INCREMENT CCW COUNT.     X01004 61400010
         EJECT                                                          61430010
WRITEBLD EQU   *                                                 S21101 61460010
         LA    R10,ONE(,R10)            INCREMENT RECORD COUNT.  X01004 61490010
         LA    R4,ONE(,R4)         INCR RECORD NUMBER            S21101 61520010
         ST    R3,CCW              SET CCW'S DATA POINTER               61600010
         MVI   CCW,WCKD            SET WRITE COUNT, KEY, AND DATA OP    61700010
         MVC   CCW2,WCKD2          SET REST OF CCW                      61800010
         STH   R5,DATA2            SET HH IN DATA                       61900010
         STC   R4,DATA3A           SET RECORD NUMBER IN DATA            62000010
         MVC   DATA3B,KEYLEN       SET KEYLENGTH IN DATA                62100010
         MVC   DATA4,C6            SET DATALEN IN DATA                  62200010
         AR    R2,R6               BUMP POINTER                         62300010
         AR    R3,R6               BUMP POINTER                         62400010
         LA    R9,ONE(,R9)              INCREMENT CCW COUNT.     X01004 62450010
         CH    R4,RECSTRK          HAVE ALL CCWS FOR TRACK BEEN MADE    62500010
         BNL   NEWTRACK                 BRANCH IF YES.           X01004 62530010
         CLM   R9,HWDMASK,MAXCCWS       HAVE 180 CCW'S BEEN BUILTX01004 62560010
         BL    WRITEBLD            NO, LOOP BACK                        62600010
         B     SETSRCH                  GO SET UP TO BREAK CHAIN.X01004 62620010
*                                                                S21101 62650010
NEWTRACK EQU   *                                                 X01004 62680010
         LA    R5,ONE(,R5)         INCR TRACK                    S21101 62720010
         SR    R4,R4                    CLEAR RECORD NUMBER.     X01004 62760010
         CH    R5,DEVWD3B          ALL TRACKS INIT                      62800010
         BL    SEEKBLD             NO LOOP BACK                         62900010
*                                                                S21101 62950010
         BCTR  R5,0                DECR TO LAST TRACK                   63000010
SEEKBLD0 EQU   *                                                 S21101 63060010
         CLM   R9,HWDMASK,MAX177        177 OR MORE CCW'S IN     X01004 63065010
*                                         CHAIN ALREADY          X01004 63070010
         BL    SEEKOK2                  BRANCH IF NO.            X01004 63075010
         NI    SWITCH,HIGHBIT           SET PREVIOUS SWITCH OFF. X01004 63080010
         OI    SWITCH,SSTR              INDICATE NEXT CPB WILL   X01004 63085010
*                                         START WITH SEEK-SEARCH-X01004 63090010
*                                         TIC-READ KEY AND DATA. X01004 63095010
         B     BREAK                    BRANCH TO COMMON CODE TO X01004 63100010
*                                         BREAK CCW CHAIN.       X01004 63105010
         EJECT                                                          63107010
SEEKOK2  EQU   *                                                 X01004 63110010
         ST    R3,CCW              POINT TO DATA                 S21101 63120010
         MVI   CCW,SEEKHEAD        SET SEEK HEAD OPCODE                 63200010
         MVC   CCW2,SEEKCCW2       SET REST OF CCW                      63300010
         XC    DATA,DATA           CLEAR DATA                           63400010
         SR    R0,R0               CLEAR MULTITRACK IND                 63500010
FINDBLD0 EQU   *                                                 S21101 63560010
         AR    R2,R6               BUMP POINTER                  S21101 63620010
         AR    R3,R6               BUMP POINTER                         63700010
         LA    R9,ONE(,R9)              INCREMENT CCW COUNT.     X01004 63704010
BUILDSTR EQU   *                                                 X01004 63708010
         CLM   R9,HWDMASK,MAX177        MORE THAN 177 CCW'S IN   X01004 63712010
*                                         CHAIN ALREADY.         X01004 63716010
         BNH   SRCHOK2                  BRANCH IF NO.            X01004 63720010
         NI    SWITCH,HIGHBIT           SET PREVIOUS SWITCH OFF. X01004 63724010
         OI    SWITCH,STR               INDICATE NEXT CPB WILL   X01004 63728010
*                                         START WITH SEARCH-TIC- X01004 63732010
*                                         READ KEY AND DATA.     X01004 63736010
*                                                                X01004 63740010
BREAK    EQU   *                                                 X01004 63744010
         STH   R4,RECORD                SAVE LAST RECORD NUMBER  X01004 63748010
*                                         WRITTEN.               X01004 63752010
         STH   R5,TRACK                 SAVE CURRENT TRACK NUMBERX01004 63756010
         SR    R2,R6                    POINT TO LAST CCW IN CPB.X01004 63760010
         NI    CCW2,NOCHAIN             SET COMMAND AND DATA     X01004 63764010
*                                         CHAINING FLAGS OFF.    X01004 63768010
         B     SAVERECS                 GO SAVE RECORD COUNT.    X01004 63772010
*                                                                X01004 63776010
SRCHOK2  EQU   *                                                 X01004 63780010
         ST    R3,CCW              POINT TO DATA                        63800010
         MVC   CCW2,SEARCH2        SETUP 2ND HALF OF CCW                63900010
         STC   R0,CCW              SET MULTI-TRACK IND                  64000010
         OI    CCW,SEARCHID        OR IN SEARCH ID EQUAL OPCODE         64100010
         XC    DATA,DATA           CLEAR DATA                           64200010
         LTR   R0,R0               TEST MULTI-TRACK                     64300010
         BZ    TICBLD0             BRANCH IF NOT ON                     64400010
*                                                                S21101 64450010
         MVC   DATA3A,RECSTRK+1    MAX REC NUMBER                       64500010
         STH   R5,DATA2            SET LAST HEAD                        64600010
         SR    R2,R6               CHANGE TIC ADDR                      64700010
         ST    R2,CCW+(2*SIZECCW)  SETUP TIC *-16                S21101 64800010
         AR    R2,R6               RESTORE POINTER                      64900010
         B     TICBLD1                                                  65000010
*                                                                S21101 65050010
         EJECT                                                          65070010
TICBLD0  EQU   *                                                 S21101 65100010
         ST    R2,CCW+SIZECCW      TIC TO *-8                    S21101 65150010
TICBLD1  EQU   *                                                 S21101 65200010
         AR    R2,R6               BUMP POINTER                  S21101 65250010
         AR    R3,R6                                                    65300010
         LA    R9,ONE(,R9)              INCREMENT CCW COUNT.     X01004 65350010
         MVI   CCW,TIC             TIC IN OPCODE                        65400010
         XC    CCW2,CCW2           CLEAR REST OF TIC                    65500010
         XC    DATA,DATA           CLEAR 'DATA'                         65600010
         AR    R2,R6                                                    65700010
         AR    R3,R6               BUMP POINTER                         65800010
         LA    R9,ONE(,R9)              INCREMENT CCW COUNT.     X01004 65830010
VERFYBLD EQU   *                                                 S21101 65860010
         ST    R3,CCW              POINT TO DATA                 S21101 65920010
         STC   R0,CCW              SET MULITRACK IND                    66000010
         OI    CCW,RKD             OR IN READ KEY AND DATA              66100010
         SR    R4,R4               COMPUTE LENGTH                       66200010
         IC    R4,KEYLEN                                                66300010
         LA    R4,DATALEN(R4)                                           66400010
         STH   R4,CCW2+2           SET IN COUNT OF CCW                  66500010
         MVC   CCW2(2),VERCCW2A    SET REST OF CCW                      66600010
         LTR   R0,R0               IS MULTI TRACK ON                    66700010
         LA    R0,MULTITRK         SET IT ON                            66800010
         BZ    FINDBLD0            WAS IT ON BEFORE                     66900010
*                                                                S21101 66950010
         MVC   CCW2(2),VERCCW2B    SET NO CHAINING IN CCW               67000010
         XC    TRACK(CODE4),TRACK       RESET TRACK AND RECORD   X01004 67005010
*                                         NUMBERS TO ZERO.       X01004 67010010
         NI    SWITCH,HIGHBIT           SET PREVIOUS SWITCH OFF. X01004 67015010
         OI    SWITCH,ENDCYL+STW        INDICATE THAT THE END OF X01004 67020010
*                                         A CYLINDER HAS BEEN    X01004 67025010
*                                         REACHED, AND THAT THE  X01004 67030010
*                                         NEXT CPB WILL START    X01004 67035010
*                                         WITH SEARCH-TIC-WRITE. X01004 67040010
SAVERECS EQU   *                                                 X01004 67045010
         CLM   R1,MASK7,XCBCPB1+ONE-XCB(R8)  CPB #1 OR CPB #2    X01004 67050010
         BNE   BRKCPB2                  BRANCH IF CPB #2.        X01004 67055010
         STH   R10,RECSCPB1             SAVE NUMBER OF RECORDS   X01004 67060010
*                                         WRITTEN FOR CPB #1.    X01004 67065010
         B     ENDINIT                  END OF CPB INITIALIZATIONX01004 67070010
BRKCPB2  EQU   *                                                 X01004 67075010
         STH   R10,RECSCPB2             SAVE NUMBER OF RECORDS   X01004 67080010
*                                       WRITTEN FOR CPB #2.      X01004 67085010
ENDINIT  EQU   *                                                 X01004 67090010
         LM    R15,R6,SUBSAVE      RESTORE CALLER'S REGS                67100010
         B     STARTCPB                 INITIALIZATION DONE-NOW  X01004 67200010
*                                         PREPARE TO EXCP.       X01004 67250010
         EJECT                                                          67270010
*                                                                       67300010
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 67400010
*                                                                       67500010
EIGHT    EQU   8                                                        67550010
         SPACE 1                                                        67560010
         DS    0F                  WORK AREA FOR DEVTYPE MACRO @ZA03118 67570010
DEVWD1   DS    F                   DEVICE TYPE FROM UCB                 67600010
DEVWD2   DS    F                   MAX BLOCK SIZE                       67700010
DEVWD3A  DS    H                   NUMBER OF CYL/PACK                   67800010
DEVWD3B  DS    H                   NUMBER OF TRK/CYL                    67900010
DEVWD4A  DS    H                   MAXIMUM TRACK LENGTH                 68000010
DEVWD4B  DS    X                   BLOCK OVERHEAD   + IF KEYED NOT LAST 68100010
DEVWD4C  DS    X                   BLOCK OVERHEAD   +  F KEYED AND LAST 68200010
DEVWD5A  DS    X                   BLOCK OVERHEAD   - IF NOT KEYED      68300010
DEVWD5B  DS    X                   TRACK CALCULATION SWITCHES           68400010
DCT10H   EQU   X'08'                    HALFWORD OVERHEAD      @YA11949 68450010
DEVWD5C  DS    H                   TOLERANCE FACTOR                     68500010
         SPACE 2                                                        68550010
SUBSAVE  DS    8F                                                       68600010
TIME     DC    F'0'                                                     68700010
C1       DC    H'1'                                                     68800010
C3       DC    H'3'                                                     68900010
C6       DC    H'6'                                                     69000010
C8       DC    H'8'                R0 LENGTH                            69100010
C16      DC    H'16'                                                    69200010
C64      DC    H'64'               CPB PREFIX SIZE                      69300010
C176     DC    H'176'                                                   69400010
MAXCCWS  DC    H'180'                   MAXIMUM CCW'S PER CHANNELX01004 69410010
*                                         PROGRAM FOR AOS.       X01004 69420010
MAX177   DC    H'177'                   MAXIMUM CCW'S BEFORE A   X01004 69430010
*                                         SEARCH-TIC-READ/WRITE  X01004 69440010
*                                         SEQUENCE FOR AOS.      X01004 69450010
ZEROS    DC    H'0'                                                     69500010
WAITLIST DS    2A                                                       69600010
CPBADDR  DS    A                                                        69700010
CPBSIZE  DS    F                                                        69800010
RECSTRK  DS    H                                                        69900010
RECSCYL  DS    H                                                        70000010
RECSCPB1 DS    H                        NUMBER OF RECORDS WRITTENX01004 70020010
*                                         FOR EXCP ON CPB #1.    X01004 70040010
RECSCPB2 DS    H                        NUMBER OF RECORDS WRITTENX01004 70060010
*                                         FOR EXCP ON CPB #2.    X01004 70080010
NUMCCWS  DS    H                                                        70100010
TRACK    DS    H                        NUMBER OF CURRENT TRACK. X01004 70120010
RECORD   DS    H                        NUMBER OF LAST RECORD    X01004 70140010
*                                         WRITTEN ON CURRENT     X01004 70160010
*                                         TRACK.                 X01004 70180010
KEYLEN   DS    X                                                        70200010
         EJECT                                                          70202010
SWITCH   DS    X                        SPECIAL HANDLING SWITCH. X01004 70204010
*                   BIT DEFINITIONS.                             X01004 70208010
*              X'80'                    INDICATES THAT A CYLINDERX01004 70212010
*                                         REQUIRES MORE THAN 180 X01004 70216010
*                                         CCWS.                  X01004 70220010
STW      EQU   X'40'                    INDICATES THAT CPB WILL  X01004 70224010
*                                         START WITH SEARCH-TIC- X01004 70228010
*                                         WRITE SEQUENCE.        X01004 70232010
STR      EQU   X'20'                    INDICATES THAT CPB WILL  X01004 70236010
*                                         START WITH SEARCH-TIC- X01004 70240010
*                                         READ SEQUENCE.         X01004 70244010
SSTR     EQU   X'10'                    INDICATES THAT CPB WILL  X01004 70248010
*                                         START WITH SEEK-SEARCH-X01004 70252010
*                                         TIC-READ SEQUENCE.     X01004 70256010
SSTW     EQU   X'08'                    INDICATES THAT CPB WILL  X01004 70260010
*                                         START WITH SEEK-SEARCH-X01004 70264010
*                                         TIC-WRITE SEQUENCE.    X01004 70268010
ENDCYL   EQU   X'04'                    INDICATES END OF CYLINDERX01004 70272010
*                                         REACHED.               X01004 70276010
*              X'02'                    UNUSED.                  X01004 70280010
*              X'01'                    UNUSED.                  X01004 70284010
*                                                                X01004 70288010
         SPACE 2                                                        70294010
DEVTOL   EQU   X'01'                                                    70300010
TIC      EQU   X'08'                                                    70400010
RKD      EQU   X'0E'                                                    70500010
SEEKHEAD EQU   X'1B'                                                    70600010
WCKD     EQU   X'1D'                                                    70700010
SEARCHID EQU   X'31'                                                    70800010
MULTITRK EQU   X'80'                                                    70900010
NOCHAIN  EQU   X'3F'                    MASK FOR CHAINING FLAGS  X01004 70920010
*                                         OFF IN LAST CCW IN CPB.X01004 70940010
FF       EQU   X'FF'                                             X01004 70960010
HWDMASK  EQU   3                        CLM MASK TO TEST HALFWORDX01004 70980010
WORK     DS    D                                                        71000010
SEEKCCW2 DC    X'40000006'                                              71100010
SEARCH2  DC    X'40000005'                                              71200010
WCKD2    DC    X'60000008'                                              71300010
VERCCW2A DC    X'7000'                                                  71400010
VERCCW2B DC    X'1000'                                                  71500010
XCB1     DS    4D                                                       71600010
XCBRECCK DC    F'0'                                              A51067 71650010
IEDQDDN  DC    CL8'IEDQDATA'                                            71700010
         EJECT                                                          71750010
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 71800010
*                                                                       71900010
*                       DSECTS                                          72000010
*                                                                       72100010
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 72200010
*                                                                       72300010
JFCBD    DSECT                                                          72500010
         IEFJFCBN                                                       72600010
         DCBD  DSORG=PS,DEVD=DA                                         72700010
         SPACE 3                                                 S21101 72800010
DATAD    DSECT                                                          72900010
DATA     DS    0D                                                       73000010
DATA1    DS    H                                                        73100010
DATA2    DS    H                                                        73200010
DATA3    DS    0H                                                       73300010
DATA3A   DS    X                                                        73400010
DATA3B   DS    X                                                        73500010
DATA4    DS    H                                                        73600010
         SPACE 4                                                        73700010
CCWD     DSECT                                                          73800010
CCW      DS    0D                                                       73900010
CCW1     DS    F                                                        74000010
CCW2     DS    F                                                        74100010
         SPACE 3                                                 S21101 74200010
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 74300010
*              EXTENT CONTROL BLOCK    ONE PER EXTENT IN DEB            74400010
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 74500010
         SPACE 2                                                        74600010
XCBD     DSECT                                                          74700010
XCB      DS    0CL32                                                    74800010
XCBSTAT1 DS    XL1                 STATUS OF XCB                        74900010
XCBLAST  EQU   X'80'               LAST XCB IN LIST                     75000010
XCBERR   EQU   X'40'               XCB HAS ERROR IN CPB  HOLD EXCP      75100010
XCBDONE  EQU   X'20'               EXTENT HAS BEEN FORMATED             75200010
XCBMSG   EQU   X'10'               EXTENT FORMATED MSG WRITTEN          75300010
XCBM     DS    XL1                                                      75400010
XCBBBCC  DS    0XL4                                                     75500010
XCBBB    DS    H                                                        75600010
XCBCCHH  DS    0XL4                                                     75700010
XCBCC    DS    H                                                        75800010
XCBHH    DS    H                                                        75900010
XCBR     DS    XL1                                                      76000010
XCBCHAN  DS    CL1                 EBCDIC CHANNEL NUMBER                76100010
XCBCOUNT DS    H                                                        76200010
XCBNBBCC DS    0F                                                       76300010
XCBNBB   DS    H                                                        76400010
XCBNCC   DS    H                                                        76500010
XCBRECS  DS    F                                                        76600010
XCBTIME  DS    F                   TIME OF INIT START                   76700010
XCBCPB1  DS    A                                                        76800010
XCBCPB2  DS    A                                                        76900010
         SPACE 3                                                 S21101 77000010
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 77100010
*              CHANNEL PROGRAM BLOCK  ONE OR MORE PER PHYSICAL CHANNEL  77200010
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 77300010
CPBD     DSECT                                                          77400010
CPBECB   DS    F                                                        77500010
CPBIOB   DS    0CL40                                                    77600010
CPBFLAG1 DS    XL1                 IOBFLAG1                             77700010
CPBFLAG2 DS    XL1                 IOBFLAG2                             77800010
CPBSENS0 DS    XL1                 IOBSENS0                             77900010
CPBSENS1 DS    XL1                 IOBSENS1                             78000010
CPBECBCC DS    XL1                 IOBECBCC                             78100010
CPBECBPT DS    AL3                 IOBECBPT                             78200010
CPBFLAG3 DS    XL1                 IOBFLAG3                             78300010
CPBCSW   DS    CL7                 IOBCSW                               78400010
CPBSIOCC DS    XL1                 IOBSIOCC                             78500010
CPBSTART DS    AL3                 IOBSTART                             78600010
CPBDCBPT DS    A                   IOBDCBPT                             78700010
CPBRESTR DS    A                   IOBRESTR                             78800010
CPBINCAM DS    H                   IOBINCAM                             78900010
CPBERRCT DS    H                   IOBERRCT                             79000010
CPBSEEK  DS    XL8                 IOBSEEK                              79100010
CPBBBCC  DS    0F                  BBCC PORTION OF DISK ADDRESS         79200010
CPBBB    DS    H                                                        79300010
CPBCC    DS    H                                                        79400010
CPBCCW1  DS    A                   POINTER TO FIRST CCW                 79500010
CPBDATA  DS    A                   POINTER TO FIRST DATA                79600010
CPBXCB   DS    A                   POINTER TO XCB FOR THIS CPB          79700010
CPBRESV  DS    F                                                        79800010
CPBCCWS  DS    D                                                        79900010
         END                                                            80000010
