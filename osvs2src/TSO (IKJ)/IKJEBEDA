          TITLE  'TSO EDIT COMMAND   DATA SET ALLOC-UNALLOC  IKJEBEDA'  00200020
IKJEBEDA CSECT                                                          00400020
*A371100,371820                                                  A45715 00460021
*C370500-371000,371700-371800,371900-371920,371960               A45715 00520021
*A398500-399600,844200-844300                                   YA00002 00520201
*D844100                                                        YA00002 00520401
*A294405-294425,372005-372270,844105-844120                      Y01676 00520501
*C396000,462900,528000,529800                                    Y01676 00521001
*D294900-294960                                                  Y01676 00521501
*C386000,529350                                                @YA01909 00527501
*D398500-399600,400000-424000,545500-598000,673500-698000      @YA01909 00533501
*A184050,386500-389000,398010-398350,438300-438600,            @YA01909 00539501
*A845090-845900,878100-878900                                  @YA01909 00569501
*D544500-782200                                                @YA01909 00575502
*D167000,184300,185200-186600,229600,260600-261200,267000      @YA01909 00577502
*D832000-842000,844200,884000-92000,943000                     @YA01909 00579502
*C29800-30200                                                  @YA03621 00581502
*D31800-322000                                                 @YA03621 00587502
*A316500                                                       @YA03621 00593502
*A166700,170600-171200,443260-443930,449000-453000             @YA03621 00596502
*A443580-443600,443750,443766-443772,443960,449700-450400      @YA07252 00597502
*A452600-452700                                                @YA07252 00598302
*            USE SYSGEN DEFAULT BLOCKSIZE FOR RUN              @ZA13879 00599103
*            MERGE TO EMPTY, VB DATA SET                       @ZA14272 00599503
*********************************************************************** 00600020
*                                                                     * 00800020
* STATUS -- VERSION NO. 01, OS/360 RELEASE NO. 20                     * 01400020
*                                                                     * 02000020
* FUNCTION -- IKJEBEDA WILL BE CALLED TO                              * 02040020
*    1) ALLOCATE A SEQUENTIAL DATA SET WITH DISPOSITION NEW, CATLG,   * 02080020
*    DELETE                                                           * 02120020
*    2) MARK A DSE ENTRY NOT-IN-USE                                   * 02160020
*    3) UNALLOCATE A SEQUENTIAL DATA SET                              * 02180020
*    FOR ALLOCATION A DSNAME WILL BE GENERATED IN THE FORM-           * 02200020
*    'USERID.SUBCOMMANDNAME.DYYDDD.TTTTTTTT'                          * 02240020
*    IKJDAIR IS INVOKED FOR ALLOCATION AND UPON RETURN, THE DSNAME,   * 02280020
*    LENGTH AND DDNAME ARE SAVED IN THE COMMUNICATION AREA. IKJDAIR   * 02320020
*    IS INVOKED ALSO TO MARK THE DSE ENTRY AND FOR UNALLOCATION.      * 03320020
*                                                                     * 04800020
* ENTRY POINTS -- IKJEBEDA, MAIN ENTRY POINT                          * 04860020
*                                                                     * 04920020
* INPUT -- REGISTER 1 POINTS TO THE COMMUNICATION AREA WHERE CASAFLAG * 04960020
*    HAS BEEN INITIALIZED TO ONE OF THE FOLLOWING-                    * 05000020
*    XXX0 XX0X  FIRST ALLOCATION REQUEST                              * 05040020
*    XXX1 XX0X  FIRST MARK DSE REQUEST                                * 05080020
*    XXX0 XX1X  SECOND ALLOCATION REQUEST                             * 05120020
*    XXX1 XX1X  FIRST UNALLOCATION REQUEST                            * 05160020
*                                                                     * 05200020
* OUTPUT -- TWO RETURN CODES ARE POSSIBLE                             * 05400020
*                                                                     * 05600020
*    0 - NORMAL RETURN                                                * 05800020
*                                                                     * 06000020
*    4 - REQUESTED ACTION UNSUCCESSFUL                                * 06200020
*                                                                     * 06400020
* EXTERNAL REFERENCES --                                              * 06600020
*                                                                     * 06800020
*         IKJDAIR   TMP SERVICE ROUTINE, ALLOCATES AND UNALLOCATES    * 06900020
*                   THE QSAM DATA SET.                                * 07000020
*                                                                     * 07400020
*         IKJEFF18  DAIRFAIL(DYNAMIC ALLOC. ERROR DIAGNOSIS RTN.)     * 07460001
*                                                                     * 07520001
*         IKJEBEMS  EDIT MESSAGE SELECTION ROUTINE, CAUSES TERMINAL   * 07600020
*                   MESSAGES TO BE PRINTED.                           * 07800020
*                                                                     * 08000020
*         MACROS USED                                                 * 08200020
*                                                                     * 08400020
*         IKJEBEMI  MESSAGE MACRO                                     * 08600020
*                                                                     * 08800020
*         IKJEBEML  CREATES PARAMETER LIST FOR IKJEBEMS               * 09000020
*                                                                     * 09200020
*         IKJEBESV  ENTRY LINKAGE                                     * 09250020
*                                                                     * 09300020
*         IKJEBERT  EXIT LINKAGE                                      * 09350020
*                                                                     * 09400020
*         IKJEBEMG  CREATES PARMLIST FOR MESSAGE INSERTIONS           * 09450020
*                                                                     * 09500020
*         IKJEBECA  DEFINES COMMUNICATION AREA DSECT                  * 09550020
*                                                                     * 09600020
*         IKJDAPL   DEFINES IKJDAIR PARAMETER LIST.                   * 09800020
*                                                                     * 10000020
*         IKJDAP08  DEFINES IKJDAIR PARAMETER BLOCK FOR ENTRY CODE 8  * 10200020
*                                                                     * 10250020
*         IKJDAP18  DEFINES IKJDAIR PARAMETER BLOCK FOR ENTRY CODE 18 * 10260020
*                                                                     * 10300020
*         IKJDAP2C  DEFINES PARAMETER BLOCK FOR DAIR ENTRY CODE 2C.   * 10400020
*                                                                     * 10600020
*         TIME      SYSTEM MACRO - RETURNS DATE AND TIME IN REGISTERS * 10800020
*                   0 AND 1                                           * 11000020
*                                                                     * 11200020
*         LINK      SYSTEM MACRO - PASSES CONTROL TO IKJDAIR          * 11400020
*                   AND TO DAIRFAIL(IKJEFF18)                         * 11500001
*                                                                     * 11600020
* EXITS, NORMAL -- TO INVOKING MODULE WITH RETURN CODE IN REGISTER 15 * 11800020
*                                                                     * 12000020
* EXITS, ERROR -- NONE                                                * 12200020
*                                                                     * 12400020
* TABLES/WORK AREAS --                                                * 12600020
*    1) IKJEBECA, EDIT COMMUNICATION AREA                             * 12800020
*    2) DATRTAB, TRANSLATION TABLE                                    * 12900020
*    3) DARCTAB, PRINTABLE CHARACTER RETURN CODE TABLE                * 13000020
*                                                                     * 13200020
* ATTRIBUTES -- REFRESHABLE, ENABLED, NON-PRIVILEGED                  * 13300020
*                                                                     * 13400020
* CHARACTER CODE DEPENDENCY -- NONE                                   * 13500020
*                                                                     * 13600020
* NOTES -- STANDARD CONVENTIONS                                       * 13660020
*                                                                     * 13720020
*********************************************************************** 13800020
         EJECT                                                          13900020
*THE FOLLOWING EQU'S ALLOW SYMBOLIC ADDRESSING OF REGISTERS             14000020
PARMREG0 EQU   0                       CONTAINS TIME AFTER TIME MACRO   14200020
PARMREG1 EQU   1                       CONTAINS DATE AFTER TIME MACRO,  14400020
*                                      ADDRESSES SR PARMLIST AND        14600020
*                                      DAIR PARMLIST DSECT              14800020
DSECTREG EQU   2                       ADDRESSES PARM BLOCK DSECTS      15000020
DISPREG  EQU   3                       CONTAINS DISPLACEMENT TO CURRENT 15200020
*                                      POSITION IN DSNAME               15400020
OPREG    EQU   4                       CONTAINS ADDRESS OF QUALIFIER TO 15600020
*                                      BE MOVED TO DSNAME               15800020
LENREG   EQU   5                       CONTAINS LENGTH OF QUALIFIER     16000020
*                                      BEING MOVED                      16200020
TLNREG   EQU   6                       CONTAINS TOTAL LENGTH OF DSNAME  16400020
WKREG    EQU   7                       GENERAL REGISTER                 16600020
UPTREG   EQU   8                       ADDRSABILITY TO UPT     @YA03621 16700002
COMMREG  EQU   9                       CONTAINS ADDR OF COMMUNICATION   16800020
*                                      AREA                             17000020
DAPREFIX EQU   10                      PTR TO USERID/PREFIX    @YA03621 17060002
*                                      IN UPT                  @YA03621 17120002
BASEREG  EQU   11                      USED BY IKJEBESV MACRO           17200020
SAVEREG  EQU   13                      CONTAINS ADDR OF SAVE AREA       17400020
RETREG   EQU   14                      CONTAINS ADDR OF RETURN ENTRY PT 17600020
RETCDREG EQU   15                      CONTAINS RET CODE FROM IKJDAIR   17800020
         SPACE                                                          18000020
*THE FOLLOWING EQU'S ALLOW SYMBOLIC REFERENCE TO CHARACTER AND          18200020
*DECIMAL CONSTANTS                                                      18400020
KZERO    EQU   0                       CONSTANT OF 0           @YA01909 18405001
KONE     EQU   1                       CONSTANT OF 1                    18410020
KTWO     EQU   2                       CONSTANT OF 2                    18420020
KFIVE    EQU   5                       CONSTANT OF 5                    18440020
KSEVEN   EQU   7                       CONSTANT OF 7                    18450020
KEIGHT   EQU   8                       CONSTANT OF 8                    18460020
K16      EQU   16                      CONSTANT OF 16                   18470020
K23      EQU   23                      CONSTANT OF 23                   18480020
K27      EQU   27                      CONSTANT OF 27                   18485020
K43      EQU   43                      CONSTANT OF 43                   18490020
K76      EQU   76                      CONSTANT OF 76                   18500020
K80      EQU   80                      CONSTANT OF 80                   18510020
         SPACE                                                          21200020
D0       EQU   0                       DISPLACEMENT OF 0                21250020
D1       EQU   1                       DISPLACEMENT OF 1                21300020
D2       EQU   2                       DISPLACEMENT OF 2                21350020
D3       EQU   3                       DISPLACEMENT OF 3                21400020
D4       EQU   4                       DISPLACEMENT OF 4                21450020
D8       EQU   8                       DISPLACEMENT OF 8                21500020
         SPACE                                                          22600020
DAOFF    EQU   X'00'                   BIT MASK                         22630020
DAUP     EQU   X'0F'                   BIT MASK                         22660020
DAON     EQU   X'80'                   BIT MASK                         22690020
DAEC8    EQU   X'08'                   DAIR ENTRY CODE 08               22720020
DAEC18   EQU   X'18'                   DAIR ENTRY CODE 18               22730020
DAEC2C   EQU   X'2C'                   DAIR ENTRY CODE 2C               22750020
DAOPC    EQU   X'01'                   DAIR OPTION CODE 01              22780020
DASCRTCH EQU   X'10'                   SCRATCH DS INDICATOR             22790020
DAALL    EQU   X'FF'                   BIT MASK                         22810020
DADOT    EQU   C'.'                    CHARACTER PERIOD                 22840020
DACD     EQU   C'D'                    CHARACTER D                      22870020
DACM     EQU   C'M'                    CHARACTER M                      22880020
DACT     EQU   C'T'                    CHARACTER T                      22900020
DABLANK  EQU   C' '                    CHARACTER BLANK                  22930020
         SPACE                                                          24600020
LENGTH   EQU   0                       CONSTANT OF 0                    24800020
NOBR     EQU   0                       CONSTANT OF 0                    25000020
         EJECT                                                          25200020
*********************************************************************** 25400020
         IKJEBESV (14,12),,*           ENTRY LINKAGE                    25600020
         SPACE                                                          25800020
         USING IKJEBECA,COMMREG        ADDRESSIBILITY TO                25900002
*                                      COMMUNICATIONS AREA              26000002
         XC    DADAIR(K76),DADAIR      ZERO PARM BLOCK                  26140020
         LA    PARMREG1,CATMPLST       ADDR OF TMP SR PARMLIST          26200020
         USING DAPL,PARMREG1           ADDRESSABILITY OF DAPL DSECT     26400020
         L     WKREG,CAPTTMP           ADDR OF TMP PARMLIST             26500020
         L     OPREG,CPPLPSCB-CPPL(WKREG) ADDR OF PSCB                  26600020
         ST    OPREG,DAPLPSCB          FOURTH WD OF PARMLIST            27000020
         NI    DALAST,DAOFF            SET SW TO ZERO                   27200020
         TM    CASAFLAG,CASADISP       DISP=OLD -- UNALLOC              27400020
         BO    DA000400                BR YES TO SET UP UNALLOC         27600020
         LA    DSECTREG,DAPARM8        ADDR OF ALLOC PARMBLOCK          27800020
         ST    DSECTREG,DAPLDAPB       FIFTH WD OF PARMLIST             28000020
         USING DAPB08,DSECTREG         ADDRESSABILITY OF PBLOCK DSECT   28200020
         MVI   DA08DDN,DABLANK         BLANK OUT                        28250020
         MVC   DA08DDN+D1(K23),DA08DDN DDNAME AND MEMBER NAME           28300020
         MVC   DA08MNM(K16),DA08DDN    AND PASSWORD                     28350020
         MVI   DA08CD+D1,DAEC8         ENTRY CODE 08                    28400020
         TM    CASAFLAG,CASAUNCG       SECOND ALLOCATION                28460020
         BO    DA000250                BR YES                           28520020
         MVI   DADSN8,DABLANK          INIT DSNAME TO BLANKS            28600020
         MVC   DADSN8+D1(K43),DADSN8   PROPAGATE BLANKS                 28800020
         LA    DISPREG,DADSNL8         ADDR OF DSNAME LENGTH            29000020
         ST    DISPREG,DA08PDSN        PTR TO DSNAME AND LENGTH         29200020
         MVI   DA08DSP1,DA08NEW        DISP1=NEW                        29260020
         MVI   DA08DPS2,DA08DEL        DISP2=DELETE                     29320020
         MVI   DA08DPS3,DA08DELE       DISP3=DELETE                     29380020
         MVI   DA08CTL,DA08PERM        PERMANENT ALLOCATION             29440020
         TM    CASAFLG2,CASANCTG       CHECK IF DISP OF NEW,     Y01676 29440501
*                                      CATALOG APPLIES           Y01676 29441001
         BZ    DA000000                IF NOT BR TO GENERATE     Y01676 29441501
*                                      DSNAME                    Y01676 29442001
         MVI   DA08DPS2,DA08CAT        SET DISP. 2 TO 'CATLG'    Y01676 29442501
         EJECT                                                          29500020
*********************************************************************** 29600020
*                                                                     * 29800002
*THE FIRST QUALIFIER, 'USERID', IS APPENED BY DAIR.                   * 30000002
*THE SECOND QUALIFIER, 'SUBCOMMANDNAME', IS OBTAINED                  * 30200002
*FROM THE COMMUNICATION AREA AND MOVED TO DSNAME. THE THIRD AND FOURTH* 30400020
*QUALIFIERS 'DYYDDD' AND 'TTTTTTTT' (DATE AND TIME), ARE OBTAINED BY  * 30600020
*ISSUING THE SYSTEM TIME MACRO, UNPACKING THE RESULTS AND MOVING THEM * 30800020
*TO DSNAME.                                                           * 31000020
*********************************************************************** 31200020
DA000000 EQU   *                                                        31250020
         LA    DISPREG,KTWO(DISPREG)   PTR TO DSNAME                    31400020
         SR    TLNREG,TLNREG           TOTAL LENGTH INIT TO 0           31600020
         OI    DA08CTL,DA08UID         APPEND USERID           @YA03621 31700002
         L     OPREG,CAPTSCMD          ADDR OF SUBCOMMMAND NAME         32400020
         LH    LENREG,CASCMDLN         LENGTH OF SUBCOMMAND NAME        32600020
         BAL   WKREG,DAMOVE            BR TO MOVE ROUTINE               32800020
         TIME                                                           33000020
         SPACE                                                          33200020
         MVI   D0(DISPREG),DACD        MOVE 'D' TO DSNAME               33400020
         LA    DISPREG,KONE(DISPREG)   ADD ONE TO DISPLACEMENT          33600020
         LA    TLNREG,KONE(TLNREG)     ADD ONE TO TOTAL LENGTH          33800020
         ST    PARMREG1,DAUNPK         DATE IN PACKED DECIMAL           34000020
         OI    DAUNPK+D3,DAUP          OR LAST BYTE WITH X'0F'          34200020
         UNPK  DAUNPK2,DAUNPK          UNPACK DATE                      34400020
         LA    OPREG,DAUNPK2+D3        PTR TO DATE                      34600020
         LA    LENREG,KFIVE            LENGTH=5                         34800020
         BAL   WKREG,DAMOVE            BR TO MOVE ROUTINE               35000020
         ST    PARMREG0,DAUNPK         TIME IN PACKED DECIMAL           35200020
         OI    DAUNPK+D3,DAUP          OR LAST BYTE WITH X'0F'          35400020
         UNPK  DAUNPK2,DAUNPK          UNPACK TIME                      35600020
         MVI   D0(DISPREG),DACT        MOVE 'T' TO DSNAME               35800020
         LA    DISPREG,KONE(DISPREG)   ADD ONE TO DISPLACEMENT          36000020
         LA    TLNREG,KONE(TLNREG)     ADD ONE TO TOTAL LENGTH          36200020
         LA    OPREG,DAUNPK2           PTR TO TIME                      36400020
         LA    LENREG,KSEVEN           LENGTH=7                         36600020
         BAL   WKREG,DAMOVE            BR TO MOVE ROUTINE               37000020
         LA    LENREG,KEIGHT           SET MAXIMUM LENGTH=8      A45715 37050021
         LA    OPREG,CADSQUAL+KSEVEN   ADDRESS OF LAST BYTE OF   A45715 37100021
*                                       DATA SET QUALIFIER FIELD A45715 37120021
DA000005 EQU   *                                                        37150020
         CLI   D0(OPREG),DABLANK       IS CHARACTER = ' '               37160020
         BNE   DA000006                BR NO TO MOVE QUALIFIER   A45715 37170021
         BCTR  OPREG,NOBR              DECREMENT DISPLACEMENT IN A45715 37180021
*                                         QUALIFIER FIELD BY ONE A45715 37185021
         BCT   LENREG,DA000005         DECREMENT LENGTH BY ONE,  A45715 37190021
*                                         BR TO REPEAT COMPARE   A45715 37192021
DA000006 EQU   *                                                        37194020
         LA    OPREG,CADSQUAL          PTR TO DS QUALIFIER FIELD A45715 37196021
         OI    DALAST,DAON             TURN ON LAST TIME SWITCH         37198020
         BAL   WKREG,DAMOVE            BR TO MOVE QUALIFIER             37198420
         STH   TLNREG,DADSNL8          TOTAL LENGTH OF DSNAME           37200020
         EJECT                                                          37200101
***************************************************************  Y01676 37200501
*                                                                Y01676 37201001
*THE SECTION BELOW ESTABLISHES THE BLOCKSIZE OF THE QSAM         Y01676 37201501
*UTILITY DATA SET, AND REQUESTS APPROPRIATE DIRECT ACCESS        Y01676 37202001
*SPACE FOR THE DATA SET.                                         Y01676 37202501
*                                                                Y01676 37203001
***************************************************************  Y01676 37203501
         SPACE                                                          37204001
         LH    PARMREG0,CABLKS         OBTAIN QSAM UTILITY     @ZA13879 37204503
*                                      TENTATIVE BLOCKSIZE       Y01676 37205001
         TM    CACFLAG2,CARECFM        CHECK IF EDIT DATA SET    Y01676 37205501
*                                      OF VARIABLE FORMAT        Y01676 37206001
         BZ    DA000010                IF SO, USE TENTATIVE      Y01676 37206501
*                                      BLOCKSIZE                 Y01676 37207001
         LH    PARMREG1,CABLKS         OTHERWISE, OBTAIN       @ZA13879 37207103
*                                      TENTATIVE BLOCKSIZE       Y01676 37207503
*                                      FOR USE IN COMPUTATION    Y01676 37207603
*                                      OF THE FINAL COPY BLOCK   Y01676 37207703
*                                      SIZE.                     Y01676 37207803
         SR    PARMREG0,PARMREG0       CLEAR 1ST HALF DIVIDEND   Y01676 37207903
         LH    WKREG,CALRECL           OBTAIN LRECL OF DATA SET  Y01676 37208001
         SH    WKREG,CONTRLEN          ADJUST LENGTH FOR         Y01676 37208501
*                                      CONTROL WORD IN RECORDS   Y01676 37209001
         DR    PARMREG0,WKREG          DIVIDE BLKSIZE BY LRECL   Y01676 37209501
         SH    PARMREG0,CABLKS         SUBTRACT QSAM BLKSIZE   @ZA13879 37210003
*                                      FROM REMAINDER            Y01676 37210501
         LCR   PARMREG0,PARMREG0       COMPLEMENT FOR VALID      Y01676 37211001
*                                      BLOCK SIZE                Y01676 37211501
DA000010 EQU   *                                                 Y01676 37212001
         STH   PARMREG0,CABLK2         SPECIFY FINAL COPY        Y01676 37212501
*                                      BLOCKSIZE                 Y01676 37212603
         LR    WKREG,PARMREG0          SAVE IT FOR DAIR INIT   @ZA14272 37212703
         SR    PARMREG0,PARMREG0       CLEAR REGISTER            Y01676 37213501
         L     PARMREG1,CAUTILNO       OBTAIN NO. OF RECORDS     Y01676 37214001
*                                      IN UTILITY DATA SET       Y01676 37214501
         LTR   PARMREG1,PARMREG1       TEST FOR EMPTY UTILITY    Y01676 37215001
         BNP   DA000015                IF SO, SPACE REQUEST IS   Y01676 37215501
*                                      ONE PHYSICAL RECORD       Y01676 37216001
         MH    PARMREG1,CALRECL        MULTIPLY RECORD COUNT BY  Y01676 37216501
*                                      LOGICAL RECORD LENGTH     Y01676 37217001
         DR    PARMREG0,WKREG          DETERMINE NO. OF BLOCKS   Y01676 37218001
*                                      REQUIRED TO CONTAIN DATA  Y01676 37218501
*                                      SET                              37219001
DA000015 EQU   *                                                 Y01676 37219501
         AH    PARMREG1,DAC1           INCREASE SPACE QUANTITY   Y01676 37220001
*                                      TO BE REQUESTED BY ONE    Y01676 37220501
         TM    CASAFLG2,CASADQTY       DOUBLE SPACE REQUEST -    Y01676 37221001
         BZ    DA000020                IF NOT, BR TO ESTABLISH   Y01676 37221501
*                                      NORMAL SPACE REQUEST      Y01676 37222001
         AR    PARMREG1,PARMREG1       DOUBLE COMPUTED SPACE     Y01676 37222501
DA000020 EQU   *                                                 Y01676 37223001
         NI    CASAFLG2,DAALL-CASADQTY-CASANCTG RESET SPECIAL    Y01676 37223501
*                                      DATA SET FLAGS TO ZERO    Y01676 37224001
         ST    WKREG,DA08BLK           ESTABLISH DAIR BLKSIZE    Y01676 37224501
         ST    PARMREG1,DA08PQTY       PRIMARY QUANTITY REQUEST  Y01676 37225001
         ST    PARMREG1,DA08SQTY       SECONDARY QUANTITY REQ.   Y01676 37225501
         OI    DA08CTL,DA08ABKL        SPECIFY REQUEST TO BE     Y01676 37226001
*                                      BASED ON PHYSICAL         Y01676 37226501
*                                      RECORDS                   Y01676 37227001
         EJECT                                                          37300020
*********************************************************************** 37400020
*                                                                     * 37600020
*IKJDAIR IS CALLED TO ALLOCATE A QSAM DATA SET WITH THE GENERATED     * 37800020
*DSNAME. IF THE ALLOCATION IS SUCCESSFUL, THE DSNAME AND LENGTH ARE   * 38000020
*STORED IN THE COMMUNICATION AREA, AND CONTROL IS RETURNED TO THE     * 38200020
*INVOKING MODULE WITH A RETURN CODE OF 0. IF THE ALLOCATION IS NOT    * 38400020
*SUCCESSFUL, DAIRFAIL(IKJEFF02) IS INVOKED TO DIAGNOSE THE            * 38600001
*ALLOCATION ERROR, WITH THE FOLLOWING EXCEPTIONS:                     * 38650001
*  RETURN CODE IS 48       -- THE RETURN CODE IS RESET TO 8 AND       * 38700001
*                             CONTROL IS RETURNED TO THE CALLER       * 38750001
*  MODULE QUALIFIER IS OBJ -- THE RETURN CODE IS SET TO 0             * 38800001
*                             AND CONTROL IS RETURNED TO THE          * 38850001
*                             CALLER                                  * 38900001
*                                                                     * 39000020
*********************************************************************** 39200020
         LA    PARMREG1,CATMPLST       ADDR OF TMP SR PARMLIST          39400020
DA000040 LINK  EP=IKJDAIR              LINK TO DAIR FOR ALLOCATE Y01676 39600001
         SPACE                                                          39800020
         LTR   RETCDREG,RETCDREG       TEST DAIR RETURN CODE   @YA01909 39801001
         BZ    DA000200                IF ZERO, BR TO CONTINUE @YA01909 39802001
         CH    RETCDREG,DARETC48       TEST FOR R.C. OF 48     @YA01909 39803001
         BNE   CONTINUE                                        @YA01909 39804001
         LA    RETCDREG,KEIGHT         IF R.C.=48, RESET TO 8  @YA01909 39805001
         B     DA000500                AND RETURN TO CALLER    @YA01909 39806001
CONTINUE EQU   *                                               @YA01909 39807001
         LA    OPREG,CASADSN           ADDRESS DSNAME          @YA01909 39808001
         LH    LENREG,CASADSNL         LENGTH OF DSNAME        @YA01909 39809001
         AR    OPREG,LENREG            ADD DISP TO END OF DSN  @YA01909 39810001
         SH    OPREG,DAC3              BACK UP THREE BYTES     @YA01909 39811001
         CLC   D0(D3,OPREG),DAOBJ      IS LAST QUALIFIER OBJ   @YA01909 39812001
         BNE   DA000025                IF NOT, DIAGNOSE ERROR  @YA01909 39813001
         LA    RETCDREG,KZERO          OTHERWISE, SET RETURN   @YA01909 39814001
*                                      CODE TO ZERO AND RETURN @YA01909 39815001
         B     DA000500                TO CALLER               @YA01909 39816001
DA000025 EQU *                                                          39817001
         ST    RETCDREG,RETCODE        SAVE DAIR RETURN CODE   @YA01909 39818001
         LA    PARMREG1,CATMPLST       SET UP REQUIRED PARM    @YA01909 39819001
*                                      LIST  FOR DAIRFAIL      @YA01909 39820001
         ST    PARMREG1,DAPLPTR        PUT ADDR. DAIR PLST     @YA01909 39821001
*                                      INTO DAIRFAIL PLST.     @YA01909 39822001
         LA    PARMREG1,RETCODE        ADDR. DAIR RETURN CODE  @YA01909 39823001
         ST    PARMREG1,RETPTR         ST IN DAIRFAIL PLST     @YA01909 39824001
         LA    PARMREG1,MSGSIGN        ADDR. SIGNAL TO         @YA01909 39825001
*                                      DAIRFAIL TO LOAD, CALL, @YA01909 39826001
*                                      AND DELETE THE          @YA01909 39827001
*                                      MESSAGE WRITER          @YA01909 39828001
         ST    PARMREG1,MSGWTR         ST IN DAIRFAIL PLST     @YA01909 39829001
         LA    PARMREG1,CALLERID       ADDR. OF INTERFACE ID   @YA01909 39830001
         ST    PARMREG1,IDPTR          ST IN DAIRFAIL PLST     @YA01909 39831001
         LA    PARMREG1,FAILPLST       INVOKE THE DAIRFAIL     @YA01909 39832001
*                                      SERVICE ROUTINE FOR     @YA01909 39833001
*                                      DIAGNOSIS OF THE        @YA01909 39834001
         LINK  EP=IKJEFF18             ALLOCATION ERROR.       @YA01909 39835001
         SPACE                                                          42600020
DA000050 EQU   *                                                        42800020
         LA    RETCDREG,KEIGHT         RETURN CODE = 8                  43000020
DA000100 EQU   *                                                        43200020
         IKJEBERT (14,12),,RC=(15)     EXIT LINKAGE                     43400020
         SPACE                                                          43600020
DA000200 EQU   *                                                        43800020
         TM    DADAIR+DA08DARC-DAPB08,DAALL  DARC FIELD = 0    @YA01909 43830001
         BNZ   DA000025             NO, BR TO DIAGNOSE ERROR   @YA01909 43860001
         TM    CASAFLAG,CASADISP       UNALLOCATION                     43900020
         BO    DA000500                BR YES TO RETURN                 44000020
         TM    CASAFLAG,CASAUNCG       SECOND ALLOCATION                44260020
         BO    DA000225                BR YES                           44320020
         L     UPTREG,CAPTUPT       ADDRESS OF UPT             @YA03621 44326002
         USING UPT,UPTREG           ADDRESSABILITY TO UPT      @YA03621 44332002
         L     DAPREFIX,UPTPREFX+4  WORD CONTAINING PREFIX     @YA03621 44338002
         L     WKREG,DAZERO3        CONSTANT TO ZERO 3 BYTES   @YA03621 44344002
         NR    DAPREFIX,WKREG       ZERO THREE BYTES LEAVING LENGTH     44350002
*                                 OF PREFIX/USERID IN REGISTER @YA03621 44356002
         LTR   DAPREFIX,DAPREFIX     IF LENGTH IS ZERO,        @YA07252 44358002
         BZ    DA000210              BYPASS MOVING PREFIX      @YA07252 44360002
         MVC   CASADSN(DAPREFIX),UPTPREFX PUT DATASET NAME     @YA03621 44362002
*                            PREFIX IN COMM. AREA              @YA03621 44368002
         DROP  UPTREG                                          @YA03621 44374002
DA000210 EQU  *                                                @YA07252 44375002
         LA    DISPREG,CASADSN         ADDR OF DSN SAVE AREA   @YA03621 44376002
         LTR   DAPREFIX,DAPREFIX       IF LENGTH IS ZERO,      @YA07252 44376602
         BZ    DA000215                BYPASS MOVING PERIOD    @YA07252 44377202
         AR    DISPREG,DAPREFIX        1ST BYTE AFTR QUALIFIER @YA03621 44378002
         MVI   D0(DISPREG),DADOT       PUT PERIOD AFTER FIRST  @YA03621 44380002
*                                      QUALIFIER OF NAME       @YA03621 44386002
         LA    DISPREG,KONE(DISPREG)   ADD ONE FOR '.' TO LEN  @YA03621 44393002
DA000215 EQU   *                                               @YA07252 44396002
         L     WKREG,DA08PDSN          PTR TO DSNAME FIELD              44400020
         LH    LENREG,D0(WKREG)        DSNAME LENGTH                    44600020
         BCTR  LENREG,NOBR             MINUS ONE FOR EXECUTE            44800020
         EX    LENREG,DACAMOVE         MOVE NAME              @YA03621  44900002
         LTR   DAPREFIX,DAPREFIX       IF LENGTH IS ZERO      @YA07252  44970002
         BZ    DA000220                PLUS ONE FOR EXECUTE   @YA07252  45040002
* FROM DAIR CONTROL BLOCK TO COMM AREA                        @YA03621  45120002
         LA    LENREG,KTWO(LENREG)     PLUS ONE FOR EXECUTE             45200002
* AND PLUS ONE FOR '.' AFTER 1ST QUALIFIER                    @YA03621  45250002
         B     DA000221                                        @YA07252 45260002
DA000220 LA    LENREG,KONE(LENREG)                             @YA07252 45270002
DA000221 AR    LENREG,DAPREFIX         ADD 1ST QUALFIER LENGTH @YA03621 45300002
         STH   LENREG,CASADSNL         SAVE LENGTH IN COMMAREA          45400020
DA000225 MVC   CASADDN(L'CASADDN),DA08DDN SAVE DAIR DDNAME              45600020
         B     DA000500                RETURN                           45900020
         SPACE                                                          46210020
DA000250 EQU   *                                                        46220020
         LA    WKREG,CASADSNL          PTR TO DSNAME                    46240020
         ST    WKREG,DA08PDSN          STORE IN PARM BLOCK              46250020
         MVI   DA08DSP1,DA08OLD        DISP=OLD                         46260020
         MVI   DA08DPS2,DA08DEL        DISP2=DELETE                     46270020
         MVI   DA08CTL,DA08PERM        PERMANENT ALLOCATION             46280020
         B     DA000040                BR TO LINK TO DAIR        Y01676 46290001
         EJECT                                                          46300020
*********************************************************************** 46400020
*                                                                     * 46600020
*THE FOLLOWING SUBROUTINE MOVES THE QUALIFIER TO THE DSNAME FIELD,    * 46800020
*INCREMENTS THE DISPLACEMENT AND TOTAL LENGTH BY THE LENGTH OF THE    * 47000020
*QUALIFIER, MOVES A '.' AFTER THE QUALIFIER UNLESS IT IS THE LAST,    * 47200020
*UPS THE DISPLACEMENT AND TOTAL LENGTH BY ONE, AND RETURNS.           * 47400020
*                                                                     * 47600020
*********************************************************************** 47800020
DAMOVE   BCTR  LENREG,NOBR             MINUS ONE FOR EXECUTE            48000020
         EX    LENREG,DAMVC            MOVE QUALIFIER TO DSNAME         48200020
         LA    LENREG,KONE(LENREG)     PLUS ONE FOR EXECUTE             48400020
         AR    DISPREG,LENREG          INCR DISPLACEMENT                48600020
         AR    TLNREG,LENREG           INCR TOTAL LENGTH                48800020
         TM    DALAST,DAON             LAST QUALIFIER SW ON             49000020
         BO    DA000300                BR YES TO RETURN                 49200020
         MVI   D0(DISPREG),DADOT       MOVE '.' TO DSNAME               49400020
         LA    DISPREG,KONE(DISPREG)   DISP+1                           49600020
         LA    TLNREG,KONE(TLNREG)     TOTAL LENGTH+1                   49800020
DA000300 EQU   *                                                        50000020
         BR    WKREG                   BR TO MAIN ROUTINE               50200020
         EJECT                                                          50400020
*********************************************************************** 50420020
*                                                                     * 50440020
*SET UP PARAMETER BLOCK FOR ENTRY CODE '2C'. THE DDNAME OF THE        * 50460020
*GENERATED DSNAME IS PASSED TO IKJDAIR.                               * 50480020
*                                                                     * 50500020
*********************************************************************** 50520020
DA000400 EQU   *                                                        50600020
         TM    CASAFLAG,CASAUNCG       ENTRY FOR X'18'                  50700020
         BO    DA000450                BR YES                           50800020
         LA    DSECTREG,DAPARM2C       ADDR OF PARM BLOCK               51000020
         ST    DSECTREG,DAPLDAPB       FIFTH WD OF PARMLIST             51400020
         USING DAPB2C,DSECTREG         ADDRESSABILITY OF PBLOCK DSECT   51480020
         MVI   DA2CCD+D1,DAEC2C        MOVE IN ENTRY CODE               51560020
         MVC   DA2CDDN(D8),CASADDN     MOVE DDNAME                      51640020
         MVI   DA2CCD+D3,DAOPC         MOVE IN OPTION CODE              51720020
         B     DA000040                BR TO CALL IKJDAIR        Y01676 52800001
         SPACE                                                          52809020
*********************************************************************** 52818020
*                                                                     * 52827020
*SET UP PARAMETER BLOCK FOR ENTRY CODE X'18'. THE DSNAME IS OBTAINED  * 52836020
*FROM THE COMMUNICATION AREA.                                         * 52845020
*                                                                     * 52854020
*********************************************************************** 52863020
DA000450 EQU   *                                                        52872020
         LA    DSECTREG,DAPARM18       ADDR OF PARM BLOCK               52881020
         ST    DSECTREG,DAPLDAPB       STORE IN PARMLIST                52890020
         USING DAPB18,DSECTREG         ESTABLISH PBLOCK ADDRESSABILITY  52899020
         MVI   DA18CD+D1,DAEC18        ENTRY CODE = X'18'               52908020
         MVI   DA18DDN,DABLANK         INIT THE REST OF THE PARM        52917020
         MVC   DA18DDN+D1(K27),DA18DDN BLOCK TO BLANKS                  52926020
         XC    DA18DPS2(KTWO),DA18DPS2 ZERO DISP AND CTL       @YA01909 52935001
         MVI   DA18DPS2,DA18DEL        SET DISPOSITION TO               52944020
         MVI   DA18CTL,DASCRTCH        SET SCRATCH DS SWITCH            52953020
         LA    WKREG,CASADSNL          PTR TO DSNAME                    52962020
         ST    WKREG,DA18PDSN          AND LENGTH                       52971020
         B     DA000040                LINK TO IKJDAIR           Y01676 52980001
         SPACE                                                          53000020
DA000500 EQU   *                                                        53100020
         NI    CASAFLAG,DAALL-CASADISP-CASAUNCG TURN OFF ALL SWITCHES   53200020
         B     DA000100                BR TO EXIT                       53400020
         SPACE                                                          53600020
*********************************************************************** 53700020
DACAMOVE MVC   D0(LENGTH,DISPREG),D2(WKREG)                             53900002
DAMVC    MVC   D0(LENGTH,DISPREG),D0(OPREG) MOVE QUALIFIER TO DSNAME    54200020
*********************************************************************** 54300020
         EJECT                                                          78240020
IKJEBEDA CSECT                                                          78260020
         SPACE                                                          78280020
         SPACE                                                          83000020
DAC1     DC    H'1'                    CONSTANT OF ONE           Y01676 84410501
CONTRLEN DC    H'4'                    CONTROL WORD LENGTH       Y01676 84411001
DABLOCKS DC    H'3156'                 MAXIMUM BLKSIZE FOR       Y01676 84411501
*                                      FINAL COPY OPERATION      Y01676 84412001
DARETC48 DC    H'48'                   RETURN CODE 48           YA00002 84430001
DAC3     DC    AL2(3)                  CONSTANT OF THREE                84450020
DAOBJ    DC    C'OBJ'                  OBJ QUALIFIER                    84500020
CALLERID DC    H'1'                    USED BY IKJEFF18 TO     @YA01909 84509001
*                                      IDENTIFY INTERFACE VIA  @YA01909 84518001
*                                      WHICH AN ERROR OCCURRED @YA01909 84527001
*                                      ID=1 INDICATES THAT THE @YA01909 84536001
*                                      GENERAL CALLER IS USING @YA01909 84545001
*                                      THE DAIR INTERFACE      @YA01909 84554001
*                                      PARAMETER LIST.         @YA01909 84563001
MSGSIGN  DC    F'0'                    SIGNAL TO IKJEFF18 TO   @YA01909 84572001
*                                      LOAD, CALL, AND DELETE  @YA01909 84581001
*                                      (IKJEFF02)              @YA10909 84590001
DAZERO3  DC    X'000000FF'            CONSTANT TO ZERO 3 BYTES @YA03621 84595002
         EJECT                                                          84600020
*********************************************************************** 85200020
COMMAREA IKJEBECA                      COMMMUNICATION AREA              85400020
*********************************************************************** 86000020
         EJECT                                                          86100020
         ORG   CASRWKA                 WORK AREA                        86200020
         SPACE                                                          86300020
DADAIR   DS    0F                                                       86400020
DAPARM8  DS    19F                     PARAMETER BLOCK FOR ALLOC        86600020
DAPARM18 EQU   DAPARM8                 PARAMETER BLOCK FOR UNALLOC      86700020
DAPARM2C EQU   DAPARM8                 PARAMETER BLOCK FOR NOT IN USE   86800020
         SPACE                                                          87000020
         SPACE                                                          87200020
DADSNL8  DS    H                       LENGTH OF DSNAME                 87400020
DADSN8   DS    CL44                    DSNAME                           87600020
         SPACE                                                          87800020
FAILPLST DS    0F                      DAIRFAIL PARAMETER LIST @YA01909 87820001
DAPLPTR  DS    A                       PTR TO DAIR PLST        @YA01909 87830001
RETPTR   DS    A                       PTR TO DAIR RETURN CODE @YA01909 87840001
MSGWTR   DS    A                       PTR TO MSGSIGN          @YA01909 87850001
IDPTR    DS    A                       PTR TO CALLERID         @YA01909 87860001
RESERVED DS    F                       RESERVED WORD PASSED    @YA01909 87870001
*                                      TO IKJEFF18             @YA01909 87880001
RETCODE  DS    F                       IKJDAIR RETURN CODE     @YA01909 87890001
         SPACE                                                          87900001
         ORG   CATEMPBF                WORK AREA                        88000020
         SPACE                                                          88200020
         SPACE                                                          92200020
         DS    0F                                                       92400020
DAUNPK   DS    1F                      UNPACK                           92600020
DAUNPK2  DS    1D                      FIELDS                           92800020
DALAST   DS    X                       LAST QUALIFIER SWITCH            93400020
         EJECT                                                          93600020
         IKJDAPL                                                        93800020
         IKJDAP08                                                       94000020
         IKJDAP18                                                       94050020
         IKJDAP2C                                                       94100020
         IKJCPPL                                                        94200020
         IKJUPT                                                         94300002
         END                                                            94400020
