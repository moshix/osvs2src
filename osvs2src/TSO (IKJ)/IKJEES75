IKJEES75 CSECT                 MODULE FOR I/O FOR LISTBC                00050020
         TITLE    'IKJEES75 - LISTBC I/O MODULE'                        00060020
*********************************************************************** 00200002
*                                                                     * 00250002
*   MODULE-NAME= IKJEES75                                             * 00300002
*                                                                     * 00350002
*   DESCRIPTIVE-NAME= LISTBC I/O MODULE                               * 00400002
*                                                                     * 00450002
*   COPYRIGHT= NONE                                                   * 00500002
*                                                                     * 00550002
*   STATUS= OS/VS2, REL.2, LEVEL=0                                    * 00600002
*                                                                     * 00650002
*   FUNCTION= THIS ROUTINE PERFORMS BDAM I/O, ENQ/DEQ, AND PUTLINE    * 00700002
*     SERVICES FOR THE LISTBC COMMAND PROCESSOR.                      * 00750002
*                                                                     * 00800002
*     OPERATION= AN I/O PARM LIST WITH FUNCTION REQUEST BITS          * 00850002
*       RECEIVED AS INPUT TO IKJEES75 DETERMINES THE PROCESSING       * 00900002
*       PERFORMED BY THIS ROUTINE. THE FOLLOWING FUNCTIONS MAY BE     * 00950002
*       REQUESTED AND ARE SATISFIED IN THE ORDER LISTED:              * 01000002
*       - LOAD PUTLINE MODULES                                        * 01050002
*       - OPEN SYS1.BRODCAST (BROADCAST DATA SET) FOR BDAM I/O        * 01100002
*       - SHARED ENQ 'SYSIKJBC':'000000'X                             * 01150002
*       - DEQ 'SYSIKJBC':'000000'X                                    * 01200002
*       - EXCLUSIVE ENQ 'SYSIKJBC':RBA (RELATIVE BLOCK ADDRESS)       * 01250002
*       - DEQ 'SYSIKJBC':RBA                                          * 01300002
*       - READ MESSAGE/DIRECTORY RECORD BY RBA, DEVICE ADDR FDBK      * 01350002
*       - READ RECORD1                                                * 01400002
*       - WRITE MESSAGE/DIRECTORY RECORD BY RBA                       * 01450002
*       - WRITE (DELETE) MESSAGE RECORD BY RBA                        * 01500002
*       - PUTLINE ERROR/BROADCAST MESSAGE                             * 01550002
*       - CLOSE SYS1.BRODCAST (IF OPEN) AND RELEASE DCB/MACRO LISTS   * 01600002
*       - DELETE PUTLINE MODULES                                      * 01650002
*       ONLY ONE READ/WRITE OPERATION WILL BE HANDLED PER ENTRY.      * 01700002
*       ALL FUNCTION REQUEST BITS ARE CLEARED BEFORE CONTROL IS       * 01750002
*       RETURNED TO THE CALLER.                                       * 01800002
*       A DYNAMIC WORKAREA FOR A BDAM DCB, MACRO LISTS, ETC. IS       * 01850002
*       OBTAINED BY IKJEES75 ON FIRST ENTRY. A PTR TO THIS AREA       * 01900002
*       (TO THE DCB) IS SAVED IN THE I/O PARM LIST FOR USE IN         * 01950002
*       SUBSEQUENT INVOKATIONS VIA THE SAME LIST.  THIS AREA IS       * 02000002
*       NOT RELEASED UNTIL SPECIFICALLY REQUESTED BY THE CALLER.      * 02050002
*                                                                     * 02100002
*   NOTES=                                                            * 02150002
*                                                                     * 02200002
*     DEPENDENCIES=                                                   * 02250002
*                                                                     * 02300002
*       CHARACTER-CODE-DEPENDENCIES= THE OPERATION OF THIS MODULE     * 02350002
*         DEPENDS UPON AN INTERNAL REPRESENTATION OF THE EXTERNAL     * 02400002
*         CHARACTER SET WHICH IS EQUIVALENT TO THE ONE USED AT        * 02450002
*         ASSEMBLY TIME. THE DEPENDENCY CODE IS C.                    * 02500002
*                                                                     * 02550002
*     RESTRICTIONS= NONE                                              * 02600002
*                                                                     * 02650002
*     REGISTER-CONVENTIONS= SEE PROGRAM LABEL 'REGS'.                 * 02700002
*                                                                     * 02750002
*     PATCH-LABEL= SPARE                                              * 02800002
*                                                                     * 02850002
*   MODULE-TYPE= PROCEDURE                                            * 02900002
*                                                                     * 02950002
*     PROCESSOR= ASM                                                  * 03000002
*                                                                     * 03050002
*     MODULE-SIZE= 1602 BYTES                                         * 03100002
*                                                                     * 03150002
*     ATTRIBUTES= REENTERABLE                                         * 03200002
*                                                                     * 03250002
*   ENTRY-POINT= IKJEES75                                             * 03300002
*                                                                     * 03350002
*     PURPOSE= PERFORM ONE OR MORE FUNCTIONS DESCRIBED IN 'OPERATION' * 03400002
*                                                                     * 03450002
*     LINKAGE= CALLED BY IKJEES70                                     * 03500002
*                                                                     * 03550002
*     INPUT=                                                          * 03600002
*       REGISTER 1 CONTAINS THE ADDRESS OF AN I/O PARM LIST.          * 03650002
*         (SEE PROGRAM DSECT LABEL 'BCIOPARM'.)                       * 03700002
*       REGISTER 4 CONTAINS THE ADDRESS OF A READ-WRITE BUFFER        * 03750002
*         (FOR SPECIAL RECORD1 OR FOR DIRECTORY RECORD).              * 03800002
*       REGISTER 5 CONTAINS THE ADDRESS OF A READ-WRITE BUFFER        * 03850002
*         (FOR MESSAGE RECORD) PREFIXED BY A DUMMY PUTLINE            * 03900002
*         SEGMENT HEADER.                                             * 03950002
*                                                                     * 04000002
*   EXIT-NORMAL=                                                      * 04050002
*                                                                     * 04100002
*     CONDITION= RETURN TO ADDRESS PASSED IN REGISTER 14 UPON         * 04150002
*       SUCCESSFUL COMPLETION OF PROCESSING.                          * 04200002
*                                                                     * 04250002
*     OUTPUT= REQUESTED FUNCTION HAS BEEN PERFORMED. SEE 'OPERATION'. * 04300002
*                                                                     * 04350002
*     RETURN-CODES= 0                                                 * 04400002
*                                                                     * 04450002
*   EXIT-ERROR=                                                       * 04500002
*                                                                     * 04550002
*     CONDITION= RETURN TO ADDRESS PASSED IN REGISTER 14 UPON         * 04600002
*       UNSUCCESSFUL TERMINATION OF PROCESSING.                       * 04650002
*                                                                     * 04700002
*     OUTPUT= ERROR MESSAGE IDENTIFYING FAILURE IS ISSUED TO THE      * 04750002
*       TERMINAL ASSOCIATED WITH THE REQUEST.                         * 04800002
*                                                                     * 04850002
*     RETURN-CODES= 4                                                 * 04900002
*                                                                     * 04950002
*   EXTERNAL-REFERENCES=                                              * 05000002
*       LSTBMSG -- LABEL IN IKJEES74 (LISTBC CP MESSAGE MODULE)       * 05050002
*                                                                     * 05100002
*     ROUTINES=                                                       * 05150002
*       IKJPUTL IS LOADED, CALLED TO ISSUE MESSAGES TO THE            * 05200002
*         TERMINAL, AND DELETED AS DIRECTED BY THE CALLER.            * 05250002
*                                                                     * 05300002
*     DATA-AREAS=                             MACRO-DSECTS=           * 05350002
*       SYS1.BRODCAST DATA SET                     --                 * 05400002
*       DCB                                   X    DCBD               * 05450002
*       PUTLINE PARAMETER BLOCK               X    --                 * 05500002
*       IOPL                                       --                 * 05550002
*       IKJEES74 (PUTLINE PARAMETER BLOCKS)        --                 * 05600002
*       MACRO LIST FORMS, DECB                X    --                 * 05650002
*       BCIOPARM                                   --                 * 05700002
*       READ/WRITE BUFFERS                         --                 * 05750002
*                                                                     * 05800002
*     CONTROL-BLOCKS= NONE                                            * 05850002
*                                                                     * 05900002
*   TABLES= TRANSLATE TABLE FOR PRINTABLE HEX CONVERSION              * 05950002
*                                                                     * 06000002
*   MACROS=                                   SERVICE-ROUTINES=       * 06050002
*     MODID                                        --                 * 06100002
*     DCBD                                         --                 * 06150002
*     OPEN                                         SVC19              * 06200002
*     ENQ                                          SVC56              * 06250002
*     DEQ                                          SVC48              * 06300002
*     READ                                         READ               * 06350002
*     WRITE                                        WRITE              * 06400002
*     CHECK                                        CHECK              * 06450002
*     CLOSE                                        SVC20              * 06500002
*     PUTLINE                                      IKJPUTL            * 06550002
*     GETMAIN                                      SVC10              * 06600002
*     FREEMAIN                                     SVC10              * 06650002
*     LOAD                                         SVC8               * 06700002
*     DELETE                                       SVC9               * 06750002
*     RETURN                                       --                 * 06800002
*                                                                     * 06850002
*     SERIALIZATION= NONE                                             * 06900002
*                                                                     * 06950002
*   CHANGE-ACTIVITY= S/D SUPPORT CODE IS Y02676.                      * 07000002
*                                                                     * 07050002
*   MESSAGES= (TEXT RESIDENT IN IKJEES74)                             * 07100002
*     IKJ56905I -- BROADCAST DATA SET NOT USABLE+                     * 07150002
*                  I/O SYNAD ERROR                                    * 07200002
*     IKJ56458 --  BROADCAST DATA SET NOT USABLE,                     * 07250002
*                  I/O SYNAD ERROR                                    * 07300002
*                  CANNOT OPEN DATA SET                               * 07350002
*     IKJ56459 --  BROADCAST DATA SET NOT USABLE,                     * 07400002
*                  CANNOT OPEN DATA SET                               * 07450002
*     IKJ56959I -- COMMAND SYSTEM ERROR+                              * 07500002
*                  PUTLINE ERROR CODE --                              * 07550002
*                                                                     * 07600002
*   ABEND-CODES= NONE                                                 * 07650002
*                                                                     * 07700002
*********************************************************************** 07750002
         EJECT                                                          08700020
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 08750020
*                                                                     * 08800020
*        MAPPING DSECT FOR PARAMETERS TO COMMUNICATE FUNCTIONS TO BE  * 08850020
*        DONE- BETWEEN THE LISTBC MAIN MODULE AND THE I/O MODULE      * 08900020
*                                                                     * 08950020
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 09000020
BCIOPARM DSECT                    DSECT FOR PARMS TO I/O MODULE         09050020
*                                                                     * 09100020
BCIOF1   DS    1C                 FLAGS FOR OPERATIONS                  09150020
BCOPEN   EQU   X'80'              PERFORM OPEN                          09200020
BCENQ    EQU   X'40'              PERFORM ENQUEUE                       09250020
BCRD     EQU   X'20'              READ SPECIFIED RECORD                 09300020
BCRD1    EQU   X'10'              READ FIRST RECORD                     09350020
BCUNUSED EQU   X'08'              ISSUE CHECK                           09400020
BCDEQ    EQU   X'04'              PERFORM DEQUEUE                       09450020
BCCLOSE  EQU   X'02'              INDICATES CLOSE                       09500020
BCPUTL   EQU   X'01'              PERFORM PUTLINE                       09550020
*                                                                     * 09600020
BCIOF2   DS    1C                 FLAGS FOR OPERATIONS                  09650020
BCDIRR   EQU   X'80'              FLAG FOR DIRECTORY BUFFER      Y02676 09700002
BCENQX   EQU   X'40'              ENQUEUE FOR EXCLUSIVE USE      Y02676 09750002
BCLOAD   EQU   X'20'              LOAD PUTLINE MODULES                  09800020
BCDELETE EQU   X'10'              DELETE PUTLINE MODULES                09850020
BCWRITE  EQU   X'08'              WRITE RECORD                          09900020
BCDEQX   EQU   X'04'              DEQ FROM EXCLUSIVE ENQ                09950020
*                                                                     * 10000020
BCIOF3   DS    1C                 FLAGS FOR MESSAGE NUMBERS             10050020
BCERFLG  EQU   X'80'              INDICATES ERROR CONDITION             10100020
BC1LVL   EQU   X'40'              INDICATES ONE-LEVEL MESSAGE           10150020
BCTXTIN  EQU   X'20'              INDICATES TEXT INSERTION REQUIRED     10200020
BCHXCV   EQU   X'10'              INDICATES THAT RETURN CODE MUST BE    10250020
*                                 CONVERTED TO PRINTABLE HEX            10300020
*                                                                     * 10500020
BCPERMF  DS    1C                 FLAGS SET FOR LIFE OF LISTBC          10550020
BCDCB    EQU   X'80'              INDICATE DCB IS NOT SET UP            10600020
BCMSGSW  EQU   X'40'              MESSAGES FOUND                        10650020
BCMAIL   EQU   X'20'              MAIL KEYWORD ON COMMAND               10700020
BCNOTICE EQU   X'10'              NOTICE KEYWORD ON COMMAND             10750020
BCLOGON  EQU   X'08'              CONTROL COMES FROM LOGON ROUTINE      10800020
BCERROR  EQU   X'04'              FLAG FOR I/O ERROR                    10850020
BCPUTER  EQU   X'01'              FLAG TO INDICATE ONE ATTEMPT          10900020
*                                 HAS BEEN MADE TO PUTLINE A          * 10950020
*                                 MESSAGE TO A TERMINAL               * 11000020
*                                                                     * 11050020
BCPUTLP  DS    F                  PTR FOR PUTLINE                       11100020
*                                 (IOPL FORMATTED BY CALLER)            11120002
*                                                                     * 11150020
BCDCBP   DS    F                  PTR TO DCB                            11200020
BCDDNM   DS    CL8                BROADCAST DS DDNAME            Y02993 11220002
*                                                                     * 11250020
BCWRRBA  DS    F                  RBA FOR WRITE INSTRUCTION             11300020
*                                                                     * 11350020
BCEQXRBA DS    1F                 RBA FOR EXCLUSIVE ENQUEUE             11400020
*                                                                     * 11450020
BCIORBA  DS    2F                 RBA USED FOR READ AND FEEDBACK        11500020
*                                                                     * 11550020
BCERCDE  DS    H                  MESSAGE CODE TO BE USED FOR INDEX-    11900020
*                                 ING INTO THE MESSAGE MODULE           11950020
BCRTCDE  DS    H                  ERROR RETURN CODE FROM A SERVICE      12000020
*                                 ROUTINE WHICH WILL BE INSERTED INTO   12050020
*                                 AN APPROPRIATE ERROR MSG              12100020
         SPACE 3                                                        12103002
*********************************************************************** 12106002
*    STRUCTURE MAPPING INPUT/OUTPUT BUFFER FOR MESSAGES FROM          * 12109002
*                          SYS1.BRODCAST DATA SET                     * 12112002
*********************************************************************** 12115002
BCMSGS   DSECT                                                   Y02993 12118002
BCSEGLTH DS    H                  LENGTH OF MESSAGE SEGMENT      Y02993 12121002
BCSEGOFF DS    H                  OFFSET TO MESSAGE SEGMENT      Y02993 12124002
BCBUF    DS    0CL129             READ BUFFER FOR MESSAGE RECORD Y02993 12127002
BCMSGL   DS    CL1                LENGTH OF MESSAGE TEXT         Y02993 12130002
BCTXT    DS    CL125              MESSAGE TEXT                   Y02993 12133002
BCCHAIN  DS    CL3                PTR TO NEXT MESSAGE            Y02993 12136002
BUFSIZE  EQU   *-BCBUF            READ BUFFER LENGTH             Y02993 12139002
         EJECT                                                          12150020
*********************************************************************** 12200020
*        MAPPING FOR MACRO PARMLISTS AND DYNAMIC WORKAREA             * 12300002
*********************************************************************** 12450020
BCLISTS  DSECT                                                          12500020
*        OPEN                                                           12550020
BCOPL    OPEN  (,(OUTPUT)),MF=L   OPEN SYS1.BRODCAST                    12600020
         SPACE 3                                                        12650020
*        ENQUEUE SHARE                                                  12700020
BCNQL    ENQ   (,,S,,SYSTEM),RET=HAVE,MF=L ENQUEUE SHARING       Y02993 12750002
         SPACE 3                                                        12800020
*        DEQUEUE                                                        12850020
BCDQL    DEQ   (,,,SYSTEM),RET=HAVE,MF=L DEQUEUE                 Y02993 12900002
         SPACE 3                                                        12950020
*        ENQUEUE EXCLUSIVE                                              13000020
BCNQLX   ENQ   (BCQNM,,E,3,SYSTEM),MF=L                                 13050020
         SPACE 3                                                        13100020
*        DEQUEUE FROM EXCLUSIVE ENQUEUE                                 13150020
BCDQLX   DEQ   (BCQNM,,3,SYSTEM),RET=HAVE,MF=L                          13200020
         SPACE 3                                                        13250020
*        READ                                                           13300020
         READ  BCDECB1,DIF,,,'S',0,,MF=L                                13350020
         SPACE 3                                                        13400020
*        READ SPECIAL FIRST RECORD                                      13450020
         READ  BCDECB2,DI,,,'S',0,BCFRREC,MF=L                          13500020
         SPACE 3                                                        13550020
*        WRITE                                                          13600020
         WRITE BCDECB3,DI,,,'S',0,,MF=L                                 13650020
         SPACE 3                                                        13700020
*        WRITE                                                          13750020
         WRITE BCDECB4,DI,,,'S',BCKEY,,MF=L                             13800020
         SPACE 3                                                        13850020
*        CLOSE                                                          13900020
BCCLL    CLOSE 0,MF=L             CLOSE SYS1.BRODCAST                   13950020
         SPACE 3                                                        14000020
*        PUTLINE- ONE LEVEL                                             14050020
BCPUTL1L PUTLINE ,MF=L                                                  14100020
         SPACE 3                                                        14150020
*        PUTLINE- TWO LEVELS                                            14200020
BCPUTL2L PUTLINE OUTPUT=(0,MULTLVL),MF=L                                14250020
         SPACE 3                                                        14300020
*        PUTLINE- DATA                                                * 14350020
BCPUTLDL PUTLINE ,MF=L                                                  14400020
*                                                                     * 14450020
         SPACE 3                                                        14600020
*********************************************************************** 14652002
*                     PUTLINE WORKAREA                                  14660002
*********************************************************************** 14670002
BCDYNA   DS    0D                 ALIGN TO DOUBLE WORD           Y02676 14680002
BCDEC    DS    D                  CONTAINS PACK DECIMAL RESULT          14700020
*                                 OR ZONED HEX                   Y02676 14750002
UNPCK    DS    D                  CONTAINS ZONED DECIMAL RESULT         14800020
*                                 OR PRINTABLE HEX               Y02676 14850002
BCPUT    DS    1F                 PTR TO PUTLINE MODULES FROM LOAD      15350020
*********************************************************************** 15400002
*        PARM BLOCKS USED BY PUTLINE FOR TWO LEVEL MESSAGES           * 16050020
*                     REQUIRING SEGMENT INSERTION                     * 16070002
*********************************************************************** 16120002
MSG1B    DS    0H                 FIRST OF TWO LEVELS                   16200020
MSG2PTR  DS    F                  POINTER TO SECOND LEVEL MSG           16250020
*                                 OUTPUT LINE DESCRIPTOR BLOCK (OLD)    16300020
MSG1SEG  DS    F                  NUMBER OF SEGMENTS IN LEVEL ONE       16350020
SEG1A    DS    F                  POINTER TO FIRST SEGMENT              16400020
SEG1B    DS    F                  POINTER TO SECOND SEGMENT             16450020
MSG1BL   EQU   *-MSG1B            LENGTH OF BLOCK                Y02676 16470002
*                                                                     * 16500020
MSG2B    DS    0H                 SECOND OF TWO LEVELS           Y02676 16550002
MSG3PTR  DS    F                  PTR TO THIRD LEVEL MSG (ZEROES)       16600020
MSG2SEG  DS    F                  NUMBER OF SEGMENTS IN SECOND LEVEL    16650020
SEG2A    DS    F                  POINTER TO FIRST SEGMENT              16700020
SEG2B    DS    F                  POINTER TO SECOND SEGMENT             16750020
SEG2C    DS    F                  POINTER TO THIRD SEGMENT              16800020
MSG2BL   EQU   *-MSG2B            LENGTH OF SECOND BLOCK         Y02676 16820002
*                                                                     * 16850020
MSG3B    DS    0H                 STRUCTURE FOR MESSAGE SEGMENT         16900020
SEGLTH   DS    H                  LENGTH OF MESSAGE SEGMENT             16950020
SEGOFSET DS    H                  OFFSET TO MESSAGE SEGMENT             17000020
SEGHDRL  EQU   *-MSG3B            LENGTH OF SEGMENT HEADER       Y02676 17020002
SEGSRT   DS    CL4                INSERTED TEXT                  Y02676 17050002
BCDYNEND DS    0C                 END OF DYNAMIC WORKAREA        Y02676 17060002
BCFIXLL  EQU   BCDYNEND-BCDYNA    LENGTH OF DYNAMIC WORKAREA     Y02676 17070002
         EJECT                                                          17100020
BCDCBD   DCBD  DSORG=DA,DEVD=DA                                         17150020
DCBEND   DS    0D                      END OF DCB DSECT                 17200020
DCBLENG  EQU   DCBEND-IHADCB      LENGTH OF DCB                  Y02993 17220002
         EJECT                                                          17550020
IKJEES75 CSECT                    MODULE TO DO I/O FOR LISTBC           17600020
REGS     DS    0H                 LABEL FOR REGISTER EQUATES     Y02993 17610002
*********************************************************************** 17620002
*                           REGISTER DEFINITION                         17630002
*********************************************************************** 17640002
REG0     EQU   0                  REGISTER FOR SVC RETURN DATA   Y02993 17650002
PARMREG  EQU   1                  REGISTER FOR PARAMETERS               17700020
REG2     EQU   2                  BASE FOR I/O PARMLIST          Y02993 17750002
REG3     EQU   3                  REGISTER FOR I/O RBA                  17800020
REG4     EQU   4                  BASE FOR DIRECTORY RECORD      Y02993 17850002
REG5     EQU   5                  BASE FOR MESSAGE RECORD,       Y02993 17900002
*                                 SEGMENT, OR PARM BLOCK                17920002
REG6     EQU   6                                                 Y02993 17950002
REG7     EQU   7                                                        18000020
REG8     EQU   8                  BASE FOR DYNAMIC WORKAREA      Y02993 18050002
REG9     EQU   9                                                        18100020
REGA     EQU   10                 REGISTER FOR DCB POINTER              18150020
SAVE     EQU   13                 REGISTER FOR SAVE AREAS               18250020
REG15    EQU   15                 REG FOR RETURN CODES                  18350020
*********************************************************************** 18360002
*                      MISCELLANEOUS EQUATES                            18370002
*********************************************************************** 18380002
N0       EQU   0                                                        18400020
N1       EQU   1                                                 Y02993 18420002
N2       EQU   2                                                 Y02993 18450002
N3       EQU   3                                                 Y02993 18470002
N4       EQU   4                                                        18500020
BCIOERR  EQU   8                  I/O ERROR RETURN CODE                 18900020
N8       EQU   8                                                 Y02993 18950002
         EJECT                                                          19150002
         STM   14,12,12(13)       SAVE CALLERS REGISTERS                19550020
         BALR  12,0               ESTABLISH ADDRESSABILITY              19650020
         USING *,12                                                     19700020
         MODID BRANCH=YES                                       Y01886  19750001
         USING IHADCB,REGA        BASE FOR DCB                          20000020
         USING BCLISTS,REG8       BASE FOR MACRO LIST FORMS      Y02993 20020002
         USING BCIOPARM,REG2      BASE FOR PARAMETER LIST               20050020
         LR    REG2,PARMREG       SET UP BASE FOR PARM LIST             20100020
         SPACE 3                                                        20150020
*********************************************************************** 20200020
*        SET UP FOR REGISTER SAVE AREA                                * 20250020
*                                                                     * 20300020
*********************************************************************** 20350020
         GETMAIN R,LV=72,SP=1     GETMAIN FOR SAVE AREA FOR IKJEES75    20450020
         ST    SAVE,4(PARMREG)    SAVE PTR TO CALLERS SAVE AREA         20500020
         ST    PARMREG,8(SAVE)    CHAIN IKJEES75 SAVE AREA TO CALLERS   20550020
         LR    SAVE,PARMREG       SET UP PTR TO IKJEES75 SAVE AREA      20600020
         L     REGA,BCDCBP        ADDRESSING FOR DCB                    20650020
         LA    REG8,DCBLENG(REGA)      ADDRESSING FOR MACRO PARM LISTS  20700020
         SPACE 3                                                        20750020
*********************************************************************** 20800020
*                                                                     * 20850020
*        SET UP DCB IN DYNAMIC CORE IF THIS IS THE FIRST USE OF THE   * 20900020
*              I/O MODULE                                             * 20950020
*                                                                     * 21000020
*********************************************************************** 21050020
         TM    BCPERMF,BCDCB      SET UP DCB REQUESTED                  21150020
         BO    BCCLOAD             NO, BRANCH TO CHECK FOR LOAD         21200020
         GETMAIN R,LV=WKARLEN,SP=1   GET CORE FOR DCB AND MACRO LISTS   21300020
         MVC   0(DCBLENG,PARMREG),BCCDCB  MOVE DCB TO GOTTEN CORE       21400020
         LR    REGA,PARMREG       SET BASE FOR DCB DSECT                21450020
         OI    BCPERMF,BCDCB      TURN ON FLAG TO INDICATE DCB HAS      21500020
*                                 BEEN SET UP                           21550020
         ST    REGA,BCDCBP        SAVE DCB PTR                          21650020
         SPACE 3                                                        21700020
*********************************************************************** 21750020
*                                                                     * 21800020
*        SET UP MACRO PARM LISTS IN DYNAMIC CORE IF THIS IS           * 21850002
*        THE FIRST USE OF THE I/O MODULE                              * 21900002
*                                                                     * 21950020
*********************************************************************** 22000020
         MVC   DCBLENG(BCLENMV,PARMREG),BCBEGL  MACRO LISTS             22100020
         LA    REG8,DCBLENG(PARMREG)   BASE FOR PARM LISTS              22150020
         XC    BCPUT,BCPUT        INDICATE PUTLINE MODULE NOT    Y02676 22200002
*                                 LOADED                                22220002
*                                                                     * 22300020
*        LOAD THE MODULES OF THE PUTLINE SERVICE ROUTINE              * 22350020
*                                                                     * 22400020
BCCLOAD  DS    0H                 CODE TO LOAD PUTLINE MODULES          22500020
         TM    BCIOF2,BCLOAD      IS LOAD OF PUTLINE MODULES REQUESTED? 22600020
         BZ    BCCONT             NO, BRANCH TO CHECK FOR OPEN          22650020
         NC    BCPUT,BCPUT        PUTLINE MODULES AVAILABLE      Y02676 22660002
         BNZ   BCCONT             YES, NO NEED TO LOAD AGAIN     Y02676 22670002
         LOAD  EP=IKJPUTL         YES, LOAD PUTLINE MODULES             22750020
         ST    REG0,BCPUT         SAVE PTR TO PUTLINE MODULES           22800020
         SPACE 3                                                        22850020
BCCONT   TM    BCIOF1,BCOPEN      IS OPEN REQUESTED?                    22950020
         BZ    BCCENQ             NO, BRANCH TO CHECK FOR ENQUE         23000020
*********************************************************************** 23050002
*        OPEN SYS1.BRODCAST                                           * 23150020
*********************************************************************** 23200002
         TM    BCPERMF,BCLOGON    ENTRY FROM LOGON               Y02676 23260002
         BO    BCCOPEN            YES, USE DEFAULT DDNAME        Y02676 23270002
         MVC   DCBDDNAM,BCDDNM    COPY DDNAME FROM IKJDAIR       Y02676 23280002
BCCOPEN  DS    0H                 CODE TO OPEN DATA SET                 23300020
         LA    PARMREG,BCOPL      PTR TO GENERATED PARM LIST            23350020
         OPEN  ((REGA)),MF=(E,(1))     OPEN SYS1.BRODCAST               23450020
         TM    DCBOFLGS,DCBOFOPN  WAS OPEN SUCCESSFUL            Y02676 23550002
         BZ    BCERR1             NO, BRANCH TO PUT OUT ERROR MSG       23600020
         SPACE 3                                                        23650020
*                                                                     * 23750020
*        ENQUEUE WITH SHARE FOR THE BROADCAST DATA SET                * 23800020
*                                                                     * 23850020
BCCENQ   DS    0H                 CODE TO ENQUEUE ON DATA SET           23950020
         TM    BCIOF1,BCENQ       IS ENQUEUE REQUESTED?                 24050020
         BZ    BCCDEQ             NO, BRANCH TO CHECK FOR DEQUE         24100020
         LA    PARMREG,BCNQL      PTR TO GENERATED PARM LIST            24150020
         ENQ   ,MF=(E,(1))        ENQUEUE SHARING ON SYS1.BRODCAST      24250020
         SPACE 3                                                        24300020
*                                                                     * 24400020
*        DEQUEUE FROM THE BROADCAST DATA SET                          * 24450020
*                                                                     * 24500020
BCCDEQ   DS    0H                 CODE TO DEQUEUE FROM BROADCAST D S    24600020
         TM    BCIOF1,BCDEQ       IS DEQUEUE REQUESTED?                 24700020
         BZ    BCCENQX            NO, BRANCH TO CHECK FOR EXCLUSIVE     24750020
*                                 ENQUE                                 24800020
         LA    PARMREG,BCDQL      PTR TO GENERATED PARM LIST            24850020
         DEQ   ,MF=(E,(1))        DEQUEUE FROM SYS1.BRODCAST            24950020
         SPACE 3                                                        25000020
*                                                                     * 25100020
*        ENQUEUE EXCLUSIVELY BY RBA TO WRITE BROADCAST RECORD         * 25150020
*                                                                     * 25200020
BCCENQX  DS   0H                  CODE TO ENQUEUE EXCLUSIVELY           25300020
         TM   BCIOF2,BCENQX       IS ENQUEUE EXCLUSIVE REQUESTED?       25400020
         BZ    BCCDEQX            NO, BRANCH TO CHECK FOR EXCLUSIVE     25450020
*                                 DEQUEUE                               25500020
         LA    REG3,BCEQXRBA      RBA FOR ENQUEUE                       25550020
         LA    PARMREG,BCNQLX     PTR TO ENQ PARM LIST                  25600020
         ENQ   (,(REG3)),MF=(E,(1))  ENQUEUE EXCLUSIVE                  25700020
         SPACE 3                                                        25750020
*        DEQUEUE FROM EXCLUSIVE ENQUEUE BY RELATIVE BLOCK ADDRESS     * 25850020
BCCDEQX  DS    0H                                                       25950020
         TM    BCIOF2,BCDEQX      EXCLUSIVE DEQUEUE REQUESTED?          26050020
         BZ    BCCREAD            NO, BRANCH TO CHECK FOR READ          26100020
         LA    REG3,BCEQXRBA      PTR TO RBA                            26150020
         LA    PARMREG,BCDQLX     PTR TO DEQ PARM LIST                  26200020
         DEQ   (,(REG3)),MF=(E,(1))                                     26300020
         SPACE 3                                                        26350020
         SPACE 3                                                        26400020
*********************************************************************** 26450020
*                                                                     * 26500020
*        READ A MESSAGE OR DIRECTORY RECORD FROM BROADCAST DATA SET   * 26550020
*        BY RBA (WITH RELATIVE TRACK ADDRESS FEEDBACK)                * 26560002
*        BUFFER ADDRESS PASSED FROM CALLER IN REG4 (DIRECTORY RECORD) * 26570002
*        OR REG5 (MESSAGE RECORD).                                    * 26580002
*********************************************************************** 26850020
BCCREAD  DS    0H                 CODE TO READ BY REL BLOCK ADDR        26900020
         TM    BCIOF1,BCRD        IS READ REQUESTED                     27000020
         BZ    BCREAD1            BRANCH IF NOT                         27050020
         TM    BCIOF2,BCDIRR      USE DIRECTORY BUFFER           Y02676 27150002
         BZ    BCREAD             BRANCH IF NOT                         27200020
         LR    REG5,REG4          PTR TO BUFFER IN R5 FOR READ          27300020
BCREAD   LA    REG3,BCIORBA       RBA FOR READ                          27400020
         READ  BCDECB1,DIF,(REGA),(REG5),,,(REG3),MF=(E,(1))            27500020
*                                                                     * 27600020
*        CHECK TO BE SURE I/O HAS COMPLETED SATISFACTORILY            * 27650020
*                                                                     * 27700020
BCCCHK1  DS    0H                 CODE TO ISSUE CHECK                   27800020
         CHECK BCDECB1            CHECK FOR COMPLETE READ               27900020
         B     BCCCLOSE           CHECK NEXT OPTION              Y02676 27950002
*********************************************************************** 33550020
*        READ RECORD1 (RBA=0) OF THE BROADCAST DATA SET               * 33650002
*        BUFFER ADDRESS PASSED FROM CALLER IN REG 4.                  * 33700002
*********************************************************************** 33850020
BCREAD1  DS    0H                 CODE FOR READING FIRST RECORD         33900020
         TM    BCIOF1,BCRD1       IS READ OF FIRST RECORD REQUESTED     34000020
         BZ    BCCWRITE           BRANCH IF NOT                         34050020
         READ  BCDECB2,DI,(REGA),(REG4),,,,MF=(E,(1)) READ FIRST REC    34150020
*********************************************************************** 34200020
*        CHECK TO BE SURE I/O HAS COMPLETED SATISFACTORILY            * 34300020
*********************************************************************** 34400020
BCCCHK2  DS    0H                 CODE TO ISSUE CHECK                   34450020
         CHECK BCDECB2            CHECK FOR COMPLETE READ               34550020
         B     BCCCLOSE           GO CHECK FOR CLOSE                    34650020
         SPACE 3                                                        34700020
*********************************************************************** 34750020
*        WRITE BY RBA UPDATED RECORDS TO SYS1.BRODCAST                * 34850020
*********************************************************************** 34900020
BCCWRITE DS    0H                 CODE TO DO WRITE                      34950020
         TM    BCIOF2,BCWRITE     IS WRITE REQUESTED                    35050020
         BZ    BCCCLOSE           BRANCH IF NOT                         35100020
         TM    BCIOF2,BCDIRR      USE DIRECTORY BUFFER           Y02676 35200002
         BZ    BCWRIT             BRANCH IF NOT                         35250020
         LR    REG5,REG4          TRANSFER BUFFER POINTER FOR READ      35300020
         LA    REG3,BCWRRBA       RBA FOR WRITE                         35400020
         WRITE BCDECB3,DI,(REGA),(REG5),,,(REG3),MF=(E,(1))             35500020
*********************************************************************** 35550020
*        CHECK TO BE SURE I/O HAS COMPLETED SATISFACTORILY            * 35650020
*********************************************************************** 35750020
BCCCHK   DS    0H                 CODE TO ISSUE CHECK                   35800020
         CHECK BCDECB3            CHECK FOR COMPLETE WRITE              35950020
         B     BCCCLOSE           GO CHECK FOR CLOSE                    36000020
         SPACE 3                                                        36050020
*********************************************************************** 36100020
*        REWRITE MESSAGE RECORD TO DATA SET WITH KEY 'FF'             * 36200002
*        AND FIRST DATA BYTE CONTAINING RELATIVE TRACK ADDRESS        * 36210002
*        (ALLOWS REUSE BY SIMULATING BDAM FREESPACE)                  * 36220002
*********************************************************************** 36300020
BCWRIT   LA    REG3,BCWRRBA       RBA FOR WRITE                         36400020
         MVC   0(1,REG5),BCIORBA+7     MOVE REL POSITION ON TRACK       36450020
         WRITE BCDECB4,DI,(REGA),(REG5),,,(REG3),MF=(E,(1))             36550020
*********************************************************************** 36600020
*        CHECK TO BE SURE I/O HAS COMPLETED SATISFACTORILY            * 36700020
*********************************************************************** 36800020
BCCCHK3  DS    0H                 CODE TO ISSUE CHECK                   36900020
         CHECK BCDECB4            CHECK FOR COMPLETE WRITE              37000020
         SPACE 3                                                        37050020
*********************************************************************** 37100020
*        CLOSE SYS1.BRODCAST                                          * 37200020
*********************************************************************** 37300020
BCCCLOSE DS    0H                 CODE TO ISSUE CLOSE                   37350020
         TM    BCIOF1,BCCLOSE     IS CLOSE REQUESTED                    37450020
         BZ    BCPUTLN            BRANCH IF NOT                         37500020
         TM    DCBOFLGS,DCBOFOPN  DCB OPEN                       Y02993 37520002
         BNO   FREEDCB            NO, NO NEED TO CLOSE           Y02993 37530002
         LA    PARMREG,BCCLL      PTR TO GENERATED PARM LIST            37550020
         CLOSE ((REGA)),MF=(E,(1))      CLOSE DATA SET                  37650020
         SPACE 3                                                        37700020
*********************************************************************** 37750020
*         THE DYNAMIC WORKAREA CONTAINING MACRO LISTS AND             * 37820002
*        THE DCB FOR SYS1.BRODCAST WILL BE RELEASED AUTOMATICALLY     * 37850020
*             AFTER THAT DATA SET IS CLOSED                           * 37900020
*********************************************************************** 38000020
FREEDCB  DS    0H                 CODE TO RELEASE WORKAREA       Y02993 38020002
         LR    PARMREG,REGA       PTR TO DCB AND WORK AREA              38050020
         FREEMAIN R,LV=WKARLEN,A=(1),SP=1  FREE DCB AND MACRO LISTS     38150020
         XC    BCPERMF,BCPERMF    CLEAR 'PERMANENT' FLAGS               38250020
         B     BCDELET            CHECK NEXT OPTION              Y02993 38260002
*        PUTLINE MAY NOT BE ISSUED AFTER WORK AREA IS FREED           * 38270002
         SPACE 3                                                        38300020
*********************************************************************** 38350020
*        ISSUE PUTLINE FOR ERROR MESSAGES OR FOR PRINTING BROADCAST   * 38450020
*              MESSAGES.                                              * 38500020
*********************************************************************** 38600020
BCPUTLN  DS    0H                 CODE TO DO PUTLINE                    38650020
         TM    BCIOF1,BCPUTL      IS PUTLINE REQUESTED                  38750020
         BZ    BCDELET            BRANCH IF NOT                         38800020
         L     PARMREG,BCPUTLP    PTR TO PARM LIST FOR PUTLINE          38850020
         SPACE 3                                                        38900020
*********************************************************************** 38950020
*        CHECK TO SEE IF THE PUTLINE IS FOR AN ERROR MESSAGE. IF NOT  * 39050020
*        IT IS FOR A BROADCAST MESSAGE- BRANCH TO PUTLINE DATA        * 39100002
*********************************************************************** 39200020
         TM    BCIOF3,BCERFLG     IS PUTLINE FOR ERROR MESSAGE?         39300020
         BZ    BCPUTLM            NO, BRANCH TO PUTLINE BROADCAST MSG   39350020
         SPACE 3                                                        39400020
**********************************************************************  39500020
*        THE FOLLOWING CODE INDEXES INTO THE LISTBC MESSAGE MODULE    * 39550002
*        IKJEES74, AND RETRIEVES THE POINTER TO THE APPROPRIATE      *  39600020
*        ERROR MESSAGE OUT PUT LINE DESCRIPTOR BLOCK.                *  39650020
**********************************************************************  39700020
         SPACE 3                                                        39750020
FINDMSG  EQU   *                                                        40000020
         LH    REG9,BCERCDE       LOAD ERROR MESSAGE INDEX       Y02676 40050002
         BCTR  REG9,REG0          DECREMENT BY ONE               Y02676 40110002
         AR    REG9,REG9          DEVELOP HALFWORD INDEX         Y02676 40170002
         L     REG7,VMSG          LOAD THE ADDRESS CONSTANT FOR THE     40250020
*                                 MESSAGE MODULE IKJEES74               40300020
         AR    REG9,REG7          ADD TABLE ADDRESS TO INDEX     Y02676 40350002
         LR    REG5,REG7          GET MESSAGE MODULE ADDRESS     Y02676 40750002
         AH    REG5,0(REG9)       ADD OFFSET TO MESSAGE BLOCK    Y02676 40850002
*********************************************************************** 41150020
*        DETERMINE IF THE ERROR MESSAGE REQUIRES TEXT INSERTION.      * 41200020
*        IF TEXT INSERTION IS NOT REQUIRED, IT IS THEN DETERMINED     * 41250020
*        IF THE ERROR MESSAGE IS A ONE-LEVEL OR TWO-LEVEL MESSAGE     * 41300020
*        AND THE APPROPRIATE 'PUTLINE' IS USED TO ISSUE THE ERROR     * 41350020
*        MESSAGE TO THE TERMINAL. IF TEXT INSERTION IS REQUIRED,      * 41400020
*        THEN A BRANCH IS TAKEN TO DO THE INSERTION.                  * 41450020
*********************************************************************** 41500020
         TM    BCIOF3,BCTXTIN     IS TEXT INSERTION REQUIRED FOR THIS   41550020
*                                 ERROR MESSAGE?                        41600020
         BO    TXTSRT             YES, BRANCH TO DO INSERTION           41650020
         L     REG15,BCPUT        LOAD THE ENTRY POINT TO PUTLINE       41700020
         TM    BCIOF3,BC1LVL      IS THIS A ONE-LEVEL ERROR MESSAGE?    41850020
         BO    BCPUTL1E           BRANCH TO ISSUE ONE-LEVEL ERROR MSG   41900020
         B     BCPUTL2E           BRANCH TO ISSUE TWO-LEVEL ERROR MSG   41950020
*********************************************************************** 42050020
*        TEXT INSERTION IS REQUIRED FOR THE ERROR MESSAGE. THE        * 42100020
*        FOLLOWING CODE CONVERTS THE ERROR CODE, WHICH HAS BEEN       * 42150020
*        RETURNED BY THE EXTERNAL ROUTINE (I.E. PUTLINE OR            * 42200002
*        PARSE) FROM BINARY TO ZONED DECIMAL OR PRINTABLE HEX.        * 42250002
*********************************************************************** 42300020
TXTSRT   EQU   *                                                        42350020
         TM    BCIOF3,BCHXCV      IS ERROR CODE TO BE PUT OUT IN        42400020
*                                 PRINTABLE HEX?                        42450020
         BO    HEXCV              YES, BRANCH TO DO CONVERSION          42500020
         LH    REG7,BCRTCDE       LOAD ERROR RETURN CODE FROM I/O PARM  42550020
*                                 LIST                                  42600020
         CVD   REG7,BCDEC         CONVERT RETURN CODE TO DECIMAL        42650020
         UNPK  UNPCK(N4),BCDEC    UNPACK THE RETURN CODE         Y02676 42700002
         MVZ   UNPCK+N3(N1),UNPCK MAKE SIGN PRINTABLE            Y02676 42710002
         B     INSERT             STEP TO INSERTION              Y02676 42720002
HEXCV    EQU   *                                                 Y02676 42730002
         MVO   UNPCK(N8),BCRTCDE(N2) ADD 'SIGN' TO SIMULATE DEC  Y02676 42740002
         UNPK  BCDEC(N8),UNPCK    UNPACK AS IF DECIMAL           Y02676 42750002
         MVN   UNPCK(N4),BCDEC    ZONES NOW ZERO                 Y02676 42760002
         TR    UNPCK(N4),TRTABLE  TRANSL RESULT TO PRINTABLE HEX Y02676 42770002
*********************************************************************** 42850020
*        THE FOLLOWING CODE MOVES THE OUTPUT LINE DESCRIPTOR FOR      * 42900020
*        THE FIRST-LEVEL MESSAGE, THE OUTPUT LINE DESCRIPTOR FOR      * 42950020
*        THE SECOND-LEVEL MESSAGE, AND THE SEGMENT INTO THE WHICH     * 43000020
*        THE ERROR CODE IS TO BE PLACED INTO DYNAMIC CORE. THIS IS    * 43050020
*        FOR THE PURPOSE OF STORING INTO THE APPROPRIATE ADDRESS      * 43100020
*        CONSTANT, IN THE SECOND-LEVEL OUTPUT LINE DESCRIPTOR, THE    * 43150020
*        POINTER TO THE SEGMENT INTO WHICH THE ERROR CODE HAS BEEN    * 43200020
*        INSERTED;AND CHAINING THE OUTPUT LINE DESCRIPTOR FOR THE     * 43250020
*        SECOND-LEVEL MESSAGE TO THE OUTPUT LINE DESCRIPTOR FOR THE   * 43300020
*        FIRST-LEVEL MESSAGE. REG5 WILL THEN BE LOADED WITH THE       * 43350020
*        ADDRESS OF THE OUTPUT LINE DESCRIPTOR FOR THE FIRST LEVEL    * 43400020
*        MESSAGE AND THEN PUTLINED TO THE TERMINAL.                   * 43450020
*********************************************************************** 43500020
INSERT   EQU   *                                                        43550020
         MVC   MSG1B(MSG1BL),N0(REG5) MOVE OLD FOR FIRST-LEVEL MESSAGE  43700002
*                                 INTO DYNAMIC CORE              Y02676 43750002
         L     REG7,N0(REG5)      LOAD ADDRESS OF OLD FOR SECOND-LEVEL  43800002
*                                 ERROR MESSAGE                  Y02676 43850002
*                                                                Y02676 43860002
         MVC   MSG2B(MSG2BL),N0(REG7) MOVE OLD FOR 2ND-LEVEL MESSAGE    43900002
         LA    REG7,MSG2B         LOAD ADDRESS OF SECOND-LEVEL OLD      43950020
         ST    REG7,MSG2PTR       CHAIN OLD FOR SECOND-LEVEL TO OLD     44000020
*                                 FOR FIRST-LEVEL MESSAGE               44050020
         L     REG7,SEG2C         GET ADDRESS OF SEGMENT NEEDING TEXT   44100020
*                                 INSERTION                             44150020
         MVC   MSG3B(SEGHDRL),N0(REG7) MOVE SEGMENT HEADER INSERT       44200002
*                                 INTO THE DYNAMIC AREA          Y02676 44250002
         LA    REG7,MSG3B         LOAD THE ADDRESS OF THE MESSAGE       44300020
*                                 SEGMENT NEEDING INSERTION             44350020
         ST    REG7,SEG2C         STORE ADDRESS IN SECOND-LEVEL OLD     44400020
         MVC   SEGSRT(N4),UNPCK   MOVE RETURN CODE TO SEGMENT    Y02676 44450002
         L     REG15,BCPUT        LOAD ADDRESS OF PUTLINE ENTRY         44550020
         LA    REG5,MSG1B         LOAD ADDRESS OF OLD FROM DYNAMIC AREA 44600020
         B     BCPUTL2E           BRANCH TO ISSUE ERROR MESSAGE TO      44650020
*                                 TERMINAL                              44700020
*********************************************************************** 45150020
*        THIS IS THE ENTRY FOR PUTTING OUT BROADCAST MESSAGES.  REG5  * 45200020
*        POINTS TO THE BUFFER WHERE THE MESSAGE WAS JUST READ INTO- SO* 45250020
*        REG5 IS DECREMENTED BY FOUR TO POINT TO THE LENGTH AND OFFSET* 45300020
*        FIELDS (USED BY PUTLINE) WHICH IMMEDIATELY PRECEDE THE BUFFER* 45350020
*        ALSO THE LENGTH OF THE MESSAGE IS IN THE FIRST BYTE OF THE   * 45400020
*        BUFFER- SO THIS LENGTH IS TRANSFERRED TO THE 'PREFIX' PARM   * 45450002
*        WORD AND THEN THE BYTE IS BLANKED OUT.                       * 45500020
*        THE LENGTH IS INCREMENTED TO INCLUDE THE LENGTH OF THE PREFIX* 45550020
*        WORD AND THE LENGTH OF THE LENGTH FIELD ITSELF.              * 45600020
*                                                                     * 45650020
*********************************************************************** 45700020
BCPUTLM  DS    0H                                                       45750020
         LA    REG6,BCBUF-BCMSGS  LENGTH OF PREFIX               Y02676 45850002
         SR    REG5,REG6          ADJUST PTR TO BUFFER START     Y02676 45890002
         USING BCMSGS,REG5        BUFFER ADDRESSABILITY          Y02676 45930002
         XC    BCSEGOFF,BCSEGOFF  SET MESSAGE OFFSET ZERO        Y02676 45970002
         IC    REG6,BCMSGL        LOAD MESSAGE LENGTH            Y02676 46010002
         LA    REG6,BCTXT-BCMSGS(REG6) ADD BYTE FOR LEN RECORDER Y02676 46050002
         STH   REG6,BCSEGLTH      SAVE TOTAL IN PARM BLOCK       Y02676 46090002
         MVI   BCMSGL,C' '        BLANK OUT LENGTH BYTE          Y02676 46130002
         DROP  REG5                                              Y02676 46170002
         L     REG15,BCPUT        PTR TO PUTLINE ENTRY POINT            46250020
         SPACE 3                                                        46300020
PUTLDATA PUTLINE PARM=BCPUTLDL,OUTPUT=((REG5),DATA),ENTRY=(15),        C46400020
               MF=(E,(1))                                               46450020
         LTR   REG15,REG15             TEST RTN CODE FROM PUTLINE       46700020
         BNZ   NOCORE                  BAD RTN CODE BRANCH TO ERR TRN   46750020
         B     BCDELET            BRANCH TO NEXT OPERATION              46800020
         SPACE 3                                                        46850020
*********************************************************************** 46900020
*        REG5 POINTS TO THE OUTPUT LINE DESCRIPTOR IN MESSAGE MODULE  * 46950020
*        IKJEES74 FOR THE APPROPRIATE ONE-LEVEL ERROR MESSAGE THAT    * 47000020
*        IS TO BE ISSUED TO THE TERMINAL VIA 'PUTLINE'.               * 47050020
*********************************************************************** 47100020
BCPUTL1E PUTLINE PARM=BCPUTL1L,OUTPUT=((REG5)),ENTRY=(15),MF=(E,(1))    47150020
         LTR   REG15,REG15             CHECK RTN CODE FROM PUTLINE      47200020
         BNZ   NOCORE                  CHECK PUTINE RETURN CODE         47250020
         B     BCDELET            CONTINUE PROCESSING                   47300020
         SPACE 3                                                        47350020
*********************************************************************** 47400020
*       THE FOLLOWING IS THE PUTLINE FOR ALL TWO-LEVEL ERROR          * 47450020
*       MESSAGES.  REG5 POINTS TO THE OUTPUT LINE DESCRIPTOR          * 47500020
*       FOR THE ERROR MESSAGE THAT IS TO BE ISSUED TO THE TERMINAL    * 47550020
*       VIA 'PUTLINE'.                                                * 47600020
*********************************************************************** 47650020
BCPUTL2E PUTLINE PARM=BCPUTL2L,OUTPUT=((REG5),MULTLVL),ENTRY=(15),     C47800020
               MF=(E,(1))                                               47850020
         LTR   REG15,REG15             CHECK PUTLINE RETURN CODE        48100020
         BNZ   NOCORE                  BRANCH TO ERROR ROUTINE          48150020
         SPACE 3                                                        48200020
*********************************************************************** 48250020
*        DELETE THE MODULES OF THE PUTLINE SERVICE ROUTINE            * 48350020
*********************************************************************** 48450020
BCDELET  DS    0H                 CODE TO DELETE PUTLINE MODULES        48500020
         TM    BCIOF2,BCDELETE    IS DELETE REQUESTED                   48600020
         BZ    BCEND              BRANCH IF NOT                         48650020
         DELETE EP=IKJPUTL        MACRO                                 48750020
         SPACE 3                                                        48800020
*********************************************************************** 48850020
*        CLEAN UP CODE EXECUTED BEFORE RETURNING TO LISTBC MODULE     * 48950020
*********************************************************************** 49050020
BCEND    DS    0H                 CLEAN UP CODE                         49150020
         XC    BCIOF1(3),BCIOF1   CLEAR OPERATION FLAGS                 49200020
         LR    PARMREG,SAVE       PTR TO THIS MODULES SAVE AREA         49250020
         L     SAVE,4(SAVE)       LOAD PTR TO CALLERS SAVE AREA         49300020
         FREEMAIN R,LV=72,A=(1),SP=1  FREE SAVE AREA                    49400020
         LA    REG15,N0           LOAD ZERO RETURN CODE                 49470020
         TM    BCPERMF,BCERROR    WAS THERE AN ERROR CONDITION?         49500020
         BZ    BCRTN              NO, RETURN TO CALLER                  49550020
         LA    REG15,BCIOERR      YES SET RETURN CODE TO 8              49560020
BCRTN    EQU   *                                                        49590020
         RETURN (14,12),RC=(15)   RETURN TO CALLER                      49650020
BCEROUT  EQU   *                                                        49750020
         OI    BCPERMF,BCERROR    INDICATE THAT AN ERROR CONDITION      49810020
*                                 OCCURRED                              49820020
         B     BCEND              BRANCH TO FREE SAVE AREA              49830020
         SPACE 3                                                        49950020
*********************************************************************** 50000020
*        SYNAD ROUTINE TO HANDLE MESSAGES FOR I/O ERROR CASES.        * 50050002
*********************************************************************** 50250020
BCSYNAD  DS    0H                 ERROR ROUTINE FROM READ               50350020
         XC    0(BUFSIZE,REG4),0(REG4) CLEAR READ BUFFER         Y02676 50352002
         TM    BCIOF1,BCRD1       RECORD1 READ FAILURE           Y02676 50353002
         BO    BCCCLOSE           YES, CAUSE FORMAT ERROR        Y02676 50354002
         XC    BCIOF1(3),BCIOF1   CLEAR OPERATION FLAGS                 50500020
         OI    BCIOF1,BCPUTL      INDICATE PUTLINE                      50550020
         OI    BCIOF3,BCERFLG     INDICATE ERROR CONDITION OCCURRED     50650020
         OI    BCPERMF,BCERROR    INDICATE ERROR HAS OCCURRED           50700020
         LA    REG7,1             LOAD ERROR MSG INDEX INTO REGISTER    50750020
         TM    BCPERMF,BCLOGON    ENTRY FROM LOGON               Y02676 50758002
         BNO   BCSYNAD1           USE REGULAR MESSAGE            Y02676 50766002
         LA    REG7,15            USE MESSAGE 15 INSTEAD         Y02676 50774002
         OI    BCIOF3,BC1LVL      SPECIAL ONE-LEVEL MESSAGE      Y02676 50782002
BCSYNAD1 DS    0H                 MESSAGE SELECTED               Y02676 50790002
         STH   REG7,BCERCDE       SAVE ERROR MSG INDEX                  50800020
         B     BCPUTLN            RECYCLE TO PRODUCE MESSAGE     Y02676 50850002
         SPACE 3                                                        50950020
*********************************************************************** 51000020
*        ROUTINE TO HANDLE MESSAGES FOR AN OPEN ERROR.                * 51050002
*********************************************************************** 51350020
BCERR1   DS    0H                 ERROR CASE                            51500020
         OI    BCPERMF,BCERROR    INDICATE I/O ERROR HAS OCCURRED M0843 51550020
         XC    BCIOF1(3),BCIOF1   CLEAR OPERATION FLAGS                 51700020
         OI    BCIOF1,BCPUTL      INDICATE PUTLINE                      51750020
         OI    BCIOF3,BCERFLG     INDICATE ERROR CONDITION OCCURRED     51800020
         LA    REG7,2             LOAD ERROR MSG INDEX INTO REGISTER    51850020
         TM    BCPERMF,BCLOGON    ENTRY FROM LOGON               Y02676 51858002
         BNO   BCERR2             NO, NO SPECIAL MESSAGE         Y02676 51866002
         LA    REG7,16            YES, USE ONE-LEVEL MESSAGE     Y02676 51874002
         OI    BCIOF3,BC1LVL      INDICATE ONE-LEVEL             Y02676 51882002
BCERR2   DS    0H                 MESSAGE SELECTED               Y02676 51890002
         STH   REG7,BCERCDE       SAVE ERROR MSG INDEX                  51900020
         B     BCPUTLN            PUT OUT MESSAGES                      51950020
         SPACE 3                                                        51960002
*********************************************************************** 51970002
*        ROUTINE TO HANDLE MESSAGES FOR PUTLINE ERROR.                * 51980002
*********************************************************************** 51990002
NOCORE   EQU   *                                                        52050020
         TM    BCPERMF,BCPUTER    IS THIS SECOND ATTEMPT TO PUTLN       52100020
         BNZ   BCEROUT            YES,BRANCH TO SET RTNCD=8             52150020
         TM    BCPERMF,BCLOGON    ENTRY FROM LOGON               Y02676 52157002
         BO    BCEROUT            YES, NO MESSAGE ISSUED         Y02676 52164002
         STH   REG15,BCRTCDE      STORE RETURN CODE              Y02676 52171002
         LA    REG15,4            RETURN CODE IF ATTN INTERRUPT  Y02676 52178002
         CH    REG15,BCRTCDE      ATTENTION INTERRUPT            Y02676 52185002
         BE    BCEROUT            YES, NO MESSAGE                Y02676 52192002
         XC    BCIOF1(3),BCIOF1   CLEAR OPERATION FLAGS                 52200020
         OI    BCPERMF,BCPUTER    INDICATE ONE ATTEMPT FAILED    Y02676 52220002
         OI    BCIOF1,BCPUTL      INDICATE PUTLINE                      52400020
         OI    BCIOF3,BCERFLG     INDICATE ERROR MESSAGE         Y02676 52405002
         LA    REG15,16           CODE FOR INSUFFICIENT CORE     Y02676 52410002
         CH    REG15,BCRTCDE      WAS CORE INSUFFICIENT          Y02676 52415002
         BE    NOCORE1            YES, USE MESSAGE 8             Y02676 52420002
         OI    BCIOF3,BCTXTIN     INDICATE INSERT REQUIRED       Y02676 52425002
         LA    REG7,12            USE MESSAGE 12                 Y02676 52430002
         STH   REG7,BCERCDE       SAVE ERROR MSG INDEX           Y02676 52435002
         B     BCPUTLN            ISSUE MESSAGE                  Y02676 52440002
NOCORE1  OI    BCIOF3,BC1LVL      INDICATE ONE-LEVEL             Y02676 52450002
         LA    REG7,8             LOAD ERROR MSG INDEX INTO REGISTER    52600020
         STH   REG7,BCERCDE       SAVE ERROR MSG INDEX                  52650020
         B     BCPUTLN            BRANCH TO ISSUE MESSAGE        Y02676 52700002
         EJECT                                                          53650020
*********************************************************************** 53700020
*        DCB FOR READING AND WRITING IN THE SYS1.BRODCAST DATA SET    * 53800020
*********************************************************************** 53900020
         DS    0D                 ALIGN TO DOUBLE WORD           Y02993 53920002
BCCDCB   DCB   BLKSIZE=129,                                            C53950020
               BUFL=129,                                               C54000020
               DDNAME=SYSLBC,                                          C54050020
               DSORG=DA,                                               C54100020
               KEYLEN=1,                                               C54150020
               MACRF=(RIC,WIC),                                        C54200020
               OPTCD=WR,                                               C54250020
               RECFM=F,                                                C54300020
               SYNAD=BCSYNAD                                            54350020
         EJECT                                                          54400020
*********************************************************************** 54450020
*        FOLLOWING ARE PARAMETER LISTS FORMED BY THE LIST FORM OF     * 54550020
*             MACROS.                                                 * 54600020
*********************************************************************** 54700020
BCBEGL   DS    0D                 START OF GENERATED LISTS       Y02993 54750002
         SPACE 3                                                        54800020
*                                                                     * 54850020
*        OPEN                                                           54900020
*                                                                     * 54950020
BCOPLST  OPEN  (,(OUTPUT)),MF=L   OPEN SYS1.BRODCAST                    55000020
         SPACE 3                                                        55050020
*                                                                     * 55100020
*        ENQUEUE SHARE                                                  55150020
*                                                                     * 55200020
BCEQLST  ENQ   (BCQNM,BCFRREC,S,,SYSTEM),RET=HAVE,MF=L           Y02993 55250002
         SPACE 3                                                        55300020
*                                                                     * 55350020
*        DEQUEUE                                                        55400020
*                                                                     * 55450020
BCDQLST  DEQ   (BCQNM,BCFRREC,,SYSTEM),RET=HAVE,MF=L             Y02993 55500002
         SPACE 3                                                        55550020
*                                                                     * 55600020
*        ENQUEUE EXCLUSIVE                                              55650020
*                                                                     * 55700020
BCEQLSTX ENQ   (BCQNM,,E,3,SYSTEM),MF=L                                 55750020
         SPACE 3                                                        55800020
*                                                                     * 55850020
*        DEQUEUE FROM EXCLUSIVE ENQUEUE                               * 55900020
*                                                                     * 55950020
BCDQLSTX DEQ   (BCQNM,,3,SYSTEM),RET=HAVE,MF=L                          56000020
         SPACE 3                                                        56050020
*                                                                     * 56100020
*        READ                                                           56150020
*                                                                     * 56200020
BCRDLST  READ  BCDECB,DIF,,,'S',0,,MF=L                                 56250020
         SPACE 3                                                        56300020
*                                                                     * 56350020
*        READ SPECIAL FIRST RECORD                                      56400020
*                                                                     * 56450020
BCRDLST1 READ  DECB1,DI,,,'S',0,BCFRREC,MF=L                            56500020
         SPACE 3                                                        56550020
*                                                                     * 56600020
*        WRITE                                                          56650020
*                                                                     * 56700020
BCWRLST  WRITE BCDEC1,DI,,,'S',0,,MF=L                                  56750020
         SPACE 3                                                        56800020
*                                                                     * 56850020
*        WRITE                                                          56900020
*                                                                     * 56950020
BCWRKLST WRITE BCDECBX,DI,,,'S',BCKEY,,MF=L                             57000020
         SPACE 3                                                        57050020
*                                                                     * 57100020
*        CLOSE                                                          57150020
*                                                                     * 57200020
BCCLLST  CLOSE 0,MF=L             CLOSE SYS1.BRODCAST                   57250020
         SPACE 3                                                        57300020
*                                                                     * 57350020
*        PUTLINE- ONE LEVEL                                             57400020
*                                                                     * 57450020
BCPUTL1  PUTLINE ,MF=L                                                  57500020
         SPACE 3                                                        57550020
*                                                                     * 57600020
*        PUTLINE- TWO LEVELS                                            57650020
*                                                                     * 57700020
BCPUTL2  PUTLINE OUTPUT=(0,MULTLVL),MF=L                                57750020
         SPACE 3                                                        57800020
*                                                                     * 57850020
*        PUTLINE- DATA                                                * 57900020
*                                                                     * 57950020
BCPUTLD  PUTLINE ,MF=L                                                  58000020
BCGETML1 GETMAIN   EC,MF=L                                              58050020
*                                                                     * 58100020
BCMOVEND DS    0D                 END OF LISTS TO MOVE           Y02993 58150002
BCLENMV  EQU   BCMOVEND-BCBEGL    LENGTH TO BE MOVED                    58950020
WKARLEN  EQU   DCBLENG+BCLENMV+BCFIXLL LENGTH OF WORKAREA        Y02993 59000002
         EJECT                                                          59010002
*********************************************************************** 59020002
*                       CONSTANTS                                       59030002
*********************************************************************** 59080002
BCQNM    DC    C'SYSIKJBC'        ENQUEUE NAME                          59200020
BCFRREC  DC    X'000000'          RELATIVE BLOCK ADDRESS OF FIRST       59250020
*                                 RECORD IN DATA SET = ZERO             59300020
BCKEY   DC     X'FF'              KEY TO INDICATE RECORD IS AVAILABLE   59350020
VMSG    DC     V(LSTBMSG)         VCON FOR MESSAGE MODULE 'IKJEES74'    59550020
TRTABLE DC     C'0123456789ABCDEF'  TRANSLATE TABLE FOR PRINTABLE HEX   59600020
*                                   CONVERSION                          59650020
SPARE    DC    50X'00'            PATCH AREA                     Y02676 59670002
         END                                                            59800020
