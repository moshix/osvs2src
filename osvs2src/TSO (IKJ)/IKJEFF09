         TITLE 'IKJEFF09 - SUBMIT INSTALLATION EXIT INTERFACE          *00001000
                        '                                               00002000
IKJEFF09 CSECT ,                                                   0001 00003000
@MAINENT DS    0H                                                  0001 00004000
         USING *,@15                                               0001 00005000
         B     @PROLOG                                             0001 00006000
         DC    AL1(16)                                             0001 00007000
         DC    C'IKJEFF09  73.297'                                 0001 00008000
         DROP  @15                                                      00009000
@PROLOG  STM   @14,@12,12(@13)                                     0001 00010000
         BALR  @12,0                                               0001 00011000
@PSTART  DS    0H                                                  0001 00012000
         USING @PSTART,@12                                         0001 00013000
         L     @00,@SIZDATD                                        0001 00014000
         GETMAIN R,LV=(0)                                               00015000
         LR    @11,@01                                             0001 00016000
         USING @DATD,@11                                           0001 00017000
         ST    @13,@SA00001+4                                      0001 00018000
         LM    @00,@01,20(@13)                                     0001 00019000
         ST    @11,8(,@13)                                         0001 00020000
         LR    @13,@11                                             0001 00021000
         MVC   @PC00001(32),0(@01)                                 0001 00022000
DUMYLBL1 DS    0H                                                  0003 00023000
*                                      IKJEFFIE MACRO              0048 00024000
*                                                                    */ 00025000
*                                                                  0049 00026000
*   /*****************************************************************/ 00027000
*   /*                                                               */ 00028000
*   /* INITIALIZATION                                                */ 00029000
*   /*                                                               */ 00030000
*   /*****************************************************************/ 00031000
*                                                                  0049 00032000
*   CONTABPT=PCONTAB;               /* USE LOCAL PTR TO CONTROL TABLE*/ 00033000
         L     @10,@PC00001+16                                     0049 00034000
         L     @10,PCONTAB(,@10)                                   0049 00035000
         ST    @10,CONTABPT                                        0049 00036000
*   HTPTR=ADDR(HIST);               /* SET UP BASE FOR HISTORY TABLE */ 00037000
         L     HTPTR,@PC00001+8                                    0050 00038000
*   MSGPTR=MSGPT;                   /* SET UP BASE FOR MESSAGE TABLE */ 00039000
         L     @10,@PC00001+12                                     0051 00040000
         L     MSGPTR,MSGPT(,@10)                                  0051 00041000
*   EXITAD=PEXIT;                   /* USE LOCAL COPY OF IKJEFF10'S     00042000
*                                      ADDRESS                       */ 00043000
         L     @10,@PC00001+24                                     0052 00044000
         L     EXITAD,PEXIT(,@10)                                  0052 00045000
*   INEXIT='1'B;                    /* SET ON TRACE BIT              */ 00046000
         OI    INEXIT(HTPTR),B'00100000'                           0053 00047000
*   EXCONTRL=EXCONTRL&&EXCONTRL;    /* ZERO INTERNAL SWITCHES        */ 00048000
*                                                                  0054 00049000
         XC    EXCONTRL(1),EXCONTRL                                0054 00050000
*   /*****************************************************************/ 00051000
*   /*                                                               */ 00052000
*   /* INITIALIZE THE PARAMETER LIST PASSED TO THE EXIT              */ 00053000
*   /*                                                               */ 00054000
*   /*****************************************************************/ 00055000
*                                                                  0055 00056000
*   EXITLIST=EXITLIST&&EXITLIST;    /* ZERO OUT EXIT PARMLIST        */ 00057000
         XC    EXITLIST(32),EXITLIST                               0055 00058000
*   SWITCHES=SWITCHES&&SWITCHES;    /* ZERO THE PARMLIST EXTENSION   */ 00059000
         XC    SWITCHES(4),SWITCHES                                0056 00060000
*   EXITWORK=EXWORD;                /* WORD FOR EXIT'S USE           */ 00061000
         L     @10,@PC00001+20                                     0057 00062000
         L     @10,EXWORD(,@10)                                    0057 00063000
         ST    @10,EXITWORK                                        0057 00064000
*   CARDPTR=STMTPTR;                /* SET UP POINTER TO CURRENT   0058 00065000
*                                      INPUT CARD                    */ 00066000
         L     @10,@PC00001                                        0058 00067000
         L     @10,STMTPTR(,@10)                                   0058 00068000
         ST    @10,CARDPTR                                         0058 00069000
*   USERIDPT=ADDR(USERID);                                         0059 00070000
         L     @10,@PC00001+4                                      0059 00071000
         ST    @10,USERIDPT                                        0059 00072000
*   SWITSPT=ADDR(SWITCHES);         /* PTR TO PARMLIST EXTENSION     */ 00073000
         LA    @10,SWITCHES                                        0060 00074000
         ST    @10,SWITSPT                                         0060 00075000
*   ACCTIPT=ADDR(HTACCNTI);         /* ACCOUNTING INFORMATION FOR  0061 00076000
*                                      USER FROM LOGON ACT C.B.      */ 00077000
         L     @08,HTACCNTP(,HTPTR)                                0061 00078000
         ST    @08,ACCTIPT                                         0061 00079000
*   ACCTLPT=ADDR(HTACCNTL);         /* LENGTH OF ACCOUNT INFO        */ 00080000
         LA    @08,HTACCNTL(,HTPTR)                                0062 00081000
         ST    @08,ACCTLPT                                         0062 00082000
*   IETAKEEX=TAKEXITS;              /* GET BITS FOR TYPE EXIT TO TAKE*/ 00083000
         MVC   IETAKEEX(1,@10),TAKEXITS(HTPTR)                     0063 00084000
*   IEOPRAND=OPOFF;                 /* OFFSET TO FIRST COLUMN OF   0064 00085000
*                                      CARD'S OPERAND FIELD        0064 00086000
*                                                                    */ 00087000
         MVC   IEOPRAND(1,@10),OPOFF(HTPTR)                        0064 00088000
*                                                                  0065 00089000
*   /*****************************************************************/ 00090000
*   /*                                                               */ 00091000
*   /* TURN ON BIT(S) IDENTIFYING TYPE CARD BEING PASSED TO EXIT     */ 00092000
*   /*                                                               */ 00093000
*   /*****************************************************************/ 00094000
*                                                                  0065 00095000
*   IF CJOB='1'B THEN               /* IF CURRENT CARD IS A JOB CARD */ 00096000
         TM    CJOB(HTPTR),B'00010000'                             0065 00097000
         BNO   @RF00065                                            0065 00098000
*     IESJOB='1'B;                  /* TURN ON JOB CARD BIT IN EXIT     00099000
*                                      PARMLIST                      */ 00100000
         OI    IESJOB(@10),B'10000000'                             0066 00101000
*   IF CEXEC='1'B THEN              /* IF CURRENT CARD IS EXEC       */ 00102000
@RF00065 TM    CEXEC(HTPTR),B'00001000'                            0067 00103000
         BNO   @RF00067                                            0067 00104000
*     IESEXEC='1'B;                                                0068 00105000
         L     @10,SWITSPT                                         0068 00106000
         OI    IESEXEC(@10),B'01000000'                            0068 00107000
*   IF CDD='1'B THEN                /* IF CURRENT CARD IS DD         */ 00108000
@RF00067 TM    CDD(HTPTR),B'00000100'                              0069 00109000
         BNO   @RF00069                                            0069 00110000
*     IESDD='1'B;                                                  0070 00111000
         L     @10,SWITSPT                                         0070 00112000
         OI    IESDD(@10),B'00100000'                              0070 00113000
*   IF CCOMMAND='1'B THEN           /* IF CURRENT CARD IS COMMAND    */ 00114000
@RF00069 TM    CCOMMAND(HTPTR),B'00000010'                         0071 00115000
         BNO   @RF00071                                            0071 00116000
*     IESCMD='1'B;                                                 0072 00117000
         L     @10,SWITSPT                                         0072 00118000
         OI    IESCMD(@10),B'00010000'                             0072 00119000
*   IF CNULL='1'B THEN              /* IF CURRENT CARD IS NULL       */ 00120000
@RF00071 TM    CNULL(HTPTR),B'00100000'                            0073 00121000
         BNO   @RF00073                                            0073 00122000
*     IESNULL='1'B;                                                0074 00123000
         L     @10,SWITSPT                                         0074 00124000
         OI    IESNULL(@10),B'00001000'                            0074 00125000
*   IF CJES='1'B THEN               /* IF CURRENT CARD IS JOB ENTRY     00126000
*                                      SUBSYSTEM CONTROL CARD      0075 00127000
*                                      (SLASH-ASTERISK-NONBLANK)     */ 00128000
@RF00073 TM    CJES(HTPTR),B'10000000'                             0075 00129000
         BNO   @RF00075                                            0075 00130000
*     IESJES='1'B;                                                 0076 00131000
         L     @10,SWITSPT                                         0076 00132000
         OI    IESJES(@10),B'10000000'                             0076 00133000
*   IF CCOMMENT='1'B THEN           /* IF CURRENT CARD IS COMMENT  0077 00134000
*                                      (COULD BE JES3 CONTROL CARD)  */ 00135000
@RF00075 TM    CCOMMENT(HTPTR),B'00000001'                         0077 00136000
         BNO   @RF00077                                            0077 00137000
*     IESCOMNT='1'B;                                               0078 00138000
         L     @10,SWITSPT                                         0078 00139000
         OI    IESCOMNT(@10),B'01000000'                           0078 00140000
*   IF COPCONEX='1'B THEN           /* IF OPERAND IS TO BE CONTINUED */ 00141000
@RF00077 TM    COPCONEX(HTPTR),B'01000000'                         0079 00142000
         BNO   @RF00079                                            0079 00143000
*     IESOPCON='1'B;                                               0080 00144000
         L     @10,SWITSPT                                         0080 00145000
         OI    IESOPCON(@10),B'00000100'                           0080 00146000
*   IF CCONEX='1'B THEN             /* IF STATEMENT IS TO BE       0081 00147000
*                                      CONTINUED                     */ 00148000
@RF00079 TM    CCONEX(HTPTR),B'10000000'                           0081 00149000
         BNO   @RF00081                                            0081 00150000
*     IESSCON='1'B;                                                0082 00151000
         L     @10,SWITSPT                                         0082 00152000
         OI    IESSCON(@10),B'00000010'                            0082 00153000
*   IF CVERBCOP='1'B THEN           /* IF CURRENT CARD IS A        0083 00154000
*                                      CONTINUATION                  */ 00155000
@RF00081 TM    CVERBCOP(HTPTR),B'00001000'                         0083 00156000
         BNO   @RF00083                                            0083 00157000
*     IESCONTN='1'B;                                               0084 00158000
         L     @10,SWITSPT                                         0084 00159000
         OI    IESCONTN(@10),B'00000001'                           0084 00160000
*   CARD2=CARD;                     /* SAVE THE ORIGINAL STATEMENT 0085 00161000
*                                                                    */ 00162000
@RF00083 L     @10,@PC00001                                        0085 00163000
         L     @10,STMTPTR(,@10)                                   0085 00164000
         MVC   CARD2(80),CARD(@10)                                 0085 00165000
*                                                                  0086 00166000
*   /*****************************************************************/ 00167000
*   /*                                                               */ 00168000
*   /* CALL INSTALLATION EXIT (MAY CALL FROM LOOP)                   */ 00169000
*   /*                                                               */ 00170000
*   /*****************************************************************/ 00171000
*                                                                  0086 00172000
*CALLEX:                                                           0086 00173000
*   CALL INSTEXIT(EXITLIST);        /* CALL THE EXIT -- IKJEFF10     */ 00174000
CALLEX   LA    @10,EXITLIST                                        0086 00175000
         ST    @10,@AL00001                                        0086 00176000
         LR    @15,EXITAD                                          0086 00177000
         LA    @01,@AL00001                                        0086 00178000
         BALR  @14,@15                                             0086 00179000
*   RFY                                                            0087 00180000
*     R15 RSTD;                                                    0087 00181000
*   RETCODE=R15;                    /* SAVE RETURN CODE              */ 00182000
         ST    R15,RETCODE                                         0088 00183000
*   RFY                                                            0089 00184000
*     R15 UNRSTD;                                                  0089 00185000
*                                                                  0089 00186000
*   /*****************************************************************/ 00187000
*   /*                                                               */ 00188000
*   /* IF PARMLIST'S RESPTR IS NOT ZERO, FREE THE REPLY BUFFER       */ 00189000
*   /*                                                               */ 00190000
*   /*****************************************************************/ 00191000
*                                                                  0090 00192000
*   IF RESPTR^=0 THEN                                              0090 00193000
         L     @10,RESPTR                                          0090 00194000
         LTR   @10,@10                                             0090 00195000
         BZ    @RF00090                                            0090 00196000
*     DO;                                                          0091 00197000
*       RFY                                                        0092 00198000
*        (R0,                                                      0092 00199000
*         R1) RSTD;                                                0092 00200000
*       R0=RETSIZE;                                                0093 00201000
         SLR   @10,@10                                             0093 00202000
         ICM   @10,7,RETMSG(MSGPTR)                                0093 00203000
         LH    R0,RETSIZE(,@10)                                    0093 00204000
*       HOLD=R1;                                                   0094 00205000
         LR    HOLD,R1                                             0094 00206000
*       R1=ADDR(RET);                                              0095 00207000
         LR    R1,@10                                              0095 00208000
*       GEN(FREEMAIN R,LV=(0),A=(1));                              0096 00209000
         FREEMAIN R,LV=(0),A=(1)                                        00210000
*       R1=HOLD;                                                   0097 00211000
         LR    R1,HOLD                                             0097 00212000
*       RFY                                                        0098 00213000
*        (R0,                                                      0098 00214000
*         R1) UNRSTD;                                              0098 00215000
*       RESPTR=0;                                                  0099 00216000
         SLR   @10,@10                                             0099 00217000
         ST    @10,RESPTR                                          0099 00218000
*     END;                                                         0100 00219000
*                                                                  0100 00220000
*   /*****************************************************************/ 00221000
*   /*                                                               */ 00222000
*   /* TAKE ERROR EXIT IF EXIT'S R.C. SAYS ABORT                     */ 00223000
*   /*                                                               */ 00224000
*   /*****************************************************************/ 00225000
*                                                                  0101 00226000
*   IF RETCODE=IEABORT THEN                                        0101 00227000
@RF00090 L     @10,RETCODE                                         0101 00228000
         CH    @10,@CH00131                                        0101 00229000
         BE    @RT00101                                            0101 00230000
*     GO TO BAD;                    /* CAUSE ERROR TERMIN. OF SUBMIT    00231000
*                                                                    */ 00232000
*                                                                  0103 00233000
*   /*****************************************************************/ 00234000
*   /*                                                               */ 00235000
*   /* IF REQUESTED, ISSUE PROMPT MESSAGE AND OBTAIN REPLY FOR EXIT  */ 00236000
*   /*                                                               */ 00237000
*   /*****************************************************************/ 00238000
*                                                                  0103 00239000
*   IF RETCODE=IEPROMPT THEN                                       0103 00240000
         CH    @10,@CH00129                                        0103 00241000
         BNE   @RF00103                                            0103 00242000
*     DO;                                                          0104 00243000
*       MSGID='09A ';                                              0105 00244000
         MVC   MSGID(4,MSGPTR),@CC00294                            0105 00245000
*CALLMSG:                                                          0106 00246000
*       MTPUTLSW='0'B;              /* CALL THE MESSAGE PROCESSING 0106 00247000
*                                      ROUTINE FOR PUTGET      Y02656*/ 00248000
*                                                                  0106 00249000
CALLMSG  NI    MTPUTLSW(MSGPTR),B'10111111'                        0106 00250000
*       /*************************************************************/ 00251000
*       /*                                                           */ 00252000
*       /* GENERAL CODE TO ISSUE ANY MESSAGE FOR EXIT                */ 00253000
*       /*                                                           */ 00254000
*       /*************************************************************/ 00255000
*                                                                  0107 00256000
*CALLMSG2:                                                         0107 00257000
*       L1=IEMSGLN-2;               /* LENGTH OF VARIABLE            */ 00258000
CALLMSG2 L     @10,EXMSGPTR                                        0107 00259000
         LH    @08,IEMSGLN(,@10)                                   0107 00260000
         BCTR  @08,0                                               0107 00261000
         BCTR  @08,0                                               0107 00262000
         STC   @08,L1(,MSGPTR)                                     0107 00263000
*       VAR1=ADDR(IEMSGTXT);        /* VARIABLE                      */ 00264000
*                                                                  0108 00265000
         LA    @10,IEMSGTXT(,@10)                                  0108 00266000
         STCM  @10,7,VAR1(MSGPTR)                                  0108 00267000
*       /*************************************************************/ 00268000
*       /*                                                           */ 00269000
*       /* ISSUE MESSAGE (COULD BE ERROR MESSAGE FROM IKJEFF09)      */ 00270000
*       /*                                                           */ 00271000
*       /*************************************************************/ 00272000
*                                                                  0109 00273000
*MSG:                                                              0109 00274000
*       RFY                                                        0109 00275000
*         R1 RSTD;                                                 0109 00276000
MSG      DS    0H                                                  0110 00277000
*       HOLD=R1;                                                   0110 00278000
         LR    HOLD,R1                                             0110 00279000
*       R1=MSGPTR;                                                 0111 00280000
         LR    R1,MSGPTR                                           0111 00281000
*       CALL MSGMOD;                /* CALL IKJEFF02 SERVICE ROUTINE */ 00282000
         L     @15,MSGRTN(,MSGPTR)                                 0112 00283000
         BALR  @14,@15                                             0112 00284000
*       RFY                                                        0113 00285000
*         R15 RSTD;                                                0113 00286000
*       MSGR15=R15;                 /* SAVE MSG ROUTINE RETURN CODE  */ 00287000
         LR    MSGR15,R15                                          0114 00288000
*       RFY                                                        0115 00289000
*         R15 UNRSTD;                                              0115 00290000
*       MTPUTLSW='1'B;              /* CHANGE MESSAGE TABLE SWITCH 0116 00291000
*                                      BACK TO PUTLINE         Y02656*/ 00292000
         OI    MTPUTLSW(MSGPTR),B'01000000'                        0116 00293000
*       R1=HOLD;                                                   0117 00294000
         LR    R1,HOLD                                             0117 00295000
*       RFY                                                        0118 00296000
*         R1 UNRSTD;                                               0118 00297000
*                                                                  0119 00298000
*       /*************************************************************/ 00299000
*       /*                                                           */ 00300000
*       /* DO SPECIAL PROCESSING AFTER SOME MESSAGES                 */ 00301000
*       /*                                                           */ 00302000
*       /*************************************************************/ 00303000
*                                                                  0119 00304000
*       IF MSGID='09C ' THEN                                       0119 00305000
         CLC   MSGID(4,MSGPTR),@CC00302                            0119 00306000
         BE    @RT00119                                            0119 00307000
*         GO TO BAD;                /* TAKE ERROR EXIT               */ 00308000
*       IF MSGID='09D ' THEN        /* ERROR MESSAGE, SO             */ 00309000
         CLC   MSGID(4,MSGPTR),@CC00303                            0121 00310000
         BE    @RT00121                                            0121 00311000
*         GO TO BAD;                /* TAKE ERROR EXIT               */ 00312000
*                                                                  0122 00313000
*       /*************************************************************/ 00314000
*       /*                                                           */ 00315000
*       /* ISSUE ERROR MESSAGE IF UNABLE TO PROMPT                   */ 00316000
*       /*                                                           */ 00317000
*       /*************************************************************/ 00318000
*                                                                  0123 00319000
*       IF MSGR15=12 THEN                                          0123 00320000
         CH    MSGR15,@CH00129                                     0123 00321000
         BNE   @RF00123                                            0123 00322000
*         DO;                       /* IF RETURN CODE FROM MSG MODULE   00323000
*                                      IS EQUAL 12 THEN INDICATES THE   00324000
*                                      USER IS IN NOPROMPT MODE      */ 00325000
*           MSGID='09C ';           /* WISH TO PUT OUT A PUTLINE MSG    00326000
*                                      TO TERMINAL USER IN WHICH WILL   00327000
*                                      BE THE PUTGET MSG THE SYSTEM     00328000
*                                      TRIED TO PUT OUT--ONLY      0125 00329000
*                                      ALLOWING, HOWEVER EIGHTY    0125 00330000
*                                      CHARACTERS                    */ 00331000
         MVC   MSGID(4,MSGPTR),@CC00302                            0125 00332000
*           IF L1>80 THEN           /* TRUNCATE MSG IF GREATER THAN     00333000
*                                      80 CHARACTERS                 */ 00334000
         CLI   L1(MSGPTR),80                                       0126 00335000
         BNH   @RF00126                                            0126 00336000
*             L1=80;                                               0127 00337000
         MVI   L1(MSGPTR),X'50'                                    0127 00338000
*           L2=LENGTH(CTCMDNM);     /* INSERT THE COMMAND NAME Y02993*/ 00339000
@RF00126 MVI   L2(MSGPTR),X'08'                                    0128 00340000
*           VAR2=ADDR(CTCMDNM);                                    0129 00341000
         L     @10,@PC00001+28                                     0129 00342000
         STCM  @10,7,VAR2(MSGPTR)                                  0129 00343000
*           GO TO MSG;              /* ISSUE THE PROMPT ERROR MESSAGE*/ 00344000
         B     MSG                                                 0130 00345000
*         END;                      /* DON'T CHECK OTHER MSG R15   0131 00346000
*                                      R.C.S - ALWAYS ASSUME CAN DO A   00347000
*                                      PUTLINE WHEN WORKING WITH   0131 00348000
*                                      INSTALLATION EXITS            */ 00349000
*       IF RETCODE=IEPROMPT THEN    /* IF ISSUED A PROMPT,           */ 00350000
@RF00123 CLC   RETCODE(4),@CF00129                                 0132 00351000
         BNE   @RF00132                                            0132 00352000
*         RESPTR=RETMSG;            /* GIVE EXIT A POINTER TO REPLY  */ 00353000
         SLR   @10,@10                                             0133 00354000
         ICM   @10,7,RETMSG(MSGPTR)                                0133 00355000
         ST    @10,RESPTR                                          0133 00356000
*       GO TO CALLEX;               /* GO BACK TO EXIT               */ 00357000
         B     CALLEX                                              0134 00358000
*     END;                                                         0135 00359000
*                                                                  0136 00360000
*   /*****************************************************************/ 00361000
*   /*                                                               */ 00362000
*   /* IF REQUESTED, ISSUE AN INFORMATIVE MESSAGE FOR THE EXIT       */ 00363000
*   /*                                                               */ 00364000
*   /*****************************************************************/ 00365000
*                                                                  0136 00366000
*   IF RETCODE=IEMSG THEN                                          0136 00367000
@RF00103 CLC   RETCODE(4),@CF00073                                 0136 00368000
         BNE   @RF00136                                            0136 00369000
*     DO;                           /* MSG ONLY                      */ 00370000
*       MSGID='09B ';                                              0138 00371000
         MVC   MSGID(4,MSGPTR),@CC00304                            0138 00372000
*       GO TO CALLMSG2;             /* IKJEFF02 WILL ISSUE PUTLINE   */ 00373000
         B     CALLMSG2                                            0139 00374000
*     END;                                                         0140 00375000
*                                                                  0140 00376000
*   /*****************************************************************/ 00377000
*   /*                                                               */ 00378000
*   /* IF REQUESTED, GET NEXT STATEMENT FROM EXIT - DON'T READ IT    */ 00379000
*   /* FROM SUBMITTED DATA SET                                       */ 00380000
*   /*                                                               */ 00381000
*   /*****************************************************************/ 00382000
*                                                                  0141 00383000
*   IF RETCODE=IERETURN THEN                                       0141 00384000
@RF00136 CLC   RETCODE(4),@CF00126                                 0141 00385000
         BNE   @RF00141                                            0141 00386000
*     DO;                           /* RETURN FOR ANOTHER STMT       */ 00387000
*       IF CALLMADE^='1'B THEN      /* IF CALLMADE IS NOT ON THEN THE   00388000
*                                      CONTROL RTN HAS NOT BEEN    0143 00389000
*                                      CALLED BEFORE                 */ 00390000
         TM    CALLMADE,B'10000000'                                0143 00391000
         BO    @RF00143                                            0143 00392000
*         DO;                                                      0144 00393000
*FIRSTCAL:                          /* FIRST CALL OF IKJEFF06 ROUTINE*/ 00394000
*           CALLMADE='1'B;          /* NO, SO SET FLAG SO NEXT TIME     00395000
*                                      WILL NOT HAVE TO COPY THE JCL    00396000
*                                      SWITCHES -- THIS IS DONE THE     00397000
*                                      FIRST TIME A CHANGED CARD IS     00398000
*                                      RE-PROCESSED SO AS TO MAKE IT    00399000
*                                      LOOK LIKE A FOLLOWER OF THE 0145 00400000
*                                      PRECEDING CARD                */ 00401000
FIRSTCAL OI    CALLMADE,B'10000000'                                0145 00402000
*           CURRJCL=PRIORJCL;       /* RE-SET JCL SWITS              */ 00403000
         MVC   CURRJCL(4,HTPTR),PRIORJCL(HTPTR)                    0146 00404000
*         END;                                                     0147 00405000
*NEXTCALL:                          /* NEXT CALL OF IKJEFF06         */ 00406000
*       STMTPTR=CARDPTR;            /* PT TO STMT AS SEEN BY THE EXIT*/ 00407000
@RF00143 DS    0H                                                  0148 00408000
NEXTCALL L     @10,@PC00001                                        0148 00409000
         L     @08,CARDPTR                                         0148 00410000
         ST    @08,STMTPTR(,@10)                                   0148 00411000
*       CALL IKJEFF06(CONTABPT);    /* IKJEFF06 IS AN ALTERNATE E.P.    00412000
*                                      IN IKJEFF05                   */ 00413000
         LA    @10,CONTABPT                                        0149 00414000
         ST    @10,@AL00001                                        0149 00415000
         L     @15,@CV00053                                        0149 00416000
         LA    @01,@AL00001                                        0149 00417000
         BALR  @14,@15                                             0149 00418000
*       IF RETCODE=IERETURN THEN    /* IF MUST GO BACK FOR ANOTHER   */ 00419000
         CLC   RETCODE(4),@CF00126                                 0150 00420000
         BNE   @RF00150                                            0150 00421000
*         DO;                                                      0151 00422000
*           CARDPTR=0;              /* YES                           */ 00423000
         SLR   @10,@10                                             0152 00424000
         ST    @10,CARDPTR                                         0152 00425000
*           GO TO CALLEX;           /* GO TO EXIT FOR ANOTHER STMT.  */ 00426000
         B     CALLEX                                              0153 00427000
*         END;                      /* NO                            */ 00428000
*       GO TO OUT;                  /* FINISHED                      */ 00429000
         B     OUT                                                 0155 00430000
*     END;                                                         0156 00431000
*                                                                  0156 00432000
*   /*****************************************************************/ 00433000
*   /*                                                               */ 00434000
*   /* IF REQUESTED, CONTINUE PROCESSING THE CURRENT CARD            */ 00435000
*   /*                                                               */ 00436000
*   /*****************************************************************/ 00437000
*                                                                  0157 00438000
*   IF RETCODE=IECONTIN THEN                                       0157 00439000
@RF00141 L     @10,RETCODE                                         0157 00440000
         LTR   @10,@10                                             0157 00441000
         BZ    @RT00157                                            0157 00442000
*     GO TO FORCE;                  /* CHECK WHETHER EXIT CHANGED  0158 00443000
*                                      CARD                          */ 00444000
*                                                                  0158 00445000
*   /*****************************************************************/ 00446000
*   /*                                                               */ 00447000
*   /* THIS SECTION OF CODE WILL BE ENTERED WHEN THE RETURN CODE IS  */ 00448000
*   /* NOT 0, 4, 8,12 OR 16. IT IS A NON-INTERPRETABLE RETURN CODE SO*/ 00449000
*   /* IKJEFF09 WILL PUT OUT AN ERROR MESSAGE AND ABORT              */ 00450000
*   /*                                                               */ 00451000
*   /*****************************************************************/ 00452000
*                                                                  0159 00453000
*ERROR:                                                            0159 00454000
*   VAR1=ADDR(RETCODE);                                            0159 00455000
ERROR    LA    @10,RETCODE                                         0159 00456000
         STCM  @10,7,VAR1(MSGPTR)                                  0159 00457000
*   L1='84'X;                       /* INDICATES DECIMAL CONVERSION  */ 00458000
         MVI   L1(MSGPTR),X'84'                                    0160 00459000
*   MSGID='09D ';                                                  0161 00460000
         MVC   MSGID(4,MSGPTR),@CC00303                            0161 00461000
*   GO TO MSG;                      /* ISSUE THE ERROR MESSAGE       */ 00462000
*                                                                  0162 00463000
         B     MSG                                                 0162 00464000
*   /*****************************************************************/ 00465000
*   /*                                                               */ 00466000
*   /* CODE USED TO ABNORMALLY TERMINATE THE SUBMIT COMMAND          */ 00467000
*   /*                                                               */ 00468000
*   /*****************************************************************/ 00469000
*                                                                  0163 00470000
*BAD:                                                              0163 00471000
*   QUIT='1'B;                                                     0163 00472000
BAD      OI    QUIT(HTPTR),B'10000000'                             0163 00473000
*   GO TO OUT;                      /* DON'T PROCESS THE CARD      0164 00474000
*                                                                    */ 00475000
         B     OUT                                                 0164 00476000
*                                                                  0165 00477000
*   /*****************************************************************/ 00478000
*   /*                                                               */ 00479000
*   /* CODE TO CHECK HOW THIS CARD IS TO BE PROCESSED                */ 00480000
*   /*                                                               */ 00481000
*   /*****************************************************************/ 00482000
*                                                                  0165 00483000
*FORCE:                                                            0165 00484000
*   IF CALLMADE='1'B THEN           /* IF CALLED IKJEFF06 CONTROL  0165 00485000
*                                      ROUTINE ONCE                  */ 00486000
FORCE    TM    CALLMADE,B'10000000'                                0165 00487000
         BO    @RT00165                                            0165 00488000
*     GO TO NEXTCALL;               /* NEED TO CALL AGAIN TO PROCESS    00489000
*                                      LAST STMT AS SEEN BY THE EXIT */ 00490000
*                                                                  0166 00491000
*   /*****************************************************************/ 00492000
*   /*                                                               */ 00493000
*   /* CHECK WHETHER EXIT WANTS THIS CARD DELETED                    */ 00494000
*   /*                                                               */ 00495000
*   /*****************************************************************/ 00496000
*                                                                  0167 00497000
*   IF CARDPTR=0 THEN                                              0167 00498000
         SLR   @10,@10                                             0167 00499000
         C     @10,CARDPTR                                         0167 00500000
         BNE   @RF00167                                            0167 00501000
*     DO;                           /* IF DELETED, JUST RETURN     0168 00502000
*                                      WITHOUT RE-SETTING THE JCL  0168 00503000
*                                      SWITCHES SO THAT CONTINUATIONS   00504000
*                                      WILL BE IDENTIFIED PROPERLY   */ 00505000
*       STMTPTR=0;                                                 0169 00506000
         L     @07,@PC00001                                        0169 00507000
         ST    @10,STMTPTR(,@07)                                   0169 00508000
*       GO TO OUT;                  /* DON'T PROCESS CURRENT CARD    */ 00509000
         B     OUT                                                 0170 00510000
*     END;                                                         0171 00511000
*                                                                  0171 00512000
*   /*****************************************************************/ 00513000
*   /*                                                               */ 00514000
*   /* CHECK WHETHER EXIT CHANGED THE CURRENT CARD                   */ 00515000
*   /*                                                               */ 00516000
*   /*****************************************************************/ 00517000
*                                                                  0172 00518000
*   IF CARD^=CARD2 THEN                                            0172 00519000
@RF00167 L     @10,@PC00001                                        0172 00520000
         L     @10,STMTPTR(,@10)                                   0172 00521000
         CLC   CARD(80,@10),CARD2                                  0172 00522000
         BNE   @RT00172                                            0172 00523000
*     GO TO FIRSTCAL;               /* IF CARD AND CARD2 ARE NOT THE    00524000
*                                      SAME, THE EXIT CHANGED THE  0173 00525000
*                                      STMT SO BETTER CALL CONTROL   */ 00526000
*                                                                  0173 00527000
*   /*****************************************************************/ 00528000
*   /*                                                               */ 00529000
*   /* COMMON CODE TO CLEAN UP AND RETURN FROM THIS MODULE           */ 00530000
*   /*                                                               */ 00531000
*   /*****************************************************************/ 00532000
*                                                                  0174 00533000
*OUT:                               /* SAVE THE EXIT WORD AND SWITCH    00534000
*                                      SETTINGS                      */ 00535000
*   EXWORD=EXITWORK;                /* SAVE EXIT'S WORD              */ 00536000
OUT      L     @10,@PC00001+20                                     0174 00537000
         L     @07,EXITWORK                                        0174 00538000
         ST    @07,EXWORD(,@10)                                    0174 00539000
*   TAKEXITS=IETAKEEX;              /* EXIT CAN CHANGE TYPE OF EXITS    00540000
*                                      TAKEN                         */ 00541000
         L     @10,SWITSPT                                         0175 00542000
         MVC   TAKEXITS(1,HTPTR),IETAKEEX(@10)                     0175 00543000
*   INEXIT='0'B;                                                   0176 00544000
         NI    INEXIT(HTPTR),B'11011111'                           0176 00545000
*   END IKJEFF09                    /* RETURN TO CALLER-QUIT SWITCH     00546000
*                                      ON IF ERROR             Y02993   00547000
*                                                                    */ 00548000
*                                                                  0177 00549000
*/* THE FOLLOWING INCLUDE STATEMENTS WERE FOUND IN THIS PROGRAM.     */ 00550000
*/*%INCLUDE SYSLIB  (IKJEFFIE)                                       */ 00551000
*/*%INCLUDE SYSLIB  (IKJEFFHT)                                       */ 00552000
*/*%INCLUDE SYSLIB  (IKJEFFMT)                                       */ 00553000
*                                                                  0177 00554000
*       ;                                                          0177 00555000
@EL00001 L     @13,4(,@13)                                         0177 00556000
@EF00001 L     @00,@SIZDATD                                        0177 00557000
         LR    @01,@11                                             0177 00558000
         FREEMAIN R,LV=(0),A=(1)                                        00559000
@ER00001 LM    @14,@12,12(@13)                                     0177 00560000
         BR    @14                                                 0177 00561000
@DATA    DS    0H                                                       00562000
@CH00131 DC    H'16'                                                    00563000
@DATD    DSECT                                                          00564000
         DS    0F                                                       00565000
@SA00001 DS    18F                                                      00566000
@PC00001 DS    8F                                                       00567000
@AL00001 DS    1A                                                       00568000
IKJEFF09 CSECT                                                          00569000
         DS    0F                                                       00570000
@CF00126 DC    F'4'                                                     00571000
@CF00073 DC    F'8'                                                     00572000
@CF00129 DC    F'12'                                                    00573000
@CH00129 EQU   @CF00129+2                                               00574000
@DATD    DSECT                                                          00575000
         DS    0D                                                       00576000
CONTABPT DS    A                                                        00577000
RETCODE  DS    A                                                        00578000
CARD2    DS    CL80                                                     00579000
EXCONTRL DS    CL1                                                      00580000
         ORG   EXCONTRL                                                 00581000
CALLMADE DS    BL1                                                      00582000
         ORG   EXCONTRL+1                                               00583000
         DS    CL3                                                      00584000
EXITLIST DS    CL32                                                     00585000
         ORG   EXITLIST                                                 00586000
CARDPTR  DS    AL4                                                      00587000
EXMSGPTR DS    AL4                                                      00588000
RESPTR   DS    AL4                                                      00589000
USERIDPT DS    AL4                                                      00590000
SWITSPT  DS    AL4                                                      00591000
EXITWORK DS    FL4                                                      00592000
ACCTIPT  DS    AL4                                                      00593000
ACCTLPT  DS    AL4                                                      00594000
         ORG   EXITLIST+32                                              00595000
SWITCHES DS    CL4                                                      00596000
         ORG   *+1-(*-@DATD)/(*-@DATD) INSURE DSECT DATA                00597000
@ENDDATD EQU   *                                                        00598000
IKJEFF09 CSECT                                                          00599000
         DS    0F                                                       00600000
@SIZDATD DC    AL1(0)                                                   00601000
         DC    AL3(@ENDDATD-@DATD)                                      00602000
@CV00053 DC    V(IKJEFF06)                                              00603000
         DS    0D                                                       00604000
@CC00294 DC    C'09A '                                                  00605000
@CC00302 DC    C'09C '                                                  00606000
@CC00303 DC    C'09D '                                                  00607000
@CC00304 DC    C'09B '                                                  00608000
PATCH    DS    CL51                                                     00609000
         ORG   PATCH                                                    00610000
PTCHINIT DC    17CL3'ZAP'                                               00611000
         ORG   PATCH+51                                                 00612000
@00      EQU   00                      EQUATES FOR REGISTERS 0-15       00613000
@01      EQU   01                                                       00614000
@02      EQU   02                                                       00615000
@03      EQU   03                                                       00616000
@04      EQU   04                                                       00617000
@05      EQU   05                                                       00618000
@06      EQU   06                                                       00619000
@07      EQU   07                                                       00620000
@08      EQU   08                                                       00621000
@09      EQU   09                                                       00622000
@10      EQU   10                                                       00623000
@11      EQU   11                                                       00624000
@12      EQU   12                                                       00625000
@13      EQU   13                                                       00626000
@14      EQU   14                                                       00627000
@15      EQU   15                                                       00628000
EXITAD   EQU   @09                                                      00629000
MSGR15   EQU   @08                                                      00630000
MSGPTR   EQU   @05                                                      00631000
HOLD     EQU   @07                                                      00632000
HTPTR    EQU   @06                                                      00633000
R0       EQU   @00                                                      00634000
R1       EQU   @01                                                      00635000
R15      EQU   @15                                                      00636000
CARD     EQU   0                                                        00637000
INSTEXIT EQU   0                                                        00638000
MSGMOD   EQU   0                                                        00639000
IEMSGBUF EQU   0                                                        00640000
IEMSGLN  EQU   IEMSGBUF                                                 00641000
IEMSGTXT EQU   IEMSGBUF+2                                               00642000
IEREPLY  EQU   0                                                        00643000
IESUBCTL EQU   0                                                        00644000
IETAKEEX EQU   IESUBCTL                                                 00645000
IEOPRAND EQU   IESUBCTL+1                                               00646000
IESTMTYP EQU   IESUBCTL+2                                               00647000
IESJOB   EQU   IESTMTYP                                                 00648000
IESEXEC  EQU   IESTMTYP                                                 00649000
IESDD    EQU   IESTMTYP                                                 00650000
IESCMD   EQU   IESTMTYP                                                 00651000
IESNULL  EQU   IESTMTYP                                                 00652000
IESOPCON EQU   IESTMTYP                                                 00653000
IESSCON  EQU   IESTMTYP                                                 00654000
IESCONTN EQU   IESTMTYP                                                 00655000
IESTMTP2 EQU   IESUBCTL+3                                               00656000
IESJES   EQU   IESTMTP2                                                 00657000
IESCOMNT EQU   IESTMTP2                                                 00658000
HISTORY  EQU   0                                                        00659000
WHATMOD  EQU   HISTORY+12                                               00660000
INEXIT   EQU   WHATMOD+3                                                00661000
JCLSWITS EQU   HISTORY+16                                               00662000
PRIORJCL EQU   JCLSWITS                                                 00663000
PVERB    EQU   PRIORJCL                                                 00664000
PDTYPE   EQU   PRIORJCL+2                                               00665000
PMISC    EQU   PRIORJCL+3                                               00666000
CURRJCL  EQU   JCLSWITS+4                                               00667000
CVERB    EQU   CURRJCL                                                  00668000
CNULL    EQU   CVERB                                                    00669000
CJOB     EQU   CVERB                                                    00670000
CEXEC    EQU   CVERB                                                    00671000
CDD      EQU   CVERB                                                    00672000
CCOMMAND EQU   CVERB                                                    00673000
CCOMMENT EQU   CVERB                                                    00674000
CJES     EQU   CVERB+1                                                  00675000
CDTYPE   EQU   CURRJCL+2                                                00676000
CMISC    EQU   CURRJCL+3                                                00677000
CCONEX   EQU   CMISC                                                    00678000
COPCONEX EQU   CMISC                                                    00679000
CVERBCOP EQU   CMISC                                                    00680000
STATICSW EQU   HISTORY+24                                               00681000
GENL     EQU   STATICSW                                                 00682000
QUIT     EQU   GENL                                                     00683000
TAKEXITS EQU   STATICSW+1                                               00684000
OPOFF    EQU   STATICSW+2                                               00685000
CODEFLD  EQU   STATICSW+3                                               00686000
DLMONJCL EQU   HISTORY+32                                               00687000
HTSWITCH EQU   HISTORY+34                                               00688000
HTACCNTP EQU   HISTORY+40                                               00689000
HTACCNTL EQU   HISTORY+44                                               00690000
HTACCNTI EQU   0                                                        00691000
MSGTABLE EQU   0                                                        00692000
TMCTPTR  EQU   MSGTABLE+4                                               00693000
ECBPTR   EQU   MSGTABLE+8                                               00694000
@NM00013 EQU   MSGTABLE+12                                              00695000
SW       EQU   MSGTABLE+20                                              00696000
MTPUTLSW EQU   SW                                                       00697000
RETMSG   EQU   MSGTABLE+21                                              00698000
SW2      EQU   MSGTABLE+24                                              00699000
MSGID    EQU   MSGTABLE+40                                              00700000
MTINSRTS EQU   MSGTABLE+44                                              00701000
L1       EQU   MTINSRTS                                                 00702000
VAR1     EQU   MTINSRTS+1                                               00703000
L2       EQU   MTINSRTS+4                                               00704000
VAR2     EQU   MTINSRTS+5                                               00705000
L3       EQU   MTINSRTS+8                                               00706000
L4       EQU   MTINSRTS+12                                              00707000
MSGRTN   EQU   MSGTABLE+60                                              00708000
RET      EQU   0                                                        00709000
RETSIZE  EQU   RET                                                      00710000
IEACCNTI EQU   0                                                        00711000
IEACCNTL EQU   0                                                        00712000
IECARD   EQU   0                                                        00713000
IEUSERID EQU   0                                                        00714000
MSGECB   EQU   0                                                        00715000
MSGTMCT  EQU   0                                                        00716000
STMTPTR  EQU   0                                                        00717000
USERID   EQU   0                                                        00718000
HIST     EQU   0                                                        00719000
MSGPT    EQU   0                                                        00720000
PCONTAB  EQU   0                                                        00721000
EXWORD   EQU   0                                                        00722000
PEXIT    EQU   0                                                        00723000
CTCMDNM  EQU   0                                                        00724000
         AGO   .@UNREFD                START UNREFERENCED COMPONENTS    00725000
RETCHAR  EQU   RET+2                                                    00726000
VAR4     EQU   MTINSRTS+13                                              00727000
HIGHL4   EQU   L4                                                       00728000
VAR3     EQU   MTINSRTS+9                                               00729000
HIGHL3   EQU   L3                                                       00730000
HIGHL2   EQU   L2                                                       00731000
HIGHL1   EQU   L1                                                       00732000
@NM00017 EQU   MSGTABLE+36                                              00733000
@NM00016 EQU   MSGTABLE+32                                              00734000
MTOLDPTR EQU   MSGTABLE+28                                              00735000
@NM00015 EQU   MSGTABLE+25                                              00736000
@NM00014 EQU   SW2                                                      00737000
MTDOMSW  EQU   SW2                                                      00738000
MT2OLDSW EQU   SW2                                                      00739000
MTNHEXSW EQU   SW                                                       00740000
MTWTPSW  EQU   SW                                                       00741000
MTJOBISW EQU   SW                                                       00742000
MTKEY1SW EQU   SW                                                       00743000
MTHEXSW  EQU   SW                                                       00744000
MTWTOSW  EQU   SW                                                       00745000
MTNOIDSW EQU   SW                                                       00746000
MSGCSECT EQU   MSGTABLE+16                                              00747000
MTHIGH   EQU   @NM00013                                                 00748000
MTCPPL   EQU   TMCTPTR                                                  00749000
LISTPTR  EQU   MSGTABLE                                                 00750000
@NM00012 EQU   HISTORY+50                                               00751000
HTACNTC2 EQU   HISTORY+48                                               00752000
HTACNTC1 EQU   HISTORY+46                                               00753000
@NM00011 EQU   HISTORY+36                                               00754000
@NM00010 EQU   HISTORY+35                                               00755000
@NM00009 EQU   HTSWITCH                                                 00756000
HTDLMSW  EQU   HTSWITCH                                                 00757000
HTDLM    EQU   DLMONJCL                                                 00758000
@NM00008 EQU   HISTORY+28                                               00759000
HTCODE   EQU   CODEFLD                                                  00760000
@NM00007 EQU   TAKEXITS                                                 00761000
COMNTX   EQU   TAKEXITS                                                 00762000
JESX     EQU   TAKEXITS                                                 00763000
NULLX    EQU   TAKEXITS                                                 00764000
CMDX     EQU   TAKEXITS                                                 00765000
DDX      EQU   TAKEXITS                                                 00766000
EXECX    EQU   TAKEXITS                                                 00767000
JOBX     EQU   TAKEXITS                                                 00768000
NONOTIFY EQU   GENL                                                     00769000
FIRST    EQU   GENL                                                     00770000
FLUSH    EQU   GENL                                                     00771000
CDLMFND  EQU   CMISC                                                    00772000
CNOTHING EQU   CMISC                                                    00773000
CCOMCON  EQU   CMISC                                                    00774000
CNAME    EQU   CMISC                                                    00775000
CCONERR  EQU   CMISC                                                    00776000
CDDDATA  EQU   CDTYPE                                                   00777000
CDDAST   EQU   CDTYPE                                                   00778000
@NM00006 EQU   CVERB+1                                                  00779000
@NM00005 EQU   CVERB+1                                                  00780000
CDATA    EQU   CVERB                                                    00781000
CDELIM   EQU   CVERB                                                    00782000
PDLMFND  EQU   PMISC                                                    00783000
PNOTHING EQU   PMISC                                                    00784000
PCOMCON  EQU   PMISC                                                    00785000
PVERBCOP EQU   PMISC                                                    00786000
PNAME    EQU   PMISC                                                    00787000
PCONERR  EQU   PMISC                                                    00788000
POPCONEX EQU   PMISC                                                    00789000
PCONEX   EQU   PMISC                                                    00790000
PDDDATA  EQU   PDTYPE                                                   00791000
PDDAST   EQU   PDTYPE                                                   00792000
@NM00004 EQU   PVERB+1                                                  00793000
@NM00003 EQU   PVERB+1                                                  00794000
PJES     EQU   PVERB+1                                                  00795000
PCOMMENT EQU   PVERB                                                    00796000
PCOMMAND EQU   PVERB                                                    00797000
PDD      EQU   PVERB                                                    00798000
PEXEC    EQU   PVERB                                                    00799000
PJOB     EQU   PVERB                                                    00800000
PNULL    EQU   PVERB                                                    00801000
PDATA    EQU   PVERB                                                    00802000
PDELIM   EQU   PVERB                                                    00803000
INOINIT  EQU   WHATMOD+3                                                00804000
INCOMPIN EQU   WHATMOD+3                                                00805000
INMSG    EQU   WHATMOD+3                                                00806000
INDAIRIN EQU   WHATMOD+3                                                00807000
INWRMGR  EQU   WHATMOD+3                                                00808000
INIDENT  EQU   WHATMOD+3                                                00809000
INREAD   EQU   WHATMOD+3                                                00810000
INGEN    EQU   WHATMOD+2                                                00811000
INPROMPT EQU   WHATMOD+1                                                00812000
INCONTRL EQU   WHATMOD                                                  00813000
SUBTAB   EQU   HISTORY                                                  00814000
@NM00002 EQU   IESTMTP2                                                 00815000
@NM00001 EQU   IETAKEEX                                                 00816000
IETCOMNT EQU   IETAKEEX                                                 00817000
IETJES   EQU   IETAKEEX                                                 00818000
IETNULL  EQU   IETAKEEX                                                 00819000
IETCMD   EQU   IETAKEEX                                                 00820000
IETDD    EQU   IETAKEEX                                                 00821000
IETEXEC  EQU   IETAKEEX                                                 00822000
IETJOB   EQU   IETAKEEX                                                 00823000
IERTEXT  EQU   IEREPLY+2                                                00824000
IEREPLYL EQU   IEREPLY                                                  00825000
.@UNREFD ANOP                          END UNREFERENCED COMPONENTS      00826000
@RT00101 EQU   BAD                                                      00827000
@RT00119 EQU   BAD                                                      00828000
@RT00121 EQU   BAD                                                      00829000
@RF00132 EQU   CALLEX                                                   00830000
@RF00150 EQU   OUT                                                      00831000
@RT00157 EQU   FORCE                                                    00832000
@RT00165 EQU   NEXTCALL                                                 00833000
@RT00172 EQU   FIRSTCAL                                                 00834000
@ENDDATA EQU   *                                                        00835000
         END   IKJEFF09,(C'PL/S-II',0503,73297)                         00836000
