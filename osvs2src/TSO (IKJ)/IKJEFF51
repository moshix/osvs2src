         TITLE 'IKJEFF51 - INSTALLATION EXIT INTERFACE                 *00001000
                       '                                                00002000
IKJEFF51 CSECT ,                                                   0001 00003000
@MAINENT DS    0H                                                  0001 00004000
         USING *,@15                                               0001 00005000
         B     @PROLOG                                             0001 00006000
         DC    AL1(16)                                             0001 00007000
         DC    C'IKJEFF51  73.293'                                 0001 00008000
         DROP  @15                                                      00009000
@PROLOG  ST    @14,12(,@13)                                        0001 00010000
         STM   @00,@12,20(@13)                                     0001 00011000
         BALR  @12,0                                               0001 00012000
@PSTART  DS    0H                                                  0001 00013000
         USING @PSTART,@12                                         0001 00014000
         L     @00,@SIZDATD                                        0001 00015000
         GETMAIN R,LV=(0)                                               00016000
         LR    @11,@01                                             0001 00017000
         USING @DATD,@11                                           0001 00018000
         ST    @13,@SA00001+4                                      0001 00019000
         LM    @00,@01,20(@13)                                     0001 00020000
         ST    @11,8(,@13)                                         0001 00021000
         LR    @13,@11                                             0001 00022000
         MVC   @PC00001(8),0(@01)                                  0001 00023000
DUMMYLBL DS    0H                                                  0003 00024000
*                                                                  0050 00025000
*   /*****************************************************************/ 00026000
*   /*                                                               */ 00027000
*   /* INITIALIZATION OF LOCAL POINTERS AND DATA                     */ 00028000
*   /*                                                               */ 00029000
*   /*****************************************************************/ 00030000
*                                                                  0050 00031000
*   FIBCMPTR=ADDR(FIBPARML);        /* USE LOCAL POINTER TO FIBCPARM    00032000
*                                      FOR EFFICIENCY                */ 00033000
         L     FIBCMPTR,@PC00001                                   0050 00034000
*   CSPLPTR=ADDR(CSPARML);          /* USE LOCAL POINTER TO PARMLIST    00035000
*                                      FOR EFFICIENCY                */ 00036000
         L     CSPLPTR,@PC00001+4                                  0051 00037000
*   HOLDER=JOBLISTP;                /* SAVE POINTER TO HEAD OF     0052 00038000
*                                      JOBNAME AND JOBID TABLE       */ 00039000
         L     HOLDER,JOBLISTP(,CSPLPTR)                           0052 00040000
*   SAVENO=TBLCOUNT;                /* SAVE COUNT OF JOBS - WILL   0053 00041000
*                                      DECREMENT THIS COUNT IF EXIT     00042000
*                                      REJECTS A JOB                 */ 00043000
*                                                                  0053 00044000
         L     @04,NUMJOBSP(,CSPLPTR)                              0053 00045000
         L     SAVENO,TBLCOUNT(,@04)                               0053 00046000
*   /*****************************************************************/ 00047000
*   /*                                                               */ 00048000
*   /* GO TO INSTALLATION EXIT FOR STATUS COMMAND WITH OPERANDS AND  */ 00049000
*   /* FOR CANCEL COMMAND                                            */ 00050000
*   /*                                                               */ 00051000
*   /*****************************************************************/ 00052000
*                                                                  0054 00053000
*   IF STATAUTO='0'B THEN           /* IF STATUS COMMAND WITH      0054 00054000
*                                      OPERANDS                      */ 00055000
         L     @04,SWITPTR(,CSPLPTR)                               0054 00056000
         TM    STATAUTO(@04),B'00100000'                           0054 00057000
         BNZ   @RF00054                                            0054 00058000
*STATCAN:                           /* LABEL FOR DO/END GROUP        */ 00059000
*     DO;                                                          0055 00060000
STATCAN  DS    0H                                                  0056 00061000
*       RFY                                                        0056 00062000
*         R0 RSTD;                                                 0056 00063000
*       GEN(LOAD EP=IKJEFF53);      /* THEN WILL NEED TO CALL      0057 00064000
*                                      INSTALLATION EXIT (IF STATUS     00065000
*                                      WAS ENTERED WITH NO OPERANDS,    00066000
*                                      BYPASS THIS DO LOOP)          */ 00067000
         LOAD EP=IKJEFF53                                               00068000
*       SAVER0=R0;                  /* SAVE ADDRESS OF WHERE IKJEFF53   00069000
*                                      WAS LOADED                    */ 00070000
         LR    SAVER0,R0                                           0058 00071000
*       RFY                                                        0059 00072000
*         R0 UNRSTD;                                               0059 00073000
*                                                                  0060 00074000
*       /*************************************************************/ 00075000
*       /*                                                           */ 00076000
*       /* SET UP INTERFACE TO THE INSTALLATION EXIT                 */ 00077000
*       /*                                                           */ 00078000
*       /*************************************************************/ 00079000
*                                                                  0060 00080000
*       EXITPARM=EXITPARM&&EXITPARM;/* CLEAR EXIT PARAMETER AREA     */ 00081000
         XC    EXITPARM(40),EXITPARM                               0060 00082000
*       USERIDPT=ADDR(FIBPSCBU);    /* PLACE POINTER TO USERID IN  0061 00083000
*                                      PARAMETER LIST                */ 00084000
         LA    @08,FIBPSCBU(,FIBCMPTR)                             0061 00085000
         ST    @08,USERIDPT                                        0061 00086000
*       IDLENPTR=ADDR(FIBPSCBL);    /* PUT ADDRESS OF LENGTH IN    0062 00087000
*                                      PARAMETER LIST                */ 00088000
         LA    @08,FIBPSCBL(,FIBCMPTR)                             0062 00089000
         ST    @08,IDLENPTR                                        0062 00090000
*       IF CANCELSW='1'B THEN       /* IF THE CANCEL SWITCH IS ON    */ 00091000
         L     @08,SWITPTR(,CSPLPTR)                               0063 00092000
         TM    CANCELSW(@08),B'10000000'                           0063 00093000
         BNO   @RF00063                                            0063 00094000
*         COMMCODE=4;               /* TELL THE EXIT THAT CANCEL IS     00095000
*                                      CALLING                       */ 00096000
         MVI   COMMCODE,X'04'                                      0064 00097000
*       ELSE                        /* OTHERWISE STATUS IS CALLER    */ 00098000
*         COMMCODE=0;                                              0065 00099000
         B     @RC00063                                            0065 00100000
@RF00063 MVI   COMMCODE,X'00'                                      0065 00101000
*       CCODEPTR=ADDR(COMMCODE);    /* PLACE ADDRESS OF CODE       0066 00102000
*                                      INDICATING WHAT COMMAND IS  0066 00103000
*                                      CALLING THE EXIT INTO THE   0066 00104000
*                                      PARAMETER LIST                */ 00105000
@RC00063 LA    @08,COMMCODE                                        0066 00106000
         ST    @08,CCODEPTR                                        0066 00107000
*       JOBIDLN=ADDR(SIZE);         /* SAVE POINTER TO AREA        0067 00108000
*                                      CONTAINING THE JOBID LENGTH   */ 00109000
         LA    @08,SIZE                                            0067 00110000
         ST    @08,JOBIDLN                                         0067 00111000
*       NAMELENP=ADDR(LEN);         /* SAVE POINTER TO AREA TO     0068 00112000
*                                      CONTAIN THE JOBNAME LENGTH    */ 00113000
         LA    @08,LEN                                             0068 00114000
         ST    @08,NAMELENP                                        0068 00115000
*       EXITHIGH='1'B;              /* END OF EXIT PARMLIST          */ 00116000
*                                                                  0069 00117000
         OI    EXITHIGH,B'10000000'                                0069 00118000
*       /*************************************************************/ 00119000
*       /*                                                           */ 00120000
*       /* LOOP THRU JOBNAME LIST (GO TO EXIT FOR EACH) - PASS       */ 00121000
*       /* INFORMATION FOR A JOB ON THE JOBLIST                      */ 00122000
*       /*                                                           */ 00123000
*       /*************************************************************/ 00124000
*                                                                  0070 00125000
*LOOP:                                                             0070 00126000
*       DO I=1 TO TBLCOUNT WHILE(QUIT='0'B&SAVENO^=0);/* LOOP THRU 0070 00127000
*                                      JOBNAMES - STOP EARLY IF    0070 00128000
*                                      SERIOUS ERROR OR IF TOOK LAST    00129000
*                                      JOBNAME OFF JOBNAME LIST      */ 00130000
LOOP     LA    I,1                                                 0070 00131000
         B     @DE00070                                            0070 00132000
@DL00070 L     @04,SWITPTR(,CSPLPTR)                               0070 00133000
         TM    QUIT(@04),B'00001000'                               0070 00134000
         BNZ   @DC00070                                            0070 00135000
         LTR   SAVENO,SAVENO                                       0070 00136000
         BZ    @DC00070                                            0070 00137000
*         JOBNMPTR=ADDR(JOBNMID);   /* PLACE A POINTER TO JOB NAME 0071 00138000
*                                      LIST IN EXIT PARAMETER LIST   */ 00139000
         L     @04,JOBLISTP(,CSPLPTR)                              0071 00140000
         LA    @04,JOBNMID(,@04)                                   0071 00141000
         ST    @04,JOBNMPTR                                        0071 00142000
*         LEN=LENGTH(JOBNMID);      /* INITIALIZE LENGTH OF JOBNAME     00143000
*                                      TO EIGHT                      */ 00144000
*                                                                  0072 00145000
         MVC   LEN(2),@CH00063                                     0072 00146000
*         /***********************************************************/ 00147000
*         /*                                                         */ 00148000
*         /* PICK UP JOBNAME                                         */ 00149000
*         /*                                                         */ 00150000
*         /***********************************************************/ 00151000
*                                                                  0073 00152000
*         DO T=1 TO LENGTH(JOBNMID);/* SPACE OVER UNTIL THE LAST     */ 00153000
         LA    T,1                                                 0073 00154000
@DL00073 DS    0H                                                  0074 00155000
*           IF JOBLISTP->JOBNMID(1,T:T)=' '/* CHARACTER OF THE       */ 00156000
*             THEN                  /* NAME IS FOUND                 */ 00157000
         L     @04,JOBLISTP(,CSPLPTR)                              0074 00158000
         ALR   @04,T                                               0074 00159000
         CLI   JOBNMID-1(@04),C' '                                 0074 00160000
         BNE   @RF00074                                            0074 00161000
*             DO;                                                  0075 00162000
*               LEN=T-1;            /* PLACE LENGTH IN PARM LIST     */ 00163000
         LR    @04,T                                               0076 00164000
         BCTR  @04,0                                               0076 00165000
         STH   @04,LEN                                             0076 00166000
*               T=LENGTH(JOBNMID);  /* INDICATES GET OUT OF LOOP     */ 00167000
         LA    T,8                                                 0077 00168000
*             END;                                                 0078 00169000
*         END;                                                     0079 00170000
*                                                                  0079 00171000
@RF00074 AH    T,@CH00046                                          0079 00172000
         CH    T,@CH00063                                          0079 00173000
         BNH   @DL00073                                            0079 00174000
*         /***********************************************************/ 00175000
*         /*                                                         */ 00176000
*         /* PICK UP JOBID, IF PRESENT                               */ 00177000
*         /*                                                         */ 00178000
*         /***********************************************************/ 00179000
*                                                                  0080 00180000
*         IF JOBLISTP->LEN1(1)=IDJOBID THEN                        0080 00181000
         L     @04,JOBLISTP(,CSPLPTR)                              0080 00182000
         CLI   LEN1(@04),X'44'                                     0080 00183000
         BNE   @RF00080                                            0080 00184000
*           DO;                                                    0081 00185000
*             JOBLISTP=JOBLISTP     /* UPDATE TO JOBID               */ 00186000
*                 +LENGTH(JOBLIST);                                0082 00187000
         AH    @04,@CH00095                                        0082 00188000
         ST    @04,JOBLISTP(,CSPLPTR)                              0082 00189000
*             JOBIDPTR=JOBLISTP     /* PLACE POINTER TO JOBID IN EXIT   00190000
*                                      PARAMETER LIST                */ 00191000
*                 +LENGTH(LEN1);                                   0083 00192000
         LA    @15,1                                               0083 00193000
         AR    @04,@15                                             0083 00194000
         ST    @04,JOBIDPTR                                        0083 00195000
*             SIZE=LENGTH(JOBNMID); /* INITIALIZE LENGTH TO EIGHT    */ 00196000
         MVC   SIZE(2),@CH00063                                    0084 00197000
*             DO T=1 TO LENGTH(JOBNMID);/* FIND LENGTH OF JOBID      */ 00198000
         LR    T,@15                                               0085 00199000
@DL00085 DS    0H                                                  0086 00200000
*               IF JOBLISTP->JOBNMID(1,T:T)=' ' THEN/* CHECK FOR END    00201000
*                                      OF JOBID                      */ 00202000
         L     @04,JOBLISTP(,CSPLPTR)                              0086 00203000
         ALR   @04,T                                               0086 00204000
         CLI   JOBNMID-1(@04),C' '                                 0086 00205000
         BNE   @RF00086                                            0086 00206000
*                 DO;                                              0087 00207000
*                   SIZE=T-1;       /* POINTING TO ONE BEYOND SO   0088 00208000
*                                      LENGTH IS ONE LESS            */ 00209000
         LR    @04,T                                               0088 00210000
         BCTR  @04,0                                               0088 00211000
         STH   @04,SIZE                                            0088 00212000
*                   T=LENGTH(JOBNMID);/* FOUND LENGTH, SO GET OUT    */ 00213000
         LA    T,8                                                 0089 00214000
*                 END;                                             0090 00215000
*             END;                                                 0091 00216000
@RF00086 AH    T,@CH00046                                          0091 00217000
         CH    T,@CH00063                                          0091 00218000
         BNH   @DL00085                                            0091 00219000
*             JOBIDSW='1'B;         /* HAVE A JOBID TO PASS SO TURN     00220000
*                                      FOUND BIT ON                  */ 00221000
         L     @04,SWITPTR(,CSPLPTR)                               0092 00222000
         OI    JOBIDSW(@04),B'00010000'                            0092 00223000
*             I=I+1;                /* UPDATE COUNT OF MAIN DO LOOP     00224000
*                                      BECAUSE TAKING TWO ITEMS OUT     00225000
*                                      OF LIST AT ONE TIME           */ 00226000
         AH    I,@CH00046                                          0093 00227000
*           END;                                                   0094 00228000
*         ELSE                      /* NO JOBID CASE                 */ 00229000
*           DO;                                                    0095 00230000
         B     @RC00080                                            0095 00231000
@RF00080 DS    0H                                                  0096 00232000
*             JOBIDSW='0'B;                                        0096 00233000
         L     @04,SWITPTR(,CSPLPTR)                               0096 00234000
         NI    JOBIDSW(@04),B'11101111'                            0096 00235000
*             JOBIDPTR=0;                                          0097 00236000
         SLR   @04,@04                                             0097 00237000
         ST    @04,JOBIDPTR                                        0097 00238000
*             SIZE=0;               /* JOBID LENGTH IS ZERO          */ 00239000
         STH   @04,SIZE                                            0098 00240000
*           END;                                                   0099 00241000
*         MESSAGEP=0;               /* ZERO OUT THE MESSAGE POINTER     00242000
*                                      -- EXIT MAY USE THIS AREA     */ 00243000
@RC00080 SLR   @04,@04                                             0100 00244000
         ST    @04,MESSAGEP                                        0100 00245000
*         REPLYPTR=0;               /* ZERO OUT REPLY POINTER -- EXIT   00246000
*                                      MAY LOOK FOR THE ADDRESS OF A    00247000
*                                      REPLY HERE                    */ 00248000
         ST    @04,REPLYPTR                                        0101 00249000
*                                                                  0102 00250000
*         /***********************************************************/ 00251000
*         /*                                                         */ 00252000
*         /* CALL THE INSTALLATION EXIT - MAY BE RE-ENTRY AFTER      */ 00253000
*         /* RETURN CODE 4 OR 8 IS PROCESSED                         */ 00254000
*         /*                                                         */ 00255000
*         /***********************************************************/ 00256000
*                                                                  0102 00257000
*CALL53:                                                           0102 00258000
*         RFY                                                      0102 00259000
*          (R0,                                                    0102 00260000
*           R1,                                                    0102 00261000
*           R15)RSTD;                                              0102 00262000
CALL53   DS    0H                                                  0103 00263000
*         R1=ADDR(EXITPARM);        /* PUT ADDRESS OF PARAMETER LIST    00264000
*                                      IN REGISTER ONE               */ 00265000
         LA    R1,EXITPARM                                         0103 00266000
*         CALL IKJEFF53;            /* CALL THE EXIT                 */ 00267000
         LR    @15,SAVER0                                          0104 00268000
         BALR  @14,@15                                             0104 00269000
*         RETCODE=R15;              /* SAVE RETURN CODE FROM THE EXIT*/ 00270000
         ST    R15,RETCODE                                         0105 00271000
*         IF REPLYPTR^=0 THEN       /* WE HAVE BEEN TO THE EXIT    0106 00272000
*                                      ALREADY AND THE EXIT REQUESTED   00273000
*                                      A REPLY - NOW IT HAS SEEN IT     00274000
*                                      SO FREE CORE USED             */ 00275000
         L     @14,REPLYPTR                                        0106 00276000
         LTR   @14,@14                                             0106 00277000
         BZ    @RF00106                                            0106 00278000
*           DO;                                                    0107 00279000
*             R0=REPSIZE;           /* PICK UP SIZE OF AREA USED     */ 00280000
         LH    R0,REPSIZE(,@14)                                    0108 00281000
*             R1=REPLYPTR;          /* PICK UP PTR TO REPLY AREA     */ 00282000
         LR    R1,@14                                              0109 00283000
*             GEN(FREEMAIN R,LV=(0),A=(1));/* FREE THE CORE          */ 00284000
         FREEMAIN R,LV=(0),A=(1)                                        00285000
*             REPLYPTR=0;           /* ZERO REPLY POINTER FOR NEXT 0111 00286000
*                                      JOBNAME                       */ 00287000
         SLR   @14,@14                                             0111 00288000
         ST    @14,REPLYPTR                                        0111 00289000
*           END;                                                   0112 00290000
*         RFY                                                      0113 00291000
*          (R0,                                                    0113 00292000
*           R1,                                                    0113 00293000
*           R15)UNRSTD;                                            0113 00294000
@RF00106 DS    0H                                                  0114 00295000
*                                                                  0114 00296000
*/********************************************************************/ 00297000
*/*                                                                  */ 00298000
*/* PROCESS RETURN CODE FROM THE EXIT                                */ 00299000
*/*                                                                  */ 00300000
*/*     0 = O.K., CONTINUE PROCESSING                                */ 00301000
*/*     4 = ISSUE PROMPT MSG IKJ56208A AND RETURN THE REPLY TO EXIT  */ 00302000
*/*     8 = ISSUE INFORMATIVE MSG IKJ56208I AND RETURN TO EXIT       */ 00303000
*/*          (THE IBM-SUPPLIED EXIT ISSUES R.C.=8 FOR A CANCEL WITH  */ 00304000
*/*           JOBNAME ^= USERID PLUS AT LEAST ONE CHARACTER)         */ 00305000
*/*     12= REJECT THIS JOB AND CONTINUE PROCESSING ANY OTHER JOBS   */ 00306000
*/*          (USED AFTER R.C.=4 OR 8 PROCESSED)                      */ 00307000
*/*     16= ABORT THE COMMAND                                        */ 00308000
*/*                                                                  */ 00309000
*/********************************************************************/ 00310000
*                                                                  0114 00311000
*         IF RETCODE^=EXITRC0 THEN                                 0114 00312000
         L     @04,RETCODE                                         0114 00313000
         LTR   @04,@04                                             0114 00314000
         BZ    @RF00114                                            0114 00315000
*RCODE:                                                            0115 00316000
*           DO;                     /* IF THE RETURN CODE FROM THE 0115 00317000
*                                      EXIT WAS NOT ZERO THEN START     00318000
*                                      THE RETURN CODE DIAGNOSIS     */ 00319000
RCODE    DS    0H                                                  0116 00320000
*             IF RETCODE^=EXITRC16 THEN/* DID THE EXIT WISH CANCEL OR   00321000
*                                      STATUS TO ABORT               */ 00322000
         CLC   RETCODE(4),@CF00067                                 0116 00323000
         BE    @RF00116                                            0116 00324000
*CODEN16:                           /* LABEL FOR DO/END GROUP        */ 00325000
*               DO;                                                0117 00326000
CODEN16  DS    0H                                                  0118 00327000
*                 IF RETCODE^=EXITRC12 THEN/* NO-NO ABORT--DID THE 0118 00328000
*                                      EXIT WISH THE JOBNAME TO BE 0118 00329000
*                                      DELETED                       */ 00330000
         CLC   RETCODE(4),@CF00065                                 0118 00331000
         BE    @RF00118                                            0118 00332000
*CODEN12:                           /* LABEL FOR DO/END GROUP        */ 00333000
*                   DO;                                            0119 00334000
*                                                                  0119 00335000
CODEN12  DS    0H                                                  0120 00336000
*                     /***********************************************/ 00337000
*                     /*                                             */ 00338000
*                     /* R.C.8 -- PUT OUT EXIT'S MSG WITH NO PROMPT  */ 00339000
*                     /* THEN RETURN TO EXIT                         */ 00340000
*                     /*                                             */ 00341000
*                     /***********************************************/ 00342000
*                                                                  0120 00343000
*                     IF RETCODE=EXITRC8 THEN                      0120 00344000
         CLC   RETCODE(4),@CF00063                                 0120 00345000
         BNE   @RF00120                                            0120 00346000
*CODE8:                                                            0121 00347000
*                       DO;         /* NO DELETION - IS THIS A     0121 00348000
*                                      REQUEST FOR A MESSAGE WITH NO    00349000
*                                      RESPONSE                      */ 00350000
CODE8    DS    0H                                                  0122 00351000
*                         MSGID='208I';/* YES, SO INDICATE MESSAGE 0122 00352000
*                                      THAT IS TO BE PUT OUT         */ 00353000
         L     @04,MSGPTR(,CSPLPTR)                                0122 00354000
         MVC   MSGID(4,@04),@CC00221                               0122 00355000
*                         L1=MLEN-LENGTH(MSGLNGTH);/* INDICATE LENGTH   00356000
*                                      OF MESSAGE                    */ 00357000
         LA    @15,2                                               0123 00358000
         L     @14,MESSAGEP                                        0123 00359000
         SLR   @03,@03                                             0123 00360000
         IC    @03,MLEN(,@14)                                      0123 00361000
         SR    @03,@15                                             0123 00362000
         STC   @03,L1(,@04)                                        0123 00363000
*                         VAR1=MESSAGEP+LENGTH(MSGLNGTH);/* SET UP 0124 00364000
*                                      TEXT OF MESSAGE AS AN INSERT,    00365000
*                                      AND PLACE IT IN MESSAGE     0124 00366000
*                                      PARAMETER LIST                */ 00367000
         AR    @14,@15                                             0124 00368000
         STCM  @14,7,VAR1(@04)                                     0124 00369000
*                       END CODE8;                                 0125 00370000
*                                                                  0126 00371000
*                     /***********************************************/ 00372000
*                     /*                                             */ 00373000
*                     /* R.C.4 -- PUT OUT EXIT'S MSG AND PROMPT FOR  */ 00374000
*                     /* REPLY, THEN RETURN TO EXIT                  */ 00375000
*                     /*                                             */ 00376000
*                     /***********************************************/ 00377000
*                                                                  0126 00378000
*                     ELSE                                         0126 00379000
*                       IF RETCODE=EXITRC4 THEN/* IF WANT PUTGET     */ 00380000
         B     @RC00120                                            0126 00381000
@RF00120 CLC   RETCODE(4),@CF00061                                 0126 00382000
         BNE   @RF00126                                            0126 00383000
*CODE4:                             /* LABEL FOR DO/END GROUP        */ 00384000
*                         DO;                                      0127 00385000
CODE4    DS    0H                                                  0128 00386000
*                           MSGID='208A';/* INDICATE MSGID OF MESSAGE*/ 00387000
         L     @04,MSGPTR(,CSPLPTR)                                0128 00388000
         MVC   MSGID(4,@04),@CC00224                               0128 00389000
*                           L1=MLEN-LENGTH(MSGLNGTH);/* INDICATE   0129 00390000
*                                      LENGTH OF MSG                 */ 00391000
         LA    @15,2                                               0129 00392000
         L     @14,MESSAGEP                                        0129 00393000
         SLR   @03,@03                                             0129 00394000
         IC    @03,MLEN(,@14)                                      0129 00395000
         SR    @03,@15                                             0129 00396000
         STC   @03,L1(,@04)                                        0129 00397000
*                           VAR1=MESSAGEP+LENGTH(MSGLNGTH);/* SET UP    00398000
*                                      TEXT OF MESSAGE AS AN INSERT,    00399000
*                                      AND PLACE IT IN MESSAGE     0130 00400000
*                                      PARAMETER LIST                */ 00401000
         AR    @14,@15                                             0130 00402000
         STCM  @14,7,VAR1(@04)                                     0130 00403000
*                           MTPUTLSW='0'B;/* INDICATE PUTGET MESSAGE */ 00404000
         NI    MTPUTLSW(@04),B'10111111'                           0131 00405000
*                         END CODE4;                               0132 00406000
*                                                                  0132 00407000
*                     /***********************************************/ 00408000
*                     /*                                             */ 00409000
*                     /* UNDIAGNOSED R.C. SO PUT OUT ERROR MESSAGE   */ 00410000
*                     /* AND TAKE ERROR EXIT                         */ 00411000
*                     /*                                             */ 00412000
*                     /***********************************************/ 00413000
*                                                                  0133 00414000
*                       ELSE                                       0133 00415000
*CODEOTH:                                                          0133 00416000
*                         DO;       /* HAD A NONZERO RETURN CODE FROM   00417000
*                                      EXIT - HOWEVER WAS UNABLE TO     00418000
*                                      DIAGNOSE IT SO PUT OUT UNABLE    00419000
*                                      TO DIAGNOSE MESSAGE           */ 00420000
         B     @RC00126                                            0133 00421000
@RF00126 DS    0H                                                  0133 00422000
CODEOTH  DS    0H                                                  0134 00423000
*                           MSGID='219I';/* INDICATE 'UNKNOWN RETURN    00424000
*                                      CODE' MESSAGE ID              */ 00425000
         L     @04,MSGPTR(,CSPLPTR)                                0134 00426000
         MVC   MSGID(4,@04),@CC00227                               0134 00427000
*                           VAR1=ADDR(EXITWD);/* INSERT IN FIRST   0135 00428000
*                                      LEVEL MESSAGE = 'INSTALLATION    00429000
*                                      EXIT'                         */ 00430000
         LA    @15,EXITWD                                          0135 00431000
         STCM  @15,7,VAR1(@04)                                     0135 00432000
*                           L1=LENGTH(EXITWD);                     0136 00433000
         MVI   L1(@04),X'11'                                       0136 00434000
*                           VAR2=ADDR(RETCODE);/* INSERT THE RETURN     00435000
*                                      CODE                          */ 00436000
         LA    @15,RETCODE                                         0137 00437000
         STCM  @15,7,VAR2(@04)                                     0137 00438000
*                           L2='84'X;/* LENGTH OF VARIABLE INSERTION    00439000
*                                      AND CONVERT R.C. TO PRINTABLE */ 00440000
         MVI   L2(@04),X'84'                                       0138 00441000
*                           QUIT='1'B;/* INDICATE ERROR EXIT         */ 00442000
         L     @04,SWITPTR(,CSPLPTR)                               0139 00443000
         OI    QUIT(@04),B'00001000'                               0139 00444000
*                         END CODEOTH;                             0140 00445000
*                                                                  0141 00446000
*                     /***********************************************/ 00447000
*                     /*                                             */ 00448000
*                     /* ISSUE MESSAGE                               */ 00449000
*                     /*                                             */ 00450000
*                     /***********************************************/ 00451000
*                                                                  0141 00452000
*                     RFY                                          0141 00453000
*                      (R1,                                        0141 00454000
*                       R15)RSTD;                                  0141 00455000
@RC00126 DS    0H                                                  0141 00456000
@RC00120 DS    0H                                                  0142 00457000
*                     R1=ADDR(MSGTABLE);/* GET ADDRESS OF IKJEFF02 0142 00458000
*                                      PARAMETER LIST                */ 00459000
         L     R1,MSGPTR(,CSPLPTR)                                 0142 00460000
*                     CALL IKJEFF02;/* ISSUE THE MESSAGE             */ 00461000
         L     @15,MSGRTNPT(,CSPLPTR)                              0143 00462000
         BALR  @14,@15                                             0143 00463000
*                     MSGCODE=R15;  /* ONLY CHECK FOR IKJEFF02     0144 00464000
*                                      R.C.=12, (ALWAYS ASSUME CAN DO   00465000
*                                      A PUTLINE WHEN WORKING WITH 0144 00466000
*                                      INSTALLATION EXIT MESSAGES)   */ 00467000
         LR    MSGCODE,R15                                         0144 00468000
*                     RFY                                          0145 00469000
*                      (R1,                                        0145 00470000
*                       R15)UNRSTD;                                0145 00471000
*                     MTPUTLSW='1'B;/* ENSURE PUTLINE, NOT PUTGET  0146 00472000
*                                      (NOPROMPT)                    */ 00473000
         L     @01,MSGPTR(,CSPLPTR)                                0146 00474000
         OI    MTPUTLSW(@01),B'01000000'                           0146 00475000
*                     IF RETCODE=EXITRC8|(RETCODE=EXITRC4&MSGCODE^=     00476000
*                         MSGRC12)THEN/* IF RETURN CODE FROM EXIT WAS   00477000
*                                      EITHER 4 0R 8 WILL NEED     0147 00478000
*                                      RE-ENTRY INTO THE EXIT        */ 00479000
         L     @15,RETCODE                                         0147 00480000
         CH    @15,@CH00063                                        0147 00481000
         BE    @RT00147                                            0147 00482000
         CH    @15,@CH00061                                        0147 00483000
         BNE   @RF00147                                            0147 00484000
         CH    MSGCODE,@CH00065                                    0147 00485000
         BE    @RF00147                                            0147 00486000
@RT00147 DS    0H                                                  0148 00487000
*                       DO;                                        0148 00488000
*                         IF RETCODE=EXITRC4 THEN/* RETURN REPLY FROM   00489000
*                                      PUTGET MESSAGE TO THE EXIT    */ 00490000
         CLC   RETCODE(4),@CF00061                                 0149 00491000
         BNE   @RF00149                                            0149 00492000
*                           REPLYPTR=RETMSG;                       0150 00493000
         L     @04,MSGPTR(,CSPLPTR)                                0150 00494000
         SLR   @15,@15                                             0150 00495000
         ICM   @15,7,RETMSG(@04)                                   0150 00496000
         ST    @15,REPLYPTR                                        0150 00497000
*                         MTINSRTS=MTINSRTS&&MTINSRTS;/* CLEAR     0151 00498000
*                                      MESSAGE INSERT AREA           */ 00499000
@RF00149 L     @04,MSGPTR(,CSPLPTR)                                0151 00500000
         XC    MTINSRTS(16,@04),MTINSRTS(@04)                      0151 00501000
*                         GO TO CALL53;/* CALL THE EXIT AGAIN        */ 00502000
         B     CALL53                                              0152 00503000
*                       END;                                       0153 00504000
*                                                                  0153 00505000
*                     /***********************************************/ 00506000
*                     /*                                             */ 00507000
*                     /* ERROR MSG IF R.C.=4 AND USER IN NOPROMPT    */ 00508000
*                     /* MODE                                        */ 00509000
*                     /*                                             */ 00510000
*                     /***********************************************/ 00511000
*                                                                  0154 00512000
*                     ELSE                                         0154 00513000
*                       IF MSGCODE=MSGRC12&RETCODE=EXITRC4 THEN/*  0154 00514000
*                                      TRIED TO GET REPLY BUT USER IN   00515000
*                                      NO PROMPT MODE                */ 00516000
@RF00147 CH    MSGCODE,@CH00065                                    0154 00517000
         BNE   @RF00154                                            0154 00518000
         CLC   RETCODE(4),@CF00061                                 0154 00519000
         BNE   @RF00154                                            0154 00520000
*                         DO;                                      0155 00521000
*                           QUIT='1'B;/* CONSIDER THIS AN ERROR SO 0156 00522000
*                                      QUIT                          */ 00523000
         L     @04,SWITPTR(,CSPLPTR)                               0156 00524000
         OI    QUIT(@04),B'00001000'                               0156 00525000
*                           MSGID='218I';/* PICK UP ID OF ERROR MSG  */ 00526000
         L     @04,MSGPTR(,CSPLPTR)                                0157 00527000
         MVC   MSGID(4,@04),@CC00229                               0157 00528000
*                           IF L1>80 THEN/* MSG WITH TOO MANY CHARS  */ 00529000
         CLI   L1(@04),80                                          0158 00530000
         BNH   @RF00158                                            0158 00531000
*                             L1=80;/* WANT TO PUT OUT PART OF MSG 0159 00532000
*                                      THAT THE EXIT TRIED TO PUT  0159 00533000
*                                      OUT, BUT ONLY 80 CHARS (VAR1     00534000
*                                      IS SAME) (THIS IS INSERT FOR     00535000
*                                      2ND LEVEL MSG)                */ 00536000
         MVI   L1(@04),X'50'                                       0159 00537000
*                           L2=LENGTH(FIBECTCN);/* INSERT =          */ 00538000
@RF00158 L     @04,MSGPTR(,CSPLPTR)                                0160 00539000
         MVI   L2(@04),X'08'                                       0160 00540000
*                           VAR2=ADDR(FIBECTCN);/* COMMAND NAME      */ 00541000
         LA    @15,FIBECTCN(,FIBCMPTR)                             0161 00542000
         STCM  @15,7,VAR2(@04)                                     0161 00543000
*                           L3=LENGTH(EXITWD);/* INSERT =            */ 00544000
         MVI   L3(@04),X'11'                                       0162 00545000
*                           VAR3=ADDR(EXITWD);/* 'INSTALLATION EXIT' */ 00546000
         LA    @15,EXITWD                                          0163 00547000
         STCM  @15,7,VAR3(@04)                                     0163 00548000
*                           RFY                                    0164 00549000
*                             R1 RSTD;                             0164 00550000
*                           R1=ADDR(MSGTABLE);/* GET ADDRESS OF MSG     00551000
*                                      RTN PARAMETER LIST            */ 00552000
         LR    R1,@04                                              0165 00553000
*                           CALL IKJEFF02;/* ISSUE THE MESSAGE       */ 00554000
         L     @15,MSGRTNPT(,CSPLPTR)                              0166 00555000
         BALR  @14,@15                                             0166 00556000
*                           RFY                                    0167 00557000
*                             R1 UNRSTD;                           0167 00558000
*                         END;                                     0168 00559000
*                   END CODEN12;                                   0169 00560000
*                                                                  0169 00561000
*                 /***************************************************/ 00562000
*                 /*                                                 */ 00563000
*                 /* R.C.=12, SO DELETE THIS JOB FROM THE PARAMETER  */ 00564000
*                 /* LIST. (ASSUME EXIT HAS PREVIOUSLY ISSUED AN     */ 00565000
*                 /* ERROR MESSAGE.)                                 */ 00566000
*                 /*                                                 */ 00567000
*                 /***************************************************/ 00568000
*                                                                  0170 00569000
*                 ELSE              /* THE EXIT DID PASS             */ 00570000
*CODE12:                                                           0170 00571000
*                   DO;             /* BACK A TWELVE RETURN CODE     */ 00572000
         B     @RC00118                                            0170 00573000
@RF00118 DS    0H                                                  0170 00574000
CODE12   DS    0H                                                  0171 00575000
*                     SAVENO=SAVENO-1;/* SUBTRACT FROM THE NUMBER OF    00576000
*                                      ENTRIES IN THE JOBNAME LIST 0171 00577000
*                                      BECAUSE THE EXIT WANTED THIS     00578000
*                                      JOBNAME DELETED               */ 00579000
         BCTR  SAVENO,0                                            0171 00580000
*                     IF JOBIDSW=ON THEN/* IF JOBID, BACK            */ 00581000
         L     @04,SWITPTR(,CSPLPTR)                               0172 00582000
         TM    JOBIDSW(@04),B'00010000'                            0172 00583000
         BNO   @RF00172                                            0172 00584000
*                       DO;         /* UP TO JOBNAME                 */ 00585000
*                         JOBLISTP=JOBLISTP/* BACK UP ONE            */ 00586000
*                             -LENGTH(JOBLIST);                    0174 00587000
         L     @04,JOBLISTP(,CSPLPTR)                              0174 00588000
         SH    @04,@CH00095                                        0174 00589000
         ST    @04,JOBLISTP(,CSPLPTR)                              0174 00590000
*                         SAVENO=SAVENO-1;/* SUBTRACT FROM NUMBER OF    00591000
*                                      ENTRIES                       */ 00592000
         BCTR  SAVENO,0                                            0175 00593000
*                         JOBPTR=JOBLISTP+18;/* POINT TO NEXT SLOT   */ 00594000
         AH    @04,@CH00161                                        0176 00595000
         LR    JOBPTR,@04                                          0176 00596000
*                       END;                                       0177 00597000
*                     ELSE          /* POINTING TO JOBNAME           */ 00598000
*                       JOBPTR=JOBLISTP/* POINT TO NEXT SLOT SO CAN     00599000
*                                      MOVE ALL JOBS UP              */ 00600000
*                           +LENGTH(JOBLIST);                      0178 00601000
         B     @RC00172                                            0178 00602000
@RF00172 LA    JOBPTR,9                                            0178 00603000
         A     JOBPTR,JOBLISTP(,CSPLPTR)                           0178 00604000
*                                                                  0179 00605000
*                     /***********************************************/ 00606000
*                     /*                                             */ 00607000
*                     /* TEST FOR POSITION ON JOBLIST                */ 00608000
*                     /*                                             */ 00609000
*                     /***********************************************/ 00610000
*                                                                  0179 00611000
*                     IF I=TBLCOUNT THEN                           0179 00612000
*                                                                  0179 00613000
@RC00172 L     @04,NUMJOBSP(,CSPLPTR)                              0179 00614000
         C     I,TBLCOUNT(,@04)                                    0179 00615000
         BNE   @RF00179                                            0179 00616000
*                       /*********************************************/ 00617000
*                       /*                                           */ 00618000
*                       /* THIS ENTRY IS AT END (DON'T USE JOBPTR)   */ 00619000
*                       /*                                           */ 00620000
*                       /*********************************************/ 00621000
*                                                                  0180 00622000
*                       JOBLISTP=JOBLISTP/* BACK UP TO PRIOR ENTRY   */ 00623000
*                           -LENGTH(JOBLIST);                      0180 00624000
*                                                                  0180 00625000
         L     @04,JOBLISTP(,CSPLPTR)                              0180 00626000
         SH    @04,@CH00095                                        0180 00627000
         ST    @04,JOBLISTP(,CSPLPTR)                              0180 00628000
*                     /***********************************************/ 00629000
*                     /*                                             */ 00630000
*                     /* THIS ENTRY IS AT BEGINNING OR IN THE MIDDLE */ 00631000
*                     /* OF JOB LIST (AND IS NOT THE ONLY ENTRY)     */ 00632000
*                     /*                                             */ 00633000
*                     /***********************************************/ 00634000
*                                                                  0181 00635000
*                     ELSE                                         0181 00636000
*NOTEND:                            /* LABEL FOR DO/END GROUP        */ 00637000
*                       DO;                                        0181 00638000
         B     @RC00179                                            0181 00639000
@RF00179 DS    0H                                                  0181 00640000
NOTEND   DS    0H                                                  0182 00641000
*                         SAVEHEAD=JOBLISTP;/* SAVE HEAD FROM THIS 0182 00642000
*                                      POINT ON                      */ 00643000
         L     @04,JOBLISTP(,CSPLPTR)                              0182 00644000
         ST    @04,SAVEHEAD                                        0182 00645000
*                         DO WHILE JOBPTR->LEN1(1)^=IDLASTJB;/* END     00646000
*                                      UPDATE LOOP AT LAST JOB'S   0183 00647000
*                                      ENTRY (LAST ENTRY IS MOVED UP)*/ 00648000
         B     @DE00183                                            0183 00649000
@DL00183 DS    0H                                                  0184 00650000
*                           JOBLISTP->JOBLIST(1)=JOBEL;/* COPY     0184 00651000
*                                      CURRENT ENTRY TO PRIOR      0184 00652000
*                                      POSITION                      */ 00653000
         L     @04,JOBLISTP(,CSPLPTR)                              0184 00654000
         MVC   JOBLIST(9,@04),JOBEL(JOBPTR)                        0184 00655000
*                           JOBLISTP=JOBLISTP+LENGTH(JOBLIST);/*   0185 00656000
*                                      UPDATE POSITION POINTER BY ONE   00657000
*                                      FIELD                         */ 00658000
         LA    @03,9                                               0185 00659000
         AR    @04,@03                                             0185 00660000
         ST    @04,JOBLISTP(,CSPLPTR)                              0185 00661000
*                           JOBPTR=JOBPTR+LENGTH(JOBLIST);/* UPDATE     00662000
*                                      ENTRY POINTER BY ONE FIELD    */ 00663000
         AR    JOBPTR,@03                                          0186 00664000
*                         END;                                     0187 00665000
@DE00183 CLI   LEN1(JOBPTR),X'80'                                  0187 00666000
         BNE   @DL00183                                            0187 00667000
*                         JOBLISTP->JOBLIST(1)=JOBEL;/* NOW HANDLE 0188 00668000
*                                      THE LAST ENTRY                */ 00669000
         L     @04,JOBLISTP(,CSPLPTR)                              0188 00670000
         MVC   JOBLIST(9,@04),JOBEL(JOBPTR)                        0188 00671000
*                       END NOTEND;                                0189 00672000
*                                                                  0189 00673000
*                     /***********************************************/ 00674000
*                     /*                                             */ 00675000
*                     /* INDICATE THE NEW LAST ENTRY (UNLESS THIS IS */ 00676000
*                     /* THE ONLY ENTRY ON THE JOBLIST)              */ 00677000
*                     /*                                             */ 00678000
*                     /***********************************************/ 00679000
*                                                                  0190 00680000
*                     IF SAVENO^=0 THEN                            0190 00681000
@RC00179 LTR   SAVENO,SAVENO                                       0190 00682000
         BZ    @RF00190                                            0190 00683000
*                       JOBLISTP->LEN1(1)=IDLASTJB;/* MARK THIS AS 0191 00684000
*                                      LAST ENTRY                    */ 00685000
         L     @04,JOBLISTP(,CSPLPTR)                              0191 00686000
         MVI   LEN1(@04),X'80'                                     0191 00687000
*                   END CODE12;                                    0192 00688000
*               END CODEN16;                                       0193 00689000
*                                                                  0193 00690000
*             /*******************************************************/ 00691000
*             /*                                                     */ 00692000
*             /* R.C.=16 SO TAKE ERROR EXIT WITHOUT ISSUING MESSAGE  */ 00693000
*             /*                                                     */ 00694000
*             /*******************************************************/ 00695000
*                                                                  0194 00696000
*             ELSE                                                 0194 00697000
*CODE16:                                                           0194 00698000
*               DO;                 /* THE EXIT DID PASS BACK A    0194 00699000
*                                      RETURN CODE OF SIXTEEN        */ 00700000
         B     @RC00116                                            0194 00701000
@RF00116 DS    0H                                                  0194 00702000
CODE16   DS    0H                                                  0195 00703000
*                 QUIT='1'B;        /* TURN ON QUIT BIT              */ 00704000
         L     @04,SWITPTR(,CSPLPTR)                               0195 00705000
         OI    QUIT(@04),B'00001000'                               0195 00706000
*               END CODE16;                                        0196 00707000
*           END RCODE;              /* END NON-ZERO R.C.             */ 00708000
*                                                                  0197 00709000
@RC00116 DS    0H                                                  0198 00710000
*         /***********************************************************/ 00711000
*         /*                                                         */ 00712000
*         /* CONTINUE LOOP THRU JOBNAMES IN PARAMETER LIST UNLESS    */ 00713000
*         /* QUIT SWITCH IS NOW ON                                   */ 00714000
*         /*                                                         */ 00715000
*         /***********************************************************/ 00716000
*                                                                  0198 00717000
*         IF RETCODE=EXITRC12 THEN                                 0198 00718000
@RF00114 CLC   RETCODE(4),@CF00065                                 0198 00719000
         BNE   @RF00198                                            0198 00720000
*           JOBLISTP=SAVEHEAD;      /* USE THIS JOBNAME - ALREADY  0199 00721000
*                                      UPDATED                       */ 00722000
         L     @04,SAVEHEAD                                        0199 00723000
         ST    @04,JOBLISTP(,CSPLPTR)                              0199 00724000
*         ELSE                      /* NO ERROR WITH THIS ENTRY SO   */ 00725000
*           JOBLISTP=JOBLISTP       /* UPDATE TO NEXT JOBNAME        */ 00726000
*               +LENGTH(JOBLIST);                                  0200 00727000
         B     @RC00198                                            0200 00728000
@RF00198 LA    @04,9                                               0200 00729000
         A     @04,JOBLISTP(,CSPLPTR)                              0200 00730000
         ST    @04,JOBLISTP(,CSPLPTR)                              0200 00731000
*       END LOOP;                   /* END OF ALL CALLS TO THE EXIT  */ 00732000
@RC00198 AH    I,@CH00046                                          0201 00733000
@DE00070 L     @04,NUMJOBSP(,CSPLPTR)                              0201 00734000
         C     I,TBLCOUNT(,@04)                                    0201 00735000
         BNH   @DL00070                                            0201 00736000
@DC00070 DS    0H                                                  0202 00737000
*       GEN(DELETE EP=IKJEFF53);    /* DONE WITH EXIT                */ 00738000
         DELETE EP=IKJEFF53                                             00739000
*     END STATCAN;                  /* END OF INTERFACE, CALL, AND 0203 00740000
*                                      DIAGNOSIS                     */ 00741000
*                                                                  0204 00742000
*   /*****************************************************************/ 00743000
*   /*                                                               */ 00744000
*   /* GO TO NEXT CANCEL/STATUS MODULE IF NO ERROR AND JOB LEFT ON   */ 00745000
*   /* LIST.                                                         */ 00746000
*   /*                                                               */ 00747000
*   /*****************************************************************/ 00748000
*                                                                  0204 00749000
*   IF SAVENO^=0&QUIT^='1'B THEN                                   0204 00750000
@RF00054 LTR   SAVENO,SAVENO                                       0204 00751000
         BZ    @RF00204                                            0204 00752000
         L     @04,SWITPTR(,CSPLPTR)                               0204 00753000
         TM    QUIT(@04),B'00001000'                               0204 00754000
         BO    @RF00204                                            0204 00755000
*CALLNEXT:                                                         0205 00756000
*     DO;                           /* IF NO ERRORS ENCOUNTERED OR AT   00757000
*                                      LEAST HAVE ONE JOB IN LIST  0205 00758000
*                                      THEN PROCEED                  */ 00759000
CALLNEXT DS    0H                                                  0206 00760000
*       JOBLISTP=HOLDER;            /* RESTORE POINTER TO HEAD OF JOB   00761000
*                                      NAME LIST                     */ 00762000
         ST    HOLDER,JOBLISTP(,CSPLPTR)                           0206 00763000
*       TBLCOUNT=SAVENO;            /* PUT NEW NUMBER OF ENTRIES IN     00764000
*                                      PARAMETER LIST                */ 00765000
         L     @10,NUMJOBSP(,CSPLPTR)                              0207 00766000
         ST    SAVENO,TBLCOUNT(,@10)                               0207 00767000
*       MTINSRTS=MTINSRTS&&MTINSRTS;/* ZERO MESSAGE INSERT AREA OF 0208 00768000
*                                      MSGTABLE                      */ 00769000
         L     @10,MSGPTR(,CSPLPTR)                                0208 00770000
         XC    MTINSRTS(16,@10),MTINSRTS(@10)                      0208 00771000
*       JOBIDSW='0'B;               /* CLEAR SWITCH IN PARMLIST      */ 00772000
*                                                                  0209 00773000
         L     @10,SWITPTR(,CSPLPTR)                               0209 00774000
         NI    JOBIDSW(@10),B'11101111'                            0209 00775000
*       /*************************************************************/ 00776000
*       /*                                                           */ 00777000
*       /* SET UP PARAMETERS TO PASS INTO NEXT MODULE                */ 00778000
*       /*                                                           */ 00779000
*       /*************************************************************/ 00780000
*                                                                  0210 00781000
*       CSPTR1=ADDR(FIBCPARM);      /* R1 -> CSPTR1 -> FIBCPARM      */ 00782000
         ST    FIBCMPTR,CSPTR1                                     0210 00783000
*       CSPTR2=ADDR(PARMLIST);      /* PASS A POINTER TO           0211 00784000
*                                      CANCEL/STATUS PARAMETER LIST  */ 00785000
         ST    CSPLPTR,CSPTR2                                      0211 00786000
*       CSHIGH='1'B;                /* STANDARD LINKAGE CONVENTION   */ 00787000
         OI    CSHIGH,B'10000000'                                  0212 00788000
*       RFY                                                        0213 00789000
*         R1 RSTD;                                                 0213 00790000
*       R1=ADDR(CSPTRS);            /* SET UP REG ONE AS CONVEYOR OF    00791000
*                                      PARAMETERS                    */ 00792000
         LA    R1,CSPTRS                                           0214 00793000
*       IF CANCELSW='1'B THEN       /* THIS IS A CANCEL SO           */ 00794000
         TM    CANCELSW(@10),B'10000000'                           0215 00795000
         BNO   @RF00215                                            0215 00796000
*         CALL IKJEFF54;            /* GO PROCESS CANCEL COMMAND     */ 00797000
         L     @15,@CV00050                                        0216 00798000
         BALR  @14,@15                                             0216 00799000
*       ELSE                        /* STATUSSW OR STATAUTO ON       */ 00800000
*         CALL IKJEFF52;            /* SO PROCESS STATUS COMMAND     */ 00801000
         B     @RC00215                                            0217 00802000
@RF00215 L     @15,@CV00049                                        0217 00803000
         BALR  @14,@15                                             0217 00804000
*       RFY                                                        0218 00805000
*         R15 RSTD;                                                0218 00806000
@RC00215 DS    0H                                                  0219 00807000
*       RETCODE=R15;                /* SAVE THE RETURN CODE          */ 00808000
         ST    R15,RETCODE                                         0219 00809000
*       RFY                                                        0220 00810000
*        (R1,                                                      0220 00811000
*         R15)UNRSTD;                                              0220 00812000
*     END CALLNEXT;                                                0221 00813000
*   ELSE                            /* NO REASON TO GO TO NEXT MODULE*/ 00814000
*     DO;                                                          0222 00815000
         B     @RC00204                                            0222 00816000
@RF00204 DS    0H                                                  0223 00817000
*       IF QUIT='1'B THEN           /* HAD A TERMINATING ERROR FOUND */ 00818000
         L     @10,SWITPTR(,CSPLPTR)                               0223 00819000
         TM    QUIT(@10),B'00001000'                               0223 00820000
         BNO   @RF00223                                            0223 00821000
*         RETCODE=12;                                              0224 00822000
         MVC   RETCODE(4),@CF00065                                 0224 00823000
*       IF SAVENO=0 THEN            /* HAD ALL JOBS REJECTED BY EXIT */ 00824000
@RF00223 SLR   @10,@10                                             0225 00825000
         CR    SAVENO,@10                                          0225 00826000
         BNE   @RF00225                                            0225 00827000
*         RETCODE=0;                                               0226 00828000
         ST    @10,RETCODE                                         0226 00829000
*     END;                                                         0227 00830000
@RF00225 DS    0H                                                  0228 00831000
*   RETURN CODE(RETCODE);           /* RETURN WITH APPROPRIATE CODE  */ 00832000
@RC00204 L     @10,RETCODE                                         0228 00833000
         L     @13,4(,@13)                                         0228 00834000
         L     @00,@SIZDATD                                        0228 00835000
         LR    @01,@11                                             0228 00836000
         FREEMAIN R,LV=(0),A=(1)                                        00837000
         LR    @15,@10                                             0228 00838000
         L     @14,12(,@13)                                        0228 00839000
         LM    @00,@12,20(@13)                                     0228 00840000
         BR    @14                                                 0228 00841000
*   END IKJEFF51                                                   0229 00842000
*                                                                  0229 00843000
*/* THE FOLLOWING INCLUDE STATEMENTS WERE FOUND IN THIS PROGRAM.     */ 00844000
*/*%INCLUDE SYSLIB  (IKJEFFB2)                                       */ 00845000
*/*%INCLUDE SYSLIB  (IKJEFFPT)                                       */ 00846000
*/*%INCLUDE SYSLIB  (IKJEFFMT)                                       */ 00847000
*                                                                  0229 00848000
*       ;                                                          0229 00849000
@DATA    DS    0H                                                       00850000
@CH00046 DC    H'1'                                                     00851000
@CH00095 DC    H'9'                                                     00852000
@CH00161 DC    H'18'                                                    00853000
@DATD    DSECT                                                          00854000
         DS    0F                                                       00855000
@SA00001 DS    18F                                                      00856000
@PC00001 DS    2F                                                       00857000
IKJEFF51 CSECT                                                          00858000
         DS    0F                                                       00859000
@CF00061 DC    F'4'                                                     00860000
@CH00061 EQU   @CF00061+2                                               00861000
@CF00063 DC    F'8'                                                     00862000
@CH00063 EQU   @CF00063+2                                               00863000
@CF00065 DC    F'12'                                                    00864000
@CH00065 EQU   @CF00065+2                                               00865000
@CF00067 DC    F'16'                                                    00866000
@DATD    DSECT                                                          00867000
         DS    0D                                                       00868000
RETCODE  DS    A                                                        00869000
SAVEHEAD DS    A                                                        00870000
LEN      DS    H                                                        00871000
SIZE     DS    H                                                        00872000
COMMCODE DS    AL1                                                      00873000
         DS    CL3                                                      00874000
CSPTRS   DS    CL8                                                      00875000
         ORG   CSPTRS                                                   00876000
CSPTR1   DS    AL4                                                      00877000
CSPTR2   DS    AL4                                                      00878000
         ORG   CSPTR2                                                   00879000
CSHIGH   DS    BL1                                                      00880000
         ORG   CSPTRS+8                                                 00881000
EXITPARM DS    CL40                                                     00882000
         ORG   EXITPARM                                                 00883000
JOBNMPTR DS    AL4                                                      00884000
NAMELENP DS    AL4                                                      00885000
USERIDPT DS    AL4                                                      00886000
IDLENPTR DS    AL4                                                      00887000
MESSAGEP DS    AL4                                                      00888000
REPLYPTR DS    AL4                                                      00889000
CCODEPTR DS    AL4                                                      00890000
JOBIDPTR DS    AL4                                                      00891000
JOBIDLN  DS    AL4                                                      00892000
@NM00010 DS    AL4                                                      00893000
         ORG   @NM00010                                                 00894000
EXITHIGH DS    BL1                                                      00895000
         ORG   EXITPARM+40                                              00896000
         ORG   *+1-(*-@DATD)/(*-@DATD) INSURE DSECT DATA                00897000
@ENDDATD EQU   *                                                        00898000
IKJEFF51 CSECT                                                          00899000
         DS    0F                                                       00900000
@SIZDATD DC    AL1(0)                                                   00901000
         DC    AL3(@ENDDATD-@DATD)                                      00902000
@CV00049 DC    V(IKJEFF52)                                              00903000
@CV00050 DC    V(IKJEFF54)                                              00904000
         DS    0D                                                       00905000
@CC00221 DC    C'208I'                                                  00906000
@CC00224 DC    C'208A'                                                  00907000
@CC00227 DC    C'219I'                                                  00908000
@CC00229 DC    C'218I'                                                  00909000
EXITWD   DC    CL17'INSTALLATION EXIT'                                  00910000
PATCH    DS    CL51                                                     00911000
         ORG   PATCH                                                    00912000
PTCHINIT DC    17CL3'ZAP'                                               00913000
         ORG   PATCH+51                                                 00914000
@00      EQU   00                      EQUATES FOR REGISTERS 0-15       00915000
@01      EQU   01                                                       00916000
@02      EQU   02                                                       00917000
@03      EQU   03                                                       00918000
@04      EQU   04                                                       00919000
@05      EQU   05                                                       00920000
@06      EQU   06                                                       00921000
@07      EQU   07                                                       00922000
@08      EQU   08                                                       00923000
@09      EQU   09                                                       00924000
@10      EQU   10                                                       00925000
@11      EQU   11                                                       00926000
@12      EQU   12                                                       00927000
@13      EQU   13                                                       00928000
@14      EQU   14                                                       00929000
@15      EQU   15                                                       00930000
MSGCODE  EQU   @04                                                      00931000
T        EQU   @02                                                      00932000
I        EQU   @08                                                      00933000
SAVENO   EQU   @06                                                      00934000
JOBPTR   EQU   @02                                                      00935000
HOLDER   EQU   @10                                                      00936000
SAVER0   EQU   @09                                                      00937000
CSPLPTR  EQU   @05                                                      00938000
FIBCMPTR EQU   @07                                                      00939000
R0       EQU   @00                                                      00940000
R1       EQU   @01                                                      00941000
R15      EQU   @15                                                      00942000
IKJEFF53 EQU   0                                                        00943000
FIBCPARM EQU   0                                                        00944000
FIBPSCBU EQU   FIBCPARM+4                                               00945000
FIBPSCBL EQU   FIBCPARM+11                                              00946000
FIBECTCN EQU   FIBCPARM+28                                              00947000
FIBFLAGS EQU   FIBCPARM+36                                              00948000
PARMLIST EQU   0                                                        00949000
JOBLISTP EQU   PARMLIST                                                 00950000
NUMJOBSP EQU   PARMLIST+4                                               00951000
SWITPTR  EQU   PARMLIST+8                                               00952000
MSGRTNPT EQU   PARMLIST+12                                              00953000
MSGPTR   EQU   PARMLIST+16                                              00954000
JOBLIST  EQU   0                                                        00955000
LEN1     EQU   JOBLIST                                                  00956000
JOBNMID  EQU   JOBLIST+1                                                00957000
TBLCOUNT EQU   0                                                        00958000
SWITCHES EQU   0                                                        00959000
CANCELSW EQU   SWITCHES                                                 00960000
STATAUTO EQU   SWITCHES                                                 00961000
JOBIDSW  EQU   SWITCHES                                                 00962000
QUIT     EQU   SWITCHES                                                 00963000
IKJEFF02 EQU   0                                                        00964000
MSGTABLE EQU   0                                                        00965000
TMCTPTR  EQU   MSGTABLE+4                                               00966000
ECBPTR   EQU   MSGTABLE+8                                               00967000
@NM00005 EQU   MSGTABLE+12                                              00968000
SW       EQU   MSGTABLE+20                                              00969000
MTPUTLSW EQU   SW                                                       00970000
RETMSG   EQU   MSGTABLE+21                                              00971000
SW2      EQU   MSGTABLE+24                                              00972000
MSGID    EQU   MSGTABLE+40                                              00973000
MTINSRTS EQU   MSGTABLE+44                                              00974000
L1       EQU   MTINSRTS                                                 00975000
VAR1     EQU   MTINSRTS+1                                               00976000
L2       EQU   MTINSRTS+4                                               00977000
VAR2     EQU   MTINSRTS+5                                               00978000
L3       EQU   MTINSRTS+8                                               00979000
VAR3     EQU   MTINSRTS+9                                               00980000
L4       EQU   MTINSRTS+12                                              00981000
RET      EQU   0                                                        00982000
REPTEXT  EQU   0                                                        00983000
REPSIZE  EQU   REPTEXT                                                  00984000
MSGLNGTH EQU   0                                                        00985000
MLEN     EQU   MSGLNGTH+1                                               00986000
JOBEL    EQU   0                                                        00987000
MSGECB   EQU   0                                                        00988000
MSGTMCT  EQU   0                                                        00989000
FIBPARML EQU   0                                                        00990000
CSPARML  EQU   0                                                        00991000
         AGO   .@UNREFD                START UNREFERENCED COMPONENTS    00992000
@NM00011 EQU   MSGLNGTH                                                 00993000
REPBUF   EQU   REPTEXT+2                                                00994000
RETCHAR  EQU   RET+2                                                    00995000
RETSIZE  EQU   RET                                                      00996000
MSGRTN   EQU   MSGTABLE+60                                              00997000
VAR4     EQU   MTINSRTS+13                                              00998000
HIGHL4   EQU   L4                                                       00999000
HIGHL3   EQU   L3                                                       01000000
HIGHL2   EQU   L2                                                       01001000
HIGHL1   EQU   L1                                                       01002000
@NM00009 EQU   MSGTABLE+36                                              01003000
@NM00008 EQU   MSGTABLE+32                                              01004000
MTOLDPTR EQU   MSGTABLE+28                                              01005000
@NM00007 EQU   MSGTABLE+25                                              01006000
@NM00006 EQU   SW2                                                      01007000
MTDOMSW  EQU   SW2                                                      01008000
MT2OLDSW EQU   SW2                                                      01009000
MTNHEXSW EQU   SW                                                       01010000
MTWTPSW  EQU   SW                                                       01011000
MTJOBISW EQU   SW                                                       01012000
MTKEY1SW EQU   SW                                                       01013000
MTHEXSW  EQU   SW                                                       01014000
MTWTOSW  EQU   SW                                                       01015000
MTNOIDSW EQU   SW                                                       01016000
MSGCSECT EQU   MSGTABLE+16                                              01017000
MTHIGH   EQU   @NM00005                                                 01018000
MTCPPL   EQU   TMCTPTR                                                  01019000
LISTPTR  EQU   MSGTABLE                                                 01020000
@NM00004 EQU   SWITCHES                                                 01021000
PTPURGSW EQU   SWITCHES                                                 01022000
STATUSSW EQU   SWITCHES                                                 01023000
PTHIGH   EQU   MSGPTR                                                   01024000
FIBCMDBF EQU   FIBCPARM+52                                              01025000
@NM00003 EQU   FIBCPARM+48                                              01026000
@NM00002 EQU   FIBCPARM+44                                              01027000
FIBCUSER EQU   FIBCPARM+40                                              01028000
@NM00001 EQU   FIBCPARM+38                                              01029000
FIBECTNO EQU   FIBFLAGS                                                 01030000
FIBCPPLE EQU   FIBCPARM+24                                              01031000
FIBCPPLP EQU   FIBCPARM+20                                              01032000
FIBCPPLU EQU   FIBCPARM+16                                              01033000
FIBCPPLC EQU   FIBCPARM+12                                              01034000
FIBCID   EQU   FIBCPARM+2                                               01035000
FIBCLEN  EQU   FIBCPARM                                                 01036000
.@UNREFD ANOP                          END UNREFERENCED COMPONENTS      01037000
@RC00118 EQU   @RC00116                                                 01038000
@RF00190 EQU   @RC00116                                                 01039000
@RF00154 EQU   @RC00118                                                 01040000
@ENDDATA EQU   *                                                        01041000
         END   IKJEFF51,(C'PL/S-II',0502,73293)                         01042000
