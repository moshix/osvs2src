AT       TITLE 'IKJEGAT - AT SUBCOMMAND OF TSO/TEST'                    00010002
         COPY  IKJEGSIO                                                 00010802
IKJEGAT  CSECT                                                          00480002
         EJECT                                                          00482002
*****************************  PROLOGUE  ****************************** 00490002
*                                                                     * 00500002
* STATUS                                                              * 00510002
*    CHANGE LEVEL 00, RELEASE NUMBER 02, VS2    03/02/73              * 00520002
*                                                                     * 00530002
* FUNCTION/OPERATION                                                  * 00540002
*    THIS MODULE CONTAINS LOGIC FOR THE AT SUBCOMMAND OF THE 'TEST'   * 00550002
*    PACKAGE FOR THE TIME SHARING OPTION (TSO) FOR AOS/2.  IT         * 00560002
*    HAS TWO FUNCTIONS-                                               * 00570002
*    1.  DETERMINE IF AT WAS ISSUED FOR A DEFER REQUEST OR TO MAKE    * 00580002
*    ACTIVE BREAKPOINTS.  IF THE REQUEST IS TO ALTER THE DEFER        * 00590002
*    QUEUE, THIS MODULE XCTL'S TO THE SECOND LOAD OF AT.              * 00600002
*    2.  INSERT BREAKPOINTS AT SPECIFIED LOCATIONS IN THE PROBLEM     * 00610002
*    PROGRAM AND SAVE ANY ASSOCIATED SUBCOMMAND CHAIN FOR THE         * 00620002
*    ADDRESSES SPECIFIED.                                             * 00630002
*                                                                     * 00640002
* ENTRY POINTS                                                        * 00650002
*         IKJEGAT - DETERMINES WHETHER THE MODULE WAS ENTERED         * 00660002
*    BECAUSE OF A USER REQUEST OR BECAUSE A NEW LOAD MODULE           * 00670002
*    HAS BEEN BROUGHT INTO CORE AND IT IS NECESSARY TO SEARCH         * 00680002
*    THE DEFER QUEUE FOR REQUESTS AGAINST THAT MODULE.                * 00690002
*                                                                     * 00700002
* INPUT                                                               * 00710002
*    A FLAG (TSTFLGS1) IN THE COMMUNICATIONS TABLE INDICATES          * 00720002
*    THE TYPE OF ENTRANCE.  WHEN THE AT ROUTINE IS ENTERED BECAUSE    * 00730002
*    A NEW MODULE HAS BEEN BROUGHT INTO CORE, THE FIRST TWO WORDS     * 00740002
*    IN AT'S WORK AREA WILL CONTAIN THE NAME OF THE MODULE.           * 00750002
*                                                                     * 00760002
* OUTPUT                                                              * 00770002
*    OUTPUT CONSISTS OF-                                              * 00780002
*    1.  DIAGNOSTIC MESSAGES.                                         * 00790002
*    2.  A BREAK ELEMENT QUEUE POINTED TO BY BREAKTAB IN TCOMTAB IN   * 00800002
*    THE FORMAT DESCRIBED BY THE BRKELEM DSECT.                       * 00810002
*    3.  RETURN CODES AS LISTED BELOW-                                * 00820002
*                                                                     * 00830002
*    0 - MAINLINE MAY REISSUE TEST MODE MESSAGE TO GET ANOTHER        * 00840002
*    SUBCOMMAND. TSTFLUSH IN TCOMTAB IS ON IF ERROR OCCURRED.         * 00850002
*    4 - RESUME PROBLEM PROGRAM - USED ONLY WHEN ACTIVATING DEFERRED  * 00860002
*    BREAKPOINTS. TSTFLUSH IN TCOMTAB IS ON IF ERROR OCCURRED.        * 00865002
*    16 - ATTENTION HAS BEEN SCHEDULED                                * 00870002
*    20 - INDICATE RETURN FROM RETRY ROUTINE                          * 00880002
*    24 - INDICATES AN ESTAE MACRO FAILURE                            * 00882002
*                                                                     * 00890002
* EXTERNAL REFERENCES                                                 * 00900002
*         1.  IKJPARS - TO SCAN THE INPUT BUFFER FOR SYNTAX CHECKING  * 00910002
*    OF ADDRESSES AND KEYWORDS IF SPECIFIED AND TO PROMPT THE         * 00920002
*    USER FOR VALID INPUT WHEN NECESSARY.  AT ENTRY TO IKJPARS        * 00930002
*    REGISTER ONE POINTS TO A PARAMETER LIST WITH THE                 * 00940002
*    FOLLOWING FORMAT-                                                * 00950002
*                                                                     * 00960002
*         0 - POINTER TO UPT                                          * 00970002
*         4 - POINTER TO ECT                                          * 00980002
*         8 - POINTER TO CP ECB                                       * 00990002
*         12 - POINTER TO PARAMETER DESCRIPTOR CONTROL LIST           * 01000002
*         16 - POINTER TO ANSWER PLACE                                * 01010002
*         20 - POINTER TO COMMAND BUFFER                              * 01020002
*         24 - POINTER TO USER WORK AREA (AT'S SAVE AREA)             * 01030002
*                                                                     * 01040002
*         2.  IKJEGCVT - CONVERTS AN ABSOLUTE ADDRESS, AN EXPRESSION, * 01050002
*    AN INDIRECT ADDRESS, OR A FULLY QUALIFIED ADDRESS TO             * 01060002
*    BINARY.  AT ENTRY, REGISTER ONE CONTAINS THE COMPLEMENT          * 01070002
*    OF THE PDE ADDRESS TO INDICATE AN ADDRESS CONVERSION             * 01080002
*    AND REGISTER ZERO IS SET TO ZERO TO INDICATE A CONVERT           * 01090002
*    TO BINARY. IN MOST CASES A SWITCH MUST BE SET IN TCOMTAB         * 01100002
*    TO TELL CONVERT THAT A RANGE IS POSSIBLE.  FOR A VALUE           * 01110002
*    CONVERSION TO BINARY REGISTER 1 CONTAINS A POINTER TO THE        * 01120002
*    COUNT PDE AND REGISTER 0 CONTAINS ZERO.                          * 01130002
*                                                                     * 01180002
* EXITS, NORMAL                                                       * 01190002
*    IF IT IS DETERMINED THAT AT WAS ISSUED TO PUT A DEFER BREAK      * 01200002
*    ELEMENT ON THE QUEUE, THIS MODULE XCTL'S TO THE SECOND LOAD      * 01210002
*    MODULE OF AT, IKJEGATD.  OTHERWISE, RETURN IS VIA REGISTER       * 01220002
*    14 TO THE CALLER.                                                * 01230002
*                                                                     * 01240002
* EXITS, ERROR                                                        * 01250002
*    RETURN VIA REGISTER 14 TO THE CALLER.                            * 01260002
*                                                                     * 01270002
* TABLES/WORK AREAS                                                   * 01280002
*    THIS MODULE USES WORK AREAS AS DESCRIBED BY THE FOLLOWING DSECTS * 01290002
*    1.  TCOMTAB - TEST'S COMMUNICATION WORK AREA                     * 01300002
*    2.  WORKSP - AT'S WORK AREA, A PART OF TEST'S WORK AREA DEFINED  * 01310002
*    BY THE TSTCWORK DSECT AS CWORKCMD                                * 01320002
*    3.  IKJPARMD - INFORMATION FROM IKJPARS                          * 01330002
*    4.  CONPLACE - INFORMATION FROM IKJEGCVT                         * 01340002
*                                                                     * 01350002
* ATTRIBUTES                                                          * 01360002
*    REENTRANT, REFRESHABLE.                                          * 01370002
*                                                                     * 01380002
* CHARACTER CODE DEPENDENCY                                           * 01390002
*    THE OPERATION OF THIS MODULE DEPENDS UPON AN INTERNAL REPRESEN-  * 01400002
*    TATION OF THE EXTERNAL CHARACTER SET WHICH IS EQUIVALENT TO THE  * 01410002
*    ONE USED AT ASSEMBLY TIME.  THE CODING HAS BEEN ARRANGED SO THAT * 01420002
*    REDEFINITION OF 'CHARACTER' CONSTANTS, BY REASSEMBLY, WILL RESULT* 01430002
*    IN A CORRECT MODULE FOR THE NEW DEFINITIONS.                     * 01440002
*                                                                     * 01450002
* NOTES                                                               * 01460002
*    NONE.                                                            * 01470002
*                                                                     * 01480002
*********************************************************************** 01490002
         EJECT                                                          01500002
*********************************************************************** 01510002
*                                                                     * 01520002
*                   EQUATES                                           * 01530002
*                                                                     * 01540002
*********************************************************************** 01550002
         SPACE                                                          01560002
R0       EQU   0                        REGISTER 0 - PARM REG           01570002
R1       EQU   1                        REGISTER 1 - WORKREG            01580002
R2       EQU   2                        REGISTER 2 - WORKREG            01590002
R3       EQU   3                        REGISTER 3 - RESERVED FOR       01600002
*                                       MAINTENANCE                     01610002
R4       EQU   4                        REGISTER 4 - WORKREG            01620002
R5       EQU   5                        REGISTER 5 - WORKREG - USED     01630002
*                                       FOR BALS TO INTERNAL RTNS       01640002
R6       EQU   6                        REGISTER 6 - WORKREG            01650002
R7       EQU   7                        REGISTER 7 - WORKREG            01660002
R8       EQU   8                        REGISTER 8 - WORKREG - IN ADDR  01670002
*                                       EXITS, SAVES ADDRESS OF WORD    01672002
*                                       TO SEND 2ND LVL MSGS TO PARSE   01674002
R9       EQU   9                        REGISTER 9 - BASE FOR TCOMTAB   01680002
R10      EQU   10                       REGISTER 10 - BASE FOR COMMON   01690002
*                                       WORKAREA                        01700002
R11      EQU   11                       REGISTER 11 - BASE FOR ADDRESS  01710002
*                                       PDE                             01720002
R12      EQU   12                       REGISTER 12 - AT'S BASE         01730002
*                                       REGISTER                        01740002
R13      EQU   13                       REGISTER 13 - SAVE AREA PTR     01750002
R14      EQU   14                       REGISTER 14 - FOR EXTERNAL      01760002
*                                       BALRS                           01770002
R15      EQU   15                       REGISTER 15 - WORKREG, RETURN   01780002
*                                       CODE REG                        01790002
         SPACE                                                          01800002
ZERO     EQU   0                        NUMBER 0                        01810002
ONE      EQU   1                        NUMBER 1                        01820002
TWO      EQU   2                        NUMBER 2                        01830002
THREE    EQU   3                        NUMBER 3                        01840002
FOUR     EQU   4                        NUMBER 4                        01850002
EIGHT    EQU   8                        NUMBER 8                        01860002
TWELVE   EQU   12                       NUMBER 12                       01870002
SIXTEEN  EQU   16                       NUMBER 16                       01880002
TWENTY   EQU   20                       NUMBER 20                       01890002
TWENTY4  EQU   24                       NUMBER 24                       01900002
TWENTY6  EQU   26                       NUMBER 26                       01910002
TWENTY8  EQU   28                       NUMBER 28                       01920002
THIRTY   EQU   30                       NUMBER 30                       01930002
FORTY3   EQU   43                       NUMBER 43                       01940002
FORTY6   EQU   46                       NUMBER 46                       01950002
FORTY7   EQU   47                       NUMBER 47                       01960002
         SPACE                                                          01970002
L1       EQU   1                        LENGTH OF 1                     01980002
L2       EQU   2                        LENGTH OF 2                     01990002
L3       EQU   3                        LENGTH OF 3                     02000002
L4       EQU   4                        LENGTH OF 4                     02010002
L5       EQU   5                        LENGTH OF 5                     02020002
L6       EQU   6                        LENGTH OF 6                     02030002
L25      EQU   25                       LENGTH OF 25                    02040002
L30      EQU   30                       LENGTH OF 30                    02050002
L34      EQU   34                       LENGTH OF 34                    02060002
L46      EQU   46                       LENGTH OF 46                    02070002
L69      EQU   69                       LENGTH OF 69                    02080002
L98      EQU   98                       LENGTH OF 98                    02090002
         SPACE                                                          02100002
D0       EQU   0                        DISPLACEMENT OF 0               02110002
D1       EQU   1                        DISPLACEMENT OF 1               02120002
D2       EQU   2                        DISPLACEMENT OF 2               02130002
D3       EQU   3                        DISPLACEMENT OF 3               02140002
D4       EQU   4                        DISPLACEMENT OF 4               02150002
D6       EQU   6                        DISPLACEMENT OF 6               02160002
D7       EQU   7                        DISPLACEMENT OF 7               02170002
D8       EQU   8                        DISPLACEMENT OF 8               02180002
         SPACE                                                          02190002
FACTOR   EQU   8                        DISPLACEMENT FOR MESSAGE        02200002
*                                       POINTERS                        02210002
BAL      EQU   X'45'                    BAL OP CODE.                    02220002
BALR     EQU   X'05'                    BALR OP CODE.                   02230002
LENBITS  EQU   X'C0'                    LENGTH BITS OF OP CODE.         02260002
HEX00    EQU   X'00'                    BYTE OF ZEROS                   02270002
HEXB2    EQU   X'B2'                    USED IN 370 OP CODE CHECK       02280002
HEXFF    EQU   X'FF'                    END FLAG FOR PARSE'S PARM LIST  02290002
FF       EQU   X'FF'                    TEST MASK FOR KEYWORDS          02300002
BADBOUND EQU   X'01'                    SETTING TO TEST FOR ADDRESS ON  02310002
*                                       HALFWORD BOUNDARY               02320002
BLANK    EQU   C' '                     BLANK                           02330002
PLUS     EQU   C'+'                     CHARACTER PLUS SIGN             02340002
FCODE    EQU   X'10'                    FULLWORD DECIMAL TYPE CODE      02350002
CZERO    EQU   C'0'                     CHARACTER ZERO                  02360002
F0       EQU   X'F0'                    ZERO                            02370002
TESTSVC  EQU   97                       TEST'S SVC NUMBER               02380002
MAXLEN   EQU   255                      MAXIMUM LENGTH OF               02390002
*                                       SUBCOMMAND CHAIN                02400002
OVLYBIT  EQU   X'20'                    FLAG TO INDICATE OVERLAY        02410002
TWOHIGH  EQU   X'13'                    MAXIMUM VALUE OF SECOND         02420002
*                                       BYTE OF VALID TWO-BYTE OP CODE  02430002
SVC10NO  EQU   10            SVC 10 NUMBER-GETMAIN                      02480002
SVC120NO EQU   120           SVC 120 NUMBER-FREEMAIN                    02530002
RC24     EQU   24            RETURN CODE 24                             02540002
         EJECT                                                          02580002
*********************************************************************** 02590002
*                                                                     * 02600002
*                  AT PROCESSING STARTS HERE                          * 02610002
*                                                                     * 02620002
*********************************************************************** 02630002
         USING TCOMTAB,R9               ESTABLISH ADDRESSABILITY TO     02640002
*                                       COMMUNICATION WORK AREA         02650002
         USING TSTCWORK,R10             R10 IS USED AS A BASE FOR       02660002
*                                       COMMON WORKAREA                 02670002
         SPACE                                                          02680002
         SAVE (14,12),,IKJEGAT          SAVE CALLER'S REGISTERS         02690002
         LR    R12,R15                  ESTABLISH ADDRESSABILITY        02700002
         USING IKJEGAT,R12              FOR THIS CSECT                  02710002
         L     R5,REGSAVE2              R5=ADDR OF AT'S SAVE AREA       02720002
         ST    R13,SAVELAST-SAVEAREA(R5)  STORE BACKWARD CHAIN PTR      02730002
         ST    R5,SAVENEXT-SAVEAREA(R13)  STORE FORWARD POINTER         02740002
         LR    R13,R5                   R13=ADDRESS OF AT'S SAVE AREA   02750002
         L     R10,WORKAREA             R10=ADDRESS OF COMMON WORKAREA  02760002
         SPACE                                                          02770002
*********************************************************************** 02780002
*        SET UP AND ISSUE ESTAE FOR ABENDS                            * 02790002
*********************************************************************** 02800002
         XC    STAEL,STAEL   CLEAR ESTAE PARM LIST                      02900002
         L     R15,TSTSTAE   R15=ADDR OF ESTAE EXIT ROUTINE             02902002
         ESTAE (R15),CT,PARAM=ATSPL,XCTL=NO,RECORD=YES,                *02910002
               MF=(E,STAEL) ESTABLISH ESTAE EXIT                        02920002
         LTR   R15,R15                  WAS STAE SUCCESSFUL             02940002
SMTSTAE  BZ    CONTINUE                 YES. CONTINUE.                  02950002
         STC   R15,TSTESTRC  SAVE RETURN CODE FROM ESTAE                02952002
         LA    R15,RC24      SET RETURN CODE TO 24                      02954002
         OI    TSTFLGS4,TSTFLUSH TELL MAINLINE TO FLUSH STACK           02956002
         B     RETMAIN       RETURN TO IKJEGMNL                         02958002
         SPACE                                                          02960002
*********************************************************************** 03070002
*        ESTAE OK. IF AT IS TO ACTIVATE DEFERRED BREAKPOINTS,         * 03080002
*        GO HANDLE THEM.                                              * 03090002
*********************************************************************** 03100002
CONTINUE DS    0H                       PROCESSING AFTER ISSUING STAE   03110002
         TM    TSTFLGS1,TSTBUILD        IS AT LOGIC RECEIVING CONTROL   03120002
*                                       TO CREATE ACTIVE BREAK          03130002
*                                       ELEMENTS FROM THE DEFER         03140002
*                                       QUEUE FOR A NEWLY LOADED        03150002
*                                       MODULE                          03160002
         BO    FROMDEFR                 YES, HANDLE DEFER QUEUE         03170002
         SPACE                                                          03180002
*********************************************************************** 03190002
*        AT WAS ISSUED FROM TERMINAL.                                 * 03200002
* CREATE THE PARAMETER LIST REQUIRED AND LINK TO IKJPARS TO SCAN THE  * 03210002
* SUBCOMMAND AND VALIDITY CHECK THE INPUT.                            * 03220002
*********************************************************************** 03230002
         LM    R4,R6,PARMLIST           PICK UP POINTERS TO UPT, ECT,   03240002
*                                       AND CP ECB                      03250002
         ST    R4,PARMS+PPLUPT-PPL      SAVE PTR TO UPT                 03260002
         ST    R5,PARMS+PPLECT-PPL      SAVE PTR TO ECT                 03270002
         ST    R6,PARMS+PPLECB-PPL      SAVE PTR TO CP'S ECB            03280002
         L     R2,PCLISTA               R2=ADDRESS OF PCL               03290002
         LA    R5,TSTANSPL              R5=POINTER TO ANSWER PLACE      03300002
         L     R4,INBUF                 R4=ADDRESS OF SUBCOMMAND BUFFER 03310002
         ST    R2,PARMS+PPLPCL-PPL      SAVE PTR TO PCL                 03320002
         ST    R5,PARMS+PPLANS-PPL      SAVE PTR TO ANSWER PLACE        03330002
         ST    R4,PARMS+PPLCBUF-PPL     SAVE PTR TO BUFFER              03340002
         ST    R13,PARMS+PPLUWA-PPL     SAVE PTR TO AT'S WORK AREA      03350002
         LA    R1,PARMS                 R1=ADDRESS OF PARAMETER LIST    03360002
         LINK  EP=IKJPARS,ERRET=PARSERR  GO TO PARSE ROUTINE            03370002
SMTPARS  DS    0H                       FOR SMT TEST CASES.             03380002
BLOW5    DS    0H                       RESUME ADDRESS IN CASE LINK     03390002
*                                       FAILS                           03400002
         SPACE                                                          03410002
*********************************************************************** 03420002
*        CHECK PARSE RETURN CODE. IF NONZERO, GO PROCESS              * 03430002
*        IT. PUT PDE ADDRESS IN R11. IF DEFER WAS SPECIFIED IN        * 03440002
*        COMMAND, GO XCTL TO SECOND LOAD OF AT, IKJEGATD.             * 03450002
*********************************************************************** 03460002
         LTR   R15,R15                  WAS PARSE SUCCESSFUL            03470002
         BNZ   CHKCODE(R15)             NO, FIND OUT WHY                03480002
         L     R1,TSTANSPL              R1=POINTER TO PDL               03490002
         USING IKJPARMD,R1              SET UP ADDRESSABILITY TO PDL    03500002
         LA    R11,ADDR                 R11=ADDRESS OF ADDRESS PDE      03510002
         USING IKJPARMA,R11             SET UP ADDRESSABILITY TO        03520002
*                                       ADDRESS PDE                     03530002
         LA    R2,TWO                   R2=TWO                          03540002
         CH    R2,DEFER                 WAS DEFER SPECIFIED ?           03550002
         BE    TRANSFER                 YES, XCTL TO SECOND LOAD OF AT  03560002
         DROP  R1                                                       03570002
         SPACE                                                          03580002
*********************************************************************** 03590002
*        AT WAS ISSUED TO MAKE ACTIVE BREAKPOINTS. CONVERT ALL        * 03600002
*        ADDRESSES IN THE ADDRESS PDES TO BINARY.                     * 03610002
*********************************************************************** 03620002
         SPACE                                                          03630002
         XR    R6,R6                    INITIALIZE INDICATOR FOR        03640002
*                                       CONVERTED PDE'S                 03650002
WASITCVD DS    0H                       MAKE SURE ALL PDE'S ARE         03660002
*                                       CONVERTED                       03670002
         TM    PDEUSER,PDECONVD         HAS PDE BEEN CONVERTED          03680002
         BZ    CONVPDE                  NO, CONVERT PDE                 03690002
         LA    R6,D1(R6)                SET INDICATOR FOR PDE           03700002
*                                       CONVERTED                       03710002
         SPACE                                                          03720002
MOREPDES DS    0H                       ARE THERE MORE PDE'S            03730002
         L     R11,PDE2CHAI             R11=PDE CHAIN CONTENTS          03740002
         LA    R11,D0(R11)              CLEAR HIGH ORDER BYTE           03750002
         LTR   R11,R11                  IS CHAIN FIELD EMPTY            03760002
         BNZ   WASITCVD                 NO, CHECK FOR PDE CONVERTED     03770002
         SPACE                                                          03780002
*********************************************************************** 03790002
*        IF NO ADDRESSES WERE CONVERTED SUCCESSFULLY, RETURN          * 03800002
*        TO MAINLINE.                                                 * 03810002
*********************************************************************** 03820002
         LTR   R6,R6                    WAS AT LEAST ONE PDE            03830002
*                                       CONVERTED                       03840002
         BNZ   BLDBREAK      YES,CONTINUE                               03850002
         SR    R15,R15       SET RETURN CODE TO ZERO                    03852002
         B     RETMAIN       RETURN TO IKJEGMNL                         03854002
         SPACE                                                          03860002
*********************************************************************** 03870002
*        BUILD ACTIVE BREAK ELEMENTS VIA BREAKRTN ROUTINE.            * 03880002
*********************************************************************** 03890002
BLDBREAK DS    0H                       PREPARE TO GO TO SUBROUTINE TO  03900002
*                                       BUILD BREAK ELEMENTS            03910002
         L     R1,TSTANSPL              R1=ADDRESS OF PDL               03920002
         BAL   R14,BREAKRTN             BRANCH TO BUILD BREAK ELEMENT   03930002
         LTR   R15,R15                  WAS BREAK REQUEST HANDLED OK    03940002
         BNZ   NOBREAK                  NO, CHECK FOR ATTN              03950002
         SPACE                                                          03960002
*********************************************************************** 03970002
*        IF SUCCESSFUL, RETURN TO MAINLINE WITH CODE 0.               * 03980002
*********************************************************************** 03990002
CODE0    DS    0H                       SET RETURN CODE TO ZERO         04000002
         XR    R15,R15                  ZERO REGISTER                   04010002
         B     RETMAIN                  PREPARE TO RETURN TO MAINLINE   04020002
         SPACE                                                          04030002
*********************************************************************** 04040002
*        IF UNSUCCESSFUL,SEND RC 16,20,OR 24 TO MAINLINE IF ONE OF THEM 04050002
*        OCCURRED AND TO ZERO OTHERWISE.                                04060002
*        RETURN TO MAINLINE.                                            04070002
*********************************************************************** 04080002
NOBREAK  DS    0H                       SUBROUTINE WAS UNABLE TO        04090002
*                                       ESTABLISH BREAKPOINT            04100002
         C     R15,ATTNCODE  IS RETURN CODE 16,20 OR 24?                04110002
         BNL   RETMAIN       YES,SEND RC TO MAINLINE                    04120002
         B     CODE0         SEND RC=0 TO MAINLINE                      04150002
         SPACE                                                          04160002
*********************************************************************** 04170002
*        THIS SECTION OF CODE CONVERTS THE ADDRESSES IN AN ADDRESS    * 04180002
*        PDE TO BINARY VIA THE IKJEGCVT MODULE. UPON ENTRY            * 04190002
*        TO THIS CODE, R11 POINTS TO THE ADDRESS PDE TO BE            * 04200002
*        CONVERTED. IF THE ADDRESSES IN THE PDE ARE INVALID, A        * 04210002
*        MESSAGE IS SENT TO THE TERMINAL, AND THE NEXT PDE IS         * 04220002
*        PROCESSED. IF THE ADDRESSES ARE VALID, THE ADDRESSES ARE     * 04230002
*        PUT IN THE PDEUSER AND PDE2USER FIELDS OF THE ADDRESS PDE,   * 04240002
*        AND THE NEXT PDE IS PROCESSED.                               * 04250002
*********************************************************************** 04260002
CONVPDE  DS    0H                       ADDRESS PDE MUST BE SENT TO     04270002
*                                       CONVERT TO ESTABLISH A          04280002
*                                       BINARY ADDRESS                  04290002
         LCR   R1,R11                   R1=COMPLEMENT OF ADDRESS OF PDE 04300002
*                                       TO INDICATE ADDRESS CONVERT     04310002
         XR    R0,R0                    R0=ZERO TO INDICATE CONVERT TO  04320002
*                                       BINARY                          04330002
         L     R15,TSTCONVT             R15=ADDRESS OF CONVERT ROUTINE  04340002
         OI    TSTFLGS1,RANGESW         TELL CONVERT A RANGE IS         04350002
*                                       POSSIBLE                        04360002
         BALR  R14,R15                  GO TO CONVERT                   04370002
         LTR   R15,R15                  WAS CONVERT SUCCESSFUL          04380002
         BNZ   WHYNOT                   NO, FIND OUT WHY NOT            04390002
         SPACE                                                          04400002
*********************************************************************** 04410002
*        CONVERSION SUCCESSFUL. BE SURE CONVERTED ADDRESSES ARE       * 04420002
*        WRITABLE AND ARE IN PDEUSER FIELD(S).                        * 04430002
*********************************************************************** 04440002
         TM    PDEFLG5,PDEWRITE         IS FIRST ADDRESS WRITABLE ?     04442002
         BZ    BADADDR                  NO - GO WRITE ERROR MSG         04444002
         TM    PDEUSER,PDESIB           IS ADDRESS IN USERWORD          04450002
         BZ    TRYRANGE                 YES, CHECK FOR RANGE            04460002
         L     R2,PDEUSER               R2=POINTER TO SI BLOCK          04470002
         MVC   PDEUSER,D0(R2)           MOVE BINARY ADDRESS TO USERWORD 04480002
         SPACE                                                          04490002
TRYRANGE DS    0H                       MAKE CERTAIN BINARY ADDRESS IN  04500002
*                                       SECOND HALF OF PDE IF RANGE     04510002
*                                       SPECIFIED                       04520002
         OC    PDE2USER,PDE2USER        WAS RANGE GIVEN                 04530002
         BZ    TESTBND                  NO, CHECK BOUNDARY              04540002
         TM    PDE2FLG5,PDEWRITE        IS SECOND ADDRESS WRITABLE ?    04542002
         BZ    BADRNGE                  NO - GO WRITE ERROR MSG         04544002
         TM    PDE2USER,PDESIB          DOES USERWORD POINT TO A BINARY 04550002
*                                       ADDRESS                         04560002
         BZ    CHKORDER                 NO, TEST FOR FIRST ADDRESS      04570002
*                                       LESS THAN SECOND                04580002
         L     R2,PDE2USER              R2=POINTER TO SI BLOCK          04590002
         MVC   PDE2USER,D0(R2)          MOVE BINARY ADDRESS TO USERWORD 04600002
         SPACE                                                          04610002
*********************************************************************** 04620002
*        A RANGE WAS GIVEN. CHECK FOR FIRST ADDRESS LESS THAN         * 04630002
*        SECOND AND FIRST ADDRESS ON HALFWORD BOUNDARY. IF ERROR,     * 04640002
*        WRITE ERROR MESSAGE AND GET NEXT PDE. IF OK, GO FLAG         * 04650002
*        PDE AS CONVERTED AND GET NEXT PDE.                           * 04660002
*********************************************************************** 04670002
CHKORDER DS    0H                       CHECK FOR FIRST ADDRESS OF      04680002
*                                       RANGE LESS THAN SECOND          04690002
         CLC   PDEUSER+D1(L3),PDE2USER+D1 IS FIRST ADDRESS LOW          04700002
         BH    BADORDER                 NO, PUT OUT MESSAGE             04710002
         TM    PDEUSER+D3,BADBOUND      IS FIRST ADDRESS FOR HALFWORD   04720002
*                                       BOUNDARY                        04730002
         BNO   FLAGOK                   YES, FLAG PDE CONVERTED         04740002
         LA    R1,MSG1       R1=ADDR OF MESSAGE NUMBERS                 04742002
         SPACE                                                          04750002
OFFBOUND DS    0H                       SET UP MESSAGE FOR ADDRESS NOT  04760002
*                                       ON HALFWORD BOUNDARY            04770002
         BAL   R5,IOTYPE2    PUT OUT MESSAGE                            04780002
         BAL   R5,IORC1      TEST IO RC'S                               04808002
         MVI   PDEUSER,HEX00 TURN OFF ALL PDEUSER FLAGS                 04808402
         B     MOREPDES      CHECK FOR MORE PDES                        04808802
         SPACE                                                          04810002
BADADDR  DS    0H                       PDE HAS AN ADDRESS WHICH IS     04812002
*                                       NOT WRITABLE. ISSUE APPROP.     04814002
*                                       ERROR MSG                       04816002
         OC    PDE2USER,PDE2USER        AN ADDRESS RANGE ?              04818002
         BNZ   BADRNGE                  YES - ISSUE BAD RANGE MSG       04818402
         LA    R1,MSG2       R1=ADDR OF MESSAGE NUMBERS                 04818802
         B     FIXSTRNG                 ADD ADDRESS STRING TO MESSAGE   04819602
         SPACE                                                          04819702
BADRNGE  DS    0H                       ADDRESS RANGE IS NOT WRITABLE   04819802
*                                       ISSUE APPROP. ERROR MSG         04819902
         LA    R1,MSG3       R1=ADDR OF MESSAGE NUMBERS                 04821902
         B     FIXSTRNG                 ADD ADDRESS STRING TO MESSAGE   04825602
         SPACE                                                          04826002
BADORDER DS    0H                       SET UP MESSAGE FOR FIRST        04826702
*                                       ADDRESS OF RANGE MUST BE        04830002
*                                       LESS THAN SECOND                04840002
         LA    R1,MSG4       R1=ADDR OF MESSAGE NUMBERS                 04850002
         SPACE                                                          04870002
FIXSTRNG DS    0H                       ADD ADDRESS STRING TO MESSAGE   04880002
         BAL   R5,IOTYPE3    PUT OUT MESSAGE                            04890002
         BAL   R5,IORC1      TEST IO RC'S                               04909202
         MVI   PDEUSER,HEX00            TURN OFF ALL PDEUSER FLAGS      04910002
         B     MOREPDES                 CHECK FOR MORE PDES             04930002
         SPACE                                                          04940002
*********************************************************************** 04950002
*        PDE OK. FLAG IT AS OK, AND GO GET NEXT PDE.                  * 04960002
*********************************************************************** 04970002
FLAGOK   DS    0H                       FLAG PDE CONVERTED              04980002
         MVI   PDEUSER,PDECONVD         SET FLAG                        04990002
         LA    R6,D1(R6)                SET INDICATOR FOR PDE CONVERTED 05000002
         B     MOREPDES                 CHECK FOR MORE PDES             05010002
         SPACE                                                          05020002
*********************************************************************** 05030002
*        ONLY ONE ADDRESS. CHECK IT FOR HALFWORD BOUNDARY.            * 05040002
*        IF OK, GO FLAG PDE CONVERTED AND GET NEXT PDE. IF ERROR,     * 05050002
*        ISSUE ERROR MESSAGE AND GO GET NEXT PDE.                     * 05060002
*********************************************************************** 05070002
TESTBND  DS    0H                       IS SINGLE ADDRESS ON HALFWORD   05080002
*                                       BOUNDARY                        05090002
         TM    PDEUSER+D3,BADBOUND      IS BOUNDARY OK                  05100002
         BNO   FLAGOK                   YES, FLAG PDE CONVERTED         05110002
         LA    R1,MSG5       R1=ADDR OF MESSAGE NUMBERS                 05120002
         B     OFFBOUND      GO ISSUE ERROR MESSAGE                     05130002
         SPACE                                                          05150002
*********************************************************************** 05160002
*        ADDRESS CONVERSION FAILED. IF AN ATTENTION OCCURRED,         * 05170002
*        SET RETURN CODE TO 16 AND RETURN TO MAINLINE.                * 05180002
*        IF AN ABEND OCCURRED, SET RETURN CODE TO 20 AND RETURN TO    * 05190002
*        MAINLINE. OTHERWISE, TURN OFF CONVERTED FLAG IN PDE AND      * 05196002
*        GET NEXT PDE.                                                * 05202002
*********************************************************************** 05210002
WHYNOT   DS    0H                       FIND OUT WHY CONVERT FAILED     05220002
         C     R15,ATTNCODE  IS RETURN CODE=16,20 OR 24?                05230002
         BNL   RETMAIN       YES, SEND IT TO IKJEGMNL                   05240002
         OI    TSTFLGS4,TSTFLUSH        TURN TSTFLUSH ON SO MNL WILL    05254002
*                                       FLUSH INPUT STACK               05255002
         MVI   PDEUSER,HEX00            TURN OFF ALL PDEUSER FLAGS      05260002
         B     MOREPDES                 IKJEGSYM WILL HAVE PUT OUT A    05270002
*                                       MESSAGE IF IT WERE UNABLE       05280002
*                                       TO RESOLVE THE ADDRESS -        05290002
*                                       CHECK FOR MORE PDE'S            05300002
         EJECT                                                          05870002
*********************************************************************** 05880002
*        USER DID NOT ENTER AT COMMAND FROM TERMINAL. A NEW           * 05890002
*        MODULE HAS BEEN BROUGHT INTO CORE. CHECK FOR ENTRIES         * 05900002
*        ON DEFER QUEUE FOR THIS NEW MODULE. THE NAME OF THE NEWLY    * 05910002
*        LOADED MODULE IS IN THE FIRST EIGHT BYTES OF AT'S            * 05920002
*        WORKAREA. THE FIRST BYTE AFTER THE LOAD MODULE NAME IS       * 05930002
*        A FLAG BYTE. IT IS X'20' IF THE MODULE IS AN OVERLAY,        * 05940002
*        AND, IN THIS CASE, A SWITCH IS SET TO TELL SYM NOT TO        * 05950002
*        ISSUE MESSAGES.                                              * 05960002
*********************************************************************** 05970002
FROMDEFR DS    0H                       THIS ROUTINE IS ENTERED TO MAKE 05980002
*                                       ACTIVE BREAKPOINTS FOR A        05990002
*                                       LOAD MODULE BROUGHT INTO        06000002
*                                       CORE                            06010002
         TM    LOADATTR,OVLYBIT         IS LOAD MODULE IN OVERLAY       06020002
         BO    FIXSYMSW                 YES, TELL SYM NOT TO PRINT MSGS 06030002
         SPACE                                                          06040002
*********************************************************************** 06050002
*        IF THE DEFER QUEUE IS EMPTY, RETURN TO MAINLINE              * 06060002
*        WITH A RETURN CODE OF 4. OTHERWISE, GET ADDRESS OF FIRST     * 06070002
*        DME ON DEFERRED QUEUE.                                       * 06080002
*********************************************************************** 06090002
HANDLED  DS    0H                       HANDLE DEFER BREAKPOINTS        06100002
         OC    DEFERTAB,DEFERTAB        IS THE DEFER QUEUE EMPTY        06110002
         BZ    CODE4                    YES, RETURN TO MAINLINE WITH A  06120002
*                                       CODE OF FOUR                    06130002
         L     R8,DEFERTAB              R8=POINTER TO FIRST DME         06140002
         USING DME,R8                   R8 IS BASE FOR DME              06150002
         SPACE                                                          06160002
*********************************************************************** 06170002
*        IF LOADNAME IN DME NOT THE SAME AS NEWLY LOADED MODULE,      * 06180002
*        GO CHECK FOR MORE DMES ON QUEUE. IF SAME, GET ADDRESS OF     * 06190002
*        FIRST DBE QUEUED FROM DME. NOTE - R8 IS BASE FOR BOTH        * 06200002
*        DME'S AND DBE'S.                                             * 06202002
*********************************************************************** 06210002
CHKMATCH DS    0H                       COMPARE LOADNAMES               06220002
         CLC   LOADNAME,DMELOAD         DOES THE DME LOADNAME           06230002
*                                       EQUAL THE INPUT LOADNAME        06240002
         BNE   MOREDMES                 NO, CHECK FOR MORE DME'S        06250002
         L     R8,DMEDBE                R8=POINTER TO FIRST DBE         06260002
         DROP  R8                       R8 WILL BE USED FOR DBE         06262002
*                                       ADDRESSABILITY                  06264002
         USING DBE,R8                   R8 IS BASE FOR DBE              06270002
         SPACE                                                          06280002
*********************************************************************** 06290002
*        GET ADDRESS OF PDL FROM DBE, AND SET UP TO CONVERT ALL       * 06300002
*        ADDRESS PDES IN PDL.                                         * 06310002
*********************************************************************** 06320002
ACCESS   DS    0H                       GET ADDR OF FIRST ADDR PDE      06330002
         L     R1,DBEPDL                R1=POINTER TO PDL               06340002
         USING IKJPARMD,R1              ESTABLISH ADDRESSABILITY TO PDL 06350002
         LA    R11,ADDR                 R11=ADDRESS OF ADDRESS PDE      06360002
         DROP  R1                                                       06370002
         XR    R6,R6                    INITIALIZE INDICATOR FOR        06380002
*                                       CONVERTED PDES                  06390002
         SPACE                                                          06400002
*********************************************************************** 06410002
*        CHECK PDE TO SEE IF OFF HAS TURNED THE PDEYECH FLAG ON.      * 06412002
*        IF SO, SKIP THE PDE AND TRY THE NEXT ONE. (THE PDEYECH FLAG  * 06414002
*        IS OFF'S WAY OF REMOVING DEFERRED BREAKPOINTS.) OTHERWISE,   * 06416002
*        GO TO IKJEGCVT TO CONVERT PDE ADDRESSES TO BINARY.           * 06420002
*********************************************************************** 06430002
CONVDEFR DS    0H                       CONVERT PDE'S ON DEFER QUEUE    06440002
*                                       FOR ONE DBE                     06450002
         TM    PDEUSER,PDEYECH          HAS BRKPT BEEN OFF'D ?          06452002
         BO    ANOTHER                  YES, GO TRY THE NEXT PDE        06454002
         OI    TSTFLGS1,RANGESW         TELL CONVERT A RANGE IS         06460002
*                                       POSSIBLE                        06470002
         LCR   R1,R11                   LOAD COMPLEMENT OF ADDRESS OF   06480002
*                                       PDE FOR ADDRESS CONVERT         06490002
         XR    R0,R0                    INDICATE BINARY CONVERT         06500002
         L     R15,TSTCONVT             R15=ADDRESS OF CONVERT ROUTINE  06510002
         BALR  R14,R15                  CONVERT PDE                     06520002
         LTR   R15,R15                  WAS CONVERSION OK               06530002
         BNZ   SETUSER                  NO, INSURE CONVERTED FLAG IS    06540002
*                                       OFF                             06550002
         TM    PDEFLG5,PDEWRITE         IS FIRST ADDRESS WRITABLE ?     06552002
         BZ    DEFBADAD                 NO - GO WRITE ERROR MSG         06554002
         TM    PDEUSER,PDESIB           IS BINARY ADDR IN USERWORD      06560002
         BZ    ASKRANGE                 YES, CHECK FOR ADDR RANGE       06570002
         L     R4,PDEUSER               R4=POINTER TO SI BLOCK          06580002
         MVC   PDEUSER,D0(R4)           MOVE BINARY ADDRESS TO USERWORD 06590002
         SPACE                                                          06600002
*********************************************************************** 06610002
*        IF A RANGE WAS GIVEN, BE SURE SECOND ADDRESS IS IN PDE.      * 06620002
*********************************************************************** 06630002
ASKRANGE DS    0H                       SEE IF SECOND USERWORD CONTAINS 06640002
*                                       A BINARY ADDRESS                06650002
         OC    PDE2USER,PDE2USER        WAS RANGE GIVEN                 06660002
         BZ    BNDTEST                  NO, CHECK BOUNDARY              06670002
         TM    PDE2USER,PDEWRITE        IS SECOND ADDRESS WRITABLE ?    06672002
         BZ    DEFBADRG                 NO - GO WRITE ERROR MSG         06674002
         TM    PDE2USER,PDESIB          DOES USERWORD POINT TO SI BLOCK 06680002
         BZ    TSTORDER                 NO, TEST FOR FIRST ADDRESS      06690002
*                                       LESS THAN SECOND                06700002
         L     R4,PDE2USER              R4=POINTER TO SI BLOCK          06710002
         MVC   PDE2USER,D0(R4)          MOVE BINARY ADDRESS TO USERWORD 06720002
         SPACE                                                          06730002
*********************************************************************** 06740002
*        A RANGE WAS GIVEN. CHECK FOR FIRST ADDRESS LESS THAN         * 06750002
*        SECOND AND FIRST ADDRESS ON HALFWORD BOUNDARY. IF ERROR,     * 06760002
*        WRITE ERROR MESSAGE AND GET NEXT PDE. IF OK, GO FLAG PDE     * 06770002
*        CONVERTED AND GET NEXT PDE.                                  * 06780002
*********************************************************************** 06790002
TSTORDER DS    0H                       CHECK FOR FIRST ADDRESS OF      06800002
*                                       RANGE LESS THAN SECOND          06810002
         CLC   PDEUSER+D1(L3),PDE2USER+D1  IS FIRST ADDRESS LOW         06820002
         BH    ORDERBAD                 NO, PUT OUT MESSAGE             06830002
         TM    PDEUSER+D3,BADBOUND      IS FIRST ADDRESS FOR HALF-WORD  06840002
*                                       BOUNDARY                        06850002
         BNO   FLAGPDE                  YES, FLAG PDE CONVERTED         06860002
         LA    R1,MSG1       R1=ADDR OF MESSAGE NUMBERS                 06870002
OFFBND   DS    0H                                                       06880002
         BAL   R5,IOTYPE2    PUT OUT MESSAGE                            06882002
         BAL   R5,IORC1      TEST IO RC'S                               06888802
         MVI   PDEUSER,HEX00 TURN OFF ALL PDEUSER FLAGS                 06889202
         B     ANOTHER       CHECK FOR MORE PDES                        06889602
         SPACE                                                          06890002
FIXMSG   DS    0H                       ADD ADDRESS STRING TO MESSAGE   06900002
         BAL   R5,IOTYPE3    PUT OUT MESSAGE                            06910002
         BAL   R5,IORC1      TEST IO RC'S                               06921702
         MVI   PDEUSER,HEX00            TURN OFF ALL FLAGS IN PDEUSER   06922002
         B     ANOTHER                  CHECK FOR MORE PDES             06930002
         SPACE                                                          06940002
DEFBADAD DS    0H                       PDE HAS AN ADDRESS WHICH IS     06942002
*                                       NOT WRITABLE. ISSUE APPROP.     06944002
*                                       ERROR MSG.                      06946002
         OC    PDE2USER,PDE2USER        ADDRESS RANGE ?                 06948002
         BNZ   DEFBADRG                 YES - ISSUE BAD RANGE MSG       06948402
         LA    R1,MSG2       R1=ADDR OF MESSAGE NUMBERS                 06948802
         B     FIXMSG                   ADD ADDRESS STRING TO MESSAGE   06949602
         SPACE                                                          06949702
DEFBADRG DS    0H                       ADDRESS RANGE IS NOT WRITABLE   06949802
*                                       ISSUE APPROP. ERROR MSG         06949902
         LA    R1,MSG3       R1=ADDR OF MESSAGE NUMBERS                 06953202
         B     FIXMSG                   ADD ADDRESS STRING TO MESSAGE   06955602
         SPACE                                                          06956002
ORDERBAD DS    0H                       SET UP MESSAGE FOR FIRST        06956702
*                                       ADDRESS OF RANGE MUST BE        06960002
*                                       LESS THAN SECOND                06970002
         LA    R1,MSG4       R1=ADDR OF MESSAGE NUMBERS                 06980002
         B     FIXMSG                   ADD ADDRESS STRING TO MESSAGE   07000002
         SPACE                                                          07010002
*********************************************************************** 07020002
*        MODULE AN OVERLAY. TURN ON SWITCH TO TELL SYM NOT TO         * 07030002
*        ISSUE MESSAGES.                                              * 07040002
*********************************************************************** 07050002
FIXSYMSW DS    0H                       TELL SYM NOT TO PRINT MSGS      07060002
         OI    TSTFLGS3,SYMMESG         SET SWITCH IN TCOMTAB           07070002
         B     HANDLED                  SET DEFER BREAKPOINTS           07080002
         SPACE                                                          07090002
*********************************************************************** 07100002
*        ONLY ONE ADDRESS GIVEN, CHECK FOR HALFWORD BOUNDARY.         * 07110002
*        IF NOT HALFWORD, ISSUE MESSAGE AND GET NEXT PDE.             * 07120002
*********************************************************************** 07130002
BNDTEST  DS    0H                       IS SINGLE ADDRESS ON HALF-WORD  07140002
*                                       BOUNDARY                        07150002
         TM    PDEUSER+D3,BADBOUND      IS BOUNDARY OK                  07160002
         BNO   FLAGPDE                  YES, FLAG PDE CONVERTED         07170002
         LA    R1,MSG5       R1=ADDR OF MESSAGE NUMBERS                 07180002
         B     OFFBND        GO ISSUE MESSAGE                           07190002
         SPACE                                                          07220002
*********************************************************************** 07230002
*        ADDRESS IS OK. FLAG PDE AS CONVERTED. INCREMENT COUNTER      * 07240002
*        FOR CONVERTED PDES..                                         * 07250002
*********************************************************************** 07260002
FLAGPDE  DS    0H                       FLAG PDE CONVERTED              07270002
         MVI   PDEUSER,PDECONVD         SET FLAG                        07280002
         LA    R6,D1(R6)                SET INDICATOR FOR PDE CONVERTED 07290002
         SPACE                                                          07300002
*********************************************************************** 07310002
*        IF MORE PDES, GO CONVERT THEM. IF NO PDES WERE CONVERTED,    * 07320002
*        GO CHECK FOR MORE DBES. OTHERWISE, BUILD ACTIVE BREAK        * 07330002
*        ELEMENTS VIA THE BREAKRTN ROUTINE FOR THE PDL.               * 07340002
*********************************************************************** 07350002
ANOTHER  DS    0H                       CHECK FOR MORE PDE'S            07360002
         L     R11,PDE2CHAI             R11=PDE CHAIN CONTENTS          07370002
         LA    R11,D0(R11)              CLEAR HIGH ORDER BYTE           07380002
         LTR   R11,R11                  IS CHAIN EMPTY                  07390002
         BNZ   CONVDEFR                 NO, CONVERT NEXT PDE            07400002
         LTR   R6,R6                    IS AT LEAST ONE PDE CONVERTED   07410002
         BZ    DBELINK                  NO, CHECK FOR MORE DBE'S        07420002
         L     R1,DBEPDL                R1=POINTER TO PDL               07430002
         BAL   R14,BREAKRTN             BRANCH TO BUILD BREAK ELEMENTS  07440002
         LTR   R15,R15                  IS BREAKRTN RC ZERO ?           07450002
         BZ    DBELINK                  YES - CHECK FOR MORE DBES       07460002
         C     R15,ATTNCODE  WAS RETURN CODE 16?                        07470002
         BE    RETMAIN       YES,SEND RC=16 TO MAINLINE                 07480002
         BL    DBELINK       RC LESS THAN 16 GET NEXT DBE               07490002
         OI    TSTFLGS4,TSTFLUSH        ABEND OCCURRED, TURN TSTFLUSH   07494002
*                                       ON SO MNL WILL FLUSH INPUT      07495002
         B     CODE4                    RETURN TO MNL WITH RC 4         07496002
         SPACE                                                          07500002
*********************************************************************** 07510002
*        IF THERE ARE MORE DBES ON THE QUEUE, PROCESS THEM. IF NOT,   * 07520002
*        RETURN TO MAINLINE WITH RETURN CODE FOUR.                    * 07530002
*********************************************************************** 07540002
DBELINK  DS    0H                       CHECK FOR MORE DBE'S            07550002
         OC    DBEDBE,DBEDBE            IS DBE LINK FIELD ZERO          07560002
         BZ    CODE4                    YES, RETURN TO MAINLINE WITH    07570002
*                                       CODE OF FOUR                    07580002
         L     R8,DBEDBE                R8=POINTER TO NEXT DBE          07590002
         B     ACCESS                   ACCESS FIRST ADDRESS PDE        07600002
         DROP  R8                       R8 NO LONGER USED FOR           07610002
*                                       DBE ADDRESSABILITY              07620002
         SPACE                                                          07630002
*********************************************************************** 07640002
*        THE PDE WAS NOT CONVERTED. SET PDEUSER FLAGS TO ZERO.        * 07650002
*        IF RETURN CODE WAS 16, ATTN WAS ENTERRED - RETURN TO MNL     * 07660002
*        WITH RETURN CODE OF 16. IF AN ABEND OCCURRED, RETURN TO      * 07670002
*        MNL WITH RETURN CODE 20. OTHERWISE, CHECK FOR MORE PDES.     * 07675002
*********************************************************************** 07680002
SETUSER  DS    0H                       INSURE FLAG FOR PDE CONVERTED   07690002
*                                       IS NOT ON                       07700002
         OI    TSTFLGS4,TSTFLUSH        TURN TSTFLUSH ON SO MNL WILL    07703002
*                                       FLUSH INPUT STACK               07706002
         MVI   PDEUSER,ZERO             INSURE X'FF' MADE ZERO          07710002
         C     R15,ATTNCODE  IS RETURN CODE=16,20 OR 24?                07720002
         BNL   RETMAIN       YES, SEND IT TO IKJEGMNL                   07730002
         B     ANOTHER       NO, CHECK FOR MORE PDE'S                   07740002
         SPACE                                                          07760002
*********************************************************************** 07770002
*        THE LOADNAME IN THE DME WAS NOT THE SAME AS THAT OF          * 07780002
*        THE NEWLY LOADED MODULE. IF THERE ARE NO MORE DMES ON        * 07790002
*        QUEUE, RETURN TO MAINLINE WITH RETURN CODE FOUR.             * 07800002
*        OTHERWISE, GET ADDRESS OF NEXT DME AND GO PROCESS IT.        * 07810002
*        NOTE THAT R8 WILL POINT TO DME.                              * 07812002
*********************************************************************** 07820002
MOREDMES DS    0H                       TEST FOR MORE DME'S             07830002
         USING DME,R8                   R8 IS DME BASE                  07832002
         OC    DMEDME,DMEDME            IS LINK FIELD EMPTY             07840002
         BZ    CODE4                    YES, RETURN WITH CODE OF FOUR   07850002
         L     R8,DMEDME                R8=ADDRESS OF NEXT DME          07860002
         B     CHKMATCH                 BRANCH TO COMPARE DME LOADNAME  07870002
*                                       WITH INPUT                      07880002
         DROP  R8                       R8 NO LONGER USED FOR           07890002
*                                       DME ADDRESSABILITY              07900002
         SPACE                                                          07910002
*********************************************************************** 07920002
*        TURN OFF SYM SWITCH AND TSTBUILD SWITCH.                     * 07930002
*        SET RETURN CODE TO FOUR FOR RETURN TO MAINLINE FROM          * 07940002
*        ACTIVATING DEFERRED BREAKPOINTS.                             * 07950002
*********************************************************************** 07960002
CODE4    DS    0H                       SET RETURN CODE TO FOUR FOR     07970002
*                                       THE PROBLEM PROGRAM TO          07980002
*                                       BE CONTINUED                    07990002
         NI    TSTFLGS3,HEXFF-SYMMESG   TURN OFF SYM MSG SWITCH         08000002
         NI    TSTFLGS1,HEXFF-TSTBUILD  TURN OFF TSTBUILD FLAG          08010002
         LA    R15,FOUR                 SET CODE TO FOUR                08020002
         B     RETMAIN                  RETURN TO MAINLINE              08030002
         EJECT                                                          08040002
*********************************************************************** 08050002
*        THE DEFER KEYWORD WAS SPECIFIED. PUT ADDRESS OF FIRST        * 08060002
*        ADDRESS PDE IN PARM WORD OF WORKAREA. PUT ADDRESS            * 08070002
*        OF TCOMTAB IN R1 AS PARAMETER FOR IKJEGATD. TURN ON XCTL     * 08080002
*        FLAG IN TSTFLGS2 FIELD OF TCOMTAB, AND XCTL TO IKJEGATD.     * 08090002
*********************************************************************** 08100002
TRANSFER DS    0H                                                       08110002
         MVC   XCTLL(XCTLEN),XLIST      MOVE LIST FORM OF XCTL TO WORK  08120002
*                                       AREA                            08130002
         ST    R11,PDEADDR              SAVE ADDRESS OF FIRST ADDR PDE  08140002
         LA    R1,TCOMTAB               R1=ADDRESS OF TCOMTAB           08150002
         LA    R15,XCTLL                R15=ADDRESS OF LIST FORM OF     08160002
*                                       MACRO                           08170002
         L     R13,SAVELAST-SAVEAREA(R13)  RESTORE R13                  08180002
         L     R14,RETURNPT-SAVEAREA(R13)  RESTORE R14                  08190002
         OI    TSTFLGS2,TSTXCTL         SET BIT FOR AT XCTL'S           08220002
         XCTL  (2,12),EP=IKJEGATD,MF=(E,(1)),SF=(E,(15))                08230002
SMTXCTL2 DS    0X                       FOR SMT TEST CASES.             08240002
         EJECT                                                          08250002
*********************************************************************** 08260002
*                                                                     * 08270002
*        THE FOLLOWING INSTRUCTIONS CONSTITUTE A CLOSED SUBROUTINE    * 08280002
*        FOR CREATING ACTIVE BREAKPOINTS FROM PDL'S PASSED TO IT.     * 08290002
*        PDL'S MUST CONTAIN ADDRESS PDE'S WHICH CONTAIN THE ACTUAL    * 08300002
*        BINARY ADDRESSES IN THE USER WORDS OF THE PDE. INPUT WILL    * 08310002
*        CONSIST OF THE PDL ADDRESS IN REGISTER 1, TCOMTAB ADDRESS    * 08320002
*        IN REGISTER 9, THE ADDRESS OF AT'S WORK AREA IN REGISTER 10, * 08330002
*        PROGRAM BASE IN REGISTER 12, A RETURN ADDRESS IN REGISTER 14 * 08340002
*        AND A SAVE AREA ADDRESS IN REGISTER 13.                      * 08350002
*                                                                     * 08360002
*********************************************************************** 08370002
BREAKRTN DS    0H                       BEGINNING OF SUBROUTINE         08380002
         SAVE  (14,12)                  SAVE CALLER'S REGISTERS.        08390002
         LA    R4,BRKSAVE               GET ADDRESS OF BREAKRTN'S       08400002
*                                       SAVEAREA                        08410002
         ST    R4,SAVENEXT-SAVEAREA(R13)  STORE FORWARD POINTER.        08420002
         ST    R13,SAVELAST-SAVEAREA(R4)  STORE BACKWARD POINTER.       08430002
         LR    R13,R4                   R13=NEW SAVE AREA ADDR.         08440002
         SPACE                                                          08450002
*********************************************************************** 08460002
*        SAVE PDL ADDRESS IN WORKAREA, AND GET ADDRESS OF             * 08470002
*        FIRST ADDRESS PDE.                                           * 08480002
*********************************************************************** 08490002
         USING IKJPARMD,R1              PDL ADDRESSABILITY.             08500002
         ST    R1,PDLADDR               SAVE ADDRESS OF PDL FOR         08510002
*                                       LATER USE                       08520002
         LA    R11,ADDR                 R11=ADDRESS PDE ADDR.           08530002
         DROP  R1                                                       08540002
         SPACE                                                          08550002
*********************************************************************** 08560002
*        IF PDE HAS BEEN CONVERTED, GO PROCESS IT IN SUPRLOOP.        * 08570002
*        IF NOT, CHECK FOR MORE PDES. IF MORE, GO CHECK THEM.         * 08580002
*        IF NO MORE, RETURN TO CALLER.                                * 08590002
*********************************************************************** 08600002
TESTCONV DS    0H                       CHECK FOR CONVERTED PDE         08610002
         TM    PDEUSER,PDECONVD         HAS PDE BEEN CONVERTED          08620002
         BO    SUPRLOOP                 YES, BUILD BRKELEM(S) FOR PDE   08630002
         L     R11,PDE2CHAI             R11=CHAIN POINTER FOR ADDR LIST 08640002
         LA    R11,D0(R11)              CLEAR HIGH ORDER BYTE           08650002
         LTR   R11,R11                  Q.IS A LIST POINTER PRESENT     08660002
         BZ    ROUTRTN                  NO, RETURN                      08670002
         B     TESTCONV                 CHECK FOR THIS PDE CONVERTED    08680002
         SPACE                                                          08690002
*********************************************************************** 08700002
*        THE PDE HAS BEEN CONVERTED. CALCULATE NUMBER OF BYTES        * 08710002
*        REQUIRED FOR BREAK ELEMENT AND ASSOCIATED DATA.              * 08720002
*********************************************************************** 08730002
SUPRLOOP DS    0H                                                       08740002
         SR    R1,R1                    CLEAR ACCUMULATOR.              08750002
         SPACE                                                          08760002
*********************************************************************** 08770002
*        GET LENGTH OF LOADNAME.CSECT.                                * 08780002
*********************************************************************** 08790002
         AH    R1,PDELEN2               R1=CSECT NAME LENGTH.           08800002
         BZ    ADDRCHK                  NO LOAD OR CSECT NAME.          08810002
         LA    R1,D1(R1)                BUMP FOR PRECEDING PERIOD.      08820002
         AH    R1,PDELEN1               ADD IN LOAD NAME LENGTH.        08830002
         TM    PDEFLG3,AFLG             Q.ANY ADDRESS.                  08840002
         BZ    CHNCALC                  NO,  COMPUTE CHAIN LENGTH.      08850002
         LA    R1,D1(R1)                YES, BUMP FOR TRAILING PERIOD.  08860002
         SPACE                                                          08870002
*********************************************************************** 08880002
*        IF REGISTER-TYPE ADDRESS, ADD ONE FOR LETTER.                * 08890002
*********************************************************************** 08900002
ADDRCHK  DS    0H                       DETERMINE ADDRESS TYPE          08910002
         TM    PDEFLG4,SYMADDR          IS ADDRESS SYMBOLIC ?           08920002
         BO    ADDADDR                  YES, SKIP BUMP FOR PUNCTUATION  08930002
*                                       OR LETTER                       08940002
         LA    R1,D1(R1)                BUMP FOR PUNCTUATION OR LETTER  08950002
*                                       FOR ABSOLUTE, RELATIVE OR       08960002
*                                       REGISTER TYPE ADDRESS           08970002
         SPACE                                                          08980002
*********************************************************************** 08990002
*        CALCULATE AMOUNT OF CORE NEEDED FOR ADDRESS STRING.          * 09000002
*********************************************************************** 09010002
ADDADDR  DS    0H                       CALCULATE CORE NEEDED           09020002
*                                       FOR ADDR STRING                 09030002
         AH    R1,PDELEN3               ADD ADDRESS STRING LENGTH.      09040002
         L     R7,PDEEXPTR              R7=ADDRESS OF 1ST EXPRESSION.   09050002
         AH    R1,PDEINDCT              R1=(BRK+ADDR+IND.COUNT).        09060002
         SPACE                                                          09070002
CALCLOOP DS    0H                       ADD IN CORE FOR EXPRESSION      09080002
         LA    R7,D0(R7)                CLEAR HIGH ORDER BYTE           09090002
         LTR   R7,R7                    Q.ANY EXPRESSION.               09100002
         BZ    CHNCALC                  NO, CHECK ON CHAIN.             09110002
         USING EXPRPDE,R7               R7 IS BASE FOR EXPRESSION PDE   09120002
         AH    R1,EXPRLNH               R1=(BRK+ADDR+EXP LEN).          09130002
         AH    R1,EXPRINDC              R1=(BRK+ADDR+EXP+IND.COUNT).    09140002
         LA    R1,D1(R1)                R1=(BRK+ADDR+EXP+IND+SIGN LEN). 09150002
         TM    EXPRFLGS,EXPRDEC         IS EXPRESSION DECIMAL VALUE     09160002
         BZ    KEEPON                   NO, CONTINUE                    09170002
         LA    R1,D1(R1)                R1=(BRK+ADDR+EXP+IND+SIGN LEN). 09180002
         SPACE                                                          09190002
KEEPON   DS    0H                       CHECK FOR ANOTHER               09200002
*                                       EXPRESSION PDE                  09210002
         L     R7,EXPRCHAI              R7=NEXT EXPRESSION ADDRESS.     09220002
         B     CALCLOOP                 GET 'EM ALL.                    09230002
         DROP  R7                       R7 NO LONGER USED FOR           09240002
*                                       EXPRESSION PDE ADDRESSABILITY   09250002
         SPACE                                                          09260002
CHNCALC DS    0H                                                        09270002
         LA    R1,BRKLEN(R1)            ADD BREAK ELEMENT LENGTH.       09280002
         CH    R1,MAXLEN2               IS ACCUMULATED LENGTH FOR       09290002
*                                       STRING GREATER THAN 100         09300002
         BH    CHGREG                   YES, LIMIT THE LENGTH           09310002
         SPACE                                                          09320002
*********************************************************************** 09330002
*        CALCULATE AMOUNT OF CORE NEEDED FOR SUBCOMMAND CHAIN.        * 09340002
*********************************************************************** 09350002
CHNCALC2 DS    0H                                                       09360002
         L     R7,PDLADDR               R7=PDL ADDRESS                  09370002
         USING IKJPARMD,R7              R7 USED FOR PDL ADDRESSABILITY  09380002
         LA    R1,D2(R1)                ADD IN ADDR SAVE LENGTH         09390002
*                                       FIELD - 2 BYTES.                09400002
         TM    PDEUSER,PDEADLST         Q.IS THIS A LIST                09410002
*                                       PDE (NOT THE 1ST)               09420002
         BO    GETBRK                   YES, GO GET CORE                09430002
         LA    R1,D7(R1)                NO, ROUND R1 UP TO DBL BOUND.   09440002
         N     R1,DBLBND                                                09450002
         LH    R0,SBCMDCHN+EXPRLNH-EXPRPDE  GET THE CHAIN LENGTH.       09460002
         LTR   R0,R0                    Q. IS THERE A CHAIN.            09470002
         BZ    GETBRK                   NO, GO GET CORE                 09480002
         ALR   R1,R0                    R1=(BRK+ADDR SAVE+CHAIN LEN).   09490002
         LA    R1,D3(R1)                ADD IN CHAIN SAVE LENGTH        09500002
*                                       FIELD 3 BYTES                   09510002
         B     GETBRK                   GO GET CORE                     09520002
         SPACE                                                          09530002
CHGREG   DS    0H                       LIMIT ADDRESS STRING            09540002
*                                       LENGTH TO 100                   09550002
         LH    R1,MAXLEN2               R1=MAXIMUM LENGTH FOR BREAK     09560002
*                                       ELEMENT AND ADDRESS STRING      09570002
         B     CHNCALC2                 CALCULATE NEEDS FOR             09580002
*                                       SUBCOMMAND CHAIN                09590002
         DROP  R7                       R7 NOT USED FOR PDL             09600002
*                                       ADDRESSABILITY FROM NOW ON      09610002
         SPACE                                                          09620002
*********************************************************************** 09630002
*        ADDRESS CHECK AND GETMAIN FOR BRKELEM CORE                   * 09640002
*********************************************************************** 09650002
GETBRK   DS    0H                                                       09660002
         L     R7,PDEUSER               GET ADDRESS OF BREAKPOINT       09662002
TSTLNH1  DS    0H                       NEXT INSTRUCTION MAY ABEND      09662402
         TM    D0(R7),LENBITS           HOW LONG IS INSTRUCTION ?       09664002
TSTLNH2  DS    0H                       PRECEDING INSTRUCTION MAY ABEND 09664402
         BO    CHEKSIX                  GO CHECK SIX BYTES              09666002
         BM    CHEKFOUR                 GO CHECK FOUR BYTES             09668002
CHEKTWO  DS    0H                       NEXT INSTRUCTION MAY ABEND      09668102
         OC    D0(L2,R7),D0(R7)         TRY FOR PROTECTION CHECK        09668402
BLOWTWO  DS    0H                       FOR PROTECTION CHECK STAE ENTRY 09668802
         B     GETELEM                  GO GET CORE FOR BRKELEM         09669202
         SPACE                                                          09669302
CHEKSIX  DS    0H                       INSTRUCTION IS SIX BYTES        09669602
         OC    D0(L6,R7),D0(R7)         TRY FOR PROTECTION CHECK        09669702
BLOWSIX  DS    0H                       FOR PROTECTION CHECK STAE ENTRY 09669802
         B     GETELEM                  GO GET CORE FOR BRKELEM         09669902
         SPACE                                                          09672002
CHEKFOUR DS    0H                       INSTRUCTION IS FOUR BYTES       09673202
         OC    D0(L4,R7),D0(R7)         TRY FOR PROTECTION CHECK        09675202
BLOWFOUR DS    0H                       FOR PROTECTION CHECK STAE ENTRY 09675602
         SPACE                                                          09675702
GETELEM  DS    0H                       CORE IS NOT WRITE-PROTECTED     09676002
         LR    R0,R1                    R1=NUMBER BYTES REQUIRED        09676702
         ST    R0,BYTENUMB              SAVE IN WORKAREA                09690002
         GETMAIN RC,LV=(0),SP=1        GET STORAGE REQUIRED             09700002
*                                       FOR BRK ELEMENT.                09710002
SMTGET01 DS    0H                       FOR SMT TEST CASES.             09720002
         SPACE                                                          09730002
*********************************************************************** 09740002
*        ZERO ENTIRE BREAK ELEMENT.                                   * 09750002
*********************************************************************** 09760002
BLOW2    DS    0H                       HERE'S THE RESUME ADDR          09770002
*                                       IF THE GETMAIN BLOWS            09780002
*                                       FOR LACK OF STORAGE.            09790002
         LTR   R15,R15       WAS GETMAIN SUCCESSFUL?                    09792002
         BZ    BLOW2C        YES, CONTINUE                              09794002
         LA    R1,SVC10NO    R1=SVC 10 NUMBER                           09796002
* ISSUE 'GETMAIN SVC ERROR' MESSAGE                                     09798002
         BAL   R5,GETFREIO   PUT OUT MESSAGE                            09798402
         C     R15,ATTNCODE  IS RETURN CODE=16,20,24?                   09798802
         BNL   RETURNRC      YES, SEND IT TO CALLER                     09799202
         LA    R15,TWENTY    SET RETURN CODE TO 20 TO LOOK LIKE ABEND   09799602
         B     RETURNRC      SEND IT TO CALLER                          09799702
BLOW2C   EQU   *                                                        09799802
         LR    R2,R1                    R2=BREAK ELEMENT ADDR.          09800002
         USING BRKELEM,R2               BREAK ELEMENT ADDRESSABILITY.   09810002
         XC    BRKELEM(BRKLEN),BRKELEM  ZERO BREAK ELEMENT              09820002
         LA    R4,BRKLEN(R2)            R4=ADDR STRING SAVE ADDR.       09830002
         ST    R4,STRNGADR              SAVE ADDRESS OF ADDRESS         09840002
*                                       STRING FOR LATER USE            09850002
         SPACE                                                          09860002
*********************************************************************** 09870002
*        THE FOLLOWING INSTRUCTIONS BUILD THE ADDRESS STRING          * 09880002
*        AS ENTERED BY THE USER INTO THE ADDRESS STRING SAVE AREA     * 09890002
*        FOR THIS BREAKPOINT.                                         * 09900002
*********************************************************************** 09910002
         LA    R1,D2(R4)                R1=SAVE AREA POINTER FOR BUILD. 09920002
         LR    R0,R11                   R0=ADDRESS OF ADDRESS PDE       09970002
         L     R15,TSTADDR              R15=ADDRESS OF ADDRESS          09980002
*                                       STRING BUILD ROUTINE            09990002
         BALR  R14,R15                  GO TO BUILD ROUTINE             10000002
         STH   R0,D0(R4)                SAVE LENGTH OF STRING           10010002
         SPACE                                                          10020002
*********************************************************************** 10030002
*        IF THIS PDE IS PART OF A LIST, GO BUILD THE BREAK            * 10040002
*        ELEMENT FOR IT. IF NOT, MOVE THE SUBCOMMAND CHAIN FOR        * 10050002
*        IT TO THE GETMAIN AREA AND SAVE A POINTER TO IT IN           * 10060002
*        CHNADDR FIELD OF WORKAREA.                                   * 10070002
*********************************************************************** 10080002
CHNSAVE  DS    0H                                                       10090002
         TM    PDEUSER,PDEADLST         Q.IS PDE FLAGGED AS A LIST PDE. 10100002
         BO    GOBUILD                  YES, DON'T CHECK FOR CHAIN      10110002
         LA    R5,D7(R1)                SET CHAIN SAVE ADDRESS REGISTER 10120002
         N     R5,DBLBND                ROUND UP TO DOUBLE              10130002
*                                       WORD FOR FREEMAIN               10140002
         ST    R5,CHNADDR               SAVE IN WORK AREA               10150002
         L     R1,PDLADDR               R1=PDL POINTER                  10160002
         USING IKJPARMD,R1              R1 IS BASE FOR PDL              10170002
         L     R7,SBCMDCHN+EXPRPTR-EXPRPDE  R7=CHAIN STRING ADDRESS.    10180002
         LA    R7,D0(R7)                CLEAR HIGH ORDER BYTE           10190002
         LTR   R7,R7                    Q.IS A CHAIN SPECIFIED.         10200002
         BZ    NOCHAIN                  NO, BUILD THE BREAK ELEMENT.    10210002
         LH    R6,SBCMDCHN+EXPRLNH-EXPRPDE  R6=LENGTH OF COMMAND CHAIN  10220002
         STH   R6,D0(R5)                PLACE CHAIN LNH IN SAVE AREA    10230002
         BCTR  R6,ZERO                  DECREMENT R6 FOR EXECUTE        10240002
         EX    R6,CHNMVC                MOVE CHAIN TO SAVE AREA         10250002
         LA    R6,D3(R6)                R6=LENGTH OF COMMAND            10260002
*                                       CHAIN+LENGTH FIELD              10270002
         ALR   R6,R5                    R6=POINTER TO LAST BYTE         10280002
*                                       OF CHAIN SAVE AREA              10290002
         XC    D0(L1,R6),D0(R6)         ZERO LAST BYTE                  10300002
         B     GOBUILD                  BUILD BREAK ELEMENT             10310002
         SPACE                                                          10320002
CHNMVC   MVC   D2(L1,R5),D0(R7)         EXECUTE MVC FOR COMMAND CHAINS. 10330002
         SPACE                                                          10340002
NOCHAIN  DS    0H                       NO CHAIN SAVE ADDRESS           10350002
         SR    R5,R5                    ZERO REGISTER                   10360002
         ST    R5,CHNADDR               SAVE IN WORK AREA               10370002
         SPACE                                                          10380002
*********************************************************************** 10390002
*                                                                     * 10400002
*        THIS SERIES OF INSTRUCTIONS BUILDS A BREAK ELEMENT AND       * 10410002
*        SETS A BREAK SVC INTO THE PROBLEM PROGRAM.  IF THE PDE       * 10420002
*        PASSED IS ONE OF A RANGE, ALL BREAK ELEMENTS ARE BUILT FOR   * 10430002
*        THE RANGE AND ALL SVC'S INSERTED IN THE PROBLEM PROGRAM.     * 10440002
*                                                                     * 10450002
*********************************************************************** 10460002
GOBUILD  DS    0H                                                       10470002
         L     R5,PDEUSER               GET ADDRESS OF BREAKPOINT       10480002
*                                       INSERTION                       10490002
         LA    R5,D0(R5)                CLEAR HIGH ORDER BYTE OF ADDR   10500002
         LA    R6,BREAKTAB              R6=HEAD OF BREAK ELEMENT CHAIN. 10510002
         L     R7,BREAKTAB              R7=1ST ELEMENT ON CHAIN.        10520002
         SPACE                                                          10530002
*********************************************************************** 10540002
*        BREAK ELEMENT QUEUE IS ARRANGED IN ASCENDING ORDER OF        * 10550002
*        BREAKPOINT ADDRESSES. FIND APPROPRIATE PLACE IN QUEUE        * 10560002
*        FOR THIS ENTRY AND GO PLACE IT IN QUEUE.                     * 10570002
*********************************************************************** 10580002
SEQLOOP  DS    0H                       EXAMINE CURRENT CHAIN           10590002
         LTR   R7,R7                    Q.ANY MORE ELEMENTS ON CHAIN.   10600002
         BZ    ADDL                     NO, ADD CURRENT ELEMENT         10610002
*                                       TO CHAIN                        10620002
         L     R8,BRKADDR-BRKELEM(R7)   R8=BRK ADDR OF EXISTING BRKPT   10630002
         CR    R8,R5                    Q.ADDRESS FOR NEW BREAKPOINT    10640002
*                                       HIGH ?                          10650002
         BE    DUPLICAT                 DUPLICATE BREAK ADDR FOUND      10660002
         BH    ADDL                     HIGH, ADD NEW BREAK ELEM HERE.  10670002
         SPACE                                                          10680002
CONTCHK  DS    0H                       CONTINUE SEARCHING QUEUE        10690002
         LA    R6,BRKLINK-BRKELEM(R7)   R6=NEW LINK FIELD ADDR.         10700002
         L     R7,BRKLINK-BRKELEM(R7)   R7=NEXT BREAK ELEMENT ADDR.     10710002
         B     SEQLOOP                  TRY AGAIN.                      10720002
         SPACE                                                          10730002
*********************************************************************** 10740002
*        ADD BREAK ELEMENT TO CHAIN. SAVE ADDRESS OF PREVIOUS         * 10750002
*        LINK FIELD FOR ERROR RECOVERY. PUT REQUIRED DATA  IN         * 10760002
*        BREAK ELEMENT.                                               * 10770002
*********************************************************************** 10780002
ADDL     DS    0H                       ADJUST POINTERS FOR             10790002
*                                       NEW ELEMENTS                    10800002
         ST    R6,SAVEPTR               SAVE LINK FIELD POINTER         10810002
         ST    R2,D0(R6)                PLACE NEW BRK ELEM ADDR         10820002
*                                       IN CHAIN                        10830002
         ST    R7,BRKLINK               HOOK CHAIN TO NEW BRK           10840002
*                                       LINK FIELD                      10850002
         ST    R5,BRKADDR               PLACE INSTR ADDR IN BRK ELEM.   10860002
         MVC   BRKNAME,STRNGADR         PLACE ADDR SAVE AREA            10870002
*                                       ADDR IN BRKELEM                 10880002
         MVC   BRKCHAIN,CHNADDR         PLACE CHAIN SAVE AREA           10890002
*                                       ADDR IN BRK ELEM                10900002
         L     R1,PDLADDR               R1=ADDR OF PDL                  10910002
         TM    COUNT+D1,FF              Q.IS COUNT SPECIFIED.           10920002
         BZ    SKIPCT                   NO, LEAVE COUNT FIELD ZERO.     10930002
         L     R1,CONAREA               R1=IKJEGCVT OUTPUT AREA ADDR.   10940002
         MVC   BRKCOUNT(L2),CONCOUNT-CONBYTE+D2(R1)  SET COUNT FIELD.   10950002
         MVC   BRKCOUNT+D2(L2),BRKCOUNT                                 10960002
         SPACE                                                          10970002
SKIPCT   DS    0H                       SAVE BREAK INSTRUCTION          10980002
         MVC   BRKINST+D2(L6),INITCON   INITIALIZE INSTR. SAVE FIELD.   10990002
         TM    BRKFLGS,BRKRANGE         IS THIS BREAK ELEMENT           11000002
*                                       PART OF A RANGE ?               11010002
         BZ    SETFLAGS                 NO - DISPLACEMENT OF ZERO IS    11020002
*                                       OK, SO GO SET PARAMETER FLAGS   11030002
         L     R6,PDEUSER               R6=BINARY ADDR FROM PDE.        11040002
         LA    R6,D0(R6)                ZERO HIGH BYTE.                 11050002
         SR    R5,R6                    R5=DISP FROM BEGINNING OF       11060002
*                                       RANGE(IF RANGE)                 11070002
         STH   R5,BRKDISP               PLACE DISPLACEMENT IN BRK ELEM. 11080002
         L     R5,BRKADDR               RESET R5                        11090002
SETFLAGS DS    0H                                                       11100002
         L     R1,PDLADDR               R1=ADDRESS OF PDL.              11110002
         TM    NONOT+D1,TWO             Q.NONOTIFY SPECIFIED.           11120002
         BZ    NOTIFY                   NO, DON'T SET SWITCH.           11130002
         OI    BRKFLGS,BRKNONOT         YES, SET SWITCH.                11140002
         SPACE                                                          11150002
NOTIFY   DS    0H                       CHECK FOR ADDRESS IN A LIST     11160002
         TM    PDEUSER,PDEADLST         Q.IS BREAK ONE OF A LIST.       11170002
         BZ    NOLIST                   NO, DON'T SET SWITCH.           11180002
         OI    BRKFLGS,BRKLIST          YES, DO.                        11190002
         SPACE                                                          11200002
*********************************************************************** 11210002
*        BAL, AND BALR INSTRUCTIONS ARE HANDLED IN A                  * 11220002
*        SPECIAL WAY. IF THE INSTRUCTION AT THE BREAKPOINT IS A       * 11230002
*        BAL OR BALR, SET THE CORRESPONDING FLAG                      * 11240002
*        IN THE BRKFLGS FIELD TO INDICATE THIS.                       * 11250002
*********************************************************************** 11260002
NOLIST   DS    0H                       CHECK FOR BAL OR BALR INSTR.    11270002
         CLI   D0(R5),BAL               Q.IS IT BAL INSTR.              11280002
         BE    BALI                     YES, SET BALSW BIT IN BRK ELEM. 11290002
         CLI   D0(R5),BALR              Q.IS IT BALR INSTR.             11300002
         BNE   LENGTH                   NEITHER, GO CHECK LENGTH        11310002
         SPACE                                                          11320002
BALI     DS    0H                       SET ELEMENT TO INDICATE BAL     11330002
*                                       OR BALR INSTRUCTION             11340002
         OI    BRKFLGS,BALSW            TURN ON BIT.                    11350002
         SPACE                                                          11430002
*********************************************************************** 11440002
*        FIND LENGTH OF INSTRUCTION AT BREAKPOINT AND MOVE IT         * 11450002
*        INTO THE BREAK ELEMENT. TOP TWO BITS IN OP CODE TELL         * 11460002
*        LENGTH OF INSTRUCTION. '00' = 2 BYTES, '01'='10' =           * 11470002
*        4 BYTES, '11' = 6 BYTES.                                     * 11480002
*********************************************************************** 11490002
LENGTH   DS    0H                       DETERMINE INSTRUCTION LENGTH    11500002
         TM    D0(R5),LENBITS           Q.HOW LONG IS INSTRUCTION.      11510002
         BO    SIXBYTE                  SIX BYTES.                      11520002
         BM    FOURBYTE                 FOUR BYTES.                     11530002
         MVC   BRKINST(L2),D0(R5)       SAVE INSTRUCTION.               11540002
         LA    R5,D2(R5)                BUMP INSTR ADDR REGISTER.       11550002
         B     CHECKMOR                 CHECK FOR MORE IN RANGE.        11560002
         SPACE                                                          11570002
FOURBYTE DS    0H                       INSTRUCTION LENGTH=4            11580002
         MVC   BRKINST(L4),D0(R5)       SAVE INSTRUCTION.               11590002
         LA    R5,D4(R5)                BUMP INSTR ADDR REGISTER.       11600002
         B     CHECKMOR                 CHECK FOR MORE IN RANGE.        11610002
         SPACE                                                          11620002
SIXBYTE  DS    0H                       INSTRUCTION LENGTH=6            11630002
         MVC   BRKINST(L6),D0(R5)       SAVE INSTRUCTION.               11640002
         LA    R5,D6(R5)                BUMP INSTR ADDR REGISTER.       11650002
         SPACE                                                          11660002
*********************************************************************** 11670002
*        CHECK TO BE SURE INSTRUCTION AT BREAKPOINT ADDRESS IS        * 11680002
*        VALID. IF NOT, GO PUT OUT MESSAGE.                           * 11690002
*********************************************************************** 11700002
CHECKMOR DS    0H                       DOES INSTR. HAVE VALID OP CODE  11710002
         L     R1,BRKADDR               R1=POINTER TO BREAK INSTR.      11720002
         L     R8,OPCODTAB              R8=POINTER TO TABLE OF OP CODES 11730002
         LR    R4,R1                    PUT ADDRESS OF FIRST BYTE       11740002
*                                       OF OP CODE IN R4                11750002
         LA    R6,L5                    PUT LENGTH OF ONE BYTE OP CODE  11760002
*                                       TABLE ENTRY IN R6               11770002
CKCODE   DS    0H                       CODE LOOP                       11780002
         XR    R7,R7                    ZERO R7                         11790002
         IC    R7,D0(R4)                R7=OP CODE OF INSTRUCTION       11800002
         MR    R6,R6                    GET INDEX FOR OP CODE TABLE     11810002
         LA    R8,D0(R7,R8)             R8=ADDRESS FOR OP CODE TEST     11820002
         TM    D0(R8),FF                WAS OP CODE VALID               11830002
         BNZ   OPCODEOK                 BRANCH IF VALID OP CODE         11840002
         SPACE                                                          11850002
         CR    R1,R4                    WAS SECOND BYTE OF OPCODE       11860002
*                                       CHECKED ?                       11870002
         BNE   BADOPCD                  YES, OP CODE NO GOOD            11880002
         CLI   D0(R1),HEXB2             ELSE CHECK FOR 2 BYTE OP CODE   11890002
         BNE   BADOPCD                  BRANCH IF INVALID OP CODE       11900002
         LA    R4,D1(R1)                PUT ADDRESS OF SECOND BYTE      11910002
*                                       OF 2-BYTE OP CODE IN R4         11920002
         CLI   D0(R4),TWOHIGH           CHECK TO SEE IF SECOND BYTE     11930002
*                                       IS WITHIN RANGE                 11940002
         BH    BADOPCD                  NO, BAD OP CODE                 11950002
         LA    R6,L6                    PUT LENGTH OF 2-BYTE OP CODE    11960002
*                                       TABLE ENTRY IN R6               11970002
         L     R8,TSTOPCD2              POINT TO TABLE OF 2-BYTE OP     11980002
*                                       CODES                           11990002
         B     CKCODE                   GO CHECK SECOND BYTE            12000002
         SPACE                                                          12010002
*********************************************************************** 12020002
*        MOVE SVC97 OP CODE TO REPLACE INSTRUCTION AT BREAKPOINT.     * 12030002
*        IF NO RANGE, OR END OF RANGE, GO CHECK FOR MORE PDES.        * 12040002
*        IF RANGE, SET RANGE FLAG IN BREAKELEMENT, GET CORE           * 12050002
*        FOR ANOTHER BREAK ELEMENT, RESET LINK POINTERS, AND GO       * 12060002
*        PROCESS NEXT INSTRUCTION IN RANGE.                           * 12070002
*********************************************************************** 12080002
OPCODEOK DS    0H                       OP CODE IS VALID                12090002
         MVC   D0(L2,R1),RSVC           SET BREAKPOINT SVC IN INSTR.    12100002
         L     R6,PDE2USER              R6=END OF RANGE(IF RANGE).      12110002
         LA    R6,D0(R6)                CLEAR HIGH ORDER BYTE           12120002
         CR    R5,R6                    Q. IS NEXT INSTRUCTION HIGH     12130002
         BH    NEXTCHAI                 YES, GET NEXT PDE               12140002
         TM    D0(R5),LENBITS           HOW MANY BYTES IN INSTRUCTION ? 12140402
         BO    TRYSIX                   SIX BYTE INSTRUCTION            12141202
         BM    TRYFOUR                  FOUR BYTE INSTRUCTION           12141602
         OC    D0(L2,R5),D0(R5)         TRY FOR PROTECTION CHECK        12142002
BLOW12   DS    0H                       RESUME ADDRESS FOR PROT. CK     12144002
         B     RANGFLAG                 TURN ON RANGE FLAG              12146002
         SPACE                                                          12146402
TRYSIX   DS    0H                       SIX BYTE INSTRUCTION            12148002
         OC    D0(L6,R5),D0(R5)         TRY FOR PROTECTION CHECK        12148402
BLOW16   DS    0H                       RESUME ADDRESS FOR PROT. CK.    12148802
         B     RANGFLAG                 TURN ON RANGE FLAG              12149202
         SPACE                                                          12149602
TRYFOUR  DS    0H                       FOUR BYTE INSTRUCTION           12149702
         OC    D0(L4,R5),D0(R5)         TRY FOR PROTECTION CHECK        12149802
BLOW14   DS    0H                       RESUME ADDRESS FOR PROT. CK.    12149902
         SPACE                                                          12153202
RANGFLAG DS    0H                       TURN ON RANGE FLAG              12155202
         OI    BRKFLGS,BRKRANGE         WE'RE IN A VALID RANGE.         12156702
         LA    R0,BRKLEN                R0=LENGTH FOR GETMAIN           12160002
         ST    R0,BYTENUMB              SAVE IN WORKAREA                12180002
         GETMAIN RC,LV=(0),SP=1                                         12190002
SMTGET02 DS    0H                       FOR SMT TEST CASES.             12200002
BLOW4    DS    0H                       RESUME ADDRESS IN CASE          12210002
*                                       OF GETMAIN FAILURE              12220002
         LTR   R15,R15       WAS GETMAIN SUCCESSFUL?                    12222002
         BZ    BLOW4C        YES, BRANCH TO CONTINUE                    12224002
         LA    R1,SVC10NO    R1=SVC 10 NUMBER                           12226002
* ISSUE 'GETMAIN SVC ERROR' MESSAGE                                     12228002
         BAL   R5,GETFREIO   PUT OUT MESSAGE                            12228402
         C     R15,ATTNCODE  IS RETURN CODE 16,20 OR 24?                12228802
         BNL   RETURNRC      YES, SEND IT TO CALLER                     12229202
         LA    R15,TWENTY    SET RETURN TO ABEND TYPE                   12229602
         B     RETURNRC      SEND IT TO CALLER                          12229702
BLOW4C   EQU   *                                                        12229802
         XC    D0(BRKLEN,R1),D0(R1)     CLEAR NEW BREAK ELEMENT         12230002
         OI    BRKFLGS-BRKELEM(R1),BRKRANGE TURN ON RANGE SWITCH.       12240002
         LA    R6,BRKLINK               R6=LINK FIELD ADDR IN           12250002
*                                       PREVIOUS BRK ELEM.              12260002
         L     R7,BRKLINK               R7=CONTENTS OF THAT LINK FIELD. 12270002
         LR    R2,R1                    R2=ADDR OF NEW BRK ELEM.        12280002
         B     SEQLOOP                  GO BUILD IT.                    12290002
         SPACE                                                          12300002
*********************************************************************** 12310002
*        OP CODE WAS BAD. BUILD MESSAGE IN OUTPUT BUFFER AND SEND     * 12320002
*        TO TERMINAL.                                                 * 12330002
*********************************************************************** 12340002
BADOPCD  DS    0H                       A BAD OP CODE HAS BEEN FOUND    12350002
         OI    TSTFLGS4,TSTFLUSH TURN ON TSTFLUSH SO MNL WILL           12400002
*                                FLUSH INPUT STACK                      12450002
         L     R6,SAVEPTR    R6=PTR TO PREVIOUS LINK FIELD              12500002
         MVC   D0(L4,R6),BRKLINK RESET PREVIOUS LINK FIELD              12550002
         LH    R7,BRKDISP    R7=BREAKPOINT DISPLACEMENT                 12560002
         L     R0,BYTENUMB   R0=NUMBER OF BYTES LAST GOTTEN             12600002
         FREEMAIN RC,LV=(R0),A=(R2),SP=1 FREEMAIN CORE LAST GOTTEN      12650002
         LTR   R15,R15       WAS FREEMAIN SUCCESSFUL?                   12700002
         BZ    BOC1          YES, BRANCH TO CONTINUE                    12710002
         LA    R1,SVC120NO   R1=SVC 120 NUMBER                          12720002
* ISSUE 'FREEMAIN SVC ERROR' MESSAGE                                    12722002
         BAL   R5,GETFREIO   PUT OUT MESSAGE                            12730002
         BAL   R5,IORC2      TEST IO RETURN CODES AND CONTINUE          12740002
BOC1     EQU   *                                                        12742002
         OC    PDE2USER+D1(L3),PDE2USER+D1 IS ADDRESS IN RANGE          12750002
         BNZ   RANGMSG       YES,OUTPUT RANGE MESSAGE                   12800002
         LA    R1,MSG10      R1=ADDR OF MESSAGE NUMBERS                 12850002
         BAL   R5,IOTYPE3    PUT OUT MESSAGE                            12900002
         BAL   R5,IORC2      TEST IO RC'S                               13100002
         B     NEXTCHAI      CHECK FOR MORE BRKELEMS TO BE BUILT        13150002
RANGMSG  DS    0H                                                       13200002
         XC    TSTIOPRM(L'TSTIOPRM),TSTIOPRM CLEAR IO PARM LIST         13300002
* ISSUE 'NO BREAKPOINTS ESTABLISHED FROM OFFSET OF RANGE BEGINNING'     13350002
* ISSUE 'INVALID OP CODE' MESSAGE                                       13400002
         IKJEGSIO MSG,FIRST=M0037,INST11=(REG,(R7)),ID=AT004,          *13410002
               INST12=(APDE,(R11)),SECOND=M0244,MF=(E,TSTIOPRM)         13414002
         BAL   R5,IORC2      TEST IO RC'S                               13416002
         B     NEXTCHAI      CHECK FOR MORE BRKELEMS TO BE BUILT        13418002
         SPACE                                                          13420002
*********************************************************************** 13430002
*        NORMAL RETURN TO CALLER FROM BREAKRTN. RC = 0.               * 13440002
*********************************************************************** 13450002
ROUTRTN  DS    0H                       NORMAL RETURN TO CALLER.        13460002
         SR    R15,R15                  INDICATE NORMAL RETURN.         13470002
         SPACE                                                          13480002
*********************************************************************** 13490002
*        RETURN TO CALLER FROM BREAKRTN. LEAVE RETURN CODE IN R15.    * 13500002
*********************************************************************** 13510002
RETURNRC DS    0H                       ABNORMAL RETURN TO CALLER.      13520002
         L     R13,SAVELAST-SAVEAREA(R13)  RESET R13 TO RESTORE         13530002
*                                       CALLER'S REGISTERS              13540002
         RETURN (14,12),RC=(15)         RETURN TO CALLER.               13550002
         SPACE                                                          13560002
*********************************************************************** 13570002
*        BREAKPOINT ADDRESS IS A DUPLICATE OF AN EXISTING BREAKPOINT  * 13580002
*        REMOVE EXISTING BREAK ELEMENT AND GO ADD THIS ONE TO         * 13590002
*        THE QUEUE.                                                   * 13600002
*********************************************************************** 13610002
DUPLICAT DS    0H                       DUPLICATE BREAK ADDR FOUND      13620002
         LA    R1,SRHPARMS              R1=ADDRESS OF SRH PARM LIST     13630002
         XC    SRHPARMS(SRHPRMLH),SRHPARMS       ZERO SRH PARM LIST     13680002
         ST    R5,SRHADDR1              PUT BREAKPOINT ADDRESS          13690002
*                                       IN SRH PARM LIST                13700002
         L     R15,TSTSRHRT             GET ADDRESS OF BRKELEM          13710002
*                                       REMOVAL ROUTINE                 13712002
         BALR  R14,R15                  BRANCH TO BRKELEM REMOVAL RTN   13714002
         L     R7,D0(R6)                R6 POINTS TO PREVIOUS LINK      13716002
*                                       FIELD - PUT ADDRESS OF NEXT     13718002
*                                       BRKELEM IN R7                   13718402
         C     R15,ATTNCODE  IS RETURN CODE LESS THAN 16?               13728402
         BNL   RETURNRC      NO,SEND RETURN CODE TO MAIN ROUTINE        13730402
         B     ADDL          GO BUILD A NEW BRKELEM                     13732402
         SPACE                                                          13735802
*********************************************************************** 13737902
*        IF NO MORE CONVERTED PDES, RETURN TO CALLER WITH RC = 0.     * 13740002
*        IF MORE PDES, FLAG THEM AS PART OF A LIST AND GO             * 13750002
*        PROCESS THEM.                                                * 13760002
*********************************************************************** 13770002
NEXTCHAI DS    0H                       EXAMINE CHAIN FIELD             13780002
         L     R11,PDE2CHAI             R11=CHAIN POINTER FOR           13790002
*                                       ADDR LIST                       13800002
         LA    R11,D0(R11)              CLEAR HIGH ORDER BYTE.          13810002
         LTR   R11,R11                  Q.IS A LIST POINTER PRESENT.    13820002
         BZ    ROUTRTN                  NO, ALL DONE, RETURN.           13830002
         TM    PDEUSER,PDECONVD         Q.WAS PDE CONVERTED             13840002
         BZ    NEXTCHAI                 NO, ARE MORE PDE'S CHAINED      13850002
         OI    PDEUSER,PDEADLST         FLAG THE PDE AS A               13860002
*                                       MEMBER OF A LIST                13870002
         B     SUPRLOOP                 CALCULATE SIZE,                 13880002
*                                       BUILD BREAK ELEMENT             13890002
         SPACE                                                          13900002
*********************************************************************** 13910002
*        PARSE RETURNED A NONZERO RETURN CODE. USE THIS BRANCH        * 13920002
*        TABLE TO PROCESS.                                            * 13930002
*********************************************************************** 13940002
         ORG   *-4                      REUSE SPACE FOR IMPOSSIBLE      13950002
*                                       ZERO RETURN CODE                13960002
CHKCODE  DS    0H                       THIS CODE IS ENTERED TO         13970002
*                                       DETERMINE WHY PARSE WAS         13980002
*                                       UNSUCCESSFUL                    13990002
         ORG                                                            14000002
         B     EXITOK1                  USER SPECIFIED NO PROMPT        14010002
         B     SET16                    ATTENTION INTERRUPT             14020002
         B     INVPARM                  AN INVALID PARAMETER WAS USED   14030002
*                                       IN PARSE                        14040002
         B     NOCORE                   INSUFFICIENT CORE               14050002
         B     PICKUP                   GET RETURN CODE FROM WORK AREA  14060002
         SPACE                                                          14070002
*********************************************************************** 14080002
*        PARSE RETURN CODE 4 - USER ENTERED INCOMPLETE/INCORRECT      * 14090002
*        DATA, BUT PROFILE WAS FOR NOPROMPT. SET FLAG IN TCOMTAB      * 14100002
*        TO TELL MAINLINE TO FLUSH INPUT STACK. RETURN TO MAINLINE    * 14110002
*        WITH RC = 0.                                                 * 14120002
*********************************************************************** 14130002
EXITOK1  DS    0H                                                       14140002
         OI    TSTFLGS4,TSTFLUSH        INDICATE FLUSH OF STACK.        14150002
         SR    R15,R15       ZERO RETURN CODE                           14160002
         B     RETMAIN       RETURN TO IKJEGMNL                         14162002
         SPACE                                                          14170002
*********************************************************************** 14180002
*        PARSE RETURN CODE 20 - VALIDITY CHECK ERROR. GET RETURN      * 14190002
*        CODE SAVED BY VALIDITY CHECK ROUTINE AND RETURN TO           * 14200002
*        MAINLINE WITH THAT AS A RETURN CODE.                         * 14210002
*********************************************************************** 14220002
PICKUP   DS    0H                       PICK UP RETURN CODE AND RETURN  14230002
         L     R15,PARSECD              GET RETURN CODE                 14240002
         B     RETMAIN                  RETURN TO MAINLINE              14250002
         SPACE                                                          14260002
*********************************************************************** 14270002
*        PARSE RETURN CODE 16 - NOT ENOUGH CORE. ISSUE MESSAGE,       * 14280002
*        AND RETURN TO MAINLINE WITH RC = 0.                          * 14290002
*********************************************************************** 14300002
NOCORE   DS    0H                       PUT OUT MSG. FOR INSUFFICIENT   14310002
*                                       STORAGE                         14320002
         BAL   R5,IOTYPE1    PUT OUT MESSAGE                            14370002
         BAL   R5,IORC1      TEST IO RC'S                               14376002
         B     CODE0                    SET RETURN CODE TO ZERO AND     14380002
*                                       RETURN TO MAINLINE              14390002
         SPACE                                                          14400002
*********************************************************************** 14410002
*        PARSE RETURN CODE 12 - AN INVALID PARAMETER WAS PASSED       * 14420002
*        TO PARSE. ISSUE MESSAGE AND RETURN TO MAINLINE WITH RC = 0.  * 14430002
*********************************************************************** 14440002
INVPARM  DS    0H                       SET UP MESSAGE FOR UNABLE       14450002
*                                       TO PARSE                        14460002
         XC    TSTIOPRM(L'TSTIOPRM),TSTIOPRM CLEAR IO PARM LIST         14470002
* ISSUE 'AT FAILED,COMMAND SYSTEM ERROR' MESSAGE                        14480002
* ISSUE 'PARSE ERROR CODE 12' MESSAGE                                   14490002
         IKJEGSIO MSG,FIRST=M0104,INST11=(NUM,I0013),SECOND=M0277,     *14492002
               ID=AT004,MF=(E,TSTIOPRM)                                 14494002
         BAL   R5,IORC1      TEST IO RC'S                               14496002
         B     CODE0         RETURN TO MNL WITH RC=0                    14498002
         SPACE                                                          14500002
*********************************************************************** 14700002
*        PARSE RETURN CODE 8 - AN ATTENTION WAS ENTERRED. SET         * 14710002
*        RC = 16 AND RETURN TO MAINLINE.                              * 14720002
*********************************************************************** 14730002
SET16    DS    0H                       SET RETURN CODE TO 16 FOR       14740002
         LA    R15,SIXTEEN              ATTENTION SCHEDULED             14750002
         B     RETMAIN                  RETURN TO MAINLINE              14760002
         EJECT                                                          14890002
*********************************************************************** 14900002
*                                                                     * 14910002
*               ESTAE EXIT ROUTINE                                    * 14920002
*                                                                     * 14930002
*********************************************************************** 14940002
RETRY    DS    0H                       AT'S RETRY ROUTINE IN CASE OF   14950002
*                                       AN ABEND                        14960002
*********************************************************************** 14970002
*        GET ADDRESS OF TCOMTAB                                       * 14980002
*********************************************************************** 14990002
         L     R5,CVTPTR                R5=ADDRESS OF CVT               15000002
         USING CVT,R5                   ESTABLISH ADDRESSABILITY        15010002
*                                       TO CVT                          15020002
         L     R5,CVTTCBP               R5=POINTER TO DOUBLE WORD       15030002
*                                       OF POINTERS TO NEXT-TO-BE       15040002
*                                       DISPATCHED TCB AND CURRENT      15050002
*                                       TCB                             15060002
         DROP  R5                                                       15070002
         L     R5,D4(R5)                R5=POINTER TO CURRENT TCB       15080002
*                                       (TEST'S TCB)                    15090002
         USING TCB,R5                   ESTABLISH ADDRESSABILITY TO     15100002
*                                       TEST'S TCB                      15110002
         L     R9,TCBTRN                R9=ADDRESS OF TCOMTAB           15120002
         DROP  R5                                                       15130002
         SPACE                                                          15140002
*********************************************************************** 15150002
*        RESTORE AT'S REGISTERS 13 AND 12(BASE).                      * 15160002
*********************************************************************** 15180002
         L     R13,REGSAVE2             R13=ADDRESS OF AT'S SAVE AREA   15190002
         L     R12,GR12-SAVEAREA(R13)   RESTORE BASE REGISTER           15200002
*********************************************************************** 15260002
*        IF AT WAS ENTERED TO ACTIVATE DEFERED BREAK ELEMENTS,        * 15270002
*        SET RETURN CODE TO 4 AND RETURN TO MAINLINE. OTHERWISE,      * 15280002
*        SET RETURN CODE TO 20 AND RETURN TO MAINLINE.                * 15290002
*********************************************************************** 15300002
         TM    TSTFLGS1,TSTBUILD        WAS THIS MODULE ENTERED TO      15320002
*                                       BUILD ACTIVE BREAKPOINTS        15330002
*                                       FROM THE DEFER QUEUE            15340002
         BO    CODE4                    YES, SET CODE TO 4              15350002
         LA    R15,TWENTY               R15=20 - INDICATES RETURN FROM  15360002
*                                       RETRY ROUTINE                   15370002
         B     RETMAIN                  RETURN TO MAINLINE              15380002
         EJECT                                                          15390002
*      ERRET FOR LINK TO IKJPARS                                        15392002
PARSERR  EQU   *                                                        15394002
         XC    TSTIOPRM(L'TSTIOPRM),TSTIOPRM CLEAR IO PARM LIST         15396002
         LR    R0,R1         LOAD ABEND CODE INTO R0                    15396402
* ISSUE 'LINK TO IKJPARS SVC ERROR' MESSAGE                             15398002
         IKJEGSIO SVCERR,SVC=6,ABENDRG=(R0),RC=(R15),                  *15398402
               INST11=(NUM,I0040),ID=AT004,MF=(E,TSTIOPRM)              15398802
         C     R15,ATTNCODE  IS RETURN CODE 16,20 OR 24?                15399202
         BNL   RETMAIN       YES SEND IT TO IKJEGMNL                    15399602
         LA    R15,TWENTY    MAKE RETURN CODE LOOK LIKE ABEND           15399702
         B     RETMAIN       SEND IT TO MAINLINE                        15399802
         EJECT                                                          15400002
*********************************************************************** 15410002
* THIS SECTION RECEIVES CONTROL FROM IKJPARS ONCE IKJPARS HAS SCANNED * 15420002
* AN ADDRESS AND HAS DETERMINED THAT IT IS SYNTACTICALLY CORRECT.     * 15430002
* FURTHER VALIDITY CHECKING OF THE ADDRESS IS PERFORMED TO ENSURE     * 15440002
* THAT THE ADDRESS IS AN ACCEPTABLE TYPE FOR THE AT SUBCOMMAND.  IF   * 15450002
* AN ADDRESS IS FOUND TO BE UNACCEPTABLE, A MESSAGE IS ISSUED TO THE  * 15460002
* USER BEFORE CONTROL IS RETURNED TO IKJPARS.                         * 15470002
*********************************************************************** 15480002
         SPACE                                                          15490002
AT1ADDVC DS    0H                       VALIDITY CHECK FOR ADDRESS      15500002
         SAVE  (14,12),,AT1ADDVC        SAVE REGISTERS FROM PARSE       15510002
         L     R5,D4(R1)                R5=ADDR OF AT'S SAVE AREA       15520002
         L     R12,GR12-SAVEAREA(R5)    GET ADDRESSABILITY WITH MAIN    15530002
*                                       SECTIONS                        15540002
         L     R9,GR9-SAVEAREA(R5)      R9=ADDR OF TCOMTAB              15550002
         L     R6,REGSAVE3              R6=ADDR OF EXIT ROUTINE'S       15560002
*                                       SAVE AREA                       15570002
         ST    R13,SAVELAST-SAVEAREA(R6)   SAVE ADDR OF PARSE'S         15580002
*                                       SAVE AREA                       15590002
         ST    R6,SAVENEXT-SAVEAREA(R13)  SAVE ADDR OF EXIT'S SAVE AREA 15600002
*                                       IN PARSE'S SAVE AREA            15610002
         LR    R13,R6                   R13=ADDR OF THIS ROUTINE'S SAVE 15620002
*                                       AREA                            15630002
         L     R10,WORKAREA             R10=ADDRESS OF COMMON WORKAREA  15640002
         LA    R8,D8(R1)                R8=ADDR OF LAST WORD OF         15650002
*                                       PARSE'S PARM LIST               15660002
         SPACE                                                          15670002
         L     R11,D0(R1)               R11=ADDRESS OF PDE              15680002
         USING IKJPARMA,R11             ESTABLISH ADDRESSABILITY TO PDE 15690002
         OI    TSTFLGS4,TSTVALCK TURN ON VALIDITY CHECK BIT             15692002
         L     R4,OUTBUF     R4=ADDR OF OUTBUF                          15694002
         XC    D0(L4,R4),D0(R4) ZERO FIRST WORD OF OUTBUF               15696002
         SPACE                                                          15700002
*********************************************************************** 15710002
*        CHECK FOR INVALID ADDRESS TYPE. IF INVALID, GO PUT           * 15720002
*        OUT MESSAGE.                                                 * 15730002
*********************************************************************** 15740002
         XR    R4,R4                    CLEAR REGISTER FOR TESTS        15750002
         CH    R4,PDEINDCT              IS ADDRESS INDIRECT             15760002
         BNE   CHKRANGE                 YES, WAS A RANGE GIVEN          15770002
         TM    PDEFLG4,GENR+LFPR+SFPR   IS ADDRESS REGISTER TYPE ?      15780002
         BM    STORMSG                  YES, PUT OUT ERROR MESSAGE      15790002
         SPACE                                                          15800002
*********************************************************************** 15810002
*        IF A RANGE WAS ENTERED, GO CHECK IT.                         * 15820002
*********************************************************************** 15830002
CHKRANGE DS    0H                       WAS A RANGE SPECIFIED           15840002
         TM    PDE2FLG2,CTNAMFLG        ENTRYNAME GIVEN IN SECOND PDE   15850002
         BO    RANGE                    YES, CHECK FOR VALID ADDRESS    15860002
         TM    PDE2FLG3,AFLG            STRING GIVEN                    15870002
         BO    RANGE                    YES, CHECK FOR VALID ADDRESS    15880002
         SPACE                                                          15890002
*********************************************************************** 15900002
*        RANGE NOT GIVEN. IF LOADNAME AND ADDRESS STRING ARE          * 15910002
*        GIVEN, GO CHECK FOR VALID SYMBOL.                            * 15920002
*********************************************************************** 15930002
NORANGE  DS    0H                       RANGE NOT GIVEN - TEST FOR      15940002
*                                       FULLY QUALIFIED NAME            15950002
         TM    PDEFLG1,LDNAMFLG         LOADNAME GIVEN                  15960002
         BZ    EXITCONV                 NO, CONVERT ADDRESS             15970002
         TM    PDEFLG3,AFLG             STRING GIVEN                    15980002
         BNZ   TESTSYM                  INSURE ADDRESS STRING IS NOT    15990002
*                                       SYMBOL WITH LENGTH GREATER      16000002
*                                       THAN EIGHT                      16010002
         SPACE                                                          16020002
*********************************************************************** 16030002
*        NEITHER LOADNAME NOR ADDRESS STRING WERE GIVEN. CONVERT      * 16040002
*        ADDRESS TO BINARY, BE SURE ADDRESS IS WRITABLE,              * 16050002
*        AND BE SURE CONVERTED ADDRESS IS IN PDEUSER FIELD.           * 16060002
*********************************************************************** 16070002
EXITCONV DS    0H                       SET UP FOR GOING TO CONVERT     16080002
*                                       ROUTINE                         16090002
         LCR   R1,R11                   R1=COMPLEMENT OF ADDRESS OF PDE 16100002
*                                       TO INDICATE ADDRESS CONVERT     16110002
         XR    R0,R0                    R0=ZERO TO INDICATE CONVERT TO  16120002
*                                       BINARY                          16130002
         OI    TSTFLGS1,RANGESW         TELL CONVERT TO EXPECT A RANGE  16140002
         L     R15,TSTCONVT             R15=ADDRESS OF CONVERT ROUTINE  16150002
         BALR  R14,R15                  GET ADDRESS CONVERTED           16160002
         LTR   R15,R15                  WAS CONVERT SUCCESSFUL          16170002
         BNZ   NOTCONV(R15)             NO, SEE IF PDE USELESS          16180002
         TM    PDEFLG5,PDEWRITE         IS ADDRESS WRITABLE ?           16182002
         BZ    ADDRPROT                 NO, CAN'T PUT A BRKPT THERE     16184002
         TM    PDEUSER,PDESIB           IS ADDRESS IN USERWORD          16190002
         BZ    INWORD                   YES, CHECK BOUNDARY             16200002
         L     R6,PDEUSER               R6=ADDRESS OF SI BLOCK          16210002
         MVC   PDEUSER(L4),D0(R6)       MOVE ADDRESS INTO USERWORD      16220002
         SPACE                                                          16230002
*********************************************************************** 16240002
*        IF ADDRESS NOT ON HALFWORD BOUNDARY, GO ISSUE ERROR          * 16250002
*        MESSAGE. OTHERWISE, FLAG PDE AS CONVERTED, SET RETURN C      * 16260002
*        CODE TO 0                                         *            16270002
*********************************************************************** 16280002
INWORD   DS    0H                       ADDRESS IS IN USERWORD          16290002
         TM    PDEUSER+D3,BADBOUND      IS ADDRESS FOR HALF-WORD        16300002
*                                       BOUNDARY                        16310002
         BO    BOUNDMSG                 NO, PUT OUT MESSAGE             16320002
         MVI   PDEUSER,PDECONVD         SET FLAG FOR PDE CONTAINING     16330002
*                                       BINARY ADDRESS                  16340002
         SPACE                                                          16350002
EXITOK   DS    0H                       SET RETURN CODE TO ZERO         16360002
         XR    R15,R15                  ZERO REGISTER                   16370002
         SPACE                                                          16380002
*********************************************************************** 16390002
*              RETURN                                                 * 16400002
*********************************************************************** 16410002
RETPARSE DS    0H                       RETURN FOR PARSE                16420002
         L     R13,SAVELAST-SAVEAREA(R13) RESTORE R13                   16422002
         NI    TSTFLGS4,HEXFF-TSTVALCK TURN OFF VALIDITY CHECK BIT      16422402
         SR    R0,R0         R0=0                                       16422802
         L     R2,OUTBUF     R2=ADDR OF OUTBUF                          16423202
         C     R0,D0(R2)     IS THERE A SECOND LEVEL MESSAGE TO PASS?   16423602
         BE    RETPARS1      NO, JUST GO BACK TO PARSE                  16423702
         L     R1,GR1-SAVEAREA(R13) R1=ADDR OF PARSE PARAMETER LIST     16423802
         MVC   D8(L4,R1),OUTBUF PUT ADDRESS OF SECOND LEVEL MESSAGE     16423902
*                               INTO PARSE PARAMETER LIST               16426202
RETPARS1 EQU   *                                                        16428202
         RETURN (14,12),RC=(15) RETURN                                  16429302
RETMAIN  DS    0H                       RETURN FOR MAINLINE             16431602
         TM    TSTFLGS1,TSTBUILD ARE WE ACTIVATING DEFERED BRKPTS?      16433902
         BO    CODE4         YES, GO GENERATE THE RIGHT RETURN CODE     16436202
         LR    R2,R15        SAVE RETURN CODE                           16438502
         ESTAE 0             REMOVE ESTAE                               16440802
         LR    R15,R2        RESET RETURN CODE                          16443102
         NI    TSTFLGS4,HEXFF-TSTRERTN TURN OFF RETRY BIT               16445402
         L     R13,SAVELAST-SAVEAREA(R13)  RESTORE R13                  16447702
         RETURN (14,12),,RC=(15)        RETURN                          16450002
         SPACE                                                          16460002
*********************************************************************** 16470002
*        CVT RETURNED A NONZERO RETURN CODE. USE THE FOLLOWING        * 16480002
*        BRANCH TABLE TO PROCESS IT.                                  * 16490002
*********************************************************************** 16500002
         ORG   *-4                      REUSE SPACE FOR ZERO COND. CODE 16510002
NOTCONV  DS    0H                                                       16520002
         ORG                                                            16530002
         B     EXIT8                    RETURN CODE 4                   16540002
         B     EXIT8                    RETURN CODE 8                   16550002
         B     EXIT8                    RETURN CODE 12                  16560002
         B     EXIT12                   RETURN CODE 16                  16570002
         B     EXIT12                   RETURN CODE 20                  16580002
         B     EXIT12        RETURN CODE 24                             16582002
         SPACE                                                          16590002
*********************************************************************** 16600002
*        CVT RETURN CODE 16,20,24 EITHER AN ATTENTION WAS ENTERED     * 16610002
*        OR SYM OR CVT BLEW. SAVE RETURN CODE IN WORKAREA, SET        * 16620002
*        RETURN CODE TO 20, AND RETURN TO PARSE.                      * 16630002
*********************************************************************** 16640002
EXIT12   DS    0H                       SET RETURN TO PARSE TO 12 SO    16650002
*                                       THAT IT WILL RETURN TO AT       16660002
         ST    R15,PARSECD              SAVE RETURN CODE IN WORK AREA   16670002
         LA    R15,TWELVE               SET RETURN CODE TO 12           16680002
         B     RETPARSE                 RETURN TO PARSE                 16690002
         SPACE                                                          16700002
*********************************************************************** 16702002
*        ADDRESS IN PDE IS IN WRITE-PROTECTED CORE. ISSUE             * 16704002
*        APPROPRIATE ERROR MESSAGE, SET RETURN CODE TO 8,             * 16706002
*        AND RETURN TO PARSE.                                         * 16708002
*********************************************************************** 16708402
ADDRPROT DS    0H                       WRITE PROTECTED ADDRESS         16708802
         LA    R1,MSG2       R1=ADDR OF MESSAGE NUMBERS                 16709202
         B     SETADDR                  ADD STRING TO MESSAGE           16709702
         SPACE                                                          16709802
*********************************************************************** 16710002
*        INVALID ADDRESS TYPE. ISSUE MESSAGE, SET RETURN CODE         * 16720002
*        TO 8 AND RETURN TO PARSE.                                    * 16730002
*********************************************************************** 16740002
STORMSG  DS    0H                       PUT OUT MESSAGE FOR INVALID     16750002
*                                       ADDRESS - REGISTER SPECIFI-     16760002
*                                       CATION NOT ALLOWED              16770002
         TM    PDE2FLG2,CTNAMFLG        WAS ENTRYNAME OF RANGE GIVEN    16780002
         BO    STMSG2                   YES, PREPARE RANGE MESSAGE      16790002
         TM    PDE2FLG3,AFLG            WAS STRING GIVEN                16800002
         BO    STMSG2                   YES, PREPARE RANGE MESSAGE      16810002
         LA    R1,MSG6       R1=ADDR OF MESSAGE NUMBERS                 16820002
         SPACE                                                          16840002
SETADDR  DS    0H                       ADD ADDRESS STRING TO MSG       16850002
         BAL   R5,IOTYPE3    PUT OUT MESSAGE                            17022002
         BAL   R5,IORC3      TEST IO RC'S                               17058002
         B     EXIT8A        RETURN TO PARSE                            17058402
         SPACE                                                          17060002
*********************************************************************** 17070002
*        CVT RETURN CODE = 4, 8, OR 12. SET RETURN CODE TO 8, RETURN TO 17080002
*        PARSE                                                          17090002
*********************************************************************** 17110002
EXIT8    DS    0H                       SET RETURN CODE TO PARSE TO     17120002
*                                       HAVE PARSE ISSUE 'REENTER'      17130002
EXIT8A   DS    0H                       SET RETURN CODE TO 8            17220002
         LA    R15,EIGHT                SET CODE TO EIGHT               17230002
         B     RETPARSE                 RETURN TO PARSE                 17240002
         SPACE                                                          17250002
*********************************************************************** 17260002
*        LOADNAME AND ADDRESS STRING GIVEN. TEST FOR VALID SYMBOL.    * 17270002
*        IF INVALID, ISSUE MESSAGE AND RETURN TO PARSE WITH RC = 8.   * 17280002
*********************************************************************** 17290002
TESTSYM  DS    0H                       IS STRING A SYMBOL WITH         17300002
*                                       LENGTH GREATER THAN 8           17310002
         CLC   PDELEN3,SYMBLLNH         IS LENGTH GREATER THAN 8        17320002
         BNH   EXITOK                   NO, RETURN TO PARSE WITHOUT     17330002
*                                       CONVERTING ADDR AS DEFER        17340002
*                                       MIGHT BE SPECIFIED              17350002
         TM    PDEFLG4,SYMADDR          IS STRING A SYMBOL              17360002
         BNO   EXITOK                   NO, RETURN TO PARSE             17370002
         LA    R1,MSG7       R1=ADDR OF MESSAGE NUMBERS                 17380002
         B     SETADDR                  ADD ADDRESS STRING TO MSG       17400002
         SPACE                                                          17410002
STMSG2   DS    0H                       SET UP FOR RANGE MESSAGE -      17420002
*                                       INVALID REGISTER NOTATION       17430002
         LA    R1,MSG8       R1=ADDR OF MESSAGE NUMBERS                 17440002
         B     SETADDR                  ADD STRING TO MESSAGE           17460002
         SPACE                                                          17470002
*********************************************************************** 17480002
*        ADDRESS NOT ON HALFWORD BOUNDARY. ISSUE MESSAGE,             * 17490002
*        SET RC = 8 AND RETURN TO PARSE.                              * 17500002
*********************************************************************** 17510002
BOUNDMSG DS    0H                       PREPARE MESSAGE FOR ADDRESS NOT 17520002
*                                       ON HALF-WORD BOUNDARY           17530002
         LA    R1,MSG5       R1=ADDR OF MESSAGE NUMBERS                 17540002
         SPACE                                                          17570002
BNDMSG1  DS    0H                                                       17572002
         BAL   R5,IOTYPE2    PUT OUT MESSAGE                            17574002
         BAL   R5,IORC3      TEST IO RC'S                               17579602
         B     EXIT8A        RETURN TO PARSE                            17579702
*********************************************************************** 17580002
*        A RANGE WAS GIVEN. IF SECOND ADDRESS IN RANGE IS INVALID     * 17590002
*        REGISTER TYPE ADDRESS, GO ISSUE MESSAGE, SET RC = 8, AND     * 17600002
*        RETURN TO PARSE.                                             * 17610002
*********************************************************************** 17620002
RANGE    DS    0H                       AN ADDRESS RANGE WAS GIVEN      17630002
         CH    R4,PDE2INDC              IS SECOND ADDRESS INDIRECT      17640002
         BNE   ISITFULL                 YES, IS FIRST FULLY QUALIFIED   17650002
         TM    PDE2FLG4,GENR+LFPR+SFPR  IS REGISTER SPECIFIED           17660002
         BM    STMSG2                   BUILD MESSAGE FOR ADDRESS       17670002
*                                       REQUIRED TO BE STORAGE          17680002
         SPACE                                                          17690002
*********************************************************************** 17700002
*        CHECK TYPES OF ADDRESSES IN PDE AND GO TO CORRECT            * 17710002
*        PROCESSING CODE.                                             * 17720002
*********************************************************************** 17730002
ISITFULL DS    0H                       CHECK FOR FIRST ADDRESS FULLY   17740002
*                                         QUALIFIED                     17750002
         TM    PDEFLG1,LDNAMFLG         LOADNAME GIVEN                  17760002
         BZ    GOTOCONV                 NO, CONVERT ADDRESSES           17770002
         TM    PDEFLG3,AFLG             STRING GIVEN                    17780002
         BZ    GOTOCONV                 NO, CONVERT ADDRESSES           17790002
         SPACE                                                          17800002
*********************************************************************** 17810002
* FIRST ARGUMENT OF THE RANGE IS A FULLY QUALIFIED ADDRESS.  CHECK    * 17820002
* THE SECOND ARGUMENT.                                                * 17830002
*********************************************************************** 17840002
         SPACE                                                          17850002
         TM    PDE2FLG1,LDNAMFLG        LOADNAME GIVEN                  17860002
         BZ    GOTOCONV                 NO, CONVERT ADDRESSES           17870002
         TM    PDE2FLG3,AFLG            STRING GIVEN                    17880002
         BZ    GOTOCONV                 NO, CONVERT ADDRESSES           17890002
         SPACE                                                          17900002
*********************************************************************** 17910002
*        BOTH ADDRESSES FULLY QUALIFIED. MAY BE A DEFERRED AT.        * 17920002
*        CHECK FOR VALID ADDRESS STRING. IF INVALID, ISSUE MESSAGE    * 17930002
*        SET RC = 8, AND RETURN TO PARSE. OTHERWISE, SET RC = 0 AND   * 17940002
*        RETURN TO PARSE.                                             * 17950002
*********************************************************************** 17960002
         CLC   PDELEN3,SYMBLLNH         IS LENGTH OF STRING GREATER     17970002
*                                       THAN 8                          17980002
         BNH   CHKPDE2                  NO, CHECK SECOND HALF PDE       17990002
         TM    PDEFLG4,SYMADDR          IS STRING A SYMBOL              18000002
         BNO   CHKPDE2                  NO, CHECK SECOND HALF PDE       18010002
         SPACE                                                          18020002
SYMMSG2  DS    0H                       PUT OUT MSG FOR RANGE CONTAINS  18030002
*                                       SYMBOL WITH LENGTH GREATER      18040002
*                                       THAN 8                          18050002
         LA    R1,MSG9       R1=ADDR OF MESSAGE NUMBERS                 18060002
         B     SETADDR                  ADD STRING TO MESSAGE           18080002
         SPACE                                                          18090002
CHKPDE2  DS    0H                       CHECK LAST PART OF RANGE FOR    18100002
*                                       SYMBOL WITH LENGTH GREATER      18110002
*                                       THAN 8                          18120002
         CLC   PDE2LEN3,SYMBLLNH        IS LENGTH GREATER THAN 8        18130002
         BNH   EXITOK                   NO, RETURN WITHOUT CONVERTING   18140002
*                                       REQUEST MAY BE DEFER            18150002
         TM    PDE2FLG4,SYMADDR         IS STRING A SYMBOL              18160002
         BNO   EXITOK                   NO, RETURN TO PARSE             18170002
         B     SYMMSG2                  YES, PUT OUT MESSAGE            18180002
         SPACE                                                          18190002
*********************************************************************** 18200002
*        BOTH ADDRESSES ARE NOT FULLY QUALIFIED. MUST BE ACTIVE       * 18210002
*        BREAKPOINT. CONVERT BOTH ADDRESSES TO BINARY. FIRST          * 18220002
*        ADDRESS MUST BE LESS THAN OR EQUAL TO SECOND, AND MUST       * 18230002
*        BE ON A HALFWORD BOUNDARY. IF BOTH CONDITIONS ARE NOT MET,   * 18240002
*        ISSUE MESSAGE, SET RC = 8, AND RETURN TO PARSE. IF OK,       * 18250002
*        SET RC = 0 AND RETURN TO PARSE.                              * 18260002
*********************************************************************** 18270002
GOTOCONV DS    0H                                                       18280002
         OI    TSTFLGS1,RANGESW         TELL CONVERT TO EXPECT A RANGE  18290002
         LCR   R1,R11                   R1=COMPLEMENT OF ADDRESS OF PDE 18300002
*                                       TO INDICATE ADDRESS CONVERT     18310002
         XR    R0,R0                    R0=ZERO TO INDICATE CONVERT     18320002
*                                       TO BINARY                       18330002
         L     R15,TSTCONVT             R15=ADDRESS OF CONVERT ROUTINE  18340002
         BALR  R14,R15                  GO TO CONVERT                   18350002
         LTR   R15,R15                  WAS CONVERT SUCCESSFUL          18360002
         BNZ   NOTCONV(R15)             NO, SEE IF PDE USELESS          18370002
         SPACE                                                          18380002
*********************************************************************** 18390002
* CONVERT WAS SUCCESSFUL.  THIS ROUTINE MAKES SURE THE BINARY         * 18400002
* ADDRESSES ARE WRITABLE, AND THE CONVERTED ADDRESSES ARE IN          * 18410002
* THE PDEUSER FIELDS.                                                 * 18412002
*********************************************************************** 18420002
         SPACE                                                          18430002
         TM    PDEFLG5,PDEWRITE         IS FIRST ADDR WRITABLE ?        18432002
         BZ    RANGPROT                 NO, CAN'T PUT A BRKPT THERE     18434002
         TM    PDEUSER,PDESIB           IS FIRST ADDRESS IN USERWORD    18440002
         BO    MOVEADR                  NO, PUT IT THERE                18450002
         SPACE                                                          18460002
CHKUSER2 DS    0H                       LOOK AT SECOND PDE OF RANGE     18470002
         TM    PDE2FLG5,PDEWRITE        IS SECOND ADDR WRITABLE ?       18472002
         BZ    RANGPROT                 NO, CAN'T PUT A BRKPT THERE     18474002
         TM    PDE2USER,PDESIB          IS SECOND ADDRESS IN USERWORD   18480002
         BO    MOVADDR2                 NO, PUT IT THERE                18490002
         SPACE                                                          18500002
COMPUSER DS    0H                       COMPARE ADDRESSES               18510002
         CLC   PDEUSER+D1(L3),PDE2USER+D1  IS FIRST ADDRESS GREATER     18520002
*                                       THAN SECOND                     18530002
         BH    FIRSTHI                  YES, PUT OUT ERROR MESSAGE      18540002
         TM    PDEUSER+D3,BADBOUND      IS FIRST ADDRESS FOR HALF-WORD  18550002
*                                       BOUNDARY                        18560002
         BO    BNDMSG2                  NO, PUT OUT MESSAGE             18570002
         MVI   PDEUSER,PDECONVD         FLAG PDE AS CONVERTED           18580002
         B     EXITOK                   RETURN TO PARSE                 18590002
         SPACE                                                          18600002
MOVEADR  DS    0H                       FIRST CONVERTED ADDRESS IN      18610002
*                                       SI BLOCK                        18620002
         L     R5,PDEUSER               R5=ADDRESS OF SI BLOCK          18630002
         L     R5,D0(R5)                R5=CONVERTED ADDRESS            18640002
         ST    R5,PDEUSER               STORE IN FIRST USERWORD         18650002
         B     CHKUSER2                 CHECK FOR CONVERTED ADDRESS IN  18660002
*                                       SECOND USERWORD                 18670002
         SPACE                                                          18680002
*********************************************************************** 18682002
*        ONE OF THE ADDRESSES IN A RANGE IS IN WRITE-PROTECTED CORE.  * 18684002
*        ISSUE MESSAGE, SET RETURN CODE TO 8, AND RETURN TO PARSE.    * 18686002
*********************************************************************** 18688002
RANGPROT DS    0H                       WRITE PROTECTED RANGE           18688402
         LA    R1,MSG3       R1=ADDR OF MESSAGE NUMBERS                 18688802
         B     SETADDR                  ADD STRING TO MESSAGE           18689602
         SPACE                                                          18689702
*********************************************************************** 18690002
*        FIRST ADDRESS OF RANGE NOT ON HALFWORD BOUNDARY. ISSUE       * 18700002
*        MESSAGE, SET RC = 8, AND RETURN.                             * 18710002
*********************************************************************** 18720002
BNDMSG2  DS    0H                       FIRST ADDRESS OF RANGE NOT      18730002
*                                       ON HALF-WORD BOUNDARY           18740002
         LA    R1,MSG1       R1=ADDR OF MESSAGE NUMBERS                 18750002
         B     BNDMSG1       GO OUTPUT MESSAGES                         18760002
         SPACE                                                          18780002
*********************************************************************** 18790002
*        MOVE SECOND ADDRESS OF RANGE INTO PDE2USER FIELD.            * 18800002
*********************************************************************** 18810002
MOVADDR2 DS    0H                       SECOND CONVERTED ADDRESS IN     18820002
*                                       SI BLOCK                        18830002
         L     R5,PDE2USER              R5=ADDRESS OF SI BLOCK          18840002
         L     R5,D0(R5)                R5=CONVERTED ADDRESS            18850002
         ST    R5,PDE2USER              STORE IN SECOND USERWORD        18860002
         B     COMPUSER                 COMPARE ADDRESSES               18870002
         SPACE                                                          18880002
*********************************************************************** 18890002
*        FIRST ADDRESS IN RANGE IS HIGHER THAN SECOND ADDRESS.        * 18900002
*        ISSUE MESSAGE, SET RC = 8, AND RETURN TO PARSE.              * 18910002
*********************************************************************** 18920002
FIRSTHI  DS    0H                       PREPARE TO WRITE MESSAGE FOR    18930002
*                                       FIRST ADDRESS EXCEEDS SECOND    18940002
         LA    R1,MSG4       R1=ADDR OF MESSAGE NUMBERS                 18950002
         B     SETADDR                  ADD ADDRESS STRING TO MSG       18970002
         EJECT                                                          18980002
*********************************************************************** 18990002
* THIS SECTION RECEIVES CONTROL FROM IKJPARS ONCE IKJPARS HAS SCANNED * 19000002
* A PARENTHESIZED STRING (KNOWN AS THE SUB-COMMAND CHAIN) AND HAS     * 19010002
* DETERMINED THAT IT IS SYNTACTICALLY CORRECT.  FURTHER VALIDITY      * 19020002
* CHECKING OF THE SUB-COMMAND CHAIN IS PERFORMED.  IF THE SUB-COMMAND * 19030002
* CHAIN IS FOUND TO BE UNACCEPTABLE, A MESSAGE IS ISSUED TO THE USER  * 19040002
* BEFORE CONTROL IS RETURNED TO IKJPARS.                              * 19050002
*********************************************************************** 19060002
AT1SUBVC DS    0H                       SUB-COMMAND VALIDITY CHECK      19070002
         SAVE (14,12),,AT1SUBVC         SAVE IKJPARS' REGISTERS         19080002
         L     R5,D4(R1)                R5=ADDR OF AT'S SAVE AREA       19090002
         LA    R7,D8(R1)                R7=POINTER TO PARSE'S PARM      19100002
*                                       FOR SECOND LEVEL MSG            19110002
         L     R12,GR12-SAVEAREA(R5)    ESTABLISH ADDRESSABILITY WITH   19120002
*                                       MAINLINE OF AT                  19130002
         L     R9,GR9-SAVEAREA(R5)      R9=ADDR OF TCOMTAB              19140002
         L     R6,REGSAVE3              R6=ADDR OF EXIT'S SAVE AREA     19150002
         ST    R13,SAVELAST-SAVEAREA(R6)  SAVE ADDRESS OF PARSE'S SAVE  19160002
*                                       AREA                            19170002
         ST    R6,SAVENEXT-SAVEAREA(R13)  SAVE ADDRESS OF EXIT'S SAVE   19180002
*                                       AREA IN PARSE'S SAVE AREA       19190002
         LR    R13,R6                   R13=ADDR OF EXIT'S SAVE AREA    19200002
         L     R10,WORKAREA             R10=ADDRESS OF COMMON WORKAREA  19210002
         OI    TSTFLGS4,TSTVALCK TURN ON VALIDITY CHECK BIT             19212002
         L     R4,OUTBUF     R4=ADDR OF OUTBUF                          19214002
         XC    D0(L4,R4),D0(R4) ZERO FIRST WORD OF OUTBUF               19216002
         SPACE                                                          19220002
*********************************************************************** 19230002
* THIS EXIT CHECKS THE LENGTH OF THE SUBCOMMAND STRING FOR A MAXIMUM  * 19240002
* OF 255.  IF IT IS GREATER A MESSAGE IS ISSUED.                      * 19250002
*********************************************************************** 19260002
         SPACE                                                          19270002
         L     R6,D0(R1)                R6=ADDR OF SUB-COMMAND PDE      19280002
         LA    R4,MAXLEN                R4=255                          19290002
         CH    R4,EXPRLNH-EXPRPDE(R6)   IS LENGTH GREATER THAN 255      19300002
         BL    TOOLONG                  YES, PUT OUT ERROR MESSAGE      19310002
         B     EXITOK                   LENGTH OK, RETURN TO IKJPARS    19320002
         SPACE                                                          19330002
*********************************************************************** 19340002
*        SUBCOMMAND CHAIN TOO LONG. ISSUE MESSAGE, SET RC = 8, AND    * 19350002
*        RETURN TO PARSE.                                             * 19360002
*********************************************************************** 19370002
TOOLONG  DS    0H                       PREPARE TO PUT OUT MESSAGE FOR  19380002
*                                       SUB-COMMAND CHAIN LENGTH        19390002
*                                       EXCEEDS 255                     19400002
         XC    TSTIOPRM(L'TSTIOPRM),TSTIOPRM CLEAR IO PARM LIST         19512002
* ISSUE 'COMMAND CHAIN TO LONG' MESSAGE                                 19514002
* ISSUE 'COMMAND CHAIN LENGTH MAY NOT EXCEED 255 BYTES' MESSAGE         19516002
         IKJEGSIO MSG,FIRST=M0035,SECOND=M0243,ID=AT004,MF=(E,TSTIOPRM) 19522002
         BAL   R5,IORC3      TEST IO RC'S                               19532002
         B     EXIT8A        RETURN TO PARSE                            19534002
         EJECT                                                          19540002
*********************************************************************** 19550002
* THIS SECTION RECEIVES CONTROL FROM IKJPARS ONCE IKJPARS HAS SCANNED * 19560002
* THE KEYWORD COUNT AND ITS SUBFIELD INTEGER AND HAS DETERMINED THAT  * 19570002
* IT IS SYNTACTICALLY CORRECT.  FURTHER VALIDITY CHECKING OF THE      * 19580002
* INTEGER IS PERFORMED.  IF THE INTEGER IS FOUND TO BE UNACCEPTABLE,  * 19590002
* A MESSAGE IS ISSUED TO THE USER BEFORE CONTROL IS RETURNED TO PARSE.* 19600002
*********************************************************************** 19610002
AT1CTVC  DS    0H                       VALIDITY CHECK FOR COUNT        19620002
         SAVE  (14,12),,AT1CTVC         SAVE IKJPARS' REGISTERS         19630002
         L     R5,D4(R1)                R5=ADDR OF AT'S SAVE AREA       19640002
         L     R12,GR12-SAVEAREA(R5)    ESTABLISH ADDRESSABILITY WITH   19650002
*                                       MAINLINE OF AT                  19660002
         L     R9,GR9-SAVEAREA(R5)      R5=ADDR OF TCOMTAB              19670002
         L     R6,REGSAVE3              R6=ADDR OF EXIT'S SAVE AREA     19680002
         ST    R13,SAVELAST-SAVEAREA(R6)  SAVE ADDRESS OF PARSE'S SAVE  19690002
*                                       AREA                            19700002
         ST    R6,SAVENEXT-SAVEAREA(R13)  SAVE ADDRESS OF EXIT'S SAVE   19710002
*                                       AREA IN PARSE'S SAVE AREA       19720002
         LR    R13,R6                   R13=ADDR OF EXIT'S SAVE AREA    19730002
         L     R10,WORKAREA             R10=ADDRESS OF COMMON WORKAREA  19740002
         LA    R7,D8(R1)                R7=POINTER TO PARSE'S PARM      19750002
*                                       FOR SECOND LEVEL MSG            19760002
         OI    TSTFLGS4,TSTVALCK TURN ON VALIDITY CHECK BIT             19762002
         L     R4,OUTBUF     R4=ADDR OF OUTBUF                          19764002
         XC    D0(L4,R4),D0(R4) ZERO FIRST WORD OF OUTBUF               19766002
         SPACE                                                          19770002
*********************************************************************** 19780002
*        USE IKJEGCVT TO CONVERT COUNT TO BINARY.                     * 19790002
*********************************************************************** 19800002
         L     R1,D0(R1)                R1=ADDR OF COUNT PDE            19810002
         LR    R11,R1        SAVE ADDRESS OF PDE                        19812002
         SR    R0,R0                    ZERO REGISTER - CONVERT TO      19820002
*                                       BINARY                          19830002
         MVI   IDENTCVT-IDENTPDE(R1),FCODE  MOVE IN TYPE CODE FOR       19840002
*                                       IKJEGCVT                        19850002
         L     R15,TSTCONVT             R15=EP OF IKJEGCVT              19860002
         BALR  R14,R15                  CONVERT COUNT TO BINARY         19870002
         LTR   R15,R15                  WAS CONVERT SUCCESSFUL          19880002
         BNZ   NOTCONV(R15)             NO, ATTENTION SCHEDULED         19890002
         SPACE                                                          19900002
*********************************************************************** 19910002
*        INSURE THAT COUNT IS LESS THAN OR EQUAL TO MAXIMUM. IF NOT,  * 19920002
*        ISSUE MESSAGE, SET RC = 8, AND RETURN TO PARSE. IF IT        * 19930002
*        IS OK, SET COUNT TO ZERO IF THE COUNT IS ZERO,               * 19940002
*        OR TO ONE LESS THAN THE COUNT IF IT IS GREATER THAN ONE,     * 19950002
*        SET RETURN CODE TO 0 AND RETURN.                             * 19960002
*********************************************************************** 19970002
         L     R4,CONAREA               R4=ADDRESS OF PLACE WHERE       19980002
*                                       CONVERT RETURNS NUMBER          19990002
         USING CONBYTE,R4               GET ADDRESSABILITY TO CONAREA   20000002
         L     R5,COUNTMAX              R5=MAXIMUM COUNT                20010002
         L     R6,CONCOUNT              R6=COUNT GIVEN                  20020002
         LTR   R6,R6                    IS COUNT = ZERO                 20030002
         BZ    EXITOK                   YES, RETURN TO PARSE            20040002
         CLR   R6,R5                    IS COUNT GREATER THAN 65535     20050002
         BH    BADCOUNT                 YES, PUT OUT ERROR MESSAGE      20060002
         BCTR  R6,ZERO                  DECREMENT BY ONE                20070002
         ST    R6,CONCOUNT              STORE BACK IN COUNT AREA        20080002
         B     EXITOK                   COUNT OK - RETURN TO PARSE      20090002
         SPACE                                                          20100002
BADCOUNT DS    0H                       PUT OUT MESSAGE FOR COUNT       20110002
*                                       EXCEEDS MAXIMUM                 20120002
         XC    TSTIOPRM(L'TSTIOPRM),TSTIOPRM CLEAR IO PARM LIST         20170002
* ISSUE 'INVALID COUNT NNNNNN' MESSAGE                                  20180002
* ISSUE 'COUNT MUST BE BETWEEN 0 AND 65535' MESSAGE                     20190002
         IKJEGSIO MSG,FIRST=M0036,INST11=(VPDE,(R11)),SECOND=M0299,    *20220002
               ID=AT004,MF=(E,TSTIOPRM)                                 20270002
         BAL   R5,IORC3      TEST IO RC'S                               20272002
         B     EXIT8A        RETURN TO PARSE                            20274002
         DROP  R4                                                       20280002
         EJECT                                                          20282002
*********************************************************************   20284002
*  COMMON IO MACRO FORMS                                                20286002
*********************************************************************   20288002
IOTYPE1  DS    0H                                                       20288402
         XC    TSTIOPRM(L'TSTIOPRM),TSTIOPRM CLEAR IO PARM LIST         20288802
         IKJEGSIO MSG,FIRST=M0103,ID=AT004,MF=(E,TSTIOPRM)              20289202
         BR    R5            RETURN TO CALLER                           20289602
IOTYPE2  DS    0H                                                       20289702
         STM   R2,R3,SAVE2345 SAVE R2-3 FOR REUSE                       20289802
         LM    R2,R3,D0(R1)  LOAD R2-3 WITH MESSAGE NUMBERS             20289902
         XC    TSTIOPRM(L'TSTIOPRM),TSTIOPRM CLEAR IO APRM LIST         20293202
         IKJEGSIO MSG,FIRST=(R2),INST11=(APDE,(R11)),SECOND=(R3),      *20295202
               INST21=(NUM,I0002),ID=AT004,MF=(E,TSTIOPRM)              20295602
         LM    R2,R3,SAVE2345 RESET R2-3                                20296002
         BR    R5            RETURN TO CALLER                           20296402
IOTYPE3  DS    0H                                                       20296502
         STM   R2,R3,SAVE2345 SAVE R2-3 FOR REUSE                       20296602
         LM    R2,R3,D0(R1)  LOAD R2-3 WITH MESSAGE NUMBERS             20299902
         XC    TSTIOPRM(L'TSTIOPRM),TSTIOPRM CLEAR IO PARM LIST         20301902
         IKJEGSIO MSG,FIRST=(R2),INST11=(APDE,(R11)),SECOND=(R3),      *20302302
               ID=AT004,MF=(E,TSTIOPRM)                                 20302702
         LM    R2,R3,SAVE2345 RESET R2-3                                20303102
         BR    R5            RETURN TO CALLER                           20303202
GETFREIO EQU   *                                                        20304802
         ST    R2,SAVE2345   SAVE R2 FOR REUSE                          20306802
         LR    R2,R1         R2=SVC NUMBER                              20307202
         XC    TSTIOPRM(L'TSTIOPRM),TSTIOPRM CLEAR IO PARM LIST         20307602
         IKJEGSIO SVCERR,SVC=(R2),RC=(R15),ID=AT004,MF=(E,TSTIOPRM)     20308002
         L     R2,SAVE2345   RESET R2                                   20308402
         BR    R5            RETURN TO CALLER                           20308502
*********************************************************************   20308802
*  COMMON IO RETURN CODE CHECKS                                         20310402
*********************************************************************   20313302
IORC1    DS    0H                                                       20317802
         OI    TSTFLGS4,TSTFLUSH HAVE MNL FLUSH INPUT STACK             20319802
         C     R15,ATTNCODE  IS RETURN CODE=16,20,OR 24?                20319902
         BNL   RETMAIN       SEND IT TO MAINLINE                        20322702
         XR    R15,R15       CLEAR RETURN CODE AND CONTINUE             20324702
         BR    R5            RETURN TO CALLER                           20325102
IORC2    DS    0H                                                       20325902
         C     R15,ATTNCODE  IS RETURN CODE 16,20 OR 24?                20326402
         BNL   RETURNRC      YES, GO RETURN THE CODE                    20328002
         XR    R15,R15       CLEAR RETURN CODE AND CONTINUE             20329602
         BR    R5            RETURN TO CALLER                           20331202
IORC3    DS    0H                                                       20334402
         LTR   R15,R15       TEST FOR ZERO RETURN CODE                  20336002
         BZ    D0(R5)        ZERO, RETURN TO CALLER                     20337602
         C     R15,ATTNCODE  IS RETURN CODE 16                          20339202
         BE    EXIT12        YES,GO END PARSE                           20340802
         OI    TSTFLGS4,TSTFLUSH HAVE MAINLINE FLUSH INPUT STACK        20344002
         C     R15,ATTNCODE  IS RETURN CODE 20 OR 24?                   20344402
         BH    EXIT12        YES, END PARSE                             20344802
         XR    R15,R15       ZERO RETURN CODE                           20345202
         B     EXIT12        END PARSE                                  20347202
         EJECT                                                          20348802
*********************************************************************** 20350402
*                                                                     * 20352002
*        CONSTANTS USED IN THE CODE                                   * 20353602
*                                                                     * 20355202
*********************************************************************** 20356802
         SPACE 2                                                        20358402
*********************************************************************** 20360002
*        LIST FORMS OF XCTL MACRO USED.                               * 20370002
*********************************************************************** 20380002
XLIST    DS    0F                       LIST FORM OF XCTL MACRO         20420002
         XCTL  EP=IKJEGATD,SF=L         LIST FORM                       20430002
XCTLEN   EQU  *-XLIST                   LENGTH OF LIST FORM OF MACRO    20440002
         SPACE                                                          20450002
*********************************************************************** 20460002
*        INITIALIZATION CONSTANTS FOR BRKINSTR FIELD                  * 20470002
*        OF BRKELEM                                                   * 20480002
*********************************************************************** 20490002
INITCON  DS    0H                                                       20500002
         NOPR  R1                       PADDING NOP.                    20510002
         NOPR  R1                       PADDING NOP.                    20520002
RSVC     SVC   TESTSVC                  BREAKPOINT SVC.                 20530002
         SPACE                                                          20532002
**********************************************************************  20534002
*  MESSAGE NUMBER CONSTANTS                                             20536002
*       EACH MESSAGE NUMBER AREA HAS THE FOLLOWING FORMAT               20538002
*        WORD1-NUMBER OF FIRST LEVEL MESSAGE                            20538402
*        WORD2-NUMBER OF SECOND LEVEL MESSAGE(ZERO OF NO MESSAGE)       20538802
**********************************************************************  20539602
MSG1     DC    F'73'         INVALID ADDRESS RANGE                      20539702
         DC    F'280'        HALF WORD BOUNDARY REQUIRED                20539802
MSG2     DC    F'101'        INVALID ADDRESS                            20539902
         DC    F'279'        ADDRESS WRITE PROTECTED                    20543202
MSG3     DC    F'73'         INVALID ADDRESS RANGE                      20545202
         DC    F'242'        PART OF RANGE WRITE PROTECTED              20545602
MSG4     DC    F'73'         INVALID ADDRESS RANGE                      20546002
         DC    F'207'        FIRST ADDR MUST NOT BE HIGHER THAN LAST    20546402
MSG5     DC    F'101'        INVALID ADDRESS                            20546502
         DC    F'280'        HALF WORD BOUNDARY REQUIRED                20546602
MSG6     DC    F'101'        INVALID ADDRESS                            20549902
         DC    F'274'        REG. NOTATION MUST BE INDIR.GEN.REG.       20552002
MSG7     DC    F'101'        INVALID ADDRESS                            20552402
         DC    F'281'        SYMBOL LENGTH EXCEEDS 8 CHARS.             20552802
MSG8     DC    F'73'         INVALID ADDRESS RANGE                      20553202
         DC    F'274'        REG. NOTATION MUST BE INDIR.GEN.REG.       20553302
MSG9     DC    F'73'         INVALID ADDRESS RANGE                      20556602
         DC    F'281'        SYMBOL LENGTH EXCEEDS 8 CHARS.             20563302
MSG10    DC    F'38'         NO BRKPT ESTABLISHED AT                    20565302
         DC    F'244'        BAD OP CODE                                20565702
         SPACE                                                          20566802
*********************************************************************** 20570102
*        MISCELLANEOUS CONSTANTS                                      * 20573402
*********************************************************************** 20576702
MAXLEN2  DC    AL2(BRKLEN+100)          MAXIMUM LENGTH FOR BREAK ELE-   20580002
*                                       MENT AND ADDRESS STRING         20590002
SYMBLLNH DC    H'8'                     MAXIMUM LENGTH OF A             20600002
*                                       VALID SYMBOL                    20610002
         DS    0F                       ALIGN SP1 AND DBLBND TO WORD    20620002
DBLBND   DC    X'FFFFFFF8'              MASK FOR ROUNDING TO DBL BOUND  20640002
RETRYA   DC    A(RETRY)                 ADDRESS OF RETRY ROUTINE        20650002
RETRYA1  EQU   RETRYA+1                 SECOND BYTE OF RETRYA           20660002
PCLISTA  DC    V(IKJEGAPL)              ADDRESS OF PCL                  20680002
ATTNCODE DC    F'16'         RETURN CODE=ATTENTION IN PROCESS           20682002
COUNTMAX DC    X'0000FFFF'              MAXIMUM COUNT INTEGER - 65535   20690002
TABLE    DC    C'0123456789ABCDEF'      TRANSLATE TABLE                 20700002
ATSPL    IKJEGSPL RTRY=RETRY,ABNTB=ABENDTAB,MODNM=IKJEGAT,TNM=AT        20702002
ABENDTAB DS    0F                       TABLE FOR ABEND MESSAGES        20710002
*                                       FULLWORD ALIGNMENT              20720002
         DC    AL1(97)                  CODE FOR PROTECTION CHECK       20722002
         DC    AL3(BLOW12)              RESUME ADDRESS FOLLOWING        20724002
*                                       PROTECTION CHECK                20726002
         DC    AL1(97)                  CODE FOR PROTECTION CHECK       20726402
         DC    AL3(BLOW14)              RESUME ADDRESS FOLLOWING        20726802
*                                       PROTECTION CHECK                20727202
         DC    AL1(97)                  CODE FOR PROTECTION CHECK       20727602
         DC    AL3(BLOW16)              RESUME ADDRESS FOLLOWING        20727702
*                                       PROTECTION CHECK                20727802
         DC    AL1(97)                  CODE FOR PROTECTION CHECK       20728002
         DC    AL3(BLOWTWO)             RESUME ADDRESS FOLLOWING        20728402
*                                       PROTECTION CHECK                20728802
         DC    AL1(97)                  CODE FOR PROTECTION CHECK       20729202
         DC    AL3(BLOWFOUR)            RESUME ADDRESS FOLLOWING        20729602
*                                       PROTECTION CHECK                20729702
         DC    AL1(97)                  CODE FOR PROTECTION CHECK       20729802
         DC    AL3(BLOWSIX)             RESUME ADDRESS FOLLOWING        20729902
*                                       PROTECTION CHECK                20733202
         DC    AL1(92)                  CODE FOR INSUFFICIENT STORAGE   20736702
         DC    AL3(BLOW2)               RESUME ADDRESS FOLLOWING        20740002
*                                       INITIAL GETMAIN                 20750002
         DC    AL1(92)                  CODE FOR INSUFFICIENT STORAGE   20760002
         DC    AL3(BLOW4)               RESUME ADDRESS FOLLOWING        20770002
*                                       ADDITIONAL BREAK ELEMENT        20780002
*                                       GETMAIN                         20790002
         DC    AL1(99)                  CODE FOR LINK FAILED            20800002
         DC    AL3(BLOW5)               RESUME ADDRESS FOLLOWING LINK   20810002
*                                       TO IKJPARS                      20820002
         DC    AL1(97)                  CODE FOR PROTECTION CHECK       20822002
         DC    AL3(TSTLNH1)             ADDRESS PRECEDING INSTRUCTION   20824002
*                                       LENGTH CHECK                    20826002
         DC    AL1(97)                  CODE FOR PROTECTION CHECK       20828002
         DC    AL3(TSTLNH2)             ADDRESS FOLLOWING INSTRUCTION   20828402
*                                       LENGTH CHECK                    20828802
         DC    AL1(97)                  CODE FOR PROTECTION CHECK       20829202
         DC    AL3(CHEKTWO)             ADDRESS PRECEDING CHECK         20829602
*                                       FOR TWO BYTE INSTRUCTION        20829702
         DC    AL1(97)                  CODE FOR PROTECTION CHECK       20829802
         DC    AL3(CHEKSIX)             ADDRESS PRECEDING CHECK         20829902
*                                       FOR SIX BYTE INSTRUCTION        20833202
         DC    AL1(97)                  CODE FOR PROTECTION CHECK       20835202
         DC    AL3(CHEKFOUR)            ADDRESS PRECEDING CHECK         20835602
*                                       FOR FOUR BYTE INSTRUCTION       20836002
         DC    X'FF'                    END OF TABLE                    20836702
         EJECT                                                          22500002
*********************************************************************** 22510002
*        PARSE MACROS DESCRIBING COMMAND INPUT                        * 22520002
*********************************************************************** 22530002
IKJEGAPL IKJPARM DSECT=IKJPARMD                                         22540002
ADDR     IKJPOSIT ADDRESS,LIST,RANGE,                                  *22550002
               PROMPT='ADDRESS POSITIONAL PARAMETER',VALIDCK=AT1ADDVC   22560002
SBCMDCHN IKJPOSIT PSTRING,VALIDCK=AT1SUBVC                              22570002
COUNT    IKJKEYWD                                                       22580002
         IKJNAME 'COUNT',SUBFLD=INTEGER                                 22590002
NONOT    IKJKEYWD DEFAULT='NOTIFY'                                      22600002
         IKJNAME 'NOTIFY'                                               22610002
         IKJNAME 'NONOTIFY'                                             22620002
DEFER    IKJKEYWD DEFAULT='NODEFER'                                     22630002
         IKJNAME 'NODEFER'                                              22640002
         IKJNAME 'DEFER'                                                22650002
INTEGER  IKJSUBF                                                        22660002
NUMBER   IKJIDENT 'INTEGER',FIRST=NUMERIC,OTHER=NUMERIC,MAXLNTH=5,     *22670002
               PROMPT='INTEGER',VALIDCK=AT1CTVC                         22680002
         IKJENDP                                                        22690002
         EJECT                                                          22700002
         IKJPPL                                                         22710002
PPLEND   EQU   *                        END OF PPL                      22720002
         EJECT                                                          22730002
TCB      IKJTCB                         TCB EXPANSION                   22740002
         EJECT                                                          22750002
CVT      DSECT                                                          22760002
         CVT                                                            22770002
         EJECT                                                          22780002
         IKJPARMA                       ADDRESS PDE DSECT               22790002
         EJECT                                                          22800002
*********************************************************************** 22812002
*                                                                     * 22814002
*        MAPPING DSECT FOR PDES FOR IDENT-TYPE DATA                   * 22816002
*                                                                     * 22818002
*********************************************************************** 22818402
IDENTPDE DSECT                                                          22818802
IDENTPTR DS    F -                      POINTER TO CHARACTER STIRNG,    22819202
*                                       OR ZERO IF NOT PRESENT          22819602
IDENTLNH DS    H -                      LENGTH OF CHARACTER STRING      22819702
IDENTFLG DS    XL1 -                    FLAGS                           22819802
IDENTBIT EQU   B'10000000' -            BIT ON MEANS STRING PRESENT     22819902
IDENTCVT DS    XL1 -                    RESERVED                        22823202
IDENTPDL EQU   *-IDENTPDE -             LENGTH OF IDENT PDE             22825202
*********************************************************************** 22828702
*                                                                     * 22829102
*        MAPPING DSECT FOR PDES FOR EXPRESSIONS                       * 22829502
*                                                                     * 22829902
*********************************************************************** 22833202
EXPRPDE  DSECT                                                          22835202
EXPRPTR  DS    F -                      POINTER TO CHARACTER STRING,    22835602
*                                       OR ZERO IF NOT PRESENT          22836002
EXPRLNH  DS    H -                      LENGTH OF CHARACTER STRING      22836402
         DS    H -                      RESERVED                        22836502
EXPRFLGS DS    XL1 -                    FLAGS                           22836602
EXPRDEC  EQU   X'04' -                  DECIMAL EXPRESSION FLAG         22839902
EXPRHEX  EQU   X'02' -                  HEX EXPRESSION FLAG             22841902
EXPRSIGN DS    CL1 -                    ARITHMETIC SIGN OR ZERO         22842302
EXPRINDC DS    H -                      INDIRECT COUNT                  22842702
EXPRCHAI DS    F -                      POINTER TO NEXT EXPRESSION      22843102
*                                       PDE OR ZERO                     22843202
EXPRPDL  EQU   *-EXPRPDE -              LENGTH OF EXPRESSION PDE        22843302
         EJECT                                                          22843402
         BRKELEM                        BREAK ELEMENT DSECT.            22846702
         EJECT                                                          22850002
         IKJEGDME                       DEFERED MODULE ELEMENT DSECT    22860002
         SPACE 2                                                        22870002
         IKJEGDBE                       DEFERED BREAK ELEMENT DSECT     22880002
         EJECT                                                          22890002
SAVEAREA DSECT                                                          22902002
SAVEUSER DS    F                        UNUSED                          22904002
SAVELAST DS    F                        PTR TO LAST SAVEAREA (CALLER'S) 22906002
SAVENEXT DS    F                        PTR TO NEXT SAVEAREA (SUBRTN)   22908002
RETURNPT DS    F                        PTR TO CALLER'S RESUME ADDRESS  22908402
ENTRYPT  DS    F                        PTR TO MY ENTRY POINT           22908802
GR0      DS    F                        GENERAL REGISTER 0              22909202
GR1      DS    F                        GENERAL REGISTER 1              22909602
GR2      DS    F                        GENERAL REGISTER 2              22909702
GR3      DS    F                        GENERAL REGISTER 3              22909802
GR4      DS    F                        GENERAL REGISTER 4              22909902
GR5      DS    F                        GENERAL REGISTER 5              22913202
GR6      DS    F                        GENERAL REGISTER 6              22915202
GR7      DS    F                        GENERAL REGISTER 7              22915602
GR8      DS    F                        GENERAL REGISTER 8              22916002
GR9      DS    F                        GENERAL REGISTER 9              22916402
GR10     DS    F                        GENERAL REGISTER 10             22916502
GR11     DS    F                        GENERAL REGISTER 11             22916602
GR12     DS    F                        GENERAL REGISTER 12             22919902
LSAVE    EQU   *-SAVEAREA               LENGTH OF SAVEAREA              22921902
         EJECT                                                          22923402
         TCOMTAB                        COMMUNICATIONS TABLE DSECT      22926702
         EJECT                                                          22930002
         TSTCWORK                       DSECT FOR WORKAREA              22940002
         ORG   CWORKCMD                 GO BACK TO COMMAND WORKAREA     22950002
         SPACE                                                          22970002
WORKSP   DS    0H                                                       22980002
         SPACE                                                          22990002
*********************************************************************** 22993302
*                                                                     * 22995302
*        THIS IS A MAPPING OF THE AREA CALLED CWORKCMD IN TSTCWORK.   * 22995702
*        WHEN AT IS ENTERED TO ACTIVATE DEFERED BREAKPOINTS, THE      * 22996102
*        FIRST 8 CHARACTERS OF THE WORK AREA CONTAIN THE NAME OF THE  * 22996502
*        NEWLY LOADED MODULE. THE NINTH BYTE CONTAINS A FLAG WHICH    * 22996602
*        INDICATES WHETHER OR NOT THE MODULE IS IN OVERLAY. THE       * 22996702
*        LAST 64 BYTES OF THE WORK AREA ARE RESERVED FOR A REGISTER   * 22997802
*        SAVE AREA FOR IKJEGLDF IN THIS CASE.                         * 22999802
*        IF ANY CHANGES ARE MADE TO THE WORK AREA, MAKE THE           * 22999902
*        SAME CHANGES TO IKJEGATD. BOTH MODULES USE THE SAME FORMAT   * 23001902
*        OF WORK AREA.                                                * 23002402
*********************************************************************** 23002702
PDLADDR  DS    A -                      ADDRESS OF PDL BEING            23004702
*                                       PROCESSED BY AT WHEN            23005102
*                                       ACTIVATING DEFERED BREAKPOINTS  23005502
PARSECD  EQU   PDLADDR -                NONZERO SERVICE ROUTINE         23005902
*                                       RETURN CODES SENT TO VALIDITY   23006102
*                                       CHECK ROUTINES ARE STORED HERE  23006502
BYTENUMB DS    F -                      SAVE AREA FOR NUMBER OF BYTES   23006602
*                                       LAST GOTTEN                     23007402
SAVEPTR  DS    A -                      POINTER TO PREVIOUS BREAK       23007802
*                                       ELEMENT LINK FIELD              23008202
CHNADDR  DS    A -                      ADDRESS OF SUBCOMMAND CHAIN     23008602
*                                       FOR BREAKPOINT(S) BEING BUILT   23009002
STAEL    DS    CL16                     ESTAE PARM LIST AREA            23013702
STRNGADR DS    A -                      ADDRESS OF ADDRESS STRING       23014102
*                                       FOR RANGE BEING PROCESSED       23014202
         DS    0F                                                       23014302
PARMS    DS    (PPLEND-PPL)X -          PPL IS BUILT HERE               23015002
         ORG   PARMS                                                    23015402
BRKSAVE  DS    18F -                    SAVE AREA FOR BREAKRTN          23015802
SAVE2345 DS    4F            SAVE AREA FOR R2-5 USED DURING IO          23015902
         ORG   STRNGADR                                                 23016202
PDEADDR  DS    A -                      ADDRESS OF FIRST ADDRESS PDE    23016302
*                                       IN PDL - PASSED AS PARM         23016402
         ORG   WORKSP                                                   23016602
LOADNAME DS    CL8 -                    LOAD NAME OF NEWLY LOADED MOD.  23016702
*                                       FOR WHICH DEFERED BREAK-        23016802
*                                       POINTS MAY BE ACTIVATED, OR     23016902
*                                       LOAD NAME FOR WHICH DEFERED     23017502
*                                       BREAKPOINTS ARE TO BE BUILT     23017902
LOADATTR EQU   * -                      ONE BYTE FLAG INDICATING        23018302
*                                       OVERLAY STATUS FOR NEWLY        23018702
*                                       LOADED MODULE                   23018902
GETCORE  GETMAIN   EC,SP=1,MF=L -       LIST FORM OF GETMAIN            23019302
ADDRCORE EQU   GETCORE+4 -              SECOND WORD OF LIST FORM        23021602
*                                       CONTAINS ADDRESS OF CORE        23023602
         ORG   WORKSP                                                   23023702
XCTLL    XCTL  EP=IKJEGATD,SF=L -       LIST FORM OF XCTL               23023802
         ORG   STAEL                    OVERLAY STAE CONTROL BLOCK      23024102
SRHPARMS DS    0H                       BRKELEM REMOVAL ROUTINE'S       23024502
*                                       PARM LIST                       23024602
SRHFLAGS DC    F'0'                     FLAGS - 0 TO REMOVE BRKELEM     23024702
SRHADDR1 DS    A                        ADDRESS OF BRKPOINT FOR         23025302
*                                       BRKELEM TO BE REMOVED           23025702
SRHADDR2 DS    A                        SECOND ADDRESS OF RANGE OR 0    23026102
SRHPRMLH EQU   *-SRHPARMS               LENGTH OF SRH PARM LIST         23026502
         EJECT                                                          23026802
*********************************************************************** 23027402
*        THIS WEIRD DSECT DESCRIBES THE CONAREA WHERE CVT RETURNS     * 23028502
*        THE BINARY VALUE TRANSLATED FROM THE IDENT PDE FOR THE       * 23030802
*        COUNT. THE FIRST BYTE CONTAINS THE LENGTH OF THE BINARY      * 23033102
*        VALUE - IN THIS CASE IT ALWAYS CONTAINS A FOUR - AND THE     * 23035402
*        NEXT FOUR BYTES, WHICH ARE ALIGNED ON A WORD BOUNDARY,       * 23037702
*        CONTAIN THE BINARY VALUE.                                    * 23040002
*********************************************************************** 23050002
CONPLACE DSECT                          DSECT FOR CONAREA               23060002
         DS    D                        ALIGNMENT                       23070002
         ORG   *-ONE                    BACK UP ONE                     23080002
CONBYTE  DS    X                        LENGTH OF COUNT (FOUR)          23090002
CONCOUNT DS    F                        BINARY COUNT                    23100002
         SPACE                                                          23110002
         EJECT                                                          23112002
IKJEGAT  CSECT                                                          23114002
         DS    0F            FORCE FULLWORD ALIGNMENT                   23116002
ATPATCH  DC    50C'Z'        PATCH AREA                                 23118002
         END                                                            23120002
