         TITLE 'IKJEGLDF, LOAD, DELETE, FREEMAIN, AND GETMAIN SUBCMNDS' 00050002
         COPY  IKJEGSIO                                                 00052002
IKJEGLDF CSECT                                                          00060002
*C127000,C151500,A151600                                        YA00064 00070002
*C529000                                                       @YM07111 00080002
*********************************************************************** 00100002
*                                                                     * 00150002
* STATUS --                                                           * 00200002
*    CHANGE LEVEL 000, VERSION 02, OS/VS2                             * 00250002
*                                                                     * 00260002
* FUNCTION --                                                         * 00300002
*                                                                     * 00350002
*    LOAD SUBCOMMAND RESULTS IN AN ATTEMPT TO LOAD THE SPECIFIED      * 00400002
*    PROGRAM AS IF A LOAD MACRO WERE ISSUED BY THE PROBLEM PROGRAM.   * 00450002
*                                                                     * 00500002
*    DELETE SUBCOMMAND RESULTS IN THE ISSUING OF THE DELETE MACRO     * 00550002
*    IN BEHALF OF THE PROBLEM PROGRAM UNDER TEST.                     * 00600002
*                                                                     * 00650002
*    GETMAIN SUBCOMMAND RESULTS IN AN ATTEMPT TO ACQUIRE THE          * 00700002
*    SPECIFIED NUMBER OF BYTES FROM A USER SPECIFIED SUBPOOL. THE     * 00750002
*    MACRO IS ISSUED UNDER THE PROBLEM PROGRAM TASK                   * 00800002
*                                                                     * 00850002
*    FREEMAIN SUBCOMMAND RESULTS IN AN ATTEMPT TO FREE THE SPECIFIED  * 00900002
*    NUMBER OF BYTES FROM THE SPECIFIED SUBPOOL. THE MACRO IS ISSUED  * 00950002
*    UNDER THE PROBLEM PROGRAM TASK.                                  * 01000002
*                                                                     * 01050002
* ENTRY POINTS --                                                     * 01100002
*         IKJEGLOD IS THE ENTRY POINT FOR LOAD                        * 01150002
*         IKJEGDEL IS THE ENTRY POINT FOR DELETE                      * 01200002
*         IKJEGGET IS THE ENTRY POINT FOR GETMAIN                     * 01250002
*         IKJEGFRE IS THE ENTRY POINT FOR FREEMAIN                    * 01300002
*                                                                     * 01350002
* INPUT -- A POINTER TO TCOMTAB, THE COMMUNICATION TABLE, IS EXPECTED * 01400002
*    IN REGISTER 9  ALL INFORMATION NEEDED CAN BE ACCESSED IN TCOMTAB.* 01450002
*                                                                     * 01500002
* OUTPUT -- A LOAD SUBCOMMAND WILL RESULT IN THE LOADED AT ADDRESS    * 01550002
*    BEING PRINTED TO THE TERMINAL. A GETMAIN WILL RESULT IN THE      * 01600002
*    GETMAIN AREA ADDRESS BEING PRINTED. NEITHER DELETE NOR FREEMAIN  * 01650002
*    PRINT OTHER THAN DIAGNOSTIC MESSAGES.                            * 01700002
*                                                                     * 01750002
* EXTERNAL REFERENCES --                                              * 01800002
*         IKJEGPARS IS ENTERED TO SCAN THE SUBCOMMAND STRING AND      * 01850002
*         CHECK SYNTAX                                                * 01900002
*                                                                     * 01950002
*         IKJEGIO IS ENTERED TO PRINT MESSAGES TO THE TERMINAL        * 02000002
*                                                                     * 02050002
*         IKJEGCVT IS ENTERED IN FREEMAIN VALIDITY CHECK TO CONVERT   * 02100002
*         THE ADDRESS OF THE AREA TO BE FREED.                        * 02150002
*                                                                     * 02200002
* EXITS, NORMAL -- SINCE LOAD, DELETE, GETMAIN AND FREEMAIN ARE       * 02250002
*         ISSUED UNDER THE PROBLEM PROGRAM TCB, RETURN IS             * 02300002
*         ACCOMPLISHED VIA THE ADDRESS IN TSTGO IN TCOMTAB INSTEAD    * 02350002
*         OF THE NORMAL BR R14                                        * 02400002
*                                                                     * 02450002
* EXITS, ERROR -- NONE                                                * 02500002
*                                                                     * 02550002
* TABLES/WORK AREAS --                                                * 02600002
*    A GETMAIN AREA IS USED FOR THE DCB ASSOCIATED WITH THE DATASET   * 02650002
*    SPECIFIED IN THE LOAD SUBCOMMAND.                                * 02700002
*    THE WORKAREA POINTED TO IN TCOMTAB IS USED FOR ALL TEMPORARY     * 02750002
*    STORAGE                                                          * 02800002
*                                                                     * 02850002
* ATTRIBUTES --                                                       * 02900002
*    REFRESHABLE AND REENTRANT                                        * 02950002
*                                                                     * 03000002
* CHARACTER CODE DEPENDENCY --                                        * 03050002
*    REASSEMBLY MAY BE NEEDED FOR CHANGE OF CODE                      * 03100002
* NOTES --                                                            * 03150002
*    R12 IS BASE REG                                                  * 03200002
*    PLM = SY35-0004                                                  * 03210002
*    *     TSO COMMAND PROCESSOR LOGIC                                * 03220002
*    *     VOLUME III - TEST                                          * 03230002
*********************************************************************** 03250002
         ENTRY IKJEGLOD                                                 03350002
         ENTRY IKJEGDEL                                                 03400002
         ENTRY IKJEGGET                                                 03450002
         ENTRY IKJEGFRE                                                 03500002
         USING TCOMTAB,R9     USE REG9 TO ADDRESS TCOMTAB DSECT         03550002
BASELOC  EQU   *             EQUATE LABEL TO THIS ADDRESS               03600002
IKJEGFRE EQU   *             EQUATE ENTRY POINT TO THIS ADDRESS         03650002
FREEMAIN EQU   *             EQUATE FREEMAIN ENTRY TO THIS ADDR         03700002
LOADLOAD SAVE  (14,12),,*    SAVE REGISTERS                             03750002
         USING FREEMAIN,R15  USE REG15 AS BASE STARTING AT FREEMN       03800002
         L     R12,BASE      PLACE START ADDRESS OF PROG IN R12         03850002
         DROP  R15           REMOVE REG15 AS BASE REG                   03900002
         USING BASELOC,R12   USE REG12 AS BASE REG                      03950002
         B     FREEALL       BRANCH TO ROUTINE TO FREEMAIN              04000002
IKJEGDEL EQU   *             EQUATE ENTRY POINT TO THIS ADDRESS         04050002
DELETE   EQU   *             EQUATE DELETE ENTRY PTR TO THIS ADDR       04100002
         SAVE  (14,12)       SAVE REGISTERS                             04150002
         USING DELETE,R15    USE REG15 AS BASE FROM DELETE              04200002
         L     R12,BASE      PLACE START ADDRESS OF PROG IN R12         04250002
         DROP  R15           REMOVE REG15 AS BASE REG                   04300002
         USING BASELOC,R12   USE REG12 AS BASE REG                      04350002
         B     DELETEIT      BRANCH TO ROUTINE TO DELETE PROG           04400002
IKJEGGET EQU   *             EQUATE ENTRY POINT TO THIS ADDRESS         04450002
GETMAIN  EQU   *             EQUATE GETMAIN ENTRY PTR TO THS ADDR       04500002
         SAVE  (14,12)       SAVE REGISTERS                             04550002
         USING GETMAIN,R15   USE REG15 AS BASE START AT GETMAIN         04600002
         L     R12,BASE      PLACE START ADDRESS OF PROG IN R12         04650002
         DROP  R15           REMOVE REG15 AS BASE REG                   04700002
         USING BASELOC,R12   USE REG12 AS BASE REG                      04750002
         B     GETIT         BRANCH TO ROUTINE TO GETMAIN               04800002
IKJEGLOD EQU    *            EQUATE ENTRY POINT TO THIS ADDRESS         04850002
LOAD     EQU   *             EQUATE LOAD ENTRY PTR TO THIS ADDR         04900002
         SAVE  (14,12)       SAVE REGISTERS                             04950002
         USING LOAD,R15      USE REG15 AS BASE WITH LOAD AS START       05000002
         L     R12,BASE      PLACE ADDRESS AT BASE                      05050002
         DROP  R15           DROP REG 15 AS BASE                        05100002
         USING BASELOC,R12   USE REG12 AS BASE START AT BASELOC         05150002
         EJECT                                                          05200002
************************************************************            05250002
** THIS  CODE  WILL LOAD A SPECIFIED PROGRAM INTO CORE    **            05300002
** UNDER PROBLEM PROGRAM TCB. INITIALLY WE SAVE REGISTERS,**            05350002
** ESTABLISH FORWARD AND BACKWARD CHAINING OF REGISTERS & **            05400002
** ESTABLISH A BASE REGISTER FOR PROGRAM ADDRESSABILITY.  **            05450002
************************************************************            05500002
LOADIT   L     R4,REGSAVE2   GET ADDRESS OF MY SAVEAREA FROM TCOM       05550002
         ST    R4,@8(R13)    PLACE MY SAVE AREA INTO CALLER SAVEAREA    05600002
         ST    R13,@4(R4)    PLACE USER SAVE AREA INTO MY SAVE          05650002
         LR    R13,R4        PLACE MY SAVEAREA ADDR INTO R13            05700002
         LA    R10,STAELOAD  ACCESS ADDR OF STAE EXIT TAB               05750002
         L     R5,LOADPARS   PLACE ADDRESS OF PCL INTO REG 5            05800002
         LA    R11,I0023     LOAD-INSERT FOR POSS ERR MSG               05850002
         LA    R6,SPLISTLD   REG 6= ESTAE PARAMETER LIST                05860002
         BAL   R14,STAEPREP  TO EXPAND STAE MACRO + CALL PARSE          05900002
*                            NOTE: LOAD VALIDITY CHECK ROUTINE,         05950002
*                            'LOADVLCK', WILL GET CONTROL FROM PARSE.   06000002
         L     R10,TSTANSPL  PLACE ADDRESS OF PDE FROM PARSE IN R10     06050002
         USING D,R10         ESTABLISH PDL ADDRESSABILITY               06100002
         LA    R10,PARSE2    ACCESS PDE ADDRESS                         06150002
         DROP  R10           DROP PDL ADDRESSABILITY                    06200002
         USING PARDSECT,R10  ESTABLISH PDE ADDRESSABILITY               06250002
************************************************************            06300002
** A PARAMETER LIST WILL BE CONSTRUCTED FOR DAIR. DAIR    **            06350002
** WILL RETURN A DDNAME FOR THE PARTITIONED DATA SET THAT **            06400002
** CONTAINS THE PROGRAM WE ARE LOOKING FOR                              06450002
************************************************************            06500002
         MVC   @4(LISTSIZE,R2),GETLIST FUTURE DCB EXPANSION AREA        06550002
         LA    R1,@4(R2)     ADDR OF LIST FORM INTO R1                  06600002
         GETMAIN EC,LV=100,SP=1,A=(R2),MF=(E,(R1))  GET CORE FOR DCB    06650002
         LTR   R15,R15       TEST RETURN CODE                           06700002
SMTGET01 DS    0H            TEST CASE TTTA7600                         06750002
         BZ    A10100        BRANCH OF RET CODE = O                     06800002
         LA    R4,TEN        REG 4 IMPLIES SVC 10 FAILED                06810002
         B     GETERR        OUTPUT ERROR MESSAGE                       06850002
A10100   EQU   *                                                        06950002
         L     R7,0(R2)      ACCESS ADDR OF GETMAIN AREA                07000002
         MVC   @0(@4,R7),TSTDCB ESTABLISH CHAIN ADDRESS                 07050002
         ST    R7,TSTDCB     ESTABLISH NEW CHAIN PTR                    07100002
         LA    R7,@4(R7)     INCREMENT PTR TO GETMAIN AREA              07150002
         L     R2,WORKAREA   ACCESS WORKAREA POINTER                    07200002
         LA    R3,DSNMEPTR-TSTCWORK(R2) INITIALIZE BUFFER               07250002
         MVI   @2(R3),BLANK  INITIALIZE BUFFER                          07300002
         MVC   @3(@43,R3),@2(R3) INITIALIZE BUFFER                      07350002
         L     R6,DSNAMPTR   ACCESS PTR TO DSNAME                       07400002
         LH    R5,LENGTH1    ACCESS LENGTH OF DSNAME                    07450002
         STH   R5,@0(R3)     STORE LENGTH OF DSNAME                     07500002
         BCTR  R5,R0         DECREMENT FOR EXECUTE                      07550002
         EX    R5,MOVEDSN    MOVE DSNAME                                07600002
         TM    FLAGS1,FULLQUAL Q.FULLY QUALIFIED DSNAME                 07650002
         BO    TODAIR        A. IF SO, GO TO DAIR                       07700002
         USING DFPL,R2       ESTABLISH ADDRESSABILITY                   07750002
         USING DFPB,R7       ESTABLISH ADDRESSABILITY                   07800002
         MVC   DFPLUPT(@4),TSTUPT  *****                                07850002
         MVC   DFPLECT(@4),TSTECT      *                                07900002
         MVC   DFPLECB(@4),TSTCPECB    *                                07950002
         ST    R7,DFPLDFPB             * INITIALIZE                     08000002
         ST    R3,DFPBDSN              *                                08050002
         L     R4,TPLPTR               *   DEFAULT                      08100002
         USING TPL,R4                  *                                08150002
         MVC   DFPBPSCB(@4),TPLPSCB    * PARM BLOCK                     08200002
         LA    R4,LOADQUAL             *                                08250002
         ST    R4,DFPBQUAL             *                                08300002
         MVI   DFPBCODE,DFPB00         *                                08350002
         MVI   DFPBCNTL,DFPBUID        *                                08400002
         LR    R1,R2                   *                                08450002
         LA    R5,@6         SVC = 6 FOR LINKFAIL                       08452002
         LA    R4,I0046      DFLT INSERT FOR POSS ERR MSG               08460002
         LINK  EP=IKJDFLT,ERRET=LINKFAIL          *****                 08500002
BLOW10   EQU   *             RESUME ADDRESS FOR STAE                    08550002
SMTDFLT  DS    0H            TEST CASE TTTA7600                         08600002
         LA    R14,@24       FOR FUTURE COMPARISON                      08650002
         CR    R14,R15       TEST ATTN                                  08700002
         LA    R15,@16       NEEDED IF ATTN WAS DETECTED                08750002
         BE    RET           RETURN TO MAINLINE                         08800002
         DROP  R2            DROP DFPL ADDRESSABILITY                   08850002
TODAIR   EQU   *             TO SET UP FOR DAIR                         08900002
         LA    R1,DAIR-TSTCWORK(R2) ACCESS COMMAND PORTION              08950002
         USING DAPL,R1       ADDRESSABILITY FOR DAIR PARM BLOCK         09000002
         MVC   DAPLUPT(@4),TSTUPT UPT PTR FOR DAIR                      09050002
         MVC   DAPLECT(@4),TSTECT ECT PTR FOR DAIR                      09100002
         MVC   DAPLECB(@4),TSTCPECB PTR TO CP ECB FOR DAIR              09150002
         L     R4,TPLPTR     PLACE POINTER TO TMP INTO R4               09200002
         USING TPL,R4        USE REG4 TO ADDRESS TMP DSECT              09250002
         L     R3,TPLPSCB    GET PTR TO PROTECTED STEP CONTROL BLK      09300002
         ST    R3,DAPLPSCB    PUT PTR INTO PSCB FIELD OF DAIR           09350002
*                            PARAMETER LIST                             09400002
         ST    R7,DAPLDAPB   PLACE POINTER TO DAIR PDE INTO PARM        09450002
         XC    @0(@76,R7),@0(R7) INITIALIZE FUTURE DAIR PARM BLOCK      09500002
         USING DAPB08,R7     ESTABLISH DAIR PARM BLOCK ADDRESSABILITY   09550002
         MVI   DA08DDN,BLANK MOVE BLANK INTO DDNAME FIELD               09600002
         MVC   DA08DDN+@1(@7),DA08DDN BLANK OUT DDNAME FIELD            09650002
         MVI   DA08UNIT,BLANK     BLANK CHAR INTO UNIT FIELD            09700002
         MVC   DA08UNIT+@1(@7),DA08UNIT BLANK OUT UNIT FIELD            09750002
         MVI   DA08SER,BLANK MOVE BLANK INTO SERIAL FIELD               09800002
         MVC   DA08SER+@1(@7),DA08SER BLANK OUT SERIAL FIELD            09850002
         MVI   DA08MNM,BLANK MOMOVE BLANK INTO MEMBER NAME FIELD        09900002
         MVC   DA08MNM+@1(@7),DA08MNM BLANK OUT MEMBER NAME FIELD       09950002
         MVC   DA08PSWD(@8),PASSWORD-TSTCWORK(R2) ACCESS PASSWORD       10000002
         OI    DA08DSP1,DA08SHR INDICATE DISP = SHR                     10050002
         MVI   DA08CD+@1,HEX08 CODE TO DAIR                             10100002
         DROP  R1            DROP DAIR PARM BLOCK ADDRESSABILITY        10150002
         LA    R3,DSNMEPTR-TSTCWORK(R2) ACCESS PTR TO DSNAME            10200002
         ST    R3,DA08PDSN   STORE DSN POINTER IN DAIR PARM BLOCK       10250002
         LA    R5,@6         SVC = 6 FOR LINKFAIL                       10252002
         LA    R4,I0041      DAIR INSERT FOR POSS ERR MSG               10260002
         LINK  EP=IKJDAIR,ERRET=LINKFAIL  LINK TO DAIR                  10310002
BLOW2    EQU   *             RESUME ADDR FOR STAE                       10350002
SMTDAIR1 DS    0H            TEST CASE TTTA7600                         10400002
         LTR   R0,R15        LOAD R0 WITH RETURN CODE AND TEST          10450002
         BZ    A10200        IFDAIR IS SUCCESSFUL THEN BRANCH           10500002
         BAL   R14,DAIRFL    TO DAIRFAIL ROUTINE                        10500402
         BAL   R14,FREEDCB   TO FREE GETMAIN AREA                       10500802
         B     A18000        BRANCH TO RETURN                           10501202
DAIRFL   EQU   *             DAIR FAIL ROUTINE                          10501602
         LR    R6,R14        SAVE RETURN ADDRESS                        10501702
         L     R2,WORKAREA   ACCESS WORKAREA PTR                        10502002
         LA    R11,PARMDRFL-TSTCWORK(R2) ACCESS DAIRFAIL PARAM LIST     10504002
         XC    @0(@20,R11),@0(R11) ZERO PARAMETER FIELD                 10506002
         ST    R15,TMPRETC-TSTCWORK(R2) STORE RET CODE IN WORK AREA     10508002
         LA    R1,TMPRETC-TSTCWORK(R2) R1=ADDR OF RET CODE              10508402
         ST    R1,@4(R11)    2ND WORD OF PARAM LIST                     10508802
         LA    R1,ONE        SET UP CALLER ID                           10509202
         STH   R1,TMPCIDP-TSTCWORK(R2) STORE IN WORK AREA               10509602
         LA    R1,TMPCIDP-TSTCWORK(R2) R1=ADDR OF CALLER ID             10509702
         ST    R1,@12(R11)   4TH WORD OF PARAM LIST                     10509802
         LA    R1,DAIR-TSTCWORK(R2) GET DAPL POINTER                    10509902
         ST    R1,@0(R11)    1ST WORD OF PARAM LIST                     10523202
         LA    R1,ZERO       SET UP MSG WRITER ENTRY                    10525202
         ST    R1,MIDHOLD-TSTCWORK(R2) STORE IN WORK AREA               10527202
         LA    R1,MIDHOLD-TSTCWORK(R2) R1=ADDR MSG WRTR ENTRY           10529202
         ST    R1,@8(R11)    3RD WORD OF PARAMETER LIST                 10531202
         LR    R1,R11        POINT TO PARAMETER LIST                    10531602
         LA    R5,@6         SVC = 6 FOR LINKFAIL                       10533602
         LA    R4,I0042      IKJEFF18-INSERT                            10535202
         LINK  EP=IKJEFF18,ERRET=LINKFAIL LINK TO DAIRFAIL              10535602
         BR    R6            RETURN TO CALLER                           10585602
* FREE DCB AREA                                                         10800002
FREEDCB  EQU   *             FREEMAIN DCB AREA                          10850002
         LR    R3,R14        SAVE RETURN ADDRESS                        10900002
         L     R2,TSTDCB     ACCESS GETMAIN AREA ADDRESS                10950002
         L     R7,@0(R2)     ACCESS PREVIOUS CHAIN ADDRESS              11000002
         ST    R7,TSTDCB     RESTORE PREVIOUS CHAIN ADDRESS TO TSTDCB   11050002
         FREEMAIN  RC,LV=100,A=(R2),SP=1                                11100002
         LTR   R15,R15       TEST RETURN CODE                           11110002
         BZ    FREDCB1       ZERO-ALL OK                                11120002
         LA    R4,@120       IMPLIES SVC 120 FAILED                     11122002
         B     GETERR        OUTPUT ERROR MESSAGE                       11130002
FREDCB1  BR    R3            RETURN TO CALLER                           11140002
UNALLOC  EQU   *             TO CLOSE DCB AND UNALLOCATE DSNAME         11200002
         L     R7,TSTDCB     ACCESS DCB CHAIN ADDRESS                   11250002
         LA    R7,@4(R7)     ACCESS PTR TO DCB                          11300002
         LA    R6,@92(R7)    ADDR OF LIST FORM OF CLOSE                 11350002
         LR    R3,R14        SAVE RETURN ADDR                           11400002
         CLOSE ((R7)),MF=(E,(6))  CLOSE DCB                             11450002
         L     R2,WORKAREA   ACCESS WORKAREA ADDRESS                    11500002
         LA    R2,CWORKCMD-TSTCWORK(R2) ACCESS COMMAND PORTION          11550002
         USING DAPB2C,R2      ESTABLISH ADDRESSABILITY FOR DAIR PARM    11600002
         MVC   DA2CCD(@2),DAIR2C INSERT DAIR CODE INTO BLOCK            11650002
         MVC   DA2CFLG(@2),FLG2C SET FLAG                               11700002
         XC    DA2CTCB(@4),DA2CTCB ZERO TCB ADDRESS PORTION             11750002
         L     R14,WORKAREA   ACCESS WORKAREA POINTER                   11800002
         MVC   DA2CDDN(@8),DDNSAVE-TSTCWORK(R14) ACCESS DDNAME          11850002
         LA    R1,DAIR-TSTCWORK(R14) WORKAREA FOR DAPL                  11900002
         USING DAPL,R1       ADDRESSABILITY FOR DAIR PARM BLOCK         11950002
         ST    R2,DAPLDAPB   PTR TO DAPB18                              12000002
         MVC   DAPLUPT(@4),TSTUPT UPT PTR FOR DAIR                      12050002
         MVC   DAPLECT(@4),TSTECT ECT PTR FOR DAIR                      12100002
         MVC   DAPLECB(@4),TSTCPECB PTR OT CPECB FOR DAIR               12150002
         L     R5,TPLPTR     PLACE PTR TO TMP INTO R5                   12200002
         USING TPL,R5        ADDRESSABILITY TO TMP DSECT                12250002
         L     R14,TPLPSCB   GET PTR TO PROTECTED STEP CONTROL BLOCK    12300002
         ST    R14,DAPLPSCB  PUT PTR INTO PSCB FIELD OF DAIR PARM       12350002
         DROP  R5            DROP TMP ADDRESSABILITY                    12400002
         DROP  R1            DROP DAIR PARM ADDRESSABILITY              12450002
         LA    R5,@6         SVC = 6 FOR LINKFAIL                       12452002
         LA    R4,I0041      DAIR INSERT FOR POSS ERR MSG               12460002
         LINK  EP=IKJDAIR,ERRET=LINKFAIL    UNALLOCATE DATA SET         12500002
BLOW9    EQU   *             STAE RESUME ADDRESS                        12550002
SMTDAIR2 DS    0H            TEST CASE TTTA7600                         12600002
         LTR   R15,R15       TEST RETURN CODE                           12602002
         BZ    NODRFL        BRANCH AROUND DAIRFAIL                     12604002
         BAL   R14,DAIRFL    TO DAIRFAIL ROUTINE                        12604402
         L     R2,WORKAREA   ACCESS WORKAREA                            12614402
         CLI   TASKSWF-TSTCWORK(R2),HEXFF  HAS TASK SW. OCCURRED        12624402
         BE    STAEOFF       YES, GO TO REMOVE ESTAE AND RETURN         12634402
         B     A18000        BRANCH TO RETURN                           12636502
NODRFL   EQU   *             COME HERE IF DAIR WAS OK                   12636602
         LR    R14,R3        RESTORE RETURN ADDRESS                     12650002
         BR    R14           RETURN TO CALLER                   YA00064 12700002
         DROP  R2            DROP DAPB18 ADDRESSABILITY                 12750002
A10200   EQU   *             EQUATE LABEL TO THIS ADDRESS               12800002
         L     R2,WORKAREA   ACCESS PTR TO WORKAREA                     12850002
         LA    R2,DDNSAVE-TSTCWORK(R2) CREATE PTR TO DDNAME SAVE AREA   12900002
         LA    R6,DA08DDN    OBTAIN ADDRESS OF DDNAME FROM              12950002
         MVC    @0(@8,R2),@0(R6) MOVE DDNAME TO HOLD AREA               13000002
         LR    R1,R7         RESTORE STARTING ADDRESS OF DCB            13050002
         USING DSNDSECT,R4   USE REG4 TO ADDRESS DSECT                  13100002
         MVC   @0(@88,R1),MYDCB MOVE DCB INTO GOTTEN CORE               13150002
         USING IHADCB,R1     USE DCB DSECT TO LOCATE LABELS             13200002
         MVC   DCBDDNAM,@0(R2) MOVE DDNAME INTO DCB                     13250002
         MVC   @88(@4,R1),LFORM MOVE IN OPEN ROUTINE INTO DCB           13300002
         MVC   @92(@4,R1),CLFORM MOVE CLOSE LIST FORM TO NEW CORE       13350002
         LA    R6,@88(@0,R1) PLACE ADDR OF ELIST                        13400002
         LR    R0,R1         PLACE POINTER TO DCB INTO R0               13450002
         OPEN  ((0)),MF=(E,(6)) OPEN DATA SET FOR BLDL MACRO            13500002
BLOW3    EQU   *             RESUME ADDR FOR STAE                       13550002
SMTOPEN  DS    0H            TEST CASE TTTA7600                         13600002
         USING IHADCB,R7     USE REG7 TO ADDRESS DCB                    13650002
         TM    DCBOFLGS,HEX10 TEST IF OPEN WAS SUCCESSFUL               13700002
         BO    A13190        IF OPEN WAS SUCCESSFUL THEN BRANCH         13750002
         LA    R2,M0045      MSG-UNABLE TO LOAD PGM                     13800002
         LA    R3,M0249      MSG-OPEN ERROR                             13810002
         BAL   R6,MSG1       GO OUTPUT MESSAGES                         13820002
         B     A18000        BRANCH TO PUT MSG OUT TO TERM              13850002
************************************************************            13900002
*  THE DCB HAS BEEN CREATED AND OPENED.                     *           13950002
*  THE BLDL MACRO WILL BE ISSUED                            *           14000002
*************************************************************           14050002
A13190   EQU   *             EQUATE LABEL TO THIS ADDRESS               14100002
         LH    R5,LENGTH2    GET LENGTH OF MEMBER NAME                  14150002
         L     R6,MEMBERPT   PLACE POINTER TO MEMBER NAME IN R6         14200002
         L     R2,WORKAREA   ACCESS WORKAREA PTR                        14250002
         LA    R11,CWORKCMD-TSTCWORK(R2)  FUTURE BLDL AREA              14300002
         MVC   @0(@4,R11),LSTDSCP PLACE LIST DESCRIPTOR INTO LIST       14350002
**************************************************************          14400002
**LIST DESCRIPTOR FIELD CONSIST OF 2 HALFWORDS.THE FIRST TWO**          14450002
**BYTES IS THE NUMBER OF ENTRIES,THE NEXT 2 BYTES IS THE    **          14500002
**LENGTH OF EACH ENTRY                                      **          14550002
**************************************************************          14600002
         MVI   @4(R11),HEX40 MOVE A BLANK INTO NAME FIELD               14650002
         MVC   @5(@7,R11),@4(R11) SPREAD THRU OUT ENTIRE AREA           14700002
         BCTR  R5,R0         PREPARE FOR EX INSTRUCTION                 14750002
         EX    R5,MEMMOVE    MOVE MEMBER NAME TO LIST                   14800002
         LR    R5,R11        PLACE ADDR OF LIST INTO REG5               14850002
         BLDL  (7),(5)       ISSUE BLDL MACRO TO COMPLETE LIST          14900002
         LTR   R15,R15       CHECK TO SEE IF BLDL FOUND MEMBER          14950002
SMTBLDL  DS    0H            TEST CASE                                  15000002
         BZ    A12020        IF BLDL SUCCESSFUL THEN BRANCH             15050002
         LR    R4,R15        SAVE RETURN CODE                           15100002
         BAL   R14,UNALLOC   GO CLOSE AND UNALLOC DATASET       YA00064 15150002
         BAL   R14,FREEDCB   GO FREE GETMAIN DCB AREA           YA00064 15160002
         LA    R2,M0045      MSG-UNABLE TO LOAD PGM                     15170002
         LA    R3,M0250      MSG-BLDL ERROR CODE 4                      15180002
         LA    R14,@4        PUT 4 IN REGISTER                          15190002
         CR    R14,R4        IS RET CODE = 4                            15192002
         BNE   BLDL8         NO, NEED ERR CODE 8 MSG                    15194002
         BAL   R6,MSG1       GO OUTPUT MESSAGES                         15196002
         B     A18000        RETURN TO MAINLINE                         15198002
BLDL8    LA    R3,M0297      MSG-BLDL ERROR CODE 8                      15198402
         BAL   R6,MSG1       GO OUTPUT MESSAGES                         15198802
         B     A18000        RETURN TO MAINLINE                         15199202
************************************************************            16000002
**IF WE'VE MADE IT THIS FAR WE ARE READY TO LOAD THE      **            16050002
**ASKED FOR PROGRAM INTO CORE.TO DO THIS WE WILL USE THE  **            16100002
**LOAD MACRO                                              **            16150002
************************************************************            16200002
A12020   EQU   *             EQUATE LABEL TO THIS ADDRESS               16250002
         TM    @26(R5),HEX20 TEST OVERLAY BIT                           16300002
         BZ    OVLY          BRANCH IF OVERLAY BIT OFF                  16350002
         OI    TSTDCB,HEX80  INDICATE  OVERLAY IN TCOMTAB               16400002
OVLY     EQU   *                                                        16450002
         LA    R10,I0023     LOAD-INSERT FOR POSS ERR MSG               16460002
         L     R2,WORKAREA   PTR TO WORKAREA                            16510002
         ST    R10,MIDHOLD-TSTCWORK(R2) STORE LOAD INSERT               16520002
         BAL   R14,TASKSW    SWITCH TO PPTCB FROM TEST TCB              16550002
**********************************************************************  16600002
** WHEN WE RETURN TO THIS POINT WE ARE NOW FUNCTIONING AS           **  16650002
** PART OF THE PROBLEM PROGRAM AND NOT AS PART OF TEST.             **  16700002
**********************************************************************  16750002
CONTLOAD BAL   R14,PPSTAE          SETUP FOR STAE UNDER PRB PROG        16800002
         LA    R5,@4(R0,R5)  LOAD LIBRARY ADDR OF PROGRAM               17000002
         LOAD  DE=(5),DCB=(7),ERRET=LOADFAIL BRING IN REQSTED PROGRAM   17050002
BLOW4    EQU   *             RESUME ADDR FOR STAE                       17100002
SMTLOAD1 DS    0H            TEST CASE                                  17150002
************************************************************            17200002
** THE REQUESTED PROGRAM HAS BEEN LOADED IN. THE ENTRY    **            17250002
** POINT OF THE PROGRAM,RETURNED IN REG0,MUST BE SAVED TO **            17300002
** BE PASSED ON TO THE  PROBLEM PROGRAM                   **            17350002
************************************************************            17400002
*                            INTO REG1                                  17450002
         LA    R2,M0049      MSG-ENTRY POINT AT ...                     17460002
         LR    R4,R0         LOAD EPA IN REG 4                          17470002
         BAL   R6,MSG5       GO OUTPUT MESSAGE                          17480002
         B     STAEOFF       REMOVE STAE REQUEST AND RETURN             18250002
         USING DSNDSECT,R2   USE REG2 TO ADDRESS DSECT                  18300002
         EJECT                                                          18350002
************************************************************            18400002
**THIS IS THE ENTRY POINT FOR THE DELETE FUNCTION OF      **            18450002
**LDF. THIS SUB-COMMAND RESULTS IN A MODULE  BEING        **            18500002
**REMOVED FROM CORE                                       **            18550002
************************************************************            18600002
DELETEIT EQU   *             EQUATE DELETE ENTRY PTR TO THIS ADDR       18650002
         L     R4,REGSAVE2   PLACE ADDR OF MY SAVE AREA INTO R4         18700002
         ST    R13,@4(R4)    STORE USER SAVE AREA ADDR INTO MY SAVE     18750002
         LR    R13,R4        PLACE MY SAVE AREA ADDR INTO R13           18800002
         LA    R10,STAEDEL   ACCESS ADDR OF STAE EXIT TAB               18850002
         L     R5,PARSEDEL   ACCESS PCL POINTER                         18900002
         LA    R11,I0024     DELETE-INSERT FOR ERR MSG                  18950002
         LA    R6,SPLISTDL   REG 6 = ESTAE PARAMETER LIST               18960002
         BAL   R14,STAEPREP  TO EXPAND STAE MACRO                       19000002
         L     R5,TSTANSPL   PLACE ADDRESS OF PDE IN R5                 19050002
         USING C,R5          ESTABLISH PDL ADDRESSABILITY               19100002
         LA    R5,PARSE1     ACCESS PDE PTR                             19150002
         DROP  R5            DROP PDL ADDRESSABILITY                    19200002
         USING PRSDSECT,R5   ESTABLISH PDE ADDRESSABILITY               19250002
         L     R2,WORKAREA   GET ADDRESS OF WORKAREA                    19260002
         MVI   CWORKCMD-TSTCWORK(R2),BLANK  PLACE A BLANK INTO BYTE 1   19270002
*                            OF WA TO PAD WITH BLANK FOR DELETE MACRO   19280002
         MVC   CWORKCMD-TSTCWORK+@1(@7,R2),CWORKCMD-TSTCWORK(R2)        19290002
         LH    R4,LEN2       LOAD LENGTH OF NAME INTO REG4              19292002
         BCTR  R4,R0         PREPARE FOR EX INSTRUCTION                 19294002
         L     R5,DSNPTR     GET MEMBER NAME POINTER                    19296002
         DROP  R5                                                       19298002
         EX    R4,DELMOVE    MOVE MODULE NAME TO WORKAREA               19298402
         LA    R10,I0024     DELETE-INSERT FOR ERR MSG                  19298802
         ST    R10,MIDHOLD-TSTCWORK(R2) STORE DELETE INSERT             19308802
************************************************************            19310002
** AFTER RETURNING FROM PARSE AND PLACING THE MODULE NAME **            19320002
** IN THE WORK AREA WE BRANCH TO SWITCH REGISTERS THEREBY **            19330002
** PUTTING US UNDER THE PROBLEM PROGRAM TCB AND NOT UNDER **            19332002
** THE TEST TCB                                           **            19340002
************************************************************            19342002
         BAL   R14,TASKSW    SWITCH TO PROB PROG TCB                    19350002
         BAL   R14,PPSTAE    SET UP FOR STAE UNDER PRB PROG             19400002
************************************************************            20100002
** AT THIS POINT WE ARE READY TO DELETE THE NAMED MODULE  **            20150002
************************************************************            20200002
CONTDEL  DELETE EPLOC=CWORKCMD-TSTCWORK(R2)     DELETE MODULE           20250002
         LTR   R15,R15       CHECK TO SEE THAT DELETE WAS SUCCESSFUL    20400002
SMTDEL   DS    0H            TEST CASE                                  20450002
         BZ    STAEOFF       RETURN TO TEST                             20500002
************************************************************            20550002
** THE MODULE TO BE DELETED CAN NOT BE FOUND WE THEREFORE **            20600002
** PUT OUT A MESSAGE INDICATING THIS AND THEN BRANCH TO   **            20650002
** PUT US BACK INTO TEST ROUTINE                          **            20700002
************************************************************            20750002
         LA    R2,M0058      MSG-DELETE FAILED                          20760002
         LA    R3,M0251      MSG-PGM NOT ON LOAD LIST                   20770002
         LA    R4,I0024      DELETE INSERT                              20780002
         BAL   R6,MSG2       GO OUTPUT MESSAGES                         20790002
         OI    TSTFLGS4,TSTFLUSH TELL MAINLINE TO FLUSH STACK           20792002
         B     STAEOFF       REMOVE STAE REQUEST AND RETURN             20792102
         EJECT                                                          21000002
************************************************************            21050002
** THIS IS THE ENTRY POINT FOR A GETMAIN COMMAND. WE WILL **            21100002
** SAVE REGISTERS,ESTABLISH ADDRESSABILITY,THEN SWITCH    **            21150002
** OURSELVES FROM TEST TO THE PROBLEM PROGRAM TCB. ONCE   **            21200002
** THIS HAS BEEN ACCOMPLISHED WE WILL ISSUE A GETMAIN     **            21250002
** FOR THE REQUIRED CORE. WE THEN RETURN                  **            21300002
************************************************************            21350002
GETIT    EQU   *             EQUATE GETMAIN ENTRY TO THIS ADDR          21400002
         L     R4,REGSAVE2   PLACE ADDR OF MY SAVE AREA INTO R4         21450002
         ST    R13,@4(R4)    PLACE USER SAVEAREA ADDR INTO MY SAVE      21500002
         LR    R13,R4        PLACE MY SAVE AREA ADDR INTO R13           21550002
         LA    R10,STAEGET   ACCESS ADDR OF STAE EXIT TABLE             21600002
         L     R5,PCLGET     ACCESS POINTER TO PCL                      21650002
         LA    R11,I0025     GETMAIN-INSERT FOR ERR MSG                 21660002
         LA    R6,SPLISTGT   REG 6 = ESTAE PARAMETER LIST               21710002
         BAL   R14,STAEPREP  TO EXPAND STAE MACRO                       21750002
         L     R3,TSTANSPL   PLACE ADDR TO PDE INTO R3                  21800002
         USING B,R3          ESTABLISH PDL ADDRESSABILITY               21850002
         LA    R3,GETMAIN1   ACCESS PDE POINTER                         21900002
         DROP  R3            DROP PDL ADDRESSABILITY                    21950002
         USING IDENTGM,R3    ESTABLISH PDE ADDRESSABILITY               22000002
         L     R1,STRNGPTR   PLACE POINTER TO INTER IN R1               22050002
         LH    R6,LENDSNME   PLACE LENGTH OF OF INTEGER IN R6           22100002
         BCTR   R6,R0        DECREMENT R6 BY 1 FOR EXECUTE CMD          22150002
         EX    R6,A13000     PACK INTEGER INTO WORKAREA                 22200002
         CVB   R4,@0(R2)     CONVERT INTEGER TO BINARY                  22250002
         LTR   R4,R4         TEST GETMAIN COUNT                         22260002
         BNZ   GETOK         COUNT NOT ZERO, BRANCH                     22270002
         LA    R2,M0047      MSG-0 BYTES INVALID CNT                    22280002
         LA    R3,ZERO       NO SECOND LEVEL MESSAGE                    22282002
         BAL   R6,MSG1       GO OUTPUT MESSAGES                         22292002
         B     A18000        RETURN TO MAINLINE                         22294002
GETOK    L     R1,SPOINTER   PLACE SUBPOOL POINTER IN REG1              22296002
         LTR   R1,R1         SEE IF WE HAVE A SUBPOOL SPECIFIED         22500002
         BNZ   A13010        IF ENTERED THEN AVOID NEXT CODE            22550002
         SR    R5,R5         DEFAULT TO SUBPOOL ZERO                    22600002
         B     A13020        BRANCH TO ISSUE GETMAIN TO SP=0            22650002
A13010   EQU   *             EQUATE LABEL TO THIS ADDRESS               22700002
         LH    R6,SPLENGTH   GET LENGTH OF INTEGER FROM PDE             22750002
         BCTR  R6,R0         DECREMENT R6 TO FIT EX INSTRUCTION         22800002
         EX    R6,A13000     PACK THIS NUMBER INTO WORKAREA             22850002
         CVB   R5,@0(R2)     CONVERT SUBPOOL INTEGER TO BINARY          22900002
A13020   EQU   *             EQUATE LABEL TO THIS ADDRESS               22950002
         XR    R7,R7         INDICATE EQUATE NOT SPECIFIED              23000002
         TM    EQUFLG,HEX80  TEST FOR PRESENCE OF EQUATE KEYWORD        23050002
         BNO   NOSYM         IF NO EQUATE KEYWORD, BRANCH               23100002
         L     R7,SYMTABLE   ACCESS PTR TO IN-CORE SYMBOL TABLE         23150002
         USING SYMDSECT,R7   ESTABLISH SYMTABLE ENTRY ADDRESSABILITY    23200002
CHKSYM   EQU   *                                                        23250002
         LTR   R7,R7         TEST IF END OF CHAIN                       23300002
         BZ    ENDSRCH       IF ZERO THEN SEARCH ENDED                  23350002
         LH    R6,EQULEN     ACCESS LENGTH OF SYMBOL IN PDE             23400002
         LH    R8,SYMLNGTH   ACCESS LENGTH OF SYMTABLE ENTRY            23450002
         CR    R8,R6         COMPARE SYMBOL LENGTHS                     23500002
         BNE   REINIT        GET NEXT SYMTAB ENTRY                      23550002
         L     R8,EQUPTR     ACCESS PTR TO SYMBOL IN PDE                23600002
         BCTR  R6,R0         DECREMENT FOR EXECUTE                      23650002
         EX    R6,SYMCOMP    TO COMPARE SYMBOLS                         23700002
         BE    SKIPGTMN      DUPLICATE FOUND, BYPASS GETMAIN            23750002
REINIT   EQU   *                                                        23800002
         L     R7,CHAIN      ACCESS PTR TO NEXT SYMTAB ENTRY            23850002
         B     CHKSYM        IF NOT, TEST FOR DUPLICATE                 23900002
*                                                                       23950002
ENDSRCH  EQU   *                                                        24000002
         LH    R6,EQULEN     ACCESS SYMBOL LENGTH                       24050002
         LA    R7,@16(R6)    LENGTH OF FUTURE SYMTAB ENTRY              24100002
         LA    R2,CWORKCMD-TSTCWORK(R2) COMMAND PORTION OF WORKAREA     24150002
         MVC   @4(LISTSIZE,R2),GETLIST  LIST FORM OF GETMAIN            24200002
         LA    R1,@4(R2)     PTR TO LIST FORM                           24250002
         GETMAIN EC,LV=(7),SP=1,A=(2),MF=(E,(1))  ISSUE GETMAIN         24300002
         LTR   R15,R15       TEST RETURN CODE                           24350002
         BZ    ENTERSYM      IF RC=0, BRANCH                            24400002
         LA    R4,TEN        IMPLIES SVC 10 FAILED                      24402002
         B     GETERR        GO OUTPUT ERROR MSG                        24410002
ENTERSYM EQU   *                                                        24550002
         L     R8,SYMTABLE   ACCESS PTR TO LAST SYMTAB ENTRY            24600002
         L     R7,@0(R2)     ACCESS PTR TO FUTURE SYMTAB ENTRY          24650002
         ST    R8,CHAIN      STORE LATEST PTR IN FUTURE ENTRY           24700002
         ST    R7,SYMTABLE   FUTURE ENTRY BECOMES LATEST ENTRY          24750002
         STH   R6,SYMLNGTH   STORE SYMBOL LENGTH                        24800002
         BCTR  R6,R0         DECREMENT FOR EXECUTE                      24850002
         L     R8,EQUPTR     ACCESS PTR TO SYMBOL FROM PDE              24900002
         EX    R6,SYMMVC     MOVE SYMBOL                                24950002
SKIPGTMN EQU   *                                                        25000002
         MVI   SYMBOL,BLANK  MAKE SYMTABLE ENTRY INACTIVE IN CASE OF    25050002
*                            GETMAIN FAILURE                            25100002
         IC    R6,@0(R8)     STORE FIRST CHARACTER IN R6                25150002
         MVC   ATTRTYPE(PARMSIZE),SYMPARM  MOVE IN CONSTANTS            25200002
         XC    ADDRSYM(@4),ADDRSYM ZERO CURRENT ADDRESS                 25250002
NOSYM    EQU   *                                                        25300002
         LA    R10,I0025     GETMAIN-INSERT FOR ERR MSG                 25310002
         L     R2,WORKAREA   PTR TO WORKAREA                            25360002
         ST    R10,MIDHOLD-TSTCWORK(R2) STORE GETMAIN INSERT            25370002
         BAL   R14,TASKSW    BRANCH TO SWITCH US TO THE PROBLEM PROG    25400002
*                            OF PDL IN REG2                             25450002
CONTGET  EQU   *                                                        25500002
************************************************************            25550002
** WHEN WE RETURN TO THIS POINT WE ARE NOW UNDER THE      **            25600002
** PROBLEM PROGRAM TASK AND NOT UNDER TEST. SINCE WE      **            25650002
** NEED OUR REGISTERS LATER,WE MUST SAVE THEM NOW IN      **            25700002
** REGSAVE3                                               **            25750002
************************************************************            25800002
************************************************************            25850002
**    REGISTER 4 = LENGTH OF CORE TO ISSUE GETMAIN        **            25900002
**    REGISTER 5 = SUBPOOL NUMBER TO GET CORE             **            25950002
**    REGISTER 1 = ADDRESS OF AREA FOR GETMAIN TO BUILD   **            26000002
**                 PARAMETER LIST IN BEFORE ISSUING SVC 10 *            26050002
************************************************************            26100002
         BAL   R14,PPSTAE    BRANCH TO STAE SETUP UNDER PPTCB           26150002
         LA    R2,CWORKCMD-TSTCWORK(R2) ACCESS COMMAND PORTION OF WRKA  26350002
         LA    R1,@4(R2)     PLACE ADDRESS OF LIST FORM IN R1           26400002
         MVC   @4(LISTSIZE,R2),GETLIST    MOVE LIST FORM INTO WA        26450002
         GETMAIN EC,LV=(4),SP=(5),A=(2),MF=(E,(1)) ISSUE CONDITIONAL    26500002
*                            GETMAIN WITH ADDRESS RETURN IN WORKAREA    26550002
         LTR   R15,R15       TEST IF GETMAIN WAS SUCCESSFUL             26600002
SMTGET02 DS    0H            TEST CASE                                  26650002
         BZ    A14001        IF SUCCESSFUL THEN BRANCH                  26700002
         LA    R4,TEN        IMPLIES SVC 10 FAILED                      26702002
         B     GETERR        GO OUTPUT ERROR MSG                        26710002
A14001   EQU   *             EQUATE LABEL TO THIS ADDRESS               26950002
         LTR   R7,R7         TEST IF EQUATE SPECIFIED                   27000002
         BZ    DONTEQU       SKIP EQUATE PROCESSING                     27050002
         STC   R6,SYMBOL     ACTIVATE SYMTABLE ENTRY                    27100002
         MVC   ADDRSYM(@4),@0(R2) ENTER EQUATED ADDRESS IN SYMTAB ENTRY 27150002
         DROP  R7                                                       27200002
DONTEQU  EQU   *                                                        27250002
         L     R4,@0(R2)     LOAD REG4 WITH ADDR OF STORAGE             27252002
         LA    R2,M0046      MSG-STORAGE AT ...                         27260002
         BAL   R6,MSG5       GO OUTPUT MESSAGE                          27280002
         B     STAEOFF       REMOVE STAE REQUEST AND RETURN             27290002
         EJECT                                                          28200002
************************************************************            28250002
** THIS IS THE ENTRY POINT FOR A FREEMAIN COMMAND.WE      **            28300002
** WILL SAVE REGISTERS,ESTABLISH ADDRESSABILITY,THEN      **            28350002
** PARSE WILL SCAN OFF THE SUB-PARAMETERS. ONCE THIS      **            28400002
** HAS BEEN ACCOMPLISHED WE WILL SWITCH FROM TEST TO THE  **            28450002
** PROBLEM PROGRAM TASK TO ISSUE THE FREEMAIN             **            28500002
************************************************************            28550002
FREEALL  EQU   *             EQUATE FREEMAIN TO THIS ADDR               28600002
         L     R4,REGSAVE2   PLACE ADDRESS OF MY SAVEAREA INTO R4       28650002
         ST    R13,@4(R4)    PLACE ADDR OF USER SAVEAREA INTO MY AREA   28700002
         LR    R13,R4        PLACE MY SAVEAREA ADDR INTO R13            28750002
         LA    R10,STAEFREE  ACCESS ADDR OF STAE TABLE                  28800002
         L     R5,PARSEIT    ACCESS POINTER TO PCL                      28850002
         LA    R11,I0026     FREEMAIN-INSERT FOR POSSIBLE MSG           28860002
         LA    R6,SPLISTFR   REG 6= ESTAE PARAMETER LIST                28910002
         BAL   R14,STAEPREP  TO EXPAND STAE MACRO                       28950002
         L     R10,TSTANSPL  PLACE ADDRESS OF PDE INTO R10              29000002
         USING A,R10         ESTABLISH PDL ADDRESSABILITY               29050002
         LA    R10,FREEMAN1  ACCESS PTR TO PDE                          29100002
         DROP  R10           DROP PDL ADDRESSABILITY                    29150002
************************************************************            29200002
** UPON RETURN FROM SWITCHING TO PROBLEM PROGRAM TASK,    **            29250002
** WE WILL ACCESS THE PDL POINTED TO BY REGISTER 10. THE  **            29300002
** LENGTH OF THE AREA TO BE FREED WILL BE IN EBCDIC AND   **            29350002
** MUST BE CONVERTED TO BINARY. THE ABSOLUTE ADDRESS      **            29400002
** WILL BE RETURNED BY CONVERT AND POINTED TO BY CONAREA  **            29450002
** IN TCOMTAB. A CHECK WILL BE MADE TO SEE IF A SUBPOOL   **            29500002
** WAS SPECIFIED. IF SO THIS TOO MUST BE CONVERTED TO     **            29550002
** BINARY                                                 **            29600002
************************************************************            29650002
         USING IDENTFM,R10   USE REG10 TO ADDRESS PDE                   29700002
         L     R1,COREPTR    PLACE POINTER TO INTEGER IN R1             29750002
         LH    R6,LENGTHFM   GET LENGTH OF INTEGER INTO R6              29800002
         BCTR  R6,R0         DECREMENT LENGTH FOR EX INSTRUCTION        29850002
         EX    R6,A13000     PACK THIS INTO WORKAREA                    29900002
         CVB   R0,@0(R2)     CONVERT THIS TO BINARY                     29950002
         DROP  R10           DROP PDE ADDRESSABILITY                    30000002
         L     R10,TSTANSPL  ACCESS PDL POINTER                         30050002
         USING A,R10         ESTABLISH PDL ADDRESSABILITY               30100002
         SR    R7,R7         CLEAR REG 7 FOR SUBPOOL NUMB               30110002
         OC    FREEMAN3(@2),FREEMAN3 TEST IF SUBPOOL SPECIFIED          30150002
         BZ    A14012        IF NOT SPECIFIED, BRANCH                   30200002
         LA    R10,FREEMAN4  ACCESS IDENT PDE                           30250002
         DROP  R10           DROP PREVIOUS PDE ADDRESSABILITY           30300002
         USING IDENTFM,R10   ESTABLISH IDENT PDE ADDRESSABILITY         30350002
         L     R1,COREPTR    ACCESS PTR TO SUBPOOL STRING               30400002
************************************************************            30450002
** AT THIS TIME SUBPOOL WAS SPECIFIED SO WE MUST CONVERT  **            30500002
**    THE INTEGER TO BINARY                               **            30550002
************************************************************            30600002
         LH    R6,LENGTHFM   ACCESS LENGTH OF SUBPOOL STRING            30650002
         BCTR  R6,R0         DECREMENT LENGTH FOR EX INSTRUCTION        30700002
         EX    R6,A13000     PACK THIS VALUE INTO THE WORKAREA          30750002
         CVB   R4,@0(R2)     CONVERT THIS TO BINARY                     30800002
         SLL   R4,@24        MOVE SUBPOOL TO HIGH ORDER BYTE            30850002
         LR    R7,R4         SUBPOOL NUMB TO REG 7                      30860002
         SRL   R7,@24        RIGHT-JUST. IN REG 7                       30870002
A14012   EQU   *             ENTER HERE IF NO SUBPOOL SPECIFIED         30950002
         DROP  R10           DROP PREVIOUS PDE ADDRESSABILITY           31000002
         L     R10,TSTANSPL  ACCESS ADDR OF PDL                         31050002
         USING A,R10         ESTABLISH PDL ADDRESSABILITY               31100002
         LA    R10,FREEMAN2  ACCESS ADDR OF PDE                         31150002
         DROP  R10           DROP PDL ADDRESSABILITY                    31200002
         USING IKJPARMA,R10  ESTABLISH PDE ADDRESSABILITY               31250002
         L     R6,PDEUSER    ACCESS ADDR IN USERWORD                    31300002
         LR    R4,R0         SAVE REGISTER ZERO                         31350002
         LA    R10,I0026     FREEMAIN-INSERT FOR POSSIBLE MSG           31360002
         L     R2,WORKAREA   PTR TO WORKAREA                            31410002
         ST    R10,MIDHOLD-TSTCWORK(R2) STORE FREEMAIN INSERT           31420002
         BAL   R14,TASKSW    SWITCH TO PROB PROG TCB                    31450002
CONTFREE BAL   R14,PPSTAE    SETUP FOR STAE UNDER PRB PROG              31500002
         LR    R0,R4         RESTORE REGISTER 0                         31700002
         LR    R1,R6         ACCESS ADDR IN USERWORD                    31750002
         LA    R1,@0(R1)     CLEAR HIGH ORDER BYTE OF ADDRESS           31760002
         FREEMAIN RC,LV=(0),A=(1),SP=(R7)  ISSUE FREEMAIN               31800002
         LTR   R15,R15       TEST RETURN CODE                           31810002
         BZ    CONTFRE1      BRANCH IF ALL OK                           31820002
         LA    R4,@120       IMPLIES SVC 120 FAILED                     31822002
         B     GETERR        GO OUTPUT ERROR MESSAGE                    31830002
CONTFRE1 B     STAEOFF       REMOVE STAE REQUEST AND RETURN             31840002
         EJECT                                                          32000002
************************************************************            32050002
** THIS ROUTINE WILL SWITCH US FROM TEST TCB WHICH WE ARE **            32100002
** NOW RUNNING UNDER TO PROBLEM PROGRAM TCB.SO THAT WE    **            32150002
** WILL LOAD THE PROGRAM UNDER THE PROBLEM PROGRAM. THIS  **            32200002
** IS ACCOMPLISHED BY PLACING OUR REGISTERS INTO THE SVRB **            32250002
** GENERAL PURPOSE SAVE AREA (RBGRSAVE) SO THAT WHEN      **            32300002
** CONTROL IS RETURNED TO THE PROBLEM PROGRAM OUR         **            32350002
** REGISTERS ARE LOADED. WE ALSO CHANGE THE LOCATION      **            32400002
** COUNTER FOUND IN RBOPSW OF THE PROGRAM REQUEST BLOCK   **            32450002
** SO THAT AFTER OUR REGISTERS HAVE REPLACED THE PROBLEM  **            32500002
** PROGRAMS REGISTERS CONTROL IS RETURNED BACK INTO THIS  **            32550002
** PROGRAM AT THE POINT WHERE WE WERE AFTER  BRANCHING    **            32600002
** TO THIS ROUTINE.                                       **            32650002
** IF A NON ZERO RETURN CODE IS ENCOUNTERED FROM SVC 97,  **            32700002
** RETURN IS MADE TO 4(R14).                              **            32750002
************************************************************            32800002
TASKSW   EQU   *                                                        32850002
         L     R1,PPTCB      PLACE PROBLEM PROGRAM TCB ADDR             32900002
*                            INTO REG1                                  32950002
         L     R2,WORKAREA   ACCESS WORKAREA PTR                        33000002
         LA    R11,CWORKLDF-TSTCWORK(R2) FUTURE RB REG SAVE AREA        33050002
         USING TCB,R1        USE REG1 TO ADDRESS TASK CONTROL BLK       33100002
         L     R1,TCBRBP     LOAD RB ADDRESS INTO REG1                  33150002
         DROP  R1            DROP R1                                    33200002
         USING RBSECT,R1     USE REG1 TO ADDRESS REQUEST BLOCK          33250002
         MVC   @0(@64,R11),RBGRSAVE MOVE RB REG SAVE AREA INTO          33300002
*                            AREA FROM GETMAIN                          33350002
         L     R1,RBLINK     PLACE ADDR OF NEXT RB INTO R1              33400002
         MVC   TSTGO(@4),RBOPSW+@4 MOVE INSTRUCTION COUNTER             33450002
*                            FROM RB INTO GETMAIN SAVE AREA             33500002
         DROP  R1            DROP R1                                    33550002
         L     R1,REGSAVE3   REGISTER SAVE AREA PARM FOR SVC            33600002
         STM   R0,R15,@0(R1) STORE REG INTO MY SAVE AREA                33650002
         LR    R4,R1         PLACE ADDR OF REG AREA IN R4               33660002
         L     R3,PPTCB      PLACE PROB PROG TCB ADDR INTO R1           33700002
         LR    R5,R14        SAVE RETURN ADDR ACROSS SVC.               33750002
* ISSUE SVC WHICH WILL PLACE MY REGISTERS INTO PROB PROG SVRB           33800002
         IKJEGS9G AGPR,TCBADDR=(R3),VALUE=(R4),MF=(E,(R2))              33850002
         LTR   R15,R15       CHECK RETURN CODE                          33900002
         BZ    TASKCONT      CONTINUE IF ALL OK                         33910002
TASKERR  EQU   *             SVC 97 ERROR PROCESSING                    33912002
         LA    R2,@12        REG 2 IS 12 FOR COMPARISON                 33920002
         CR    R15,R2        COMPARE 12 TO RET CODE                     33930002
         BH    RET           IS GREATER THAN 12, BACK TO MNL            33940002
         B     SVCFAIL       IF 12 OR LESS, PUT OUT ERROR MSG           33942002
TASKCONT EQU   *             CONTINUE PROCESSING                        33944002
*************************************************************           34000002
** AT THIS TIME WE SHOULD HAVE SWITCHED THE PROBLEM PROGRAM**           34050002
** REGISTERS WITH MY REGISTERS.NOW WE CHANGE THE           **           34100002
** INSTRUCTION COUNTER FOUND IN THE PRB                    **           34150002
*************************************************************           34200002
         LA    R5,0(R5)      CLEAR 1ST BYTE OF RESUME ADDRESS           34250002
************************************************************            34300002
**AT THIS POINT REG5 CONTAINS MY RETURN ADDRESS WITHIN THE**            34350002
**MAINLINE PORTION OF THIS PROGRAM. REG3 CONTAINS THE     **            34400002
**PROBLEM PROG TCB ADDRESS WHICH WILL BE SEARCHED FOR A   **            34450002
**PRB. ONCE FOUND THE RPOPSW FIELD WILL BE CHANGED TO     **            34500002
**CONTAIN MY RETURN ADDRESS                               **            34550002
************************************************************            34600002
         IKJEGS9G OPSW,TCBADDR=(R3),VALUE=(R5),MF=(E,(R2))              34650002
         LTR   R15,R15       CHECK RETURN CODE                          34700002
         BNZ   TASKERR       SVC FAILED                                 34750002
*                                                                       34800002
         L     R3,PPRB        ACCESS ADDR OF NEW RB                     34850002
         USING RBSECT,R3      USE REG3 TO ADDRESS REQUEST BLOCK         34900002
         MVC   TSTGO+@4(@1),RBWCF SAVE WAIT COUNT OF NEW RB             34950002
         DROP  R3             DROP REG3                                 35000002
         IKJEGS9G WCF,TCBADDR=(R3),MF=(E,(R2))                          35050002
         LTR   R15,R15        CHECK RETURN CODE                         35100002
         BNZ   TASKERR        SVC FAILED                                35150002
*                                                                       35200002
         LA    R4,I0087      IKJEGLDF INSERT                            35210002
         LA    R5,@8         SVC = 8 FOR LINKFAIL                       35220002
         LOAD  EP=IKJEGLDF,ERRET=LINKFAIL  LOAD MYSELF                  35230002
BLOW8    EQU   *              RESUME ADDR FOR STAE EXIT                 35300002
SMTLOAD2 DS    0H             TEST CASE TTTA7600                        35350002
         XR    R15,R15        ZERO REGISTER                             35400002
         L     R3,OUTBUF      ACCESS PTR TO OUTBUF                      35450002
         ST    R15,@0(R3)     STORE ZEROES IN BUFFER- NO MSG            35500002
         OI    TSTFLGS2,TSTLDF                                          35550002
         LA    R15,@4         PLACE SUCCESSFUL JOB RETURN CODE          35600002
*                             INTO REG15                                35650002
         L     R13,REGSAVE1   RESTORE CALLERS SAVE AREA                 35750002
         RETURN (14,12),RC=(15) RETURN TO MAINLINE TEST                 35800002
         SPACE 1                                                        35850002
SVCFAIL  LR    R4,R10        LOAD REG4 WITH INSERT                      35860002
         LA    R2,M0104      MSG-... FAILED, CMMND SYS ERR              35870002
         LA    R3,M0283      MSG-SVC 97 RET CODE NONZERO                35880002
         BAL   R6,MSG2       GO OUTPUT MESSAGES                         35890002
         B     A18000        RETURN TO MAINLINE                         35892002
         EJECT                                                          36150002
************************************************************            36200002
*                                                                       36250002
*          MISCELLANEOUS SUBROUTINES                                    36300002
*                                                                       36350002
******************************************************************      36400002
PPSTAE   EQU   *                                                        36450002
         L     R1,WORKAREA         ACCESS WORKAREA PTR                  36500002
         MVI   TASKSWF-TSTCWORK(R1),HEXFF  SET TASK SW INDICATOR ON     36510002
         MVC   @0(STAELEN,R1),LISTSTAE LIST FORM OF ESTAE MACRO         36550002
         LA    R10,STAEXIT         STAE EXIT ROUTINE                    36600002
         LR    R3,R14              SAVE RETURN REGISTER                 36650002
         ESTAE (R10),RECORD=YES,MF=(E,(R1))   ISSUE ESTAE               36652002
         LTR   R15,R15             TEST STAE RETURN CODE                36750002
         BZ    PPGOBACK            IF ZERO BRANCH AROUND MSG            36752002
         OI    TSTFLGS4,TSTESTAE   TURN ON TSTESTAE FOR IO              36752402
         LA    R2,M0103            MSG-NOT ENOUGH CORE                  36754002
         LA    R3,ZERO             NO SECOND LEVEL MESSAGE              36756002
         BAL   R6,MSG1             GO OUTPUT MESSAGES                   36758002
         NI    TSTFLGS4,HEXFF-TSTESTAE  TURN OFF TSTESTAE               36808002
         OI    TSTFLGS4,TSTFLUSH   TELL MAINLINE TO FLUSH STACK         36960002
         B     TSTSVC              RETURN VIA SVC                       37020002
PPGOBACK EQU   *                   LOAD R2 AND RETURN                   38210002
         LR    R14,R3              RESTORE RETURN REGISTER              38250002
         L     R2,WORKAREA         INIT REG 2 WITH WORKAREA             38300002
         BR    R14                 RETURN                               38350002
******************************************************************      38400002
GETREGS  EQU   *                                                        38450002
         L     R2,@16              ACCESS PTR TO CVT                    38500002
         USING CVT,R2              ESTABLISH CVT ADDRESSABILITY         38550002
         L     R4,CVTTCBP          ACCESS TCB PTR                       38600002
         L     R4,@4(R4)           ACCESS CURRENT TCB PTR               38650002
         USING TCB,R4              ESTABLISH TCB ADDRESSABILITY         38700002
         L     R9,TCBTRN           ACCESS PTR TO TCOMTAB                38750002
         DROP  R2                  DROP CVT  ADDRESSABILITY             38800002
         BR    R11                 RETURN TO CALLER                     38850002
******************************************************************      38900002
STAEXIT  EQU   *                   STAE EXIT FOR PP                     38950002
         USING STAEXIT,R15         USE ENTRY POINT AS BASE              39000002
         L     R12,BASE            START ADDR OF PROGRAM                39050002
         DROP  R15                 DROP ENTRY POINT ADDRESSABILITY      39100002
         USING BASELOC,R12         ESTABLISH PROGRAM ADDRESSABILITY     39150002
         BAL   R11,GETREGS         TO GET PTR TO TCOMTAB                39200002
         LR    R8,R14              SAVE RETURN ADDRESS                  39202002
         LA    R7,M0058            MSG-... FAILED                       39220002
         LA    R5,M0253            MSG-SYS ABEND CODE ...               39230002
         L     R2,WORKAREA         PTR TO WORKAREA                      39240002
         LA    R3,MSGINSRT-TSTCWORK(R2)  ACCESS WORKAREA FOR INSERT     39240402
         UNPK  @0(@5,R3),TCBCMPC(@3)  PREPARE CODE FOR CONVERT          39240802
         TR    @0(@3,R3),TABLE-@240  CONVERT TO EBCDIC                  39241202
         LA    R6,@7               MESSAGE INSERT LENGTH OF 7           39241702
         STH   R6,MSGINSHD-TSTCWORK(R2)  STORE MESSAGE LENGTH           39241802
         L     R4,MIDHOLD-TSTCWORK(R2) R4=INSERT FOR MSG                39242002
         BAL   R6,MSG6                                                  39244002
         LA    R15,@4              SET RETURN CODE                      39500002
         LA    R0,RETRY2           INDICATE ADDRESS OF RETRY RTN        39550002
         DROP  R4                  DROP TCB  ADDRESSABILITY             39600002
         OI    TSTFLGS4,TSTFLUSH   TELL MAINLINE TO FLUSH STACK         39610002
         BR    R8                  RETURN TO ABEND                      39650002
******************************************************************      39700002
RETRY2   EQU   *                                                        39750002
         USING RETRY2,R15          USE ENTRY POINT AS BASE              39800002
         L     R12,BASE            START ADDR OF PROGRAM                39850002
         DROP  R15                 DROP ENTRY POINT ADDRESSABILITY      39900002
         USING BASELOC,R12         ESTABLISH PROGRAM ADDRESSABILITY     39950002
         BAL   R11,GETREGS         TO GET PTR TO TCOMTAB                40000002
         B     STAEOFF             RETURN VIA SVC                       40300002
******************************************************************      40350002
STAEOFF  EQU   *                                                        40400002
         LR    R2,R15        SAVE RET CODE OVER ESTAE                   40402002
         ESTAE 0             REMOVE ESTAE REQUEST                       40404002
         LR    R15,R2        RESTORE RETURN CODE                        40406002
         NI    TSTFLGS4,HEXFF-TSTRERTN  SHUT OFF RETRY FLAG             40408002
         B     TSTSVC        RETURN VIA SVC                             40458002
******************************************************************      40550002
*  R5 = @ PCL                                                           40600002
* R10 = @ STAE EXIT TAB                                                 40650002
* R11 = POSSIBLE COMMAND SYSTEM ERROR MSG                               40700002
******************************************************************      40750002
STAEPREP EQU   *             EXPAND STAE MACRO                          40800002
         L     R2,WORKAREA   ACCESS ADDR OF WORKAREA                    40950002
         MVI   TASKSWF-TSTCWORK(R2),HEX00  SET TASKSWITCH IND. OFF      40960002
         MVC   CWORKCMD-TSTCWORK(STAELEN,R2),LISTSTAE PUT STAE IN WKA   41000002
         LA    R1,CWORKCMD-TSTCWORK(R2)  PARAMETER TO STAE              41050002
         L     R10,TSTSTAE   ADDR OF STAE EXIT ROUTINE                  41100002
         ST    R12,@68(R13)  SAVE BASE REGISTER                         41150002
         LR    R3,R14        RETAIN RETURN ADDR IN REG 3                41200002
         LR    R8,R14        SAVE RETURN REGISTER                       41250002
         ESTAE (R10),PARAM=(R6),RECORD=YES,MF=(E,(R1))  ISSUE ESTAE     41252002
         LTR   R15,R15       TEST FOR NON ZERO RETURN CODE              41350002
SMTSTAE  DS    0H            TEST CASE TTTA7600                         41400002
         BZ    SETPARM       IF ZERO SETUP FOR PARSE                    41450002
         STC   R15,TSTESTRC  STORE RETURN CODE FROM ESTAE               41452002
         LA    R15,@24       SEND RET CODE=24 TO MAINLINE               41454002
         B     RET1          BRANCH TO RETURN TO MAINLINE               41456002
SETPARM  EQU   *             SET UP PARAMETER LIST FOR PARSE            41600002
         LA    R1,CWORKCMD-TSTCWORK(R2) ACCESS COMMAND PORTION          41650002
         USING PPL,R1        ESTABLISH PPL ADDRESSABILITY               41700002
         MVC   PPLUPT(@4),TSTUPT PTR TO UPT FOR PARSE                   41750002
         MVC   PPLECT(@4),TSTECT PTR TO ECT FOR PARSE                   41800002
         MVC   PPLECB(@4),TSTCPECB PTR TO CP ECB FOR PARSE              41850002
         ST    R5,PPLPCL      PTR TO PCL FOR PARSE                      41900002
         ST    R13,PPLUWA     PTR TO MY SAVE AREA                       41950002
         LA    R3,TSTANSPL    ACCESS ADDR OF ANSWER PLACE               42000002
         ST    R3,PPLANS      PTR TO ANSWER PLACE FOR PARSE             42050002
         MVC   PPLCBUF(@4),INBUF PTR TO COMMAND BUFFER FOR PARSE        42100002
         DROP  R1            DROP PPL ADDRESSABILITY                    42150002
         LA    R5,@6         SVC = 6 FOR LINKFAIL                       42152002
         LA    R4,I0040      PARSE-INSERT FOR POSSIBLE MSG              42160002
         LINK  EP=IKJPARS,ERRET=LINKFAIL LINK TO PARS                   42210002
BLOW1    EQU   *                                                        42250002
SMTPARS  DS    0H            TEST CASE TTTA7600                         42300002
         BAL   R14,CHKCDE    TO CHECK RETURN CODE                       42350002
         LR    R14,R8        RESTORE RETRUN REGISTER                    42400002
         BR    R14           RETURN TO COMMAND PROCESSING               42450002
CHKCDE   EQU   *                                                        42500002
         B     RETCDTAB(R15) BRANCH ACCORDING TO CODE                   42550002
RETCDTAB BR    R14           BRANCH BACK OF CODE = 0                    42600002
         BR    R14           FOR ALIGNMENT PURPOSES                     42650002
         B     RETCDE4       RETURN CODE = 4                            42700002
         B     RETCDE8       RETURN CODE = 8                            42750002
         B     RETCDE12      RETURN CODE = 12                           42800002
         B     RETCDE16      RETURN CODE = 16                           42850002
         B     RETCDE20      RETURN CODE = 20                           42900002
*                                                                       42950002
RETCDE20 EQU   *             ENTER IF RETURN CODE = 20                  43000002
         L     R15,CODESAVE-TSTCWORK(R2) ACCESS SAVED RETURN CODE       43050002
         LA    R14,@16       TO TEST RETURN CODE                        43100002
         CR    R15,R14       TEST RETURN CODE                           43150002
         BE    RET           RETURN 16 TO MAINLINE                      43200002
         BH    SEND20        RETURN 20 TO MAINLINE                      43250002
RETCDE4  EQU   *             ENTER FOR R. C. OF 4 (UNABLE TO PROMPT)    43300002
         OI    TSTFLGS4,TSTFLUSH TELL MNLINE TO FLUSH STACK             43350002
         XR    R15,R15       RETURN 0 TO MAINLINE                       43400002
         B     RET           RETURN TO MAINLINE                         43450002
SEND20   EQU   *                                                        43500002
         LA    R15,@20       RETURN CODE OF 20 TO MAINLINE              43550002
         B     RET           RETURN TO MAINLINE                         43600002
RETCDE12 EQU   *             ENTER IF PARSE RET CODE = 12               43650002
* INVALID PARMS FROM SUBCOMMAND                                         43660002
         LA    R3,M0277      MSG-PARSE ERROR CODE 12                    43670002
         LA    R2,M0104      MSG-... FAILED COMMND SYS ERR              43680002
         LR    R4,R11        LOAD REG4 WITH INSERT                      43690002
         BAL   R6,MSG2       GO OUTPUT MESSAGES                         43692002
         B     A18000        RETURN TO MAINLINE                         43694002
RETCDE16 EQU   *             ENTER IF R. C. = 16 (NO STORAGE FOR PDE)   43950002
         LA    R2,M0103      MSG-NOT ENOUGH MAIN STOR.                  43960002
         LA    R3,ZERO       NO SECOND LEVEL MESSAGE                    43962002
         BAL   R6,MSG1       GO OUTPUT MESSAGES                         43980002
         B     A18000        COMMON MSG OUTPUT ROUTINE                  44050002
RETCDE8  EQU   *             ENTER IF PARSE RET CODE = 8 (ATTENTION)    44100002
         LA    R15,@16       SET RETURN CODE TO MAINLINE                44150002
         B     RET           RETURN TO MAINLINE                         44200002
******************************************************************      44250002
RETRY    EQU   *             STAE RETRY ENTRY POINT                     44300002
         L     R2,@16        ACCESS PTR TO CVT                          44350002
         USING CVT,R2        ESTABLISH CVT ADDRESSABILITY               44400002
         L     R3,CVTTCBP    ACCESS TCB PTR                             44450002
         L     R3,@4(R3)     ACCESS CURRENT TCB PTR                     44500002
         USING TCB,R3        ESTABLISH TCB ADDRESSABILITY               44550002
         L     R9,TCBTRN     PTR TO TCOMTAB                             44600002
         L     R13,REGSAVE2  ACCESS SAVE AREA                           44650002
         L     R12,@68(R13)  ACCESS BASE REGISTER                       44700002
         DROP  R2            DROP CVT ADDRESSABILITY                    44750002
         DROP  R3            DROP TCB ADDRESSABILITY                    44800002
         NI    TSTFLGS2,HEXFF-TSTLDF TURN OF LDF FLAG                   45100002
         LA    R15,@20       RETURN CODE TO MAINLINE                    45150002
         OI    TSTFLGS4,TSTFLUSH   TELL MAINLINE TO FLUSH STACK         45160002
         B     RET           RETURN TO MAINLINE                         45200002
******************************************************************      45250002
A18000   EQU   *             EQUATE LABEL TO THIS ADDRESS               46800002
         OI    TSTFLGS4,TSTFLUSH   TELL MAINLINE TO FLUSH STACK         46850002
         CH    R15,ATTNCODE  COMPARE RET CODE TO 16                     46900002
         BNL   RET           RET WITH CODE NOT LESS 16                  46950002
GOHOME   EQU   *                                                        47150002
         SR    R15,R15       SEND BACK ZERO RETRUN CODE                 47152002
RET      EQU   *             REMOVE ESTAE AND RETURN                    47154002
         LR    R2,R15        SAVE RET CODE OVER ESTAE                   47156002
         ESTAE 0             REMOVE ESTAE REQUEST                       47158002
         LR    R15,R2        RESTORE RETURN CODE                        47158402
         NI    TSTFLGS4,HEXFF-TSTRERTN  SHUT OFF RETRY FLAG             47158802
RET1     EQU   *             RETURN TO MAINLINE                         47159202
         L     R13,@4(R13)   RESTORE SAVE AREA ADDR                     47200002
         RETURN (14,12),RC=(15) RETURN TO CALLER                        47250002
         EJECT                                                          47300002
******************************************************************      47350002
*          VALIDITY CHECK ROUTINES FROM PARSE                           47400002
*           (1) LOADVLCK - LOAD VALIDITY CHECK RTN                      47450002
*           (2) ADDRVLCK - FREEMAIN VALIDITY CHECK RTN                  47500002
******************************************************************      47550002
LOADVLCK EQU   *             LOAD VALIDITY CHECK ROUTINE                47600002
         SAVE  (14,12)       SAVE CALLERS REGISTERS                     47650002
         DROP  R12           DROP R12 AS BASE REGISTER                  47700002
         USING LOADVLCK,R15  USE ENTRY POINT AS BASE REGISTER           47750002
         L     R2,@4(R1)     PLACE ADDRESS IF MY SAVEAREA INTO R2       47800002
         LM    R3,R12,@32(R2) RELOAD MY REGISTERS FROM SAVEAREA         47850002
         DROP  R15           DROP R15 AS BASE REGISTER                  47900002
         USING BASELOC,R12   USE REG12 AS BASE REGISTER                 47950002
         L     R3,REGSAVE3   GET MY SAVE AREA ADDRESS FROM TCOMTAB      48000002
         ST    R13,@4(R3)    PLACE BACK POINTER INTO MY REG             48050002
         LR    R13,R3        POINT R13 TO MY REGISTERS SAVE             48100002
         SR    R14,R14       CLEAR REG 14                               48110002
         L     R4,OUTBUF     ACCESS OUTBUF                              48120002
         ST    R14,ZERO(R4)  CLEAR 1ST WORD OF OUTBUF                   48130002
         L     R10,@0(R1)    ACCESS ADDRESS OF PDE                      48150002
         USING PARDSECT,R10  ESTABLISH PDE ADDRESSABILITY               48200002
         L     R2,WORKAREA   ACCESS PTR TO WORKAREA                     48250002
         TM    FLAGS2,HEX80  TEST FOR PRESENCE OF MEMBERNAME            48300002
         BNO   INVLDMSG      BRANCH TO PUT OUT DIAGNOSTIC               48350002
         MVI   PASSWORD-TSTCWORK(R2),BLANK MOVE IN BLANK                48400002
         MVC   PASSWORD-TSTCWORK+@1(@7,R2),PASSWORD-TSTCWORK(R2) BLANK  48450002
         TM    FLAGS3,HEX80  TEST FOR PRESENCE OF PASSWORD              48500002
         BNO   GOPARSE       BRANCH TO RETURN                           48550002
         LH    R4,LENGTH3    ACCESS LENGTH OF PASSWORD                  48600002
         BCTR  R4,R0         DECREMENT FOR EXECUTE                      48650002
         L     R5,PSWRDPTR   ACCESS ADDR OF ADDR STRING                 48700002
         EX    R4,MOVEPASS   PUT PASSWOR IN WORKAREA                    48750002
GOPARSE  SR    R15,R15       ZERO RETURN CODE                           48760002
         B     A16030        BRANCH TO RETURN                           48800002
INVLDMSG EQU   *             PUT OUT DIAGNOSTIC MSG                     48850002
         LA    R2,M0048      MSG-MEMBER NAME MISSING                    48860002
         LA    R3,ZERO       NO SECOND LEVEL MESSAGE                    48862002
         BAL   R6,MSG1       GO OUTPUT MESSAGES                         48880002
         B     GOIO          GO CHECK RETURN CODE                       48890002
         SPACE                                                          49000002
ADDRVLCK EQU   *             FREEMAIN VALIDITY CHECK ROUTINE            49050002
         SAVE  (14,12)       SAVE REG                                   49100002
         DROP  R12           REMOVE REG12 AS BASE REG                   49150002
         USING ADDRVLCK,R15  USE REG15 AS BASE REG                      49200002
         L     R2,@4(R1)     PLACE ADDRESS OF MY SAVEAREA INTO R2       49250002
         LM    R3,R12,@32(R2) LOAD BACK MY REGISTERS FROM SAVEAREA      49300002
         DROP  R15           REMOVE REG15 AS BASE REG                   49350002
         USING BASELOC,R12   USE REG12 AS BASE REG                      49400002
         L     R3,REGSAVE3   GET MY SAVE AREA ADDRESS FROM TCOMTAB      49450002
         ST    R13,@4(R3)    PLACE BACK POINTER INTO MY REG             49500002
         LR    R13,R3        POINT R13 TO MY REGISTERS                  49550002
         SR    R14,R14       CLEAR REG 14                               49560002
         L     R4,OUTBUF     ACCESS OUTBUF                              49570002
         ST    R14,ZERO(R4)  CLEAR 1ST WORD OF OUTBUF                   49580002
         OI    TSTFLGS4,TSTVALCK SET VALIDITY FLAG ON FOR IO            49590002
         L     R10,@0(R1)    PLACE ADDRESS OF PDE INTO R10              49600002
         L     R2,WORKAREA   ACCESS PTR TO WORKAREA                     49650002
         LA    R3,@8(R1)     CREATE PTR TO PARSE PARAM                  49700002
         ST    R3,MSGADDR-TSTCWORK(R2) FUTURE PTR TO 2ND MSG            49750002
         USING IKJPARMA,R10    USE REG10 TO ADDRESS PDE                 49800002
A15000   EQU   *             EQUATE LABEL TO THIS ADDRESS               49850002
         TM    PDEFLG2,CTNAMFLG SEE IF ENTRY NAME WAS SPECIFIED         49900002
         BNO   A15001        IF NOT THEN ALL OK SO FAR                  49950002
         TM    PDEFLG4,SYMADDR+RELADDR TEST FOR SYMBOLIC/RELATIVE ADDR  50000002
         BM    A15010        IF ADDR THEN BRANCH                        50050002
         LA    R1,M0252      MSG-INVALID QUAL ADDR                      50060002
         B     ADDRMSG       BRANCH TO PUT ERROR MSG OUT                50150002
A15001   EQU   *             EQUATE LABEL TO THIS ADDRESS               50200002
         TM    PDEFLG4,SYMADDR  TEST FOR SYMBOLIC ADDR                  50250002
         BO    A15010        BRANCH IF SYMBOL SPECIFIED                 50300002
         TM    PDEFLG4,ABSCOMPL                                         50350002
         BZ    A15010        IF IT WAS THEN BRANCH TO GO TO CONVERT     50400002
A15002   EQU   *             EQUATE LABEL TO THIS ADDRESS               50450002
         TM    PDEFLG4,RELADDR  CHECK FORA A RELATIVE ADDRESS           50500002
         BNO   A15003        IF NOT RELATIVE THEN BRANCH                50550002
         B     A15010        BRANCH TO CONVERT ADDR AND CONTINUE        50600002
A15003   EQU   *             EQUATE LABEL TO THIS ADDRESS               50650002
         TM    PDEFLG4,GENR  CHECK FOR REGISTER NOTATION                50700002
         BNO   A15004        IF NOT REG NOTATION THEN BRANCH            50750002
         LH    R4,PDEINDCT   OTHERWISE LOAD INDIRECT COUNT INTO R4      50800002
         LTR   R4,R4         SEE IF INDIRECT COUNT WAS SPECIFIED        50850002
         BNZ   A16010        IF SPECIFIED THEN BRANCH ALL OK SO FAR     50900002
A15004   EQU   *             EQUATE LABEL TO THIS ADDRESS               50950002
         LA    R1,M0274      MSG-REG MUST BE INDRCT GEN REG             50960002
*                            THEREFORE LOAD ERROR MSG AND BRANCH        51050002
ADDRMSG  EQU   *             PREPARE INVALID ADDRESS MSG                51100002
         LA    R2,M0101      MSG-INVALID ADDRESS                        51110002
         LR    R3,R1         REG3 IS SECOND LEVEL MSG                   51120002
         LR    R4,R10        REG4 IS ADDRESS OF PDE                     51130002
         BAL   R6,MSG3       GO OUTPUT MESSAGES                         51140002
GOIO     L     R2,WORKAREA   ACCESS PTR TO WORKAREA                     51140402
         ST    R15,CODESAVE-TSTCWORK(R2) STORE RETURN CODE              51142002
         CH    R15,ATTNCODE  COMPARE RET CODE TO 16                     51192002
         LA    R15,@12       IF EQUAL RETURN CODE OF 16                 52600002
         BNL   A16030        IF RETURN CODE EQUAL 16                    52650002
         LA    R15,@8        TELL PARSE TO SIGNAL REENTER               52700002
A16030   EQU   *             EQUATE LABEL TO THIS ADDRESS               52750002
         L     R4,OUTBUF     ACCESS OUTBUF                              52760002
         L     R4,ZERO(R4)   ACCESS 1ST WORD OF OUTBUF                  52770002
         LTR   R4,R4         IS THERE A SECOND LEVEL MESSAGE            52780002
         BZ    PARSRET       NO, RETURN TO PARSE                        52790002
         L     R8,WORKAREA   ACCESS WORKAREA POINTER                    52792002
         L     R11,MSGADDR-TSTCWORK(R8) GET PTR TO PARSE PARM LIST      52794002
         MVC   @0(@4,R11),OUTBUF ADDR OF SECOND LEVEL MSG TO LIST       52796002
PARSRET  EQU   *             RETURN TO PARSE                            52798002
         NI    TSTFLGS4,HEXFF-TSTVALCK SHUT OFF VALIDITY FLAG           52798402
         L     R13,@4(R13)   RESTORE USER REG                           52800002
         L     R5,INBUF      PLACE INPUT BUFFER POINTER IN R5           52850002
         LA    R6,CWORKCMD-TSTCWORK(R2) COMMAND PORTION OFWORK @YM07111 52900002
        ST    R5,PPLCBUF-PPL(R6) RESTORE POINTER IN PARSE PARM LIST     52950002
         RETURN (14,12),RC=(15)     RETURN TO CALLER                    53000002
A16010   EQU   *             EQUATE LABEL TO THIS ADDRESS               53050002
A15010   EQU   *             EQUATE LABEL TO THIS ADDRESS               53100002
         LR    R1,R10        PALCE POINTER TO PDE INTO R1               53150002
*                            CONVERT TO LOCATE                          53200002
         LCR   R1,R1         LOAD COMPLIMENT OF R1 AS INDICATOR TO CVT  53250002
         L     R15,TSTCONVT  PLACE ADDR OF CONVERT INTO R15             53300002
         BALR  R14,R15       BRANCH TO CONVERT TO GET BINARY ADDR       53350002
         B     CONVTAB(R15)  BRANCH ACCORDING TO RETURN CODE            53400002
CONVTAB  B     CONTINUE      IF RETURN CODE = 0                         53450002
         B     CONVMSG       IF RETURN CODE = 4                         53500002
         B     SYMSTAE       IF RETURN CODE = 8                         53550002
         B     SYMSTAE       IF RETURN CODE = 12                        53600002
         B     SYMSTAE       IF RETURN CODE = 16                        53650002
         B     SYMSTAE       IF RETURN CODE = 20                        53700002
CONTINUE EQU   *             CONTINUE HERE IF RETURN CODE = 0           53750002
         L     R11,PDEUSER   ACCESS USERWORD                            53800002
         LTR   R11,R11       DETERMINE IF SYMBOLIC ADDR                 53850002
         LA    R11,@0(R11)   TURN HIERARCHY BIT                         53900002
         BH    RESCHK        USERWORD NOT FROM SYM, BRANCH              53950002
         L     R11,@0(R11)   ACCESS SYMBOL                              54000002
         ST    R11,PDEUSER   STORE ADDR IN USERWORD                     54050002
RESCHK   EQU   *             RESUME CHECK PROCEDURE                     54100002
         SR    R15,R15       PLACE ZERO RETURN CODE IN R15              54150002
         TM    PDEUSER+@3,HEX07 CHECK LOW ORDER BYTE OF BINARY          54200002
*                            ADDRESS FOR '000' TO SEE IF IT IS ON       54250002
*                            A DOUBLEWORD BOUNDARY                      54300002
         BZ    A16030        IF ZERO THEN IT IS ON AN INTEGRAL BDY      54350002
         LA    R2,M0101      MSG-INVALID ADDRESS                        54360002
         LA    R3,M0280      MSG-DOUBLEWORD BOUNDRY REQ.                54370002
         LR    R4,R10        ADDRESS INSERT TO REG4                     54380002
         LA    R5,I0004      DOUBLE-INSERT                              54382002
         BAL   R6,MSG4       GO OUTPUT MESSAGES                         54390002
         B     GOIO          GO CHECK RETURN CODE                       54392002
CONVMSG  EQU   *             ENTER HERE IF RETURN CODE = 4              54500002
         LA    R15,@8        SET RETURN CODE TO PARSE (PROMPT)          54550002
         B     A16030        RETURN TO PARSE                            54750002
SYMSTAE  EQU   *             ENTER HERE IF RETURN CODE = 20             55000002
         L     R8,WORKAREA   ACCESS PTR TO WORKAREA                     55050002
         ST    R15,CODESAVE-TSTCWORK(R8) STORE RETURN CODE              55100002
         LA    R15,@12       SET RETURN CODE TO PARSE                   55150002
         B     A16030        RETURN TO PARSE                            55200002
         EJECT                                                          55300002
* THE FOLLOWING ARE MESSAGE OUTPUTTING ROUTINES                         55310002
         SPACE                                                          55320002
MSG1     XC    TSTIOPRM,TSTIOPRM CLEAR PARAMETER AREA                   55330002
         IKJEGSIO MSG,FIRST=(R2),SECOND=(R3),ID=LDF17,                 *55340002
               MF=(E,TSTIOPRM)  CALL IO                                 55342002
         BR    R6            RETURN                                     55344002
         SPACE                                                          55346002
MSG2     XC    TSTIOPRM,TSTIOPRM CLEAR PARAMETER AREA                   55348002
         IKJEGSIO MSG,FIRST=(R2),INST11=(NUM,(R4)),SECOND=(R3),        *55348402
               ID=LDF17,MF=(E,TSTIOPRM)  CALL IO                        55348802
         BR    R6            RETURN                                     55349202
         SPACE                                                          55349602
MSG3     XC    TSTIOPRM,TSTIOPRM CLEAR PARAMETER AREA                   55349702
         IKJEGSIO MSG,FIRST=(R2),INST11=(APDE,(R4)),SECOND=(R3),       *55349802
               ID=LDF17,MF=(E,TSTIOPRM)  CALL IO                        55350002
         BR    R6            RETURN                                     55366602
         SPACE                                                          55376602
MSG4     XC    TSTIOPRM,TSTIOPRM CLEAR PARAMETER AREA                   55378602
         IKJEGSIO MSG,FIRST=(R2),INST11=(APDE,(R4)),SECOND=(R3),       *55380602
               INST21=(NUM,(R5)),ID=LDF17,MF=(E,TSTIOPRM) CALL IO       55381002
         BR    R6            RETURN                                     55383002
         SPACE                                                          55383102
MSG5     XC    TSTIOPRM,TSTIOPRM CLEAR PARAMETER AREA                   55383202
         IKJEGSIO MSG,FIRST=(R2),INST11=(REG,(R4)),ID=LDF17,           *55388802
               MF=(E,TSTIOPRM)  CALL IO                                 55390802
         BR    R6            RETURN                                     55392802
         SPACE                                                          55393202
MSG6     XC    TSTIOPRM,TSTIOPRM CLEAR PARAMETER AREA                   55393302
         IKJEGSIO MSG,FIRST=(R7),INST11=(NUM,(R4)),SECOND=(R5),        *55393402
               INST21=(ADDR,MSGINSHD-TSTCWORK(R2)),ID=LDF17,           *55395602
               MF=(E,TSTIOPRM)  CALL IO                                 55396002
         BR    R6            RETURN                                     55396502
         SPACE                                                          55398502
LINKFAIL LR    R2,R1         ABEND CODE TO REG 2                        55400202
         LR    R3,R15        RET CODE TO REG 3                          55403202
         XC    TSTIOPRM,TSTIOPRM CLEAR PARAMETER AREA                   55406202
         IKJEGSIO SVCERR,SVC=(R5),ABENDRG=(R2),RC=(R3),                *55411202
               INST11=(NUM,(R4)),ID=LDF17,MF=(E,TSTIOPRM)               55412202
TESTRC   L     R2,WORKAREA   ADDRESSABILITY TO WORKAREA                 55412302
         CLI   TASKSWF-TSTCWORK(R2),HEXFF  TEST FOR TASK SWITCH         55412602
         BE    STAEOFF       YES, RETURN VIA TSTSVC                     55413002
         CH    R15,ATTNCODE  IS RET CODE LESS THAN 16                   55414202
         BNL   RET           NO, RETURN TO MAINLINE                     55414602
         B     GOHOME        YES, RETURN TO MAINLINE, RC=0              55415002
         SPACE                                                          55418202
GETERR   LR    R3,R15        RET CODE TO REG 3                          55420602
         XC    TSTIOPRM,TSTIOPRM CLEAR PARAMETER AREA                   55421002
         IKJEGSIO SVCERR,SVC=(R4),RC=(R3),                             *55421402
               ID=LDF17,MF=(E,TSTIOPRM)  CALL IO                        55421802
         B     TESTRC        BRANCH TO TEST RET CODE                    55425502
         SPACE                                                          55437102
LOADFAIL LR    R3,R15        RET CODE TO REG 3                          55447102
         LR    R2,R1         ABEND CODE TO REG 2                        55457102
         XC    TSTIOPRM,TSTIOPRM  CLEAR PARAMETER AREA                  55459102
         IKJEGSIO SVCERR,SVC=8,ABENDRG=(R2),RC=(R3),                   *55461102
               ID=LDF17,MF=(E,TSTIOPRM)  CALL IO                        55463102
         B     TESTRC        BRANCH TO TEST RET CODE                    55465102
         SPACE                                                          55465502
SPLISTLD IKJEGSPL RTRY=RETRY,ABNTB=STAELOAD,MODNM=IKJEGLDF,            *55465902
               TNM=LOAD      BUILD ESTAE PARAMETER LIST                 55466302
SPLISTDL IKJEGSPL RTRY=RETRY,ABNTB=STAEDEL,MODNM=IKJEGLDF,             *55466402
               TNM=DELETE    BUILD ESTAE PARAMETER LIST                 55466502
SPLISTGT IKJEGSPL RTRY=RETRY,ABNTB=STAEGET,MODNM=IKJEGLDF,             *55466602
               TNM=GETMAIN   BUILD ESTAE PARAMETER LIST                 55477702
SPLISTFR IKJEGSPL RTRY=RETRY,ABNTB=STAEFREE,MODNM=IKJEGLDF,            *55487702
               TNM=FREEMAIN  BUILD ESTAE PARAMETER LIST                 55488102
         EJECT                                                          55555602
MEMMOVE  MVC   @4(@1,R11),@0(R6) MOVE NAME INTO LIST                    55566702
DELMOVE  MVC   CWORKCMD-TSTCWORK(@0,R2),@0(R5)  MOVE NAME TO WORKAREA   55577802
A13000   PACK  @0(@8,R2),@0(@1,R1) PACK INTEGER INTO WORKAREA           55588902
MOVEPASS MVC   PASSWORD-TSTCWORK(@1,R2),@0(R5) MOVE PASSWORD            55600002
MOVEDSN  MVC   @2(@1,R3),@0(R6) MOVE DSNAME FOR DEFAULT PARM BLOCK      55800002
         USING SYMDSECT,R7                                              55850002
SYMCOMP  CLC   SYMBOL(@1),@0(R8) COMPARE SYMBOLS                        55900002
SYMMVC   MVC   SYMBOL(@0),@0(R8) MOVE SYMBOL FROM PDE TO SYMTABLE       55950002
PCLGET   DC    V(IKJEGGTM)   ADDR OF PCL DSECT FOR GETMAIN              56000002
PARSEIT  DC    V(IKJEGFRL)   ADDR OF PCL DSECT FOR FREEMAIN             56050002
PARSEDEL DC    V(IKJEGDLT)   ADDR OF PCL CSECT FOR DELETE               56100002
LOADPARS DC    V(IKJEGLDP)   ADDR OF PCL CSECT FOR LOAD                 56150002
         SPACE 1                                                        56200002
BASE     DC    A(BASELOC)    ADCON WHICH CONTAINS BEGINNING ADDRESS     56250002
REGCODE  DC    X'FF000000'   CODE FOR SVC 97                            56300002
         DS    0F                                                       56350002
LSTDSCP  DC    X'0001004C'   LIST DESCRIPTOR FIELD FOR BLDL LIST        56400002
         DS    0F                                                       56450002
BYTEX04  DC    X'04000000'   CODE TO SVC 97                             56500002
BYTEX08  DC    X'08000000'   HEX 08 TO TEST MASK WITH                   56550002
BYTEX01  DC    X'01000000'   HEX 40 TO TEST MASK WITH                   56600002
DAIR2C   DC    X'002C'       CODE TO DAIR                               56850002
FLG2C    DC    X'0001'       DAIR FLAG TO INDICATE DDN NOT IN USE       56900002
ATTNCODE DC    H'16'         ATTENTION RETURN CODE                      56950002
TABLE    DC    C'0123456789ABCDEF'  TRANSLATE TABLE                     57000002
         SPACE 1                                                        57900002
GETLIST  GETMAIN MF=L        LIST FORM OF THE GETMAIN MACRO             57950002
LISTSIZE EQU   *-GETLIST     GET ACTUAL SIZE OF THE LIST                58000002
         SPACE 1                                                        58050002
MYDCB    DCB   DSORG=PO,MACRF=(R)                                       58100002
         SPACE 1                                                        58150002
CLFORM   CLOSE (CLFORM),MF=L                                            58200002
         SPACE 1                                                        58250002
LFORM    OPEN  (,(INPUT)),MF=L                                          58300002
         SPACE 3                                                        58310002
CONSTANT DC    60C'Z'        PATCH AREA                                 58320002
         EJECT                                                          58350002
************************************************************            58400002
*                                                          *            58450002
*                  PARSE MACROS FOR FREEMAIN               *            58500002
*                                                          *            58550002
************************************************************            58600002
IKJEGFRL IKJPARM  DSECT=A                                               58650002
         SPACE 1                                                        58700002
FREEMAN1 IKJIDENT 'NUMBER',FIRST=NUMERIC,OTHER=NUMERIC,PROMPT='INTEGER' 58750002
         SPACE 1                                                        58800002
FREEMAN2 IKJPOSIT ADDRESS,PROMPT='ADDRESS',VALIDCK=ADDRVLCK             58850002
         SPACE 1                                                        58900002
FREEMAN3 IKJKEYWD                                                       58950002
         SPACE 1                                                        59000002
         IKJNAME  'SP',SUBFLD=SUBPOOL                                   59050002
         SPACE 1                                                        59100002
SUBPOOL IKJSUBF                                                         59150002
         SPACE 1                                                        59200002
FREEMAN4 IKJIDENT 'NUMBER',FIRST=NUMERIC,OTHER=NUMERIC,                *59250002
               PROMPT='SUBPOOL NUMBER'                                  59260002
         SPACE 1                                                        59300002
         IKJENDP                                                        59350002
         EJECT                                                          59400002
************************************************************            59450002
*                                                          *            59500002
*                  PARSE MACROS FOR GETMAIN                *            59550002
*                                                          *            59600002
************************************************************            59650002
IKJEGGTM IKJPARM  DSECT=B                                               59700002
         SPACE 1                                                        59750002
GETMAIN1 IKJIDENT 'NUMBER',FIRST=NUMERIC,OTHER=NUMERIC,                *59800002
               MAXLNTH=8,PROMPT='INTEGER'                               59810002
         SPACE 1                                                        59850002
GETMAIN2 IKJKEYWD                                                       59900002
         SPACE 1                                                        59950002
GETMAIN3 IKJNAME  'SP',SUBFLD=GETMAIN4                                  60000002
         SPACE 1                                                        60050002
GETMAIN6 IKJKEYWD                                                       60100002
         SPACE 1                                                        60150002
GETMAIN7 IKJNAME    'EQUATE',SUBFLD=GETMAIN8                            60200002
         SPACE 1                                                        60250002
GETMAIN4 IKJSUBF                                                        60300002
         SPACE 1                                                        60350002
GETMAIN5 IKJIDENT 'NUMBER',FIRST=NUMERIC,OTHER=NUMERIC,                J60400002
               PROMPT='SUBPOOL NUMBER'                                  60450002
         SPACE 1                                                        60500002
GETMAIN8 IKJSUBF                                                        60550002
         SPACE 1                                                        60600002
GETMAIN9 IKJIDENT   'SYMBOL',FIRST=ALPHA,OTHER=ALPHANUM,               *60650002
               PROMPT='SYMBOL',MAXLNTH=8                                60660002
         SPACE 1                                                        60700002
         IKJENDP                                                        60750002
         EJECT                                                          60800002
************************************************************            60850002
*                                                          *            60900002
*                  PARSE MACROS FOR DELETE                 *            60950002
*                                                          *            61000002
************************************************************            61050002
IKJEGDLT IKJPARM  DSECT=C                                               61100002
         SPACE 1                                                        61150002
PARSE1   IKJIDENT 'NAME',FIRST=ALPHA,OTHER=ALPHANUM,                   X61200002
               PROMPT='PROGRAM NAME'                                    61250002
         SPACE 1                                                        61300002
         IKJENDP                                                        61350002
         EJECT                                                          61400002
************************************************************            61450002
*                                                          *            61500002
*                  PARSE MACROS FOR LOAD                   *            61550002
*                                                          *            61600002
************************************************************            61650002
IKJEGLDP IKJPARM  DSECT=D                                               61700002
         SPACE 1                                                        61750002
PARSE2   IKJPOSIT DSNAME,                                              J61800002
               PROMPT='PROGRAM NAME AS FULLY QUALIFIED DSNAME',        X61850002
               VALIDCK=LOADVLCK                                         61900002
         SPACE 1                                                        61950002
         IKJENDP                                                        62000002
         EJECT                                                          62050002
************************************************************            62100002
*                                                          *            62150002
*                           EQUATES                        *            62200002
*                                                          *            62250002
************************************************************            62300002
R0       EQU   0             REG.  0                                    62350002
R1       EQU   1             REG.  1                                    62400002
R2       EQU   2             REG.  2                                    62450002
R3       EQU   3             REG.  3                                    62500002
R4       EQU   4             REG.  4                                    62550002
R5       EQU   5             REG.  5                                    62600002
R6       EQU   6             REG.  6                                    62650002
R7       EQU   7             REG.  7                                    62700002
R8       EQU   8             REG.  8                                    62750002
R9       EQU   9             REG.  9                                    62800002
R10      EQU   10            REG. 10                                    62850002
R11      EQU   11            REG. 11                                    62900002
R12      EQU   12            REG. 12                                    62950002
R13      EQU   13            REG. 13                                    63000002
R14      EQU   14            REG. 14                                    63050002
R15      EQU   15            REG. 15                                    63100002
CHANGEO  EQU   97            SVC 97                                     63150002
HEX01    EQU   X'01'         X'01'                                      63200002
F0       EQU   X'F0'         X'F0'                                      63250002
B7       EQU   X'B7'         X'B7'                                      63300002
BLANK    EQU   X'40'         X'40'                                      63350002
ZERO     EQU   0             EQUATE ZERO TO 0                           63400002
@164     EQU   164           164                                        63450002
TWELVE   EQU   12            12                                         63500002
@64      EQU   64            64                                         63550002
@232     EQU   232           232                                        63600002
@20      EQU   20            20                                         63650002
SIXFOUR  EQU   64            64                                         63700002
TEN      EQU   10            10                                         63750002
ONE      EQU   1             1                                          63800002
@0       EQU   0             NO.  0                                     63850002
@1       EQU   1             NO.  1                                     63900002
@2       EQU   2             NO.  2                                     63950002
@3       EQU   3             NO.  3                                     64000002
@4       EQU   4             NO.  4                                     64050002
@5       EQU   5             NO.  5                                     64100002
@6       EQU   6             NO.  6                                     64150002
@7       EQU   7             NO.  7                                     64200002
@8       EQU   8             NO.  8                                     64250002
@9       EQU   9             NO.  9                                     64300002
@12      EQU   12            NO. 12                                     64350002
@13      EQU   13            NO. 13                                     64400002
@14      EQU   14            NO. 14                                     64450002
@16      EQU   16            NO. 16                                     64500002
@17      EQU   17            NO. 17                                     64550002
@152     EQU   152           NO. 152                                    64560002
@21      EQU   21            NO. 21                                     64600002
@22      EQU   22            NO. 22                                     64650002
@24      EQU   24            NO. 24                                     64700002
@26      EQU   26            NO. 26                                     64750002
@32      EQU   32            NO. 32                                     64800002
@33      EQU   33            NO. 33                                     64850002
@36      EQU   36            NO. 36                                     64900002
@38      EQU   38            NO. 38                                     64950002
@40      EQU   40            NO. 40                                     65000002
@43      EQU   43            NO. 43                                     65050002
@44      EQU   44            NO. 44                                     65100002
@52      EQU   52            NO. 52                                     65150002
@68      EQU   68            NO. 68                                     65200002
@76      EQU   76            NO. 76                                     65250002
@88      EQU   88            NO. 88                                     65300002
@92      EQU   92            NO. 92                                     65350002
@95      EQU   95            NO. 95                                     65400002
@96      EQU   96            NO. 96                                     65450002
@104     EQU   104           NO. 104                                    65460002
@108     EQU   108           NO. 108                                    65470002
@112     EQU   112           NO. 112                                    65480002
@116     EQU   116           NO. 116                                    65490002
@120     EQU   120           NO. 120                                    65492002
@124     EQU   124           NO. 124                                    65492402
@136     EQU   136           NO. 136                                    65494002
@140     EQU   140           NO. 140                                    65496002
@144     EQU   144           NO. 144                                    65498002
@148     EQU   148           NO. 148                                    65498402
@156     EQU   156           NO. 156                                    65498802
@240     EQU   240           NO. 240                                    65500002
FULLQUAL EQU   X'40'         X'40'                                      65550002
HEX00    EQU   X'00'         X'00'                                      65600002
HEX10    EQU   X'10'         X'10'                                      65650002
HEX08    EQU   X'08'         X'08'                                      65700002
HEX07    EQU   X'07'         X'07'                                      65750002
HEX20    EQU   X'20'         X'20'                                      65800002
HEXFF    EQU   X'FF'         X'FF'                                      65850002
HEX80    EQU   X'80'         X'80'                                      65900002
HEX40    EQU   X'40'         X'40'                                      65950002
HEX04    EQU   X'04'         X'04'                                      66000002
C8       EQU   C'8'          X'8'                                       66050002
PLUS     EQU   X'4E'         X'4E'                                      66100002
* THE FOLLOWING ARE FIRST LEVEL MESSAGE NUMB. EQUATES.                  66110002
M0045    EQU   45            UNABLE TO LOAD PROGRAM                     66120002
M0046    EQU   46            STORAGE AT ...                             66122002
M0047    EQU   47            0 BYTES IS INVAL CNT FOR GETMAIN           66130002
M0048    EQU   48            MEMBER NAME MISSING, RESPECIFY             66140002
M0049    EQU   49            ENTRY POINT AT ...                         66142002
M0058    EQU   58            ... FAILED                                 66144002
M0101    EQU   101           INVALID ADDRESS ...                        66146002
M0103    EQU   103           NOT ENOUGH MAIN STORAGE                    66148002
M0104    EQU   104           ... FAILED, COMMAND SYS. ERR.              66148402
* THE FOLLOWING ARE 2ND LEVEL MESSAGE NUMB. EQUATES.                    66148802
M0249    EQU   249           OPEN ERROR                                 66149202
M0250    EQU   250           BLDL ERROR CODE 4                          66149602
M0251    EQU   251           PROGRAM NOT ON LOAD LIST                   66149702
M0252    EQU   252           INVALID QUALIFIED ADDRESS                  66149802
M0253    EQU   253           SYSTEM ABEND CODE ...                      66149902
M0274    EQU   274           REG NOT. MUST BE INDRCT GEN REG            66166602
M0277    EQU   277           PARSE ERROR CODE 12                        66176602
M0280    EQU   280           DOUBLEWORD BOUNDARY REQUIRED               66178602
M0283    EQU   283           SVC 97 RET CODE NONZERO                    66180602
M0297    EQU   297           BLDL ERROR CODE 8                          66181002
* THE FOLLOWING ARE CONST MESSAGE INSERT EQUATES.                       66182602
I0004    EQU   4             DOUBLE                                     66182702
I0023    EQU   23            LOAD                                       66183002
I0024    EQU   24            DELETE                                     66183102
I0025    EQU   25            GETMAIN                                    66183202
I0026    EQU   26            FREEMAIN                                   66188802
I0040    EQU   40            IKJPARS                                    66190802
I0041    EQU   41            IKJDAIR                                    66192802
I0046    EQU   46            IKJDFLT                                    66193202
I0042    EQU   42            IKJEFF18                                   66193602
I0087    EQU   87            IKJEGLDF                                   66194002
I0094    EQU   94            ESTAE CODE FOR ABEND                       66194102
I0096    EQU   96            ESTAE CODE FOR ABEND                       66194202
I0099    EQU   99            ESTAE CODE FOR ABEND                       66194302
************************************************************            66194402
         EJECT                                                          66200002
************************************************************            75500002
*                                                          *            75550002
*                          TCOMTAB DSECT MACRO GENERATED   *            75600002
*                                                          *            75650002
************************************************************            75700002
TCOMTAB  TCOMTAB             MACRO THAT GENERATES TCOMTAB               75750002
         EJECT                                                          75800002
************************************************************            75850002
*                                                          *            75900002
*                         DCB DSECT                        *            75950002
*                                                          *            76000002
************************************************************            76050002
          DCBD  DEVD=DA       DCB DSECT                                 76100002
************************************************************            76150002
*                                                          *            76200002
*                    TMP DSECT                             *            76250002
*                                                          *            76300002
************************************************************            76350002
         IKJTPL                                                         76400002
************************************************************            76450002
*                                                          *            76500002
*                     PDE DSECT FOR PARSE                  *            76550002
*                                                          *            76600002
************************************************************            76650002
PARDSECT DSECT               DSECT DEFINING PDE FOR PARSE               76700002
DSNAMPTR DS    CL4           POINTER TO DSNAME                          76750002
LENGTH1  DS    CL2           LENGTH OF DSNAME                           76800002
FLAGS1   DS    CL1           FLAGS                                      76850002
RESERVE1 DS    CL1           NOT USED                                   76900002
MEMBERPT DS    CL4           POINTER TO MEMBER                          76950002
LENGTH2  DS    CL2           LENGTH OF MEMBER                           77000002
FLAGS2   DS    CL1           FLAGS                                      77050002
RESERVE2 DS    CL1           NOT USED                                   77100002
PSWRDPTR DS    CL4           POINTER TO PASSWORD                        77150002
LENGTH3  DS    CL2           LENGTH OF PASSWORD                         77200002
FLAGS3   DS    CL1           FLAGS                                      77250002
RESRVE3  DS    CL1           NOT USED                                   77300002
*                                                                       77350002
         DS    0F                                                       77400002
PRSDSECT DSECT               DSECT DEFINING DSECT FOR PARSE             77450002
DSNPTR   DS    CL4           POINTER TO DSNAME                          77500002
LEN2     DS    CL2           LENGTH OF DSNAME                           77550002
FLGS1    DS    CL1           FLAGS                                      77600002
RESRVE1  DS    CL1           NOT USED                                   77650002
************************************************************            77700002
*                                                          *            77750002
*       DSECT FOR PARAMETER CONTROL LIST PASSED TO PARSE   *            77800002
*                                                          *            77850002
************************************************************            77900002
         IKJPPL               DSECT DESCRIBING PCL TO BE PASSEC         77950002
         EJECT                                                          78000002
         IKJDAPL              DSECT FOR DAIR PARM BLOCK                 78050002
         IKJDAP08             DSECT FOR DAIR CODE 08                    78100002
         IKJDAP2C             DSECT FOR DAIR CODE 2C                    78150002
***********************************************************             78200002
*                                                         *             78250002
*       DSNAME DSECT POINTED TO BY DAIR ALLOCATION DSECT  *             78300002
*                                                         *             78350002
***********************************************************             78400002
DSNDSECT DSECT                                                          78450002
LENGTHDN DS   CL2             LENGTH OF DSNAME FOR DAIR                 78500002
NAME     DS   CL8             DSNAME FOR DAIR                           78550002
         EJECT                                                          78600002
************************************************************            78650002
*                                                          *            78700002
*                     REQUEST BLOCK DSECT                  *            78750002
*                                                          *            78800002
************************************************************            78850002
         IKJRB                RB DSECT                                  78900002
         EJECT                                                          78950002
         IKJDFPL                                                        79000002
         IKJDFPB                                                        79050002
************************************************************            79100002
*                                                          *            79150002
*                          TCB DSECT                       *            79200002
*                                                          *            79250002
************************************************************            79300002
TCBDSECT IKJTCB               DSECT FOR TCB                             79350002
        EJECT                                                           79400002
************************************************************            79450002
**                                                        **            79500002
**   PARSE PDE DSECT FOR GETMAIN ENTRY POINT              **            79550002
**                                                        **            79600002
************************************************************            79650002
IDENTGM  DSECT               DSECT FOR IDENT PDE                        79700002
STRNGPTR DS    A             POINTER TO INTEGER STRING                  79750002
LENDSNME DS    CL2           LENGTH OF INTERGER STRING                  79800002
FLAGS    DS    CL1           FLAGS                                      79850002
RESERVED DS    CL1           RESERVED                                   79900002
KEYWORD  DS    CL2           KEYWORD                                    79950002
EQUKYWD  DS    CL2           NUMBER OF KEYWORDS                         80000002
SPOINTER DS    A             POINTER TO SUBPOOL INTEGER                 80050002
SPLENGTH DS    CL2           LENGTH OF SP INTEGER                       80100002
SPFLAGS  DS    CL1           FLAGS                                      80150002
SPRES    DS    CL1           RESERVED                                   80200002
EQUPTR   DS    A             PTR TO EQUATE SYMBOL                       80250002
EQULEN   DS    H             LENGTH OF SYMBOL                           80300002
EQUFLG   DS    X             FLAGS                                      80350002
EQURES   DS    X             RESERVED                                   80400002
*                                                                       80450002
         DS    0F                                                       80500002
SYMDSECT DSECT               DSECT FOR SYMBOL TABLE                     80550002
CHAIN    DS    A             PTR TO NEXT SYMTABLE ENTRY                 80600002
ADDRSYM  DS    A             ADDRESS                                    80650002
ATTRTYPE DS    X             TYPE                                       80700002
ATTRMULT DS    CL3           MULT                                       80750002
ATTRLNTH DS    H             LENGTH                                     80800002
SYMLNGTH DS    H             LENGTH OF SYMBOL                           80850002
SYMBOL   DS    CL8           SYMBOL                                     80900002
************************************************************            80950002
**                                                        **            81000002
**      PARSE PDE DSECT FOR FREEMANI ENTRY POINT          **            81050002
**                                                        **            81100002
************************************************************            81150002
IDENTFM  DSECT               DSECT FOR FREEMAIN PARSE PDE               81200002
COREPTR  DS    A             POINTER TO INTEGER                         81250002
LENGTHFM DS    CL2           LENGTH OF INTEGER                          81300002
FLAGSFM  DS    CL1           FLAGS                                      81350002
RESFM    DS    CL1           RESERVED                                   81400002
         IKJPARMA            ADDRESS PDE FOR PARSE                      81450002
         EJECT                                                          81500002
TSTCWORK TSTCWORK                                                       81550002
DDNSAVE  EQU   CWORKCMD+@68                                             81552002
DAIR     EQU   CWORKCMD+@76                                             81554002
PASSWORD EQU   CWORKCMD+@96                                             81556002
CODESAVE EQU   CWORKCMD+@104                                            81558002
MSGHOLD  EQU   CWORKCMD+@108                                            81558402
MSGHOLD2 EQU   CWORKCMD+@112                                            81558802
MSGADDR  EQU   CWORKCMD+@116                                            81559202
PARMDRFL EQU   CWORKCMD+@120                                            81559602
MIDHOLD  EQU   CWORKCMD+@140                                            81559702
TMPRETC  EQU   CWORKCMD+@144                                            81559802
TMPCIDP  EQU   CWORKCMD+@148                                            81559902
TASKSWF  EQU   CWORKCMD+@152                                            81561902
DSNMEPTR EQU   CWORKCMD+@156                                            81563202
* THE FOLLOWING IS A FORMATTED MESSAGE INSERT FOR IO.                   81613202
* THE SAME AREA IS USED AS FOR THE DAIL FAIL PARAMETER LIST.            81663202
MSGINSHD EQU   CWORKCMD+@120 MESSAGE INSERT HEADER                      81713202
MSGINSRT EQU   CWORKCMD+@124 MESSAGE INSERT ITSELF                      81763202
IKJEGLDF CSECT                                                          82000002
         DS    0F             FOR ALIGNMENT PURPOSES                    82050002
STAELOAD DC   AL1(I0099)      STAE CODE                                 82100002
         DC   AL3(BLOW1)      RESUME ADDRESS                            82150002
         DC   AL1(I0099)      STAE CODE FOR DAIR LINK                   82200002
         DC   AL3(BLOW2)      RESUME ADDRESS                            82250002
         DC   AL1(I0096)      STAE CODE                                 82300002
         DC   AL3(BLOW3)      RESUME ADDRESS                            82350002
         DC   AL1(I0094)      STAE CODE                                 82400002
         DC   AL3(BLOW4)      RESUME ADDRESS                            82450002
         DC   AL1(I0094)      STAE CODE                                 82500002
         DC   AL3(BLOW8)      RESUME ADDRESS                            82550002
         DC    AL1(I0099)     STAE CODE FOR DAIR LINK                   82600002
         DC    AL3(BLOW9)     RESUME ADDRESS                            82650002
         DC    AL1(I0099)     STAE CODE FOR DEFAULT LINK                82700002
         DC    AL3(BLOW10)    RESUME ADDRESS                            82750002
         DC   X'FF'           END OF TABLE INDICATION                   82800002
         DS   0F              FOR ALIGNMENT PURPOSES                    82850002
STAEDEL  DC   AL1(I0099)      STAE CODE                                 82900002
         DC    AL3(BLOW1)     RESUME ADDRESS                            82950002
         DC   AL1(I0094)      STAE CODE                                 83000002
         DC   AL3(BLOW8)      RESUME CODE                               83050002
         DC   X'FF'           END OF TABLE INDICATOR                    83100002
         DS   0F              FOR ALIGNMENT PURPOSES                    83150002
STAEGET  DC   AL1(I0099)      STAE CODE                                 83200002
         DC    AL3(BLOW1)     RESUME ADDRESS                            83250002
         DC   AL1(I0094)      STAE CODE                                 83300002
         DC   AL3(BLOW8)      RESUME ADDRESS                            83350002
         DC   X'FF'           END OF TABLE INDICATOR                    83400002
         DS   0F              FOR ALIGNMENT PURPOSES                    83450002
STAEFREE DC   AL1(I0099)      STAE CODE                                 83500002
         DC    AL3(BLOW1)     RESUME ADDRESS                            83550002
         DC   AL1(I0094)      STAE CODE                                 83600002
         DC   AL3(BLOW8)      RESUME ADDRESS                            83650002
         DC   X'FF'           END OF TABLE INDICATOR                    83700002
LOADQUAL DC   CL8'LOAD'       FOR DEFAULT PARM BLOCK                    83750002
         DS   0F              FOR ALIGNMENT PURPOSES                    83800002
LISTSTAE ESTAE MF=L           LIST FORM OF ESTAE                        83810002
STAELEN  EQU   *-LISTSTAE     LENGTH OF LIST FORM OF ESTAE              83860002
SUBPOOL2 EQU  *                                                         83900002
         DC   AL1(0)          SUBPOOL NUMBER                            83950002
         DC   AL3(104)        LENGTH TO BE FREED                        84000002
ARETRY   DC   A(RETRY)        ADDRESS OF STAE RETRY RTN                 84050002
ARETRY1  EQU   ARETRY+@1                                                84100002
SYMPARM  DC    X'04'          DITTO                                     84150002
         DC    X'000001'      DITTO                                     84200002
         DC    H'4'           DITTO                                     84250002
PARMSIZE EQU   *-SYMPARM                                                84300002
         EJECT                                                          84350002
         CVT   DSECT=YES                                                84400002
         END                                                            84450002
