NL     TITLE 'IKJEGMNL - TSO TEST - MAINLINE MONITOR'                   00050003
         COPY  IKJEGSIO                                                 00070002
IKJEGMNL CSECT                                                          00100002
         EXTRN IKJEGMMT                                                 00150002
         EXTRN IKJEGSTA                                                 00200002
         EJECT                                                          00300002
*A596500-598500                                                @YM00583 00310002
*C640000                                                       @YM04132 00320002
*C215100-215300                                                @YM07109 00330002
*A76500,171600,171800,640100-640400                            @YM07115 00340002
*C7650002,64030002                                             @ZA02701 00342003
*     MOVE TOO MANY BYTES                                      @ZA20612 00343003
*C919500                                                       @Y30NQKK 00345003
*********************************************************************** 00350002
*                                                                       00400002
* STATUS --                                                             00450002
*    CHANGE LEVEL 00, VERSION NO. 03, VS2 RELEASE 3                     00500003
*                                                                       00550002
* FUNCTION --                                                           00600002
*    THIS MODULE RECEIVES CONTROL FROM THE INITIALIZATION MODULE        00650002
*    (IKJEGINT) OF THE TEST DEBUGGING PACKAGE OF TSO AS THE RESULT      00700002
*    OF AN XCTL.IT FINISHES INITIALIZATION AND IS THEREAFTER RE-        00750002
*    SPONSIBLE FOR THE ACQUISITION OF TEST COMMANDS FROM THE TER-       00800002
*    MINAL AND THE ROUTING OF CONTROL TO ONE OR ANOTHER OF THE VAR-     00850002
*    IOUS TEST COMMAND PROCESSORS OR TO THE PROGRAM BEING TESTED,       00900002
*    ACCORDING TO THE USER'S WISHES.                                    00950002
*                                                                       01000002
* ENTRY POINTS --                                                       01050002
*    IKJEGMNL                                                           01100002
*                                                                       01150002
* INPUT  --                                                             01200002
*    TEST COMMUNICATION TABLE (TCOMTAB) POINTER IN GPR 9.               01250002
*                                                                       01300002
* OUTPUT --                                                             01350002
*    NONE                                                               01400002
*                                                                       01450002
* EXTERNAL REFERENCES --                                                01500002
*         IKJEGIO  FOR TERMINAL I/O (VIA IKJEGSIO MACRO)                01550002
*         IKJSCAN  TO SCAN THE SUBCOMMAND INPUT BUFFER                  01600002
*         IKJDAIR  TO UNALLOCATE DATASETS ALLOCATED BY TEST OR THE PP   01650002
*         IKJEGSTA  IS MAINLINE'S ESTAE EXIT ROUTINE                    01700002
*         IKJEGATN  IS MAINLINE'S ATTENTION EXIT ROUTINE                01750002
*         IKJEFT04  IS BOTH THE TMP'S AND MAINLINES' STAI EXIT ROUTINE  01800002
*                                                                       01850002
* EXITS, NORMAL --                                                      01900002
*         LINK TO COMMAND PROCESSING PROGRAM                            01950002
*         RETURN TO TMP ('END' OR 'RUN'),RETURN CODE=0                  02000002
*                                                                       02050002
* EXITS, ERROR --                                                       02100002
*         NONE                                                          02150002
*                                                                       02200002
* TABLES/WORKAREAS --                                                   02250002
*    TCOMTAB  POINTED AT BY REGISTER 9, IS THE COMMUNICATIONS TABLE FOR 02300002
*    THE TEST PROCESSOR                                                 02350002
*                                                                       02400002
*    TPL  POINTED TO BY REGISTER 10 IS THE TEST PARAMETER LIST          02450002
*    THE TPL WAS PASSED TO INITIALIZATION BY THE TMP                    02500002
*                                                                       02550002
*    WORKAREA POINTER IN TCOMTAB IS THE MAIN WORKAREA FOR MAINLINE.     02600002
*                                                                       02750002
* ATTRIBUTES --                                                         02800002
*    RE-ENTRANT                                                         02850002
*    REFRESHABLE                                                        02900002
*                                                                       02950002
* CHARACTER CODE DEPENDENCY --                                          03000002
*    NONE                                                               03050002
*                                                                       03100002
* NOTES --                                                              03150002
*    REGISTER CONVENTIONS FOR MAINLINE ARE AS FOLLOWS                   03200002
*    REG 9  TCOMTAB POINTER                                             03250002
*    REG 10  POSSIBLE SECOND BASE REGISTER                              03300002
*    REG 11  ONLY USED FOR LINK REGISTER                                03350002
*    REG 12 IS THE BASE REGISTER                                        03400002
*    REGISTER 0,1,14,15 ARE USED BY MOST SUBROUTINES BAL-ED TO.         03450002
*                                                                       03500002
*********************************************************************** 03550002
         EJECT                                                          03600002
*********************************************************************** 03650002
*                                                                     * 03700002
*        GENERAL REGISTER EQUATES.                                    * 03750002
*                                                                     * 03800002
*********************************************************************** 03850002
R0       EQU   0              REGISTER 0                                03900002
R1       EQU   1              REGISTER 1                                03950002
R2       EQU   2              REGISTER 2                                04000002
R3       EQU   3              REGISTER 3                                04050002
R4       EQU   4              REGISTER 4                                04100002
R5       EQU   5              REGISTER 5                                04150002
R6       EQU   6              REGISTER 6                                04200002
R7       EQU   7              REGISTER 7                                04250002
R8       EQU   8              REGISTER 8                                04300002
R9       EQU   9              REGISTER 9                                04350002
R10      EQU   10             REGISTER 10                               04400002
R11      EQU   11             REGISTER 11                               04450002
R12      EQU   12             REGISTER 12                               04500002
R13      EQU   13             REGISTER 13                               04550002
R14      EQU   14             REGISTER 14                               04600002
R15      EQU   15             REGISTER 15                               04650002
         EJECT                                                          04700002
         SAVE  (14,12),,*     SAVE ENTRY REGISTERS.                     04750002
         LR    R12,R15        SET-UP BASE REGISTER ADDRESS.             04800002
         LR    R9,R1           SAVE ADDRESS OF TCOMTAB.                 04850002
         USING IKJEGMNL,R12   ESTABLISH ADDRESSABILITY FOR THIS         04900002
*                             CSECT                                     04950002
         LA    R10,4095(R12)  ADDRESS FOR SECOND BASE REG               04960003
         USING IKJEGMNL+4095,R10 ESTABLISH ADDRESSABILTY                04970003
         USING TCOMTAB,R9     ESTABLISH ADDRESSABILITY TO TCOMTAB       05000002
         L     R15,REGSAVE1   ADDRESS OF SAVE AREA.                     05150002
         ST    R13,X4(,R15)   CROSS-CHAIN CURRENT AND PREVIOUS          05200002
         ST    R15,X8(,R13)   SAVE AREAS.                               05250002
         LR    R13,R15        SET-UP SAVE AREA ADDRESS.                 05300002
         EJECT                                                          05650002
*********************************************************************** 05700002
*                                                                     * 05750002
*        COMPLETE INITIALIZATION PHASE --                             * 05800002
*                                                                     * 05850002
*        1 --  STOP ALL SUBTASKS OPERATING UNDER THE TMP/TEST TCB     * 06350002
*        2 --  AUTOMATICALLY QUALIFY TO THE MODULE CURRENTLY          * 06400002
*              OPERATING UNDER TEST.                                  * 06450002
*        3 --  ADD A TERMINAL ELEMENT TO THE INPUT STACK FOR A        * 06500002
*              TASK THAT WAS TAKEN OVER FROM THE TMP.                 * 06550002
*                                                                     * 06600002
*********************************************************************** 06650002
         SPACE 2                                                        06700002
         SPACE 2                                                        07600002
         BAL   R11,STOPALL    INSURE ALL TASKS ARE STOPED INIT @ZA02701 07650003
         SPACE 2                                                        07700002
         BAL   R11,QUAL       AUTOMATIC QUALIFY FIRST TIME IN.          07750002
         SPACE 2                                                        07800002
         BAL   R11,ADD        ADD AN ELEM TO THE STACK, IF NEEDED.      07850002
         EJECT                                                          07900002
*********************************************************************** 07950002
*                                                                     * 08000002
*        ESTABLISH AN ATTENTION EXIT FOR THE TEST COMMAND.            * 08050002
*        THE OUTPUT BUFFER AND LENGTH POINT TO THE TEST MODE          * 08100002
*        MESSAGE WHICH IS A PART OF THE IKJEGATN MODULE.  THE         * 08150002
*        INPUT BUFFER ADDRESS POINTS TO THE STANDARD TEST OUTPUT      * 08200002
*        BUFFER BUT SPECIFIES A LENGTH OF ZERO.  THIS ENABLES A       * 08250002
*        PUTGET WITH THE TERM OPTION TO GET THE LINE OF INPUT         * 08300002
*        DURING ATTENTION PROCESSING.  THE USER ADDRESS IS THE        * 08350002
*        ADDRESS OF TCOMTAB.                                          * 08400002
*                                                                     * 08450002
*********************************************************************** 08500002
         SPACE 2                                                        08550002
         L     R2,OUTBUF      DUMMY INPUT BUFFER ADDRESS.               08600002
         L     R3,MNLEGATN   ADDRESS OF ATTENTION EXIT ROUTINE.         08650002
         MVC   TSTSTAX(MNLSTAXL),MNLSTAX INITIALIZE STAX                08700002
*                             PARAMETER LIST.                           08750002
         STAX  (R3),IBUF=((R2),),USADDR=(R9),REPLACE=NO,               X08800002
               MF=(E,TSTSTAX) ACTIVATE TESTS ATTENTION EXIT.            08850002
         LTR   R15,R15        TEST FOR SUCCESSFUL COMPLETION.           08900002
         BZ    MNLISTAE       IF IF RETURN CODE = 0, BRANCH TO          08950002
*                             ESTABLISH STAE EXIT ROUTINE.              09000002
         LA    R1,RESTART1    SET THE RESTART ADDRESS.                  09050002
         ST    R1,TSTRSTRT    DITTO                                     09100002
         BR    R1             GO TO RESTART1 AND CLEANUP.               09150002
         EJECT                                                          09200002
*********************************************************************** 09250002
*                                                                     * 09300002
*        ESTABLISH AN ABNORMAL END EXIT FOR THE TEST COMMAND.         * 09350002
*        IKJEGSTA PERFORMS ALL EXIT PROCESSING FOR THE TEST           * 09400002
*        COMMAND.  FOR ABENDS OCCURRING IN THE MAINLINE PORTION       * 09450002
*        OF TEST, ALL RETRYS WILL BE ATTEMPTED THROUGH IKJEGSTR       * 09500002
*        IN THIS MODULE.                                              * 09550002
*                                                                     * 09600002
*********************************************************************** 09650002
         SPACE 2                                                        09700002
MNLISTAE EQU   *                                                        09750002
         XC    MNLSVCPL,MNLSVCPL CLEAR SVC PARAMETER LIST               09800002
         L     R15,TSTSTAE   R15=ADDR OF ESTAE EXIT ROUTINE             09810002
         ESTAE (R15),CT,PARAM=MNLSPL,XCTL=NO,RECORD=YES,               *09850002
               MF=(E,MNLSVCPL)  ESTABLISH ABEND EXIT                    09900002
         LTR   R15,R15        TEST FOR SUCCESSFUL COMPLETION.           10000002
         BZ    SCREQ1        SUCCESSFUL,CONTINUE                        10050002
         LA    R1,SVC60NO    R1=ADDR OF SVC NUMBER                      10100002
         BAL   R14,IOSVC     OUTPUT SVC ERROR MESSAGE                   10110002
         B     ENDITERR      TERMINATE                                  10120002
         EJECT                                                          10150002
*********************************************************************** 10200002
*                                                                     * 10250002
*        THE FOLLOWING BEGINS THE MAIN PROCESS LOOP WHICH             * 10300002
*        INTERFACES BETWEEN THE TERMINAL, THE SUBCOMMAND              * 10350002
*        PROCESSOR, AND RETURN CODE CHECK UPON RETURN FROM A          * 10400002
*        SUBCOMMAND PROCESSOR.                                        * 10450002
*                                                                     * 10500002
*        1 --  FREE THE CURRENT INPUT BUFFER AND PDL, IF THEY         * 10550002
*              EXIST.                                                 * 10600002
*        2 --  DETERMINE IF A SUBCOMMAND IS IN CORE AND READY TO      * 10650002
*              BE PROCESSED.  INBUF WILL HAVE BEEN INITIALIZED        * 10700002
*              BY IKJEGATN.                                           * 10750002
*        3 --  DETERMINE IF A SUBCOMMAND IS TO BE PROCESSED FROM      * 10800002
*              A SUBCOMMAND CHAIN ENTERED ON AN AT SUBCOMMAND.        * 10850002
*              SUBCHAIN WILL HAVE BEEN INITIALIZED BY IKJEGCTL        * 10900002
*              WHEN A BREAKPOINT IS HIT.  WHEN SUBCHAIN IS NOT        * 10950002
*              ZERO, JUSTGET(CLOSED SUBROUTINE) IS CALLED TO RETRIEVE * 11000002
*              ONE SUBCOMMAND AT A TIME FROM THE CHAIN.               * 11050002
*        4 --  WHEN NEITHER OF THE ABOVE IS TRUE, INVOKE IKJEGSIO     * 11100002
*              TO PUT THE MODE MESSAGE AND TO GET A SUBCOMMAND.       * 11150002
*                                                                     * 11200002
*********************************************************************** 11250002
         SPACE 2                                                        11300002
SCREQ1   EQU   *                                                        11350002
         BAL   R11,FREINBUF   FREE INBUF AND PDL IF ANY.                11400002
         SPACE 2                                                        11450002
SCREQ    EQU   *                                                        11500002
         NC    INBUF(L'INBUF),INBUF Q.IS A COMMAND IN STORAGE.          11550002
         BNZ   SCAN           YES,LINK TO COMMAND SCAN ROUTINE.         11600002
         SPACE 2                                                        11650002
         NC    SUBCHAIN(L'SUBCHAIN),SUBCHAIN COMMAND CHAIN IN PROGRES   11700002
         BZ    SCREQ2        NO,GO ISSUE 'TEST' MODE MESSAGE            11750002
         L     R15,MNLEGMN1  YES, R15=ADDR OF PROCESSOR                 11760002
         BALR  R14,R15       GO GET NEXT SUBCOMMAND                     11770002
         LTR   R15,R15       SUCCESSFUL COMPLETION?                     11780002
         BZ    SCREQ         YES, GO PROCESS SUBCOMMAND                 11790002
* ISSUE 'GETMAIN SVC ERROR' MESSAGE                                     11790402
         LA    R1,SVC10NO    NO,GETMAIN ERROR OCCURRED                  11792002
*                            R1=ADDR OF SVC NUMBER                      11794002
         BAL   R14,IOSVC     GO ISSUE SVC ERROR MESSAGE                 11796002
         B     ENDITERR      IGNORE RC'S AND TERMINATE                  11798002
         SPACE 2                                                        11800002
SCREQ2   EQU   *                                                        11850002
         XC    TSTIOPRM(L'TSTIOPRM),TSTIOPRM  CLEAR IO PARM LIST        11910002
         TM    TSTFLGS2,TSTLDF WAS LDF LAST IN CONTROL?                 11910402
         BZ    SCREQ2A       NO,BYPASS SPECIAL HANDLING                 11910802
         OI    TSTFLGS1,TSTFIRST TELL IKJEGSTA TO RETURN CONTROL        11911202
         OI    TSTFLGS4,TSTESTAE TELL IKJEGSIO TO NOT SET ESTAE         11911602
SCREQ2A  EQU   *                                                        11911702
* ISSUE 'TEST' MODE MESSAGE AND GET INPUT                               11912002
         IKJEGSIO PTGT,FIRST=M0071,ID=MNL22,MF=(E,TSTIOPRM)             11920002
         NI    TSTFLGS4,XFF-TSTESTAE RESET NO ESTAE BIT                 11932002
         NI    TSTFLGS1,XFF-TSTFIRST RESET IKJEGSTA RETURN BIT          11934002
         NI    TSTFLGS2,XFF-TSTLDF RESET LDF BIT                        11936002
         LTR   R15,R15       TEST FOR ZERO RETURN FROM IO               11938002
         BZ    GOADD         NORMAL RETURN CONTINUE                     11940002
         C     R15,ATTNCODE  IS ATTENTION IN EFFECT                     11942002
         BE    ATTNPROC      YES GO PROCESS IT                          11944002
         B     ENDITERR      CANNOT BE SURE OF VALIDITY OF              11946002
*                            'TEST' MESSAGE SO TERMINATE                11948002
         SPACE 2                                                        11950002
GOADD    EQU   *                                                        11960002
         BAL   R11,ADD        ADD A TERM ELEM TO THE STACK              12000002
         EJECT                                                          12050002
*********************************************************************** 12100002
*                                                                     * 12150002
*        PERFORM A CURSORY EXAMINATION OF THE INPUT BUFFER BY         * 12200002
*        FIRST CHECKING FOR A NULL LINE.  WHEN A NULL LINE WAS        * 12250002
*        ENTERED, IGNORE AND BRANCH TO FREE INPUT BUFFER.  FOR        * 12300002
*        OTHER THAN A NULL LINE, CHECK FOR AN ASSIGNMENT              * 12350002
*        SUBCOMMAND (AN EQUAL SIGN FOLLOWING THE SUBCOMMAND NAME)     * 12400002
*        IF AN ASSIGNMENT SUBCOMMAND IS FOUND, BLANK OUT THE          * 12450002
*        EQUAL SIGN AND SET-UP TO INVOKE IKJEGPCH.  OTHERWISE         * 12500002
*        PROCESSING WILL CONTINUE BY BRANCHING TO INVOKE IKJSCAN.     * 12550002
*                                                                     * 12600002
*        R2 -- CONSTANT 4 FOR COMPARISONS, ADDRESS OF SUBCOMMAND      * 12650002
*              NAME.                                                  * 12700002
*        R3 -- COUNTER OF NUMBER OF BYTES IN BUFFER, LENGTH OF        * 12750002
*              SUBCOMMAND NAME.                                       * 12800002
*        R4 -- POINTER TO CURRENT BYTE IN BUFFER.                     * 12850002
*        R5 -- ADDRESS OF LOAD MODULE NAME FOR ASSIGN.                * 12900002
*                                                                     * 12950002
*********************************************************************** 13000002
         SPACE 2                                                        13050002
SCAN     EQU   *                                                        13100002
         L     R4,INBUF       ADDRESS OF INPUT BUFFER.                  13150002
         LH    R3,X0(,R4)     LENGTH OF INPUT BUFFER.                   13200002
         LA    R2,X4          CONSTANT OF FOUR.                         13250002
         CR    R2,R3          CHECK IF THIS IS A NULL LINE.             13300002
         BE    SCREQ1         IF A NULL LINE, BRANCH TO FREE            13350002
*                             INPUT BUFFER.                             13400002
LOOP0    EQU   *                                                        13450002
         CLI   X4(R4),MNLBLANK CHECK FOR LEADING BLANK                  13500002
         BNE   LOOP           IF NOT A LEADING BLANK, BRANCH TO         13550002
*                             CHECK FOR A ASSIGN SUBCOMMAND.            13600002
         LA    R4,X1(,R4)     INCREMENT BUFFER POINTER BY 1.            13650002
         BCT   R3,LOOP0       CHECK IF ANOTHER LEADING BLANK.           13700002
         B     SCREQ1         IF ALL BLANKS, BRANCH TO REQUEST A        13750002
*                             NEW LINE.                                 13800002
LOOP     EQU   *                                                        13850002
         CLI   X4(R4),MNLBLANK CHECK FOR BLANK AS A DELIMITER.          13900002
         BE    MNLXX000       IF A BLANK ENCOUNTERED, NOT A             13950002
*                             ASSIGN SUBCOMMAND.                        14000002
         CLI   X4(R4),MNLLPARN CHECK FOR A LEFT PARENTHESIS.            14050002
         BE    MNLXX000       IF LEFT PARENTHESIS ENCOUNTERED,          14100002
*                             NOT A ASSIGN SUBCOMMAND.                  14150002
         CLI   X4(R4),MNLEQUAL CHECK FOR AN EQUAL SIGN.                 14200002
         BE    SCPCH          IF AN EQUAL SIGN FOUND, BRANCH TO         14250002
*                             REMOVE.                                   14300002
         LA    R4,X1(,R4)     INCREMENT BUFFER POINTER BY 1.            14350002
         BCT   R3,LOOP        DECREMENT COUNTER, CONTINUE SEARCH.       14400002
         B     MNLXX000       NO SIGNIFICANT CHARACTERS FOUND,          14450002
*                             BRANCH TO INVOKE IKJSCAN.                 14500002
SCPCH    EQU   *                                                        14550002
         MVI   X4(R4),MNLBLANK BLANK OUT EQUAL SIGN FOR PARSE.          14600002
         L     R2,MNLEGPCH    ADDRESS OF ASSIGN ENTRY IN                14650002
*                             SUBCOMMAND TABLE.                         14700002
         SR    R3,R3          ZERO LENGTH REGISTER TO INSURE            14750002
         IC    R3,SCDNAME(,R2) VALIDITY OF ONE BYTE LENGTH.             14800002
         LA    R5,SCDPCHLD(,R2) ADDRESS OF LOAD MODULE NAME FOR         14850002
*                             ASSIGN SUBCOMMAND.                        14900002
         LA    R2,SCDSCPPN(,R2) SET REGISTER TO POINT TO COMMON         14950002
*                             SUBCOMMAND NAME.                          15000002
         B     MNLXX170       BRANCH TO INVOKE ASSIGN SUBCOMMAND.       15050002
         EJECT                                                          15100002
*********************************************************************** 15150002
*                                                                     * 15200002
*        THE INPUT BUFFER CONTAINS A LINE OF INPUT WHICH IS NOT A     * 15250002
*        NULL LINE, A BLANK LINE, OR AN ASSIGNMENT SUBCOMMAND.        * 15300002
*        INVOKE THE COMMAND SCAN SERVICE ROUTINE (IKJSCAN) TO         * 15350002
*        SCAN THE INPUT BUFFER FOR THE SUBCOMMAND NAME.  UPON         * 15400002
*        RETURN FROM IKJSCAN, VALIDITY CHECK THE SPELLING OF THE      * 15450002
*        SUBCOMMAND ENTERED BY THE USER WITH ALL THOSE NAMES THAT     * 15500002
*        EXIST IN THE IBM TABLE AND THE USER TABLE.  WHEN A MATCH     * 15550002
*        IS FOUND, INVOKE THE MODULE INDICATED IN THE CURRENT         * 15600002
*        TABLE ENTRY.                                                 * 15650002
*                                                                     * 15700002
*        R2 -- FLAG WORD FOR IKJSCAN, ADDRESS OF SUBCOMMAND NAME      * 15750002
*              ENTERED BY USER.                                       * 15800002
*        R3 -- IKJSCAN OUTPUT AREA, LENGTH OF SUBCOMMAND NAME         * 15850002
*              ENTERED BY USER.                                       * 15900002
*        R4 -- ADDRESS OF INPUT BUFFER, LENGTH OF SUBCOMMAND NAME     * 15950002
*              OR ABBREVIATION IN CURRENT TABLE ENTRY.                * 16000002
*        R5 -- ADDRESS OF SUBCOMMAND NAME OR ABBREVIATION IN          * 16050002
*              CURRENT TABLE ENTRY, ADDRESS OF LOAD MODULE NAME.      * 16100002
*                                                                     * 16150002
*********************************************************************** 16200002
         SPACE 2                                                        16250002
MNLXX000 EQU   *                                                        16300002
         L     R4,INBUF       ADDRESS OF CURRENT INPUT BUFFER.          16350002
         MVC   MNLSCPRM(L'TSTUPT+L'TSTECT+L'TSTCPECB),PARMLIST          16400002
*                             INITIALIZE POINTERS TO UPT, ECT AND       16450002
*                             ECB FOR IKJSCAN.                          16500002
         LA    R2,MNLCSFLG    ADDRESS OF FLAG WORD FOR IKJSCAN.         16550002
         XC    MNLCSFLG(L'MNLCSFLG),MNLCSFLG ZERO FLAG WORD AND         16600002
         OI    MNLCSFLG,MNLNOCHK INDICATE NO SYNTAX CHECKING.           16650002
         LA    R3,MNLCSOA     ADDRESS OF TWO-WORD OUTPUT AREA.          16700002
         LINK  EP=IKJSCAN,PARAM=(,,,(R2),(R3),(R4)),ERRET=SCANERR,     X16750002
               MF=(E,MNLSCPRM) INVOKE COMMAND SCAN ROUTINE.             16800002
         LTR   R15,R15        TEST FOR ZERO RETURN CODE.                16850002
         BNZ   TMPRTURN       IF NOT ZERO, BRANCH TO RETURN.            16900002
         NI    TSTFLGS3,XFF-NOPARMS RESET OPERAND FLAG.                 16950002
         USING CSOA,R3        ESTABLISH ADDRESSABILITY TO CSOA.         17000002
         TM    CSOAFLG,CSOAVWP DETERMINE IF OPERANDS WERE ENTERED       17050002
         BO    MNLXX010       OPERANDS ENTERED, BRANCH TO               17100002
*                             VALIDATE SUBCOMMAND NAME.                 17150002
         TM    CSOAFLG,CSOAVNP  TEST FOR VALID COMMAND.        @YM07115 17160002
         BZ    NOSHOW1        COMMAND INVALID MSG.             @YM07115 17180002
         OI    TSTFLGS3,NOPARMS INDICATE NO OPERANDS ENTERED.           17200002
MNLXX010 EQU   *                                                        17250002
         L     R2,CSOACNM     ADDRESS OF SUBCOMMAND NAME.               17300002
         LH    R3,CSOALNM     LENGTH OF COMMAND NAME.                   17350002
         DROP  R3                                                       17400002
         SR    R4,R4          INITIALIZE REGISTER TO CONTAIN            17450002
*                             SUBCOMMAND NAME LENGTH.                   17500002
         STH   R4,MNLCFLGS    ZERO FLAG BYTES.                          17550002
         L     R5,MNLIBMTB    ADDRESS OF STANDARD SUBCOMMAND            17600002
*                             TABLE.                                    17650002
MNLXX030 EQU   *                                                        17700002
         IC    R4,X0(,R5)     LENGTH OF CURRENT ENTRY IN                17750002
*                             SUBCOMMAND NAME TABLE.                    17800002
         CR    R3,R4          DETERMINE IF THE LENGTH OF THE            17850002
*                             CURRENT TABLE ENTRY EQUALS THE            17900002
*                             LENGTH OF THE SUBCOMMAND ENTERED.         17950002
         BE    MNLXX090       IF LENGTHS ARE EQUAL, BRANCH TO           18000002
*                             COMPARE SUBCOMMAND NAMES.                 18050002
         CLI   X0(R5),SCDTBEND CHECK FOR END OF TABLE.                  18100002
         BE    MNLXX130       WHEN END OF TABLE HAS BEEN REACHED,       18150002
*                             BRANCH TO DETERMINE IF BOTH TABLES        18200002
*                             HAVE BEEN SEARCHED.                       18250002
         XI    MNLCFLG1,MNLABBRV INDICATE A TEST FOR HALF OF A          18300002
*                             TABLE ENTRY.                              18350002
         BNZ   MNLXX070       WHEN ABBREVIATION FLAG IS OFF,            18400002
*                             BRANCH TO COMPUTE A POINTER TO THE        18450002
*                             ABBREVIATION.                             18500002
         LA    R5,SCDNXTNM(R4,R5) IF AN ABBREVIATION JUST USED,         18550002
*                             COMPUTE POINTER TO NEXT NAME IN           18600002
*                             TABLE.                                    18650002
         B     MNLXX030       BRANCH TO CHECK SUBCOMMAND AGAINST        18700002
*                             NEXT TABLE ENTRY.                         18750002
MNLXX070 EQU   *                                                        18800002
         LA    R5,SCDNXTAB(R4,R5) COMPUTE POINTER TO ABBREVIATION       18850002
*                             FOR CURRENT ENTRY.                        18900002
         B     MNLXX030       BRANCH TO CHECK SUBCOMMAND NAME           18950002
*                             AGAINST ABBREVIATION.                     19000002
MNLXX090 EQU   *                                                        19050002
         BCTR  R4,X0          REDUCE LENGTH FOR COMPARISON.             19100002
         EX    R4,MNLCMDCK    DETERMINE IF SUBCOMMAND NAME              19150002
*                             ENTERED BY USER IS THE SAME AS THE        19200002
*                             CURRENT TABLE ENTRY.                      19250002
         BE    MNLXX150       WHEN A MATCH IS FOUND, BRANCH TO          19300002
*                             INVOKE SUBCOMMAND PROCESSOR.              19350002
         XI    MNLCFLG1,MNLABBRV INDICATE A TEST FOR HALF OF A          19400002
*                             TABLE ENTRY.                              19450002
         BNZ   MNLXX110       IF ABBREVIATION FLAG WAS OFF,             19500002
*                             BRANCH TO COMPUTE POINTER TO THE          19550002
*                             ABBREVIATION.                             19600002
         LA    R5,SCDNXTNM+X1(R4,R5) OTHERWISE, COMPUTE A POINTER       19650002
*                             TO THE SUBCOMMAND NAME IN THE NEXT        19700002
*                             TABLE ENTRY.                              19750002
         B     MNLXX030       BRANCH TO COMPARE LENGTH AGAINST          19800002
*                             CURRENT TABLE ENTRY.                      19850002
MNLXX110 EQU   *                                                        19900002
         LA    R5,SCDNXTAB+X1(R4,R5) COMPUTE ADDRESS OF THE             19950002
*                             ABBREVIATION FOR THIS ENTRY.              20000002
         B     MNLXX030       BRANCH TO COMPARE LENGTH AGAINST          20050002
*                             CURRENT ABBREVIATION.                     20100002
MNLXX130 EQU   *                                                        20150002
         XI    MNLCFLG2,MNLUSERT INDICATE A TABLE HAS BEEN              20200002
*                             SEARCHED AND TEST FOR WHICH TABLE.        20250002
         BZ    NOSHOW1        WHEN BOTH THE IBM TABLE AND THE           20300002
*                             USER TABLE HAVE BEEN SEARCHED,            20350002
*                             BRANCH TO PUT THE INVALID SUBCOM-         20400002
*                             MAND MESSAGE.                             20450002
         L     R5,MNLUSRTB    ADDRESS OF USER SUBCOMMAND TABLE.         20500002
         B     MNLXX030       BRANCH TO RESUME SEARCH USING THE         20550002
*                             NEW SUBCOMMAND NAME TABLE.                20600002
MNLXX150 EQU   *                                                        20650002
         LA    R5,SCDNXTAB+X1(R4,R5) POSSIBLE POINTER TO LOAD           20700002
*                             MODULE NAME IF THIS IS AN                 20750002
*                             ABBREVIATION.                             20800002
         TM    MNLCFLG1,MNLABBRV DETERMINE IF THIS WAS AN               20850002
*                             ABBREVIATION.                             20900002
         BO    MNLXX170       IF AN ABBREVIATION, BRANCH TO             20950002
*                             INVOKE SUBCOMMAND PROCESSOR.              21000002
         IC    R4,SCDABBR(,R5) GET ABBREVIATION LENGTH.                 21050002
         LA    R5,SCDABBRL(R4,R5) COMPUTE ADDRESS TO LOAD MODULE        21100002
*                             NAME.                                     21150002
MNLXX170 EQU   *                                                        21200002
         BCTR  R3,X0          REDUCE SUBCOMMAND NAME LENGTH BY 1.       21250002
         L     R1,TSTECT      ADDRESS OF ECT.                           21300002
         USING ECT,R1         ESTABLISH ADDRESSABILITY TO ECT.          21350002
         MVI   ECTSCMD,MNLBLANK BLANK OUT PREVIOUS SUBCOMMAND           21400002
         MVC   ECTSCMD+X1(L'ECTSCMD-X1),ECTSCMD NAME IN ECT.            21450002
         EX    R3,MNLSCDMV    MOVE CURRENT SUBCOMMAND NAME TO ECT.      21500002
         L    R15,ECTSCMD+X4  R15= LAST HALF COMMAND           @YM07109 21510002
         L    R1,ECTSCMD      R1= FIRST HALF COMMAND           @YM07109 21520002
         TSEVENT PPMODE       RECORD SUBCOMMAND TIME STAMP     @YM07109 21530002
         DROP  R1                                                       21550002
         XC    MNLLINKL(L'MNLLINKL),MNLLINKL ZERO PARAMETER LIST        21600002
*                             FOR LINK MACRO EXPANSION.                 21650002
         NI    TSTFLGS1,XFF-TSTFIRST-RANGESW SET FLAGS TO '0'B.         21700002
         NI    TSTFLGS3,XFF-SYMMESG SET FLAG TO '0'B.                   21750002
         NI    TSTFLGS4,XFF-TSTVALCK TURN OFF VALIDITY CHECK BIT        21760002
         OI    TSTFLGS3,TSTLINK INDICATE THAT LINK TO SUBCOMMAND        21800002
*                             IS IN PROCESS (INDICATOR TO STAE).        21850002
         STM   R14,R12,N12(R13) SAVE REGISTERS FOR STAE RETRY.          21900002
         MVC   TSTRTYCD,X8(R5) SET UP SUBCOMMAND ID FIELD.              21950002
         LINK  EPLOC=(R5),SF=(E,MNLLINKL),ERRET=SUBCERR                 22000002
* INVOKE SUBCOMMAND PROCESSOR                                           22060002
         EJECT                                                          22110002
BLOWSC   EQU   *                                                        22150002
         NI    TSTFLGS3,XFF-TSTLINK  RESET LINK ABEND BIT               22200002
         XC    TSTRSTRT(X4),TSTRSTRT  INSURE RESTART ADDR ZEROED        22250002
         NI    TSTFLGS2,XFF-TSTXCTL  RESET XCTL ABEND BIT               22360002
         NI    TSTFLGS1,XFF-TSTBUILD RESET BUILD BRKPT SWITCH           22370002
         SPACE                                                          22400002
*        RETURN CODE CHECK                                              22450002
         SPACE                                                          22500002
         B     HERE(R15)       BRANCH ACCORDING TO RETURN CODE.         22550002
HERE     EQU   *                                                        22600002
         B     CLEAN          RC=0,GET ANOTHER COMMAND.                 22650002
         B     IKJEGCTL       RC=4,'GO',GO TO CTL SUBROUTINE.           22700002
         B     TMPRTURN       RC=8,'END',FOLD UP TENT.                  22750002
         B     RUNRTURN       RC=12,'RUN',FOLD UP TENT,NO DETACH.       22800002
         B     ATTNPROC       RC=16,ATTENTION INT. PROCESSING.          22850002
         B     STAERTRN       RETURN FROM A S.C. WHICH ABENDED.         22900002
         B     ESTAERR       RC=24 PROCESS ESTAE ERROR                  22910002
CLEAN    EQU   *                                                        22950002
         TM    TSTFLGS4,TSTFLUSH   Q. IS THERE A NEED TO FLUSH.         23000002
         BNO   CLEAN1         NO.                                       23050002
STAERTRN EQU   *                                                        23100002
         NI    TSTFLGS4,XFF-TSTFLUSH  INSURE RESET OF FLAG.             23150002
         BAL   R11,FLUSH      TCLEARQ AND MAYBE STACK FLUSH.            23200002
CLEAN1   EQU   *                                                        23250002
         TM    TSTFLGS1,ENDSW HAS EITHER 'RUN' OR 'END' BEEN ENTERED    23300002
         BO    TMPRTURN       YES.FOLD.                                 23350002
         L     R1,ECBTMPA     GET ATTENTION ECB.                        23400002
         TM    X0(R1),TESTATTN  DID IKJEGATN POST Q.Q.Q.                23450002
         BO    ATTNPROC       YES. PROCESS THE ATTENTION REQUEST.       23500002
         B     SCREQ1          GET ANOTHER COMMAND.                     23550002
ESTAERR  EQU   *             RC=24 RETURNED FROM SOME MODULE            23560002
         SR    R15,R15       ZERO REG 15                                23572002
         IC    R15,TSTESTRC  PUT ESTAE RC IN R15                        23574002
* ISSUE 'ESTAE SVC ERROR' MESSAGE                                       23580002
         LA    R1,SVC60NO    R1=ADDR OF SVC NUMBER                      23590002
         BAL   R14,IOSVC     PUT OUT SVC ERROR MESSAGE                  23590402
         LTR   R15,R15       TEST FOR ZERO RETURN CODE                  23592002
         BZ    CLEAN         ZERO FOUND CONTINUE PROCESSING             23594002
         C     R15,ATTNCODE  IS ATTEN IN EFFECT                         23596002
         BE    ATTNPROC      YES. GO PROCESS IT                         23598002
ESTAERR1 EQU   *                                                        23598402
* ISSUE 'TEST ENDED DUE TO ERROR' MESSAGE                               23599202
         LA    R1,MSG1       R1=ADDR OF MESSAGE NUMBERS                 23599602
         BAL   R14,IOMSG     PUT OUT MESSAGE                            23612202
         B     TMPRTURN      IGNORE RC'S AND TERMINATE                  23624802
         EJECT                                                          23637402
*********************************************************************** 23650002
*                                                                     * 23700002
*        CORE CLEAN-UP FOLLOWING EXECUTION OF A SUBCOMMAND.           * 23750002
*                                                                     * 23800002
*        1 --  FREE LAST INPUT BUFFER, POINTED TO BY INBUF,           * 23850002
*              UNLESS AN ATTENTION INTERRUPT HAS OCCURRED.            * 23900002
*        2 --  FREE LAST PDL RETURNED BY PARSE.                       * 23950002
*        3 --  FREE CHAIN OF SYMBOL INFORMATION BLOCKS IF SUCH        * 24000002
*              A CHAIN EXISTS.                                        * 24050002
*                                                                     * 24100002
*********************************************************************** 24150002
         SPACE 2                                                        24200002
FREINBUF EQU   *                                                        24250002
         L     R1,ECBTMPA     POINT TO ATTN ECB                         24300002
         TM    X0(R1),TESTATTN  HAS ATTENTION BEEN HIT Q.Q.Q.           24350002
         BO    PDLFREE        YES. DON'T FREE INPUT BUFFER.             24400002
         L     R1,INBUF       R1=ADDR OF BUFFER                         24450002
         LTR   R1,R1          Q.IS INBUF ZERO.                          24500002
         BZ    PDLFREE        YES, CHECK ON TSTANSPL.                   24550002
         LH    R0,X0(,R1)     R0=LENGTH OF BUFFER FOR FREEMAIN          24600002
         XC    INBUF(L'INBUF),INBUF CLEAR INPUT BUFFER POINTER.         24700002
         FREEMAIN RC,LV=(0),A=(1),SP=1 FREE THE BUFFER.                 24750002
         LTR   R15,R15       WAS FREEMAIN SUCCESSFUL                    24760002
         BZ    PDLFREE       YES CONTINUE                               24770002
* ISSUE 'FREEMAIN SVC ERROR' MESSAGE                                    24782002
         LA    R1,SVC120NO   R1=ADDR OF SVC NUMBER                      24784002
         BAL   R14,IOSVC     PUT OUT SVC ERROR MESSAGE                  24786002
* IGNORE RETURN CODES AND CONTINUE                                      24792002
         SPACE 2                                                        24800002
PDLFREE  EQU   *                                                        24850002
         IKJRLSA TSTANSPL     RELEASE THE PDL                           24900002
         XC    TSTANSPL(L'TSTANSPL),TSTANSPL ZERO BEFORE FREEING        24950002
         SPACE 2                                                        25000002
         L     R14,SICHAIN    ADDR OF HEAD OF CHAIN                     25050002
         XC    SICHAIN(L'SICHAIN),SICHAIN ZERO IN CASE OF ABEND         25100002
LOOP4    EQU   *                                                        25150002
         LTR   R1,R14         Q. END OF CHAIN.                          25200002
         BCR   Z,R11          RETURN TO CALLER                          25250002
         L     R14,SIBLINK(,R14) R14=ADDR OF NEXT SIB,IF ANY            25300002
         L     R0,MNLSIBLN    SIB CORE SUBPOOL AND LENGTH               25350002
         FREEMAIN  RC,LV=(0),A=(1),SP=1  FREE THIS SIB                  25400002
         LTR   R15,R15       WAS FREEMAIN SUCCESSFUL                    25410002
         BZ    LOOP4         YES CONTINUE                               25420002
* ISSUE 'FREEMAIN SVC ERROR' MESSAGE                                    25440002
         LA    R1,SVC120NO   R1=ADDR OF SVC NUMBER                      25442002
         BAL   R14,IOSVC     PUT OUT SVC ERROR MESSAGE                  25442402
* IGNORE RETURN CODES AND CONTINUE                                      25444002
         B     LOOP4          LOOP ------                               25450002
         EJECT                                                          25500002
NOSHOW1  EQU   *                                                        25550002
*        LINE RECEIVED DID NOT HAVE A VALID VERB AS THE FIRST FIELD.    25600002
*        WRITE A DIAGNOSTIC MESSAGE TO THE TERMINAL AND GET ANOTHER     25650002
*        LINE.                                                          25700002
         SPACE                                                          25750002
* ISSUE 'INVALID COMMAND' MESSAGE                                       25762002
* ISSUE 'COMMAND NOT SUPPORTED' MESSAGE                                 25772002
         LA    R1,MSG2       R1=ADDR OF MESSAGE NUMBERS                 25774002
         BAL   R14,IOMSG     PUT OUT MESSAGES                           25776002
         BAL   R11,IORETCK   GO TEST IO RETURN CODES                    25780002
         B     SCREQ1        GET ANOTHER COMMAND.                       25900002
         EJECT                                                          25950002
ATTNPROC EQU   *                                                        27900002
         TM    TSTFLGS1,ENDSW HAS EITHER 'RUN' OR 'END' BEEN ENTERED.   27950002
         BO    TMPRTURN       YES.FOLD.                                 28000002
         L     R1,ECBTMPA     R1=ATTENTION ECB ADDR.                    28050002
         TM    X0(R1),TESTATTN Q.DID TEST POST ECB (X'48').             28100002
         BNO   ENDIT1         NO,FOLD UP TENT.                          28150002
         XC    X0(X4,R1),X0(R1)  ZERO ATTENTION ECB.                    28200002
         BAL   R11,PDLFREE    FREE PDL BUT NOT INPUT BUFFER.            28250002
         NI    TSTFLGS4,XFF-TSTFLUSH TURN OFF FLUSH SWITCH.             28300002
         B     SCREQ          PROCESS COMMAND RECEIVED.                 28350002
         EJECT                                                          28360002
IORETCK  EQU   *             IO RETURN CODE CHECK ROUTINE               28474002
         B     IORC0(R15)    USE RC AGAINST BRANCH TABLE                28476002
IORC0    EQU   *                                                        28478002
         B     X0(R11)       RC=0 NORMAL RETURN CONTINUE                28480002
         B     X0(R11)       RC=4 IO ERROR TRY TO CONTINUE              28482002
         B     ESTAERR1      RC=8 SHOULD NEVER HAPPEN                   28482402
         B     X0(R11)       RC=12 IO ERROR TRY TO CONTINUE             28482802
         B     ATTNPROC      RC=16 ATTN. GO PROCESS IT                  28483202
         B     X0(R11)       RC=20 RETRY ENTERED TRY TO CONTINUE        28483302
* RC=24 ESTAE ERROR                                                     28493702
         SR    R15,R15       ZERO REG 15                                28506602
         IC    R15,TSTESTRC  PUT ESTAE RETURN CODE IN R15               28508602
* ISSUE 'ESTAE SVC ERROR' MESSAGE                                       28510002
         LA    R1,SVC10NO    R1=ADDR OF SVC NUMBER                      28512002
         BAL   R14,IOSVC     PUT OUT SVC ERROR MESSAGE                  28514002
         LTR   R15,R15       TEST FOR SUCCESSFUL COMPLETION             28516402
         BZ    X0(R11)       IO SUCCESSFUL.RETURN                       28518402
         C     R15,ATTNCODE  IS ATTENTION IN EFFECT                     28518802
         BE    ATTNPROC      YES PROCESS IT                             28518902
         B     ESTAERR1      MESSAGE STILL BAD TERMINATE                28523302
         EJECT                                                          28527902
*********************************************************************** 28532302
*                                                                     * 28536702
*        USER PROGRAM CONTROL AND MONITORING SECTION.                 * 28550002
*                                                                     * 28600002
*        THIS SECTION OF CODE IS GIVEN CONTROL WHENEVER THE GO        * 28650002
*        SUBCOMMAND PROCESSOR HAS COMPLETED PROCESSING NORMALLY.      * 28700002
*        THE FUNCTION OF THIS SECTION OF CODE IS TO MAKE THE          * 28750002
*        USER PROGRAM DISPATCHABLE BY POSTING AN ECB AND TO PLACE     * 28800002
*        TEST IN THE WAIT STATE, WAITING ON ANY ONE OF A NUMBER       * 28850002
*        OF EVENTS.                                                   * 28900002
*                                                                     * 28950002
*        TO MAKE THE USER PROGRAM DISPATCHABLE AFTER EXECUTION OF     * 29000002
*        THE GO SUBCOMMAND PROCESSOR, THE FOLLOWING OCCUR --          * 29050002
*                                                                     * 29100002
*        1 --  THE INPUT BUFFER CONTAINING THE GO SUBCOMMAND IS       * 29150002
*               FREED.                                                * 29200002
*                                                                     * 30300002
*        2 --  TEST'S DISPATCHABILITY ECB IS ZEROED.                  * 30310002
*                                                                     * 30320002
*        3 --  A CHECK IS MADE TO DETERMINE IF A PSEUDO BREAK-        * 30330002
*              POINT IS TO BE DISPATCHED. IF SO, IT IS GIVEN          * 30340002
*              PRIORITY.                                              * 30342002
*                                                                     * 30344002
*        4 --  FOR OTHER THAN PSEUDO BREAKPOINTS, PROCESSING IS       * 30346002
*              RETURNED TO EITHER A SUBCOMMAND PROCESSOR OR TO        * 30348002
*              THE TMP IF AN ATTENTION INTERRUPT HAS OCCURRED         * 30348402
*              SINCE RETURN FROM GO.                                  * 30348802
*                                                                     * 30349202
*        5 --  THE TERMINAL IS REMOVED FROM THE INPUT STACK           * 30349602
*              AND THE USER PROGRAM IS POSTED.                        * 30349702
*                                                                     * 30349802
*        6 --  THE USER PROGRAM IS SET DISPATCHABLE AND TEST GOES     * 30350002
*              INTO THE WAIT STATE.                                   * 30400002
*                                                                     * 30450002
*********************************************************************** 30500002
         SPACE 2                                                        30550002
IKJEGCTL EQU   *                                                        30600002
         BAL   R11,FREINBUF   CLEAN UP AFTER 'GO'.                      30650002
         SPACE 2                                                        30700002
         L     R2,ECBTST      R2=TEST DISPATCHABILITY ECB ADDR.         30750002
         XC    X0(X4,R2),X0(R2)  CLEAR TESTS ECB.                       30800002
         SPACE 2                                                        30850002
         OC    TSTGOPSW(L'TSTGOPSW),TSTGOPSW PSEUDO BREAK NEXT.         30900002
         BNZ   POST           YES. PSEUDO BREAK GETS PRIORITY.          30950002
         SPACE 2                                                        31000002
         L     R1,ECBTMPA     POINT TO ATTN ECB                         31050002
         TM    X0(R1),TESTATTN  HAS ATTENTION BEEN HIT Q.Q.Q.           31100002
         BO    ATTNPROC       PROCESS THE ATTENTION.                    31150002
         SPACE 2                                                        31200002
POST     EQU   *                                                        32200002
         BAL   R11,REMOVE     REMOVE THE TERM ELEM OFF THE STACK        32300002
         POST  ECBPP          MAKE PROGRAM BEING TESTED DISPATCHABLE.   32350002
         SPACE 2                                                        32352003
         SPACE 2                                                        32400002
WAIT     EQU   *                                                        32450002
         BAL   R11,START      START THE TASK OR TASKS.                  32500002
         WAIT  ECBLIST=ECBLIST  TEST CREAKS TO A HALT.                  32550002
         EJECT                                                          32600002
*********************************************************************** 32650002
*                                                                     * 32700002
*        DETERMINE WHICH EVENT OCCURRED TO BRING TEST OUT OF THE      * 32750002
*        WAIT STATE.                                                  * 32800002
*                                                                     * 32850002
*        1 --  IF THE STOP/MODIFY ECB IS POSTED, BRANCH TO CLEAN-     * 32900002
*              UP AND RETURN TO THE TMP.                              * 32950002
*                                                                     * 33000002
*        2 --  IF THE TEST DISPATCHABILITY ECB IS POSTED, PROCESS     * 33050002
*              FOR EITHER SVC 061 OR SVC 097.                         * 33100002
*                                                                     * 33150002
*        3 --  OTHERWISE, BRANCH TO CONTINUE CHECK FOR POSTED ECB     * 33200002
*                                                                     * 33250002
*********************************************************************** 33300002
         SPACE 2                                                        33350002
         BAL   R11,STOP       STOP THE TASK OR TASKS.                   33400002
         SPACE 2                                                        33450002
         L     R1,ECBLOG      CHECK IF STOP/MODIFY WAS ENTERED BY OP.   33500002
         TM    X0(R1),X40     *                                         33550002
         BZ    CKECBTST      NOT POSTED CHECK NEXT ECB                  33600002
         B     ENDIT1        TERMINATE                                  33648002
         SPACE 2                                                        33650002
CKECBTST EQU   *                                                        33660002
         L     R1,ECBTST      TEST'S ECB.                               33700002
         TM    X0(R1),TESTPOST Q.WAS TEST ECB POSTED(40 OR 44).         33750002
         BZ    STAICHK        NO,CHECK STAI ECB.                        33800002
         BM    BKPNT          YES,POSTED BY SVC 97,PROCESS BREAKPOINT   33850002
         EJECT                                                          33900002
*********************************************************************** 33950002
*                                                                     * 34000002
*        POST BY SVC 61.                                              * 34010002
*        ECBTST POSTED COMPLETE WITH A X'44'.  COMPLETION CODE        * 34050002
*        PORTION OF ECBPP CONTAINS A POINTER TO THE SVC 061 SVRB.     * 34100002
*                                                                     * 34150002
*        1 --  IF SVC 061 HAS PLACED A VALID TCB ADDRESS IN ITS       * 34200002
*              EXTENDED SAVE AREA, ISSUE A GETMAIN FOR A SVC          * 34250002
*              INFORMATION BLOCK QUEUE CONTROL BLOCK AND COMPLETE     * 34300002
*                                                                     * 34350002
*        2 --  IF A DEFER BREAKPOINT QUEUE EXISTS, BRANCH TO          * 34400002
*              INVOKE THE AT SUBCOMMAND PROCESSOR TO ACTIVATE         * 34450002
*                             BREAKPOINTS IN THE MODULE JUST LOADED.  * 34500002
*                                                                     * 34550002
*********************************************************************** 34600002
         SPACE 2                                                        34650002
         L     R1,ECBPP       OBTAIN SVRB ADDRESS FOR SVC61.            34700002
         LM    R3,R4,RBEXSAVE-RBSECT(R1) GET THE TCB ADDR AND SVC       34750002
*                             INFO BLOCK POINTER.                       34800002
         LTR   R3,R3          IF TCB ADDRESS IS ZERO, IGNORE.           34850002
         BZ    NOGET          BRANCH TO AVOID GETMAIN.                  34900002
         SPACE 2                                                        34950002
         L     R0,CORETRN     GETMAIN FOR A QUEUE CONTROL BLOCK.        35000002
         GETMAIN RC,LV=(0),SP=1     GET CORE FOR QUEUE CONTROL BLOCK.   35050002
         LTR   R15,R15       WAS GETMAIN SUCCESSFUL                     35060002
         BZ    CONT1         YES CONTINUE                               35070002
* ISSUE 'GETMAIN SVC ERROR' MESSAGE                                     35080002
         LA    R1,SVC10NO    R1=ADDR OF SVC NUMBER                      35082002
         BAL   R14,IOSVC     PUT OUT SVC ERROR MESSAGE                  35084002
         B     ENDITERR      TERMINATE AFTER RETURN FROM IO             35090002
CONT1    EQU   *                                                        35092002
         MVC   X0(X4,R1),TSTTRN SAVE THE LINK FIELD.                    35100002
         STM   R3,R4,X4(R1)   TCB ADDRESS AND SVC INFO BLOCK            35150002
*                             POINTER INTO QUEUE CONTROL BLOCK.         35200002
         ST    R1,TSTTRN      SAVE HEAD QUEUE CONTROL BLOCK ADDRESS.    35250002
         SPACE 2                                                        35300002
NOGET    EQU   *                                                        35350002
         OC    DEFERTAB(L'DEFERTAB),DEFERTAB DEFER BREAKPOINT PRESENT.  35400002
         BZ    IKJEGCTL       IF NOT, BRANCH TO RESUME PROCESSING.      35450002
         SPACE 2                                                        35500002
         OI    TSTFLGS1,TSTBUILD SET SWITCH FOR IKJEGAT.                35550002
*                             CWORKCMD CONTAINS LOADNAME,LOADBGN.       35600002
         L     R2,MNLEGAT     ADDRESS OF AT ENTRY IN SUBCOMMAND         35650002
*                             TABLE.                                    35700002
         SR    R3,R3          ZERO LENGTH REGISTER TO INSURE            35750002
         IC    R3,SCDNAME(,R2) VALIDITY OF ONE BYTE LENGTH.             35800002
         LA    R5,SCDATLD(,R2) ADDRESS OF LOAD MODULE NAME FOR          35850002
*                             AT SUBCOMMAND.                            35900002
         LA    R2,SCDSCPPN(,R2) SET REGISTER TO POINT TO COMMON         35950002
*                             SUBCOMMAND NAME.                          36000002
         B     MNLXX170       BRANCH TO INVOKE AT SUBCOMMAND.           36050002
         EJECT                                                          36100002
*********************************************************************** 36150002
*                                                                     * 36200002
*        POST BY SVC 97.                                              * 36210002
*        ECBTST POSTED COMPLETE WITH A X'40'.  COMPLETION CODE        * 36250002
*        PORTION OF ECBPP CONTAINS A POINTER TO THE SVC 097 SVRB.     * 36300002
*                                                                     * 36350002
*        1 --  QUALIFY THE TCB AND PRB IN WHICH THE BREAKPOINT        * 36400002
*              OCCURRED.                                              * 36450002
*                                                                     * 36500002
*        2 --  REPLACE THE TERMINAL ON THE INPUT STACK.               * 36550002
*                                                                     * 36600002
*        3 --  DETERMINE IF A PSEUDO OR OTHER BREAKPOINT.             * 36650002
*                                                                     * 36700002
*********************************************************************** 36750002
         SPACE 2                                                        36800002
BKPNT    EQU   *                                                        36850002
         TM    TSTFLGS4,TSTSVCAB DID SVC 97 ABEND?                      36860002
         BZ    BKPT1         NO,CONTINUE                                36870002
         LA    R1,MSG3       R1=ADDR OF MESSAGE NUMBERS                 36880002
* ISSUE 'TEST ENDED DUE TO ERROR' MESSAGE                               36890002
* ISSUE 'UNRECOVERABLE SVC ERROR' MESSAGE                               36892002
         BAL   R14,IOMSG     PUT OUT MESSAGES                           36894002
         B     ENDIT1        IGNORE IO RC'S AND TERMINATE               36896002
BKPT1    EQU   *                                                        36898002
         BAL   R11,QUAL       REQUALIFY IF NECESSARY.                   36900002
         SPACE 2                                                        36950002
         BAL   R11,ADD        ADD A TERM ELEM TO THE STACK              37000002
         SPACE 2                                                        37050002
         L     R4,TSTGOPSW    SET R1 FOR POSSIBLE PARAMETER TO SVC97    37100002
         LTR   R4,R4          Q. IST 'TSTGO' FIELD ZERO.                37150002
         BZ    BRKCHK         YES,TEST DID NOT SET THE BREAKPOINT.      37200002
         EJECT                                                          37250002
*********************************************************************** 37300002
*                                                                     * 37350002
*        WHEN TSTGOPSW IS NON-ZERO, A PSEUDO BREAKPOINT IS            * 37400002
*        INDICATED.                                                   * 37450002
*                                                                     * 37500002
*        1 --  DETERMINE IF BREAKPOINT IS IN A BREAK ELEMENT.  IF     * 37550002
*              PSEUDO BREAKPOINT IS NOT WITHIN A BREAK ELEMENT,       * 37600002
*              SET RESUME ADDRESS IN RB TO THE ADDRESS SPECIFIED      * 37650002
*              IN TSTGOPSW.                                           * 37700002
*                                                                     * 37750002
*        2 --  FOR A PSEUDO BREAKPOINT OCCURRING WITHIN A BREAK       * 37800002
*              ELEMENT, COMPUTE ADDRESS OF NEXT SEQUENTIAL            * 37850002
*              INSTRUCTION IN THE USER PROGRAM AND SET RESUME         * 37900002
*              ADDRESS IN RB ACCORDINGLY.                             * 37950002
*                                                                     * 38000002
*        3 --  DETERMINE IF IKJEGLDF WAS RUNNING UNDER THE USER       * 38050002
*              TCB.  IF SO, RESTORE USER PROGRAM REGISTERS AND        * 38100002
*              DELETE IKJEGLDF.  IN ALL CASES RETURN CONTROL TO       * 38150002
*              THE USER AT THE TERMINAL.                              * 38200002
*                                                                     * 38250002
*********************************************************************** 38300002
         SPACE 2                                                        38350002
         L     R5,BREAKTAB    GET THE BREAK ELEMENT QUEUE               38400002
LOOP6    EQU   *                                                        38450002
         LTR   R5,R5          Q. HAVE ALL BREAK ELEMENTS BEEN CHECKED.  38500002
         BZ    PSEUDO1        YES. RESTORE THE SAVED I.C.               38550002
         SPACE 2                                                        38600002
         USING BRKELEM,R5     BREAK ELEMENT ADDRESSABILITY              38650002
         LA    R0,BRKINST     OBTAIN BEGINNING OF INSTR. FIELD          38700002
         LA    R2,BRKINST+X6  OBTAIN END OF INSTR. FIELD.               38750002
         LA    R4,X0(,R4)     CLEAR HIGH BYTE OF TSTGO.                 38800002
         CR    R4,R0          Q. IS IC WITHIN BREAK ELEMENT.            38850002
         BL    MISS           NO. BRANCH.                               38900002
         CR    R4,R2          Q. IS IC WITHIN BREAK ELEMENT.            38950002
         BNH   HIT            YES. BRANCH                               39000002
MISS     EQU   *                                                        39050002
         L     R5,BRKLINK     GET NEXT ELEMENT , IF ONE.                39100002
         B     LOOP6          LOOP                                      39150002
HIT      EQU   *                                                        39200002
         SR    R4,R0          COMPUTE OFFSET INTO BRKINST               39250002
         A     R4,BRKADDR     CREATE A NEW 'TSTGO' ADDRESS              39300002
         SPACE 2                                                        39350002
PSEUDO1  EQU   *                                                        39400002
         L     R5,PPTCB       ADDRESS OF USER TCB.                      39450002
         IKJEGS9G OPSW,TCBADDR=(R5),VALUE=(R4),MF=(E,MNLSVCPL)          39500002
         SPACE 2                                                        39550002
         LTR   R15,R15        CHECK RETURN CODE.                        39600002
         BZ    PSEUDO2        IF ZERO, CONTINUE.                        39650002
SVC97ERR EQU   *                                                        39700002
         NI    TSTFLGS1,XFF-TSTBUILD INDICATE NO DEFER BKPT.            39800002
* ISSUE 'TEST ENDED DUE TO ERROR' MESSAGE                               39812002
* ISSUE 'BREAKPOINT SVC ERROR CODE 4' MESSAGE                           39814002
         LA    R1,MSG4       R1=ADDR OF MESSAGE NUMBERS                 39824002
         BAL   R14,IOMSG     PUT OUT MESSAGES                           39826002
         BAL   R11,IORETCK   TEST IO RETURN CODES                       39830002
         B     PUTEND        TERMINATE.                                 39850002
         SPACE 2                                                        39900002
PSEUDO2  EQU   *                                                        39950002
         XC    TSTGOPSW(L'TSTGOPSW+L'TSTGOWCF+L'TSTRSVD2),TSTGOPSW      40000002
*                             ZERO OUT 'TSTGO' FOR NEXT USE.            40050002
         NI    TSTFLGS3,XFF-TSTSTAI  TURN OFF THE STAI BIT.             40100002
         TM    TSTFLGS2,TSTLDF  COMING FROM LOAD,DEL,GET,FREE.....      40150002
         BZ    SCREQ          NO. GET NEXT SUBCOMMAND.                  40200002
         SPACE 2                                                        40250002
         L     R2,WORKAREA    ADDRESSABILITY.                           40300002
         LA    R2,CWORKLDF-TSTCWORK(,R2) GET PP REGS ADDRESS.           40350002
         L     R5,PPTCB       ADDRESS OF USER TCB.                      40400002
         IKJEGS9G AGPR,TCBADDR=(R5),VALUE=(R2),MF=(E,MNLSVCPL)          40450002
         LTR   R15,R15        CHECK RETURN CODE.                        40500002
         BNZ   SVC97ERR       IF NOT ZERO, PUT MESSAGE.                 40550002
         SPACE 2                                                        40600002
         DELETE EP=IKJEGLDF   DELETE PP PORTION.                        40650002
         SPACE 2                                                        40700002
         NI    TSTFLGS3,XFF-TSTLINK TURN OFF LINK ABEND BIT             40750002
         BAL   R11,DCBFREE    FREE THE DCB IF NOT IN OVERLAY.           40800002
         B     SCREQ          GET THE NEXT SUBCOMMAND.                  41050002
         EJECT                                                          41100002
DCBFREE  EQU   *                                                        41150002
         L     R4,TSTDCB      GET THE Q OF DCBS.                        41200002
         TM    TSTFLGS1,ENDSW IF ENDING CLOSE ALL DCBS AND FREE.        41250002
         BO    FREEDCB        'END' OR 'RUN' HAS BEEN ENTERED.          41300002
         LTR   R4,R4          HIGH BIT ON DON'T FREE,ZERO FIELD ALSO    41350002
         BCR   NEG+Z,R11      NEGATIVE OR ZERO....RETURN.               41400002
FREEDCB  EQU   *                                                        41450002
         LTR   R4,R4          TEST FOR ZERO.                            41500002
         BCR   Z,R11          IF ZERO RETURN.                           41550002
         LA    R5,X4(,R4)     DCB ADDRESS.                              41600002
         TM    DCBOFLGS(R5),X10 CHECK IF OPEN DCB.                      41650002
         BZ    NOCLOSE        DCB ALREADY CLOSED.                       41700002
         MVC   MNLCLOSE(CLLEN),CLFORM CLOSE LIST FORM TO WORKAREA.      41750002
         CLOSE ((R5)),MF=(E,MNLCLOSE) CLOSE.                            41800002
NOCLOSE  EQU   *                                                        41850002
         MVC   TSTDCB(L'TSTDCB),X0(R4) PUSH UP ON QUEUE                 41900002
         FREEMAIN  RC,LV=100,A=(R4),SP=1 FREE DCB CORE.                 41950002
         LTR   R15,R15       WAS FREEMAIN SUCCESSFUL                    41960002
         BZ    DCBFREE       YES CONTINUE                               41970002
* ISSUE 'FREEMAIN SVC ERROR' MESSAGE                                    41990002
         LA    R1,SVC120NO   R1=ADDR OF SVC NUMBER                      41992002
         BAL   R14,IOSVC     PUT OUT SVC ERROR MESSAGE                  41992402
* IGNORE RETURN CODES AND CONTINUE                                      41994002
         B     DCBFREE        GET THE NEXT DCB IF ONE....               42000002
         EJECT                                                          42050002
*********************************************************************** 42100002
*                                                                     * 42150002
*        ENTRY AT THIS LOCATION INDICATES THAT SVC 097 POSTED         * 42200002
*        IKJEGMNL AND THAT TSTGOPSW (IN TCOMTAB) IS ZERO.  THIS       * 42250002
*        SECTION OF CODE DETERMINES IF THE BREAKPOINT LOCATION IS     * 42300002
*        THE SAME AS A LOCATION IN ONE OF THE BREAKPOINT ELEMENTS     * 42350002
*        AND INFORMS THE USER.  IF THE BREAKPOINT LOCATION IS         * 42400002
*        UNKNOWN, A NORMAL TERMINATION MESSAGE IS PUT TO THE USER     * 42450002
*        AND THE USER PROGRAM RESUME ADDRESS IS UPDATED TO POINT      * 42500002
*        TO A SVC 003 INSTRUCTION IN THE CVT.                         * 42550002
*                                                                     * 42600002
*        1 --  DETERMINE IF BREAKPOINT LOCATION IS KNOWN.  IF NOT     * 42650002
*              UPDATE RB RESUME ADDRESS TO POINT TO SVC 003 IN        * 42700002
*              CVT, ISSUE NORMAL TERMINATION MESSAGE, AND BRANCH      * 42750002
*              TO GET NEW SUBCOMMAND.                                 * 42800002
*                                                                     * 42850002
*        2 --  IF BREAKPOINT LOCATION IS KNOWN, BUILD MESSAGE         * 42900002
*              INDICATING LOCATION OF BREAKPOINT AND PUT MESSAGE      * 42950002
*              TO USER IF NOTIFY WAS SPECIFIED ON AT SUBCOMMAND.      * 43000002
*              IF NONOTIFY WAS SPECIFIED OR AFTER MESSAGE IS PUT      * 43050002
*              TO THE TERMINAL, PLACE SUBCOMMAND CHAIN ADDRESS        * 43100002
*              FOR THIS BREAKPOINT IN TCOMTAB AND BRANCH TO GET       * 43150002
*              NEW SUBCOMMAND.                                        * 43200002
*                                                                     * 43250002
*********************************************************************** 43300002
         SPACE 2                                                        43350002
BRKCHK   EQU   *                                                        43400002
         L     R4,ECBPP       R4=ADDR OF SVC 97 SVRB.                   43450002
         L     R4,RBLINK-RBSECT(,R4) ADDRESS OF RB FOR                  43500002
*                             BREAKPOINTED PROGRAM.                     43550002
         L     R5,BREAKTAB    R5=HEAD OF BREAK ELEMENT QUEUE.           43600002
LOOP2A   EQU   *                                                        43650002
         LTR   R5,R5          Q.ANY MORE BREAK ELEMENTS.                43700002
         BNZ   LOOP2B         SEE IF THE PP ENDED.                      43750002
         SPACE 2                                                        43800002
         L     R2,CVTPTR      ADDRESS OF THE CVT                        43850002
         USING CVT,R2         ESTABLISH ADDRESSABILITY TO CVT.          43900002
         LA    R2,CVTEXIT     ADDRESS OF SVC 3 INSTR IN CVT             43950002
         DROP  R2                                                       44000002
         L     R5,PPTCB       ADDRESS OF USER TCB.                      44050002
         IKJEGS9G OPSW,TCBADDR=(R5),VALUE=(R2),MF=(E,MNLSVCPL)          44100002
         LTR   R15,R15        CHECK RETURN CODE.                        44150002
         BNZ   SVC97ERR       IF NOT ZERO, PUT MESSAGE.                 44200002
         SPACE 2                                                        44250002
* ISSUE 'PROGRAM UNDER TEST HAS TERMINATED NORMALLY' MESSAGE            44350002
* ISSUE 'BREAKPOINTS ARE STILL VALID' MESSAGE                           44352002
         LA    R1,MSG5       R1=ADDR OF MESSAGE NUMBERS                 44360002
         BAL   R14,IOMSG     PUT OUT MESSAGES                           44362002
         BAL   R11,IORETCK   TEST IO RETURN CODES                       44370002
         B     SCREQ          ENTER COMMAND MODE.                       44400002
         SPACE 2                                                        44450002
         USING BRKELEM,R5     BREAK ELEMENT ADDRESSABILITY.             44500002
LOOP2B   EQU   *                                                        44550002
         CLC   BRKADDR+X1(X3),RBOPSW+X5-RBSECT(R4) Q.THIS BREAK         44600002
*                             ELEMENT THE ONE.                          44650002
         BE    ATLOC          YES,INITIALIZE CHAIN AND ENTER CMD MODE.  44700002
         L     R5,BRKLINK     NO,CHECK NEXT ELEMENT ON QUEUE.           44750002
         B     LOOP2A         *                                         44800002
         SPACE 2                                                        44850002
* BUILD AND OUTPUT 'AT' MESSAGE WHEN BREAKPOINTS ARE FOUND              44860002
ATLOC    EQU   *                                                        44900002
         L     R1,OUTBUF      R1=OUTPUT BUFFER ADDRESS.                 44950002
         LA    R2,X4(,R1)     R2=IS TO BE CONSTRUCTED MSG PTR.          45000002
         LA    R4,X4         SET INITIAL MESSAGE LENGTH TO 4            45050002
         LA    R3,N160(,R1)   GET WORK ADDRESS FOR CONVERT.             45350002
         UNPK  X1(X5,R3),BRKDISP(X3)  MAKE DISPLACEMENT PRINTABLE.      45400002
         TR    X1(X4,R3),TABLE-XF0    *                                 45450002
         LA    R8,X4          4 BYTES OF OUTPUT FROM UNPK               45500002
ATLOOP   EQU   *                                                        45550002
         CLI   X1(R3),XF0     CHECK IF LEADING ZERO.                    45600002
         BNE   PUTPLUS        PUT A PLUS SIGN BEFORE OFFSET.            45650002
         MVC   X1(X3,R3),X2(R3)  SHIFT LEFT CHARACTER.                  45700002
         BCT   R8,ATLOOP      CHECK FOR MORE LEADING ZEROS.             45750002
         B     ATNAME         BRKDISP EQUALS ZERO.                      45800002
         SPACE 2                                                        45850002
PUTPLUS  EQU   *                                                        45900002
         MVI   X0(R3),PLUS    PUT A PLUS SIGN IN FRONT OF OFFSET        45950002
         LA    R8,X1(,R8)     ADD PLUS SIGN LENGTH.                     46000002
         AR    R4,R8          UPDATE CURRENT LENGTH.                    46050002
         EX    R8,MOVEAT      MOVE '+ (OFFSET)' TO OUTBUFFER.           46100002
         AR    R2,R8          UPDATE OUTBUFFER POINTER.                 46150002
         MVC   X0(FROMLEN,R2),FROM  MOVE ' FROM ' TO OUTBUFFER.         46200002
         LA    R8,FROMLEN     GET LENGTH OF FROM DC                     46250002
         AR    R2,R8          UPDATE OUTBUFFER POINTER.                 46300002
         AR    R4,R8          UPDATE CURRENT LENGTH.                    46350002
ATNAME   EQU   *                                                        46400002
         EX    R4,MOVEAT      MOVE THE 'AT' MSG TO OUTBUFFER.           46450002
         L     R3,BRKNAME     GET THE ADDRESS STRING.                   46500002
         LA    R7,MAXLEN      GET MAX. LENGTH TO PRINT.                 46550002
         SR    R7,R4          R7=MAX.LENGTH-AT MSG LENGTH               46600002
         LH    R6,X0(,R3)     GET ADDR. STRING LENGTH.                  46650002
         CR    R6,R7          DOES ADDR.STRING EXCEED MAX.LENGTH.       46700002
         BL    SKIP1          NO.GO TO SKIP1.                           46750002
         LR    R6,R7          REPLACE WITH MAX. LENGTH.                 46800002
SKIP1    EQU   *                                                        46850002
         LTR   R6,R6          BE SURE LEN GT ZERO              @ZA20612 46900003
         LR    R11,R6         SAVE LENGTH AROUND BCTR INST     @ZA20612 46910003
         BZ    MOVEONE        IF ZERO DO NOT DECREMENT         @ZA20612 46920003
         BCTR  R6,R0          DECREMENT LENGTH FOR MOVE        @ZA20612 46930003
MOVEONE  EQU   *                                               @ZA20612 46940003
         LA    R3,X2(,R3)     POINT TO BRKNAME PLUS TWO                 46950003
         EX    R6,MOVEAT      MOVE THE ADDRESS STRING TO OUTBUFFER      46960003
         LR    R6,R11         RESTORE LENGTH AFTER DECREMENT   @ZA20612 46970003
         AR    R4,R6          GET WHOLE MESSAGE LENGTH                  47000002
         SLL   R4,N16         PUT LENGTH IN 1ST HALF WORD               47050002
         ST    R4,X0(,R1)     PUT LENGTH OF MESSAGE IN OUTBUFFER        47100002
         SPACE 2                                                        47150002
         TM    BRKFLGS,BRKNONOT CHECK IF 'NONOTIFY'                     47200002
         BO    NONOT          YES DON'T PRINT.                          47250002
         LR    R4,R1         R4=ADDRESS OF OUTBUF                       47300002
         XC    TSTIOPRM(L'TSTIOPRM),TSTIOPRM  CLEAR IO PARM LIST        47310002
* ISSUE 'AT' MESSAGE                                                    47320002
         IKJEGSIO MSG,FIRST=M0006,INST11=(ADDR,(R4)),ID=MNL22,         *47330002
               MF=(E,TSTIOPRM)                                          47340002
         BAL   R11,IORETCK   TEST IO RETURN CODES                       47342002
NONOT    EQU   *                                                        47350002
         MVC   SUBCHAIN(L'SUBCHAIN),BRKCHAIN PLACE CHAIN ADDRESS        47400002
*                             IN TCOMTAB.                               47450002
         B     SCREQ          ENTER COMMAND MODE.                       47500002
         EJECT                                                          47550002
**********************************************************************  47600002
*                                                                     * 47650002
*        CONTINUE CHECKING TO DETERMINE THE EVENT WHICH TOOK TEST     * 47700002
*        OUT OF THE WAIT STATE.                                       * 47750002
*                                                                     * 47800002
*        1 --  DETERMINE IF THE STAI RB IS POSTED INDICATING          * 47850002
*              THAT THE USER PROGRAM HAS ABENDED.  IF SO, BRANCH      * 47900002
*              TO PROCESS ABEND.                                      * 47950002
*                                                                     * 48000002
*        2 --  IF STAI ECB IS NOT POSTED, ONLY REMAINING EVENT IS     * 48050002
*              NORMAL TERMINATION OF USER PROGRAM.  ISSUE A           * 48100002
*              MESSAGE THAT USER PROGRAM HAS TERMINATED AND           * 48150002
*              RETURN TO THE TMP.                                     * 48200002
*                                                                     * 48250002
*********************************************************************** 48300002
         SPACE 2                                                        48350002
STAICHK  EQU   *                                                        48400002
         L     R3,ECBTMPS     ADDRESS OF STAI EXIT ECB.                 48450002
         TM    X0(R3),POSTFLAG Q.IS STAI ECB POSTED.                    48500002
         BNZ   STAICHK1       YES,GO PROCESS ABEND                      48550002
* ISSUE 'PROGRAM UNDER TEST HAS TERMINATED' MESSAGE                     48650002
* ISSUE 'BREAKPOINTS ARE NO LONGER VALID' MESSAGE                       48652002
         LA    R1,MSG6       R1=ADDR OF MESSAGE NUMBERS                 48660002
         BAL   R14,IOMSG     PUT OUT MESSAGES                           48662002
         BAL   R11,IORETCK   TEST IO RETURN CODES                       48670002
         B     ENDIT1         FOLD UP TENT.                             48700002
         SPACE 5                                                        48750002
*********************************************************************** 48800002
*                                                                     * 48850002
*        USER PROGRAM HAS ABENDED.  ATTEMPT TO RECOVER ABEND AND      * 48900002
*        NOTIFY USER.                                                 * 48950002
*                                                                     * 49000002
*        1 --  OBTAIN ADDRESS OF TMP (MODULE IKJEFT04) MESSAGE        * 49050002
*              ROUTINE FROM ECB AND BRANCH TO PUT ENDED DUE TO        * 49100002
*              ERROR MESSAGE.                                         * 49150002
*                                                                     * 49200002
*        2 --  DETERMINE IF IKJEGLDF ABENDED WHILE RUNNING UNDER      * 49250002
*              USER TCB.  IF SO, INDICATE A SUBTASK ABEND AND         * 49300002
*              RETURN TO TMP STAI EXIT ROUTINE.                       * 49350002
*                                                                     * 49400002
*        3 --  STARTING WITH THE ABENDING TCB, LOOK FOR MOST          * 49450002
*              RECENT PRB WHICH ABENDED OR WHICH INVOKED THE          * 49500002
*              SUPERVISOR SERVICE WHICH ABENDED.  IF NONE FOUND,      * 49550002
*              ASSUME NOTHING LEFT TO TEST IF USER IS NOT MULTI-      * 49600002
*              TASKING.                                               * 49650002
*                                                                     * 49700002
*        4 --  ONCE A PRB IS FOUND, SAVE THE PRB REGISTERS IN         * 49750002
*              REGSAVE2 AND THE ABEND LOCATION OR PRB RESUME          * 49800002
*              ADDRESS IN TSTGOPSW.  INDICATE A RETRY ADDRESS OF      * 49850002
*              TSTSVC IN TCOMTAB, POST TMP STAI EXIT COMPLETE,        * 49900002
*              AND BRANCH TO WAIT ON PSEUDO BREAKPOINT TO BE HIT.     * 49950002
*                                                                     * 50000002
*********************************************************************** 50050002
         SPACE 2                                                        50100002
STAICHK1 EQU   *                                                        50150002
         MVI   X0(R3),X0      CLEAR ECB.                                50200002
         L     R3,X0(,R3)     LOAD THE ECB.                             50250002
         LTR   R1,R3          PASS PARMS AND CHECK ADDRESS.             50300002
         BZ    SKIP111        DON'T GO.                                 50350002
         L     R15,X0(,R3)    PICK UP THE IKJEFT04 MSG PRINT RTN.       50400002
         BALR  R14,R15        PRINT 'ENDED DUE TO ERROR'                50450002
         SPACE 2                                                        50500002
SKIP111  EQU   *                                                        50550002
         TM    TSTFLGS2,TSTLDF  Q.DID LOAD,DELETE,GET OR FREE BOMB.     50600002
         L     R1,WORKAREA    GET REGS IF LDF ABENDED.                  50650002
         L     R3,REGSAVE2    REGS TO GO TO REGSAVE2 FOR SVC.           50700002
         MVC   X0(N64,R3),CWORKLDF-TSTCWORK(R1) *                       50750002
         BO    SKIP2          YES. WE HAVE PP REGS.                     50800002
         SPACE 2                                                        50850002
         L     R11,TPLPTR    GET TPL ADDRESS                            50860002
         USING TPL,R11       GET TPL ADDRESSABILITY                     50870002
         L     R7,TPLNTCB     GET THE ABENDED TCB.                      50900002
         DROP  R11                                                      50910002
         LA    R7,X0(,R7)     CLEAR THE HIGH BYTE.                      50950002
         ST    R7,PPTCB       SAVE THE TCB FOR STATUS START.            51000002
         L     R6,TCBRBP-TCB(,R7) ADDRESS OF MOST RECENT RB,            51050002
*                             ASSUME PRB FOR STAI EXIT.                 51100002
         TM    RBSTAB1-RBSECT(R6),RBFTP DETERMINE IF A PRB.             51150002
         BNZ   QRETRY         IF FIRST RB IS NOT A PRB, ERROR.          51200002
*                             BRANCH TO CHECK FOR MULTITASKING.         51250002
         TM    RBSTAB2-RBSECT(R6),RBTCBNXT CHECK IF LAST RB.            51300002
         BO    QRETRY         IF ONLY RB ON QUEUE, ERROR.               51350002
         L     R5,RBLINK-RBSECT(,R6) ADDRESS OF NEXT MOST RECENT        51400002
*                             RB, ASSUME SVRB FOR ABEND.                51450002
         TM    RBSTAB1-RBSECT(R5),RBFTSVRB DETERMINE IF A SVRB.         51500002
         BNO   QRETRY         IF NOT A SVRB, ERROR.                     51550002
         TM    RBSTAB2-RBSECT(R5),RBTCBNXT CHECK IF LAST RB.            51600002
         BO    QRETRY         IF LAST RB ON QUEUE, ERROR.               51650002
         L     R4,RBLINK-RBSECT(,R5) ADDRESS OF NEXT MOST RECENT        51700002
*                             RB, ASSUME ABENDING PRB OR IRB.           51750002
         TM    RBSTAB1-RBSECT(R4),RBFTP-RBFTIRB DETERMINE IF A          51800002
*                             PRB OR AN IRB.                            51850002
         BNZ   ABNDSVRB       IF NOT A PRB OR AN IRB, BRANCH TO         51900002
*                             CHECK FOR A SVRB.                         51950002
         LR    R2,R5          SAVE ADDRESS OF PREVIOUS RB IN R2         52250002
         B     AOK            BRANCH TO SET PSEUDO BREAKPOINT.          52300002
         SPACE 2                                                        52350002
ABNDSVRB EQU   *                                                        52400002
         TM    RBSTAB2-RBSECT(R4),RBTCBNXT CHECK IF LAST RB.            52450002
         BO    QRETRY         IF LAST RB ON QUEUE, ERROR.               52500002
         TM    RBSTAB1-RBSECT(R4),RBFTSVRB DETERMINE IF SVRB.           52550002
         BNO   QRETRY         IF NOT A SVRB, ERROR.                     52600002
         LA    R5,RBSECT-RBPREFIX(,R0) LENGTH OF RB PREFIX.             52650002
         SR    R4,R5          SET RB POINTER TO PREFIX.                 52700002
         CLC   RBINTCOD-RBPREFIX(L'RBINTCOD,R4),ABEND DETERMINE         52750002
*                             IF THIS RB ABENDED.                       52800002
         BNE   QRETRY         IF RB DID NOT ABEND, ERROR.               52850002
         AR    R4,R5          RESTORE RB POINTER TO BASIC SECTION       52900002
         SPACE 2                                                        52950002
PRBLOOK  EQU   *                                                        53000002
         LR    R2,R4          SAVE ADDRESS OF PREVIOUS RB IN R2         53010002
         L     R4,RBLINK-RBSECT(,R4) NEXT RB ON QUEUE.                  53050002
         TM    RBSTAB1-RBSECT(R4),RBFTP-RBFTIRB DETERMINE IF PRB        53100002
*                             OR IRB NEXT ON QUEUE.                     53150002
         BZ    AOK            IF A PRB OR IRB, BRANCH TO SET            53200002
*                             PSEUDO BREAKPOINT.                        53250002
         TM    RBSTAB2-RBSECT(R4),RBTCBNXT CHECK IF LAST RB.            53300002
         BZ    PRBLOOK        IF NOT THE END OF THE RB QUEUE,           53350002
*                             CONTINUE SEARCH UNTIL A PRB (OR           53400002
*                             IRB) OR END OF QUEUE OCCURS.              53450002
         SPACE 2                                                        53500002
QRETRY   EQU   *                                                        53550002
         L     R5,TCBOTC-TCB(,R7)  GET THE MOTHER TCB.                  53600002
         LA    R5,X0(,R5)     CLEAR THE HIGH BYTE.                      53650002
         C     R5,TSTTCB      Q. IS THE MOTHER OF TPLNTCB TEST TCB.     53700002
         BNE   SOMTHING       SKIP THE NOTHING CODE.                    53750002
* ISSUE 'NO ACTIVE PROGRAM LEFT' MESSAGE                                53810002
         LA    R1,MSG7       R1=ADDR OF MESSAGE NUMBERS                 53820002
         BAL   R14,IOMSG     PUT OUT MESSAGES                           53822002
         BAL   R11,IORETCK   TEST IO RETURN CODES                       53830002
         B     PUTEND         EXIT.                                     53850002
         SPACE 2                                                        53900002
SOMTHING EQU   *                                                        53950002
         ST    R5,PPTCB       SAVE THE MOTHER AND SET A PSEUDO BRKPT.   54000002
         L     R6,TCBRBP-TCB(,R5) GET THE FIRST RB .                    54050002
LOOP7C   EQU   *                                                        54100002
         TM    RBSTAB1-RBSECT(R6),RBFTSIRB Q.IS THIS A PRB(IRB)         54150002
         BZ    SETPSEUD       YES SET A PSEUDO BRKPT.                   54200002
         L     R6,RBLINK-RBSECT(,R6)  GET THE NEXT RB.                  54250002
         B     LOOP7C         LOOP UNTIL A PRB(IRB) IS FOUND.           54300002
         SPACE 2                                                        54350002
SETPSEUD EQU   *                                                        54400002
         MVC   TSTGOPSW(L'TSTGOPSW),RBOPSW+X4-RBSECT(R6) SAVE THE I.C.  54450002
         MVC   TSTGOWCF(L'TSTGOWCF),RBWCF-RBSECT(R6) SAVE THE WAIT      54500002
*                             COUNT.                                    54550002
         IKJEGS9G WCF,TCBADDR=(R6),MF=(E,MNLSVCPL)                      54600002
         LTR   R15,R15        CHECK RETURN CODE.                        54650002
         BNZ   SVC97ERR       IF NOT ZERO, PUT MESSAGE.                 54700002
         SPACE 2                                                        54750002
         LA    R5,TSTSVC      ADDRESS OF PSEUDO BREAKPT.                54800002
         IKJEGS9G OPSW,TCBADDR=(R6),VALUE=(R5),MF=(E,MNLSVCPL)          54850002
         LTR   R15,R15        CHECK RETURN CODE.                        54900002
         BNZ   SVC97ERR       IF NOT ZERO, PUT MESSAGE.                 54950002
         SPACE 2                                                        55000002
         STATUS START,TCB=(R7) START THE ABENDED TCB.                   55050002
         LA    R0,PPEXIT2     RETRY AT SVC 3                            55100002
         B     STAIPOST       LET THE ABEND CONTINUE.                   55150002
         SPACE 2                                                        55200002
AOK      EQU   *                                                        55250002
         MVC   X0(N64,R3),RBGRSAVE-RBSECT(R2)  SAVE THE REGISTERS.      55300002
         OC    TSTGOPSW(L'TSTGOPSW),RBABOPSW-RBSECT(R4)  SAVE ABEND     55350002
*                             ADDRESS.                                  55400002
         BNZ   SKIP2          SKIP THE NEXT BIT OF CODE.                55450002
         MVC   TSTGOPSW(L'TSTGOPSW),RBOPSW+X4-RBSECT(R4)  SET UP        55500002
*                             TEST GO.                                  55550002
SKIP2    EQU   *                                                        55600002
         OI    TSTFLGS3,TSTSTAI  INDICATE THAT THE DAUGHTER ABENDED.    55650002
         LA    R0,TSTSVC      RETRY ADDRESS.                            55700002
STAIPOST EQU   *                                                        55750002
         L     R11,TPLPTR    GET TPL ADDRESS                            55760002
         USING TPL,R11       GET TPL ADDRESSABILITY                     55770002
         L     R1,TPLECT     GET ECT ADDR FROM TPL          @ZA07137    55777003
         OI    ECTSWS2-ECT(R1),ECTTABND   TELL TMP STAI     @ZA07137    55784003
*                            NOT TO DEQ                     @ZA07137    55791003
         L     R1,TPLNECB     POST ECB FOR THE TMP STAI EXIT RTN.       55800002
         DROP  R11                                                      55810002
         O     R0,POST7F      POST STAI ECB WITH A '7F'                 55850002
         POST  (1),(0)        POST STAI ECB WITH X'7F'.                 55900002
         B     WAIT           ALLOW RECOVERY BY WAITING ON PSEUDO-      55950002
*                             BREAK TO OCCUR.                           56000002
         EJECT                                                          56050002
*********************************************************************** 56100002
*                                                                     * 56150002
*        TERMINATION OF THE TEST SESSION.                             * 56200002
*                                                                     * 56250002
*        THIS SECTION OF CODE WILL TERMINATE THE TEST SESSION.        * 56300002
*        SYSTEM RESOURCES WHICH WERE ALLOCATED ARE CLEANED UP         * 56350002
*        AND CONTROL IS RETURNED TO THE TMP.                          * 56400002
*                                                                     * 56450002
*        1 --  THE TEST ATTENTION EXIT IS CANCELLED.  NOTE-- CARE     * 56500002
*              MUST BE EXERCISED NOT TO CANCEL THE TMP ATTENTION      * 56550002
*              EXIT.                                                  * 56600002
*                                                                     * 56650002
*        2 --  ANY OPEN DCB IS CLOSED AND FREEMAINED.                 * 56700002
*                                                                     * 56750002
*        3 --  DETERMINE IF AN IN-CORE SYMBOL TABLE EXISTS AND        * 56800002
*              FREEMAIN IF PRESENT.                                   * 56850002
*                                                                     * 56900002
*        4 --  DETERMINE IF TERMINATION IS DUE TO AN END OR A RUN     * 56950002
*              SUBCOMMAND.  IF END WAS ENTERED, POST TERMINATION      * 57000002
*              ECB COMPLETE WITH A X'40' AND STOP THE SUBTASK         * 57050002
*              AGAIN.  TMP WILL START AND DETACH SUBTASK NON-         * 57100002
*              DISPATCHABLE. POST THE USER PROGRAM.                   * 57150002
*                                                                     * 57300002
*        5 --  DETERMINE IF A QUEUE OF SVC INFORMATION BLOCKS         * 57350002
*              EXISTS AND FREEMAIN IF PRESENT.                        * 57400002
*                                                                     * 57450002
*        6 --  INVOKE IKJDAIR TO UNALLOCATE DATA SETS FOR USER'S      * 57500002
*              TCB.                                                   * 57550002
*                                                                     * 57600002
*        7 --  ISSUE SVC 097 TO ZERO THE TCBTRN FIELD IN THE TCB.     * 57650002
*                                                                     * 57700002
*        8 --  FREEMAIN THE TCOMTAB AND OTHER WORKAREAS.              * 57750002
*                                                                     * 57800002
*********************************************************************** 57850002
         SPACE 2                                                        57900002
TMPRTURN EQU   *                                                        57950002
         L     R1,TPLPTR      GET TPL ADDRESS            @ZA07137       57950703
         L     R1,TPLECT-TPL(R1)  GET ECT ADDRESS        @ZA07137       57951403
         NI    ECTSWS2-ECT(R1),XFF-ECTTABND RESET NO DEQ @ZA07137       57952103
CANSTAX  LA    R1,RESTART1    IF ABEND DURING END PROCESSING            57989003
         ST    R1,TSTRSTRT    SET RESTART ADDRESS FOR STAE              58050002
         STAX                                                           58100002
         SPACE 2                                                        58150002
RESTART1 EQU   *                                                        58200002
         LA    R1,RESTRT1A    SET NEXT RESTART ADDRESS FOR STAE RTRY    58250002
         ST    R1,TSTRSTRT    DITTO                                     58300002
         L     R1,ECBTMPA     POINT TO ATTN ECB                         58350002
         NI    X0(R1),XFF-TESTATTN+X40  TURN OFF ONE BIT,IF ON          58400002
         BAL   R11,DCBFREE    FREE ALL THE DCBS.                        58450002
         SPACE 2                                                        58500002
RESTRT1A EQU   *                                                        58550002
         LA    R1,RESTRT1B    SET NEXT RESTART ADDRESS FOR STAE RTRY    58600002
         ST    R1,TSTRSTRT    DITTO                                     58650002
         BAL   R11,FREINBUF   CLEAN UP AFTER CP.                        58700002
         SPACE 2                                                        58750002
RESTRT1B EQU   *                                                        58800002
         LA    R1,RESTRT1D    SET NEXT RESTART ADDRESS FOR STAE RTRY    58850002
         ST    R1,TSTRSTRT    DITTO                                     58900002
         L     R2,SYMTABLE    R2=ADDR OF HEAD OF CHAIN.                 58950002
         XC    SYMTABLE(L'SYMTABLE),SYMTABLE  ZERO IN CASE OF ABEND     59000002
LOOP5    EQU   *                                                        59050002
         LTR   R2,R2          Q.END OF CHAIN.                           59100002
         BZ    RESTRT1D       YES,FORTFAHREN MIT DER REINIGUNG.         59150002
         LR    R1,R2          NO,R1=SYMBOL ELEMENT ADDR FOR FREEMAIN.   59200002
         LA    R0,SYSMLEN     GET SYMBOL COMMON SECTION LENGTH          59250002
         AH    R0,SYMBLEN(,R1) GET SYMBOL BLOCK SIZE                    59350002
         L     R2,SYMLINK(,R2) GET THE NEXT ONE.                        59400002
         FREEMAIN RC,LV=(0),A=(1),SP=1  FREE THE SYMBOL ELEMENT.        59450002
         LTR   R15,R15       TEST FOR RC=0                              59460002
         BZ    LOOP5         RC=0,CONTINUE                              59470002
* ISSUE 'FREEMAIN SVC ERROR' MESSAGE                                    59472002
         LA    R1,SVC120NO   R1=ADDR OF SVC NUMBER                      59480002
         BAL   R14,IOSVC     PUT OUT SVC ERROR MESSAGE                  59490002
         B     LOOP5         IGNORE RETURN CODES AND CONTINUE TO        59492002
*                            CHECK FOR ANOTHER SYMBOL ELEMENT.          59500002
         SPACE 2                                                        59550002
RESTRT1D EQU   *                                                        59600002
         LA    R1,ENDIT2      SET NEXT RESTART ADDRESS FOR STA @YM00583 59650002
         ST    R1,TSTRSTRT    DITTO                                     59700002
         BAL   R11,REMOVE     REMOVE THE TERM ELEM OFF THE STACK        59750002
         TM    TSTFLGS1,RUNSW  SHOULD SUBTASK BE DETACHED.              59800002
         BNZ   ENDIT2         YES.DETACH AND WIPE OUT HIS REGI @YM00583 59850002
         L     R3,ECBTERM     TERMONATION ECB FOR THE SUBTASK.          59900002
         XC    X0(X4,R3),X0(R3)  ZERO THE COMPLETION.                   59950002
         MVI   X0(R3),X40     SET TERMINATION ECB FOR DETACH.           60000002
         BAL   R11,STOPALL    FOR END, STOP TWICE - TMP WILL START      60100003
*                              ONCE AND DETACH TASK NON-DISPATCHABLE    60101003
         L     R11,TPLPTR             GET TPL ADDRESS      @ZA07137     60102003
         L     R11,TPLECT-TPL(R11)    GET ECT ADDRESS      @ZA07137     60103003
         OI    ECTSWS-ECT(R11),ECTATRM SET TMP STAI NO POST @ZA07137    60104003
         SPACE 2                                                        60105003
ENDIT2   EQU   *                                                        61050002
         LA    R1,RESTRT1F         SET NEXT RESTART ADDRESS FOR STAE    61060002
         ST    R1,TSTRSTRT         DITTO                                61080002
         L     R2,TSTTRN      GET THE HEAD OF TRN QUEUE.                61100002
         XC    TSTTRN(L'TSTTRN),TSTTRN  ZERO FOR ABEND PROCESSING       61150002
LOOP3    LTR   R1,R2          LINK PTR OR HEAD.                         61200002
         BZ    RESTRT1F       IF ZERO ...END OF QUEUE...                61250002
         L     R14,TSTTCB     LOAD TCB ADDR FOR SVC97   @ZA06226        61260003
         IKJEGS9G FREE,TCBADDR=(R14),VALUE=X0,MF=(E,MNLSVCPL)           61270003
         LTR   R15,R15       TEST FOR RC=0                              61460002
         BZ    RESTRT1F      RC=0,CONTINUE                              61465003
* ISSUE 'FREEMAIN SVC ERROR' MESSAGE                                    61480002
         LA    R1,SVC005NO   R1=ADDR OF SVC NUMBER                      61485003
         BAL   R14,IOSVC     PUT OUT SVC ERROR MESSAGE                  61492002
         SPACE 2                                                        61550002
RESTRT1F EQU   *                                                        61600002
         LA    R1,RESTART2    IF ABEND LINKING TO DAIR                  61650002
         ST    R1,TSTRSTRT    SET RESTART ADDRESS FOR STAE              61700002
         L     R0,TSTTCB      TCB ADDRESS FOR DAIR LIST                 61750002
         L     R1,WORKAREA    ADDRESSABILITY TO GENERAL WORKAREA.       61800002
         MVC   X0(LEN2C,R1),DAIR2C  UNALLOC TCB.                        61850002
         ST    R0,X4(,R1)     TCB TO LIST.                              61900002
         LA    R14,CWORKLDF-TSTCWORK(,R1) ADDR OF DAIR PARM LIST        61950002
         MVC   X0(N12,R14),PARMLIST  MOVE IN FIRST PORTION.             62000002
         L     R11,TPLPTR    GET TPL ADDRESS                            62010002
         USING TPL,R11       GET TPL ADDRESSABILITY                     62020002
         L     R0,TPLPSCB     PSCB TO SECOND PORTION.                   62050002
         DROP  R11                                                      62060002
         STM   R0,R1,N12(R14)  PSCB,DAIR PARMS TO LIST.                 62100002
         LR    R1,R14         OBTAIN ADDRESSABILITY TO CWORKLDF         62150002
         LINK  EP=IKJDAIR     LINK TO DAIR                              62200002
         SPACE 1                                               @YM00538 62200402
BLOWDAIR EQU   *                                                        62202002
RESTART2 EQU   *                                                        62204002
******* IGNORE DAIR RETURN CODES                                        62210002
         SPACE 1                                               @YM00538 62220002
*****    THE FOLLOWING CHANGE IS INSERTED TO FIX A PROBLEM IN  @YM00538 62230002
*****    THE DESIGN OF MAINLINE.  IF THE RUN SUBCOMMAND HAS    @YM00538 62240002
*****    BEEN ISSUED, MAINLINE WILL POST THE P.P. DISPATCH-    @YM00538 62242002
*****    ABILITY ECB AND WAIT ON SVC 97.  SVC 97 WILL IN TURN  @YM00538 62244002
*****    POST MAINLINE WHEN IT HAS FINISHED USE OF TCOMTAB.    @YM00538 62246002
*****    MAINLINE WILL THEN CONTINUE POOCESSING AND FREEMAIN   @YM00538 62248002
*****    TCOMTAB FROM SUBPOOL 1.                               @YM00538 62248402
         TM    TSTFLGS1,RUNSW IS IT THE RUN SUBCOMMAND         @YM00538 62248802
         BZ    RESTRT2B       NO, CONTINUE PROCESSING          @YM00538 62249202
         BAL   R11,START      SET SUBTASK DISPATCHABLE         @YM00538 62249602
         POST  ECBPP          POST PP DISPATCH. ECB            @YM00538 62249702
         L     R1,ECBTST      LOAD R1 WITH ADDR OF ECB         @YM00538 62249902
         XC    X0(X4,R1),X0(R1)  CLEAR THE ECB                 @YM00538 62259902
         WAIT  ECB=(R1)       WAIT FOR SVC 97                  @YM00538 62266602
         BAL   R11,STOP       SET SUBTASK NONDISPATCHABLE      @YM00538 62276602
         SPACE 2                                                        62283302
RESTRT2B EQU   *                                                        62350002
         LA    R1,RESTRT2A    SET NEXT RESTART ADDRESS FOR STAE RTRY    62400002
         ST    R1,TSTRSTRT    DITTO                                     62450002
         L     R5,TSTTCB      ADDRESS OF TMP/TEST TCB.                  62500002
         IKJEGS9G TRN,TCBADDR=(R5),VALUE=X0,MF=(E,MNLSVCPL)             62550002
*****                                                                   62600002
*****    RETURN CODE CHECK IGNORED.                                     62650002
*****                                                                   62700002
         SPACE 2                                                        62790002
RESTRT2A EQU   *                                                        62800002
         ESTAE 0              REMOVE ABEND EXIT                         62850002
         NI    TSTFLGS4,XFF-TSTRERTN TURN OFF RETRY SWITCH              62900002
         LR    R1,R9          R1=TCOMTAB ADDR FOR FREEMAIN.             62950002
         L     R0,MNLTCOML    LENGTH OF AREA TO BE FREED.               63000002
         L     R13,X4(R13)   RELOAD ADDRESS OF TMP SAVE AREA            63050002
         FREEMAIN RU,LV=(0),A=(1),SP=1 FREE TCOMTAB.                    63100002
         SPACE 2                                                        63150002
RESTART4 EQU   *                                                        63200002
         RETURN (14,12),RC=0                                            63250002
         EJECT                                                          63300002
*********************************************************************** 63350002
*                                                                     * 63400002
*        SET SUBTASK NON-DISPATCHABLE SUBROUTINE.                     * 63450002
*                                                                     * 63500002
*********************************************************************** 63550002
         SPACE 2                                                        63600002
STOP     EQU   *                                                        63650002
         NC    TSTGOPSW(L'TSTGOPSW),TSTGOPSW PSEUDO BREAKPOINT.         63700002
         BZ    STOPALL        NO. STOP THEM ALL.                        63750002
         STATUS STOP,TCB=PPTCB  STOP ONLY ONE.                          63800002
         BR    R11            RETURN.                                   63850002
         SPACE 2                                                        63900002
STOPALL  EQU   *                                                        63950002
         TM   TSTFLGS2,TOFFDEF  IS THE STATUS SYNCH INDICATOR  @YM07115 64010002
*                             ON FROM SVC 97..                 @YM07115 64020002
         NOP  STOPSYNH        YES ISSUE THE STATUS SYNCH       @ZA02701 64030003
         STATUS STOP          STOP THEM ALL.                   @YM07115 64040002
         BR    R11            RETURN.                                   64050002
         SPACE 2                                                        64060002
STOPSYNH EQU   *                                                        64070002
         STATUS STOP,SYNCH    STOP THEM ALL.                   @YM04132 64080002
         BR    R11            RETURN.                                   64090002
         SPACE 5                                                        64100002
*********************************************************************** 64150002
*                                                                     * 64200002
*        SET SUBTASK DISPATCHABLE SUBROUTINE.                         * 64250002
*                                                                     * 64300002
*********************************************************************** 64350002
         SPACE 2                                                        64400002
START    EQU   *                                                        64450002
         NC    TSTGOPSW(L'TSTGOPSW),TSTGOPSW PSEUDO BREAKPOINT SET.Q.   64500002
         BZ    STARTALL       NO,START THEM ALL.                        64550002
         STATUS START,TCB=PPTCB YES,START ONLY PP TCB.                  64600002
         BR    R11            RETURN.                                   64650002
         SPACE 2                                                        64700002
STARTALL EQU   *                                                        64750002
         STATUS START         START THEM ALL.                           64800002
         BR    R11            RETURN.                                   64850002
         EJECT                                                          64900002
*********************************************************************** 64950002
*                                                                     * 65000002
*        STACK MANIPULATION SUBROUTINE.                               * 65050002
*                                                                     * 65100002
*        A TERMINAL ELEMENT IS ADDED WHEN TEST INITIALLY              * 65150002
*        DETERMINES THAT INPUT IS FROM THE TERMINAL.  IKJEGIO,        * 65200002
*        UPON GETTING A RETURN CODE FROM PUTGET, TURNS ON A BIT       * 65250002
*        (TSTA IN TCOMTAB) INDICATING INPUT FROM THE TERMINAL.        * 65300002
*        IKJEGMNL WILL PLACE A TERMINAL ELEMENT ON THE STACK          * 65350002
*        WHILE TEST IS RUNNING AND WILL REMOVE IT UPON POSTING        * 65400002
*        THE PROBLEM PROGRAM.  WHEN TEST IS RUNNING FROM ELEMENTS     * 65450002
*        PLACED ON THE INPUT STACK, THIS OPERATION IS NOT DONE.       * 65500002
*                                                                     * 65550002
*********************************************************************** 65600002
         SPACE 2                                                        65650002
ADD      EQU   *                                                        65700002
         SR    R0,R0          ZERO INDICATES 'ADD'                      65750002
         TM    TSTFLGS4,TSTA  RUNNING FROM THE TERMINAL Q.Q.Q.          65800002
         BCR   Z,R11          NO. RETURN.                               65850002
         TM    TSTFLGS4,TSTB  TERM ELEM ALREADY ADDED.                  65900002
         BCR   ONES,R11       YES RETURN.                               65950002
         B     LIKECODE       CONSERVE CODE.                            66000002
         SPACE 2                                                        66050002
REMOVE   EQU   *                                                        66100002
         LA    R0,X1          ONE INDICATES 'REMOVE'                    66150002
         TM    TSTFLGS4,TSTB  IS THERE AN ELEM TO REMOVE.               66200002
         BCR   Z,R11          NO. RETURN.                               66250002
         SPACE 2                                                        66300002
LIKECODE EQU   *                                                        66350002
         MVC   MNLSRPRM(L'TSTUPT+L'TSTECT+L'TSTCPECB),PARMLIST          66400002
*                             INITIALIZE POINTERS TO UPT, ECT AND       66450002
*                             ECB FOR IKJSTCK.                          66500002
         MVC   MNLSTPB(STACKLEN),STACKLST INITIALIZE STACK              66550002
*                             PARAMETER BLOCK.                          66600002
         BCT   R0,ADD1        BRANCH IF REQUEST WAS FOR ADD             66650002
         STACK PARM=MNLSTPB,DELETE=TOP,MF=(E,MNLSRPRM) REMOVE          X66700002
                              TERMINAL FROM STACK.                      66750002
         NI    TSTFLGS4,XFF-TSTB  INDICATES NO ELEMENT.                 66800002
         BR    R11            RETURN.                                   66850002
         SPACE 2                                                        66900002
ADD1     EQU   *                                                        66950002
         STACK PARM=MNLSTPB,TERM=*,MF=(E,MNLSRPRM) ADD TERMINAL        X67000002
                              TO INPUT STACK.                           67050002
         OI    TSTFLGS4,TSTB  INDICATE AN ELEMENT.                      67100002
         BR    R11            RETURN.                                   67150002
         EJECT                                                          67200002
*********************************************************************** 67250002
*                                                                     * 67300002
*        STACK FLUSH SUBROUTINE.                                      * 67350002
*                                                                     * 67400002
*********************************************************************** 67450002
         SPACE 2                                                        67500002
FLUSH    EQU   *                                                        67550002
         XC    SUBCHAIN(L'SUBCHAIN),SUBCHAIN ZERO SUBCOMMAND            67600002
*                             CHAIN POINTER FOR BREAK ELEMENT.          67650002
         SPACE 2                                                        67700002
         TCLEARQ  INPUT                                                 67750002
         TM    TSTFLGS4,TSTA  Q. IS TEST COMING OUT OF A STACK.         67800002
         BCR   ONES,R11       NO. RETURN TO CALLER.                     67850002
         SPACE 2                                                        67900002
         MVC   MNLSRPRM(L'TSTUPT+L'TSTECT+L'TSTCPECB),PARMLIST          67950002
*                             INITIALIZE POINTERS TO UPT, ECT AND       68000002
*                             ECB FOR IKJSTCK.                          68050002
         MVC   MNLSTPB(STACKLEN),STACKLST INITIALIZE STACK              68100002
*                             PARAMETER BLOCK.                          68150002
         STACK PARM=MNLSTPB,DELETE=ALL,MF=(E,MNLSRPRM) DELETE          X68200002
                              ALL BUT FIRST ELEMENT FROM STACK.         68250002
         BR    R11            RETURN.                                   68300002
         EJECT                                                          68350002
*********************************************************************** 68400002
*                                                                     * 68450002
*        RUN SUBCOMMAND EXIT.                                         * 68500002
*                                                                     * 68550002
*        THIS SECTION OF CODE GAINS CONTROL AFTER THE RUN SUBCOM-     * 68600002
*        MAND PROCESSOR HAS COMPLETED.  SPECIAL PROCESSING IS         * 68650002
*        PERFORMED HERE THAT ALLOWS THE USER PROGRAM TO RESUME        * 68700002
*        NORMAL PROCESSING AND TO ALLOW TEST TO RETURN TO THE         * 68750002
*        TMP.                                                         * 68800002
*                                                                     * 68850002
*        1 --  SET-UP TO INVOKE THE END SUBCOMMAND PROCESSOR.         * 68900002
*              END WILL PERFORM PART OF TEST CLEAN-UP AND WILL        * 68950002
*              RETURN TO IKJEGMNL SO THAT NORMAL RETURN IS            * 69000002
*              POSSIBLE.                                              * 69050002
*                                                                     * 69100002
*********************************************************************** 69150002
         SPACE 2                                                        69200002
RUNRTURN EQU   *                                                        69250002
ENDIT1   EQU   *                                                        69300002
         OI    TSTFLGS1,ENDSW TURN ON ENDSW.                            69350002
         L     R2,MNLEGEND    ADDRESS OF END ENTRY IN SUBCOMMAND        69400002
*                             TABLE.                                    69450002
         SR    R3,R3          ZERO LENGTH REGISTER TO INSURE            69500002
         IC    R3,SCDNAME(,R2) VALIDITY OF ONE BYTE LENGTH.             69550002
         LA    R5,SCDENDLD(,R2) ADDRESS OF LOAD MODULE NAME FOR         69600002
*                             END SUBCOMMAND.                           69650002
         LA    R2,SCDSCPPN(,R2) SET REGISTER TO POINT TO COMMON         69700002
*                             SUBCOMMAND NAME.                          69750002
         B     MNLXX170       BRANCH TO INVOKE END SUBCOMMAND.          69800002
         EJECT                                                          69850002
*********************************************************************** 69900002
*                                                                     * 69950002
*        QUALIFICATION SUBROUTINE.                                    * 70000002
*                                                                     * 70050002
*        AUTOMATIC QUALIFICATION TAKES PLACE WHEN A BREAKPOINT IS     * 70100002
*        HIT EITHER UNDER A NEW TCB OR UNDER A NEW RB.                * 70150002
*                                                                     * 70200002
*        1 --  LOCATE ADDRESS OF RB TO BE CHECKED.  THIS ADDRESS      * 70250002
*              IS USED TO UPDATE PPRB IN TCOMTAB.                     * 70300002
*                                                                     * 70350002
*        2 --  WHEN NEW RB IS (A) AN IRB, (B) A PRB FOR A STAE        * 70400002
*              EXIT ROUTINE, OR (C) THE CDE POINTED TO BY THE NEW     * 70450002
*              RB IS FOR THE SAME PROGRAM AT THE SAME ADDRESS,        * 70500002
*              QUALIFICATION IS EITHER NOT POSSIBLE OR NOT            * 70550002
*              NECESSARY.                                             * 70600002
*                                                                     * 70650002
*        3 --  TO QUALIFY A NEW RB, PLACE LOAD MODULE NAME AND        * 70700002
*              ADDRESS IN TCOMTAB AND INVALIDATE CSECT NAME.          * 70750002
*                                                                     * 70800002
*********************************************************************** 70850002
         SPACE 2                                                        70900002
QUAL     EQU   *                                                        70950002
         L     R4,PPTCB       FIND CURRENT RB ADDRESS.                  71000002
         L     R2,TCBRBP-TCB(,R4) *                                     71050002
         L     R1,RBLINK-RBSECT(,R2)  *                                 71100002
         LA    R1,X0(,R1)     CLEAR HIGH BYTE.                          71150002
         L     R2,PPRB        GET LAST BREAKPOINTED RB.                 71200002
         LA    R2,X0(,R2)     CLEAR HIGH BYTE.                          71250002
         ST    R1,PPRB        SAVE THE NEW PRB ADDRESS.                 71300002
         SPACE 2                                                        71350002
         TM    RBSTAB1-RBSECT(R1),RBFTIRB Q.IS THIS AN IRB.             71400002
         BCR   ONES,R11       YES. DO NOT QUALIFY.                      71450002
         SPACE 2                                                        71500002
         L     R14,RBCDE-RBSECT(,R1) GET THE CDE POINTER.               71550002
         LA    R14,X0(,R14)   CLEAR THE HIGH BYTE.                      71600002
         LTR   R14,R14        Q.IS THE CDE PTR. ZERO.                   71650002
         BCR   Z,R11          YES. CANNOT AUTOMATICALLY QUALIFY.        71700002
         SPACE 2                                                        71750002
         CR    R1,R2          Q.IS REQUALIFICATION NEEDED.              71800002
         LR    R2,R14         PUT THE CDE PTR INTO R2                   71850002
         BNE   REQUAL         REQUALIFY TO THIS BREAKPOINTED RB         71900002
         SPACE 2                                                        71950002
         CLC   TSTAQUAL(X8),CDNAME-CDENTRY(R2)  SAME NAME AS BEFORE.    72000002
         BNE   REQUAL         REQUALIFY AUTOMATICLY                     72050002
         CLC   TSTAQUAL+X9(X3),CDENTPT-CDENTRY+X1(R2)  CHECK EPA-ES     72100002
         BCR   EQ,R11         SAME AS BEFORE. RETURN.                   72150002
         SPACE 2                                                        72200002
REQUAL   EQU   *                                                        72250002
         MVC   TSTAQUAL(N12),CDNAME-CDENTRY(R2)  SAVE NAME AND EPA      72300002
         MVI   TSTCURCT,X0    ZERO CURRENT CSECT NAME.                  72350002
         MVC   TSTCURLD(X8),CDNAME-CDENTRY(R2) REINITIALIZE CURRENT     72400002
*                             LOADNAME                                  72450002
         SPACE 2                                                        72500002
MINOR    EQU   *                                                        72550002
         TM    CDATTR-CDENTRY(R2),CDMIN IS IT A MINOR.                  72600002
         LR    R14,R2         SAVE THE CDE ADDRESS                      72650002
         L     R2,CDXLMJP-CDENTRY(,R2) WANT A MAJOR.                    72700002
         BO    MINOR          NOT A MAJOR.                              72750002
         L     R1,XTLNRFAC-XTLST(,R2) GET THE NUMBER OF EXTENTS.        72800002
         SLL   R1,X2          TIMES 4.                                  72850002
         L     R2,XTLMSBLA-XTLST(R1,R2)  GET THE MEMBER ADDRESS.        72900002
         TM    CDATTR2-CDENTRY(R14),CDOLY CHECK IF OVERLAY.             72950002
         BO    OVERLAY        YES. SPECIAL HANDLING.                    73000002
         TM    CDATTR2-CDENTRY(R14),CDSPZ TEST IF OSLOADED              73050002
         BNO   SKIP6          NO --BRANCH                               73100002
         LA    R2,N16(,R2)    ADD 16 TO BYPASS PREFIX.                  73150002
SKIP6    EQU   *                                                        73200002
         ST    R2,PPLOAD      RE-INITIALIZE PPLOAD.                     73250002
         ST    R2,TSTSYMBA    DITTO.                                    73300002
         BR    R11            RETURN.                                   73350002
         SPACE 2                                                        73400002
OVERLAY  EQU   *                                                        73450002
*                             R2=ADDRESS OF SEGTAB CSECT.               73500002
         LR    R15,R2         SAVE THE EXTENT LIST ADDR.                73550002
         LA    R0,X4          SET INDEX,4 REGIONS MAX.                  73600002
         SR    R14,R14        CLEAR FOR INSERT.                         73650002
CKREGION EQU   *                                                        73700002
         IC    R14,X8(,R2)    GET SEG NO. OF REGION                     73750002
         TM    N10(R2),XFF    ARE THEIR ANY MORE REGIONS.               73800002
         BZ    LASTREGN       NO, GO FIGURE LEN OF SEGTAB.              73850002
         BCT   R0,SETNEXT1    YES, GO SET TO CHECK NEXT.                73900002
         SPACE 2                                                        73950002
LASTREGN EQU   *                                                        74000002
         SLL   R14,X2         MULTIPLY LAST SEG NO. BY 4.               74050002
         LA    R2,N24(R14,R15) XLADDR PLUS LENGTH OF SEGTAB.            74100002
*        AT THIS POINT R2'S LOW TWO BITS ARE ZERO.                      74150002
         LA    R14,X4         ALIGN TO A DOUBLE WORD.                   74200002
         NR    R14,R2         DITTO.                                    74250002
*        R14 RESULT IS EITHER 0 OR FOUR.                                74300002
*        IF ON DOUBLE WORD BNDY 0 IS ADDED TO R2                        74350002
*        IF NOT ON A DWORD BNDY 4 IS ADDED TO R2                        74400002
         ALR   R2,R14         DITTO                                     74450002
         B     SKIP6          SAVE ROOT SEG ADDR.                       74500002
SETNEXT1 EQU   *                                                        74550002
         LA    R2,X2(,R2)     DITTO.                                    74600002
         B     CKREGION       LOOP.                                     74650002
         EJECT                                                          74700002
*********************************************************************   74710002
*        THIS IS THE ESTAE RETRY ROUTINE FOR THE MAINLINE MODULE        74750002
*        OF TEST.                                                       74800002
*********************************************************************   74850002
         SPACE                                                          75450002
IKJEGSTR EQU   *                                                        75500002
         DROP  R12                                                      75510002
         USING *,R15           ESTABLISH ADDRESSABILITY                 75550002
         L     R12,BASEAD     *                                         75600002
         DROP  R15            *                                         75650002
         USING IKJEGMNL,R12   REESTABLISH USING                         75660002
         L     R7,CVTPTR      CVTPTR                                    75700002
         USING CVT,R7         ESTABLISH ADDRESSABILITY TO CVT.          75750002
         L     R8,CVTTCBP     NEW/CURRENT WORDS.                        75800002
         DROP  R7                                                       75850002
         L     R8,X4(,R8)     CURRENT TCB.                              75900002
         L     R9,TCBTRN-TCB(R8)  TCOMTAB ADDRESS.                      75950002
         L     R13,REGSAVE1   RESET R13                                 76000002
         LM    R2,R11,N28(R13) RESET R2-R11                             76050002
         B     RETRY1        BRANCH AROUND CONSTANTS                    76150002
BASEAD   DC    A(IKJEGMNL)    MAINLINE ENTRY POINT ADDRESS/BASE         76200002
RETRY1   EQU   *                                                        76300002
         L     R3,TSTRSTRT   FETCH RESTART ADDRESS                      76350002
         LTR   R3,R3         IS THERE ONE?                              76400002
         BZ    RETRY2        NO,GO CHECK FOR END SWITCH                 76450002
         B     REESTAE       GO ISSUE ESTAE                             76500002
RETRY2   EQU   *                                                        76550002
         TM    TSTFLGS1,ENDSW DID ABEND OCCUR AT 'END' TIME?            76600002
         BZ    RETRY3        NO,GO CHECK LINK BIT                       76650002
         LA    R3,TMPRTURN   R3=WHERE TO GO AFTER ESTAE                 76700002
         B     REESTAE       GO ISSUE ESTAE                             76750002
RETRY3   EQU   *                                                        76800002
         TM    TSTFLGS3,TSTLINK DID ABEND OCCUR AT LINK TO SC TIME?     76850002
         BO    RETRY4        YES,GO CHECK FOR PERCOLLATION              76900002
         TM    TSTFLGS2,TSTLDF DID IO AFTER LDF ABEND?                  76910002
         BZ    RETRY3A       NO,CONTINUE                                76920002
         NI    TSTFLGS1,XFF-TSTFIRST TURN OFF IKJEGSTA RETURN BIT       76922002
         NI    TSTFLGS2,XFF-TSTLDF TURN OFF LDF BIT                     76924002
         NI    TSTFLGS4,XFF-TSTESTAE TURN OFF NO ESTAE BIT              76926002
         LA    R3,SCREQ2     R3=WHERE TO GO AFTER ESTAE                 76930002
         B     REESTAE       GO ISSUE ESTAE                             76940002
RETRY3A  EQU   *                                                        76942002
         LA    R3,ENDITERR   RE=WHERE TO GO AFTER ESTAE                 76950002
         B     REESTAE       GO ISSUE ESTAE                             77000002
RETRY4   EQU   *                                                        77050002
         TM    TSTFLGS4,TSTPERC HAS PERCOLLATION HAPPENED?              77100002
         BO    RETRY5        YES,SKIP LINK FAILED MESSAGE               77150002
         XC    TSTIOPRM(L'TSTIOPRM),TSTIOPRM CLEAR IO PARM LIST         77250002
* ISSUE 'LINK TO SUBCOMMAND FAILED' MESSAGE                             77300002
         IKJEGSIO MSG,FIRST=M0104,INST11=(NUM,I0032),ID=MNL22,         *77350002
               MF=(E,TSTIOPRM)                                          77400002
         BAL   R11,IORETCK   TEST IO RC'S                               77450002
RETRY5   EQU   *                                                        77500002
         NI    TSTFLGS4,XFF-TSTPERC TURN OFF PERCOLLATION BIT           77550002
         NI    TSTFLGS3,XFF-TSTLINK TURN OFF LINK BIT                   77560002
         NI    TSTFLGS1,XFF-TSTPRINT-PCHLSTVL-RANGESW                   77570002
         NI    TSTFLGS2,XFF-TSTXCTL TURN OFF XCTL BIT                   77580002
         TM    TSTFLGS1,TSTBUILD IS BUILD SWITCH ON?                    77590002
         BZ    RETRY6        NO,GO SET UP FOR NEW COMMAND               77592002
         LA    R3,BUILDON    R3=WHERE TO GO AFTER ESTAE                 77594002
         B     REESTAE       GO ISSUE ESTAE                             77596002
RETRY6   EQU   *                                                        77598002
         LA    R3,SCREQ1     R3=WHERE TO GO AFTER ESTAE                 77598402
REESTAE  EQU   *                                                        77598802
         XC    MNLSVCPL,MNLSVCPL CLEAR SVC PARAMETER LIST               77599202
         L     R15,TSTSTAE   R15=ADDR OF ESTAE EXIT ROUTINE             77599302
         ESTAE (R15),OV,PARAM=MNLSPL,XCTL=NO,RECORD=YES,               *77599602
               MF=(E,MNLSVCPL)  OVERLAY PREVIOUS ESTAE                  77599802
         LTR   R15,R15       WAS ESTAE SUCCESSFUL?                      77599902
         BNZ   TMPRTURN      NO,TERMINATE                               77600002
         NI    TSTFLGS4,XFF-TSTRERTN YES,TURN OFF RETRY BIT             77616602
         BR    R3            GO WHERE R3 POINTS TO                      77626602
BUILDON  NI    TSTFLGS1,XFF-TSTBUILD  CONTINUE PROCESSING               77633302
         B     IKJEGCTL       GO TO P.P.                                77650002
PUTEND   EQU   *                                                        77950002
         TM    TSTFLGS1,TSTBUILD  IS THIS A DEFER BREAK POINT           78050002
         BO    BUILDON        YES. IGNORE DEFER BREAK POINT.            78100002
ENDITERR EQU   *                                                        78150002
         BAL   R11,FLUSH      TCLEARQ AND MAYBE STACK FLUSH.            78200002
         B     ENDIT1         GO THRU END PROCESSING.                   78250002
         EJECT                                                          78300002
******************* PROCESS ERRET FOR LINK'S ************************** 78302002
SCANERR  EQU   *                                                        78310002
         LR    R0,R1         LOAD ABEND CODE INTO R0                    78310102
         LA    R1,SVC6NO1    R1=ADDR OF SVC NUMBER AND INSERT NUMBER    78310402
* ISSUE 'LINK SVC ERROR' MESSAGE                                        78310502
         BAL   R14,IOSVC1    PUT OUT SVC ERROR MESSAGE                  78310802
         B     ENDITERR      TERMINATE                                  78311202
SUBCERR  EQU   *                                                        78312002
         LA    R1,SVC6NO2    R1=ADDR OF SVC NUMBER                      78314002
* ISSUE 'LINK SVC ERROR' MESSAGE                                        78316002
         BAL   R14,IOSVC     PUT OUT SVC ERROR MESSAGE                  78318002
         BAL   R11,IORETCK   TEST IO RC'S                               78320002
         SR    R15,R15       CLEAR R15                                  78320402
         B     BLOWSC        RETURN AS THOUGH LINK WAS SUCCESSFUL       78320802
         SPACE 2                                                        78322002
         EJECT                                                          78332002
* COMMON IO MACROS                                                      78342002
IOSVC    EQU   *             COMMON SVC ERROR PROCESSOR                 78372002
         XC    TSTIOPRM(L'TSTIOPRM),TSTIOPRM CLEAR IO PARM LIST         78382002
         ST    R14,MSAVE14   SAVE RETURN ADDRESS                        78384002
         ST    R2,MSAVE234   SAVE R2 FOR REUSE                          78384102
         LH    R2,X0(R1)     R2=SVC NUMBER                              78384202
         IKJEGSIO SVCERR,SVC=(R2),RC=(R15),ID=MNL22,MF=(E,TSTIOPRM)     78384302
         L     R2,MSAVE234   RESET R2                                   78397402
         L     R14,MSAVE14   RESET RETURN REGISTER                      78407402
         BR    R14           RETURN TO CALLER                           78409402
IOSVC1   EQU   *             COMMON SVC ERROR PROCESSOR                 78409502
         XC    TSTIOPRM(L'TSTIOPRM),TSTIOPRM CLEAR IO PARM LIST         78409602
         ST    R14,MSAVE14   SAVE RETURN ADDRESS                        78409702
         STM   R2,R3,MSAVE234 SAVE R2-3 FOR REUSE                       78411302
         LH    R2,X0(R1)     R2=SVC NUMBER                              78413302
         LH    R3,X2(R1)     R3=INSERT NUMBER                           78413402
         IKJEGSIO SVCERR,SVC=(R2),RC=(R15),ABENDRG=(R0),               *78413502
               INST11=(NUM,(R3)),ID=MNL22,MF=(E,TSTIOPRM)               78413902
         LM    R2,R3,MSAVE234 RESET R2-3                                78415002
         L     R14,MSAVE14   RESET RETURN REGISTER                      78415402
         BR    R14           RETURN TO CALLER                           78415802
IOMSG    EQU   *             COMMON MESSAGE PROCESSOR                   78416202
         XC    TSTIOPRM(L'TSTIOPRM),TSTIOPRM CLEAR IO PARM LIST         78416602
         STM   R2,R3,MSAVE234 SAVE R2-3 FOR REUSE                       78417002
         ST    R14,MSAVE14   SAVE RETURN ADDRESS                        78418502
         LH    R2,X0(R1)     R2=FIRST LEVEL MESSAGE NUMBER              78420102
         LH    R3,X2(R1)     R3=SECOND LEVEL MESSAGE NUMBER             78421702
         IKJEGSIO MSG,FIRST=(R2),SECOND=(R3),ID=MNL22,MF=(E,TSTIOPRM)   78423302
         LM    R2,R3,MSAVE234 RESET R2-3                                78424902
         L     R14,MSAVE14   RESET RETURN REGISTER                      78426502
         BR    R14           RETURN TO CALLER                           78428102
         EJECT                                                          78601702
MNLCMDCK CLC   X0(*-*,R2),X1(R5)                                        78608602
MNLSCDMV MVC   ECTSCMD-ECT(*-*,R1),X0(R2)                               78615502
MOVEAT   MVC   X0(X0,R2),X0(R3)  MOVE A PART OF AT MSG TO OUTBUF        78622402
*********************************************************************** 78629302
*                                                                     * 78636202
*        CONSTANTS AND DSECTS                                         * 78643102
*                                                                     * 78650002
*********************************************************************** 78700002
         SPACE 5                                                        78750002
MNLEGMN1 DC    V(IKJEGMN1)   ENTRY TO SUBCOMMAND CHAIN PROCESSOR        78760002
MNLEGATN DC    V(IKJEGATN)   ATTENTION EXIT ROUTINE ENTRY POINT.        78800002
MNLSIBLN EQU   *              LENGTH=16  SIB CORE                       78850002
ATTNCODE DC    A(16)          RETURN CODE ON ATTENTION INTERRUPT.       79500002
MNLTCOML DC    A(TCOMLEN+OUTBUFRL+CONAREAL+CWORKLEN+REGSAVEL)           79700002
*                             LENGTH OF TESTS WORK AREA.                79750002
CORETRN  DC    A(12)          CONTROL WORDS FOR SVC INFO BLKS.          79800002
         SPACE                                                          80050002
MNLEGAT  DC    V(IKJEGAID)    AT'S ID                                   80650002
MNLEGEND DC    V(IKJEGEID)    END'S ID                                  80700002
MNLEGPCH DC    V(IKJEGPID)    ADDRESS OF ASSIGN ENTRY IN                80750002
*                             SUBCOMMAND TABLE.                         80800002
MNLIBMTB DC    V(IKJEGSCD)    ADDRESS OF IBM TABLE OF TEST SUBCOMMANDS. 80850002
MNLUSRTB DC    V(IKJEGSCU)    ADDRESS OF USER TABLE OF SUBCOMMANDS.     80900002
POST7F   DC    X'3F000000'   POST CODE OF '7F'                          80950002
TABLE    DC    C'0123456789ABCDEF' TABLE FOR TRANSLATE.                 81050002
FROM     DC    C' FROM '      FROM                                      81100002
FROMLEN  EQU   *-FROM         FROM LENGTH                               81150002
ABEND    DC    XL2'000D'      ABEND CONSTANT.                           81200002
         SPACE                                                          81250002
*        IC TABLE FOR ABENDS                                            81300002
         SPACE                                                          81350002
MNLABTAB DS    0F             ABEND VECTOR TABLE FOR RESIDENT CODE.     81400002
         DC    AL1(DAIRCODE),AL3(BLOWDAIR)  LINK TO DAIR FAILED.        81450002
         DC    AL1(0),AL3(BLOWSC) WILL RETRY, NO MESSAGE PRINTED.       81500002
         DC    X'FFFF'        STOPPER.                                  81550002
SVC6NO1  DC    H'6'          SVC 6 NUMBER                               81552002
         DC    H'43'         INSERT NUMBER FOR ...IKJSCAN...            81554002
SVC6NO2  DC    H'6'          SVC 6 NUMBER                               81556002
SVC10NO  DC    H'10'         SVC 10 NUMBER                              81560002
SVC60NO  DC    H'60'         SVC 60 NUMBER                              81570002
SVC120NO DC    H'120'        SVC 120 NUMBER                             81580002
SVC005NO DC    H'5'           SVC 5 (FREEMAIN)                          81585003
MSG1     DC    H'100'        TEST ENDED DUE TO ERROR                    81590002
         DC    H'0'          NO SECOND LEVEL MESSAGE                    81592002
MSG2     DC    H'3'          INVALID COMMAND                            81594002
         DC    H'200'        COMMAND NOT SUPPORTED                      81596002
MSG3     DC    H'100'        TEST ENDED DUE TO ERROR                    81598002
         DC    H'287'        UNRECOVERABLE SVC ERROR                    81598402
MSG4     DC    H'100'        TEST ENDED DUE TO ERROR                    81598802
         DC    H'273'        BREAKPOINT SVC ERROR CODE 4                81599202
MSG5     DC    H'5'          PROGRAM TERMINATED NORMALLY                81599602
         DC    H'201'        BREAKPOINTS ARE STILL VALID                81599702
MSG6     DC    H'7'          PROGRAM HAS TERMINATED                     81599802
         DC    H'203'        BREAKPOINTS ARE NO LONGER VALID            81599902
MSG7     DC    H'1'          NO ACTIVE PROGRAM LEFT                     81616602
         DC    H'0'          NOSECOND LEVEL MESSAGE                     81626602
         EJECT                                                          81633302
*        LIST FORMS                                                     81650002
         SPACE                                                          81700002
         IKJDAP2C                                                       81750002
DA2CLEN  EQU   *              LENGTH                                    81800002
IKJEGMNL CSECT                                                          81850002
DAIR2C   DC    (DA2CLEN-DAPB2C)X'0'  INITIALIZE BEFORE ORGS             81900002
         ORG   DA2CCD-DAPB2C+DAIR2C    *                                81950002
         DC    XL2'002C'      CODE                                      82000002
         ORG   DA2CLEN-DAPB2C+DAIR2C   *                                82050002
LEN2C    EQU   *-DAIR2C                                                 82100002
         SPACE 5                                                        82150002
MNLSTAX  DS    0F             LIST FORM OF STAX MACRO INSTRUCTION.      82200002
         STAX  0,OBUF=(IKJEGMMT,4),IBUF=(,0),MF=L                       82250002
MNLSTAXL EQU   *-MNLSTAX      LENGTH OF MACRO LIST FORM.                82300002
         SPACE 5                                                        82350002
CLFORM   CLOSE CLFORM,MF=L    *                                         82400002
CLLEN    EQU   *-CLFORM       LENGTH OF CLOSE L-FORM.                   82450002
         SPACE 5                                                        82500002
         SPACE 2                                                        82610002
MNLSPL   IKJEGSPL RTRY=IKJEGSTR,ABNTB=MNLABTAB,MODNM=IKJEGMNL,         *82620002
               TNM=MAINLINE     ESTAE PARAMETER LIST                    82630002
         EJECT                                                          82650002
*        EQUATES                                                        82800002
         SPACE                                                          82850002
DAIRCODE EQU   99             LINK TO DAIR FAILED                       82900002
X0       EQU   0              HEXIDECIMAL 0                             82950002
X1       EQU   1              HEXIDECIMAL 1                             83000002
X2       EQU   2              HEXIDECIMAL 2                             83050002
X3       EQU   3              HEXIDECIMAL 3                             83100002
X4       EQU   4              HEXIDECIMAL 4                             83150002
X5       EQU   5              HEXIDECIMAL 5                             83200002
X6       EQU   6              HEXIDECIMAL 6                             83250002
X7       EQU   7              HEXIDECIMAL 7                             83300002
X8       EQU   8              HEXIDECIMAL 8                             83350002
X9       EQU   9              HEXIDECIMAL 9                             83400002
N0       EQU   0             NUMBER ZERO                                83410002
N2       EQU   2             NUMBER 2                                   83420002
N4       EQU   4             NUMBER 4                                   83430002
N10      EQU   10             NUMBER 10                                 83450002
N12      EQU   12             TWELVE                                    83500002
N16      EQU   16             SIXTEEN                                   83550002
N20      EQU   20            TWENTY                                     83560002
N24      EQU   24             TWENTY FOUR.                              83600002
N28      EQU   28             TWENTY EIGHT.                             83650002
N48      EQU   48            NUMBER 48                                  83660002
N64      EQU   64             SIXTY FOUR.                               83700002
N160     EQU   160            ONE SIXTY                                 83750002
N1       EQU   1             NUMBER 1                                   83760002
N4095    EQU   4095          NUMBER 4095                                83770002
X10      EQU   X'10'                                                    83800002
X40      EQU   X'40'          BLANK,POST FLAG,OR HEX 40                 83850002
XF0      EQU   X'F0'          HEXIDECIMAL F0                            83900002
XFF      EQU   X'FF'          HEXIDECIMAL FF                            83950002
Z        EQU   8              ZERO CODITION CODE.                       84000002
ONES     EQU   1              ONES CONDITION CODE.                      84050002
TESTPOST EQU   X'44'          POST MASK FOR SVC 61 POST.                84100002
MAXLEN   EQU   154            *                                         84150002
POSTFLAG EQU   X'40'          NORMAL POST MASK.                         84200002
HEX00    EQU   X'00'         VALUE OF X00                               84246002
HEXFF    EQU   X'FF'         VALUE OF XFF                               84248002
HEX4D    EQU   X'4D'         VALUE OF X4D-LEFT PAREN                    84248402
HEX5D    EQU   X'5D'         VALUE OF X5D-RIGHT PAREN                   84248802
HEX5E    EQU   X'5E'         VALUE OF X5E-SEMICOLON                     84249202
HEX7D    EQU   X'7D'         VALUE OF X7D-SINGLE QUOTE                  84249602
HEX40    EQU   X'40'         VALUE OF X40-BLANK                         84249702
LEFTPREN EQU   B'00001000'   VALUE OF X08                               84249802
FIRSTQSW EQU   B'00000100'   VALUE OF X04                               84249902
         SPACE 5                                                        84250002
STACKLST STACK MF=L                                                     84300002
STACKLEN EQU   *-STACKLST                                               84350002
         SPACE 5                                                        84400002
SYSMLEN  EQU   16             *                                         84450002
SYMBLEN  EQU   14             DISPLACEMENT INTO BLOCK                   84500002
SYMLINK  EQU   0              LINK FIELD.                               84550002
EQ       EQU   8              EQUAL CONDITION CODE.                     84600002
NE       EQU   7              NE CONDITION CODE.                        84650002
NZ       EQU   7              NZ CONDITION CODE.                        84700002
NEG      EQU   4              NEGATIVE CONDITION.                       84750002
PLUS     EQU   C'+'           PLUS SIGN                                 84800002
MNLLPARN EQU   C'('           LEFT PAREN                                84850002
MNLEQUAL EQU   C'='           EQUAL SIGN                                84900002
TESTATTN EQU   X'48'          TEST ATTN POST CODE.                      84950002
MNLBLANK EQU   C' '           CHARACTER BLANK.                          85000002
SIBLINK  EQU   12             *                                         85050002
DCBOFLGS EQU   48                                                       85100002
         EJECT                                                          85104002
IKJEGMN1 CSECT                                                          85110002
************************************************************            85130002
** HERE WE PROCESS A SUBCOMMAND CHAIN. REGISTER2 WILL BE  **            85140002
** USED TO SCAN THE CHAIN. WE WILL LOOK FOR A SEMI-COLON  **            85142002
** OR ZEROS. WHEN A SEMI-COLON IS FOUND THIS INDICATES    **            85144002
** THE END OF ONE COMMAND. THIS COMMAND WILL BE PLACED    **            85146002
** INTO AN INBUF AREA GOTTEN WITH A GETMAIN. THE ADDRESS  **            85148002
** OF THE GETMAIN AREA IS PLACED INTO INBUF AND RETURN    **            85148402
** TO LABEL SCREQ.WHEN ZERO IS FOUND THIS INDICATES       **            85148802
** END OF THE CHAIN                                       **            85149202
************************************************************            85149602
         SAVE  (14,12),,*    SAVE REGISTERS IN TCOMTAB FOR REUSE        85149702
         USING IKJEGMN1,R12  ESTABLISH ADDRESSABILITY                   85149802
         LR    R12,R15       SET BASE REGISTER                          85154002
         XR    R3,R3         ZERO OUT R3 TO USE IT AS LENGTH COUNTER    85158202
         XR    R4,R4         WE NEED R4 TO ACT AS LENGTH COUNTER        85162402
         L     R2,SUBCHAIN   GET SUBCHAIN ADDRESS FROM TCOMTAB          85166602
         LA    R2,N2(R2)     INCREMENT R2 PASS LENGTH FIELD             85176602
         LR    R6,R2         PLACE BEGINNING ADDR OF CHAIN IN R6        85178602
A005000  EQU   *             EQUATE LABEL TO THS ADDRESS                85180602
         CLI   N0(R2),HEX00  CHECK TO SEE IF WE ARE AT THE END          85182602
         BNE   A00500        IF NOT AT END OF SUBCMD THEN BRANCH        85183002
         NI    TSTFLGS2,HEXFF-LEFTPREN TURN OFF LEFT PREN SW            85183102
         NI    TSTFLGS2,HEXFF-FIRSTQSW TURN OFF FIRST QUOTE SW          85183202
         B     A00519        BRANCH TO TERMINATE SUBCMD PROCESSING      85188802
A00500   EQU   *             EQUATE LABEL TO THIS ADDRESS               85190802
         CLI   N0(R2),HEX4D  DO WE HAVE A LEFT PARENTHESIS              85192802
         BNE   A00501        IF NOT THEN BRANCH TO CHECK SOME MORE      85193202
         TM    TSTFLGS2,FIRSTQSW SEE IF A FIRST QUOTE WAS FOUND         85193602
         BO    A00505        IF ON DONT KEEP COUNT OF THIS PAREN        85194002
         LA    R3,N1(R3)     KEEP A COUNT OF PARENS IN R3               85194102
         OI    TSTFLGS2,LEFTPREN TURN ON LEFT PARENTHESIS FOUND SW      85194202
         B     A00505        BRANCH TO INCREMENT POINTER AND COUNT      85194302
************************************************************            85208202
** THE SUBCOMMAND CHAIN IS SCANNED USING THIS SCAN        **            85218202
** WE CHECK FOR A SEMI-COLON,LEFT AND RIGHT PARENTHESIS   **            85220202
** AND END OF THE CHAIN. IF AN APOSTROPHY IS ENCOUNTERED  **            85220602
** SWITCHES ARE TURNED ON SO THAT SEMI-COLONS AND         **            85221002
** PARENTHESIS OCCURRING WITHIN THE APOSTROPHIES ARE      **            85221402
** DISREGARDED.                                           **            85221802
************************************************************            85221902
A00501   EQU   *             EQUATE LABEL TO THIS ADDRESS               85222002
         CLI   N0(R2),HEX5D  CHECK FOR A RIGHT PAREN                    85222102
         BNE   A00502        IF NOT EQUAL TO ) THEN BRANCH              85226702
         TM    TSTFLGS2,FIRSTQSW  SEE IF A QUOTE HAS BEEN FOUND YET     85228702
         BO    A00505        IF ON THEN DISREGARD THIS PAREN            85230702
         TM    TSTFLGS2,LEFTPREN SEE IF A LEFT PREN SW EXIST            85231102
         BNO   A00505        IF IT DOESNT THEN BRANCH                   85231202
         BCTR  R3,N0         DECREMENT REG3 BY ONE                      85231302
         LTR   R3,R3         SEE IF LEFT AND RIGHT PARENS BALANCE       85231402
         BNZ   A00505        IF THEY DONT THEN BRANCH TO CHECK MORE     85236002
         NI    TSTFLGS2,HEXFF-LEFTPREN TURN OFF LEFT PREN SW SINCE      85238002
*                            RIGHT PARENTHESIS BALANCE IT OUT           85240002
         LA    R4,N1(R4)     INCREMENT LENGTH BY ONE                    85240402
         LA    R2,N1(R2)     LETS SEE IF WE THIS IS THE LAST PAREN      85240502
         CLI   N0(R2),HEX00  CHECK FOR END OF CHAIN INDICATOR           85240602
         BE    A00519        IF WE ARE THEN BRANCH TO LEAVE             85240702
         BCTR  R2,N0         OTHERWISE BACK R2 UP ONE                   85252502
         BCTR  R4,N0         RETURN R4 TO ORIGINAL VALUE                85262502
         B     A00505        BRANCH TO CONTINUE PROCESSING              85264502
A00502   EQU   *             EQUATE LABEL TO THIS ADDRESS               85268402
         CLI   N0(R2),HEX5E  CHECK FOR A SEMICOLON                      85270402
         BNE   A00503        IF NOT A SEMICOLON THEN BRANCH             85272402
         TM    TSTFLGS2,FIRSTQSW SEE IF A QUOTE HAS BEEN FOUND YET      85276302
         BO    A00505        IF ON THEN SKIP THE FOLLOWING CODE         85278302
         TM    TSTFLGS2,LEFTPREN HAS A LEFT PARENTHESIS BEEN FOUND YET  85280302
         BO    A00505        IF ON BRANCH TO CONTINEU THE SCAN          85284202
         BCTR  R2,N0         DECREMENT R2 TO SIMULATE LENGTH FLD        85286202
         B     A00520        OTHERWISE BRANCH TO REMOVE SUBCOMD         85288202
A00503   EQU   *             EQUATE LABEL TO THIS ADDRESS               85298502
         TM    TSTFLGS2,FIRSTQSW SEE IF A QUOTE HAS BEEN FOUND YET      85308502
         BO    A00504        IF ON THEN LEAVE THIS CODE ALONE           85308602
         CLI   N0(R2),HEX7D  IF NOT ON THEN CHECK FOR A QUOTE           85308702
         BNE   A00505        IF NOT PRESENT THEN CONTINUE SCAN          85312102
         OI    TSTFLGS2,FIRSTQSW TURN ON A QUOTE FOUND SW               85314102
         B     A00505        BRANCH TO CONTINUE THE SCAN                85314502
A00504   EQU   *             EQUATE LABEL TO THIS ADDRESS               85314902
         CLI   N0(R2),HEX7D  CHECK FOR AN IMBEDDED QUOTE                85315302
         BNE   A00505        IF NOT ON THEN BRANCH TO CONTINUE SCAN     85315402
         LA    R4,N1(R4)     INCREMENT COUNT REG                        85315502
         LA    R2,N1(R2)     INCREMENT SCAN REG                         85315602
         CLI   N0(R2),HEX7D  CHECK FOR THE MATE OF THE FIRST            85319002
*                            IMBEDDED QUOTE THERE SHOULD BE ONE         85321002
         BE    A00505        IF THERE IS ONE THEN ALL IS OK BRANCH      85321402
*                            TO CONTINUE SCAN                           85321802
         XI    TSTFLGS2,FIRSTQSW TURN OFF THE FIRST QUOTE SW            85322202
         B     A005000       BRANCH TO CONTINUE SCANNING                85322302
************************************************************            85322402
** IN THIS SCAN REGISTER 3 IS USED TO KEEP COUNT OF       **            85322502
** LEFT PARENTHESIS, REGISTER 4 IS USED TO RECORD THE     **            85325902
** LENGTH OF THE INDIVIDUAL COMMANDS IN THE CHAIN         **            85327902
** REGISTER 2 IS USED FOR SCANNING FOR THE VARIOUS        **            85328302
** INDICATORS (EG. SEMI-COLON), REGISTER 6 CONTAINS       **            85328702
** THE BEGINNING ADDRESS OF THE COMMAND. REGISTER         **            85329102
** 5 CONTAINS THE END ADDRESS OF THE CHAIN, REGISTER      **            85329202
** 8 CONTAINS THE LENGTH OF THE CHAIN, REGISTER 7         **            85329302
** IS USED FOR MISCELLANEOUS JOBS.                        **            85329402
************************************************************            85332802
A00505   EQU   *             EQUATE LABEL TO THIS ADDRESS               85334802
         LA    R4,N1(R4)     INCREMENT COUNT REG BY ONE                 85335202
         LA    R2,N1(R2)     INCREMENT SCAN REG BY ONE                  85335602
         B     A005000       BRANCH TO CONTINUE SCAN                    85336002
A00519   EQU   *             EQUATE LABEL TO THIS ADDRESS               85336102
         XR    R2,R2         ZERO OUT REG2                              85336202
A00520   EQU   *             EQUATE LABEL TO THIS ADDRESS               85336302
         ST    R2,SUBCHAIN   UPDATE SUBCHAIN POINTER IN                 85337402
*                            TCOMTAB TO ADDRESS NEXT COMMAND            85339402
A00530   EQU   *             EQUATE LABEL TO THIS ADDRESS               85339502
         LTR   R4,R4         MAKE SURE WE HAVE A LENGTH FOR             85339602
*                            THE SUB-COMMAND                            85348202
         BNZ   A00540        IF WE DO HAVE A CHAIN THEN BRANCH          85350202
         B     A00505        OTHERWISE BRANCH TO PROCESS NEXT CHAIN     85352202
*                            INSTRUCTION                                85354202
A00540   EQU   *             EQUATE LABEL TO THIS ADDRESS               85356202
         LA    R4,N4(N0,R4)  ADD 4 BYTES TO REG4 FOR LL FIELD           85356602
         L     R1,WORKAREA   LOAD ADDR OF WORKAREA FROM                 85356702
*                            TCOMTAB INTO REG1                          85356802
         LA    R7,N48(R1)    PLACE ADDRESS FROM WORKAREA INTO           85356902
*                            REG4 FOR RETURN AREA FROM GETMAIN          85368502
         GETMAIN EC,LV=(4),A=(7),SP=1,MF=(E,(1))                        85378502
*                            ISSUE A GETMAIN FOR INPUT BUF AREA         85378902
         LTR   R15,R15       TEST FOR SUCCESSFUL GETMAIN                85379302
         BNZ   A00600        CANNOT GET REQUESTED CORE,EXIT             85379702
         L     R1,N0(R7)     PLACE ADDR OF GOTTEN CORE IN REG1          85380102
         ST    R1,INBUF      PLACE INPUT ADDRESS INTO TCOMTAB AT        85380202
*                            INBUF                                      85380302
         BCTR  R4,N0         SUBTRACT ONE FROM REG4 SO AS NOT TO        85381102
*                            EXCEED INPUT BUFFER WHEN BLANKED OUT       85381502
         BCTR  R4,N0         DECREMENT FOR EXECUTE                      85381902
         MVI   N0(R1),HEX40  PLACE A BLANK INTO FIRST BYTE OF AREA      85382302
         EX    R4,BLANKOUT   SPREAD THIS BLANK THRU ENTIRE AREA         85382702
         LA    R4,N2(N0,R4)  ADD1 TO R4 TO RESTORE TO ORIGINAL          85385602
         XC    N0(N4,R1),N0(R1) ZERO OUT FIRST 4 BYTES ON INPUT         85387602
         STH   R4,N0(R1)     PLACE LENGTH INTO FIRST 2 BYTES            85389602
*                            OF INPUT BUFFER                            85390002
         LA    R7,N4         PLACE A 4 INTO REG7                        85390402
         SR    R4,R7         SUBTRACT 4 BYTES FOR LENGTH                85390802
         BCTR  R4,N0         DECREMENT R4 BY 1                          85391202
         EX    R4,A00702     MOVE COMMAND FROM SUB-COMMAND              85391302
*                            CHAIN TO INPUT BUFFER                      85393402
A00600   EQU   *             EQUATE LABEL TO THIS ADDRESS               85395402
         RETURN (14,12),RC=(15)                                         85397402
BLANKOUT MVC   N1(N1,R1),N0(R1) BLANKS OUT GETMAIN AREA                 85404402
A00702   MVC   N4(N1,R1),N0(R6)  MOVE SUB-COMMAND FROM CHAIN TO         85404802
*                            INPUT BUFFER                               85404902
IKJEGMNL CSECT                                                          85408502
         EJECT                                                          85412402
         BRKELEM                                                        85416002
         EJECT                                                          85419602
         TSTCWORK                                                       85423202
         EJECT                                                          85426802
         TCOMTAB                                                        85438402
PPEXIT2H EQU   PPEXIT+2       2ND HALF WORD OF PPEXIT                   85450002
         SPACE                                                          85500002
         ORG   TSTMNLWK       DEFINE MAINLINE WORK AREA.                85550002
MNLCFLGS DS    0A             CONTROL FLAGS.                            85600002
MNLCFLG1 DS    X              FLAG BYTE 1.                              85650002
MNLABBRV EQU   B'10000000'    ABBREVIATION FOR SUBCOMMAND NAME.         85700002
*              B'0XXXXXXX'    RESERVED BITS.                            85750002
MNLCFLG2 DS    X              FLAG BYTE 2.                              85800002
MNLUSERT EQU   B'10000000'    USER SUBCOMMAND TABLE CURRENTLY           85850002
*                             BEING SEARCHED.                           85900002
*              B'0XXXXXXX'    RESERVED BITS.                            85950002
MNLRSVD1 DS    H              RESERVED BYTES.                           86000002
         ORG   TSTMNLWK                                                 86010002
MNLSCPRM DS    CL24           SERVICE ROUTINE PARAMETER LIST.           86050002
MNLCSOA  DS    CL8            IKJSCAN OUTPUT AREA.                      86100002
MNLCSFLG DS    F              IKJSCAN FLAG WORD.                        86150002
MNLNOCHK EQU   B'10000000'    DO NOT SYNTAX CHECK COMMAND NAME.         86200002
*              B'0XXXXXXX'    RESERVED BITS.                            86250002
         ORG   TSTMNLWK                                                 86300002
MNLLINKL DS    CL12           LINK SVC PARAMETER LIST.                  86350002
         ORG   TSTMNLWK                                                 86360002
MNLCLOSE DS    F              CLOSE PARAMETER LIST.                     86400002
         ORG   TSTMNLWK                                                 86450002
MNLSVCPL DS    CL16           PARAMETER LIST FOR SVC 097.               86500002
         ORG   TSTMNLWK                                                 86550002
MNLSRPRM DS    CL16          STACK PARM LIST PART 1                     86560002
MNLSTPB  DS    CL8           STACK PARM LIST PART 2                     86600002
         ORG   TSTMNLWK                                                 86610002
MSAVE234 DS    3F            R2-4 SAVE AREA FOR IO                      86620002
MSAVE14  DS    F             R14 SAVE AREA FOR IO                       86630002
         EJECT                                                          86650002
         IKJTPL                                                         86700002
         EJECT                                                          86750002
         IKJPSCB                                                        86760003
         EJECT                                                          86770003
         IKJTCB                                                         86800002
         EJECT                                                          86850002
         IKJECT                                                         86900002
         EJECT                                                          86950002
         IKJCSOA                                                        87000002
         EJECT                                                          87050002
         IKJCSPL                                                        87100002
         EJECT                                                          87150002
         IKJDAPL                                                        87200002
         EJECT                                                          87250002
         IKJRB                                                          87300002
         EJECT                                                          87350002
         IHACDE                                                         87400002
         EJECT                                                          87450002
         IHAXTLST                                                       87500002
         EJECT                                                          87550002
         CVT   DSECT=YES                                                87600002
         EJECT                                                          87650002
         IKJEGSUB (ASSIGN,,IKJEGPCH),                                  X91750002
               (AT,,IKJEGAT),                                          X91800002
               (CALL,,IKJEGCAL),                                       X91850002
               (COPY,C,IKJEGCPY),                                      X91900002
               (DELETE,DEL,IKJEGDEL),                                  X91950003
               (DROP,,IKJEGDRP),                                       X92000002
               (END,,IKJEGEND),                                        X92050002
               (EQUATE,EQ,IKJEGEQU),                                   X92100002
               (FREEMAIN,FREE,IKJEGFRE),                               X92150002
               (GETMAIN,GET,IKJEGGET),                                 X92200002
               (GO,,IKJEGGO),                                          X92250002
               (HELP,H,IKJEGCIV),                                      X92300002
               (LIST,L,IKJEGLST),                                      X92350002
               (LISTDCB,,IKJEGDCB),                                    X92400002
               (LISTDEB,,IKJEGDEB),                                    X92450002
               (LISTMAP,,IKJEGMAP),                                    X92500002
               (LISTPSW,,IKJEGPSW),                                    X92550002
               (LISTTCB,,IKJEGTCB),                                    X92600002
               (LOAD,,IKJEGLOD),                                       X92650002
               (OFF,,IKJEGOFF),                                        X92700002
               (QUALIFY,Q,IKJEGQFY),                                   X92750002
               (RUN,R,IKJEGRUN),                                       X92800002
               (WHERE,W,IKJEGWHR),                                     X92850002
               CSECT=IBM                                                92900002
         EJECT                                                          92950002
         IKJEGSUB CSECT=USER                                            93000002
         EJECT                                                          93050002
IKJEGMNL CSECT                                                          93100002
         DS    0F            FORCE FULLWORD ALIGNMENT                   93110002
MNLPATCH DC    50C'Z'        PATCH AREA                                 93150002
         END                                                            93200002
