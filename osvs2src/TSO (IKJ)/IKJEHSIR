STAE     TITLE 'IKJEHSIR- STAE INTERFACE/EXIT ROUTINE FOR UTILITIES'    00100020
*                                                                       00150003
*        RELEASE VS2-3.0 SU                                             00160003
*                                                                       00170003
*0000048000-049000,059500-059700                                ZA03681 00180003
*0000064000-064600,120000                                       ZA03681 00192003
*0000123500-123800                                              ZA03681 00196003
*0000415000,498000,675500                                       ZA03681 00198003
*                                                                       00198403
IKJEHSIR CSECT                                                          00200020
         SPACE 1                                                        00300020
         ENTRY IKJEBSIR       ENTRY POINT AND ALIAS                     00400020
         SPACE 1                                                        00500020
*STATUS: CHANGE LEVEL 00                                                00600020
*                                                                       00700020
*FUNCTION/OPERATION:                                                    00800020
*                                                                       00900020
*        THIS IS THE COMMON STAE ROUTINE FOR THE TSO UTILITY            01000020
*        COMMAND PROCESSORS (CP'S).                                     01100020
*               IT RECEIVES CONTROL VIA SYNCH FROM THE                  01200020
*        ABEND STAE INTERFACE ROUTINE (ASIR) WHENEVER A                 01300020
*        CP ABENDS AND THAT CP HAS ISSUED A STAE NAMING                 01400020
*        THIS MODULE (IKJEHSIR) AS ITS STAE EXIT.                       01500020
*                                                                       01600020
*        DETERMINATION IS FIRST MADE TO SEE IF THE CP                   01700020
*        WANTS TO HANDLE THE ABEND.  IF SO, A CHECK IS MADE             01800020
*        TO SEE IF THE CP WANTS IKJEHSIR TO ISSUE A MESSAGE             01900020
*        TO THE USER AT THE TERMINAL.  IF YES, AN ATTEMPT IS            02000020
*        MADE TO GET CORE FOR A WORK AREA SO THAT THE USER              02100020
*        AT THE TERMINAL CAN BE NOTIFIED THAT THE CP HAS                02200020
*        ABENDED.  IF CORE IS GOTTEN, AN INFORMATIONAL                  02300020
*        MESSAGE, CONTAINING THE CP'S NAME AND THE ABEND CODE,          02400020
*        IS PUT OUT TO THE USER AT THE TERMINAL.                        02500020
*                                                                       02600020
*        IF THE CP DOES NOT WANT TO HANDLE THE ABEND, THE               02700020
*        ABEND CODE IS PLACED IN THE ENVIRONMENT CONTROL TABLE          02800020
*        (ECT) (QV) FOR THE TERMINAL MONITOR PROGRAM (TMP).             02900020
*                                                                       03000020
*        IF THE ABEND CODE IS 33E, NO MESSAGE IS ISSUED, FOR THIS       03100020
*        MEANS THE USER HIT THE ATTENTION KEY TO STOP THE               03200020
*        CP'S PROCESSING.                                               03300020
*                                                                       03400020
*        IF THE CP IS GOING TO HANDLE THE ABEND, THE CP'S               03500020
*        RETRY ROUTINE ADDRESS IS RETURNED TO ASIR.  IF THE             03600020
*        ABEND CODE IS 33E, A DIRECT CALL TO THE RETRY ADDRESS          03700020
*        IS MADE AS A RETRY ROUTINE CANNOT BE SCHEDULED                 03800020
*        DURING A DETATCH.                                              03900020
         EJECT                                                          04000020
*ENTRY POINTS:                                                          04100020
*                                                                       04200020
*        IKJEHSIR- ONLY ENTRY POINT, FROM ASIR                          04300020
*        IKJEBSIR- EQUIVALENT TO IKJEHSIR                               04400020
*                                                                       04500020
*INPUT:                                                                 04600020
*                                                                       04700020
*        R0    A CODE 12 IF NO SDWA.                                    04800003
*              A CODE 0,4,8,16 IF SDWA AQUIRED.                         04850003
*                                                                       04860003
*        R1    ADDRESS OF SDWA IF ACQUIRED OR                           04900003
*              ABEND COMP CODE IF NO SDWA.                              05000003
*                                                                       05500020
*        R2    IF R0 = 0, 4 , 8, 16, UNPREDICTABLE                      05600003
*                                                                       05700020
*              IF R0 = 12, ADDRESS OF EXIT PARAMETER LIST               05800020
*                                                                       05900020
*        R14   RETURN ADDRESS                                           05950003
*                                                                       05960003
*        R15   ADDRESS OF STAE EXIT ROUTINE                             05970003
*OUTPUT:                                                                06000020
*        NORMAL (IE, RETRY):                                            06100020
*                  A MESSAGE TO THE USER AT THE TERMINAL                06200020
*              R0  THE ADDRESS OF THE RETRY ROUTINE                     06300020
*              R1  ADDRESS OF SDWA IF ACQUIRED OR                       06400003
*                  ABEND COMPLETION CODE OF NO SDWA                     06450003
*              R14 RETURN ADDRESS                                       06460003
*              R15 A 4 INDICATING RETRY                                 06500020
*                                                                       06600020
*        ABNORMAL (IE, NO RETRY):                                       06700020
*              R15 A 0 INDICATING NO RETRY                              06800020
*                                                                       06900020
*EXTERNAL ROUTINES:                                                     07000020
*                                                                       07100020
*              PUTLINE-  TO PUT A MESSAGE                               07200020
*              GETMAIN-  TO GET WORK AREA                               07300020
*              FREEMAIN- TO FREE WORK AREA                              07400020
         EJECT                                                          07500020
*EXIT:                                                                  07600020
*                                                                       07700020
*        NORMAL:                                                        07800020
*              NORMAL EXIT IS BR R14 TO ASIR                            07900020
*                                                                       08000020
*        ABNORMAL:                                                      08100020
*              ABNORMAL EXIT IS BR R14 TO ASIR                          08200020
*                                                                       08300020
*        NOTE:  ON A 33E ABEND (DETACH), A BALR R14,R15 IS MADE         08400020
*               TO THE CP'S RETRY ROUTINE.                              08500020
*                                                                       08600020
*TABLES/WORKAREAS:                                                      08700020
*                                                                       08800020
*        ECT-      ENVIRONMENT CONTROL TABLE                            08900020
*        STAEWORK- WORK AREA SUPPLIED BY ASIR                           09000020
*        RETRY-    PSEUDO RETRY ADDRESS SUPPLIED BY CP                  09100020
*        PARAM-    LIST OF ABEND CODES AND RETRY ADDRESSES              09200020
*                  SUPPLIED BY CP                                       09300020
*        IKJUWORK- WORK AREA GOTTEN VIA GETMAIN                         09400020
*                                                                       09500020
*ATTRIBUTES:                                                            09600020
*                                                                       09700020
*        REENTRANT, READ-ONLY                                           09800020
*                                                                       09900020
         EJECT                                                          10000020
         YREGS                                                          10100020
*                             LENGTH EQUATES                            10200020
         SPACE 1                                                        10300020
L0       EQU   0              LENGTH OF ZERO                            10400020
L1       EQU   1              LENGTH OF ONE                             10500020
L2       EQU   2              LENGTH OF TWO                             10600020
L3       EQU   3              LENGTH OF THREE                           10700020
L4       EQU   4              LENGTH OF FOUR                            10800020
L5       EQU   5              LENGTH OF FIVE                            10900020
L6       EQU   6              LENGTH OF SIX                             11000020
L8       EQU   8              LENGTH OF EIGHT                           11100020
L12      EQU   12             LENGTH OF TWELVE                          11200020
L20      EQU   20             LENGTH OF TWENTY                          11300020
L256     EQU   256            LENGTH OF TWO FIFTY-SIX                   11400020
         EJECT                                                          11450003
IKJEBSIR LR    R6,R14 SAVE RETURN REG                           ZA03681 12000003
         SPACE 1                                                        12050020
         LR    R12,R15        SET UP                                    12100020
         USING IKJEHSIR,R12   BASE REG                                  12300020
         B     BRARID         BRANCH AROUND ID                  ZA03681 12350003
         DC    C'IKJEHSIR'    MODULE ID                         ZA03681 12360003
         DC    X'5100'        DATE - APRIL 10, 1975             ZA03681 12370003
BRARID   EQU   *                                                ZA03681 12380003
         SPACE 1                                                        12400020
*        SINCE THE RETRY ROUTINE NEEDS THE ASIR ENTRY CODE,             12500020
*        WE HAVE TO SAVE THIS CODE FOR THE RETRY ROUTINE.               12600020
         SPACE 1                                                        12700020
         LR    R3,R0          SAVE ASIR ENTRY CODE                      12800020
         C     R0,F12         IS THERE A WORK AREA                      12900020
         BE    ROUTE2         BR ON NO                                  13000020
         SPACE 1                                                        13100020
         USING STAEWORK,R1    STAE WORK AREA BASE REG                   13200020
         SPACE 1                                                        13300020
*        THE FIRST WORD OF THE ASIR WORK AREA IS THE POINTER            13400020
*        PASSED BY THE CP IN THE PARAM= PARAMETER OF THE STAE           13500020
*        MACRO.  THE SECOND WORD IS THE ABEND CODE AS IT                13600020
*        WOULD APPEAR IN THE TCBCMP FIELD OF THE TCB.                   13700020
         SPACE 1                                                        13800020
         L     R2,STAEEXIT    GET EXIT PARM PTR                         13900020
         L     R7,STAECODE    GET ABEND CODE                            14000020
         SPACE 1                                                        14100020
*        SINCE WE DID HAVE A WORK AREA, WE DON'T WANT TO                14200020
*        CHANGE R7, SO WE BRANCH AROUND THE LOADING OF R7.              14300020
         SPACE 1                                                        14400020
         B     ROUTE2A        BYPASS FOLLOWING                          14500020
         SPACE 1                                                        14600020
         DROP  R1             DROP STAEWORK REG                         14700020
         EJECT                                                          14800020
*        IF THERE IS NO ASIR WORK AREA, R1 COMES IN WITH THE            14900020
*        COMPLETION CODE, WE WILL NEED IT, SO WE SAVE IT.               15000020
         SPACE 1                                                        15100020
ROUTE2   LR    R7,R1          PUT COMP CODE IN R7                       15200020
         SPACE 1                                                        15300020
*        R2 IS POINTING AT THE PARAMETER PASSED BY THE CP.              15400020
*        IT IS SETUP ABOVE, OR IT COMES IN SETUP BY ASIR                15500020
*        WHEN NO WORK AREA IS AVAILABLE, SO SET A BASE REG.             15600020
         SPACE 1                                                        15700020
         USING STAEPARM,R2    PARM BASE REG                             15800020
         SPACE 1                                                        15900020
*        NOW WE SET R4 TO THE PSEUDO RETRY ADDRESS PASSED BY            16000020
*        THE CP, AND SET IT UP AS A DSECT BASE.                         16100020
         SPACE 1                                                        16200020
ROUTE2A  L     R4,RETRYER     GET PSEUDO RETRY ADDR                     16300020
         SPACE 1                                                        16400020
         USING RETRY,R4       RETRY BASE REG                            16500020
         SPACE 1                                                        16600020
*        NOW WE SET R5 TO THE LIST OF ABEND CODES PASSED BY             16700020
*        THE CP, AND SET IT UP AS A DSECT BASE.                         16800020
         SPACE 1                                                        16900020
         L     R5,TBLADDR     GET LIST ADDRESS                          17000020
         SPACE 1                                                        17100020
         USING PARAM,R5       LIST BASE REG                             17200020
         SPACE 1                                                        17300020
*        NOW WE FIND OUT IF THE CP WANTS TO HANDLE ABENDS OR            17400020
*        NOT.  THE FIRST BYTE OF THE STAEPARM IS A FLAG                 17500020
*        TELLING US THIS. THE DEFAULT IS YES.                           17600020
         SPACE 1                                                        17650020
*********************************************************************** 17700020
*        NOTE:  IF A DUMP OF A CP IS WANTED, TURN STAETMP BIT ON.     * 17800020
*               THIS WILL BYPASS STAE PROCESSING BY THE CP AND        * 17900020
*               BY IKJEHSIR.                                          * 18000020
*********************************************************************** 18050020
         EJECT                                                          18051020
*        CHECK FOR PARAMETERS BEING PROPER; IE, FILLED IN, TO AVOID     18052020
*        UNPLESANT ABENDS IN IKJEHSIR ITSELF.                           18053020
         SPACE 1                                                        18054020
         LA    R5,L0(R5)      CLEAR THE TOP BYTE                        18055020
         LTR   R5,R5          ANYTHING THERE                            18056020
         BZ    GOOFUP         NO, LET THE TMP HAVE IT                   18057020
         SPACE 1                                                        18058020
         L     R8,TMPREG1     GET TMP REG ONE                           18059020
         LA    R8,L0(R8)      CLEAR TOP BYTE                            18060020
         LTR   R8,R8          ANYTHING THERE                            18061020
         BZ    GOOFUP         NO, LET TMP HAVE IT                       18062020
         SPACE 1                                                        18063020
         LA    R4,L0(R4)      CLEAR TOP BYTE                            18064020
         LTR   R4,R4          ANYTHING THERE                            18065020
         BZ    GOOFUP         NO, LET TMP HAVE IT                       18066020
         SPACE 1                                                        18067020
         TM    STAEFLAG,STAETMP+STAEUSER  EITHER SET                    18068020
         BZ    GOOFUP         NO, LET TMP HAVE IT                       18069020
         SPACE 1                                                        18100020
         TM    STAEFLAG,STAETMP TMP TO HANDLE ABENDS                    18200020
         BO    LETTMP         BR ON YES                                 18300020
         SPACE 1                                                        18400020
*        WE DON'T NEED THE POINTER TO THE STAEPARM ANY MORE.            18500020
         SPACE 1                                                        18600020
         DROP  R2             STAEPARM BASE REG                         18700020
         EJECT                                                          18800020
*        NOW THAT WE KNOW THE CP WANTS TO HANDLE SOME ABENDS,           18900020
*        LET'S FIND OUT WHAT KIND OF ABEND CODE IT WAS; IE,             19000020
*        SYSTEM OR USER.                                                19100020
         SPACE 1                                                        19200020
*        FIRST WE COPY THE CODE SO WE CAN PLAY WITH IT.                 19300020
         SPACE 1                                                        19400020
         LA    R8,L0(R7)      COPY ABEND CODE, AND CLEAR TOP BYTE       19500020
         SPACE 1                                                        19800020
*        NOW WE MOVE THE USER PORTION TO R9.                            19900020
         SPACE 1                                                        20000020
         SRDL  R8,L12         USER PORTION TO R9                        20100020
         SPACE 1                                                        20200020
*        THE FIRST THING WE CHECK FOR IS A SYSTEM ABEND,                20300020
*        IF THERE IS ONE, IT OVERRIDES ANY USER ABEND.                  20400020
         SPACE 1                                                        20500020
         LTR   R8,R8          SYSTEM ABEND CODE                         20600020
         BNZ   SYSTEM         BR ON YES                                 20700020
         SPACE 1                                                        20800020
*        IF NOT A SYSTEM ABEND CODE, CHECK FOR A USER ABEND             20900020
*        CODE.  IF IT IS A USER ABEND CODE OF ZERO, IT WILL             21000020
*        BE DISALLOWED AND TREATED AS IF THE CP SAID TO LET             21100020
*        THE TMP HANDLE IT.                                             21200020
         SPACE 1                                                        21300020
         SRL   R9,L20         INTO LAST 3 NIBBLES                       21400020
         LTR   R9,R9          USER ABEND CODE                           21500020
         BZ    GOOFUP         BR ON NO                                  21600020
         EJECT                                                          21700020
*        NOW WE FIND OUT IF THE CP WANTS TO HANDLE USER ABENDS.         21800020
*        IF WE FIND HE WANTS TO HANDLE IT, WE GO AND SET UP             21900020
*        FOR HIS RETRY ROUTINE, OTHERWISE, WE GIVE THE ABEND            22000020
*        TO THE TMP.                                                    22100020
         SPACE 1                                                        22200020
USER     TM    PARMFLAG,FLAGUSER IS THIS A USER ENTRY                   22300020
         BZ    USER01            BR ON NO                               22400020
         SPACE 1                                                        22500020
*        NOW WE FIND OUT IF IT IS A LIST OF CODES OR ONLY ONE           22600020
         SPACE 1                                                        22700020
         TM    PARMFLAG,FLAGONE ONE CODE ENTRY                          22800020
         BZ    USER02           BR ON NO                                22900020
         SPACE 1                                                        22950020
*        ITS A ONE CODE ENTRY; THEREFORE, THE CODE IS IN THE            22960020
*        SECOND HALFWORD OF THE STAEPARM CONTROL BLOCK.  SEE            22970020
*        IF IT MATCHES THE ABEND CODE WE HAVE IN R9.                    22980020
         SPACE 1                                                        22990020
         CH    R9,PARMCODE    IS THIS THE CODE                          23000020
         BNE   USER01         BR ON NO                                  23100020
         SPACE 1                                                        23200020
*        THE CP WANTS TO HANDLE THIS USER ABEND, SO GET HIS             23300020
*        RETRY ROUTINE ADDRESS FROM THE LIST.                           23400020
         SPACE 1                                                        24000020
         B     CLEARR2        SET UP FOR RETRY ROUTINE                  24100020
         EJECT                                                          24200020
*        THIS ENTRY WASN'T THE ONE WE WERE LOOKING FOR, SO              24300020
*        SET UP FOR THE NEXT, BUT FIRST SEE IF THE END OF               24400020
*        THE LIST HAS BEEN REACHED.                                     24500020
         SPACE 1                                                        24600020
USER01   TM    PARMFLAG,FLAGEND+FLAGUSER IS IT END OF LIST              24700020
         BO    LETTMP                    YES, LET TMP HANDLE IT         24800020
         SPACE 1                                                        24900020
         LA    R5,PARMLNTH(R5) POINT AT NEXT ENTRY                      25000020
         B     USER            EXAMINE IT                               25100020
         SPACE 1                                                        25200020
*        IT WAS NOT FOR ONE CODE, SEE IF IT IS FOR A LIST.              25300020
         SPACE 1                                                        25400020
USER02   TM    PARMFLAG,FLAGMUL LIST POINTER                            25500020
         BZ    USER03           BR ON NO                                25600020
         SPACE 1                                                        25700020
*        POINT AT THE LIST OF CODES SO WE CAN CHECK THEM                25800020
         SPACE 1                                                        25900020
         L     R11,PARMADDR   LIST POINTER                              26000020
         SPACE 1                                                        26100020
         USING PARMLIST,R11   LIST BASE REG                             26200020
         SPACE 1                                                        26300020
*        CLEAR THE REG WE WILL USE TO COUNT ENTRIES IN CODE LIST        26400020
         SPACE 1                                                        26500020
         XR    R2,R2          CLEAR REG 2                               26600020
         L     R15,EFFS2      F'S FOR CLEARING                          26650020
         SPACE 1                                                        26700020
*        LOOK AT EACH ENTRY IN THE LIST, AND SEE IF IT                  26800020
*        MATCHES THE ABEND CODE WE HAVE IN R9                           26900020
         SPACE 1                                                        27000020
USER02A  LH    R14,CODES      GET AN ENTRY                              27100020
         NR    R14,R15        CLEAR TOP OF REG                          27300020
         CR    R9,R14         IS THIS THE RIGHT CODE                    27400020
         BNE   USER02B        BR ON NO                                  27500020
         SPACE 1                                                        27600020
*        HAVE THE RIGHT CODE, SO GET THE RETRY ROUTINE ADDRESS          27700020
         SPACE 1                                                        27800020
         B     GETRETRY       SET UP FOR RETRY ROUTINE                  28000020
         EJECT                                                          28100020
*        THIS WASN'T THE RIGHT CODE, CHECK FOR THE END OF LIST          28200020
         SPACE 1                                                        28300020
USER02B  TM    CODES,CODESEND END OF LIST                               28400020
         BO    USER01         YES, CHECK NEXT ENTRY                     28500020
         SPACE 1                                                        28600020
         LA    R11,CODELNTH(R11) POINT AT NEXT CODE                     28700020
         SPACE 1                                                        28800020
*        UP THE COUNT OF CODES IN THE LIST BY FOUR.                     28900020
         SPACE 1                                                        29000020
         LA    R2,L4(R2)      UP COUNT BY ONE * FOUR                    29100020
         B     USER02A        CHECK IT                                  29200020
         SPACE 1                                                        29300020
*        THE ENTRY IS NOT FOR ONE OR A LIST, SEE IF IT IS               29400020
*        FOR ALL OTHER TYPES OF USER ABENDS                             29500020
         SPACE 1                                                        29600020
USER03   TM    PARMFLAG,FLAGALL IS IT FOR OTHERS                        29700020
         BZ    USER01           BR ON NO                                29800020
         SPACE 1                                                        29900020
*        GET THE ADDRESS THAT WILL HANDLE ALL OTHER ABENDS              30000020
         SPACE 1                                                        30100020
         B     CLEARR2        SET UP FOR RETRY ROUTINE                  30400020
         EJECT                                                          30500020
*        THIS SECTION EXAMINES THE PARAMETER LIST FOR SYSTEM            30600020
*        ABENDS THE CP WANTS TO HANDLE.  IF WE FIND THE CP              30700020
*        WANTS TO HANDLE IT, WE SET UP FOR RETRY, OTHERWISE             30800020
*        WE GIVE THE ABEND TO THE TMP.                                  30900020
         SPACE 1                                                        31000020
SYSTEM   TM    PARMFLAG,FLAGUSER USER ABEND ENTRY                       31100020
         BO    SYSTEM1A          BR ON YES                              31200020
         SPACE 1                                                        31300020
*        NOW FIND OUT IF IT IS A SINGLE ENTRY OR A LIST                 31400020
         SPACE 1                                                        31500020
         TM    PARMFLAG,FLAGONE ONE CODE ENTRY                          31600020
         BZ    SYSTEM02         BR ON NO                                31700020
         CH    R8,PARMCODE      RIGHT CODE                              31800020
         BNE   SYSTEM01         BR ON NO                                31900020
         SPACE 1                                                        32000020
*        THE CP WANTS TO HANDLE THIS SYTEM ABEND CODE, SO               32100020
*        GET HIS RETRY ROUTINE ADDRESS                                  32200020
         SPACE 1                                                        32300020
         B     CLEARR2        SETUP FOR RETRY ROUTINE                   32600020
         SPACE 1                                                        32700020
*        THIS ENTRY WASN'T FOR THIS CODE, SO SET UP FOR                 32800020
*        NEXT ENTRY AFTER CHECKING FOR END OF THE LIST                  32900020
         SPACE 1                                                        33000020
SYSTEM01 TM    PARMFLAG,FLAGEND END OF LIST                             33100020
         BO    LETTMP           LET TMP HANDLE IT                       33200020
         SPACE 1                                                        33300020
*        WE CAME HERE IF A USER CODE WAS FOUND BY 'SYSTEM';             33400020
*        SINCE THERE IS NO SYSTEM FLAG, WE CANNOT CHECK FOR             33500020
*        ONE AT SYSTEM01.                                               33600020
         SPACE 1                                                        33700020
SYSTEM1A LA    R5,PARMLNTH(R5) POINT AT NEXT ENTRY                      33800020
         B     SYSTEM          CHECK NEXT ENTRY                         33900020
         SPACE 1                                                        34000020
*        ENTRY WAS NOT FOR ONE CODE, SEE IF IT IS A LIST                34100020
         SPACE 1                                                        34200020
SYSTEM02 TM    PARMFLAG,FLAGMUL LIST ENTRY                              34300020
         BZ    SYSTEM03         BR ON NO                                34400020
         SPACE 1                                                        34500020
*        CLEAR THE REG WE WILL USE FOR COUNT OF CODES                   34600020
         SPACE 1                                                        34700020
         XR    R2,R2          CLEAR REG 2                               34800020
         EJECT                                                          34900020
*        POINT AT THE LIST OF CODES SO WE CAN EXAMINE THEM              35000020
*        THE USING FOR THE BASE REG IS SET IN 'USER'                    35100020
         SPACE 1                                                        35200020
         L     R11,PARMADDR   LIST POINTER                              35300020
         L     R15,EFFS2      F'S FOR CLEARING                          35350020
         SPACE 1                                                        35400020
*        LOOK AT EACH ENTRY IN THE CODE LIST AND SEE IF IT              35500020
*        MATCHES THE SYSTEM CODE WE HAVE IN R8                          35600020
         SPACE 1                                                        35700020
SYSTEM2A LH    R14,CODES      GET CODE ENTRY                            35800020
         NR    R14,R15        CLEAR TOP OF REG                          36000020
         CR    R8,R14         IS THIS THE CODE                          36100020
         BNE   SYSTEM2B       BR ON NO                                  36200020
         SPACE 1                                                        36300020
*        WE HAVE THE RIGHT CODE, SO NOW GET THE RETRY ADDRESS           36400020
         SPACE 1                                                        36500020
         B     GETRETRY       SET UP FOR RETRY ROUTINE                  36700020
         SPACE 1                                                        36800020
*        THIS WASN'T THE CODE WE HAVE, CHECK FOR END OF LIST            36900020
         SPACE 1                                                        37000020
SYSTEM2B TM    CODES,CODESEND    END OF LIST                            37100020
         BO    SYSTEM01          BR ON YES                              37200020
         LA    R11,CODELNTH(R11) POINT AT NEXT CODE                     37300020
         SPACE 1                                                        37400020
*        UP THE COUNT OF CODES IN THE LIST BY FOUR.                     37500020
         SPACE 1                                                        37600020
         LA    R2,L4(R2)      UP COUNT BY ONE * FOUR                    37700020
         B     SYSTEM2A       CHECK THIS ONE                            37800020
         SPACE 1                                                        37900020
*        ENTRY IS NOT FOR ONE CODE OR A LIST OF CODES,                  38000020
*        SEE IF IT IS FOR ALL OTHER SYSTEM ABEND CODES.                 38100020
         SPACE 1                                                        38150020
SYSTEM03 TM    PARMFLAG,FLAGALL IS IT FOR ALL OTHERS                    38200020
         BZ    SYSTEM01         BR ON NO                                38250020
         SPACE 1                                                        38300020
         B     CLEARR2        SET UP FOR RETRY ROUTINE                  38350020
         SPACE 1                                                        38400020
*        WE DON'T NEED THIS REGISTER ANYMORE, SO DROP IT.               38450020
         SPACE 1                                                        38500020
         DROP  R11            PARM ADDR BASE REG                        38550020
         EJECT                                                          38600020
*        IF THE CP DOES NOT WANT TO HANDLE THE ABEND, EITHER THRU       38650020
*        THE STAETMP BIT OF THE STAEPARM CONTROL BLOCK BEING ON,        38700020
*        BY NOT HAVING A FLAGALL ENTRY, OR BY NOT HAVING THE CODE       38750020
*        IN HIS LIST OF CODES, WE WILL LET THE TMP HANDLE IT.           38800020
         SPACE 1                                                        40100020
LETTMP   L     R1,TMPREG1     POINTER TO TMP PARMS                      40200020
         SPACE 1                                                        40300020
         USING TMPPARM,R1     PARM BASE REG                             40400020
         SPACE 1                                                        40500020
         L     R11,TMPECT     POINTER TO ECT                            40600020
         SPACE 1                                                        40700020
         USING ECT,R11        ECT BASE REG                              40800020
         SPACE 1                                                        40900020
         ST    R7,ECTRCDF     STORE ABEND CODE                          41000020
         SPACE 1                                                        41100020
*        WE HAVE DONE WHAT WAS ASKED OF US; IE, NOTHING,                41200020
*        SO NOW WE GO BACK TO ASIR INDICATING NO RETRY.                 41300020
*                                                                       41310020
         SPACE 1                                                        41400020
LETTMP01 LR    R14,R6         RESTORE RETURN REG                ZA03681 41500003
         SPACE 1                                                        41600020
*        NO RETRY IS INDICATED BY A RETURN CODE OF 0 IN R15.            41700020
         SPACE 1                                                        41800020
         XR    R15,R15        RETURN CODE OF ZERO                       41900020
         BR    R14            RETURN TO ASIR                            42000020
         SPACE 1                                                        42100020
*        IF WE GET A USER ABEND CODE OF ZERO, WE TREAT IT AS IF THERE   42200020
*        WERE NO RETRY ROUTINE; IE, WE LET THE TMP HANDLE IT.           42300020
         SPACE 1                                                        42500020
GOOFUP   EQU   LETTMP         LET TMP HAVE IT                           42600020
         SPACE 1                                                        42700020
*        WE DON'T NEED THE REGS ANYMORE, SO DROP THEM                   42800020
         SPACE 1                                                        42900020
         DROP  R1             TMP PARM BASE REG                         43000020
         DROP  R11            ECT BASE REG                              43100020
         EJECT                                                          43200020
*        THE CP DID NOT HAVE A LIST, SO CLEAR REG 2                     43250020
         SPACE 1                                                        43260020
CLEARR2  XR    R2,R2          CLEAR LIST NUMBER                         43270020
         SPACE 1                                                        43280020
*        THE CP WANTS TO HANDLE THE ABEND, GET HIS RETRY                43290020
*        ROUTINE ADDRESS FROM THE LIST.                                 43292020
         SPACE 1                                                        43294020
GETRETRY L     R10,PARMRTRY   GET RETRY ROUTINE ADDRESS                 43296020
         SPACE 1                                                        43298020
*        WE KNOW THAT THE CP WANTS TO HANDLE THE ABEND, SO              43300020
*        STORE THE THINGS THAT WE HAVE TO GIVE HIM, THEN                43400020
*        CHECK IF IT WAS A 33E ABEND.                                   43500020
         SPACE 1                                                        43600020
CHECK33E ST    R10,RETRYR15   RETRY ROUTINE BASE ADDRESS                43700020
         SPACE 1                                                        43800020
         ST    R2,RETRYR2     STORE BRANCH ENTRY CODE                   44000020
         ST    R3,RETRYR0     STORE STAE ENTRY CODE                     44100020
         SPACE 1                                                        44200020
*        CHECK IF IT IS A SYSTEM OR USER ABEND CODE, WE WANT            44300020
*        TO GIVE IT TO THE CP RIGHT JUSTIFIED                           44400020
         SPACE 1                                                        44500020
         LTR   R8,R8          SYSTEM ABEND                              44600020
         BZ    CHK33E01       BR ON NO                                  44700020
         ST    R8,RETRYR1     STORE SYSTEM CODE                         44800020
         SPACE 1                                                        44900020
*        CHECK TO SEE IF IT WAS A 33E ABEND. IF IT WAS, WE              45000020
*        HAVE TO GO DIRECTLY TO THE RETRY ROUTINE AS WE                 45100020
*        CANNOT SCHEDULE A RETRY ROUTINE DURING DETACH.                 45200020
         SPACE 1                                                        45300020
         C     R8,SYS33E      33E ABEND                                 45400020
         BNE   CHK33E02       BR ON NO, PUT OUT MESSAGE                 45500020
         SPACE 1                                                        45600020
*        THE USER MUST SPECIFICALLY ASK TO HANDLE A 33E ABEND,          45700020
*        SO CHECK TO SEE IF HE DID OR IF WE CAME HERE FROM              45800020
*        A FLAGALL ENTRY.                                               45900020
         SPACE 1                                                        46000020
         TM    PARMFLAG,FLAGALL IS IT FLAGALL ENTRY                     46100020
         BO    LETTMP           YES, GIVE TO TMP                        46200020
         EJECT                                                          46300020
*        TO ENABLE US TO FIND OUR WAY BACK TO ASIR, SET UP STANDARD     46400020
*        LINKAGE CONVENTIONS FOR THE 33E RETRY ROUTINE IN A GETMAINED   46500020
*        AREA IN SUBPOOL 1.                                             46600020
         SPACE 1                                                        46800020
         GETMAIN  R,LV=L2GET*L2,SP=L1   GET SOME CORE                   46900020
         SPACE 1                                                        47000020
*        SET UP A DOUBLE CHAIN OF SAVEAREAS SO THAT IKJEHSIR'S REGS     47100020
*        CAN BE RECOVERED WHEN THE 33E RETRY ROUTINE RETURNS TO         47150020
*        IKJEHSIR.  THIS IS REQUIRED SINCE, WHEN THE RETRY ROUTINE      47160020
*        SAVES REGISTERS AT R13+12, IT IS SAVING ITS OWN REGISTERS      47170020
*        AS THEY WERE STORED BY THE PSEUDO MACRO.                       47180020
         SPACE 1                                                        47200020
         STM   R14,R12,L12(R1)   SAVE MY REGS                           47400003
         SPACE 1                                                        47560020
*        NOW WE SET UP THE SECOND SAVE AREA AT +72                      47570020
         SPACE 1                                                        47580020
         LA    R13,L2GET(R1)  POINT AT SAVE TWO                         47590020
         ST    R1,L4(R13)     BACK CHAIN TO SAVE ONE                    47592020
         ST    R13,L8(R1)     FOWARD CHAIN FROM SAVE ONE                47594020
         ST    R13,RETRYR13   POINTER FOR RETRY ROUTINE                 47596020
         SPACE 1                                                        47600020
*        SET UP A POINTER BACK TO US FOR RETRY ROUTINE                  47700020
         SPACE 1                                                        47800020
         LA    R14,COMEBACK   RETURN POINT                              47900020
         ST    R14,RETRYR14   STORE IT                                  48000020
         SPACE 1                                                        48100020
*        GET THE ADDRESS OF THE RETRY PSEUDO ROUTINE AND BALR TO IT.    48200020
         SPACE 1                                                        48300020
         LA    R15,RETRIER    ROUTINE ADDRESS                           48400020
         BALR  R14,R15        GO TO HIM                                 48500020
         SPACE 1                                                        48550020
*        NOW RESTORE MY REGISTERS THAT WERE SAVED UP ABOVE.             48560020
         SPACE 1                                                        48570020
COMEBACK L     R13,L4(R13)    RESTORE R13                               48580020
         LM    R14,R12,L12(R13) RESTORE THE REST OF THEM                48590020
         EJECT                                                          48600020
*        WE TREAT A RETURN FROM A 33E RETRY ROUTINE AS IF NO RETRY      48700020
*        ROUTINE WERE TO BE SCHEDULED, SINCE WE CANNOT SCHEDULE ONE     48800020
*        ON A 33E ABEND ANYWAY.                                         48900020
         SPACE 1                                                        49000020
*        BEFORE WE RETURN, WE MUST FREE THE CORE WE GOT.                49100020
         SPACE 1                                                        49200020
         LR    R1,R13         AREA TO FREE                              49300020
         SPACE 1                                                        49500020
         FREEMAIN  R,LV=L2GET*L2,A=(R1),SP=L1  FREE IT                  49600020
         SPACE 1                                                        49700020
         LR    R14,R6        RESTORE RETURN REG                 ZA03681 49800003
         SPACE 1                                                        49850020
*        NO RETRY IS INDICATED BY A RETURN CODE OF 0 IN R15.            49860020
         SPACE 1                                                        49870020
         XR    R15,R15        RETURN CODE ZERO                          49900020
         BR    R14            RETURN TO ASIR                            50000020
         EJECT                                                          50100020
*        IF IT IS NOT A SYSTEM ABEND, ALL WE HAVE TO DO IS              50200020
*        STORE THE USER ABEND FOR THE CP'S RETRY ROUTINE                50300020
         SPACE 1                                                        50400020
CHK33E01 ST    R9,RETRYR1     STORE ABEND CODE                          50500020
         SPACE 1                                                        50600020
*        CHECK TO SEE IF THE CP WANTS TO PUT OUT HIS OWN MESSAGE.       50700020
         SPACE 1                                                        50800020
CHK33E02 TM    PARMFLAG,FLAGNMSG NO MESSAGE                             50900020
         BO    NOCORE            BR ON YES                              51000020
         SPACE 1                                                        51100020
*        THIS SECTION SETS UP THE IKJUWORK DSECT FOR PUTLINE.           51200020
*        FIRST WE DO A GETMAIN FOR REQUIRED AMOUNT OF CORE              51300020
*        IN SUBPOOL 1.                                                  51350020
         SPACE 1                                                        51400020
GETCORE  GETMAIN  R,LV=LCORE,SP=L1 GET CORE FOR PUTLINE                 51500020
         SPACE 1                                                        51600020
*        WE DON'T NEED THE POINTER TO PARM ANY MORE, GO.                51700020
         SPACE 1                                                        51800020
         DROP  R5             PARM BASE REG                             51900020
         EJECT                                                          52000020
*        THIS SECTION SETS UP THE PARAMETER LISTS AND                   52100020
*        MESSAGE FOR PUTLINE SERVICE ROUTINE.                           52200020
         SPACE 1                                                        52300020
*        UPON ENTRY:                                                    52350020
*              R1  GOTTEN CORE                                          52400020
*              R4  RETRY DSECT                                          52500020
*              R8  SYSTEM CODE                                          52600020
*              R9  USER CODE                                            52700020
*              R10 RETRY ADDRESS                                        52800020
         SPACE 1                                                        52900020
*        THE FIRST THING WE HAVE TO DO IS ESTABLISH THE                 53000020
*        STANDARD LINKAGE CONVENTIONS FOR PUTLINE.                      53100020
         SPACE 1                                                        53200020
         LR    R13,R1         POINT AT NEW SAVEAREA                     53500020
         SPACE 1                                                        53600020
         USING IKJUWORK,R13   SET UP DSECT BASE                         53700020
         SPACE 1                                                        53800020
*        CLEAR THE DSECT OUT SO THINGS WITH ZEROS WILL BE THERE.        53900020
         SPACE 1                                                        54000020
         XC    PUTLPARM(L2XC),PUTLPARM CLEAR CORE                       54100020
         SPACE 1                                                        54200020
*        SET UP A REGISTER POINTING TO THE PARMETERS PASSED             54300020
*        TO THE CP BY THE TMP SO WE CAN GET THINGS FOR THE              54400020
*        PUTLINE SERVICE ROUTINE.                                       54500020
         SPACE 1                                                        54600020
         L     R1,TMPREG1     TMP PARM REG                              54700020
         SPACE 1                                                        54800020
         USING TMPPARM,R1     TMP PARM BASE REG                         54900020
         SPACE 1                                                        55000020
         L     R11,TMPUPT     POINTER TO THE USER                       55100020
         ST    R11,PUTLUPT    . PROFILE TABLE                           55200020
         L     R11,TMPECT     POINTER TO THE ENVIRONMENT                55300020
         ST    R11,PUTLECT    . CONTROL TABLE                           55400020
         SPACE 1                                                        55500020
         DROP  R1             TMP PARM BASE REG                         55600020
         SPACE 1                                                        55700020
*        WE WILL BE MODIFYING THE ECT, SO SET UP A BASE FOR IT          55800020
         SPACE 1                                                        55900020
         USING ECT,R11        ECT BASE REG                              56000020
         EJECT                                                          56100020
*        SET UP THE ECB POINTER FOR THE PUTLINE SERVICE ROUTINE         56200020
         SPACE 1                                                        56300020
         LA    R7,CPECB       POINTER TO THE ECB                        56400020
         ST    R7,PUTLECB     .FOR PUTLINE                              56500020
         SPACE 1                                                        56600020
*        SET UP THE MESSAGE DESCRIPTOR FOR PUTLINE                      56700020
         SPACE 1                                                        56800020
         LA    R1,PUTLINE     PARM BLOCK POINTER                        56900020
         ST    R1,PUTLPTR     .STORE IN LIST                            57000020
         LA    R1,L4          NUMBER OF SEGMENTS                        57100020
         ST    R1,PUTLPTRS    .STORE IN LIST                            57200020
         SPACE 1                                                        57300020
*        NOW WE SET UP THE MESSAGE INSERTS                              57400020
         SPACE 1                                                        57500020
         LA    R1,MSG         MAIN MESSAGE                              57600020
         ST    R1,PUTLMAIN    .POINTER                                  57700020
         LA    R1,INSERT1     INSERT ONE                                57800020
         ST    R1,PUTLI1      .POINTER                                  57900020
         LA    R1,INSERT2     INSERT TWO                                58000020
         ST    R1,PUTLI2      .POINTER                                  58100020
         LA    R1,INSERT3     INSERT THREE                              58200020
         ST    R1,PUTLI3      .POINTER                                  58300020
         SPACE 1                                                        58400020
*        NOW WE MOVE THE MESSAGES INTO THE DSECT                        58500020
         SPACE 1                                                        58600020
         LA    R1,MSG         MAIN MESSAGE IN DSECT                     58700020
         LA    R2,MSGID       MAIN MESSAGE IN PROGRAM                   58800020
         LH    R3,MSGID       LENGTH OF MESSAGE                         58900020
         BAL   R14,MOVEMSG    MOVE THE MESSAGE                          59000020
         SPACE 1                                                        59100020
         LA    R1,INSERT1     INSERT 1 AREA                             59200020
         LA    R2,PNAME       PGM NAME INSERT                           59300020
         LH    R3,PNAME       LENGTH OF INSERT                          59400020
         BAL   R14,MOVEMSG    MOVE IT                                   59500020
         EJECT                                                          59600020
*        NOW WE HAVE TO FIND OUT IF IT WAS A SYSTEM OR USER ABEND       59700020
         SPACE 1                                                        59800020
         LA    R1,INSERT2     AREA IN DSECT                             59900020
         SPACE 1                                                        60000020
*        R8 HAS THE SYSTEM CODE IN IT, IF NONE IS USER                  60100020
         SPACE 1                                                        60200020
         LTR   R8,R8          SYSTEM CODE                               60300020
         BZ    INSERTS2       BR ON NO, USER                            60400020
         LA    R2,SYSCODE     SYSTEM CODE INSERT                        60500020
         LH    R3,SYSCODE     LENGTH OF INSERT                          60600020
         BAL   R14,MOVEMSG    MOVE INSERT                               60700020
         SPACE 1                                                        60800020
         ST    R8,DWORK1      STORE FOR TRANSLATE                       60900020
         B     INSERTS3       MOVE CODE INSERT                          61000020
         SPACE 1                                                        61100020
INSERTS2 LA    R2,USRCODE     USER CODE INSERT                          61200020
         LH    R3,USRCODE     LENGTH OF INSERT                          61300020
         BAL   R14,MOVEMSG    MOVE IT                                   61400020
         SPACE 1                                                        61500020
         ST    R9,DWORK1      STORE FOR TRANSLATE                       61600020
         SPACE 1                                                        61700020
INSERTS3 LA    R1,INSERT3     ADDRESS IN WORKAREA                       61800020
         LA    R2,ABCODE      ABEND CODE INSERT                         61900020
         LH    R3,ABCODE      LENGTH OF INSERT                          62000020
         BAL   R14,MOVEMSG    MOVE IT                                   62100020
         SPACE 1                                                        62200020
*        THIS TRANSLATES THE CODE AT DWORK1 TO PRINTABLE HEX            62300020
         SPACE 1                                                        62400020
INSERTS5 UNPK  DWORK(L5),DWORK1+L2(L3) UNPACK CODE                      62500020
         TR    DWORK(L5),TRANSTBL      TRANSLATE IT                     62600020
         MVC   INSERTC(L3),DWORK+L1    MOVE TO INSERT                   62700020
         SPACE 1                                                        62800020
*        NOW WE MOVE THE NAME OF THE ABENDING CP FROM ECT               62900020
         SPACE 1                                                        63000020
         MVC   INSERTP(L8),ECTPCMD PROGRAM NAME                         63100020
         SPACE 1                                                        63200020
*        IN THE CASE THAT THE CP'S RETRY ROUTINE ABENDS, THE            63300020
*        TMP HAS TO BE ABLE TO LET THE TERMINAL USER KNOW THAT          63400020
*        THERE WERE TWO ABENDS, THIS IS DONE BY ZEROING OUT             63500020
*        THE ECT CODE IN A STAE EXIT ROUTINE.  WE WILL DO               63600020
*        THAT NOW                                                       63700020
         SPACE 1                                                        63800020
         XR    R1,R1          ZERO R1                                   63900020
         ST    R1,ECTRCDF     ZERO ECT RETURN CODE                      64000020
         EJECT                                                          64100020
*        THIS IS THE ACTUAL PUTLINE TO THE USER                         64200020
         SPACE 1                                                        64300020
PUTIT    PUTLINE  PARM=PUTLINE,                                        X64400020
               OUTPUT=(PUTLPTRS,TERM,SINGLE,INFOR),                    X64500020
               TERMPUT=(EDIT,WAIT,NOHOLD,BREAKIN),                     X64600020
               MF=(E,PUTLPARM)  PUT MESSAGE                             64700020
         SPACE 1                                                        64800020
*        BEFORE WE GO BACK TO ASIR, WE HAVE TO CLEAN UP THE             64900020
*        THINGS THAT WE HAVE DONE. WE                                   65000003
*        HAVE TO FREE THE CORE WE GOT FOR PUTLINE PROCESSING.           65200020
         SPACE 1                                                        65300020
         LR    R1,R13         AREA TO FREE                              65400020
         SPACE 1                                                        65600020
*        NOW WE FREE THE CORE WE GOT BEFORE                             65700020
         SPACE 1                                                        65800020
         FREEMAIN  R,LV=LCORE,SP=L1,A=(R1)  FREE IT                     65900020
         SPACE 1                                                        66000020
*        SINCE WE HAVE FREED THE CORE, DROP THE BASE REG                66100020
         SPACE 1                                                        66200020
         DROP  R13            IKJUWORK BASE REG                         66300020
         EJECT                                                          66400020
*        THIS IS WHERE WE FINALLY SET UP TO TELL ASIR THAT              66500020
*        THE CP HAS A RETRY ROUTINE THAT HE SHOULD SCHEDULE.            66600020
*        WE DO THIS BY SETTING R15 TO 4, R0 TO THE PSEUDO               66700020
*        RETRY ADDRESS.                                                 66800003
         SPACE 1                                                        67000020
NOCORE   LA    R0,RETRIER     CP'S RETRY ROUTINE                        67100020
         LA    R15,L4         INDICATE RETRY                            67200020
         SPACE 1                                                        67400020
         LR    R14,R6                RESTORE RETURN REG         ZA03681 67550003
         BR    R14                   RETURN TO ASIR                     67600020
         SPACE 1                                                        67700020
*        FREE THE OTHER REG, WE'RE DONE WITH IT                         67800020
         SPACE 1                                                        67900020
         DROP  R4             RETRY BASE REG                            68000020
         EJECT                                                          68100020
*        THIS ROUTINE MOVES THE MESSAGE FROM THIS PROGRAM TO            68200020
*        THE GETMAINED AREA IN SUBPOOL 1.                               68300020
         SPACE 1                                                        68400020
*        UPON ENTRY                                                     68500020
*              R1 POINTS AT DSECT AREA                                  68600020
*              R2 POINTS AT MESSAGE TO MOVE                             68700020
*              R3 HAS LENGTH IN IT                                      68800020
         SPACE 1                                                        68900020
MOVEMSG  BCTR  R3,L0          -1 FOR EXECUTED MOVE                      69000020
         EX    R3,MOVEMSG1    MOVE THE MESSAGE                          69100020
         BR    R14            RETURN TO CALLER                          69200020
         SPACE 1                                                        69300020
*        THIS INSTRUCTION MOVES THE INSERTS                             69400020
         SPACE 1                                                        69500020
MOVEMSG1 MVC   L0(L0,R1),L0(R2) MOVE THE MESSAGE                        69600020
         EJECT                                                          69700020
F12      DC    F'12'          FOR 104 BYTE COMPARE                      69800020
         SPACE 1                                                        69900020
*        THE FOLLOWING DC'S MUST FOLLOW A FULLWORD ALIGNING DC          70000020
         SPACE 1                                                        70100020
EFFS2    DC    X'00000FFF'    FOR ANDING LIST CODE                      70300020
SYS33E   DC    X'0000033E'    SYSTEM 33E ABEND                          70400020
         SPACE 1                                                        70500020
MSGID    DC    AL2(LMSGID)    TOTAL LENGTH OF MESSAGE                   70600020
         DC    H'0'           OFFSET FOR INSERTION                      70700020
         DC    C'IKJ52675I '  MESSAGE ID                                70800020
         DC    C' ABENDED, '  1ST PART                                  70900020
         DC    C' COMPLETION CODE' 2ND PART                             71000020
         SPACE 1                                                        71100020
LMSGID   EQU   *-MSGID        LENGTH OF MESSAGE                         71200020
         SPACE 1                                                        71300020
         DS    0H             ENSURE HALFWORD ALIGNMENT                 71400020
PNAME    DC    AL2(LPNAME)    LENGTH OF INSERT                          71500020
         DC    H'10'          OFFSET FOR INSERT                         71600020
         DC    CL8' '         PROGRAM NAME                              71700020
         SPACE 1                                                        71800020
LPNAME   EQU   *-PNAME        LENGTH OF INSERT                          71900020
         SPACE 1                                                        72000020
         DS    0H             ENSURE HALFWORD ALIGNMENT                 72100020
SYSCODE  DC    AL2(LSYSCODE)  LENGTH OF INSERT                          72200020
         DC    H'20'          OFFSET FOR INSERTION                      72300020
         DC    C'SYSTEM'      TYPE OF ABEND                             72400020
         SPACE 1                                                        72500020
LSYSCODE EQU   *-SYSCODE      LENGTH OF INSERT                          72600020
         SPACE 1                                                        72700020
         DS    0H             ENSURE HALFWORD ALIGNMENT                 72800020
USRCODE  DC    AL2(LUSRCODE)  LENGTH OF INSERT                          72900020
         DC    H'20'          OFFSET FOR INSERT                         73000020
         DC    C'USER'        TYPE OF ABEND                             73100020
         SPACE 1                                                        73200020
LUSRCODE EQU   *-USRCODE      LENGTH OF INSERT                          73300020
         SPACE 1                                                        73400020
         DS    0H             ENSURE HALFWORD ALIGNMENT                 73500020
ABCODE   DC    AL2(LABCODE)   LENGTH OF INSERT                          73600020
         DC    H'36'          OFFSET FOR INSERT                         73700020
         DC    CL4' '         ACTUAL CODE                               73800020
         SPACE 1                                                        73900020
LABCODE  EQU   *-ABCODE       LENGTH OF INSERT                          74000020
         EJECT                                                          74100020
*        TRANSLATE TABLE FOR CONVERSION OF ABEND CODES                  74200020
         SPACE 1                                                        74300020
TTBL     DC    C'0123456789ABCDEF'   TRANS TABLE                        74400020
         SPACE 1                                                        74500020
TRANSTBL EQU   *-L256         ORG FOR TR INSTRUCTION                    74600020
         SPACE 1                                                        74700020
*        THIS IS A PATCH AREA FOR THIS ROUTINE                          74800020
         SPACE 1                                                        74900020
STAPATCH DC    5D'0'          PATCH AREA                                75000020
         SPACE 1                                                        75100020
*        TO MAKE IT EASIER TO PATCH, SET UP AN S-CON FOR IT             75200020
         SPACE 1                                                        75300020
STASCON  DC    S(STAPATCH)    S-CON FOR PATCHAREA                       75400020
         SPACE 1                                                        75500020
*        AND NOW SO WE CAN FIND THEM ON A LINKEDIT MAP,                 75600020
*        WE MAKE THEM ENTRY POINTS.                                     75700020
         SPACE 1                                                        75800020
         ENTRY STAPATCH,STASCON ENTRY POINTS                            75900020
         SPACE 1                                                        76000020
*        SINCE THIS IS THE END OF THE WORLD, GET RID OF OUR BASE        76050020
         SPACE 1                                                        76060020
         DROP  R12            OUR BASE REG                              76070020
         EJECT                                                          76100020
IKJUWORK DSECT                DSECT OF WORK AREA                        76200020
         SPACE 1                                                        76300020
*        THIS IS A DSECT OF THE WORK AREA ACQUIRED BY THE IKJEHSIR      76400020
*        EXIT ROUTINE.  IT IS IN SUBPOOL 1.                             76500020
         SPACE 1                                                        76600020
SAVEAREA DC    18F'0'         SAVEAREA FOR PROGRAM                      76700020
         SPACE 1                                                        76800020
*        THE FOLLOWING EQUATE IS USED TO GET A SAVEAREA                 76900020
*        FOR THE 33E RETRY ROUTINE                                      77000020
         SPACE 1                                                        77100020
L2GET    EQU   *-IKJUWORK     SAVEAREA SIZE                             77200020
         SPACE 1                                                        77300020
*        THE FOLLOWING IS THE PARAMETER LIST PASSED TO THE PUTLINE      77400020
*        SERVICE ROUTINE BY THIS ROUTINE.                               77500020
         SPACE 1                                                        77600020
PUTLPARM DS    0F             PUTLINE PARMETER LIST                     77700020
PUTLUPT  DC    F'0'           POINTER TO UPT                            77800020
PUTLECT  DC    F'0'           POINTER TO ECT                            77900020
PUTLECB  DC    F'0'           POINTER TO ECB                            78000020
PUTLPTR  DC    F'0'           POINTER TO PARM BLOCK                     78100020
         SPACE 1                                                        78200020
CPECB    DC    F'0'           ECB FOR PUTLINE                           78300020
         SPACE 1                                                        78400020
*        THIS GENERATES THE PUTLINE PARMETER BLOCK                      78500020
         SPACE 1                                                        78600020
PUTLINE  PUTLINE  OUTPUT=(0,TERM,SINGLE,INFOR),                        X78700020
               TERMPUT=(EDIT,WAIT,NOHOLD,BREAKIN),                     X78800020
               MF=L           PUTLINE BLOCK                             78900020
         SPACE 1                                                        79000020
*        THE FOLLOWING IS THE LIST OF INSERT ADDRESSES PASSED           79100020
*        TO PUTLINE.  IT IS POINTED TO BY THE ADDRESS OF THE            79200020
*        OUTPUT LINE IN THE PUTLINE BLOCK ABOVE.                        79300020
         SPACE 1                                                        79400020
PUTLPTRS DC    F'4'           NUMBER OF SEGMENTS                        79500020
PUTLMAIN DC    A(0)           POINTER TO MAIN MESSAGE                   79600020
PUTLI1   DC    A(0)           POINTER TO INSERT ONE                     79700020
PUTLI2   DC    A(0)           POINTER TO INSERT TWO                     79800020
PUTLI3   DC    A(0)           POINTER TO INSERT THREE                   79900020
         SPACE 1                                                        80000020
DWORK    DC    D'0'           WORK AREA FOR TRANSLATE                   80100020
         SPACE 1                                                        80200020
DWORK1   EQU   DWORK+L4       AREA FOR STORAGE                          80300020
         EJECT                                                          80400020
*        THE FOLLOWING IS THE MESSAGE AREA AND INSERT AREA              80500020
*        POINTED TO BY PUTLPTRS ABOVE.                                  80600020
         SPACE 1                                                        80700020
         DS    0H             HALFWORD ALIGNMENT                        80800020
MSG      DC    (LMSGID)X'00'  SPACE FOR MESSAGE                         80900020
         SPACE 1                                                        81000020
         DS    0H             HALFWORD ALIGNMENT                        81100020
INSERT1  DC    (LPNAME)X'00'  SPACE FOR INSERT1                         81200020
         SPACE 1                                                        81300020
INSERTP  EQU   *-L8           FOR PROGRAM NAME                          81400020
         SPACE 1                                                        81500020
         DS    0H              HALFWORD ALIGNMENT                       81600020
INSERT2  DC    (LSYSCODE)X'00' SPACE FOR INSERT 2                       81700020
         SPACE 1                                                        81800020
         DS    0H             HALFWORD ALIGNMENT                        81900020
INSERT3  DC    (LABCODE)X'00' SPACE FOR INSERT 3                        82000020
         SPACE 1                                                        82100020
INSERTC  EQU   *-L3           FOR ABEND CODE                            82200020
         SPACE 1                                                        82300020
         DS    0F             FULLWORD ALIGNMENT                        82400020
         SPACE 1                                                        82500020
L2XC     EQU   *-PUTLPARM     SIZE TO XC                                82600020
         SPACE 1                                                        82700020
LCORE    EQU   *-IKJUWORK     LENGTH OF DSECT                           82800020
         EJECT                                                          82900020
         STAES                MY DSECTS                                 83000020
         EJECT                                                          83100020
         IKJECT               ECT DSECT                                 83200020
         EJECT                                                          83300020
         IKJUPT               UPT DSECT                                 83400020
         EJECT                                                          83500020
         IKJPSCB              PSCB DSECT                                83600020
         SPACE 1                                                        83700020
         END                                                            83800020
