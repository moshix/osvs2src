         TITLE '     IKTCAS41 - STOP Q PROCESSOR                       *00001000
                        '                                               00002000
IKTCAS41 CSECT ,                                                   0001 00003000
@MAINENT DS    0H                                                  0001 00004000
         USING *,@15                                               0001 00005000
         B     @PROLOG                                             0001 00006000
         DC    AL1(16)                                             0001 00007000
         DC    C'IKTCAS41  78.045'                                 0001 00008000
         DROP  @15                                                      00009000
@PROLOG  STM   @14,@12,12(@13)                                     0001 00010000
         BALR  @12,0                                               0001 00011000
@PSTART  DS    0H                                                  0001 00012000
         USING @PSTART,@12                                         0001 00013000
         ST    @13,@SA00001+4                                      0001 00014000
         LA    @14,@SA00001                                        0001 00015000
         ST    @14,8(,@13)                                         0001 00016000
         LR    @13,@14                                             0001 00017000
         EJECT                                                          00018000
*                                                                  0039 00019000
*/*  *****************************************************************/ 00020000
*/*                                                                  */ 00021000
*/*    THIS SUBROUTINE PROCESSES THE W.E.'S FOUND ON THE             */ 00022000
*/*    ASYNCHRONOUS STOP QUEUE.  THE MAIN PROCESSING IS AS FOLLOWS:  */ 00023000
*/*                                                                  */ 00024000
*/*    -   IF THE Q IS EMPTY, EXIT                                   */ 00025000
*/*    -   FIND THE W.E. AT THE TOP OF THE Q                         */ 00026000
*/*    -   CALL THE SUBROUTINE 'PRCSSTPE'                            */ 00027000
*/*    -   UPON RETURN FROM 'PRCSSTPE', IF THE SUBROUTINE WAS        */ 00028000
*/*        UNABLE TO HANDLE THE REQUEST, EXIT AND GO BACK TO SLEEP   */ 00029000
*/*    -   OTHERWISE, DEQUEUE THE TOP W.E. AND EXIT                  */ 00030000
*/*                                                                  */ 00031000
*/*  *****************************************************************/ 00032000
*                                                                  0039 00033000
*   IF TWACSKIP='N'&TWACSTPQ^=0 THEN/* SHOULD WE PROCESS STOP Q      */ 00034000
         CLI   TWACSKIP(TWAPTR),C'N'                               0039 00035000
         BNE   @RF00039                                            0039 00036000
         L     @10,TWACSTPQ(,TWAPTR)                               0039 00037000
         LTR   @10,@10                                             0039 00038000
         BZ    @RF00039                                            0039 00039000
*     DO;                           /* YES                           */ 00040000
*       RESPECIFY                                                  0041 00041000
*        (WESTD) BASED(TEMPPTR);    /* SET UP NEW BASE FOR W.E.      */ 00042000
*       TEMPPTR=TWACSTPQ;           /* GET BEGINNING POINTER         */ 00043000
         LR    TEMPPTR,@10                                         0042 00044000
*       DO WHILE(WENEXT^=0);        /* FIND                          */ 00045000
         B     @DE00043                                            0043 00046000
@DL00043 DS    0H                                                  0044 00047000
*         TEMPPTR=WENEXT;           /* LAST W.E.                     */ 00048000
         L     TEMPPTR,WENEXT(,TEMPPTR)                            0044 00049000
*       END;                        /* ON Q                          */ 00050000
@DE00043 L     @10,WENEXT(,TEMPPTR)                                0045 00051000
         LTR   @10,@10                                             0045 00052000
         BNZ   @DL00043                                            0045 00053000
*       CALL PRCSSTPE;              /* PROCESS THE W.E.              */ 00054000
         BAL   @14,PRCSSTPE                                        0046 00055000
*       IF TWACSKIP='N' THEN        /* KEEP ON GOING                 */ 00056000
         CLI   TWACSKIP(TWAPTR),C'N'                               0047 00057000
         BNE   @RF00047                                            0047 00058000
*         DO;                       /* YES                           */ 00059000
*LOOP1:                             /* COMPARE AND SWAP LOOP         */ 00060000
*           TEMPPTR=TWACSTPQ;       /* GET BEGINNING POINTER MAKE  0049 00061000
*                                      TWACSTPQ THE WENEXT FIELD OF A   00062000
*                                      PSUEDO W.E.                   */ 00063000
LOOP1    L     TEMPPTR,TWACSTPQ(,TWAPTR)                           0049 00064000
*           TEMPPTR2=ADDR(TWACSTPQ)-(ADDR(WENEXT)-ADDR(WESTD));    0050 00065000
         LA    TEMPPTR2,TWACSTPQ(,TWAPTR)                          0050 00066000
         SL    TEMPPTR2,@CF00107                                   0050 00067000
*           DO WHILE(WENEXT^=0);    /* FIND                          */ 00068000
         B     @DE00051                                            0051 00069000
@DL00051 DS    0H                                                  0052 00070000
*             TEMPPTR2=TEMPPTR;     /* LAST                          */ 00071000
         LR    TEMPPTR2,TEMPPTR                                    0052 00072000
*             TEMPPTR=WENEXT;       /* W.E.                          */ 00073000
         L     TEMPPTR,WENEXT(,TEMPPTR)                            0053 00074000
*           END;                    /* ON Q HAVE ANY W.E.'S BEEN   0054 00075000
*                                      INSERTED BETWEEN THE BOTTOM 0054 00076000
*                                      W.E. AND THE NEXT TO BOTTOM 0054 00077000
*                                      W.E.                          */ 00078000
@DE00051 L     @10,WENEXT(,TEMPPTR)                                0054 00079000
         LTR   @10,@10                                             0054 00080000
         BNZ   @DL00051                                            0054 00081000
*           CS(TEMPPTR,WENEXT,TEMPPTR2->WENEXT);                   0055 00082000
         CS    TEMPPTR,@10,WENEXT(TEMPPTR2)                        0055 00083000
*           BC(7,LOOP1);            /* YES - TRY AGAIN               */ 00084000
         BC    7,LOOP1                                             0056 00085000
*           IF WECODE1T=TCCONSLE&   /* FOR HALT CANCEL       @ZM21019*/ 00086000
*               WECODE1F=FCCIVT THEN                               0057 00087000
         CLI   WECODE1T(TEMPPTR),X'04'                             0057 00088000
         BNE   @RF00057                                            0057 00089000
         CLI   WECODE1F(TEMPPTR),X'12'                             0057 00090000
         BE    @RT00057                                            0057 00091000
*             ;                     /* BYPASS THE FREEMAIN SINCE   0058 00092000
*                                      STORAGE WAS ACQUIRED BY     0058 00093000
*                                      ANOTHER TCB. FREEMAIN HERE  0058 00094000
*                                      WOULD CAUSE 305 ABEND. STORAGE   00095000
*                                      WILL BE FREED BY SYSTEM WHEN     00096000
*                                      TCAS ENDS, WHICH IS IMMINENT.    00097000
*                                                            @ZM21019*/ 00098000
*           ELSE                                                   0059 00099000
*             DO;                   /*                       @ZM21019*/ 00100000
@RF00057 DS    0H                                                  0060 00101000
*               LENGTH=WELEN;       /* FREE                          */ 00102000
         LH    LENGTH,WELEN(,TEMPPTR)                              0060 00103000
*               SUBPL=WECODE2T;     /* THE                           */ 00104000
         SLR   SUBPL,SUBPL                                         0061 00105000
         IC    SUBPL,WECODE2T(,TEMPPTR)                            0061 00106000
*               ADDRESS=TEMPPTR;    /* OLD                           */ 00107000
         ST    TEMPPTR,ADDRESS                                     0062 00108000
*               CALL FRESPACE;      /* W.E.                          */ 00109000
         BAL   @14,FRESPACE                                        0063 00110000
*             END;                  /*                       @ZM21019*/ 00111000
*         END;                                                     0065 00112000
@RT00057 DS    0H                                                  0066 00113000
*       RESPECIFY                                                  0066 00114000
*        (WESTD);                   /* REVERT TO OLD BASE            */ 00115000
@RF00047 DS    0H                                                  0067 00116000
*     END;                                                         0067 00117000
*   RETURN CODE(0);                 /* FINISHED                      */ 00118000
@RF00039 SLR   @15,@15                                             0068 00119000
         L     @13,4(,@13)                                         0068 00120000
         L     @14,12(,@13)                                        0068 00121000
         LM    @00,@12,20(@13)                                     0068 00122000
         BR    @14                                                 0068 00123000
         EJECT                                                          00124000
*PRCSSTPE:                                                         0069 00125000
*   PROC OPTIONS(SAVE(14));                                        0069 00126000
@EL00001 L     @13,4(,@13)                                         0069 00127000
@EF00001 DS    0H                                                  0069 00128000
@ER00001 LM    @14,@12,12(@13)                                     0069 00129000
         BR    @14                                                 0069 00130000
PRCSSTPE ST    @14,@SA00002                                        0069 00131000
*                                                                  0070 00132000
*/*  *****************************************************************/ 00133000
*/*                                                                  */ 00134000
*/*    THE PURPOSE OF THIS SUBROUTINE IS TO PROCESS A W.E. FROM THE  */ 00135000
*/*    STOP Q.  THE MAIN PROCESSING IS AS FOLLOWS:                   */ 00136000
*/*                                                                  */ 00137000
*/*    -   TRY AND PUT A RETURN W.E. ON THE SYNC Q.  IF              */ 00138000
*/*        UNSUCCESSFUL, EXIT AND GO BACK TO SLEEP.  NOTE THAT       */ 00139000
*/*        PUTTING MY RETURN W.E. ON THE TOP OF THE SYNC Q HAS THE   */ 00140000
*/*        EFFECT OF LOCKING OUT ALL OTHER TASKS WHICH PROCESS       */ 00141000
*/*        THE SYNC Q.                                               */ 00142000
*/*    -   FIND OUT FROM THE OPERATOR WHAT KIND OF STOP HE WANTS,    */ 00143000
*/*        FSTOP OR SIC.                                             */ 00144000
*/*    -   BUILD THE SET OF REQUIRED W.E.'S AND PUT THEM ON THE      */ 00145000
*/*        SYNC Q.                                                   */ 00146000
*/*    -   POST VTAM SUB-TASK                                        */ 00147000
*/*    -   EXIT                                                      */ 00148000
*/*                                                                  */ 00149000
*/*  *****************************************************************/ 00150000
*                                                                  0070 00151000
*   IF TWASYNQH^=0 THEN             /* IS SYNC Q EMPTY               */ 00152000
         L     @10,TWASYNQH(,TWAPTR)                               0070 00153000
         LTR   @10,@10                                             0070 00154000
         BZ    @RF00070                                            0070 00155000
*     TWACSKIP='Y';                 /* NO - GO BACK TO SLEEP         */ 00156000
         MVI   TWACSKIP(TWAPTR),C'Y'                               0071 00157000
*   ELSE                                                           0072 00158000
*     DO;                           /* YES CALCULATE THE LENGTH OF A    00159000
*                                      RETURN W.E. + A CLOSE ACB W.E.   00160000
*                                      + AN ADDRESS SPACE TERMINATION   00161000
*                                      W.E. + A TCAS TERMINATION W.E.   00162000
*                                      + AN END TCAS MAIN TASK W.E.,    00163000
*                                      ROUNDED UP TO THE NEXT      0072 00164000
*                                      DOUBLEWORD.                   */ 00165000
         B     @RC00070                                            0072 00166000
@RF00070 DS    0H                                                  0073 00167000
*       LENGTH=((12+12+12+12+12)+7)/8*8;                           0073 00168000
         LA    LENGTH,64                                           0073 00169000
*       SUBPL=4;                    /* SUBPOOL NUMBER                */ 00170000
         LA    SUBPL,4                                             0074 00171000
*       CALL GETSPACE;              /* GET SPACE                     */ 00172000
         BAL   @14,GETSPACE                                        0075 00173000
*       SAVEADDR=ADDRESS;           /* SAVE FOR FUTURE USE           */ 00174000
         L     @10,ADDRESS                                         0076 00175000
         LR    SAVEADDR,@10                                        0076 00176000
*       WECODE1T=TCCONSLE;          /* MY TASK CODE                  */ 00177000
         L     @07,WEPTR                                           0077 00178000
         MVI   WECODE1T(@07),X'04'                                 0077 00179000
*       WECODE2T=TCCONSLE;          /* CODE                          */ 00180000
         MVI   WECODE2T(@07),X'04'                                 0078 00181000
*       WECODE1F=FCRETURN;          /* RETURN FUNCTION CODE          */ 00182000
         MVI   WECODE1F(@07),X'FF'                                 0079 00183000
*       WECODE2F=FCCSTOP;           /* STOP FUNCTION CODE            */ 00184000
         MVI   WECODE2F(@07),X'11'                                 0080 00185000
*       WERC=0;                     /* ZERO OUT                      */ 00186000
         SLR   @15,@15                                             0081 00187000
         STH   @15,WERC(,@07)                                      0081 00188000
*       WENEXT=0;                   /* ZERO OUT                      */ 00189000
         ST    @15,WENEXT(,@07)                                    0082 00190000
*       WELEN=LENGTH;               /* TOTAL LENGTH OF SPACE         */ 00191000
         STH   LENGTH,WELEN(,@07)                                  0083 00192000
*       TEMPPTR2=0;                 /* SEE IF SYNC                   */ 00193000
         SLR   TEMPPTR2,TEMPPTR2                                   0084 00194000
*       CS(TEMPPTR2,ADDRESS,TWASYNQH);/* Q STILL EMPTY               */ 00195000
         CS    TEMPPTR2,@10,TWASYNQH(TWAPTR)                       0085 00196000
*       BC(8,STPESKIP);             /* YES                           */ 00197000
         BC    8,STPESKIP                                          0086 00198000
*       CALL FRESPACE;              /* NO - FREE SPACE               */ 00199000
         BAL   @14,FRESPACE                                        0087 00200000
*       TWACSKIP='Y';               /* AND GO BACK                   */ 00201000
         MVI   TWACSKIP(TWAPTR),C'Y'                               0088 00202000
*       RETURN;                     /* TO SLEEP                      */ 00203000
@EL00002 DS    0H                                                  0089 00204000
@EF00002 DS    0H                                                  0089 00205000
@ER00002 L     @14,@SA00002                                        0089 00206000
         BR    @14                                                 0089 00207000
*STPESKIP:                                                         0090 00208000
*       ADDRESS=ADDRESS+12;         /* PT TO NEXT FREE W.E.          */ 00209000
STPESKIP LA    @10,12                                              0090 00210000
         L     @05,ADDRESS                                         0090 00211000
         ALR   @05,@10                                             0090 00212000
         ST    @05,ADDRESS                                         0090 00213000
*       WECODE1T=TCVTAM;            /* TELL VTAM                     */ 00214000
         L     @02,WEPTR                                           0091 00215000
         MVI   WECODE1T(@02),X'02'                                 0091 00216000
*       WECODE1F=FCVACBCL;          /* INTERFACE                     */ 00217000
         MVI   WECODE1F(@02),X'12'                                 0092 00218000
*       WENEXT=ADDRESS+12;          /* DRIVER TO                     */ 00219000
         ALR   @05,@10                                             0093 00220000
         ST    @05,WENEXT(,@02)                                    0093 00221000
*       CALL FILLINWE;              /* CLOSE ACB                     */ 00222000
         BAL   @14,FILLINWE                                        0094 00223000
*       ADDRESS=ADDRESS+12;         /* POINT TO NEXT FREE W.E.       */ 00224000
         LA    @10,12                                              0095 00225000
         AL    @10,ADDRESS                                         0095 00226000
         ST    @10,ADDRESS                                         0095 00227000
*       WECODE1T=TCUSER;            /* TASK CODE= U.I.               */ 00228000
         L     @10,WEPTR                                           0096 00229000
         MVI   WECODE1T(@10),X'03'                                 0096 00230000
*       WTOREPLY='';                /* CLEAR REPLY ARE@YM03218       */ 00231000
         MVI   WTOREPLY,C' '                                       0097 00232000
         MVC   WTOREPLY+1(5),WTOREPLY                              0097 00233000
*       IF TEMPPTR->WECODE1T=TCCONSLE&/* IF W.E. FOR HALT VTAM       */ 00234000
*           TEMPPTR->WECODE1F=FCCIVT THEN/* (W.E. ID 0412)   @ZM21019*/ 00235000
         CLI   WECODE1T(TEMPPTR),X'04'                             0098 00236000
         BNE   @RF00098                                            0098 00237000
         CLI   WECODE1F(TEMPPTR),X'12'                             0098 00238000
         BNE   @RF00098                                            0098 00239000
*         WECODE1F=FCUFSTOP;        /* FORCE FSTOP           @ZM21019*/ 00240000
         MVI   WECODE1F(@10),X'22'                                 0099 00241000
*       ELSE                        /* NORMAL W.E. FOR CONSOLE     0100 00242000
*                                      COMMUNICATION         @ZM21019*/ 00243000
*         IF TCASUSEC^=0            /* IF THERE IS USR@YM03218       */ 00244000
*           THEN                                                   0100 00245000
         B     @RC00098                                            0100 00246000
@RF00098 L     @10,TCASTPTR(,TWAPTR)                               0100 00247000
         LH    @10,TCASUSEC(,@10)                                  0100 00248000
         LTR   @10,@10                                             0100 00249000
         BZ    @RF00100                                            0100 00250000
*           CALL STPWTOR;           /* THEN GO ASK OPE@YM03218       */ 00251000
         BAL   @14,STPWTOR                                         0101 00252000
*       IF WTOREPLY(1)='S' THEN     /* IF OP REPLY IS SIC            */ 00253000
@RF00100 DS    0H                                                  0102 00254000
@RC00098 CLI   WTOREPLY,C'S'                                       0102 00255000
         BNE   @RF00102                                            0102 00256000
*         WECODE1F=FCUSIC;          /* CONSTRUCT SIC W.E.            */ 00257000
         L     @10,WEPTR                                           0103 00258000
         MVI   WECODE1F(@10),X'21'                                 0103 00259000
*       ELSE                        /* IF NOT                        */ 00260000
*         WECODE1F=FCUFSTOP;        /* CONSTRUCT FSTOP W.E.          */ 00261000
         B     @RC00102                                            0104 00262000
@RF00102 L     @10,WEPTR                                           0104 00263000
         MVI   WECODE1F(@10),X'22'                                 0104 00264000
*       WENEXT=ADDRESS+12;          /* INSERT NEXT W.E. ADDR         */ 00265000
@RC00102 LA    @10,12                                              0105 00266000
         AL    @10,ADDRESS                                         0105 00267000
         L     @02,WEPTR                                           0105 00268000
         ST    @10,WENEXT(,@02)                                    0105 00269000
*       CALL FILLINWE;              /* FILL IN NEXT W.E.             */ 00270000
         BAL   @14,FILLINWE                                        0106 00271000
*       ADDRESS=ADDRESS+12;         /* POINT TO NEXT FREE W.E.       */ 00272000
         LA    @10,12                                              0107 00273000
         L     @02,ADDRESS                                         0107 00274000
         ALR   @02,@10                                             0107 00275000
         ST    @02,ADDRESS                                         0107 00276000
*       WECODE1T=TCMAIN;            /* TELL                          */ 00277000
         L     @15,WEPTR                                           0108 00278000
         MVI   WECODE1T(@15),X'01'                                 0108 00279000
*       WECODE1F=FCMTCTRM;          /* TCAS                          */ 00280000
         MVI   WECODE1F(@15),X'80'                                 0109 00281000
*       WENEXT=ADDRESS+12;          /* ABOUT                         */ 00282000
         ALR   @02,@10                                             0110 00283000
         ST    @02,WENEXT(,@15)                                    0110 00284000
*       CALL FILLINWE;              /* TERMINATION                   */ 00285000
         BAL   @14,FILLINWE                                        0111 00286000
*       WERC2='07'X;                /* REQUEST                       */ 00287000
         L     @10,WEPTR                                           0112 00288000
         MVI   WERC2(@10),X'07'                                    0112 00289000
*       ADDRESS=ADDRESS+12;         /* POINT TO NEXT FREE W.E.       */ 00290000
         LA    @10,12                                              0113 00291000
         AL    @10,ADDRESS                                         0113 00292000
         ST    @10,ADDRESS                                         0113 00293000
*       WECODE1T=TCMAIN;            /* TELL                          */ 00294000
         L     @10,WEPTR                                           0114 00295000
         MVI   WECODE1T(@10),X'01'                                 0114 00296000
*       WECODE1F=FCMOKEND;          /* TCAS                          */ 00297000
         MVI   WECODE1F(@10),X'91'                                 0115 00298000
*       WENEXT=SAVEADDR;            /* TO                            */ 00299000
         ST    SAVEADDR,WENEXT(,@10)                               0116 00300000
*       CALL FILLINWE;              /* TERMINATE                     */ 00301000
         BAL   @14,FILLINWE                                        0117 00302000
*       ADDRESS=SAVEADDR+12;        /* ADDR OF NEW FIRST W.E.        */ 00303000
         LA    @10,12                                              0118 00304000
         ALR   @10,SAVEADDR                                        0118 00305000
         ST    @10,ADDRESS                                         0118 00306000
*       CS(TWASYNQH,ADDRESS,TWASYNQH);/* PT Q HEAD AT NEW FRONT      */ 00307000
         L     @15,TWASYNQH(,TWAPTR)                               0119 00308000
         CS    @15,@10,TWASYNQH(TWAPTR)                            0119 00309000
         BZ    @BC00119                                            0119 00310000
         ST    @15,TWASYNQH(,TWAPTR)                               0119 00311000
@BC00119 DS    0H                                                  0120 00312000
*       RESPECIFY                                                  0120 00313000
*        (R1) RESTRICTED;                                          0120 00314000
*       R1=ADDR(TWAVECB);           /* ADDR OF ECB TO POST           */ 00315000
         LA    R1,TWAVECB(,TWAPTR)                                 0121 00316000
*       GEN(POST  (1))              /* TELL VTAM SUB-TASK            */ 00317000
*       REFS(R0,R1,R14,R15);                                       0122 00318000
         POST  (1)                                                      00319000
*       RESPECIFY                                                  0123 00320000
*        (R1) UNRESTRICTED;                                        0123 00321000
*     END;                                                         0124 00322000
*   END PRCSSTPE;                                                  0125 00323000
         B     @EL00002                                            0125 00324000
         EJECT                                                          00325000
*STPWTOR:                                                          0126 00326000
*   PROC OPTIONS(SAVE(14));                                        0126 00327000
STPWTOR  ST    @14,@SA00003                                        0126 00328000
*                                                                  0127 00329000
*/*  *****************************************************************/ 00330000
*/*                                                                  */ 00331000
*/*    THIS SUBROUTINE FINDS OUT FROM THE OPERATOR WHAT KIND OF STOP */ 00332000
*/*    HE WANTS, 'FSTOP' OF 'SIC'.                                   */ 00333000
*/*                                                                  */ 00334000
*/*  *****************************************************************/ 00335000
*                                                                  0127 00336000
*   RESPECIFY                                                      0127 00337000
*    (R1) RESTRICTED;                                              0127 00338000
*   R1=10;                          /* MESSAGE NUMBER                */ 00339000
         LA    R1,10                                               0128 00340000
*   CALL MSGBLK;                    /* ADDR OF LIST FORM OF MSG      */ 00341000
         L     @15,TWAMSG(,TWAPTR)                                 0129 00342000
         BALR  @14,@15                                             0129 00343000
*   MVC(IKT010D(1:MSGLNGTH),MSGDATA);/* MOVE IN LIST FORM            */ 00344000
         L     @10,MSGLNGTH(,R1)                                   0130 00345000
         BCTR  @10,0                                               0130 00346000
         EX    @10,@SM00312                                        0130 00347000
*   R1=16;                          /* MESSAGE NUMBER                */ 00348000
         LA    R1,16                                               0131 00349000
*   CALL MSGBLK;                    /* ADDR OF LIST FORM OF MSG      */ 00350000
         L     @15,TWAMSG(,TWAPTR)                                 0132 00351000
         BALR  @14,@15                                             0132 00352000
*   MVC(IKT016D(1:MSGLNGTH),MSGDATA);/* MOVE IN LIST FORM            */ 00353000
         L     @10,MSGLNGTH(,R1)                                   0133 00354000
         BCTR  @10,0                                               0133 00355000
         EX    @10,@SM00314                                        0133 00356000
*   CVD(TCASUSEC,DBLWORD);          /* NUMBER OF                     */ 00357000
         L     @10,TCASTPTR(,TWAPTR)                               0134 00358000
         LH    @10,TCASUSEC(,@10)                                  0134 00359000
         CVD   @10,DBLWORD                                         0134 00360000
*   UNPK(IKT010DA,DBLWORD);         /* ACTIVE                        */ 00361000
         UNPK  IKT010DA(5),DBLWORD(8)                              0135 00362000
*   IKT010DA(5)=IKT010DA(5)|'F0'X;  /* USERS                         */ 00363000
         OI    IKT010DA+4,X'F0'                                    0136 00364000
*   WTOREPLY='';                    /* CLEAR REPLY AREA              */ 00365000
         MVI   WTOREPLY,C' '                                       0137 00366000
         MVC   WTOREPLY+1(5),WTOREPLY                              0137 00367000
*   WTORECB=0;                      /* CLEAR REPLY ECB               */ 00368000
         SLR   @10,@10                                             0138 00369000
         ST    @10,WTORECB                                         0138 00370000
*   R1=ADDR(IKT010D);               /* ADDR OF MSG                   */ 00371000
         LA    R1,IKT010D                                          0139 00372000
*   GEN(WTOR  ,WTOREPLY,6,WTORECB,MF=(E,(1)))                      0140 00373000
*   REFS(R0,R1,R14,R15,WTOREPLY,WTORECB);/* ISSUE WTOR               */ 00374000
         WTOR  ,WTOREPLY,6,WTORECB,MF=(E,(1))                           00375000
*   GEN(WAIT  ECB=WTORECB)          /* WAIT FOR OPERATOR             */ 00376000
*   REFS(R0,R1,R14,R15,WTORECB);                                   0141 00377000
         WAIT  ECB=WTORECB                                              00378000
*   IF WTOREPLY='FSTOP '|WTOREPLY='SIC   ' THEN/* IF GOOD, EXIT      */ 00379000
         CLC   WTOREPLY(6),@CC00297                                0142 00380000
         BE    @RT00142                                            0142 00381000
         CLC   WTOREPLY(6),@CC00298                                0142 00382000
         BE    @RT00142                                            0142 00383000
*     ;                                                            0143 00384000
*   ELSE                            /* NO - GET A GOOD REPLY         */ 00385000
*     DO UNTIL(WTOREPLY='FSTOP '|WTOREPLY='SIC   ');               0144 00386000
@DL00144 DS    0H                                                  0145 00387000
*       WTOREPLY='';                /* CLEAR REPLY AREA              */ 00388000
         MVI   WTOREPLY,C' '                                       0145 00389000
         MVC   WTOREPLY+1(5),WTOREPLY                              0145 00390000
*       WTORECB=0;                  /* CLEAR REPLY ECB               */ 00391000
         SLR   @10,@10                                             0146 00392000
         ST    @10,WTORECB                                         0146 00393000
*       R1=ADDR(IKT016D);           /* ADDR OF MSG                   */ 00394000
         LA    R1,IKT016D                                          0147 00395000
*       GEN(WTOR  ,WTOREPLY,6,WTORECB,MF=(E,(1)))                  0148 00396000
*       REFS(R0,R1,R14,R15,WTOREPLY,WTORECB);/* ISSUE WTOR           */ 00397000
         WTOR  ,WTOREPLY,6,WTORECB,MF=(E,(1))                           00398000
*       GEN(WAIT  ECB=WTORECB)      /* WAIT FOR OPERATOR             */ 00399000
*       REFS(R0,R1,R14,R15,WTORECB);                               0149 00400000
         WAIT  ECB=WTORECB                                              00401000
*     END;                                                         0150 00402000
@DE00144 CLC   WTOREPLY(6),@CC00297                                0150 00403000
         BE    @DC00144                                            0150 00404000
         CLC   WTOREPLY(6),@CC00298                                0150 00405000
         BNE   @DL00144                                            0150 00406000
@DC00144 DS    0H                                                  0151 00407000
*   RESPECIFY                                                      0151 00408000
*    (R1) UNRESTRICTED;                                            0151 00409000
*   END STPWTOR;                                                   0152 00410000
@EL00003 DS    0H                                                  0152 00411000
@EF00003 DS    0H                                                  0152 00412000
@ER00003 L     @14,@SA00003                                        0152 00413000
         BR    @14                                                 0152 00414000
         EJECT                                                          00415000
*FILLINWE:                                                         0153 00416000
*   PROC OPTIONS(SAVE(14));                                        0153 00417000
FILLINWE ST    @14,12(,@13)                                        0153 00418000
*                                                                  0154 00419000
*/*  *****************************************************************/ 00420000
*/*                                                                  */ 00421000
*/*    THIS SUBROUTINE FILLS IN COMMON STOP W.E. INFORMATION         */ 00422000
*/*                                                                  */ 00423000
*/*  *****************************************************************/ 00424000
*                                                                  0154 00425000
*   WECODE2T=TCCONSLE;              /* MY TASK CODE                  */ 00426000
         L     @10,WEPTR                                           0154 00427000
         MVI   WECODE2T(@10),X'04'                                 0154 00428000
*   WECODE2F=FCCSTOP;               /* STOP FUNCTION CODE            */ 00429000
         MVI   WECODE2F(@10),X'11'                                 0155 00430000
*   WERC=0;                         /* ZERO OUT                      */ 00431000
         SLR   @05,@05                                             0156 00432000
         STH   @05,WERC(,@10)                                      0156 00433000
*   WELEN=0;                        /* ZERO OUT                      */ 00434000
         STH   @05,WELEN(,@10)                                     0157 00435000
*   END FILLINWE;                                                  0158 00436000
@EL00004 DS    0H                                                  0158 00437000
@EF00004 DS    0H                                                  0158 00438000
@ER00004 L     @14,12(,@13)                                        0158 00439000
         BR    @14                                                 0158 00440000
         EJECT                                                          00441000
*FRESPACE:                                                         0159 00442000
*   PROC OPTIONS(SAVE(14));                                        0159 00443000
FRESPACE ST    @14,@SA00005                                        0159 00444000
*                                                                  0160 00445000
*/*  *****************************************************************/ 00446000
*/*                                                                  */ 00447000
*/*    THIS SUBROUTINE DOES A FREEMAIN FOR THE NUMBER OF BYTES       */ 00448000
*/*    SPECIFIED IN 'LENGTH', USING THE ADDRESS FOUND IN 'ADDRESS'   */ 00449000
*/*    AS A STARTING ADDRESS, AND USING THE VALUE FOUND IN 'SUBPL'   */ 00450000
*/*    AS THE SUBPOOL NUMBER                                         */ 00451000
*/*                                                                  */ 00452000
*/*  *****************************************************************/ 00453000
*                                                                  0160 00454000
*   RESPECIFY                                                      0160 00455000
*    (R2,                                                          0160 00456000
*     R3) RESTRICTED;                                              0160 00457000
*   R2=LENGTH;                                                     0161 00458000
         LR    R2,LENGTH                                           0161 00459000
*   R3=SUBPL;                                                      0162 00460000
         LR    R3,SUBPL                                            0162 00461000
*   GEN(FREEMAIN EU,LV=(R2),A=ADDRESS,SP=(R3))                     0163 00462000
*   REFS(ADDRESS,R0,R1,R2,R3,R14,R15);                             0163 00463000
         FREEMAIN EU,LV=(R2),A=ADDRESS,SP=(R3)                          00464000
*   RESPECIFY                                                      0164 00465000
*    (R2,                                                          0164 00466000
*     R3) UNRESTRICTED;                                            0164 00467000
*   END FRESPACE;                                                  0165 00468000
@EL00005 DS    0H                                                  0165 00469000
@EF00005 DS    0H                                                  0165 00470000
@ER00005 L     @14,@SA00005                                        0165 00471000
         BR    @14                                                 0165 00472000
         EJECT                                                          00473000
*GETSPACE:                                                         0166 00474000
*   PROC OPTIONS(SAVE(14));                                        0166 00475000
GETSPACE ST    @14,@SA00006                                        0166 00476000
*                                                                  0167 00477000
*/*  *****************************************************************/ 00478000
*/*                                                                  */ 00479000
*/*    THIS SUBROUTINE DOES A GETMAIN FOR THE NUMBER OF BYTES        */ 00480000
*/*    SPECIFIED IN 'LENGTH' (SHOULD BE A DOUBLEWORD MULTIPLE),      */ 00481000
*/*    FROM THE SUBPOOL SPECIFIED IN 'SUBPL', AND THEN PLACES THE    */ 00482000
*/*    STARTING ADDRESS OF THE GETMAIN'ED AREA IN 'ADDRESS'.         */ 00483000
*/*                                                                  */ 00484000
*/*  *****************************************************************/ 00485000
*                                                                  0167 00486000
*   RESPECIFY                                                      0167 00487000
*    (R2,                                                          0167 00488000
*     R3) RESTRICTED;                                              0167 00489000
*   R2=LENGTH;                                                     0168 00490000
         LR    R2,LENGTH                                           0168 00491000
*   R3=SUBPL;                                                      0169 00492000
         LR    R3,SUBPL                                            0169 00493000
*   GEN(GETMAIN EU,LV=(R2),A=ADDRESS,SP=(R3))                      0170 00494000
*   REFS(ADDRESS,R0,R1,R2,R3,R14,R15);                             0170 00495000
         GETMAIN EU,LV=(R2),A=ADDRESS,SP=(R3)                           00496000
*   RESPECIFY                                                      0171 00497000
*    (R2,                                                          0171 00498000
*     R3) UNRESTRICTED;                                            0171 00499000
*   END GETSPACE;                                                  0172 00500000
@EL00006 DS    0H                                                  0172 00501000
@EF00006 DS    0H                                                  0172 00502000
@ER00006 L     @14,@SA00006                                        0172 00503000
         BR    @14                                                 0172 00504000
         EJECT                                                          00505000
*   END IKTCAS41                                                   0173 00506000
*                                                                  0173 00507000
*/* THE FOLLOWING INCLUDE STATEMENTS WERE FOUND IN THIS PROGRAM.     */ 00508000
*/*%INCLUDE SYSLIB  (IKTTCAST)                                       */ 00509000
*/*%INCLUDE SYSLIB  (IKTCASWA)                                       */ 00510000
*                                                                  0173 00511000
*       ;                                                          0173 00512000
@DATA    DS    0H                                                       00513000
@SM00312 MVC   IKT010D(0),MSGDATA(R1)                                   00514000
@SM00314 MVC   IKT016D(0),MSGDATA(R1)                                   00515000
         DS    0F                                                       00516000
@SA00001 DS    18F                                                      00517000
@SA00002 DS    1F                                                       00518000
@SA00005 DS    1F                                                       00519000
@SA00006 DS    1F                                                       00520000
@SA00003 DS    1F                                                       00521000
         DS    0F                                                       00522000
@CF00107 DC    F'4'                                                     00523000
         DS    0D                                                       00524000
ADDRESS  DS    A                                                        00525000
WTORECB  DS    F                                                        00526000
@CC00297 DC    C'FSTOP '                                                00527000
@CC00298 DC    C'SIC   '                                                00528000
         DS    CL4                                                      00529000
DBLWORD  DS    CL8                                                      00530000
IKT016D  DS    CL96                                                     00531000
WTOREPLY DS    CL6                                                      00532000
         DS    CL2                                                      00533000
IKT010D  DS    CL96                                                     00534000
         ORG   IKT010D                                                  00535000
@NM00002 DS    CL20                                                     00536000
IKT010DA DS    CL5                                                      00537000
@NM00003 DS    CL71                                                     00538000
         ORG   IKT010D+96                                               00539000
@00      EQU   00                      EQUATES FOR REGISTERS 0-15       00540000
@01      EQU   01                                                       00541000
@02      EQU   02                                                       00542000
@03      EQU   03                                                       00543000
@04      EQU   04                                                       00544000
@05      EQU   05                                                       00545000
@06      EQU   06                                                       00546000
@07      EQU   07                                                       00547000
@08      EQU   08                                                       00548000
@09      EQU   09                                                       00549000
@10      EQU   10                                                       00550000
@11      EQU   11                                                       00551000
@12      EQU   12                                                       00552000
@13      EQU   13                                                       00553000
@14      EQU   14                                                       00554000
@15      EQU   15                                                       00555000
TEMPPTR2 EQU   @02                                                      00556000
TEMPPTR  EQU   @04                                                      00557000
SUBPL    EQU   @06                                                      00558000
LENGTH   EQU   @05                                                      00559000
SAVEADDR EQU   @03                                                      00560000
R0       EQU   @00                                                      00561000
R1       EQU   @01                                                      00562000
R2       EQU   @02                                                      00563000
R3       EQU   @03                                                      00564000
TWAPTR   EQU   @11                                                      00565000
R14      EQU   @14                                                      00566000
R15      EQU   @15                                                      00567000
MSGBLK   EQU   0                                                        00568000
@NM00001 EQU   0                                                        00569000
MSGLNGTH EQU   @NM00001                                                 00570000
MSGDATA  EQU   @NM00001+4                                               00571000
WESTD    EQU   0                                                        00572000
WECODE1T EQU   WESTD                                                    00573000
WECODE1F EQU   WESTD+1                                                  00574000
WECODE2T EQU   WESTD+2                                                  00575000
WECODE2F EQU   WESTD+3                                                  00576000
WENEXT   EQU   WESTD+4                                                  00577000
WERC     EQU   WESTD+8                                                  00578000
WERC2    EQU   WERC+1                                                   00579000
WELEN    EQU   WESTD+10                                                 00580000
TCAST    EQU   0                                                        00581000
TCASUSER EQU   TCAST+4                                                  00582000
TCASUSEC EQU   TCASUSER                                                 00583000
TCASFLG1 EQU   TCAST+88                                                 00584000
TCASFLG2 EQU   TCAST+89                                                 00585000
TWAR     EQU   0                                                        00586000
TWASYNQH EQU   TWAR+4                                                   00587000
TWATCAST EQU   TWAR+20                                                  00588000
TWAMSG   EQU   TWAR+48                                                  00589000
TWAMFL   EQU   TWAR+80                                                  00590000
TWAVFL   EQU   TWAR+81                                                  00591000
TWAUFL   EQU   TWAR+82                                                  00592000
TWACFL   EQU   TWAR+83                                                  00593000
TWAM     EQU   TWAR+84                                                  00594000
TWAME    EQU   TWAM+68                                                  00595000
TWAMEI   EQU   TWAME                                                    00596000
TWAV     EQU   TWAR+184                                                 00597000
TWAVE    EQU   TWAV+68                                                  00598000
TWAVEI   EQU   TWAVE                                                    00599000
TWAVI    EQU   TWAR+284                                                 00600000
TWAVECB  EQU   TWAVI                                                    00601000
TWAU     EQU   TWAR+300                                                 00602000
TWAUE    EQU   TWAU+68                                                  00603000
TWAUEI   EQU   TWAUE                                                    00604000
TWAUI    EQU   TWAR+400                                                 00605000
TWAC     EQU   TWAR+408                                                 00606000
TWACE    EQU   TWAC+68                                                  00607000
TWACEI   EQU   TWACE                                                    00608000
TWACI    EQU   TWAR+508                                                 00609000
TWACSTPQ EQU   TWACI+4                                                  00610000
TWACSKIP EQU   TWACI+12                                                 00611000
TCASTPTR EQU   TWATCAST                                                 00612000
WEPTR    EQU   ADDRESS                                                  00613000
         AGO   .@UNREFD                START UNREFERENCED COMPONENTS    00614000
TWAEND   EQU   TWAR+536                                                 00615000
TWAWORKE EQU   TWAR+524                                                 00616000
@NM00017 EQU   TWACI+13                                                 00617000
TWACMODQ EQU   TWACI+8                                                  00618000
TWACECB  EQU   TWACI                                                    00619000
TWACERRS EQU   TWACE+4                                                  00620000
TWACERA  EQU   TWACEI+1                                                 00621000
TWACEIFC EQU   TWACEI                                                   00622000
TWACRTFC EQU   TWAC+60                                                  00623000
TWACABFC EQU   TWAC+56                                                  00624000
TWACTWA  EQU   TWAC+52                                                  00625000
TWACEWA  EQU   TWAC+4                                                   00626000
TWACID   EQU   TWAC                                                     00627000
TWAUACQH EQU   TWAUI+4                                                  00628000
TWAUECB  EQU   TWAUI                                                    00629000
TWAUERRS EQU   TWAUE+4                                                  00630000
TWAUERA  EQU   TWAUEI+1                                                 00631000
TWAUEIFC EQU   TWAUEI                                                   00632000
TWAURTFC EQU   TWAU+60                                                  00633000
TWAUABFC EQU   TWAU+56                                                  00634000
TWAUTWA  EQU   TWAU+52                                                  00635000
TWAUEWA  EQU   TWAU+4                                                   00636000
TWAUID   EQU   TWAU                                                     00637000
TWAVACQH EQU   TWAVI+12                                                 00638000
TWAVTHQH EQU   TWAVI+8                                                  00639000
TWAVTEQH EQU   TWAVI+4                                                  00640000
TWAVERRS EQU   TWAVE+4                                                  00641000
TWAVERA  EQU   TWAVEI+1                                                 00642000
TWAVEIFC EQU   TWAVEI                                                   00643000
TWAVRTFC EQU   TWAV+60                                                  00644000
TWAVABFC EQU   TWAV+56                                                  00645000
TWAVTWA  EQU   TWAV+52                                                  00646000
TWAVEWA  EQU   TWAV+4                                                   00647000
TWAVID   EQU   TWAV                                                     00648000
TWAMERRS EQU   TWAME+4                                                  00649000
TWAMERA  EQU   TWAMEI+1                                                 00650000
TWAMEIFC EQU   TWAMEI                                                   00651000
TWAMRTFC EQU   TWAM+60                                                  00652000
TWAMABFC EQU   TWAM+56                                                  00653000
TWAMTWA  EQU   TWAM+52                                                  00654000
TWAMEWA  EQU   TWAM+4                                                   00655000
TWAMID   EQU   TWAM                                                     00656000
@NM00016 EQU   TWACFL                                                   00657000
TWACFL4  EQU   TWACFL                                                   00658000
TWACFL2  EQU   TWACFL                                                   00659000
TWACFL1  EQU   TWACFL                                                   00660000
@NM00015 EQU   TWAUFL                                                   00661000
TWAUFL4  EQU   TWAUFL                                                   00662000
TWAUFL3  EQU   TWAUFL                                                   00663000
TWAUFL2  EQU   TWAUFL                                                   00664000
TWAUFL1  EQU   TWAUFL                                                   00665000
@NM00014 EQU   TWAVFL                                                   00666000
TWAVFL6  EQU   TWAVFL                                                   00667000
TWAVFL5  EQU   TWAVFL                                                   00668000
TWAVFL4  EQU   TWAVFL                                                   00669000
TWAVFL3  EQU   TWAVFL                                                   00670000
TWAVFL2  EQU   TWAVFL                                                   00671000
TWAVFL1  EQU   TWAVFL                                                   00672000
@NM00013 EQU   TWAMFL                                                   00673000
TWAMFL1  EQU   TWAMFL                                                   00674000
TWACCOMP EQU   TWAR+76                                                  00675000
TWAUCOMP EQU   TWAR+72                                                  00676000
TWAVCOMP EQU   TWAR+68                                                  00677000
TWAMECB  EQU   TWAR+64                                                  00678000
TWACTCB  EQU   TWAR+60                                                  00679000
TWAUTCB  EQU   TWAR+56                                                  00680000
TWAVTCB  EQU   TWAR+52                                                  00681000
TWADEQAS EQU   TWAR+44                                                  00682000
TWAEESR  EQU   TWAR+40                                                  00683000
TWAPPSR  EQU   TWAR+36                                                  00684000
TWATCSR  EQU   TWAR+32                                                  00685000
TWATTSR  EQU   TWAR+28                                                  00686000
TWAINIT  EQU   TWAR+24                                                  00687000
TWACSCB  EQU   TWAR+16                                                  00688000
TWAASCB  EQU   TWAR+12                                                  00689000
TWAPASQH EQU   TWAR+8                                                   00690000
TWARSON  EQU   TWAR+2                                                   00691000
TWACOMP  EQU   TWAR                                                     00692000
TCASTEND EQU   TCAST+136                                                00693000
TCASDUMP EQU   TCAST+132                                                00694000
TCASSCHD EQU   TCAST+128                                                00695000
TCASTPND EQU   TCAST+124                                                00696000
TCASOMJR EQU   TCAST+120                                                00697000
@NM00012 EQU   TCAST+118                                                00698000
TCASBR14 EQU   TCAST+116                                                00699000
TCASATTN EQU   TCAST+112                                                00700000
TCASASCI EQU   TCAST+108                                                00701000
TCASTTQH EQU   TCAST+104                                                00702000
@NM00011 EQU   TCAST+102                                                00703000
@NM00010 EQU   TCAST+100                                                00704000
@NM00009 EQU   TCAST+98                                                 00705000
@NM00008 EQU   TCAST+96                                                 00706000
TCASASCB EQU   TCAST+92                                                 00707000
@NM00007 EQU   TCAST+90                                                 00708000
@NM00006 EQU   TCASFLG2                                                 00709000
@NM00005 EQU   TCASFLG1                                                 00710000
TCASNACT EQU   TCASFLG1                                                 00711000
TCASVSD  EQU   TCASFLG1                                                 00712000
TCASABND EQU   TCASFLG1                                                 00713000
TCASMDSW EQU   TCASFLG1                                                 00714000
TCASBKMD EQU   TCASFLG1                                                 00715000
TCASLTE  EQU   TCAST+84                                                 00716000
TCASEXIT EQU   TCAST+80                                                 00717000
TCASOQM  EQU   TCAST+76                                                 00718000
TCASIQM  EQU   TCAST+72                                                 00719000
TCASTSB  EQU   TCAST+68                                                 00720000
TCASTTL  EQU   TCAST+64                                                 00721000
TCASWA   EQU   TCAST+60                                                 00722000
TCASFRR  EQU   TCAST+56                                                 00723000
TCASMSGS EQU   TCAST+52                                                 00724000
TCASDATO EQU   TCAST+48                                                 00725000
TCASDATI EQU   TCAST+44                                                 00726000
TCASXECB EQU   TCAST+40                                                 00727000
TCASTID  EQU   TCAST+32                                                 00728000
@NM00004 EQU   TCAST+31                                                 00729000
TCASCHNL EQU   TCAST+30                                                 00730000
TCASCRSZ EQU   TCAST+28                                                 00731000
TCASLBUF EQU   TCAST+24                                                 00732000
TCASHBUF EQU   TCAST+20                                                 00733000
TCASCLSZ EQU   TCAST+18                                                 00734000
TCASRCON EQU   TCAST+16                                                 00735000
TCASACBP EQU   TCAST+8                                                  00736000
TCASUMAX EQU   TCASUSER+2                                               00737000
TCASID   EQU   TCAST                                                    00738000
WEDATA   EQU   WESTD+12                                                 00739000
WERC1    EQU   WERC                                                     00740000
.@UNREFD ANOP                          END UNREFERENCED COMPONENTS      00741000
@RC00070 EQU   @EL00002                                                 00742000
@RT00142 EQU   @EL00003                                                 00743000
@ENDDATA EQU   *                                                        00744000
         END   IKTCAS41,(C'PLS2244',0701,78045)                         00745000
