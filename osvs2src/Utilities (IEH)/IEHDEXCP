         COPY  LCGASMSW                                                 00100000
IEHDEXCP CSECT                                                          00102021
*                                                                       00104440
*C 111500,277000,759000             @SA75596=@XA10959=@YA11189=@ZA06532 00105940
*A 169800-169840,275500-276500,     @SA75596=@XA10959=@YA11189=@ZA06532 00107940
*A 751500                           @SA75596=@XA10959=@YA11189=@ZA06532 00110540
*                                                                       00110840
*C 111500,122748,122757             @YA10573=@SA75577=@XA10923=@ZA04436 00114740
*                                                                       00118640
*C 111500                           @SA74482=@YA10558=@XA10391=@ZA04427 00122540
*A 731720-731760                    @SA74482=@YA10558=@XA10391=@ZA04427 00126440
*                                                                       00130340
*C 111500                           @YA09679=@SA74485=@XA10384=@ZA04411 00134240
*A 122344                           @YA09679=@SA74485=@XA10384=@ZA04411 00138140
*                                                                       00142040
*C 124032                           @XA08872=@SA74445=@YA08050=@ZA03364 00145940
*A 111400-111600,124032,124120,     @XA08872=@SA74445=@YA08050=@ZA03364 00149840
*A 124124                           @XA08872=@SA74445=@YA08050=@ZA03364 00153740
*                                                                       00157600
*D 122320,122620,122640,161456      @SA73402=@YA06584=@XA07254=@ZA01677 00161500
*C 122340,122740,124090,124190      @SA73402=@YA06584=@XA07254=@ZA01677 00165400
*C 161440                           @SA73402=@YA06584=@XA07254=@ZA01677 00169300
*A 122744-122805,124058             @SA73402=@YA06584=@XA07254=@ZA01677 00173200
*A 124136-124183,124203-124207      @SA73402=@YA06584=@XA07254=@ZA01677 00177100
*A 124244-124245,161436             @SA73402=@YA06584=@XA07254=@ZA01677 00181000
*A 161444-161452,826500-826592      @SA73402=@YA06584=@XA07254=@ZA01677 00184900
*A 845100-845480                    @SA73402=@YA06584=@XA07254=@ZA01677 00188800
*                                                                       00192700
*C 576660,589660,734040             @SA69914=@YA04806=@XA05792=@ZA01201 00196600
*A 733520,733540                    @SA69914=@YA04806=@XA05792=@ZA01201 00200500
* D148000-149000,144500-145500                                   YM0959 00204400
*158000,80100                                                    4073   00208300
*        RELEASE 23 DELETIONS                                         * 00212220
*        RELEASE 22 DELETIONS                                         * 00216120
*        RELEASE 21 DELETIONS                                         * 00220020
*A161404                                              VS08480 = OZ00607 00220402
*569760-575160,581160-667560,795500-796500   SA65560 = OX2864 = OY2654  00222003
*                         PTM XM0208 IS ANSWERED UNDER OS APAR SA53223  00230002
*                                               XM4417=YA03005=SA67332  00232003
*           PTM 5476 IS FLAGGED AS SA67332                      XM5476  00234003
*1310161700                                                      A42498 00240021
*        RELEASE 20 DELETIONS                                         * 00260020
*0900447050,447070,773900                                        M6419  00265020
*0900478600-478800                                               M5599  00270020
*0900478600-478800,795000                                        A37209 00290020
*0900622630-622670,622680-622820,668950                          A21395 00328020
*0900564070,564750                                               A31314 00338020
*0900564070                                                      M0025  00343020
*0900                                                            S20201 00348020
* APAR 38132 IS FIXED IN THIS MODULE AS OF RELE 19.6            A38132  00348320
*        RELEASE 19 DELETIONS                                           00348720
*2276380000                                                      A29477 00349420
*2276661900-666200,671200-723200,897000-905000                   M4513  00350120
*2276669150-669180                                               A29172 00350820
*177000-179800,564160-564840,585600-585800                       7042   00351520
*076200,731800-732700,734500                                     O122   00352220
*175000                                                          7343   00352920
*607430                                                          6057   00353620
*        RELEASE 18 DELETIONS                                           00354320
*3411563000,569000,578200-578700                                 3651   00355020
*3411428380                                                      2920   00355720
*3411669150-669250,669600                                        2319   00356420
*3411622630                                                      1326   00357120
*STATUS CHANGE LEVEL 005                                                00377121
*                                                                     * 00400016
*FUNCTION/OPERATION- THIS ROUTINE HANDLES SOME OF THE I/O FOR THE     * 00500002
*   DUMP FUNCTION OF THE IEHDASDR UTILITY PROGRAM. ALL I/O INVOLVED   * 00600016
*   WITH DA AND/OR TAPE DEVICES IS AT THE EXCP LEVEL. THE FIRST       * 00700016
*   I/O OPERATION ON THE DIRECT ACCESS DEVICE RESULTS IN THE END OF   * 00800016
*   EXTENT APPENDAGE(IGG019P8) BEING ENTERED FROM IOS. THIS ROUTINE   * 00900016
*   WILL MODIFY THE DEB EXTENTS AND SET THE CORRECT FILE MASK.        * 01000016
*   PROCESSING WILL BE DONE ONE TRACK AT A TIME UNTIL EITHER THE      * 01100016
*   DUMP LIMITS OR THE VOLUME LIMITS ARE EXHAUSTED. CONTROL WILL BE   * 01200016
*   RETURNED TO -IEHDDUMP- AT THIS TIME.                              * 01300016
*   MOST OF THE I/O WILL BE HANDLED BY IEHDDOIO MODULE, WHICH   SA53223 01350002
*   WAS CREATED AS A RESULT OF SPLITTING IEHDEXCP FOR VS1/2.    SA53223 01360002
*                                                                     * 01400016
*ENTRY POINTS- THE ONLY ENTRY POINT IS -IEHDEXCP-, AND CONTROL IS     * 01500016
*   ALWAYS RECEIVED FROM THE -IEHDDUMP- ROUTINE.                      * 01600016
*                                                                     * 01700016
*INPUT- POINTERS TO A WORKAREA(REGISTER 12) AND TO A CONTROL BLOCK    * 01800016
*   (REGISTER 10).                                                    * 01900016
*                                                                     * 02000016
*OUTPUT TO DIRECT ACCESS- A COPY OF THE -FROM- DIRECT ACCESS          * 02100016
*   DEVICE WITH PREVIOUSLY UNOWNED TRACKS CLEANED UP.                 * 02200016
*                                                                     * 02300016
*OUTPUT TO TAPE-                                                      * 02400016
*   LIMITS RECORD- ALWAYS THE FIRST RECORD AFTER A TAPE MARK ON       * 02500016
*   EACH VOLUME OF TAPE. THIS RECORD IS 24 BYTES IN LENGTH AND        * 02600016
*   CONTAINS THE FOLLOWING INFORMATION.                               * 02700016
*                                                                     * 02800016
*        BYTES 0-3    CCHH OF THE FIRST TRACK DUMPED.                 * 02900016
*        BYTES 4-7    CCHH+1 OF THE LAST TRACK DUMPED.                * 03000016
*        BYTES 8-11   CCHH OF THE FIRST TRACK THIS VOLUME.            * 03100016
*        BYTES 12-19  CODE THAT IDENTIFIES THIS AS BEING A            * 03200016
*                     RESTORE TAPE.                                   * 03300016
*        BYTE  20     FULL DUMP SWITCH -X'F0'=FULL,X'00'=PARTIAL.     * 03400016
*        BYTE  21     DEVICE TYPE CODE AS FOLLOWS.                    * 03500016
*                        CODE 0    2321                               * 03600016
*                             1    2311                               * 03700016
*                             2    2314                               * 03800016
*                             3    2302                               * 03900016
*                             4    2303                               * 04000016
*                             5    2301                               * 04100016
*        BYTES 22-23  UNUSED.                                         * 04200016
*                                                                     * 04300016
*   CONTROL RECORD- THIS RECORD IS WRITTEN FOR EACH TRACK DUMPED      * 04400016
*   AND IMMEDIATELY PRECEDES THE DATA RECORD FOR EACH TRACK. IT       * 04500016
*   CONTAINS A CHANNEL PROGRAM USED BY RESTORE TO WRITE ONE TRACK.    * 04600016
*   THE LENGTH OF THIS RECORD DEPENDS ON THE NUMBER OF RECORDS ON     * 04700016
*   THE DUMPED TRACK.                                                 * 04800016
*                                                                     * 04900017
*   TRACK IMAGE RECORD- THIS RECORD CONTAINS THE DATA DUMPED FROM     * 05000017
*   A TRACK AND ALWAYS FOLLOWS A CONTROL RECORD.  IT IS WRITTEN AS    * 05100016
*   ONE MAXIMUM LENGTH PHYSICAL RECORD ON TAPE. IT CONTAINS THE       * 05200016
*   DATA FIELD OF RECORD ZERO AND ALL FIELDS OF OTHER RECORDS THAT    * 05300016
*   WERE ON THE TRACK THAT WAS DUMPED.                                * 05400016
*                                                                     * 05500016
*   TRAILER RECORD- THIS ALWAYS FOLLOWS THE TAPE MARK THAT WAS AT     * 05600016
*   THE END OF THE LAST TRACK IMAGE RECORD. IT IS 24 BYTES IN         * 05700016
*   LENGTH, OF WHICH ONLY THE FIRST 4 BYTES ARE USED. IT INDICATES    * 05800016
*   WHETHER THE RESTORE IS COMPLETE WHEN THE END OF THIS VOLUME       * 05900016
*   IS REACHED.                                                       * 06000016
*                                                                     * 06100016
*EXITS-NORMAL- SUCCESSFUL COMPLETION OF ALL I/O OPERATIONS RESULTS    * 06200016
*   IN A RETURN TO -IEHDDUMP- WITH A RETURN CODE OF ZERO.             * 06300016
*                                                                     * 06400016
*EXITS-ERROR-  ANY ERROR ENCOUNTERED WILL BE DESCRIBED BY AN          * 06500016
*   APPROPRIATE MESSAGE TO THE MESSAGE DATA SET. A RETURN CODE        * 06600016
*   GREATER THAN ZERO WILL ALSO BE PASSED TO -IEHDDUMP-.              * 06700016
*                                                                     * 06800016
*EXTERNAL ROUTINES- THIS ROUTINE IS ALWAYS ENTERED FROM -IEHDDUMP-.   * 06900016
*   FIVE OTHER CSECTS ARE USED BY THE ROUTINE. ANY MESSAGES WILL      * 07000016
*   BE WRITTEN OUT BY THE MESSAGE WRITER ROUTINE(IEHDPRNT) AFTER      * 07100016
*   BEING SET UP BY THE MESSAGE ROUTINE(IEHDMSGB). THE END OF         * 07200016
*   EXTENT APPENDAGE(IGG019P8) HANDLES THE LIMITS AND EXTENTS IN      * 07300016
*   THE DEB FOR ALL DA DEVICES INVOLVED. ALL DEVICE DEPENDENT         * 07400016
*   CONSTANTS WILL BE CONTAINED IN THE -IEHDCONS- CSECT. IEHDEXCP     * 07500016
*   WILL LOAD BOTH -IEHDAOUT- AND -IEHDPRNT- WHEN DUMPING TO A        * 07560016
*  SYSTEM OUTPUT DEVICE.  IEHDRCVR WILL BE LINKED TO WHEN AN I/O   O122 07590019
*  ERROR (MISSING ADDRESS MARKER OR DATA CHECK) ARE ENCOUNTERED    O122 07620019
*  WHEN DUMPING TO SYSOUT.                                         O122 07650019
*                                                                     * 07700016
*ATTRIBUTES- SERIALLY REUSABLE, RELOCATABLE, NON-PRIVILEGED.          * 07730016
*                                                                     * 07760016
 TITLE 'IEHDEXCP-2ND CSECT OF IEHDDUMP-IEHDASDR SYSTEM UTILITY PROGRAM' 07860016
*   THE FOLLOWING ARE REGISTER ASSIGNMENTS.                             08000016
GR0      EQU   0                                                        08100016
GR1      EQU   1                                                        08200016
GR2      EQU   2                                                        08300016
GR3      EQU   3                                                        08400016
GR4      EQU   4                                                        08500016
GR5      EQU   5                                                        08600016
GR6      EQU   6                                                        08700016
GR7      EQU   7                                                        08800016
GR8      EQU   8                                                        08900016
GR9      EQU   9                                                        09000016
GR10     EQU   10                                                       09100016
GR11     EQU   11                                                       09200016
GR12     EQU   12                                                       09300016
GR13     EQU   13                                                       09400016
GR14     EQU   14                                                       09500016
GR15     EQU   15                                                       09600016
RCVT     EQU   9                                                        09700016
UCBPTR   EQU   9                                                        09800016
BASEREG  EQU   11                                                       09900016
WORKBASE EQU   12                                                       10000016
         SPACE 2                                                        10100016
         USING FUNCBLK,10                                               10200016
         USING IEHDEXCP,BASEREG                                         10300016
         USING WORK,12                                                  10400016
         SAVE  (14,12),T,*             SAVE THE REGISTERS.              10600016
         LR    BASEREG,GR15            LOAD THE BASE REGISTER.          10700016
         LA    GR7,EXCPSAVE            SAVE AREA ADDRESS.               10800016
         ST    GR7,8(GR13)             ADDRESS OF NEW AREA TO OLD.      10900016
         ST    GR13,4(GR7)             ADDRESS OF OLD AREA TO NEW.      11000016
         LR    GR13,GR7                SAVE AREA FOR CALLED ROUTINES.   11100016
         USING IOBLOCKS,9                                               11130016
         B     APARNO                  BRANCH AROUND APAR NO   @ZA03364 11140040
         DC    C'OZ06532'              LAST APAR FIXED IN MOD  @ZA06532 11150040
APARNO   LA    GR9,BLOCKS              ADR PRIMARY I/O BLOCKS. @ZA03364 11160040
         L     GR3,PTRCFUNC            POINTER TO CURRENT FUNCTION.     11300016
         TM    0(GR3),PROCESS          PREVIOUSLY UNDER WAY.            11400016
         BZ    FORMAT5                 NO--START FROM THE BEGINNING.    11500002
         B     RDCNTS                   RETURN TO IEHDDOIO      SA53223 11600002
         EJECT                                                          11710016
*********************************************************************** 11900002
*        THIS SECTION WILL READ IN THE FORMAT 4 DSCB TO DETERMINE     * 11950002
*        IF THE I/P DEVICE IS A DOS PACK. IF IT IS, THE 'DUMPALL'     * 12010002
*        SWITCH WILL BE SET. IF IT IS NOT A DOS                       * 12060002
*        PACK, THE FORMAT5 DSCB WILL READ IN . ALL AVAILABLE          * 12100002
*        EXTENTS WILL BE CONVERTED FROM RTA TO MBBCCHHR, USING        * 12150002
*        THE CVT CONVERT ROUTINE. THE CONVERTED EXTENTS WILL BE       * 12200002
*        STORED IN THE FORMAT5 TABLE FOR LATER USE DETERMINING        * 12202002
*        IF AN INDIVIDUAL TRACK IS OWNED AND THUS IF THIS TRACK       * 12204002
*        SHOULD BE DUMPED.                                            * 12206002
**********************************************************************  12208002
         USING IHADCB,GR8                                               12210002
         USING IOBLOCKS,GR9                                             12212002
FORMAT5  CLI   DEVSW,X'F0'             DUMPING TO SYSOUT.               12214002
         BE    START                   YES--DO NOT PROCESS FORMAT5      12216002
         LA    GR8,OUTDCB              ADDRESS OF DCB.                  12218002
         L     GR1,DCBDEBAD            ADDRESS OF DEB.                  12220002
         MVC   OUTSEEK+3(4),38(GR1)    CCHH OF VTOC TO IOB.             12222002
         AIF   ('&LIB' EQ 'LIB1').NOTIME BRCH IF OS ASSEM        Y02113 12224002
         MVC   TIMESTMP(L4),D38(GR1)    SAVE CCHH OF F4 DSCB     Y02113 12226002
.NOTIME  ANOP                                                    Y02113 12228002
         MVI   R,R1                     SET REC NO. FOR F4 DSCB SA58744 12230002
RDF4     EQU  *                                                @ZA01677 12234002
         MVI   RDVTOC,X'FF'            INDICATE VTOC JUST READ @ZA04411 12234440
         LA    GR3,OUTSEEK+3           SEARCH ADDRESS.                  12236002
         ST    GR3,READVTOC            SEARCH ADDRESS TO SEARCH CCW.    12238002
         MVI   READVTOC,X'31'          RESET OP CODE.                   12240002
         LA    GR3,READVTOC            CCW ADDRESS OF RD FORMAT5 CCW.   12242002
         ST    GR3,OUTCCWAD            SET CCW ADDRESS IN IOB.          12244002
         L     GR3,FORM5FPT            ADDRESS OF BUFFER.               12246002
         LA    GR3,D84(GR3)            INCREMENT INTO BUFFER            12248002
         ST    GR3,RDVDATA             STORE ADDRESS IN READ KD CCW.    12250002
         MVI   RDVDATA,X'0E'           RESET OP CODE.                   12252002
         EXCP  OUTIOB                  READ IN FORMAT5 DSCB TO BUFFER.  12254002
         WAIT  ECB=OUTECB              AWAIT COMPLETION                 12256002
         CLI   OUTECB,GOOD             ALL OK                           12258002
         BNE   IOERR                   NO-ERROR                         12260002
         MVI   R,R2                    RESET SEEK ARGU FOR F5   SA58744 12266002
         LA    GR7,START               SET 1ST TIME THRU SWT    SA58744 12268002
         TM    D58(GR3),CONTAM+VTOCERR FMT 5 BAD ?                      12270002
         BNZ   NOCOND                  YES, DONOT READ F5      @ZA03364 12272040
         MVC   F5CCHHR(5),OUTSEEK+3    CCHHR OF FIRST F5 DSCB  @ZA01677 12274002
*                                      TO CAMLST (OBTAIN)      @ZA01677 12274402
OBTF5    L     GR3,FUCBPTR             PTR TO FROM UCB         @ZA04436 12274840
         MVC   FRVOL(6),28(GR3)        FROM VOLSER TO CAMLST   @ZA01677 12275202
         USING F5BUF,GR8               F5BUF DSECT             @ZA01677 12275602
         L     GR8,FORM5FPT            PT TO F5BUF             @ZA04436 12275740
         LA    GR3,DS5KEYID            PTR TO F5 DSCB          @ZA01677 12275802
         ST    GR3,F5DSCB+12           READ IN ADR CAMLST      @ZA01677 12275902
         OBTAIN F5DSCB                 OBTAIN F5 DSCB          @ZA01677 12276002
         LTR   GR15,GR15               SUCCESFUL OBTAIN        @ZA01677 12278502
         BNZ   SETFLG                  NO, WRITE MSG 817       @ZA01677 12280502
CONVRT   EQU   *                                                SA58744 12286802
         USING CVT,GR8                                                  12289402
         USING CONSTANT,GR9                                             12292002
         L     GR8,CVTPTR              ADDRESS COMM. VECTOR TABLE.      12294602
         L     GR9,IODEVCON            ADDRESS FOR DEVICE CONSTANTS.    12297202
         L     GR15,CVTPCNVT           ADDRESS CVT CONVERT ROUTINE.     12299802
         DROP  8                                                        12302402
         LA    GR2,D140(GR3)           ADDRESS FOR CONVERTED RTA.       12305002
         MVC   44(90,GR3),45(GR3)      MAKE EXTENTS CONTIGUOUS.         12307602
         MVC   151(5,GR3),135(GR3)     SAVE NEXT F5 PTR                 12310202
         MVC   134(4,GR3),ZERO         ZERO END OF EXTENTS FIELD.       12312802
         BCTR  GR3,0                   DECREMENT PTR. FOR LATER USE.    12315402
         MVC   DUMPWORK(4),ZERO        CLEAR OUT WORK AREA.             12318002
         L     GR1,CNTBUFPT            ADDRESS OF DUMMY DEB.            12320602
         MVI   16(GR1),1               SET FOR ONE EXTENT.              12323202
         L     GR8,FUCBPTR             UCB PTR. FOR 'FROM' DEVICE.      12325802
         EJECT                                                          12328402
FORMAT5A ST    GR8,32(GR1)             UCB PTR. TO DUMMY DEB.           12331002
         MVC   38(4,GR1),ZERO          ZERO FOR LOWER LIMITS.           12333602
         MVI   42(GR1),X'FF'           SET 'FFFF' FOR UPPER             12336202
         MVC   43(5,GR1),42(GR1)         LIMITS IN DEB.                 12338802
         MVI   46(GR1),X'7F'           NUMBER TRKS/EXTENT.              12341402
         L     GR8,FORM5FPT            ADDR. FORMAT5 EXTENTS TABLE.     12344002
         SPACE                                                          12346602
*  INITIALIZATION OF REGISTER COMPLETE. START CONVERTING RTA TO CCHH.   12349202
*              REGISTER 1- ADDRESS OF THE DUMMY DEB.                    12351802
*              REGISTER 2- ADDRESS FOR CONVERTED RTA.                   12354402
*              REGISTER 3- ADDRESS OF READ-IN FORMAT5 DSCB.             12357002
*              REGISTER 4- TRKS PER CYL THIS DEVICE.                    12359602
*              REGISTER 8- ADDR NEXT AVAILABLE SLOT IN FORMAT5 TABLE.   12362202
         SPACE                                                          12364802
NEXTRTA  LH    GR4,TRKCYL              TRKS/CYLINDER THIS DEVICE.       12367402
         LA    GR6,1                   FOR INNER LOOP.                  12370002
         LA    GR3,5(GR3)              INCREMENT EXTENT POINTER.        12372602
         MVC   DUMPWORK(2),0(GR3)      MOVE IN BEGINNING RTA THIS EXT.  12375202
         L     GR0,DUMPWORK            PRIME REGISTER 0 FOR CONVERT RTN 12377802
         LTR   GR0,GR0                 END OF EXTENTS.                  12380402
         BZ    LASTRTA                 YES--GO TO SET END OF TABLE.     12383002
CONVERT  LR    GR5,GR13                SAVE REGISTER THIRTEEN.          12385602
         STM   14,12,12(13)            SAVE THE REGISTERS.              12388202
         BALR  GR14,GR15               GO TO CONVERT RTA TO MBBCCHHR.   12390802
         LTR   GR15,GR15               SUCCESSFUL RETURN.               12393402
         LR    GR13,GR5                RESTORE REGISTER THIRTEEN.       12396002
         LM    14,12,12(GR13)          RESTORE ALL THE REGISTERS.       12398602
         BZ    OKEND                   GOOD RETURN-CONTINUE PROCESSING. 12401202
NOCOND   MVI   DOUBLE+4,X'FF'          NOT WRITE COND= IN MSG  @ZA03364 12403240
SETFLG   EQU   *                                                SA58744 12403802
         ST    GR15,DOUBLE             SAVE COND CODE          @ZA01677 12405802
         LA    GR1,17                  INVALID FORMAT5 EXTENT.          12406402
         BAL   GR4,SETUPMSG            SET UP THIS MESSAGE.    @ZA01677 12409002
         MVC   0(8,GR1),DDNAME1        DDNAME TO MESSAGE.               12411602
         TM    DOUBLE+4,X'FF'          WRITE COND= ?           @ZA03364 12412040
         BO    IGNOREF5                NO THEN BRANCH          @ZA03364 12412440
         LA    GR1,8(GR1)              PT AFTER THE DNAME=XXXX @ZA01677 12413602
         MVC   0(5,GR1),COND           MOVE COND= TO MSG       @ZA01677 12414002
         LA    GR1,5(GR1)              PT AFTER COND=          @ZA01677 12414102
         L     GR15,DOUBLE             RELOAD COND CODE        @ZA01677 12414502
         MVI   DOUBLE,X'00'            CLEAR CONVERT AREA      @ZA01677 12414702
         MVC   DOUBLE+1(7),DOUBLE                              @ZA01677 12415102
         CVD   GR15,DOUBLE             CONVERT COND CODE (DEC) @ZA01677 12415502
         UNPK  0(3,GR1),DOUBLE+6(2)    UNPACK COND CODE        @ZA01677 12415902
         OI    2(GR1),X'F0'            SET CORRECT SIGN        @ZA01677 12416402
         MVI   BADCOND,X'00'           CLEAR SWITCH            @ZA01677 12416802
         S     GR15,FOUR               COND CODE = 4?          @ZA01677 12417202
         BZ    TERM                    YES,BRANCH              @ZA01677 12417302
         S     GR15,EIGHT              COND CODE = 12?         @ZA01677 12417402
         BNZ   IGNOREF5                NO,BRANCH               @ZA01677 12417902
TERM     MVI   BADCOND,X'FF'           INDICATE TERMINATE      @ZA01677 12418302
IGNOREF5 BAL   GR4,MSGWRT              WRITE OUT THIS MESSAGE. @ZA01677 12419002
         TM    BADCOND,X'FF'           TERMINATE? (C/C=4/12)   @ZA01677 12420302
         BO    SETCOND                 YES,BRANCH              @ZA01677 12420702
         MVI   RCODE,X'FF'             SET SWITCH FOR RETURN CODE 4.    12422202
         OI    SWITCH,DUMPALL          SET SWITCH TO DUMP ALL TRKS.     12423102
         BR    GR7                     START DUMP I/O FUNCTIONS.        12424002
SETCOND  LA    GR15,8                  SET CON CODE = 8 RETURN @ZA01677 12424402
         B     FINALR3                 TERMINATE THIS FUNCTION @ZA01677 12424502
         EJECT                                                          12424602
OKEND    MVC   0(4,GR8),3(GR2)         MOVE CCHH TO FORMAT5 TABLE.      12427202
         LA    GR8,4(GR8)              INCREMENT FORMAT5 TABLE PTR.     12429802
         MVC   DUMPWORK(4),ZERO        CLEAR OUT WORK AREA.             12432402
         BCT   GR6,NEXTRTA             TAKE BRANCH IF SWITCH IS SET.    12435002
         MVC   DUMPWORK+2(2),0(GR3)      MOVE IN BEGINNING RTA.         12437602
         L     GR0,DUMPWORK            PRIME REGISTER 0 FOR CONVERT RTN 12440202
         MVC   DUMPWORK(4),ZERO        CLEAR OUT WORK AREA.             12442802
         MVC   DUMPWORK+2(2),2(GR3)    MOVE NO OF FULL CYL THIS EXTENT  12445402
         L     GR5,DUMPWORK            PRIME REGISTER FOR MULTIPLY.     12448002
         MR    GR4,GR4                 COMPUTE TOTAL TRACKS.            12450602
         IC    GR4,4(GR3)              ADDITIONAL TRACKS THIS EXTENT.   12453202
         AR    GR4,GR5                 TOTAL ADDITIONAL TRACKS.         12455802
         AR    GR0,GR4                 END RTA THIS EXTENT.             12458402
         BCTR  GR0,0                   DECREMENT NO. OF ADDITIONAL TRKS 12461002
         SLL   GR0,16                  LEFT JUSTIFY FOR CONVERT RTN.    12463602
         LA    GR6,2                   SET UP INNER LOOP CONTROL.       12466202
         MVC   DUMPWORK(4),ZERO        CLEAR OUT WORK AREA.             12468802
         B     CONVERT                 GO TO CONVERT ENDING RTA.        12471402
LASTRTA  MVI   0(GR8),X'FF'            SET END OF TABLE POINTER.        12474002
         BR    GR7                     CONTINUE                         12476602
         EJECT                                                          12479202
         USING IOBLOCKS,9                                               12481802
START    LA    GR9,BLOCKS              ADDRESS PRIMARY I/O BLOCKS.      12484402
         L     GR3,PTRCFUNC            POINTER TO CURRENT FUNCTION.     12487002
         OI    0(GR3),PROCESS          SET SWITCH FOR NOW PROCESSING.   12489602
         MVC   TOSEEK+3(4),CCHHONE     MOVE IN THE                      12492202
         MVC   CCHH(4),CCHHONE              TRACK TO BE DUMPED.         12494802
         MVI   OUTSEEK+3,X'FF'         SET 'CC' OF CCHH FOR APPENDAGE.  12497402
         CLI   DEVSW,X'F0'             DUMPING TO SYSOUT.               12500002
         BNE   BUILDCNT                       NO-- GO BEGIN PROCESSING  12506002
         LOAD  EP=IEHDAOUT             LOAD -IEHDAOUT- INTO CORE.       12512002
         ST    GR0,DAOUTADR            SAVE ENTRY POINT.                12518002
         LOAD  EP=IEHDPRNT             LOAD -IEHDPRNT- INTO CORE.       12524002
         ST    GR0,PRNTADR             SAVE ENTRY POINT.                12530002
         EJECT                                                          12536002
*********************************************************************** 12542002
*                                                                     * 12548002
*  THIS SECTION WILL BUILD THE READ COUNT CCWS. MAXIMUM NUMBER OF     * 12554002
*  CCWS IS DETERMINED BY THE MAXIMUM NUMBERS OF RECORDS POSSIBLE PER  * 12560002
*  TRACK THIS DEVICE. THESE WILL BE EXECUTED WITH THE ENTIRE          * 12566002
*  CHANNEL PROGRAM BEING RESTARTED IF RECORD ONE IS AN EOF. GOOD      * 12572002
*  RETURNS FROM THE WAIT WILL BE FILE PROTECT OR TRACK CONDITION.     * 12578002
*  POSSIBLY IN COMBINATION WITH OVERFLOW INCOMPLETE.                  * 12584002
*                                                                     * 12590002
*********************************************************************** 12600002
BUILDCNT L     GR2,CCWBUFPT            GET POINTER TO CCW BUFFER.       12620002
         USING CCWS,2                                                   12640002
         USING IOBLOCKS,GR9                                             12660002
         LA    GR9,BLOCKS          ADDRESS PRIMARY I/O BLOCKS.          12680002
         ST    GR2,OUTCCWAD            CCW ADDRESS TO IOB.              12700016
         TM    SEQSW,RPSFEAT1      FROM DEVICE HAVE RPS          S20201 12706020
         BZ    GO                  NO                            S20201 12712020
         LR    GR4,GR2             PUT BUFF PTR IN WORK REG      S20201 12718020
         SH    GR4,SIXTEEN         PT TO RPS BUFR                S20201 12724020
         ST    GR4,OUTCCWAD        ST PTR IN IOB                 S20201 12730020
         ST    GR2,D8(GR4)         SET UP TIC ADDR               S20201 12736020
         MVI   D8(GR4),TICCODE     RESET TIC OP                  S20201 12742020
GO       EQU   *                        *                        S20201 12748020
         MVI   AOUTSW,FMTTRK           SWITCH TO FORMAT TRACK      O122 12760019
         MVI   RECNUM,X'00'            INITIALIZE FOR NEW TRACK    O122 12820019
         MVC   0(40,GR2),SEARIDEQ      MOVE IN 'DUMMY' CCWS.            12900016
         LA    GR4,OUTSEEK+3           SEARCH ADDRESS.                  13000016
         ST    GR4,SEIDEQR0            STORE INTO CCW.                  13100016
         MVI   0(GR2),X'31'            RESET OP CODE.                   13200016
* THIS SETS UP CORRECT ADDRESSES IN THE CCWS.                           13400016
         ST    GR2,TICBACKA            RESET TIC ADDRESS.               13500016
         MVI   TICBACKA,X'08'          RESET TIC OP CODE.               13600016
         L     GR4,DATBUFPT            POINT TO DATA BUFFER             13800016
         ST    GR4,TRACKPT             SAVE ADDRESS FOR IEHDAOUT   O122 13850019
         ST    GR4,RDWRDATA            STORE ADDRESS IN READ R0 CCW.    13900016
         MVI   RDWRDATA,X'06'          RESET OP CODE.                   14000016
         LA    GR4,8(GR4)              POINT 8 BEYOND ACTUAL BEGINNING. 14100016
         ST    GR4,RDWRTCKD            PUT POINTER IN CCW.              14200016
         MVI   RDWRTCKD,X'9E'          RESET RD CKD OP CODE.            14300016
         MVC   RDWRTCNT+1(3),CNTBUFPT+1  SET ADDR OF COUNT BUFF IN CCW. 14400016
         L     GR8,IODEVCON            PT TO DEVCONS             YM0959 14450000
         USING CONSTANT,GR8                                      YM0959 14500000
         MVC   RDWRTCKD+6(2),DATASIZE  SET BYTE COUNT            YM0959 14550000
         LM    GR4,GR5,32(GR2)         PICK UP DUMMY CCW.               14600016
         LA    GR6,8                   SET UP INCREMENTING FACTOR.      14700016
         LH    GR7,MAXREC              MAXIMUM RECS PER TRK THIS DEV.   15000016
         LA    GR3,RDWRTCNT            SET UP BEGINNING ADDRESS.        15100016
CREATCCW STM   GR4,GR5,0(GR3)          STORE 'DUMMY' CCW IN LIST.       15200016
         AR    GR4,GR6                 UPDATE COUNT BUFFER ADDRESS.     15500016
         AR    GR3,GR6                 INCREMENT CCW POINTER.           15600016
         BCT   GR7,CREATCCW            LOOP THRU UNTIL THRU.            15800016
         SR    GR3,GR6                 BACK UP ONE CCW           4074   15850000
         MVI   4(GR3),X'00'            TURN OFF CHAIN BIT        4074   15900000
         MVI   R,0                     SET SEARCH FOR RECORD ZERO.      16000016
         USING IOBLOCKS,9                                               16010016
TRKOWNED LA    GR9,BLOCKS              ADDRESS PRIMARY I/O BLOCKS.      16020016
         TM    SWITCH,DUMPALL          DUMPING ALL TRACKS THIS DEV.     16030016
         BO    RDCNTS                  YES--GO TO PROCESS FOR THIS TRK. 16040016
         LA    GR5,CCHHONE             CURRENT TRACK ADDRESS.           16050016
         L     GR4,FORM5FPT            PTR TO ENTRY IN FORMAT5 TABLE    16060016
TRKCHK   CLC   0(4,GR5),0(GR4)         CURRENT TRK > OR = LOWER LIMIT.  16070016
         BL    RDCNTS                  NO--LESS THAN--DUMP IT.          16080016
         CLC   4(4,GR4),LASTORIG       UPPER LIMIT=LAST PRIMARY TRK.    16084016
         BE    FINIS                   YES--ECONOMY RUN--GO TO FINISH.  16088016
         CLC   0(4,GR5),4(GR4)         CURRENT TRK < OR = UPPER LIMIT.  16096016
         BNH   WRTHAR0                 YES--DO NOT DUMP IT.             16100016
         LA    GR4,8(GR4)              BUMP TABLE PTR TO NEXT EXTENTS.  16110016
         ST    GR4,FORM5FPT            STORE TABLE PTR FOR FUTURE USE.  16120016
         CLI   0(GR4),X'FF'            END OF TABLE.                    16130016
         BNE   TRKCHK                  NO--GO CHECK NEXT EXTENTS.       16140016
         L     GR8,IODEVCON             RELOAD 'DCONS PTR       OZ00607 16140402
         L     GR3,DATBUFPT            PTR TO DATA BUFFER               16140802
         AH    GR3,DATASIZE            PT TO FORM5 AREA                 16141602
         CLC   235(5,GR3),ZERO         LAST FMT 5                       16142402
         BE    NOMORE                  YES                              16143202
         ST    GR3,FORM5FPT            PT TO HEAD OF AREA      @ZA01677 16143602
         MVC   F5CCHHR(5),235(GR3)     CCHHR OF 2:ND F5 DSCB   @ZA01677 16144002
*                                      TO CAMLST (OBTAIN)      @ZA01677 16144402
         BAL   GR7,OBTF5               DO OBTAIN OF 2-NN F5    @ZA01677 16144802
*                                      DSCB                    @ZA01677 16145202
         USING IOBLOCKS,GR9                                             16146402
         LA    GR9,BLOCKS              ADDR PRIMARY IO BLKS             16147202
         MVC   OUTSEEK+3(4),CONTROL+8  NEXT CCHH                        16148002
         MVI   R,0                     SET TO REC 0                     16148802
         L     GR2,CCWBUFPT            GET PTR TO CCW BUFR              16158002
         TM    SEQSW,RPSFEAT1          RPS ON FROM DEVICE               16163002
         BZ    OK                      NO                               16168002
         L     GR2,RPSBUFPT            YES-PT TO RPS BUFR               16173002
OK       ST    GR2,OUTCCWAD            STORE IN IOB                     16178002
         B     TRKOWNED                CONTINUE CHECK                   16183002
         DROP  8                                                        16188002
NOMORE   EQU   *                                                        16193002
         OI    SWITCH,DUMPALL          SET SWITCH TO DUMP REST OF TRKS  16198002
RDCNTS   EQU   *                                                        16203002
         MVI   BRCHVAL,RDCNTVAL         SET IEHDDOIO BRCH VALUE SA53223 16208002
RDCNTS1  EQU   *                                                SA53223 16258002
         CALL  IEHDDOIO                                         SA53223 16600002
         LA    GR3,BRCHTABL             GET BRCH TABLE ADDR     SA53223 16800002
         SR    GR2,GR2                  ZERO WORK REGISTER      SA53223 16810002
         IC    GR2,BRCHVAL              LOAD BRCH TABLE VALUE   SA53223 16850002
         AR    GR3,GR2                  COMPUTE BRCH TABL ENTRY SA53223 16900002
         BR    GR3                      BRCH TO TABLE ENTRY     SA53223 16950002
WRTHAR0  EQU   *                                                SA53223 16960002
         MVI   BRCHVAL,WRTHARO          SET IEHDDOIO BRCH VALUE SA53223 16970002
         CLI   RDVTOC,X'FF'            JUST READ VTOC?         @ZA06532 16980040
         BNE   RDCNTS1                 NO THEN BRANCH          @ZA06532 16982040
         MVI   RDVTOC,X'F0'            TO GET OK EXTENT IN DEB @ZA06532 16984040
         B     RDCNTS1                  GO CALL IEHDDOIO        SA53223 16990002
BRCHTABL EQU   *                                                SA53223 17000002
         B     PROC4                                            SA53223 17050002
         B     IOERR                                            SA53223 17100002
         B     IOTERR                                           SA53223 17150002
         B     OUT4                                             SA53223 17200002
         B     ISUMSG                                           SA53223 17250002
         B     FINIS                    NOT USED                SA53223 17300002
         B     FINAL3                                           SA53223 17350002
*        END OF BRCH TABLE.                                     SA53223 17580002
OUT4     BAL   GR14,UPCCHH             GO UPDATE THE TRACK ADDRESS.     27500016
         CLI   RDVTOC,X'F0'            TO P8 FIRST TIME        @ZA06532 27550040
         BNE   SKIPP8                  NO,THEN NO FF IN CCHH   @ZA06532 27600040
         MVI   OUTSEEK+3,X'FF'         SET 'CC' OF CCHH FOR P8 @ZA06532 27650040
SKIPP8   L     GR3,CCWBUFPT            ADDRESS READ COUNT CCWS @ZA06532 27700040
         MVI   24(GR3),X'9E'           RESET OP CODE IN CASE R1=EOF.    27800016
         NI    SWITCH,X'AF'            TURN OFF ALL BUT DUMP ALL TRKS.  27850016
         TM    DEVSW,X'F0'             DUMPING TO DA OR SYSOUT.   0811  27860017
         BO    TRKOWNED                YES-BRANCH.                0811  27870017
         L     GR1,TAPECCW4            POINT TO CCWS WRITTEN.     0811  27880017
         MVI   48(GR1),X'1D'           RESET OP CODE IN CASE T.O. 0811  27890017
         B     TRKOWNED                CONTINUE PROCESSING W/ NXT TRK.  27900016
         AIF   ('&LIB' EQ 'LIB1').VSAM01 BRCH IF OS ASSEM       Y02113  43050001
*        TIMESTAMP TEST MADE HERE                               Y02113  43070001
         TM    TIMESET,TIMECHK          HAS F4 DSCB BEEN UPD    Y02113  43080001
         BO    TIMEOK                   YES, DON'T CHK          Y02113  43090001
         CLC   OUTSEEK+D3(L4),TIMESTMP  IS THIS THE F4 DSCB     Y02113  43092001
         BNE   TIMEOK                   NO, DON'T SET CLOCK     Y02113  43094001
         STCK  CLOCK(GR2)               PUT TIMESTMP IN F4 DSCB Y02113  43096001
         OI    TIMESET,TIMECHK          SET CHECK SWITCH        Y02113  43098001
TIMEOK   EQU   *                                                Y02113  43098401
.VSAM01  ANOP                                                   Y02113  43098801
PROC4    BAL   GR14,UPCCHH             GO UPDATE THE TRACK ADDRESS.     44800016
         NI    SWITCH,X'AF'            TURN OFF ALL BUT DUMP ALL TRKS.  44900016
         OI    TOFLGS,X'42'            INDICATE CMD CHAINING.           44950016
         B     BUILDCNT                 GO PROCESS NEXT TRK             56466002
         EJECT                                                          56516002
*                                                                       56566002
*  WRITE TRAILER RECORD.                                                56616002
*                                                                       56666002
         SPACE                                                          56716002
TRAILER  L     GR5,CNTBUFPT            BUFFER POINTER.                  56766002
         ST    GR1,0(GR5)              ST TRAILER REC IN BUFFER.        56816002
         ST    GR5,TAPECCW5         DATA PTR TO WRITE CCW.              56866003
         LA    GR5,TAPECCW5            ADDRESS OF CCWS.                 56916002
         MVI   TAPECCW5,WRTAPE          RESET WRITE OP CODE.            56966003
WRTTRL   ST    GR5,TOCCWAD             CCW POINTER TO IOB.              57316002
VOLEXCP  EXCP  TOIOB                   EXECUTE CHANNEL PROGRAM.         57366002
         WAIT  ECB=TOECB               AWAIT COMPLETION.                57416002
         CLI   TOECB,GOOD              ALL OK.                          57466002
         BCR   8,GR2                   YES-RETURN.                      57516003
         TM    TOSTATUS+4,X'01'        UNIT EXCEPTION-EOV.              57566002
         BCR   1,GR2                   YES-THAT'S OK-RETURN.            57616003
         B     IOTERROR           ALL OTHER IS I/O ERROR       @ZA01201 57666002
YESEOV   EQU   *                                                        57716002
         LA    GR3,TODCB                LOAD DCB ADDRESS                57766002
         USING IHADCB,3                                                 57816002
         OI    DCBOFLGS,TAPMK           INSURE BIT 0 IS ON      SA21395 57866002
         EOV   TODCB                                                    57916002
         LA    GR2,CONTROL              GET ADDR OF HDR         OX2864  57926003
         ST    GR2,TAPECCW5             STORE IN TAPE CCW       OX2864  57936003
         MVI   TAPECCW5,WRTAPE          RESET OPECODE           OX2864  57946003
         L     GR2,CNTBUFPT            BUFFER ADDRESS.                  57966002
         ST    GR2,TOCCWAD             CCW PTR. TO IOB.            2319 58016002
         MVC   0(L8,GR2),TAPECCW5      CCWS TO WRITE CONTROL REC.       58066003
         EXCP  TOIOB                   WRITE CONTROL RECORD.            58766002
         WAIT  ECB=TOECB               NO---AWAIT COMPLETION.           58816002
         CLI   TOECB,GOOD              ALL OK.                          58866002
         BCR   8,GR4                   YES--RETURN.                     58916002
         B     IOTERROR                NO---I/O ERROR          @ZA01201 58966002
         EJECT                                                          62360016
*********************************************************************** 62400016
*                                                                     * 62500016
*   THE FOLLOWING ROUTINE UPDATES THE TRACK ADDRESS AND CHECKS        * 62600016
*   TO SEE IF THIS WAS THE LAST TRACK TO BE DUMPED.  IF NO,THE        * 62700016
*   ROUTINE WILL UPDATE THE EXTENTS IN THE DEB AND RETURN.  IF        * 62800016
*   THIS IS THE LAST TRACK, THE ROUTINE WILL BRANCH TO THE CLOSE      * 62900016
*   OUT ROUTINE.                                                      * 63000016
*                                                                     * 63100016
*   REGISTER 9 POINTS TO THE CORRECT IOBLOCK.                         * 63200016
*   REGISTER 14 IS THE RETURN REGISTER.                               * 63300016
*                                                                     * 63400016
*********************************************************************** 63500016
         USING IOBLOCKS,GR9                                             63700016
         USING CONSTANT,2                                               63800016
UPCCHH   L     GR2,IODEVCON            ADDRESSING FOR DEVICE CONSTANT.  63900016
         L     GR3,CONTROL+8           CURRENT CCHH ADDRESS.            64000016
         CLC   OUTSEEK+6(1),LASTORIG+3   THIS LAST TRACK OF CYLINDER.   64100016
         BC    4,UPCCHH1               NO--                             64200016
         A     GR3,CONVCYL             YES,STEP TO NEXT CYLINDER.       64300016
         AIF   ('&LIB' EQ 'LIB2').X0001                         Y02113  64350000
CK2321   CLI   OUTSEEK+5,X'04'         IS THIS 2321 AND LAST CYLINDER.  64500016
         BC    7,UPCCHH2               NO--RETURN.                      64600016
         AL    GR3,STC2321             INCREMENT STRIP.                 64700016
         CLI   OUTSEEK+4,X'09'         THIS LAST STRIP.                 64800016
         BC    7,UPCCHH2               NO--RETURN.                      64900016
         AL    GR3,SCC2321             INCREMENT SUBCELL.               65000016
.X0001   ANOP                                                   Y02113  65050000
         B     UPCCHH2                 GO STORE VALUE AND RETURN.       65100016
UPCCHH1  AL    GR3,F1                  INCREMENT TO NEXT TRACK.         65300016
UPCCHH2  ST    GR3,CONTROL+8           SAVE NEW VALUE.                  65400016
         CLC   CONTROL+4(4),CONTROL+8    THIS LAST TRACK TO DUMP.       65500016
         BE    FINIS                   YESS--GO TO FINISH UP THE JOB.   65600016
         MVC   OUTSEEK+3(4),CONTROL+8   TRACK ADDRESS TO IOB.           65700016
         MVC   TOSEEK+3(4),CONTROL+8       TRK ADDRESS TO 'TO' IOB.     65800016
         TM    SWITCH,EOV              EOV SWITCH SET FOR PRIMARY 'TO'. 65809016
         BZ    UPCCHH3                 NO--GO CHECK FOR COPIES.         65818016
         NI    SWITCH,X'FD'            SET EOV SWITCH OFF.              65827016
         L     GR1,REELCK              CURRENT TRAILER INFO.            65836016
         SLL   GR1,1                   UPDATE AND                       65845016
         ST    GR1,REELCK                 STORE TRAILER INFO.           65854016
         BAL   GR2,TRAILER             GO TO WRITE TRAILER.             65863016
         BAL   GR4,YESEOV              GO TO FORCE EOV.                 65872016
UPCCHH3  OC    COPYPTR(4),COPYPTR      ARE THERE COPIES.                65890016
         BCR   8,GR14                  NO--RETURN TO CALLER.            65899016
         L     GR8,COPYPTR             ADDRESS OF COPY BLOCK.           65908016
         USING COPYBLK,8                                                65917016
UPCCHH4  LA    GR9,CIOBLOCK            I/O BLOCK FOR COPY.              65926016
         MVC   TOSEEK+3(4),CONTROL+8   UPDATE SEARCH ARGUMENT.          65935016
         TM    CERRSW,X'FF'            EOV THIS COPY.                   65944016
         BZ    UPCCHH5                 NO--GO TO SEE IF MORE COPIES.    65953016
         MVI   CERRSW,0                SET COPY EOV SWITCH OFF.         65962016
         L     GR1,CREELCK             CURRENT TRAILER INFO.            65971016
         SLL   GR1,1                   UPDATE AND                       65980016
         ST    GR1,CREELCK                STORE TRAILER INFO.           65989016
         BAL   GR2,TRAILER             GO TO WRITE TRAILER RECORD.      65998016
         BAL   GR4,YESEOV              GO TO EXECUTE EOV.               66007016
UPCCHH5  OC    CCOPYPTR(4),CCOPYPTR    MORE COPIES.                     66025016
         BC    8,UPCCHH6               NO--GO TO RETURN.                66034016
         L     GR8,CCOPYPTR            POINTER TO NEXT COPY.            66043016
         B     UPCCHH4                 GO TO PROCESS THIS COPY.         66052016
UPCCHH6  LA    GR9,BLOCKS              PRIMARY I/O BLOCK.               66061016
         BR    GR14                    RETURN TO CALLER.                66070016
         DROP  2,8                                                      66080016
         EJECT                                                          66090016
FINIS    CLI   DEVSW,X'FF'             DUMPING TO DIRECT ACCESS.        66140016
         BE    FINALR2                 YES--GO TO ENDING THIS    M4513  66240019
*                                       FUNCTION                 M4513  66340019
FINISA   CLI   DEVSW,X'F0'             DUMPING TO SYSOUT.               66624016
         BNE   FINISAA                 NO--MUST BE TO TAPE.             66628016
         DELETE EP=IEHDAOUT            DELETE THE LOAD MODULE.          66632016
         DELETE EP=IEHDPRNT                                             66636016
         B     FINALR2                 GO TO RETURN TO IEHDDUMP.        66640016
FINISAA  L     GR1,REELCK              CURRENT TRAILER RECORD INFO.     66644016
         SLL   GR1,1                   UPDATE AND STORE                 66650016
         LCR   GR1,GR1                 TRAILER INFORMATION              66660016
         BAL   GR2,TRAILER             GO WRITE THE TRAILER RECORD.     66665016
         OC    COPYPTR(4),COPYPTR      ARE THERE COPIES.                66670016
         BZ    FINALR2                 NO--GO TO RETURN TO IEHDDUMP.    66680016
         L     GR3,COPYPTR             ADDRESS FIRST OR ONLY COPY.      66690016
         USING COPYBLK,3                                                66700016
CFINISA  LA    GR9,CIOBLOCK            ADDRESSING FOR THIS COPY BLK.    66710016
         L     GR1,CREELCK             TRAILER RECORD INFORMATION.      66720016
         SLL   GR1,1                   UPDATE AND                       66730016
         LCR   GR1,GR1                 SAVE THIS                        66740016
         BAL   GR2,TRAILER             GO TO WRITE TRAILER RECORD.      66750016
         OC    CCOPYPTR(4),CCOPYPTR    MORE COPIES.                     66760016
         BZ    FINALR2                 NO--GO TO RETURN TO IEHDDUMP.    66770016
         L     GR3,CCOPYPTR            PTR. TO NEXT COPY.               66780016
         B     CFINISA                 GO TO PROCESS.                   66790016
         DROP  3                                                        66800016
         EJECT                                                          72360016
*********************************************************************** 72400016
*                                                                     * 72500016
*  THIS ROUTINE WILL RECEIVE CONTROL UPON DETECTION OF AN I/O ERROR.  * 72600016
*  SYNADAF(SVC 68) AND ITS ASSOCIATED MACROS WILL BE USED TO          * 72700016
*  DETERMINE THE ERROR CONDITION.                                     * 72800016
*                                                                     * 72900016
*********************************************************************** 73000016
         SPACE                                                          73090016
IOERR    STM   0,15,SAVERR             SAVE REGISTERS              O122 73100019
         LA    GR3,OUTIOB              ADDRESS OF FROM IOB         O122 73110019
         CLI   DEVSW,X'F0'             DUMPING TO SYSOUT           O122 73120019
         BNE   CANTCONT                NO                          O122 73130019
         TM    OUTSTAT+4,X'02'         UNIT CHECK                  O122 73140019
         BNO   CANTCONT                NO                          O122 73150019
         TM    OUTSENSE,X'08'          DATA CHECK                  O122 73160019
         BO    RECOVER                 YES                         O122 73170019
         L     GR4,FUCBPTR             LOAD FROM UCB ADR.      @ZA04427 73172040
         TM    19(GR4),X08             2314?                   @ZA04427 73174040
         BNO   CANTCONT                NO THEN BRANCH          @ZA04427 73176040
         TM    OUTSENSE+1,X'02'        MISSING ADDRESS MARKER      O122 73180019
         BNO   CANTCONT                NO                          O122 73190019
*        SET UP PARAMETERS FOR IEHDRCVR                            O122 73200019
RECOVER  LM    GR4,GR5,DAOUTADR        ADDR OF IEHDAOUT & IEHDPRNT O122 73210019
         LA    GR6,OUTIOB              ADDRESS OF IOB              O122 73220019
*              REGISTERS 10 AND 12 ALREADY CONTAIN ADDRESSES OF    O122 73230019
*              IEHDBLKS AND IEHDWORK                               O122 73240019
         LINK  EP=IEHDRCVR             TRY RECOVER FROM I/O ERROR  O122 73250019
         LTR   GR15,GR15               IS RETURN CODE ZERO         O122 73260019
         BNZ   TESTRETN                NO, TEST FOR FOUR           O122 73270019
         LM    0,15,SAVERR             YES, RESTORE REGISTERS      O122 73280019
         B     PROC4                   RETURN TO PROCESS TRACK  SA67332 73290003
TESTRETN SRL   GR15,3                                              O122 73300019
         LTR   GR15,GR15               IS RETURN CODE FOUR         O122 73310019
         BZ    PROC4                   YES, GO PROCESS NEXT TRACK  O122 73320019
         B     FINALR3                 NO, TERMINATE THE FUNCTION  O122 73330019
SAVERR   DS    16F                     REGISTER SAVE AREA          O122 73340019
         EJECT                                                     O122 73350019
IOTERROR LA    GR9,4(GR9)             ADD TO POINT TO IOB      @ZA01201 73352002
         ST    GR9,IOBPTR              SAVE ACTIVE IOB ADR     @ZA01201 73354002
IOTERR   L     GR3,IOBPTR              LOAD ACTIVE IOB ADR     @ZA01201 73404002
CANTCONT LA    GR1,13                  I/O ERROR MESSAGE           O122 73450019
         BAL   GR4,SETUPMSG            GO TO SET UP THIS MSG.           73540016
         LR    GR1,GR3                 RESTORE POINTER TO IOB.          73630016
         SYNADAF ACSMETH=EXCP,PARM1=(1)                                 73720016
         MVC   MESS+22(78),49(GR1)     SYNADAF MSG TO BUFFER.    SM4350 73810021
         SYNADRLS                                                       73900016
ISUMSG   EQU   *                                                SA53223 73950002
         BAL   GR4,MSGWRT              GO TO PRINT THIS MESSAGE.        74000016
         LA    GR15,8                  SET UP RETURN CODE.              74200016
         B     FINALR3                 RETURN.                          74300016
         EJECT                                                          74400016
SETUPMSG LINK  EP=IEHDMSGB             MOVE MESSAGE TO BUFFER.          74410016
         BR    GR4                     RETURN TO CALLER.                74420016
         SPACE                                                          74430016
MSGWRT   LINK  EP=IEHDPRNT             PRINT THIS MESSAGE.              74440016
         BR    GR4                     RETURN TO CALLER.                74450016
         SPACE                                                          74460016
*                                                                       74500016
*  RETURN TO IEHDDUMP HERE.                                             74600016
*                                                                       74700016
         SPACE                                                          74800016
FINALR2  LA    GR15,0                  SET RETURN CODE.                 74900016
FINALR3  L    GR3,PTRCFUNC             SLOT FOR CURRENT FUNCTION.       75000016
         MVI   0(GR3),COMPLETE         INDICATE IT IS COMPLETE.         75100016
FINAL3   MVI   RDVTOC,X'00'            CLEAR SW                @ZA06532 75150040
         L     GR13,4(GR13)            RESTORE REGISTER 13     @ZA06532 75900040
         RETURN (14,12),T,RC=(15)      RESTORE/RETURN WITH PROPER CODE. 76000016
         EJECT                                                          76100016
         DS    0H                                                       76700016
SIXTEEN  DC    H'16'                                                    76900016
WRTAPE    EQU   X'01'                   WRITE TAPE OP-CODE     NUFORMAT 76950003
TAPMK    EQU   X'80'                                             A21395 77100020
GOOD     EQU   X'7F'                                                    77200016
DC       EQU   X'08'                   USED FOR DATA CHECKING TEST.3651 77230018
CCH      EQU   X'40'                   USED TO CHECK COMMAND CHAIN.3651 77260018
D8       EQU   8                   DISP OF 8                     S20201 77265020
D0       EQU   0                        DISPLACEMENT OF ZERO    SA53223 77267002
L8       EQU   8                        LENGTH CONSTANT         SA53223 77269002
RDCNTVAL EQU   X'00'                    CAUSES IEHDDOIO TO BRCH SA53223 77269402
*                                       TO A LABEL: RDCNTS.     SA53223 77269902
WRTHARO  EQU   X'04'                    CAUSES IEHDDOIO TO BRCH SA53223 77272402
*                                       TO A LABEL: WRTHAR0.    SA53223 77276402
X08      EQU   X'08'                   HEX CONSTANT.             S20201 77277502
RPSFEAT1 EQU   X'04'               RPS ON FROMDD                 S20201 77280002
TICCODE  EQU   X'08'               TIC CCW OP                    S20201 77282502
RPSFEAT  EQU   X'40'               RPS ON TODD                   S20201 77285020
D1       EQU   1                   DISP OF 1                     S20201 77290020
D3       EQU   3                        DISPL. OF 3             Y02113  77292001
D4       EQU   4                        DISPL. OF 4                     77292202
D38      EQU   38                       DISPL. OF 38                    77292402
D58      EQU   58                       DISPL. OF 58                    77292602
D84      EQU   84                       DISPL. OF 84                    77292802
D140     EQU   140                      DISPL. OF 140                   77293002
R1       EQU   1                        RECORD NO OF FMT 4              77293202
R2       EQU   2                        RECORD NO OF FMT 5              77293402
CONTAM   EQU   X'80'                    CONAMINATION BIT                77293602
VTOCERR  EQU   X'40'                    DADSM ERROR BIT                 77293802
L4       EQU   4                        LENGTH OF 4             Y02113  77294001
TIMECHK  EQU   X'01'                    MEANS TIMESTAMP SAVED   Y02113  77296001
CLOCK    EQU   92                       DISPL INTO BUFFER FOR   Y02113  77298001
*                                       TIMESTAMP.              Y02113  77298401
*                                       INTO BUFFER             Y02113  77300002
AREA     DS    1F                      SAVE AREA FOR CCW LENGTH.  0811  77370017
LABEL1   DC    C'MAINTENANCE'           LABEL OF MAINT. AREA    SA53223 77372002
         DC    100F'0'                                                  77372402
LABEL2   DC    C'AREA'                  END OF MAINT. AREA      SA53223 77372802
         DS    0D                                                A37209 77374020
RDVOLBUF DS    CL92                     VOLID BUFFER             A37209 77378020
SRKEY    DC    X'0000000003'            RECORD THREE SEARCH      A37209 77382020
*                                       ARGUMENT                 A37209 77386020
         DS    0H                      HALF WORD ALIGHNMENT      A51474 77396000
ZERO     DC    6X'0'                   TWO BYTES OF ZEROS WILL   A51474 77400000
*                                      ALSO BE USED FROM THE     A51474 77450000
*                                      FOLLOWING CONSTANT.       A51474 77460000
SCC2321  DC    X'00F60000'             INCREMENT TO NEXT SUBCELL.       77470002
STC2321  DC    X'0000FB00'             INCREMENT TO NEXT STRIP.         77480002
F1       DC    F'1'                                                     77500016
         DS    0F                                                S20201 77800020
DAOUTADR DS    1F                      IEHDAOUT ENTRY POINT SAVE AREA.  79100016
PRNTADR  DS    1F                      IEHDPRNT ENTRY POINT SAVE AREA.  79200016
TAPECCW5 CCW   1,0,X'20',24            WRITE TRAILER RECORD.   NUFORMAT 79650003
         SPACE                                                          79700016
SEARIDEQ CCW   X'31',0,X'60',5         SEARCH ID EQUAL ON R0            79800016
         CCW   8,SEARIDEQ,X'60',5      TIC BACK.                        79900016
         CCW   6,0,X'60',8             READ R0 DATA.                    80000016
         CCW   X'9E',0,X'60',X'4000'   READ CKD R1               4074   80100000
*                                      WITH MAXIMUM COUNT               80150000
DUMMYCCW CCW   X'92',0,X'60',8         DUMMY READ COUNT CCW.            80200016
DMMYRCCW CCW   X'1E',0,X'60',0         DUMMY READ COUNT/KEY/DATA CCW    80300016
         SPACE 1                                                        80400016
READVTOC CCW   X'31',0,X'60',5         SEARCH ON RECORD 1 OF VTOC.      82440016
         CCW   8,READVTOC,0,0          REPEAT UNTIL FOUND.              82460016
RDVDATA  CCW   6,0,X'20',140           READ FORMAT 4 DSCB.              82560002
*        CHANNEL PROGRAMS FOR SAVING OLD VOLID                          82570020
SRCHKEYR CCW   X'31',SRKEY,X'60',5      SEARCH ID EQUAL          A37209 82580020
         CCW   8,SRCHKEYR,0,0                                    A37209 82590020
         CCW   X'06',RDVOLBUF,X'20',92  READ IN VOLID            A37209 82600020
SRCHKEYW CCW   X'31',SRKEY,X'60',5      SEARCH ID EQUAL          A37209 82610020
         CCW   8,SRCHKEYW,0,0                                    A37209 82620020
         CCW   X'05',RDVOLBUF,X'20',92  WRITE OUT ORIGINAL VOLID A37209 82630020
TOTAL    DS    F'0'                                              A51474 82632000
EXCPSAVE DS    18F                      SAVE AREA                A37209 82640020
F5DSCB   CAMLST SEEK,F5CCHHR,FRVOL,44  OBTAIN OF F5 DSCB       @ZA01677 82650002
*                                      44 IS USED AS A ADR     @ZA01677 82650402
*                                      OVERWRITTEN AT OBTF5    @ZA01677 82650802
F5CCHHR  DC    5X'0'                   CCHHR OF F5 DSCB        @ZA01677 82652040
FRVOL    DC    6X'0'                   VOLSER OF FROM          @ZA01677 82654040
         DS    0D                                              @ZA01677 82656002
DOUBLE   DC    8X'0'                   CONVERT AREA            @ZA01677 82658002
FOUR     DC    F'4'                                            @ZA01677 82658402
EIGHT    DC    F'8'                                            @ZA01677 82658802
COND     DC    C'COND='                                        @ZA01677 82659202
BADCOND  DS    X'00'                                           @ZA01677 82659602
         SPACE                                                          82660016
* THIS IS USED TO WRITE HA, R0, R1 ONLY.                                82760016
R0CCWS   DSECT                                                          82900016
*   USED WHEN MODIFYING HA, R0 CCWS FOR EXECUTION.                      83000016
SEARCHR0 DS    2F                                                       83100016
TICBACK  DS    2F                                                       83200016
WRITER0  DS    2F                                                       83300016
SEARCH1  DS    2F                                                       83400016
TICAGAIN DS    2F                                                       83500016
READR0   DS    2F                                                       83600016
ERASEALL DS    2F                                                       83700016
READREC0 DS    2F                                                       83800016
         SPACE                                                          83900016
CCWS     DSECT                                                          84000016
SEIDEQR0 DS    CL8                                                      84100016
TICBACKA DS    CL8                                                      84200016
RDWRDATA DS    CL8                                                      84300016
RDWRTCKD DS    CL8                                                      84400016
RDWRTCNT DS    CL8                                                      84500016
         SPACE                                                          84502002
F5BUF    DSECT                         F5 DSCB                 @ZA01677 84510002
         DS    CL84                    WORK AREA               @ZA01677 84520002
DS5KEYID DS    CL4                     05050505                @ZA01677 84530002
DS5AVEX1 DS    CL5                     FIRST AVE EXTENT        @ZA01677 84540002
DS5AVEX2 DS    CL35                    7 MORE AVE EXTENT       @ZA01677 84542002
DS5FMTID DS    CL1                     FORMAT 5 ID(F5)         @ZA01677 84544002
DS5AVEX3 DS    CL90                    18 MORE AVE EXTENT      @ZA01677 84546002
DS5PTRDS DS    CL5                     PTR TO NXT F5 DSCB      @ZA01677 84548002
         EJECT                                                          84550016
         IEHDWORK                                                       84600016
         EJECT                                                          84700016
IOBLOCKS DSECT                                                          84800016
* DUMP 'TO' ECB.                                                        84900016
TOECB    DS    1F                      WAIT//COMPLETE BITS PLUS CODE.   85000016
* DUMP 'TO' IOB.                                                        85100016
TOIOB    DS    0F                                                       85200016
TOFLGS   DS    CL2                     FLAGS ONE AND TWO.               85300016
TOSENSE  DS    CL2                     SENSE BYTES.                     85400016
TOECBAD  DS    1F                      ECB ADDRESS.                     85500016
TOSTATUS DS    2F                      CHANNEL STATUS.                  85600016
TOCCWAD  DS    1F                      CCW LIST ADDRESS.                85700016
TODCBAD  DS    1F                      DCB ADDRESS.                     85800016
TORESAD  DS    1F                      RESTART ADDRESS.                 85900016
TOBLKCNT DS    CL2                     BLOCK COUNT INCREMENT.           86000016
TOERROR  DS    CL2                     ERROR COUNT.                     86100016
TOSEEK   DS    2F                      MBBCCHHR.                        86200016
* DUMP 'TO' DCB.                                                        86300016
TODCB    DS    13F                     DCB.                             86400016
         DS    0D                      FOR DOUBLE WORD ALIGNMENT.       86500016
TAPECCW2 DS    1D                      USED TO PUT OUT CCW RECORD       86600016
*                                        AND DATA ON TAPE.              86700016
TAPECCW3 DS    2D                      WRITE HA,R0 CCWS ON TAPE.        86800016
TAPECCW4 DS    2D                      WRITE HA,R0,R1 CCWS ON TAPE.     86900016
         DS    0D                      FOR DOUBLE WORD ALIGNMENT.       87000016
* DUMP 'FROM' ECB.                                                      87100016
OUTECB   DS    1F                      WAIT//COMPLETE BITS PLUS CODE.   87200016
* DUMP 'FROM' IOB.                                                      87300016
OUTIOB   DS    0F                                                       87400016
OUTFLG   DS    CL2                     FLAGS ONE AND TWO.               87500016
OUTSENSE DS    CL2                     SENSE BYTES.                     87600016
OUTECBAD DS    1F                      ECB ADDRESS.                     87700016
OUTSTAT  DS    2F                      CHANNEL STATUS.                  87800016
OUTCCWAD DS    1F                      CCW LIST ADDRESS.                87900016
OUTDCBAD DS    1F                      DCB ADDRESS.                     88000016
OUTRESAD DS    1F                      RESTART ADDRESS.                 88100016
OUTBLKCT DS    CL2                     BLOCK COUNT INCREMENT.           88200016
OUTERROR DS    CL2                     ERROR COUNT.                     88300016
OUTSEEK  DS    2F                      7BBCCHHR.                        88400016
CCHH     EQU   OUTSEEK+3               CYLINDER/HEAD ADDRESS.           88500016
R        EQU   OUTSEEK+7               RECORD NUMBER.                   88600016
* DUMP 'FROM' DCB.                                                      88700016
OUTDCB   DS    18F                     DCB.                             88800016
         SPACE                                                          89100016
IOBLKEND DS    0H                      END OF IOBLOCKS DSECT.           89200016
DBSIZE   EQU   IOBLKEND-IOBLOCKS       SIZE OF IOBLOCKS DSECT.          89300016
         EJECT                                                          89350016
         SPACE 1                                                        89400016
         IEHDBLKS                                                       89500016
         EJECT                                                          89600016
         SPACE 2                                                        90600016
         SPACE                                                          90700016
RBUFFER  DSECT                                                          90800016
ZERO1    DS    CL8                     WILL CONTAIN 8 BYTES OF ZEROS.   90900016
CCWBUFF  EQU   ZERO1                                                    91000016
TICSW    DS    CL1                     'FF' INDICATES PREVIOUS CCW=TIC. 91100016
         DS    CL3                     NOT USED.                        91200016
ADDRESS  DS    CL4                     TEMPORARY ADDRESS HOLDER.        91300016
SEEKCCW  DS    CL8                     SEEK CCW FOR STAND-ALONE.        91400016
SETMASK  DS    CL8                     SET FILE MASK FOR STAND-ALONE.   91500016
SEARIDE  DS    CL8                     SEARCH EQUAL ID CCW.             91600016
         EJECT                                                          91700016
CVT      DSECT                                                          91800016
         CVT   SYS=MIN                                                  91900016
         EJECT                                                          92000016
UCB      DSECT                                                          92100016
         IEFUCBOB                                                       92200016
         EJECT                                                          92300016
JFCB     DSECT                                                          92400016
         IEFJFCBN                                                       92500016
         EJECT                                                          92600016
         DCBD  DSORG=PS                                                 92700016
         END                                                            92800016
