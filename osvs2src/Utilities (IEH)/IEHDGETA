         TITLE 'IEHDGETA - PERFORMS GETALT FUNCTION  IEHDASDR UTILITY'  00302421
         COPY  LCGASMSW                                                 00304021
IEHDGETA CSECT                                                          00310000
**********************************************************************  00311099
*                                                                       00312099
*                        FIXES THIS MODULE                              00313099
*                        LATEST FIRST.                                  00314099
*                                                                       00315099
**********************************************************************  00316099
*                                                                       00317099
*D 66000                               ONLY SU32               @ZA25515 00317599
*C 115000                              ONLY SU32               @ZA25515 00318099
*A 103500-104000                       ONLY SU32               @ZA25515 00318299
*A 255105-255108,886500                ONLY SU32               @ZA25515 00318499
*                                                                       00319099
*                                                                     * 00320016
*                    VS2-3 SU32                                @G32DSPD 00320132
*                                                              @G32DSPD 00321132
*        RELEASE 23 DELETIONS                                         * 00324020
*        RELEASE 22 DELETIONS                                         * 00328020
*        RELEASE 21 DELETIONS                                         * 00332020
*                                                                A49434 00334000
*        RELEASE 20 DELETIONS                                         * 00336020
*1145348000                                                      A35813 00337020
*1145                                                            S20201 00338020
*1145162000,177000                                               S20201 00343020
*D 300000,383000                                               @Z30RSAG 00345032
*C 300500,446500,405800                                        @Z30RSAG 00347032
*A 166820,271100-380,337500-867,373000-378000                  @Z30RSAG 00347432
*A 447600,700,483500,600                                       @Z30RSAG 00347832
*STATUS CHANGE LEVEL 003                                                00348020
*                                                                     * 00360016
**********************************************************************  00366099
      EJECT                                                             00372099
*FUNCTION/OPERATION- THIS ROUTINE HANDLES THE -GETALT- FUNCTION       * 00380016
*   OF THE IEHDASDR SYSTEM UTILITY PROGRAM. GETALT IS USED TO         * 00400016
*   ASSIGN ALTERNATE TRACKS FOR DEFECTIVE OR QUESTIONABLE TRACKS      * 00420016
*   ON DISK OR DATA CELL VOLUMES. THE TRACKS SPECIFIED ON THE GETALT  * 00440016
*   CONTROL CARD WILL HAVE THE NEXT AVAILABLE ALTERNATE TRACK         * 00460016
*   ASSIGNED. THIS FUNCTION IS EXECUTED IN AN SVC ROUTINE.            * 00480016
*   RACF AUTHORIZATION IS REQUIRED FOR RACF DEFINED VOLUMES.   @G32DSPD 00490032
*                                                                     * 00500016
*ENTRY POINTS- THE ONLY ENTRY POINT IS -IEHDGETA- AND CONTROL IS      * 00520016
*   ALWAYS RECEIVED FROM THE MONITOR MODULE IEHDASDS.                 * 00540016
*                                                                     * 00560016
*INPUT- POINTERS TO A WORKAREA(REGISTER12) AND TO A CONTROL BLOCK     * 00580016
*   (REGISTER 10).                                                    * 00600016
*   DATA IS ON A DIRECT ACCESS DEVICE OTHER THAN A DRUM DEVICE        * 00620016
*                                                                     * 00640016
*EXITS- NORMAL- A SUCCESSFUL GETALT OPERATION RESULTS IN A RETURN     * 00660016
*   TO THE MONITOR (IEHDASDS) WITH A RETURN CODE OF 0. A GETALT       * 00680016
*   COMPLETE MESSAGE IS PLACED IN THE MESSAGE DATA SET.               * 00700016
*                                                                     * 00720016
*EXITS- ERROR- ANY ERROR ENCOUNTERED IS DESCRIBED BY AN APPROPRIATE   * 00740016
*   MESSAGE TO THE MESSAGE DATA SET. A RETURN CODE GREATER THAN       * 00760016
*   ZERO WILL BE PASSED BACK TO THE MONITOR.                          * 00780016
*                                                                     * 00790016
*EXTERNAL ROUTINES- THIS ROUTINE IS ALWAYS ENTERED FROM               * 00800016
*   THE MONITOR MODULE IEHDASDS. FOUR OTHER CSECTS ARE USED BY        * 00820016
*   THIS ROUTINE. MESSAGES ISSUED WILL BE FORMULATED BY THE MESSAGE   * 00840016
*   ROUTINE(IEHDMSGB) AND PRINTED BY THE PRINT ROUTINE                * 00860016
*   (IEHDPRNT). THE END OF EXTENT APPENDAGE(IGG019P8) HANDLES         * 00880016
*   THE LIMITS AND EXTENTS IN THE DEB FOR ALL DA DEVICES INVOLVED     * 00900016
*   THE SVC ROUTINE(IGC0008B) HANDLES THE ACTUAL ASSIGNMENT OF AN     * 00920016
*   ALTERNATE TRACK.                                                  * 00940016
*                                                                     * 00960016
*TABLES/WORK AREAS- UPON ENTRY REGISTERS 10 AND 12 POINT TO A         * 00980016
*   FUNCTION BLOCK AND A WORKAREA RESPECTIVELY. THEY ARE DESCRIBED    * 01000016
*   IN THE DSECTS CALLED -FUNCBLK- AND -WORK-.                        * 01020016
*                                                                     * 01040016
*ATTRIBUTES- SERIALLY REUSABLE, RELOCATABLE.                          * 01060016
*                                                                     * 01080016
*   THE FOLLOWING ARE REGISTER ASSIGNMENTS.                             01500016
GR0      EQU   0                                                        01800016
GR1      EQU   1                                                        02100016
GR2      EQU   2                                                        02400016
GR3      EQU   3                                                        02700016
GR4      EQU   4                                                        03000016
GR5      EQU   5                                                        03300016
GR6      EQU   6                                                        03600016
GR7      EQU   7                                                        03900016
GR8      EQU   8                                                        04200016
GR9      EQU   9                                                        04500016
GR10     EQU   10                                                       04800016
GR11     EQU   11                                                       05100016
GR12     EQU   12                                                       05400016
GR13     EQU   13                                                       05700016
GR14     EQU   14                                                       06000016
GR15     EQU   15                                                       06300016
UCBPTR   EQU   9                                                        06900016
BASEREG  EQU   11                                                       07200016
WORKBASE EQU   12                                                       07500016
         USING FUNCBLK,10                                               07800016
         USING IEHDGETA,BASEREG                                         08100016
         USING WORK,12                                                  08400016
         SAVE  (14,12),T,*             SAVE THE REGISTERS               08700016
         LR    BASEREG,GR15            LOAD THE BASE REGISTER.          09000016
         LA    GR7,GETASAVE            SAVE AREA ADDRESS                09300016
         ST    GR7,8(GR13)             ADDRESS OF NEW AREA TO OLD.      09600016
         ST    GR13,4(GR7)             ADDRESS OF OLD AREA TO NEW.      09900016
         LR    GR13,GR7                LOAD SAVE AREA ADDRESS.          10200016
         SR    GR8,GR8                 INITIALIZE REGISTER TO ZERO.     10300016
         B     APARNO                  BRANCH AROUND APAR NO   @ZA25515 10350099
         DC    C'SU32 OZ25515'         LAST FIX THIS MODULE    @ZA25515 10400099
**********************************************************************  10500016
*        DETERMINE DEVICE TYPE AND SET UP POINTER TO THE  PROPER      * 10800016
*        DEVICE CONSTANTS FOR THIS DEVICE.                            * 11100016
**********************************************************************  11400016
APARNO   L     GR7,RDDCBAD             POINTER TO DCB          @ZA25515 11500099
         USING IHADCB,7                                                 11600016
         L     UCBPTR,TUCBPTR          PICK UP POINTER TO UCB           11700016
         USING UCB,9                                                    12000016
         AIF    ('&LIB' EQ 'LIB2').X225600                      XL03145 12050003
         CLI   UCBID,X'FF'             IS THIS MAIN UCB                 12100016
         BNE   IS2321                  NO-MUST BE 2321                  12200016
.X225600 ANOP                                                   XL03145 12250003
         TM    UCBTBYT3,UCB3DACC       IS THIS A DIRECT ACCESS DEVICE.  12300016
         BZ    BADPARM                 NO--MUST BE BAD PARAMETER.       12600016
         AIF   ('&LIB' NE 'LIB1').X301600                       XL03912 12650003
         CLI   UCBTBYT4,ZEUS1      IS IT 2305-1                  S20201 12660020
         BE    GOODEV              YES IT IS                     S20201 12720020
         CLI   UCBTBYT4,ZEUS2      NO IS IT 2305-2               S20201 12780020
         BE    GOODEV              YEH                           S20201 12840020
         TM    UCBTBYT4,X'02'          IS THIS DRUM DEVICE              12900016
         BO    DRUMDEV                 YES - CANNOT HANDLE DEVICE       13200016
GOODEV   EQU   *                                                 S20201 13250020
.X301600 ANOP                                                   XL03912 13260003
         TM    SRTESTAT,SRTESYSR       THIS A SYSTEMS RESIDENCE VOLUME  13300016
         BO    SYSRES                  YES-NOT ALLOWED                  13400016
         SR    GR3,GR3                                                  13500016
         IC    GR3,UCBTBYT4            UCB DEVICE TYPE CODE             13800016
         AIF   ('&LIB' EQ 'LIB1').X227600                       XL03130 13850003
         CLI   UCBTBYT4,WIN             IS THIS A 3340?         XL03130 13900003
         BNE   GETCON                   NO, GET DEVICE CONSTANT.XL03130 13950003
         IC    GR3,ODEVMOD              YES, USE DEV MOD NO.    XL03130 14000003
GETCON   EQU   *                                                XL03130 14050003
.X227600 ANOP                                                   XL03130 14060003
         LA    GR5,KDEVSIZE            SIZE OF EACH DEVICE ENTRY        14100016
         BCTR  GR3,0                   DECREMENT FOR PROPER INDEX       14400016
         MR    GR4,GR3                 ENTRY SIZE TIMES INDEX VALUE     14700016
         L     GR4,IODEVCON            BEGIN ADDRESS OF DEVICE CONSTANT 15000016
         AR    GR4,GR5                 ADDRESS OF CONSTANTS THIS DEVICE 15300016
         ST    GR4,IODEVCON            SAVE IN FUNCTION BLOCK           15600016
         AIF   ('&LIB' EQ 'LIB2').X225601                       XL03145 15900003
         B     SKIP                                                     16260016
IS2321   LA    GR3,4                   INDEX FOR 2321                   16320016
         LA    GR5,KDEVSIZE            SIZE OF EACH DEVICE ENTRY        16380016
         MR    GR4,GR3                 ENTRY SIZE TIMES INDEX VALUE     16440016
         L     GR4,IODEVCON            BEGIN ADDRESS OF DEVICE CONSTANT 16500016
         AR    GR4,GR5                 ADDRESS OF CONSTANTS THIS DEVICE 16560016
         ST    GR4,IODEVCON            SAVE IN FUNCTION BLOCK           16620016
.X225601 ANOP                                                   XL03145 16650003
SKIP     L     GR2,IODEVCON                                             16680016
         MVC   IODEVCON(1),UCBTBYT4    SAVE UCB DEVICE TYPE    @Z30RSAG 16682032
         CLI   UCBTBYT4,ZEUS1          IS ITB2305                S20201 16690020
         BE    ZEUSCMPR                YES - CHK ALTS DIFFERENT  S20201 16700020
         CLI   UCBTBYT4,ZEUS2          IS IT A 2305              S20201 16710020
         BE    ZEUSCMPR                YES - CHK ALTS DIFFERENT  S20201 16720020
         AIF   ('&LIB' EQ 'LIB1').X227913                       XL03912 16720303
         CLI   UCBTBYT4,K2314          IS THIS 2314             XL03145 16720603
         BE    CHKCYL1                 YES, CHECK CCHH          XL03145 16720903
         AGO   .X227914                                         XL03912 16721203
.X227913 ANOP                                                   XL03912 16721503
         CLI   UCBTBYT4,MERLN          IS THIS 3330              A49434 16722000
         BNE   CHKCYL1                  NO                       X99204 16724000
.X227914 ANOP                                                   XL03912 16726003
CKLAST   EQU   *                        MERLIN                   X99204 16729200
         USING CONSTANT,2                                               16740016
         CLC   GTRACK(2),LASTALT       IS VALID TRACK SPECIFIED  A49434 16750000
         BH    TRKINVLD                NO, GO SET RTN CODE       A49434 16760003
         B     CHKHD1                  CONTINUE CHECKING         A49434 16770000
CHKCYL1  EQU   *                       CHECK CCHH                A49434 16790000
         CLC   GTRACK(1),LASTALT       IS TRACK SPECIFIED A             16870016
         BH    TRKINVLD                  VALID TRACK.                   16940016
         CLC   GTRACK+1(1),LASTALT+1                                    17010016
         BH    TRKINVLD                                                 17080016
CHKHD1   EQU   *                       CONTINUE 3330 CHECKING    A49434 17130000
         CLC   GTRACK+2(1),LASTALT+2                                    17150016
         BH    TRKINVLD                                                 17220016
         CLC   GTRACK+3(1),LASTALT+3                                    17290016
         BH    TRKINVLD                INVALID TRACK                    17400016
         B     AFTZEUS                 GO AROUND ZEUS  CODE      S20201 17460020
ZEUSCMPR CLC   GTRACK(2),LASTALT       OVER LAST ALT             S20201 17520020
         BNL   TRKINVLD                YES - INVALID TRACK       S20201 17580020
         CLC   GTRACK+2(1),LASTALT+2   CHK THIRD BYTE            S20201 17640020
         BH    TRKINVLD                YES - INVALID TRACK       S20201 17700020
         CLI   GTRACK+3,X'07'           TRACK TOO BIG            S20201 17760020
         BH    TRKINVLD                YES - INVALID TRACK       S20201 17820020
AFTZEUS  EQU   *                                                 S20201 17940020
         MVC   REQUEST+VOL(L6),SRTEVOLI  SET VOLID TO MSG.      YL02912 17990002
         DROP  GR9                                              YL02912 17992002
         L     GR9,CVTPTR               GET ADDRESS OF CVT.     YL02912 17994002
         USING CVT,GR9                                          YL02912 17996002
         L     GR9,CVTTCBP              GET PTR TO TCB ADDRESS. YL02912 17998002
         L     GR9,D4(GR9)              GET TCB ADDRESS.        YL02912 17998402
         L     GR9,D12(GR9)             GET TIOT ADDRESS.       YL02912 17998802
         MVC   REQUEST+JJJ(L8),D0(GR9)  SET JOB NAME TO MSG.    YL02912 17999202
         MVC   REQUEST+SSS(L8),D8(GR9)  SET STEP NAME TO MSG.   YL02912 17999602
REQUEST  WTOR  'IEH846D CONFIRM REQUEST TO ASSIGN ALTERNATES ON VOLID= *17999702
                    .JJJJJJJJ,SSSSSSSS.',REPLY,1,WTORECB,ROUTCDE=(4),  *17999802
               DESC=(2)                                         YL02912 18024902
         TM    WTORECB,COMPLETE         IS OPERATION COMPLETE?  YL02912 18037402
         BO    TESTANSW                 YES,GO CHECK ANSWER.    YL02912 18049902
         WAIT  ECB=WTORECB              NO, AWAIT COMPLETION.   YL02912 18059902
TESTANSW MVI   WTORECB,ZERO             CLEAR ECB POST BITS.    YL02912 18069902
         CLI   REPLY,C'U'               REPLY EQUAL 'U'?        YL02912 18079902
         BE    USE                      YES, CONTINUE LABEL.    YL02912 18089902
         CLI   REPLY,C'T'               REPLY EQUAL 'T'?        YL02912 18091902
         BE    TERM                     YES, TERMINATE.         YL02912 18093902
         MVC   ERRANS+ERJJ(L8),D0(GR9)  SET JOB NAME TO MSG.    YL02912 18095902
         MVC   ERRANS+ERSS(L8),D8(GR9)  SET STEP NAME TO MSG.   YL02912 18097902
ERRANS   WTO   'IEH808I REPLY IN ERROR. REPLY WITH  U  OR  T , JJJJJJJJ*18098302
               ,SSSSSSSS.',ROUTCDE=(4),DESC=(5)                 YL02912 18098702
         B     REQUEST                  GO WRITE REQUEST AGAIN. YL02912 18099102
         DROP  GR9                                              YL02912 18099502
USE      EQU  *                                                 YL02912 18099602
         EJECT                                                          18099702
*********************************************************************** 18099902
*                                                                     * 18300016
*  THIS ROUTINE OPENS THE DATA CONTROL BLOCKS FOR ALL DIRECT ACCESS   * 18600016
*     DEVICES INVOLVED. THE OPEN IS ALWAYS PERFORMED ON THE FORMAT    * 18900016
*     FOUR DSCB OF THE VTOC.                                          * 19200016
*                                                                     * 19500016
*********************************************************************** 19800016
         MVC   DCBDDNAM(8),DDNAME2     PUT DDNAME IN DCB                20700016
         MVC   OPENLD+1(3),RDDCBAD+1   MOVE DCB ADDRESS TO LIST         21000016
OPENJ    LA    GR9,GETAREA             BUFFER ADDRESS TO READ JFCB      21300016
         ST    GR9,LIST                                                 21600016
         MVI   LIST,X'87'              EXIT LIST CODE                   21900016
         RDJFCB MF=(E,OPENLD)                                           22200016
         USING JFCB,9                                                   22500016
         MVI   JFCBDSNM,X'04'          SET DSNAME FIELD FOR             22800016
         MVC   JFCBDSNM+1(43),JFCBDSNM   FORMAT 4 DSCB.                 23100016
         MVI   JFCBTSDM,X'08'          STOP WRITE OF JFCB AT OPEN       23400016
         OPEN  MF=(E,OPENLD),TYPE=J                                     23700016
         TM    DCBOFLGS,X'10'          WAS THERE A SUCCESSFUL OPEN.     24000016
         BZ    NOOPEN                  NO--GIVE AN ERROR MESSAGE        24300016
         NI    DCBMACRF+1,X'F3'        SET BITS OFF TO PREVENT CLOSE    24600016
*                                        FROM WRITING AN EOF RECORD     24900016
*                                        AND UPDATING THE DSCB.         25200016
         ST    GR10,DCBIOBAD           FUNCTION BLOCK ADDRESS IN DCB    25500016
         SPACE 2                                                        25500832
*********************************************************************** 25501632
*       THIS SECTION OF CODE PERFORMS RACF AUTHORIZATION CHECKS. THE  * 25502432
*  USER MUST HAVE ALTER AUTHORIZATION TO GET AN ALTERNATE TRACK. IF   * 25503232
*  HE DOES NOT, THE OPERATION WILL NOT BE ALLOWED. IF RACF IS NOT     * 25504032
*  ACTIVE IN THE SYSTEM RACF CHECKING WILL NOT BE PERFORMED.          * 25504832
*********************************************************************** 25505632
         L     GR5,CVTPTR              GET CVT POINTER         @G32DSPD 25506432
         USING CVT,GR5                                         @G32DSPD 25507232
         L     GR5,CVTRAC              GET RACF POINTER        @G32DSPD 25508032
         DROP  GR5                                             @G32DSPD 25508832
         LTR   GR5,GR5                 TEST THE RACF POINTER   @G32DSPD 25509632
         BZ    NULLRACF                NOT ACTIVE IF PTR NULL  @G32DSPD 25510432
         USING RCVT,GR5                GO END SEE IF RACF IS   @ZA25515 25510599
         TM    RCVTSTA1,RCVTDASD       CURRENT.                @ZA25515 25510699
         BZ    NULLRACF                NO IT WAS NOT.          @ZA25515 25511099
         DROP  GR5                                             @ZA25515 25511199
         L     GR5,TUCBPTR             GET UCB POINTER         @G32DSPD 25511232
         USING UCB,GR5                                         @G32DSPD 25512032
         MVC   RACVOL,UCBVOLI          SET VOLID FOR RACHECK   @G32DSPD 25512832
         DROP  GR5                                             @G32DSPD 25513632
         RACHECK ATTR=ALTER,ENTITY=RACVOL,CLASS='DASDVOL'      @G32DSPD 25514432
         CLM   GR15,B'0001',RC8        RC 8=UNAUTHORIZED       @G32DSPD 25515232
         BE    UNAUTH                  RC 8,GO TERMINATE       @G32DSPD 25516032
NULLRACF EQU   *                       RACF NOT ACTIVE,OR      @G32DSPD 25516832
*                                      VOL ID NOT RACF DEFINED,@G32DSPD 25517632
*                                      OR RACF AUTHORIZED.     @G32DSPD 25518432
        SPACE 2                                                         25519232
*********************************************************************** 25520016
*                                                                     * 25540016
*  THIS ROUTINE DETERMINES IF THE ALTERNATE TRACK REQUEST IS A VALID  * 25560016
*     ONE. IF SO, SVC 82 IS ISSUED TO ASSIGN AN ALTERNATE TRACK FOR   * 25580016
*     THE ONE SPECIFIED AS BAD. THE SVC ROUTINE PASSES BACK A RETURN  * 25600016
*     CODE WHICH IS CHECKED AND A MESSAGE IS WRITTEN DESCRIBING EITHER* 25620016
*     THE ALTERNATE TRACK OR THE ERROR CONDITION WHICH PREVENTED THE  * 25640016
*     ASSIGNMENT OF A TRACK.                                          * 25660016
*                                                                     * 25680016
*********************************************************************** 25700016
         CLC   GTRACK(4),TRKZERO       IS BAD TRACK ZERO                25800016
         BE    TRKINVLD                YES - INVALID REQUEST            26100016
         L     GR6,DCBDEBAD            PICK UP DEB ADDRESS              26400016
         CLC   GTRACK(4),38(GR6)       IS BAD TRACK VTOC                26700016
         BE    TRKINVLD                FIRST TRACK OF VTOC INVALID      26800016
         BH    COMPAR2                 GO CHECK FOR REST OF VTOC        26900016
ASSIGN   MVC   PARMLIST+1(3),TUCBPTR+1  PICK UP UCB POINTER             27000016
         MVC   PARMLIST+4(4),GTRACK    PUT BAD TRACK ADDRESS IN LIST    27100016
         CLI   IODEVCON,D3350          IS IT 3350 ?            @Z30RSAG 27110032
         BNE   NOMAD                   NO, SKIP THIS           @Z30RSAG 27120032
         LH    GR5,DATASIZE                                    @Z30RSAG 27130032
         GETMAIN R,LV=(GR5)                                    @Z30RSAG 27132032
         ST    GR1,DATAREA                                     @Z30RSAG 27134032
         ST    GR1,BUFFADR             STORE ADDR AWAY         @Z30RSAG 27134432
         BAL   GR1,FILLBUFF            GO FILL BUFFER          @Z30RSAG 27136032
NOMAD    EQU   *                                               @Z30RSAG 27138032
         AIF   ('&LIB' EQ 'LIB1').X228305                       XL03130 27140003
         LA    GR1,ODEVMOD              GET DEV MOD NO. PTR.    XL03130 27180003
         ST    GR1,PARMLIST+12          PUT PTR INTO PARM LIST. XL03130 27220003
.X228305 ANOP                                                   XL03130 27260003
         LA    GR1,31                  DESCRIBE DEFECTIVE TRACK.        27300016
         LA    GR5,NEXTONE             SET UP FOR BRANCH AFTER PRINT    27350016
MSGLINK  BAL   GR4,MSGBLD              GO SET UP MESSAGE                27400016
         UNPK  GTRACK(9),PARMLIST+4(5) PUT TRACK ADDRESS IN PRINTABLES  27450016
         TR    GTRACK(8),TTABLE-240                                     27500016
         MVC   13(8,GR1),GTRACK        PUT TRACK ADDRESS IN MESSAGE     27550016
MOVENAME MVC   0(8,GR1),DDNAME2        PUT DDNAME IN MESSAGE            27600016
         B     MSGPRNT                 GO PRINT MESSAGE                 27650016
         DROP  9                                                        27720016
NEXTONE  LA    GR1,PARMLIST            PICK UP PARAMETER LIST ADDRESS   27920016
         SVC   ALTER                   ASSIGN ALTERNATE TRACK           28620016
         B     *+4(15)                 BRANCHING TABLE FOR RETURN CODES 29400016
         B     GOODRTN                 GOOD RETURN                      29700016
         NOP   *                       CONDITION CODE 4        @Z30RSAG 30000032
         B     MSG23                      NOT APPLICABLE       @Z30RSAG 30050032
         B     IOERR                   I/O ERROR                        30600016
         B     NOMORE                  NO MORE TRACKS AVAILABLE         30900016
GOODRTN  L     GR0,PARMLIST+4          PICK UP ALTERNATE TRK ADDRESS    31100016
         LA    GR1,32                  DESCRIBE ALTERNATE TRACK         31300016
         LA    GR5,NEXT                SET UP FOR BRANCK AFTER PRINT    31500016
         LTR   GR0,GR0                 WAS ALTERNATE TRK ASSIGNED       31700016
         BNE   MSGLINK                 YES-GO INDICATE NEW TRACK        31900016
         LA    GR4,MOVENAME            NO-SET UP FOR BRANCH AFTER MSG   32100016
         B     MSGBLD                  GO INDICATE NO ALTERNATE TRK     32300016
NEXT     EX    GR8,SWITCH1                                              32500016
         LA    GR1,6                   OPERATION COMPLETED SUCCESSFULLY 32700016
         L     UCBPTR,TUCBPTR          PICK UP POINTER TO UCB           33340016
         USING UCB,9                                                    33380016
         BAL   GR4,MSGBLD              GO SET UP MESSAGE                33420016
         MVC   0(8,GR1),DDNAME2        PUT DDNAME IN MESSAGE            33460016
         AIF   ('&LIB' EQ 'LIB2').X225602                       XL03145 33465003
         CLI   UCBID,X'FF'             IS THIS A 2321.                  33470016
         BNE   YES2321                 YES-GO HANDLE.                   33480016
.X225602 ANOP                                                   XL03145 33490003
         MVC   40(6,GR1),SRTEVOLI      PUT VOL/SER NO IN MESSAGE        33500016
SETMSG   MVC   MESS+8(10),MODNAME      PUT FUNCTION NAME IN MESSAGE.    33540016
         BAL   GR5,MSGPRNT             GO PRINT MESSAGE                 33580016
         LA    GR15,0                  SET UP RETURN CODE/SUCCESSFUL    33620016
         L     GR3,PTRCFUNC            PICK UP POINTER TO CURRENT FUNC. 33660016
         MVI   0(GR3),COMPLETE         SET COMPLETE BIT FOR FUNCTION.   33700016
         B     CLOSEUP                                                  33740016
************************************************************   @Z30RSAG 33750032
*                                                          *   @Z30RSAG 33760032
*        THIS ROUTINE FILLS THE DATA BUFFER                *   @Z30RSAG 33770032
*                                                          *   @Z30RSAG 33772032
************************************************************   @Z30RSAG 33774032
FILLBUFF EQU   *                                               @Z30RSAG 33776032
         L     GR4,DATAREA             POINT TO BUFFER         @Z30RSAG 33778032
         LH    GR5,DATASIZE            LENGTH OF BUFFER        @Z30RSAG 33778432
         AR    GR5,GR4                 POINT TO END OF BUFFER  @Z30RSAG 33778832
         SH    GR5,EIGHT                                       @Z30RSAG 33779232
MOVEIT   EQU   *                                               @Z30RSAG 33779632
         MVC   0(L8,GR4),BITPAT        MOVE BIT PATTERN        @Z30RSAG 33779732
         LA    GR4,L8(GR4)                                     @Z30RSAG 33779832
         CR    GR4,GR5                 IS END ?                @Z30RSAG 33779932
         EJECT                                                          33782002
         BL    MOVEIT                  LOOP IF NO              @Z30RSAG 33783232
         BR    GR1                     RETURN WHEN FINISHED    @Z30RSAG 33785232
         DROP  9                                                        33786732
*********************************************************************** 33790016
*                                                                     * 33800016
*  THIS SECTION WRITES OUT MESSAGES, SETS RETURN CODES AND RETURNS    * 33810016
*     CONTROL.                                                          33820016
*                                                                     * 33830016
*********************************************************************** 33840016
BADPARM  LA    GR1,10                  IS NOT DIRECT ACCESS             33900016
         B     MSG1                                                     34200016
         AIF  ('&LIB' NE 'LIB1').X301201                        XL03145 34250003
DRUMDEV  LA    GR1,23                  IS DRUM DEVICE                   34500016
         B     MSG2                     GO SET UP MESSAGE        A35813 34800020
.X301201 ANOP                                                   XL03145 34850003
NOOPEN   LA    GR1,5                   UNSUCCESSFUL OPEN                35100016
         B     MSG1                                                     35400016
COMPAR2  CLC   GTRACK(4),42(GR6)       IS BAD TRACK PART OF VTOC        35700016
         BH    ASSIGN                  OK TO ASSIGN ALTERNATE           36000016
         LA    GR8,X'F0'               SET SWITCH TO WRITE WARNING      36030016
         B     ASSIGN                    MESSAGE AFTER TRACK ASSIGNMENT 36060016
UNUSABLE LA    GR1,30                  BAD TRACK IS PART OF VGOC OR     36100016
*                                        IS TRACK ZERO.                 36200016
*                                        WRITING MESSAGE.               36400016
         B     MSG1                    GO WRITE MESSAGE                 36600016
TRKINVLD LA    GR1,22                  INVALID TRACK ADDRESS            36900016
         B     MSG1                    GO WRITE MESSAGE                 37200016
*  RACF AUTHORIZATION ERROR                                             37207032
UNAUTH   LA    GR1,MSG66I              SET FOR IEH866I MSG     @G32DSPD 37214032
         BAL   GR4,MSGBLD              GET MESSAGE TEXT        @G32DSPD 37221032
         MVC   0(L'GETALTNM,GR1),GETALTNM    TE GETALT         @G32DSPD 37228032
         MVC   18(8,GR1),DDNAME2       SET DDNAME              @G32DSPD 37235032
         B     PRNTM                   GO PRINT ERROR MSG      @G32DSPD 37242032
MSG23    EQU   *                                               @Z30RSAG 37250032
         LA    GR1,23                                          @Z30RSAG 37300032
         BAL   GR4,MSGBLD                                      @Z30RSAG 37350032
         MVC   0(L8,GR1),GTRACK        MOVE TRACK NO. TO MSG.  @Z30RSAG 37400032
         B     PRNTM                                           @Z30RSAG 37450032
FREEMN   EQU   *                                               @Z30RSAG 37500032
         CLI   IODEVCON,D3350          IS IT 3350 ?            @Z30RSAG 37550032
         BNER  GR5                     NO, SKIP FOLLOWING      @Z30RSAG 37600032
         L     GR4,BUFFADR             POINT TO BUFFER         @VS40034 37650032
         LTR   GR4,GR4                 ZERO PTR ?              @VS40034 37660032
         BZR   GR5                     YES, EXIT               @VS40034 37670032
         LH    GR6,DATASIZE            GET LENGTH BUFFER       @Z30RSAG 37700032
         FREEMAIN R,LV=(GR6),A=(GR4)   FREE IT                 @Z30RSAG 37750032
         BR    GR5                     RETURN                  @Z30RSAG 37800032
IOERR    LA    GR1,13                  I/O ERROR                        38100016
         BAL   GR4,MSGBLD              GO SET UP MESSAGE                38300016
         MVC   0(3,GR1),MSGCON         PUT SVC NO. AND DDNAME IN MSG    38500016
         MVC   3(8,GR1),DDNAME2                                         38700016
         LA    GR5,CODESET             SET UP FOR BRANCH AFTER PRINT    38900016
         B     MSGPRNT                 GO PRINT MESSAGE                 39100016
MSG2     BAL   GR4,MSGBLD               GO SET UP MESSAGE        A35813 39160020
         MVC   0(8,GR1),DDNAME2         PUT DD NAME IN MESSAGE   A35813 39220020
         BAL   GR5,MSGPRNT                                       A35813 39280020
         LA    GR15,4                   SET RETURN CODE TO 4     A35813 39340020
         TM    DCBOFLGS,X'10'           WAS OPEN PERFORMED       A35813 39400020
         BZ    FINAL                    NO, DONT CLOSE           A35813 39460020
         B     CLOSEUP                  GO CLOSE DCB             A35813 39520020
NOMORE   LA    GR1,27                  NO MORE ALTERNATE TRACKS         39600016
MSG1     BAL   GR4,MSGBLD              GO SET UP MESSAGE                39900016
         MVC   0(8,GR1),DDNAME2        PUT DDNAME IN MESSAGE            40200016
PRNTM    BAL   GR5,MSGPRNT             GO PRINT MESSAGE        @Z30RSAG 40500032
CODESET  BAL   GR5,FREEMN              FREE BUFFER IF 3350     @Z30RSAG 40550032
         LA    GR15,8                  SET UP RETURN CODE/ERR  @Z30RSAG 40580032
         TM    DCBOFLGS,X'10'          WAS OPENED PERFORMED             40660016
         BZ    FINAL                   NO-DON'T CLOSE                   40740016
CLOSEUP  LR    GR3,GR15                SAVE RETURN CODE                 40820016
         CLOSE ((7))                                                    40900016
         LR    GR15,GR3                PUT RETURN CODE IN REG 15        40980016
FINAL    L     GR13,GETASAVE+4         RESTORE REGISTER 13              41100016
         RETURN (14,12),T,RC=(15)      RETURN WITH PROPER CODE          41400016
SWITCH1  NOP   UNUSABLE                SWITCH FOR WARNING MESSAGE FOR   41460016
*                                        ALTERNATE ASSIGNED TO VTOC     41520016
*                                        MESSAGE WRITING.               41600016
SYSRES   LA    GR1,14                  IS A SYSTEMS RESIDENCE VOLUME    41700016
         BAL   GR4,MSGBLD              GO SET UP MESSAGE                41800016
         MVC   0(8,GR1),DDNAME2        PUT DDNAME IN MESSAGE            41900016
         MVC   MESS+8(10),MODNAME                                       42000016
         LA    GR5,CODESET             SET UP FOR BRANCH AFTER PRINT    42100016
         B     MSGPRNT                 GO PRINT MESSAGE                 42200016
MSGBLD   LINK  EP=IEHDMSGB             GO SET UP MESSAGE                42300016
         BR    GR4                     CONTINUE PROCESSING              42400016
TERM     EQU  *                                                 YL02912 42450002
         LA   GR1,MESS57               INDICATE GETALT DENIED.  YL02912 42460002
         BAL  GR4,MSGBLD               GO BUILD MESSAGE.        YL02912 42470002
         MVC  D0(L8,GR1),DDNAME2       PUT DDNAME IN MESSAGE.   YL02912 42480002
         MVC  MESS+D8(L6),MODNAME      OVERLAY FUNCTION NAME.   YL02912 42490002
         LA   GR5,CODESET              SET BRANCH AFTER PRINT.  YL02912 42492002
MSGPRNT  LINK  EP=IEHDPRNT             GO PRINT MESSAGE                 42500016
         BR    GR5                     CONTINUE PROCESSING              42600016
         DROP  7                                                        42700016
         AIF   ('&LIB' EQ 'LIB2').X225603                       XL03145 42800003
         USING DATACELL,9                                               42900016
YES2321  MVC   40(6,GR1),DCELVOLI      PLACE 232U SERIAL IN MESSAGE     43100016
         B     SETMSG                  GO WRITE OUT THE MESSAGE.        43300016
         DROP  9                                                        43500016
.X225603 ANOP                                                   XL03145 43600003
LIST     DS    0F            FOR READ IN JFCB                           43800016
         DC    X'87'                                                    44100016
         DC    AL3(0)                                                   44400016
OPENLD   RDJFCB (,(OUTPUT)),MF=L       PARAMETER LIST FOR OPEN          44500016
PARMLIST DC    X'1F'                   PARAMETER LIST FOR SVC           44550016
         DC    AL3(0)                                                   44600016
         DC    1F'0'                                           @Z30RSAG 44650032
DATAREA  DC    F'0'                                            @Z30RSAG 44660032
         DC    X'80'                                                    44700016
         DC    AL3(0)                                                   44750016
BITPAT   DC    X'76B3BD1FAAAAFFFF'                             @Z30RSAG 44760032
EIGHT    DC    H'8'                                            @Z30RSAG 44770032
TTABLE   DC    C'0123456789ABCDEF'     TRANSLATE TABLE                  44800016
MSGCON   DC    C'82,'                  SVC NO. FOR I/O ERROR MESSAGE    44850016
MODNAME  DC    C'GETALT FOR'           NAME OF MODULE                   44940016
GETALTNM DC    C'GETALT'                FUNCTION NAME          @G32DSPD 44942032
RC8      DC    AL1(8)                   RETURN CODE 8          @G32DSPD 44962032
GETASAVE DS    18F                     SAVE AREA                        45000016
TRKZERO  DC    F'0'                                                     45300016
RDDCBAD  DC    A(RDDCB)                DCB ADDRESS.                     45600016
D0       EQU   0                        DISPLACEMENT VALUE 0    YL02912 45650002
D4       EQU   4                        DISPLACEMENT VALUE 4    YL02912 45700002
D8       EQU   8                        DISPLACEMENT VALUE 8    YL02912 45750002
D12      EQU   12                       DISPLACEMENT VALUE 12   YL02912 45800002
MSG66I   EQU   66                       IEH866I OFFSET         @G32DSPD 45802032
L6       EQU   6                        LENGTH VALUE OF 6.      YL02912 45842032
L8       EQU   8                        LENGTH VALUE OF 8.      YL02912 45900002
ZERO     EQU   0                        IMMEDIATE CONSTANT.     YL02912 45950002
MESS57   EQU   57                       MESSAGE IEH857I.        YL02912 46000002
VOL      EQU   70                       DISPLACEMENT FOR VOLID. YL02912 46010002
JJJ      EQU   77                       DISPLACEMENT FOR JOB.   YL02912 46020002
SSS      EQU   86                       DISPLACEMENT FOR STEP.  YL02912 46030002
ERJJ     EQU   56                       DISPLACEMENT FOR JOB.   YL02912 46040002
ERSS     EQU   65                       DISPLACEMENT FOR STEP.  YL02912 46042002
WTORECB  DC    F'0'                     ECB FOR WTOR INST.      YL02912 46050002
ALTER    EQU   82                                                       47600016
ZEUS1    EQU   X'06'                                             S20201 48200020
ZEUS2    EQU   X'07'                                             S20201 48250000
MERLN    EQU   X'09'                   3330 ID                   A49434 48300000
D3350    EQU   X'0B'                   3350 DEVICE TYPE        @Z30RSAG 48350032
         AIF   ('&LIB' EQ 'LIB1').X228310                       XL03130 48400003
WIN      EQU   X'0A'                   3340 DEVICE TYPE.        XL03130 48500003
.X228310 ANOP                                                   XL03130 48600003
K2314    EQU   X'08'                   2314 ID                  XL03145 48700003
         AIF   ('&LIB' EQ 'LIB1').OSDCB                                 48820000
RDDCB    DCB   DSORG=PS,MACRF=(E),DEVD=DA,EXLST=LIST,EOEA=P8,    M5431 F48850000
               SIOA=P7,PGFX=YES                                  M5431  48900000
         AGO   .C1                                                      48950000
.OSDCB   ANOP                                                           49000000
RDDCB    DCB   DSORG=PS,MACRF=(E),DEVD=DA,EXLST=LIST,EOEA=P8            49050000
.C1      ANOP                                                           49100000
MAINT    DS    50F                     PATCH AREA.              US02492 49150002
REPLY    DS   CL1                      AREA FOR WTOR REPLY.     YL02912 49150102
RACVOL   DS   CL6                      VOL SER FOR RACHECK     @G32DSPD 50150132
         EJECT                                                          52900016
         IEHDWORK                                                       59900016
         EJECT                                                          66900016
         IEHDBLKS                                                       73900016
VLABEL   DSECT                                                          85800016
VOLUME   DS    CL3                     LABEL IDENTIFIER.                86100016
VOLNO    DS    CL1                     LABEL NUMBER.                    86400016
SERIAL   DS    CL6                     LABEL SERIAL NUMBER.             86700016
SECURITY DS    CL1                     VOLUME SECURITY.                 87000016
VTOCPTR  DS    CL10                    POINTER TO VTOC                  87300016
         DS    CL20                    RESERVED.                        87600016
OWNER    DS    CL10                    OWNER IDENTIFICATION.            87900016
         DS    CL29                    BLANK.                           88200016
         EJECT                                                          88250002
CVT      DSECT                                                          88300002
         CVT                                                            88350032
         EJECT                                                          88600016
         ICHPRCVT                                              @ZA25515 88650099
         EJECT                                                          88700099
UCB      DSECT                                                          89100016
         IEFUCBOB                                                       89400016
         EJECT                                                          89500016
JFCB     DSECT                                                          89700016
         IEFJFCBN                                                       90000016
         EJECT                                                          90100016
         DCBD  DSORG=PS                                                 90300016
         END                                                            90600016
