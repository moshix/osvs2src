         TITLE 'IEHDINIT -- INITIALIZATION MODULE FOR IEHDREST'         00100002
         COPY  LCGASMSW                                                 00110002
IEHDINIT CSECT                                                          00150002
*                                                                     * 00200002
*D 185600-900                                                  @ZM42083 00200403
*STATUS CHANGE LEVEL 001                                              * 00250002
*                                                                     * 00300002
*A111230                                                       @ZM40088 00302003
*A111214-111222                                                @ZM40425 00304003
*D111230                                                       @ZM40425 00306003
*FUNCTION/OPERATION- THIS ROUTINE WILL INITIALIZE THE CONTROL BLOCKS  * 00350002
*   AND WORK AREAS FOR THE RESTORE FUNCTION. THE DATA CONTROL BLOCKS  * 00400002
*   ARE OPENED AND THE 'TO' DEVICE IS TESTED FOR UNEXPIRED AND/OR     * 00450002
*   PASSWORD PROTECTED DATA SETS.                                     * 00500002
*                                                                     * 00550002
*ENTRY POINTS-  THE ONLY ENTRY POINT IS -IEHDINIT-, AND CONTROL IS    * 00600002
*   ALWAYS RECEIVED FROM THE MONITOR ROUTINE(IEHDASDS).               * 00650002
*                                                                     * 00700002
*INPUT-  POINTERS TO A WORKAREA(REGISTER 12) AND TO A CONTROL         * 00750002
*   BLOCK(REGISTER 10).                                               * 00800002
*                                                                     * 00850002
*EXITS-NORMAL- A SUCCESSFUL RESTORE RESULTS IN A RETURN TO THE        * 00900002
*   MONITOR(IEHDASDS) WITH A RETURN CODE OF 0. A RESTORE COMPLETE     * 00950002
*   MESSAGE IS ALSO PLACED IN THE MESSAGE DATA SET.                   * 01000002
*                                                                     * 01050002
*EXITS-ERROR-  ANY ERROR ENCOUNTERED IS DESCRIBED BY AN APPROP-       * 01100002
*   IATE MESSAGE TO THE MESSAGE DATA SET. A RETURN CODE GREATER       * 01150002
*   THAN ZERO WILL ALSO BE PASSED BACK TO THE MONITOR.                * 01200002
*                                                                     * 01250002
*EXTERNAL ROUTINES-  THIS ROUTINE IS ALWAYS ENTERED FROM THE          * 01300002
*   MONITOR ROUTINE (IEHDASDS). ALL MESSAGES ARE BUILT BY -IEHDMSGB-  * 01350002
*   AND WRITTEN OUT BY -IEHDPRNT-. ALL DEVICE CONSTANTS REFERENCED    * 01400002
*   ARE IN -IEHDCONS-. EXPIRATION DATE AND SECURITY TESTS ARE MADE    * 01450002
*   BY -IEHDPASS-. THE ACTUAL RESTORE FUNCTION IS EXECUTED IN         * 01500002
*   MODULE -IEHDREST-.                                                * 01550002
*                                                                     * 01600002
*TABLES/WORK AREAS-  UPON ENTRY, REGISTERS 10 AND 12 POINT TO A       * 01650002
*   FUNCTION BLOCK AND WORK AREA RESPECTIVELY. THEY ARE DESCRIBED     * 01700002
*   IN THE DSECTS CALLED -FUNCBLK- AND -WORK-.                        * 01750002
*   THIS ROUTINE MUST ALSO SECURE BUFFER SPACE FOR READING IN TAPE    * 01800002
*   RECORDS. THE PROGRAM ATTEMPTS TO GET TWO BUFFERS BUT CAN GET      * 01850002
*   BY WITH ONE.                                                      * 01900002
*   IF COPIES ARE BEING MADE FROM THE RESTORE TAPE, THERE WILL ALSO   * 01950002
*   BE ONE OR MORE COPY BLOCKS CHAINED FROM THE FUNCTION BLOCK. SEE   * 02000002
*   THE -COPYBLK- DSECT FOR A DESCRIPTION.                            * 02050002
*                                                                     * 02100002
*ATTRIBUTES- SERIALLY REUSABLE,RELOCATABLE                            * 02150002
*                                                                     * 02200002
*********************************************************************** 02250002
         EJECT                                                          02300002
*********************************************************************** 02350002
*                                                                     * 02400002
*   THE FOLLOWING ARE REGISTER ASSIGNMENTS.                           * 02450002
*                                                                     * 02500002
*********************************************************************** 02550002
         SPACE                                                          02600002
GR0      EQU   0                                                        02650002
GR1      EQU   1                                                        02700002
GR2      EQU   2                                                        02750002
GR3      EQU   3                                                        02800002
GR4      EQU   4                                                        02850002
GR5      EQU   5                                                        02900002
GR6      EQU   6                                                        02950002
GR7      EQU   7                                                        03000002
GR8      EQU   8                                                        03050002
GR9      EQU   9                                                        03100002
GR10     EQU   10                                                       03150002
GR11     EQU   11                                                       03200002
GR12     EQU   12                                                       03250002
GR13     EQU   13                                                       03300002
GR14     EQU   14                                                       03350002
GR15     EQU   15                                                       03400002
UCBPTR   EQU   9                                                        03450002
BASEREG  EQU   11                                                       03500002
K0       EQU   0                       DISPLACEMENT CONSTANT.           03550002
         SPACE 3                                                        03600002
*********************************************************************** 03650002
*                                                                     * 03700002
*   MESSAGE REFERENCES.                                               * 03750002
*                                                                     * 03800002
*********************************************************************** 03850002
         SPACE                                                          03900002
MESS5    EQU   5                       MESSAGE IEH805                   03950002
MESS10   EQU   10                      MESSAGE IEH810                   04000002
MESS11   EQU   11                      MESSAGE IEH811                   04050002
MESS13   EQU   13                      MESSAGE IEH813                   04100002
MESS14   EQU   14                      MESSAGE IEH814                   04150002
MESS21   EQU   21                      MESSAGE IEH821                   04200002
MESS30   EQU   30                      MESSAGE IEH830                   04250002
         EJECT                                                          04300002
         USING FUNCBLK,GR10                                             04350002
         USING IEHINIT,BASEREG                                          04400002
         USING WORK,GR12                                                04450002
         SPACE 1                                                        04500002
IEHINIT  SAVE  (14,12),T               SAVE THE REGISTERS.              04550002
         LR    BASEREG,GR15            LOAD THE BASE REGISTER.          04600002
         LA    GR7,INITSAVE            SAVE AREA ADDRESS.               04650002
         ST    GR7,8(GR13)             ADDRESS OF NEW AREA TO OLD.      04700002
         ST    GR13,4(GR7)             ADDRESS OF OLD AREA TO NEW.      04750002
         LR    GR13,GR7                LOAD SAVE AREA ADDRESS.          04800002
         SPACE 2                                                        04850002
         L     GR3,PTRCFUNC            POINTER TO CURRENT FUNCTION.     04900002
         TM    0(GR3),PROCESS          PREVIOUSLY UNDER WAY?            04950002
         BZ    START2                  NO--START FROM THE BEGINNING.    05000002
         B     CALLREST                RETURN TO IEHDREST.              05050002
         EJECT                                                          05100002
*********************************************************************** 05150002
*                                                                     * 05200002
*   ESTABLISH ADDRESSABILITY TO PROPER DEVICE CONSTANTS.              * 05250002
*                                                                     * 05300002
*********************************************************************** 05350002
START2   L     UCBPTR,TUCBPTR          TO-UCB ADDRESS.                  05400002
         USING UCB,9                                                    05450002
         LA    GR8,DDNAME2             USED ON ERROR ONLY.              05500002
         TM    UCBTBYT3,UCB3DACC       IS THIS A DIRECT ACCESS DEVICE.  05550002
         BZ    BADPARM                 NO--MUST BE BAD PARAMETER.       05600002
         TM    SRTESTAT,SRTESYSR       THIS A SYSTEMS RESIDENCE VOLUME. 05650002
         BO    BADDEV                  YES-THIS IS NOT ALLOWED.         05700002
         SR    GR3,GR3                 CLEAR.                           05750002
         AIF   ('&LIB' EQ 'LIB1').WIN01 BRCH IF OS ASSEM                05800002
         CLI   UCBTBYT4,WINCH           WINCHESTER DEVICE ?             05850002
         BNE   WINNO                    NO, BRCH                        05900002
         IC    GR3,ODEVMOD              INSERT WINCH. MODEL NO.         05950002
         B     WINYES                   CONTINUE                        06000002
WINNO    EQU   *                                                        06050002
.WIN01   ANOP                          BRCH POINT FOR OS ASSEM          06100002
         IC    GR3,UCBTBYT4            UCB DEVICE TYPE CODE.            06150002
WINYES   EQU   *                                                        06200002
         LA    GR5,KDEVSIZE            SIZE OF EACH DEVICE ENTRY.       06250002
         BCTR  GR3,0                   DECREMENT FOR PROPER INDEX.      06300002
         MR    GR4,GR3                 ENTRY SIZE TIMES INDEX VALUE.    06350002
         L     GR4,IODEVCON            BEGIN ADDRESS OF DEVICE CONSTANT 06400002
         AR    GR4,GR5                 ADDRESS OF CONSTANTS THIS DEVICE 06450002
         ST    GR4,IODEVCON            SAVE IN FUNCTION BLOCK.          06500002
         MVC   IODEVCON(1),UCBTBYT4    UCB DEVICE TYPE CODE.            06550002
         TM    UCBTBYT2,RPS            TODD HAVE RPS                    06600002
         BZ    STARTIO                 NO                               06650002
         OI    SEQSW+D1,RPSFEAT        YES SET RPS SWITCH               06700002
STARTIO  EQU   *                                                        06750002
         OC    COPYPTR(4),COPYPTR      ARE THERE COPIES.                06800002
         BZ    START5                  NO--GO GET BUFFER SPACE.         06850002
         L     GR8,COPYPTR             YES-COPY BLOCK ADDRESS.          06900002
         USING COPYBLK,GR8                                              06950002
START9   L     UCBPTR,CUCBPTR          ADDRESS OF COPY UCB.             07000002
         TM    UCBTBYT3,UCB3DACC       IS THIS A DIRECT ACCESS DEVICE.  07050002
         BZ    BADPARM                 NO--INVALID PARAMETER.           07100002
         TM    SRTESTAT,SRTESYSR       IS THIS SYSTEMS RESIDENCE.       07150002
         BO    BADDEV                  YES-NOT ALLOWED.                 07200002
         CLC   IODEVCON(1),UCBTBYT4    SAME DEVICE TYPE AS PRIMARY.     07250002
         BNE   BADCOPY                 NO--INCONSISTANT                 07300002
         OC    CCOPYPTR(4),CCOPYPTR    ARE THERE MORE COPIES.           07350002
         BZ    START5                  NO--GO START PROCESSING.         07400002
         L     GR8,CCOPYPTR            ADDRESS OF NEXT COPY.            07450002
         B     START9                  GO PROCESS THIS COPY.            07500002
         DROP  8,9                                                      07550002
         EJECT                                                          07600002
*********************************************************************** 07650002
*                                                                     * 07700002
*   THIS SECTION ATTEMPTS TO OBTAIN CORE BUFFERS FOR READING IN THE   * 07750002
*     RECORDS FROM THE RESTORE TAPE. IF TWO BUFFERS ARE OBTAINED, A   * 07800002
*     SWITCH IS SET TO INDICATE THIS. IF NO BUFFERS ARE OBTAINED,     * 07850002
*     THE 'NOCORE SWITCH IS SET FOR THAT FUNCTION.                    * 07900002
*                                                                     * 07950002
*********************************************************************** 08000002
         SPACE 1                                                        08050002
         USING CONSTANT,9                                               08100002
START5   L     GR9,IODEVCON            ADDRESSING FOR DEVICE CONSTANTS. 08150002
         LH    GR2,RBUFSIZE            SIZE PER BUFFER/THIS DEVICE.     08200002
         LA    GR3,BUFFPTR1            SAVE ADDRESS OF BUFFER 1 HERE.   08250002
         BAL   GR14,GETBUFF            GO GET 1ST BUFFER.               08300002
         DROP  9                                                        08350002
         SPACE 1                                                        08400002
         LTR   GR15,GR15               WAS CORE AVAILABLE FOR BUFFER.   08450002
         BZ    TRYTWO                  YES--SEE IF SECOND BUFFER AVAIL. 08500002
         SPACE 1                                                        08550002
         L     GR3,PTRCFUNC            NO--POINTER TO CURRENT FUNCTION. 08600002
         OI    0(GR3),NOCORE           INDICATE NO CORE AVAILABLE.      08650002
         LA    GR15,4                  SET RETURN CODE.                 08700002
         B     FINAL3                  RETURN TO MONITOR.               08750002
         SPACE 1                                                        08800002
GETBUFF  GETMAIN EC,LV=(2),A=(3)       GET CORE FOR A BUFFER.           08850002
         BR    GR14                    RETURN.                          08900002
         SPACE 1                                                        08950002
TRYTWO   LA    GR3,BUFFPTR2            SAVE ADDRESS OF BUFFER 2 HERE.   09000002
         BAL   GR14,GETBUFF            GO TRY TO GET A 2ND BUFFER.      09050002
         LTR   GR15,GR15               WAS CORE AVAILABLE FOR SECOND.   09100002
         BP    SETUPBLK                GO SET UP THE CONTROL BLOCKS.    09150002
         MVI   BUFFSW,X'FF'            SET SWITCH TO SHOW TWO BUFFERS.  09200002
         EJECT                                                          09250002
*********************************************************************** 09300002
*                                                                     * 09350002
*   THIS ROUTINE MOVES THE NECESSARY I/O CONTROL BLOCKS INTO THE      * 09400002
*     SPECIFIED BUFFER. IT ALSO MODIFIES THE NECESSARY POINTERS AND   * 09450002
*     MOVES IN THE DDNAMES TO THE DCBS.                               * 09500002
*                                                                     * 09550002
*********************************************************************** 09600002
         SPACE 1                                                        09650002
SETUPBLK MVC   BLOCKS(RBLKSIZE),RDECB  I/O BLOCKS TO FUNCTION BLOCK.    09700002
         LA    GR9,BLOCKS              ADDRESS OF I/O BLOCKS.           09750002
         USING IOBLOCKS,9                                               09800002
         LA    GR3,TAPEECB             ADDRESS OF ECB.                  09850002
         ST    GR3,TECBAD              SAVE IN IOB.                     09900002
         LA    GR3,TAPEDCB             ADDRESS OF DCB.                  09950002
         ST    GR3,TDCBAD              SAVE IN IOB.                     10000002
         USING IHADCB,GR3                                               10050002
         MVC   DCBDDNAM(8),DDNAME1     MOVE TAPE DDNAME TO DCB.         10100002
         LA    GR3,DISKECB             ADDRESS OF DISK ECB.             10150002
         ST    GR3,DECBAD              SAVE IN IOB.                     10200002
         LA    GR3,DISKDCB             ADDRESS OF DISK DCB.             10250002
         ST    GR3,DDCBAD              SAVE IN IOB.                     10300002
         MVC   DCBDDNAM(8),DDNAME2     MOVE DIRECT ACCESS DDNAME TO DCB 10350002
         ST    GR10,DCBIOBAD           FUNCTION BLOCK ADDRESS TO DCB.   10400002
         L     GR3,BUFFPTR1            ADDRESS OF BUFFER 1.             10450002
         USING RBUFFER,3                                                10500002
         AGO   .SPEED1                                                  10520003
         LA    GR3,CCWBUFF             SLOT TO READ IN CCW RECORD.      10550002
.SPEED1  ANOP                                                           10560003
         LA    GR3,CCWBUFF             CLEAR HI BYTE.          @ZM00000 10570003
         ST    GR3,RDVDATA             SET ADDRESS IN READ DSCB CCW.    10600002
         MVI   RDVDATA,X'06'           RESET THE OP CODE.               10650002
         ST    GR3,TAPECCW1            SET ADDRESS IN TAPE CCW.         10700002
         MVI   TAPECCW1,2              RESET THE OP CODE.               10750002
         L     GR15,IODEVCON           ADDRESSING FOR DEVICE CONSTANTS. 10800002
         USING CONSTANT,15                                              10850002
         AH    GR3,CCWSIZE             ADDRESS TO READ IN DATA.         10900002
         ST    GR3,TAPEDAT1            SET ADDRESS IN TAPE CCW.         10950002
         MVI   TAPEDAT1,2              RESET THE OP CODE.               11000002
         MVC   TAPECCW1+6(2),CCWSIZE   SET TAPE CCW COUNT FOR MAXIMUM.  11050002
         MVC   TAPEDAT1+6(2),DATASIZE  SET TAPE CCW COUNT FOR MAXIMUM.  11100002
         CLI   BUFFSW,ON               THIS A BUFFERED OPERATION.       11150002
         BNE   TESTCOPY                NO--GO CHECK FOR COPIES.         11200002
         L     GR3,BUFFPTR2            YES-BUFFER 2 ADDRESS.            11250002
         USING RBUFFER,3                                                11300002
         ST    GR3,TAPECCW2            SET UP TAPE READ CCW.            11400002
         MVI   TAPECCW2,2              RESET THE OP CODE.               11450002
         AH    GR3,CCWSIZE             SLOT TO READ IN DATA.            11500002
         ST    GR3,TAPEDAT2            SET UP TAPE READ CCW.            11550002
         MVI   TAPEDAT2,2              RESET THE OP CODE.               11600002
         MVC   TAPECCW2+6(2),CCWSIZE   SET TAPE CCW COUNT FOR MAXIMUM.  11650002
         MVC   TAPEDAT2+6(2),DATASIZE  SET TAPE CCW COUNT FOR MAXIMUM.  11700002
         EJECT                                                          11750002
TESTCOPY EQU   *                                                        11800002
         OC    COPYPTR(4),COPYPTR      ARE THERE COPIES.                11850002
         BZ    TESTTAPE                NO--GO START ON THE TAPE.        11900002
         DROP  9                                                        11950002
         L     GR9,COPYPTR             YES-POINTER TO FIRST COPY BLOCK. 12000002
         USING COPYBLK,GR9                                              12050002
MORE2    MVC   CIOBLOCK(116),RDECB     MOVE IN THE I/O CONTROL BLOCKS.  12100002
         LA    GR7,CIOBLOCK            ADDRESS OF COPY I/O BLOCKS.      12150002
         USING IOBLOCKS,GR7                                             12200002
         LA    GR3,DISKECB             COPY ECB ADDRESS.                12250002
         ST    GR3,DECBAD              STORE IN COPY IOB.               12300002
         LA    GR3,DISKDCB             COPY DCB ADDRESS.                12350002
         USING IHADCB,GR3                                               12400002
         ST    GR3,DDCBAD              DCB ADDRESS TO IOB.              12450002
         MVC   DCBDDNAM(8),DDNAME3     DDNAME TO DCB.                   12500002
         ST    GR10,DCBIOBAD           FUNCTION BLOCK ADDRSS TO DCB.    12550002
         OC    CCOPYPTR(4),CCOPYPTR    ARE THERE MORE COPIES.           12600002
         BZ    TESTTAPE                NO--GO START ON THE TAPE.        12650002
         L     GR9,CCOPYPTR            YES-ADDRSSS OF NEXT COPY BLOCK.  12700002
         B     MORE2                   GO PROCESS MORE COPIES.          12750002
         DROP  3,7,9,15                                                 12800002
         EJECT                                                          12850002
*********************************************************************** 12900002
*                                                                     * 12950002
*   THIS ROUTINE OPENS THE DATA CONTROL BLOCKS FOR ALL DIRECT         * 13000002
*     ACCESS DEVICES INVOLVED. OPEN IS ALWAYS PERFORMED ON THE        * 13050002
*     FORMAT 4 DSCB OF THE VTOC.                                      * 13100002
*                                                                     * 13150002
*        REGISTERS 2,5,8,9 ARE WORK REGISTERS.                        * 13200002
*        REGISTER  14 IS THE RETURN REGISTER.                         * 13250002
*                                                                     * 13300002
*********************************************************************** 13350002
         SPACE 2                                                        13400002
OPENJ    MVC   LIST+1(3),BUFFPTR1+1    BUFFER ADDRESS TO READ JFCB LIST 13450002
         OC    COPYPTR(4),COPYPTR      COPIES//MORE THAN ONE TO OPEN.   13500002
         BZ    OPEN3                   NO--JUST OPEN ON ONE DEVICE.     13550002
         L     GR9,COPYPTR             ADDRESS OF 1ST OR ONLY COPY.     13600002
         USING COPYBLK,GR9                                              13650002
OPEN2    LA    GR8,CIOBLOCK            I/O BLOCKS//THIS DEVICE.         13700002
         BAL   GR2,OPEN1               GO OPEN THE DCB FOR THIS DEVICE. 13750002
         OC    CCOPYPTR(4),CCOPYPTR    ARE THERE MORE COPIES.           13800002
         BZ    OPEN3                   NO--GO OPEN THE FIRST DEVICE.    13850002
         L     GR9,CCOPYPTR            ADDRESS OF NEXT COPY BLOCK.      13900002
         B     OPEN2                   REPEAT OPENJ ON OTHER DEVICES.   13950002
OPEN3    LA    GR8,BLOCKS              I/O BLOCKS FOR UNIT DEVICE.      14000002
         BAL   GR2,OPEN1               GO OPEN DCB FOR UNIT DEVICE.     14050002
         BR    GR14                    RETURN.                          14100002
         DROP  GR9                                                      14150002
         SPACE                                                          14200002
         USING IOBLOCKS,GR8                                             14250002
OPEN1    MVC   OPENLD+1(3),DDCBAD+1    DA DCB ADDRESS FOR OPEN LIST.    14300002
         RDJFCB MF=(E,OPENLD)                                           14350002
         L     GR5,BUFFPTR1            ADDRESS JFCB WAS READ INTO.      14400002
         USING JFCB,GR5                                                 14450002
         MVI   JFCBDSNM,X'04'          SET DSNAME FIELD FOR             14500002
         MVC   JFCBDSNM+1(43),JFCBDSNM   FORMAT 4 DSCB.                 14550002
         MVI   JFCBTSDM,X'08'          PREVENT WRITE-BACK OF JFCB.      14600002
         OPEN  MF=(E,OPENLD),TYPE=J                                     14650002
         L     GR5,OPENLD              DIRECT ACCESS DCB ADDRESS.       14700002
         USING IHADCB,5                                                 14750002
         TM    DCBOFLGS,X'10'          WAS THERE A SUCCESSFUL OPEN.     14800002
         BZ    NOOPEN                  NO--GIVE AN ERROR MESSAGE.       14850002
         NI    DCBMACRF+1,X'F3'        SET BITS OFF TO PREVENT CLOSE    14900002
*                                        FROM WRITING AN EOF RECORD     14950002
*                                        AND UPDATING THE DSCB.         15000002
         BR    GR2                     RETURN.                          15050002
         DROP  GR5,GR8                                                  15100002
         EJECT                                                          15150002
*********************************************************************** 15200002
*                                                                     * 15250002
*   THIS ROUTINE OPENS THE TAPE FOR INPUT.                            * 15300002
*                                                                     * 15350002
*********************************************************************** 15400002
         SPACE                                                          15450002
TESTTAPE L     UCBPTR,FUCBPTR          FROM UCB ADDRESS.                15500002
         USING UCB,9                                                    15550002
         TM    UCBTBYT3,UCB3TAPE       IS THIS A TAPE DEVICE.           15600002
         BZ    BADTAP                  NO--MUST BE BAD PARAMETER.       15650002
         LH    GR8,SRTEFSCT            TAPE DATA SET SEQ. COUNT.        15700002
         LA    GR9,BLOCKS              ADDRESS OF I/O BLOCKS.           15750002
         USING IOBLOCKS,9                                               15800002
         SPACE 1                                                        15850002
         L     GR5,TDCBAD              TAPE DCB ADDRESS.                15900002
         OPEN  ((5),(INPUT))           OPEN TAPE DCB.                   15950002
         L     GR5,TDCBAD              TAPE DCB ADDRESS.                16000002
         USING IHADCB,GR5                                               16050002
         TM    DCBOFLGS,X'10'          WAS THERE A SUCCESSFUL OPEN.     16100002
         BZ    NOOPEN                  NO--GIVE AN ERROR MESSAGE.       16150002
         MVC   LIST+1(3),BUFFPTR1+1    BUFFER ADDRESS TO DCB LIST.      16200002
         L     GR5,TDCBAD              TAPE DCB ADDRESS.                16250002
         RDJFCB ((5))                  READ JFCB FOR TAPE.              16300002
         L     GR3,BUFFPTR1            ADDRESS OF JFCB.                 16350002
         USING JFCB,3                                                   16400002
         MVC   VOLNUMB,JFCBVLCT        MOVE VOL CNT TO WORKAREA SA65804 16450002
         OC    VOLNUMB,JFCBNVOL        ALSO VOL SER COUNT.       YM7437 16460002
         TM    JFCBLTYP,X'11'          UNLABELED OR BLP TAPE.           16500002
         BC    5,PROCDA                YES--MUST BE SOME KIND OF LABEL. 16550002
         OI    SWITCH,STDLABEL         INDICATE USING NL TAPE(S).       16600002
         DROP  3                                                        17100002
PROCDA   BAL   GR14,OPENJ              GO OPEN ON DIRECT ACCESS DEVICE. 17150002
         LA    GR9,BLOCKS              I/O CONTROL BLOCKS.              17200002
         BAL   GR14,FORMAT4            GO READ IN THE FORMAT 4.         17250002
         MVC   ALTDATA(6),0(GR3)       SAVE THE ALTERNATE DATA.         17300002
         OC    COPYPTR(4),COPYPTR      ARE THERE COPIES.                17350002
         BZ    CALLREST               NO--GO MAKE SECURITY TEST.        17400002
         L     GR7,COPYPTR             YES-POINTER TO FIRST COPY.       17450002
         USING COPYBLK,GR7                                              17500002
MORE4    EQU   *                                                OX03063 17510002
         LTR   GR7,GR7                 COPIES ?                 OX03063 17520002
         BZ    CALLREST                NO, CALL IEHDREST        OX03063 17530002
         LA    GR9,CIOBLOCK            ADDRESS OF I/O BLOCKS.   OX03063 17550002
         BAL   GR14,FORMAT4            GO READ IN THE FORMAT4.          17600002
         MVC   CALTDATA(6),0(GR3)      SAVE THE ALTERNATE DATA.         17650002
         OC    CCOPYPTR(4),CCOPYPTR    ARE THERE MORE COPIES.           17700002
         BZ    CALLREST               NO--GO MAKE SECURITY TEST OX03063 17750002
         L     GR7,CCOPYPTR            YES-POINTER TO NEXT COPY.        17800002
         B     MORE4                   GO READ IN THE FORMAT FOUR.      17850002
         EJECT                                                          18200002
*********************************************************************** 18250002
*                                                                     * 18300002
*        IEHDREST IS CALLED AT THIS POINT                             * 18350002
*                                                                     * 18400002
*********************************************************************** 18450002
         SPACE 2                                                        18500002
CALLREST EQU   *                                                        18550002
VOLRST   CALL  IEHDREST                 GO TO RESTORE MODULE   @ZM00000 18600003
         SPACE 2                                                        18650003
RSTRTN   ST    GR15,RETCODE             SAVE RETURN CODE       @ZM00000 18700003
         L     GR3,PTRCFUNC             POINTER TO CURRENT FUNCTION.    18750002
         TM    0(GR3),COMPLETE          IS FUNCTION COMPLETE?           18800002
         BO    CLOSE                    YES, CLOSE DCB AND FREE CORE.   18850002
         SPACE                                                          18900002
         LA    GR15,0                   NO, SET RETURN CODE FOR MONITOR 18950002
         B     FINAL3                   RETURN TO MONITOR.              19000002
         EJECT                                                          19050002
*********************************************************************** 19100002
*                                                                     * 19150002
*   THIS SECTION READS IN THE FORMAT 4 DSCB FROM THE VTOC.            * 19200002
*   THE ALTERNATE TRACK INFORMATION IS SAVED FOR THAT VOLUME.         * 19250002
*                                                                     * 19300002
*   REGISTER 3 WILL RETURN A POINTER TO THE 6 BYTES OF ALTERNATE DATA.* 19350002
*   REGISTER 9 MUST POINT TO THE I/O CONTROL BLOCKS FOR THIS DEVICE.  * 19400002
*   REGISTER 14 IS THE RETURN REGISTER.                               * 19450002
*********************************************************************** 19500002
         SPACE 1                                                        19550002
         USING IOBLOCKS,9                                               19600002
         USING IHADCB,GR8                                               19650002
FORMAT4  LA    GR8,DISKDCB             ADDRESS FOR DCB.                 19700002
         L     GR1,DCBDEBAD            ADDRESS OF DEB.                  19750002
         MVC   CCHH(4),38(GR1)         CCHH OF VTOC TO IOB.             19800002
* GET THE ADDRESS OF THE VTOC  THE FOLLOWING NECESSARY CCHH UNALIGNED   19805003
         MVI   R,1                     SET SEARCH FOR RECORD ONE.       19850002
         LA    GR3,DSEEK+3             SEARCH ADDRESS.                  19900002
         ST    GR3,READVTOC            SEARCH ADDRESS TO SEARCH CCW.    19950002
         MVI   READVTOC,X'31'          RESET THE CCW OP CODE.           20000002
         LA    GR3,READVTOC            CCW ADDRESS//READ VTOC.          20050002
         TM    SEQSW+D1,RPSFEAT        TODD HAVE RPS?                   20100002
         BZ    SETRR                   NO.                              20150002
         LA    GR3,SETCCW              YES,SETUP ADDR OF                20200002
*                                      SET SECTOR CCW FOR IOB.          20250002
         LA    GR1,READVTOC            GET TIC ADDRESS.                 20300002
         ST    GR1,SECTIC              PUT IN TIC.                      20350002
         MVI   SECTIC,X'08'            RESTORE TIC CMD.                 20400002
SETRR    EQU   *                                                        20450002
         ST    GR3,DCCWAD              SET UP IOB.                      20500002
         EXCP  DISKIOB                 READ IN THE FORMAT 4 DSCB.       20550002
         WAIT  ECB=DISKECB             AWAIT COMPLETION.                20600002
         CLI   DISKECB,GOOD            ANY ERRORS.                      20650002
         BNE   IOERR                   NO--I/O ERROR.                   20700002
         MVI   R,0                     RESET RECORD NO. TO ZERO.        20750002
         L     GR3,RDVDATA             ADDRESS OF FORMAT 4 DATA.        20800002
         LA    GR3,8(GR3)              ADDRESS OF ALTERNATE DATA.       20850002
         BR    GR14                    RETURN.                          20900002
         DROP  8,9                                                      20950002
         EJECT                                                          21000002
*********************************************************************** 21050002
*                                                                     * 21100002
*                ALL MESSAGES ARE BUILT HERE.                         * 21150002
*                                                                     * 21200002
*********************************************************************** 21250002
         SPACE                                                          21300002
BADDEV   LA    GR1,MESS14              MESSAGE 814.                     21350002
         BAL   GR9,BUILD               GO MOVE MESSAGE TO BUFFER.       21400002
         MVC   MESS+8(10),FUNCTION     FUNTION TYPE TO MESSAGE.         21450002
BADDEV1  MVC   0(8,GR1),0(GR8)         DDNAME TO MESSAGE.               21500002
         B     MSGWRT                  GO WRITE OUT THE MESSAGE.        21550002
         SPACE 1                                                        21600002
BADPARM  LA    GR1,MESS10              MESSAGE 810.                     21650002
         BAL   GR9,BUILD               GO MOVE MESSAGE TO BUFFER.       21700002
         B     BADDEV1                 COMPLETE MESSAGE AND WRITE OUT.  21750002
         SPACE                                                          21800002
BADCOPY  LA    GR1,MESS21              MESSAGE 821.                     21850002
         BAL   GR9,BUILD               PLACE MESSSAGE IN BUFFER.        21900002
         USING COPYBLK,GR8                                              21950002
         MVC   0(8,GR1),DDNAME3        PLACE DDNAME IN MESSAGE.         22000002
         B     MSGWRT                  GO WRITE OUT THE MESSAGE.        22050002
         DROP  GR8                                                      22100002
         SPACE                                                          22150002
         USING IOBLOCKS,GR9                                             22200002
IOERR    LA    GR3,DISKIOB             IOB ADDRESS.                     22250002
         DROP  9                                                        22300002
         LA    GR1,MESS13              MESSAGE 813.                     22350002
         BAL   GR9,BUILD               PLACE MESSAGE HEADING IN BUFFER. 22400002
         LR    GR1,GR3                 IOB ADDRESS.                     22450002
         SYNADAF ACSMETH=EXCP,PARM1=(1)                                 22500002
         MVC   MESS+22(78),49(GR1)     MOVE SYNAD MESS TO BUFFER SM4350 22550002
         SYNADRLS                                                       22600002
         BAL   GR9,MSGWRT1             WRITE OUT I/O ERROR MSG.         22650002
UNUSABLE LA    GR3,DDNAME2             DDNAME FOR MESSAGE.              22700002
         BAL   GR4,MSGWRTA             GO TO SET UP AND PRINT MESSAGE.  22750002
         OC    COPYPTR(4),COPYPTR      ANY COPIES.                      22800002
         BZ    FINAL4                  NO--BRANCH.                      22850002
         USING COPYBLK,GR3                                              22900002
         L     GR3,COPYPTR             PTR TO 1ST OR ONLY COPY BLK.     22950002
UNUSE    BAL   GR4,MSGWRTA             GO TO SET UP AND PRINT MSG.      23000002
         OC    CCOPYPTR(4),CCOPYPTR    MORE COPIES.                     23050002
         BZ    FINAL4                  NO--BRANCH.                      23100002
         L     GR3,CCOPYPTR            YES-PTR TO NEXT COPY BLK.        23150002
         B     UNUSE                   CONTINUE PROCESSING.             23200002
         SPACE                                                          23250002
BUILD    LINK  EP=IEHDMSGB                                              23300002
         BR    GR9                     RETURN.                          23350002
         SPACE                                                          23400002
MSGWRT1  EQU   *                                                        23450002
         LINK  EP=IEHDPRNT             WRITE OUT THE MESSAGE.           23500002
         BR    GR9                     RETURN.                          23550002
         SPACE                                                          23600002
MSGWRTA  LA    GR1,MESS30              MESSAGE 830.                     23650002
         BAL   GR9,BUILD               GO TO SET UP MSG.                23700002
         MVC   0(8,GR1),0(GR3)         DDNAME TO MESSAGE.               23750002
         BAL   GR9,MSGWRT1             GO TO PRINT MSG.                 23800002
         BR    GR4                     RETURN TO CALLER.                23850002
         SPACE                                                          23900002
BADTAP   LA    GR1,MESS11              MESSAGE 811.                     23950002
         BAL   GR9,BUILD               PLACE MESSAGE IN BUFFER.         24000002
         MVC   0(8,GR1),DDNAME1        DDNAME TO MESSAGE.               24050002
         B     MSGWRT                  GO WRITE OUT THE MESSAGE.        24100002
         SPACE                                                          24150002
NOOPEN   LA    GR1,MESS5               MESSAGE 805.                     24200002
         BAL   GR9,BUILD               PLACE MESSAGE IN BUFFER.         24250002
         USING IHADCB,GR5                                               24300002
         MVC   0(8,GR1),DCBDDNAM       MOVE DDNAME TO MESSAGE.          24350002
         DROP  GR5                                                      24400002
         SPACE                                                          24450002
MSGWRT   EQU   *                                                        24500002
         BAL   GR9,MSGWRT1              GO WRITE ERROR MESSAGE.         24550002
FINAL4   EQU   *                                                        24600002
         LA    GR15,8                   SET UP THE RETURN CODE.         24650002
         ST    GR15,RETCODE             SAVE THE RETURN CODE.           24700002
         EJECT                                                          24750002
*********************************************************************** 24800002
*                                                                     * 24850002
*   THIS ROUTINE CLOSES THE DATA CONTROL BLOCKS FOR ALL DIRECT        * 24900002
*     ACCESS DEVICES AND THE ONE TAPE DEVICE USED BY RESTORE. IF      * 24950002
*     THE DCBS HAD NOT BEEN OPENED WHEN THIS ROUTINE IS CALLED,       * 25000002
*     NO ACTION IS PERFORMED.                                         * 25050002
*                                                                     * 25100002
*        REGISTERS 2,5,8,9 ARE WORK REGISTERS.                        * 25150002
*                                                                     * 25200002
*********************************************************************** 25250002
         SPACE 2                                                        25300002
         USING IHADCB,GR5                                               25350002
         USING IOBLOCKS,GR9                                             25400002
CLOSE    LA    GR9,BLOCKS              ADDR PRIMARY I/O BLOCKS.         25450002
         L     GR5,DDCBAD              ADDR. UNIT DCB.                  25500002
         BAL   GR2,CLOSE1              GO TO CLOSE THIS DEVICE.         25550002
         L     GR5,TDCBAD              FROM DCB.                        25600002
         TM    DCBOFLGS,X'10'          DEVICE EVER OPENED.              25650002
         BZ    FINALR1                 NO, GO FREE CORE.                25700002
         OI    DCBOFLGS,X'04'          INDICATE TAPE MARK READ.         25750002
         BAL   GR2,CLOSE2              GO TO CLOSE THIS DCB.            25800002
         OC    COPYPTR(4),COPYPTR      COPIES REQUESTED.                25850002
         BZ    FINALR1                 NO, GO FREE CORE.                25900002
         L     GR8,COPYPTR             PTR. TO FIRST COPY BLOCK.        25950002
         USING COPYBLK,GR8                                              26000002
CLOSEA   LA    GR9,CIOBLOCK            ADDR COPY I/O BLOCK.             26050002
         L     GR5,DDCBAD              ADDR. OF COPY DCB.               26100002
         BAL   GR2,CLOSE1              GO TO CLOSE THIS DCB.            26150002
         OC    CCOPYPTR(4),CCOPYPTR    MORE COPIES?                     26200002
         BZ    FINALR1                 NO, GO FREE CORE.                26250002
         L     GR8,CCOPYPTR            PTR. TO NEXT COPY BLOCK.         26300002
         B     CLOSEA                  CONTINUE TILL ALL DCBS CLOSED.   26350002
         SPACE                                                          26400002
CLOSE1   TM    DCBOFLGS,X'10'          DEVICE EVER OPENED.              26450002
         BCR   8,GR2                   NO--RETURN.                      26500002
CLOSE2   CLOSE ((5))                   CLOSE THIS DCB.                  26550002
         BR    GR2                     RETURN.                          26600002
         DROP  GR5,GR8,GR9                                              26650002
         EJECT                                                          26700002
*********************************************************************** 26750002
*                                                                     * 26800002
*   THIS SECTION FREES THE CORE THAT WAS USED FOR BUFFERS, IF ANY.    * 26850002
*                                                                     * 26900002
*********************************************************************** 26950002
         SPACE                                                          27000002
FINALR1  CLC   BUFFPTR1(4),ZERO        ARE THERE ANY BUFFERS ASSIGNED.  27050002
         BE    FINALR2                 NO--RETURN TO MONITOR.           27100002
         L     GR1,BUFFPTR1            ADDRESS OF FIRST BUFFER.         27150002
         BAL   GR8,FREEBUF             GO FREE BUFFER ONE.              27200002
         CLI   BUFFSW,ON               IS THIS A BUFFERED OPERATION.    27250002
         BNE   FINALR2                 NO--GO RETURN TO MONITOR.        27300002
         L     GR1,BUFFPTR2            ADDRESS OF 2ND BUFFER.           27350002
         BAL   GR8,FREEBUF             GO FREE SECOND BUFFER.           27400002
         B     FINALR2                 RETURN TO MONITOR                27450002
         USING CONSTANT,9                                               27500002
FREEBUF  L     GR9,IODEVCON            ADDRESS OF DEVICE CONSTANTS.     27550002
         LA    GR1,0(GR1)              INSURE HIGH ORDER BYTE CLEARED.  27600002
         LH    GR0,RBUFSIZE            PICK UP BUFFER SIZE.             27650002
         FREEMAIN R,LV=(0),A=(1)       FREE CORE.                       27700002
         BR    GR8                     RETURN.                          27750002
         DROP  GR9                                                      27800002
         SPACE 1                                                        27850002
FINALR2  EQU   *                                                        27900002
         L     GR15,RETCODE            LOAD RETURN CODE                 27950002
         SPACE                                                          28000002
FINAL3   L     GR13,INITSAVE+4         RESTORE REGISTER 13.             28050002
         RETURN (14,12),T,RC=(15)      RESTORE/RETURN W/PROPER CODE.    28100002
         EJECT                                                          28150002
*********************************************************************** 28200002
*                                                                     * 28250002
*                         DEFINED CONSTANTS                           * 28300002
*                                                                     * 28350002
*********************************************************************** 28400002
         SPACE                                                          28450002
OPENLD  RDJFCB (,(OUTPUT)),MF=L        PARAMETER LIST FOR OPEN DA.      28500002
LIST     DS    0F                      FOR READ IN OF JFCB.             28550002
         DC    X'87'                                                    28600002
         DC    AL3(0)                                                   28650002
F1       DC    F'1'                    USED TO INCREMENT TRACK ADDRESS. 28700002
ZERO     DC    F'0'                                                     28750002
RETCODE  DC    F'0'                                                     28800002
GOOD     EQU   X'7F'                   NO ERRORS ON I/O.                28850002
ON       EQU   X'FF'                   SWITCH ON.                       28900002
RPS      EQU   X'10'                   TEST FOR UCB RPS FEATURE         28950002
RPSFEAT  EQU   X'40'                   RPS FEATURE SWITCH               29000002
WINCH    EQU   X'0A'                   UCB DEVICE TYPE                  29050002
FUNCTION DC    C'RESTORE TO'           MESSAGE FILL IN.                 29100002
SETCCW   CCW   X'23',F1,X'40',1        SET SECTOR ZERO                  29150002
SECTIC   CCW   8,0,0,0                                                  29200002
         SPACE                                                          29250002
READVTOC CCW   X'31',0,X'60',5         SEARCH ON RECORD 1 OF VTOC.      29300002
         CCW   8,READVTOC,0,0          REPEAT UNTIL FOUND.              29350002
RDVDATA  CCW   6,0,X'20',96            READ FORMAT 4 DATA.              29400002
         EJECT                                                          29450002
*********************************************************************** 29500002
*                                                                     * 29550002
*                          CONTROL BLOCKS                             * 29600002
*                                                                     * 29650002
*********************************************************************** 29700002
         SPACE                                                          29750002
*   RESTORE DA WRITE-OUT ECB.                                         * 29800002
         DS    0D                      NECESSARY ALIGNMENT.             29850002
RDECB    DC    F'0'                    WAIT//COMPLETE BITS              29900002
*   RESTORE DA WRITE-OUT IOB.                                           29950002
RDIOB    DS    0F                                                       30000002
RDFLAGS  DC    XL2'4200'               FLAG1 AND FLAG2.                 30050002
RDSENSE  DC    H'0'                    SENSE BYTES.                     30100002
RDECBAD  DC    A(RDECB)                ECB ADDRESS.                     30150002
RDSTATUS DC    2F'0'                   CHANNEL STATUS.                  30200002
RDCCWAD  DC    A(0)                    CCW ADDRESS.                     30250002
RDDCBAD  DC    A(RDDCB)                DCB ADDRESS.                     30300002
RDRESAD  DC    F'0'                    RESTART ADDRESS.                 30350002
RDBLKCT  DC    H'1'                    BLOCK COUNT INCREMENT.           30400002
RDERROR  DC    H'0'                    ERROR COUNT.                     30450002
RDSEEK   DC    2F'0'                   MBBCCHHR.                        30500002
*   RESTORE DA WRITE-OUT DCB.                                           30550002
         AIF   ('&LIB' EQ 'LIB1').OSDCB                                 30600002
RDDCB    DCB   DSORG=PS,MACRF=(E),DEVD=DA,EXLST=LIST,EOEA=P8,          C30650002
               XENDA=P9,SIOA=P7,PGFX=YES                                30700002
         AGO   .C1                                                      30750002
.OSDCB   ANOP                                                           30800002
RDDCB    DCB   DSORG=PS,MACRF=(E),DEVD=DA,EXLST=LIST,EOEA=P8            30850002
.C1      ANOP                                                           30900002
*   RESTORE TAPE READ-IN ECB.                                           30950002
RTECB    DS    1F                      WAIT//COMPLETE BITS PLUS CODE.   31000002
*   RESTORE TAPE READ-IN IOB.                                           31050002
RTIOB    DS    0F                      RESTORE.                         31100002
FLAGS    DC    XL2'4200'               FLAG1 AND FLAG2.                 31150002
SENSE    DC    H'0'                    SENSE BYTES.                     31200002
ADECB    DC    A(RTECB)                ECB ADDRESS.                     31250002
STATUS   DC    2F'0'                   CHANNEL STATUS.                  31300002
CCWS     DC    A(0)                    ADDRESS OF CCWS.                 31350002
DCBAD    DC    A(RTDCB)                DCB ADDRESS                      31400002
RESTART  DC    F'0'                    RESTART ADDRESS.                 31450002
BLKCT    DC    H'1'                    BLOCK COUNT INCREMENT.           31500002
TERROR1  DC    H'0'                    ERROR COUNT.                     31550002
         SPACE 1                                                        31600002
         SPACE 1                                                        31650002
RTDCB    DCB   DSORG=PS,MACRF=(E),DEVD=TA,EXLST=LIST,TRTCH=C            31700002
R1CCW    CCW   2,0,X'60',X'FFFF'       READ CCWS INTO BUFFER ONE.       31750002
R1DATA   CCW   2,0,X'20',X'FFFF'       READ DATA INTO BUFFER ONE.       31800002
         SPACE                                                          31850002
R2CCW    CCW   2,0,X'60',X'FFFF'       READ CCWS INTO BUFFER TWO.       31900002
R2DATA   CCW   2,0,X'20',X'FFFF'       READ DATA INTO BUFFER TWO.       31950002
RDLSTBLK DS    0H                      END OF CONTROL BLOCKS            32000002
RBLKSIZE EQU   RDLSTBLK-RDECB          SIZE OF I/O BLOCKS--RESTORE.     32050002
INITSAVE DC    18F'0'                  REG SAVE AREA FOR IEHDINIT       32100002
D1       EQU   1                       DISP OF 1                        32150002
MAINT    DS    100X                    ZAP FIX AREA.                    32200002
         EJECT                                                          32250002
IOBLOCKS DSECT                                                          32300002
*   RESTORE DA WRITE-OUT ECB.                                           32350002
DISKECB  DS    1F                      WAIT//COMPLETE BITS PLUS CODE.   32400002
         SPACE 1                                                        32450002
*   RESTORE DA WRITE-OUT IOB.                                           32500002
DISKIOB  DS    0F                                                       32550002
DISKFLG  DS    CL2                     FLAGS 1 AND 2.                   32600002
DSENSE   DS    CL2                     SENSE BYTES.                     32650002
DECBAD   DS    1F                      ECB ADDRESS.                     32700002
DSTATUS  DS    2F                      CHANNEL STATUS.                  32750002
DCCWAD   DS    1F                      CCW LIST ADDRESS.                32800002
DDCBAD   DS    1F                      DCB ADDRESS.                     32850002
DRESAD   DS    1F                      RESTART ADDRESS.                 32900002
DBLKCT   DS    CL2                     BLOCK COUNT INCREMENT.           32950002
DERROR1  DS    CL2                     ERROR COUNT                      33000002
DSEEK    DS    2F                      MBBCCHHR.                        33050002
BB       EQU   DSEEK+1                 BIN ADDRESS.                     33100002
CCHH     EQU   DSEEK+3                 CYLINDER-HEAD ADDRESS.           33150002
R        EQU   DSEEK+7                 RECORD NUMBER.                   33200002
         SPACE 1                                                        33250002
*   RESTORE DA WRITE-OUT DCB.                                           33300002
DISKDCB  DS    18F                                                      33350002
         SPACE 2                                                        33400002
*   RESTORE TAPE READ-IN ECB.                                           33450002
TAPEECB  DS    1F                      WAIT//COMPLETE BITS PLUS CODE.   33500002
         SPACE 1                                                        33550002
*   RESTORE TAPE READ-IN IOB.                                           33600002
TAPEIOB  DS    0F                                                       33650002
TAPEFLG  DS    CL2                     FLAGS 1 AND 2.                   33700002
TSENSE   DS    CL2                     SENSE BYTES.                     33750002
TECBAD   DS    1F                      ECB ADDRESS                      33800002
TSTATUS  DS    2F                      CHANNEL STATUS.                  33850002
TCCWAD   DS    1F                      CCW LIST ADDRESS.                33900002
TDCBAD   DS    1F                      DCB ADDRESS.                     33950002
TRESAD   DS    1F                      RESTART ADDRESS.                 34000002
TBLKCT   DS    CL2                     BLOCK COUNT INCREMENT.           34050002
TERROR   DS    CL2                     ERROR COUNT                      34100002
         SPACE 1                                                        34150002
*   RESTORE TAPE READ-IN DCB NUMBER ONE.                                34200002
TAPEDCB  DS    13F                                                      34250002
         SPACE 1                                                        34300002
*   CCWS TO READ-IN RESTORE TAPE.                                       34350002
         DS    0D                      ALIGNMENT.                       34400002
TAPECCW1 DS    CL8                     USED TO READ CCW RECORD.         34450002
TAPEDAT1 DS    CL8                     USED TO READ DATA RECORD.        34500002
TAPECCW2 DS    CL8                     USED TO READ CCW RECORD.         34550002
TAPEDAT2 DS    CL8                     USED TO READ DATA RECORD.        34600002
IOBLKEND DS    0H                      END OF IOBLOCKS DSECT.           34650002
          EJECT                                                         34700002
         IEHDBLKS                                                       34750002
         EJECT                                                          34800002
         IEHDWORK                                                       34850002
         SPACE                                                          34900002
VLABEL   DSECT                                                          34950002
VOLUME   DS    CL3                     LABEL IDENTIFIER.                35000002
VOLNO    DS    CL1                     LABEL NUMBER.                    35050002
SERIAL   DS    CL6                     LABEL SERIAL NUMBER.             35100002
SECURITY DS    CL1                     VOLUME SECURITY.                 35150002
VTOCPTR  DS    CL10                    POINTER TO VTOC                  35200002
         DS    CL20                    RESERVED.                        35250002
OWNER    DS    CL10                    OWNER IDENTIFICATION.            35300002
         DS    CL29                    BLANK.                           35350002
         SPACE                                                          35400002
RBUFFER  DSECT                                                          35450002
ZERO1    DS    CL8                     WILL CONTAIN 8 BYTES OF ZEROS.   35500002
CCWBUFF  EQU   ZERO1                                                    35550002
TICSW    DS    CL1                     'FF' INDICATES PREVIOUS CCW=TIC. 35600002
         DS    CL3                     NOT USED.                        35650002
ADDRESS  DS    CL4                     TEMPORARY ADDRESS HOLDER.        35700002
SEEKCCW  DS    CL8                     SEEK CCW FOR STAND-ALONE.        35750002
SETMASK  DS    CL8                     SET FILE MASK FOR STAND-ALONE.   35800002
SEARIDE  DS    CL8                     SEARCH EQUAL ID CCW.             35850002
*   VARIOUS CCW COMBINATIONS CAN FOLLOW FROM THIS POINT ON.             35900002
         EJECT                                                          35950002
CVT      DSECT                                                          36000002
         CVT   SYS=MIN                                                  36050002
         EJECT                                                          36100002
UCB      DSECT                                                          36150002
         IEFUCBOB                                                       36200002
         EJECT                                                          36250002
JFCB     DSECT                                                          36300002
         IEFJFCBN                                                       36350002
         EJECT                                                          36400002
         DCBD  DSORG=PS                                                 36450002
         END                                                            36500002
