*        VSAM CATALOG WORK AREA MACRO                            Y02918 00050002
         MACRO                                                   Y02918 00100002
         IEZCTGWA                                                       00150002
CTGWA    DSECT                                                   Y02918 00200002
CTGWAVL  DS    A                                                 Y02918 00250002
CTGWALV  DS    H                                                 Y02918 00300002
CTGWAVCT DS    H                                                 Y02918 00350002
CTGWAUCT DS    H                                                 Y02918 00400002
         MEND                                                    Y02918 00450002
*        VSAM CATALOG VOLUME LIST MACRO                          Y02918 00500002
         MACRO                                                   Y02918 00550002
         IEZCTGVL                                                       00600002
CTGVL    DSECT                                                   Y02918 00650002
CTGVLVOL DS    XL6                                               Y02918 00700002
CTGVLDEV DS    XL4                                               Y02918 00750002
CTGVLSEQ DS    XL2                                               Y02918 00800002
CTGVLTTR DS    XL3                                               Y02918 00850002
         MEND                                                    Y02918 00900002
         TITLE '  IEHMVESH - DATA SET GROUP MODULE'              Y02918 00950002
**************************************************************** Y02918 01000002
*                                                                Y02918 01050002
*TITLE: 'IEHMVESH'                                               Y02918 01100002
*                                                                Y02918 01150002
*FUNCTION/OPERATION: DATA SET GROUP MODULE.                      Y02918 01200002
*        ON FIRST ENTRY FOR A DSGROUP REQUEST, OBTAINS THE NAMES Y02918 01250002
*        OF ALL DATA SETS IN THE GROUP VIA A VSAM GENERIC LOCATE Y02918 01300002
*        REQUEST AND WRITES A RECORD ON SYSUT1 DESCRIBING EACH   Y02918 01350002
*        NON-VSAM DATA SET IN THE GROUP. THEN SETS UP A SINGLE   Y02918 01400002
*        DATA SET MOVE/COPY REQUEST FROM A SYSUT1 RECORD EACH    Y02918 01450002
*        TIME IT IS ENTERED. WHEN ALL THE DATA SETS IN THE GROUP Y02918 01500002
*        HAVE BEEN PROCESSED, IT IS DONE.                        Y02918 01550002
*                                                                Y02918 01600002
*ENTRY POINT: IEHMVESH                                           Y02918 01650002
*                                                                Y02918 01700002
*INPUT: COMMUNICATIONS AREA FIELDS:                              Y02918 01750002
*        IEHMVV21 = ADDRESS OF DSGROUP NAME                      Y02918 01800002
*        IEHMVV40 = ADDRESS OF SYSUT1 DCB                        Y02918 01850002
*        IEHMVV40+4 = ADDRESS OF SYSUT1 DECB                     Y02918 01900002
*        IEHMVV10 = ADDRESS OF NEXT AVAILABLE COMM. AREA         Y02918 01950002
*        IEHMVV20+2 = END OF INPUT FLAG                          Y02918 02000002
*        IEHMVV20 = 'DSNAME' AND 'FROM' FLAGS                    Y02918 02050002
*                                                                Y02918 02100002
*OUTPUT: SYSUT1 RECORD FOR EACH NON-VSAM DATA SET IN GROUP       Y02918 02150002
*        COMMUNICATIONS AREA FIELDS:                             Y02918 02200002
*        IEHMVV27+16 = ADDRESS OF SYSUT1 RECORD AREA             Y02918 02250002
*        IEHMVV27+12 = DSGROUP CONTINUATION FLAG                 Y02918 02300002
*        IEHMVV10 = ADDRESS OF NEXT AVAILABLE COMM. AREA         Y02918 02350002
*        IEHMVV21 = ADDRESS OF 'FROM' DATA SET NAME              Y02918 02400002
*        IEHMVV82 = DSCB TTR FOR SINGLE VOLUME 'FROM' DATA SET   Y02918 02450002
*        IEHMVV22 = VOLUME COUNT AND LIST ADDRESS FOR 'FROM'     Y02918 02500002
*              DATA SET                                          Y02918 02550002
*                                                                Y02918 02600002
*EXTERNAL MODULES: IEHMVESU - TO PRINT ERROR MESSAGES            Y02918 02650002
*                                                                Y02918 02700002
*EXITS:  IEHMVESU - TO PROCESS A SINGLE DATA SET REQUEST         Y02918 02750002
*        IEHMVEST - WHEN A DSGROUP HAS BEEN PROCESSED AND        Y02918 02800002
*              ANOTHER REQUEST IS PENDING                        Y02918 02850002
*        IEHMVESK - WHEN A DSGROUP HAS BEEN PROCESSED AND        Y02918 02900002
*              END OF INPUT WAS ENCOUNTERED                      Y02918 02950002
*                                                                Y02918 03000002
*TABLES/WORK AREA: PERMANENT COMMUNICATIONS AREA - IEHMVV (R12)  Y02918 03050002
*        VSAM CATALOG AREAS - CTGPL (R11), CTGWA (R3),           Y02918 03100002
*              CTGVL (R2)                                        Y02918 03150002
*        SYSUT1 RECORD AREA - UT1RCD (R10)                       Y02918 03200002
*        GENERIC LOCATE WORK AREA - GLWA (R6)                    Y02918 03250002
*        GENERIC LOCATE WORK AREA ENTRY - GLNAME (R7)            Y02918 03300002
*        MODULE WORK AREA (R11)                                  Y02918 03350002
*                                                                Y02918 03400002
*ATTRIBUTES: SERIALLY REUSABLE                                   Y02918 03450002
*                                                                Y02918 03500002
*NOTES: THIS MODULE SUPPORTS DATA SET GROUP OPERATIONS FOR       Y02918 03550002
*        VS2 RELEASE 2.                                          Y02918 03600002
*                                                                Y02918 03650002
**************************************************************** Y02918 03700002
         EJECT                                                   Y02918 03750002
IEHMVESH CSECT                                                   Y02918 03800002
*A069200,095700,096100,096500,112580-113540,118000-118200,     @ZA26030 03800499
*A251100-251300                                                @ZA26030 03800799
*C095500,112500,112540,113840,118300                           @ZA26030 03801099
*D096600                                                       @ZA26030 03801699
*A193100-193200,250600                                         @ZA16446 03802099
*C193000,196000                                                @ZA16446 03804099
*A077100-077200,238008-238016,240705-240745                    @Z40CSJH 03810004
*C071500,111000,197500                                         @ZA10928 03820037
*                                                                Y02918 03850002
*A081700                                                       @ZA07397 03853037
*C071500                                                       @ZA07397 03856037
*A096500-096700                                                @ZA06561 03860037
*D096500                                                       @ZA06561 03870037
*                                                                       03880037
*        REGISTER EQUATES                                        Y02918 03900002
R0       EQU   0                                                 Y02918 03950002
R1       EQU   1                                                 Y02918 04000002
R2       EQU   2                       VOLUME LIST ENTRY BASE    Y02918 04050002
R3       EQU   3                       CATLG WORK AREA BASE AND  Y02918 04100002
*                                      WORK REG                  Y02918 04150002
R4       EQU   4                       WORK REG                  Y02918 04200002
R5       EQU   5                       GENERIC LOCATE AREA       Y02918 04250002
*                                      * USED LENGTH             Y02918 04300002
R6       EQU   6                       GENERIC LOCATE WORK AREA  Y02918 04350002
*                                      * BASE                    Y02918 04400002
R7       EQU   7                       GENERIC LOCATE NAME ENTRY Y02918 04450002
*                                      BASE                      Y02918 04500002
R8       EQU   8                       BASE REGISTER             Y02918 04550002
R9       EQU   9                       WORK REG                  Y02918 04600002
R10      EQU   10                      SYSUT1 RECORD BASE        Y02918 04650002
R11      EQU   11                      CATLG PARM LIST BASE      Y02918 04700002
R12      EQU   12                      COMM. AREA BASE           Y02918 04750002
R13      EQU   13                                                Y02918 04800002
R14      EQU   14                                                Y02918 04850002
R15      EQU   15                                                Y02918 04900002
*                                                                Y02918 04950002
*        LENGTH AND DISPLACEMENT EQUATES                         Y02918 05000002
L1       EQU   1                       LENGTH OF 1               Y02918 05050002
L2       EQU   2                       LENGTH OF 2               Y02918 05100002
L3       EQU   3                       LENGTH OF 3               Y02918 05150002
L4       EQU   4                       LENGTH OF 4               Y02918 05200002
L5       EQU   5                       LENGTH OF 5               Y02918 05250002
L6       EQU   6                       LENGTH OF 6               Y02918 05300002
L12      EQU   12                      LENGTH OF 12              Y02918 05350002
L20      EQU   20                      LENGTH OF 20              Y02918 05400002
L43      EQU   43                      LENGTH OF 43              Y02918 05450002
L44      EQU   44                      LENGTH OF 44              Y02918 05500002
*                                                                Y02918 05550002
D0       EQU   0                       DISPLACEMENT OF 0         Y02918 05600002
D1       EQU   1                       DISPLACEMENT OF 1         Y02918 05650002
D2       EQU   2                       DISPLACEMENT OF 2         Y02918 05700002
D3       EQU   3                       DISPLACEMENT OF 3         Y02918 05750002
D4       EQU   4                       DISPLACEMENT OF 4         Y02918 05800002
D6       EQU   6                       DISPLACEMENT OF 6         Y02918 05850002
D7       EQU   7                       DISPLACEMENT OF 7         Y02918 05900002
D8       EQU   8                       DISPLACEMENT OF 8         Y02918 05950002
D12      EQU   12                      DISPLACEMENT OF 12        Y02918 06000002
D16      EQU   16                      DISPLACEMENT OF 16        Y02918 06050002
D17      EQU   17                      DISPLACEMENT OF 17        Y02918 06100002
*                                                                Y02918 06150002
*        FLAG EQUATES                                            Y02918 06200002
EIP      EQU   X'20'                   END OF INPUT              Y02918 06250002
DSNAME   EQU   X'20'                   DSNAME GIVEN              Y02918 06300002
FROM     EQU   X'01'                   FROM DATA SET SET UP      Y02918 06350002
GL       EQU   0                       GENERIC LOCATE ISSUED     Y02918 06400002
SPL      EQU   4                       SUPERLOCATE ISSUED        Y02918 06450002
DSGCONT  EQU   X'80'                   DSGROUP CONTINUATION      Y02918 06500002
DUMMY    EQU   X'FF'                   DUMMY RECORD CODE         Y02918 06550002
*                                                                Y02918 06600002
*        MISCELLANEOUS EQUATES                                   Y02918 06650002
B1       EQU   1                       SHIFT 1 BIT               Y02918 06700002
B2       EQU   2                       SHIFT 2 BITS              Y02918 06750002
B8       EQU   8                       SHIFT 8 BITS              Y02918 06800002
HEX0F    EQU   X'0F'                   SIGN FOR CONVERSION       Y02918 06850002
BLANK    EQU   X'40'                   EBCDIC BLANK              Y02918 06900002
DOT      EQU   X'4B'                   EBCDIC DOT              @ZA26030 06920099
NONVSAM  EQU   X'C1'                   NON-VSAM DATA SET         Y02918 06950002
M3       EQU   3                       MASK FOR ICM              Y02918 07000002
*                                                                Y02918 07050002
*        PROLOGUE                                                Y02918 07100002
         SAVE  (14,12),T,IEHMVESH-OZ26030                      @ZA26030 07150099
         BALR  R8,R0                   ESTABLISH ADDR            Y02918 07200002
         USING *,R8                                              Y02918 07250002
         IEHPRE (14,1),TF                                        Y02918 07300002
*        ASSEMBLER USING STATEMENTS                              Y02918 07350002
         USING CTGVL,R2                                          Y02918 07400002
         USING CTGWA,R3                                          Y02918 07450002
         USING GLWA,R6                                           Y02918 07500002
         USING GLNAME,R7                                         Y02918 07550002
         USING UT1RCD,R10                                        Y02918 07600002
         USING CTGPL,R11                                         Y02918 07650002
         USING IEHMVV,R12                                        Y02918 07700002
CVOLTEST TM    IEHMVV20+1,X'40'        IS CVOL BIT ON - IF YES @Z40CSJH 07710004
         BO    CVOLNTRY                BR TO CVOL PROCESSING   @Z40CSJH 07720004
         TITLE ' IEHMVESH - GROUP SET-UP'                        Y02918 07750002
*                                                                Y02918 07800002
*        ON FIRST ENTRY, OBTAIN LIST OF DATA SETS IN GROUP.      Y02918 07850002
*        ON SUBSEQUENT ENTRIES, SET UP NEXT MOVE/COPY REQUEST.   Y02918 07900002
*                                                                Y02918 07950002
         TM    IEHMVV27+D12,DSGCONT    DSGROUP CONTINUATION      Y02918 08000002
         BZ    GLREQ                   NO - NEED LIST OF NAMES   Y02918 08050002
         L     R10,IEHMVV27+D16        SET SYSUT1 RECORD ADDRESS Y02918 08100002
         LA    R2,UT1VLST              SET VOL LIST ADDRESS      Y02918 08150002
         NI    IEHMVV20+2,X'BE'        TURN OFF ABORT BITS     @ZA07397 08170037
         B     RDUT1                   READ NEXT SYSUT1 RECORD   Y02918 08200002
*                                                                Y02918 08250002
*        FIRST ENTRY. OBTAIN THE NAMES OF THE DATA SETS IN THE   Y02918 08300002
*        GROUP VIA A VSAM GENERIC LOCATE.                        Y02918 08350002
*                                                                Y02918 08400002
GLREQ    L     R10,IEHMVV10            USE NEXT AVAILABLE AREA   Y02918 08450002
         ST    R10,IEHMVV27+D16        * IN COMM. AREA FOR       Y02918 08500002
*                                      * SYSUT1 RECORD AREA      Y02918 08550002
         LA    R2,UT1VLST              SET VOL LIST BASE         Y02918 08600002
         LA    R11,IEHMVV00            SET MODULE WORK AREA BASE Y02918 08650002
         XC    CTGPL(CTGPLLEN),CTGPL   INITIALIZE PARM LIST      Y02918 08700002
         XC    UT1OVHD,UT1OVHD         INITIALIZE SYSUT1 RECORD  Y02918 08750002
*        SET UP GENERIC LOCATE PARM LIST AND WORK AREA           Y02918 08800002
         OI    CTGOPTN1,CTGNAME+CTGGENLD SET GENREIC LOCATE      Y02918 08850002
         OI    CTGOPTN3,CTGSUPLT+CTGAM0 * OPTION FLAGS           Y02918 08900002
         LA    R9,GLREQNM              SET GENERIC DATA SET      Y02918 08950002
         ST    R9,CTGENT               * NAME ADDRESS            Y02918 09000002
*        SET UP GENERIC DATA SET NAME ENTRY                      Y02918 09050002
         L     R4,IEHMVV21             SET NAME ADDRESS          Y02918 09100002
         SR    R3,R3                   INITIALIZE LEGNTH         Y02918 09150002
GNL      CLI   D0(R4),BLANK            BLANK AFTER NAME          Y02918 09200002
         BE    SETNL                   YES - END OF NAME         Y02918 09250002
         LA    R3,D1(R3)               INCREMENT LENGTH BY 1     Y02918 09300002
         LA    R4,D1(R4)               INCREMENT NAME POINTER    Y02918 09350002
         CH    R3,MAXNL                MAX LENGTH REACHED        Y02918 09400002
         BH    SET43                   YES - USE LENGTH          Y02918 09450002
         B     GNL                     NO - CONTINUE SCAN        Y02918 09500002
SET43    MVC   D0(L1,R9),MAXNL+1       SET LENGTH TO MAX       @ZA26030 09550099
         STC   R3,NLENGTH              SET LENGTH DETERMINED   @ZA26030 09570099
         B     SETNM                   SET NAME IN ENTRY         Y02918 09590099
SETNL    EQU   *                                               @ZA26030 09610099
         STC   R3,D0(R9)               SET LENGTH DETERMINED   @ZA06561 09630099
         STC   R3,NLENGTH              SET LENGTH DETERMINED   @ZA26030 09650099
SETNM    L     R4,IEHMVV21             SET NAME ADDRESS          Y02918 09700002
         MVC   D1(L43,R9),D0(R4)       SET NAME IN ENTRY         Y02918 09750002
*                                                                Y02918 09800002
*        OBTAIN INITIAL AREA FOR GENERIC LOCATE WORK AREA AND    Y02918 09850002
*        SAVE ITS SIZE IN CASE IT IS INSUFFICIENT AND MUST BE    Y02918 09900002
*        FREED                                                   Y02918 09950002
*                                                                Y02918 10000002
         L     R9,C904                 SET INITIAL WORK AREA     Y02918 10050002
         ST    R9,GLSIZE               * SIZE AND SAVE           Y02918 10100002
         GETMAIN R,LV=904              OBTAIN WORK AREA          Y02918 10150002
         ST    R1,CTGWKA               SET WORK AREA ADDRESS     Y02918 10200002
         LR    R6,R1                   SET WORK AREA BASE        Y02918 10250002
*        ENTER HERE TO REISSUE GENERIC LOCATE WITH A LARGER WORK Y02918 10300002
*        AREA                                                    Y02918 10350002
GLRE     STH   R9,GLWALEN              SET WORK AREA LENGTH      Y02918 10400002
         CATLG MF=(E,CTGPL)            ISSUE GENERIC LOCATE      Y02918 10450002
*        TEST RETURN CODE FROM CATALOG MANAGEMENT                Y02918 10500002
         LA    R1,GL                   INDICATE GENERIC LOCATE   Y02918 10550002
         BAL   R14,LOCRCK              ANALIZE RETURN CODE       Y02918 10600002
         B     GLOK                    LOCATE SUCCESSFUL         Y02918 10650002
         B     GLRE                    REISSUE REQUEST           Y02918 10700002
         B     DSGDNE                  ERROR - TERMINATE REQUEST Y02918 10750002
         EJECT                                                   Y02918 10800002
*                                                                Y02918 10850002
*        GENERIC LOCATE WAS SUCCESSFUL. SCAN DATA SET NAME       Y02918 10900002
*        ENTRIES FOR NON-VSAM DATA SETS                          Y02918 10950002
*                                                                Y02918 11000002
GLOK     SR    R5,R5                                             Y02918 11050002
         ICM   R5,3,GLWANLEN           GET LENGTH OF NAME AREA @ZA10928 11100037
         SH    R5,NMOV                 SUBTRACT OVERHEAD         Y02918 11150002
         LA    R7,GLWAFNME             GET FIRST NAME ENTRY ADDR Y02918 11200002
TSTNV    CLI   GLENTYP,NONVSAM         DATA SET VSAM           @ZA26030 11250099
         BNE   ENTDNE                  YES- CANT HONOR REQUEST @ZA26030 11254099
* IF LENGTH IS 44 OR IF BLANK AFTER NAME THEN IT IS A          @ZA26030 11258099
* FULLY QUALIFIED NAME AND THE DATA SET SHALL BE COPIED.       @ZA26030 11262099
         ST    R3,SAVEREG3             SAVE REG3               @ZA26030 11266099
         ST    R7,SAVEREG7             SAVE REG7               @ZA26030 11270099
         SR    R3,R3                   CLEAR REG 3             @ZA26030 11274099
         IC    R3,NLENGTH              GET LENGTH OF NAME      @ZA26030 11278099
         LA    R9,44                   SET MAX NAME EQUAL 44   @ZA26030 11282099
         SR    R9,R3       FULLY QUALIFIED NAME OF 44 CHARS ?  @ZA26030 11286099
         BNZ   NOT44                   NO - GO ON              @ZA26030 11290099
         CLC   D0(L44,R4),D1(R7)       YES - CHECK IF THIS     @ZA26030 11294099
*                                      IS THE NAME WE ARE      @ZA26030 11298099
*                                      LOOKING FOR.            @ZA26030 11302099
         BNE   RESTORE                 NO - CANT HONOR REQUEST @ZA26030 11306099
         BE    DSNV                    YES - CAN HONOR REQUEST @ZA26030 11310099
NOT44    EQU   *                                               @ZA26030 11314099
         LA    R3,D1(R3)          ADD ONE TOO POINT AFTER NAME @ZA26030 11315099
         AR    R7,R3                   POINT AFTER NAME        @ZA26030 11318099
         CLI   D0(R7),BLANK           IS IT A BLANK AFTER NAME @ZA26030 11322099
         BE    DSNV                    YES - CAN HONOR REQUEST @ZA26030 11326099
* IF A DOT AFTER NAME THE DATA SET SHALL BE COPIED IN OTHER    @ZA26030 11330099
* CASE GET NEXT ENTRY.                                         @ZA26030 11334099
         CLI   D0(R7),DOT              IS IT A DOT AFTER NAME  @ZA26030 11338099
         BE    DSNV                    YES - CAN HONOR REQUEST @ZA26030 11342099
RESTORE  EQU   *                                               @ZA26030 11346099
         L     R7,SAVEREG7             RESTORE REG7            @ZA26030 11355099
         L     R3,SAVEREG3             RESTORE REG3            @ZA26030 11364099
ENTDNE   EQU   *                                               @ZA26030 11373099
         SH    R5,GLWAELEN             ALL ENTRIES PROCESSED   @ZA26030 11382099
         BNP   DUMWT                   YES - WRITE DUMMY RCD     Y02918 11400002
         AH    R7,GLWAELEN             POINT TO NEXT ENTRY       Y02918 11450002
         B     TSTNV                   TEST ENTRY TYPE           Y02918 11500002
         EJECT                                                   Y02918 11550002
*                                                                Y02918 11600002
*        DATA SET IS NON-VSAM. ISSUE SUPERLOCATE TO OBTAIN       Y02918 11650002
*        IT'S VOLUME LIST                                        Y02918 11700002
*                                                                Y02918 11750002
DSNV     EQU   *                                               @ZA26030 11800099
         L     R7,SAVEREG7             RESTORE REG7            @ZA26030 11810099
         L     R3,SAVEREG3             RESTORE REG3            @ZA26030 11820099
         XC    CTGPL(CTGPLLEN),CTGPL   INITIALIZE PARM LIST    @ZA26030 11830099
         OI    CTGOPTN3,CTGSUPLT+CTGAM0 SET SUPERLOCATE OPTIONS  Y02918 11850002
         LA    R3,SPWA                 SET WORK AREA ADDRESS     Y02918 11900002
         ST    R3,CTGWKA               * IN PARM LIST            Y02918 11950002
         LA    R9,GLDSNM               SET DATA SET NAME ADDRESS Y02918 12000002
         ST    R9,CTGENT                                         Y02918 12050002
         LA    R9,GLREQNM              SET CVOL RETURN AREA      Y02918 12100002
         ST    R9,CTGCVOL              * ADDRESS                 Y02918 12150002
         ST    R2,CTGWAVL              SET VOLUME LIST ADDRESS   Y02918 12200002
         MVC   CTGWALV,VLLEN           SET VOLUME LIST LENGTH    Y02918 12250002
         CATLG MF=(E,CTGPL)            ISSUE SUPERLOCATE         Y02918 12300002
*        TEST RETURN CODE FROM CATALOG MANAGEMENT                Y02918 12350002
         LA    R1,SPL                  INDICATE SUPERLOCATE      Y02918 12400002
         BAL   R14,LOCRCK              ANALIZE RETURN CODE       Y02918 12450002
         B     SPLOK                   SUCCESSFUL                Y02918 12500002
         B     SPLOK                   SUCCESSFUL                Y02918 12550002
         B     ENTDNE                  ERROR - SKIP DATA SET     Y02918 12600002
         EJECT                                                   Y02918 12650002
*                                                                Y02918 12700002
*        SUPERLOCATE WAS SUCCESSFUL. CONSTRUCT DATA SET RECORD.  Y02918 12750002
*                                                                Y02918 12800002
SPLOK    MVC   UT1NAME(44),GLDSNM      SET DATA SET NAME         Y02918 12850002
         SR    R9,R9                                             Y02918 12900002
         LH    R9,CTGWAVCT             GET VOLUME COUNT          Y02918 12950002
         CH    R9,MAXVC                MORE THAN MAX VOLUMES     Y02918 13000002
         BNH   SETVC                   NO - SET VOL COUNT        Y02918 13050002
         MVC   UT1VLCT,MAXVC           SET VOL COUNT TO MAX      Y02918 13100002
         B     MULTVL                  CONTINUE                  Y02918 13150002
SETVC    MVC   UT1VLCT,CTGWAVCT        SET VOL COUNT RETURNED    Y02918 13200002
         CH    R9,ONEVOL               ONE VOLUME DATA SET       Y02918 13250002
         BNE   MULTVL                  NO - NO TTR               Y02918 13300002
         MVC   UT1TTR,CTGVLTTR         SET DSCB TTR              Y02918 13350002
         B     SKPTTRC                 CONTINUE                  Y02918 13400002
MULTVL   XC    UT1TTR,UT1TTR           SET DSCB TTR TO 0         Y02918 13450002
*        SUPERLOCATE RETURNS INFORMATION IN ORDER:               Y02918 13500002
*              VOLSER,DEVICE CODE,SEQ NO                         Y02918 13550002
*        IEHMOVE REQUIRES INFORMATION IN ORDER:                  Y02918 13600002
*              DEVICE CODE,VOLSER,SEQ NO                         Y02918 13650002
*        SO EACH ENTRY MUST BE REORDERED                         Y02918 13700002
SKPTTRC  LR    R4,R9                   SET VOL COUNT             Y02918 13750002
REORDER  MVC   TEMPVL,CTGVLVOL         SAVE VOLSER               Y02918 13800002
         MVC   MVEVLDEV(L4),CTGVLDEV   REORDER DEVICE CODE       Y02918 13850002
         MVC   MVEVLVOL(L6),TEMPVL     REORDER VOLSER            Y02918 13900002
         LA    R2,D12(R2)              GET NEXT ENTRY ADDRESS    Y02918 13950002
         BCT   R4,REORDER              LOOP UNTIL DONE           Y02918 14000002
         LA    R2,UT1VLST              RESET TO FIRST ENTRY      Y02918 14050002
*        COMPUTE LENGTH OF VOLUME LIST PORTION OF RECORD         Y02918 14100002
         MH    R9,VLELEN               GET VOLUME LIST LENGTH    Y02918 14150002
         AH    R9,VLOVHD               ADD OVERHEAD              Y02918 14200002
         STCM  R9,M3,UT1VLLEN          SET LENGTH                Y02918 14250002
*                                                                Y02918 14300002
*        WRITE DATA SET RECORD TO SYSUT1                         Y02918 14350002
*                                                                Y02918 14400002
         BAL   R14,RCDWRT              WRITE RECORD              Y02918 14450002
         B     ENTDNE                  GET NEXT ENTRY            Y02918 14500002
         EJECT                                                   Y02918 14550002
*                                                                Y02918 14600002
*        ALL NON-VSAM DATA SETS IN THE GROUP ARE NOW             Y02918 14650002
*        REPRESENTED ON SYSUT1. WRITE A DUMMY RECORD.            Y02918 14700002
*                                                                Y02918 14750002
DUMWT    MVI   UT1CDE,DUMMY            SET DUMMY CODE            Y02918 14800002
         SR    R9,R9                                             Y02918 14850002
         STCM  R9,M3,UT1VLLEN          SET VOLUME LIST LENGTH    Y02918 14900002
         BAL   R14,RCDWRT              WRITE RECORD              Y02918 14950002
*                                                                Y02918 15000002
*        FREE GENERIC LOCATE AREA                                Y02918 15050002
*        REPOSITION SYSUT1 TO BEGIN PROCESSING AT FIRST RECORD   Y02918 15100002
*                                                                Y02918 15150002
RDPT     BAL   R14,GLFREE              FREE GENERIC LOCATE AREA  Y02918 15200002
         L     R3,IEHMVV40             SET SYSUT1 DCB ADDRESS    Y02918 15250002
         POINT (R3),RCD1               POINT TO FIRST RECORD     Y02918 15300002
         TITLE ' IEHMVESH - DATA SET SET-UP'                     Y02918 15350002
*                                                                Y02918 15400002
*        FIRST OR SUBSEQUENT ENTRIES. READ A RECORD FROM SYSUT1  Y02918 15450002
*        AND SET UP FIELDS IN COMMUNICATION AREA TO PERFORM A    Y02918 15500002
*        SINGLE DATA SET MOVE/COPY REQUEST FOR THE FROM VOLUME   Y02918 15550002
*        REPRESENTED BY THE SYSUT1 RECORD.                       Y02918 15600002
*                                                                Y02918 15650002
RDUT1    L     R3,IEHMVV40             SET SYSUT1 DCB ADDRESS    Y02918 15700002
         L     R4,IEHMVV40+4           SET SYSUT1 DECB ADDRESS   Y02918 15750002
         READ  (R4),SF,(R3),UT1RCD,'S',MF=E READ UT1 RECORD      Y02918 15800002
         CHECK (R4)                    WAIT FOR COMPLETION       Y02918 15850002
         TM    UT1CDE,DUMMY            DUMMY RECORD              Y02918 15900002
         BO    DSGDNE                  YES - DSGROUP DONE        Y02918 15950002
*                                                                Y02918 16000002
*        SET UP ADDRESS OF 'FROM' DATA SET NAME IN IEHMVV21.     Y02918 16050002
*        FOR SINGLE VOLUME DATA SETS, IEHMVV82 WILL CONTAIN      Y02918 16100002
*        THE DSCB TTR OF THE 'FROM' DATA SET.                    Y02918 16150002
         LA    R9,UT1NAME              SET FROM DSNAME ADDRESS   Y02918 16200002
         ST    R9,IEHMVV21                                       Y02918 16250002
         MVC   IEHMVV82(L3),UT1TTR     SET UP DSCB TTR           Y02918 16300002
*        SET UP A LIST OF 17 BYTE 'FROM' VOLUME ENTRIES USING    Y02918 16350002
*        THE 12 BYTE ENTRIES IN THE SYSUT1 RECORD. PLACE THE     Y02918 16400002
*        VOLUME COUNT IN THE FIRST BYTE OF IEHMVV22 AND THE      Y02918 16450002
*        ADDRESS OF THE 'FROM' VOLUME LIST IN BYTES 2-4 OF       Y02918 16500002
*        IEHMVV22.                                               Y02918 16550002
         SR    R9,R9                   DETERMINE NEXT AVAILABLE  Y02918 16600002
         ICM   R9,M3,UT1VLLEN          * ADDRESS IN COMM. AREA   Y02918 16650002
*                                      * AFTER SYSUT1 RECORD     Y02918 16700002
         LA    R9,UT1NAME(R9)          * AREA - BUILD 'FROM'     Y02918 16750002
         LA    R9,D8(R9)               VOL LIST THERE            Y02918 16800002
         ST    R9,IEHMVV22             SET 'FROM' VOL LIST ADDR  Y02918 16850002
         SR    R4,R4                                             Y02918 16900002
         LH    R4,UT1VLCT              SET VOLUME COUNT          Y02918 16950002
         LTR   R4,R4                   NO VOLUMES                Y02918 17000002
         BZ    RDUT1                   YES - SKIP DATA SET       Y02918 17050002
         STC   R4,IEHMVV22             SET FROM VOLUME COUNT     Y02918 17100002
LOOP2    MVC   D0(L12,R9),CTGVL        MOVE UT1 ENTRY TO 'FROM'  Y02918 17150004
         XC    D12(L5,R9),D12(R9)      * LIST AND CLEAR EXTRA    Y02918 17200002
         LA    R9,D17(R9)              SET NEXT 'FROM' ENTRY     Y02918 17250002
         LA    R2,D12(R2)              SET NEXT UT1 ENTRY        Y02918 17300002
         BCT   R4,LOOP2                LOOP UNTIL VOL CT IS 0    Y02918 17350004
*        SET UP A POINTER TO THE NEXT AVAILABLE FULLWORD IN THE  Y02918 17400002
*        COMMUNICATIONS AREA                                     Y02918 17450002
         LA    R9,D3(R9)                                         Y02918 17500002
         SRL   R9,B2                                             Y02918 17550002
         SLL   R9,B2                                             Y02918 17600002
         ST    R9,IEHMVV10             SET NEXT AVAIL. ADDRESS   Y02918 17650002
*                                                                Y02918 17700002
*        SET FLAGS FOR A SINGLE DATA SET REQUEST AND DATA SET    Y02918 17750002
*        GROUP CONTINUATION.                                     Y02918 17800002
*                                                                Y02918 17850002
         OI    IEHMVV20,DSNAME+FROM    SET DSNAME AND FROM FLAGS Y02918 17900002
         OI    IEHMVV27+D12,DSGCONT    SET DSGROUP CONT. FLAG    Y02918 17950002
         B     DSPRCS                  PROCESS THE DATA SET      Y02918 18000002
         TITLE ' IEHMVESH - EXITS'                                      18050002
*        EXIT TO IEHMVESZ TO PROCESS THE DATA SET REQUEST        Y02918 18100002
DSPRCS   IEHPOST (14,1),T                                        Y02918 18150002
         XCTL   (2,12),EP=IEHMVESZ                               Y02918 18200002
*                                                                Y02918 18250002
*        AN ENTIRE DATA SET GROUP HAS BEEN PROCESSED. IF ANOTHER Y02918 18300002
*        REQUEST IS PENDING, EXIT TO IEHMVEST, OTHERWISE EXIT TO Y02918 18350002
*        IEHMVESK.                                               Y02918 18400002
DSGDNE   TM    IEHMVV20+D2,EIP         END OF INPUT              Y02918 18450002
         BO    ALLDNE                  YES - WRAP UP RUN         Y02918 18500002
NXTREQ   IEHPOST (14,1),T                                        Y02918 18550002
         XCTL (2,12),EP=IEHMVEST                                 Y02918 18600002
ALLDNE   IEHPOST (14,1),T                                        Y02918 18650002
         XCTL  (2,12),EP=IEHMVESK                                Y02918 18700002
         TITLE ' IEHMVESH - SUBROUTINES'                         Y02918 18750002
*                                                                Y02918 18800002
*        THIS ROUTINE ANALIZES THE RETURN CODE FROM CATALOG      Y02918 18850002
*        MANAGEMENT AFTER A GENERIC LOCATE OR SUPERLOCATE        Y02918 18900002
*                                                                Y02918 18950002
LOCRCK   ST    R14,SVRTN               SAVE RETURN ADDRESS       Y02918 19000002
         LTR   R15,R15                 RC=0                      Y02918 19050002
         BZ    RET0                    YES - LOCATE SUCCESSFUL   Y02918 19100002
         CH    R15,RC8                 RC=8                      Y02918 19150002
         BE    ANYNMS                  YES                       Y02918 19200002
         CH    R15,RC40                RC=40                     Y02918 19250002
         BE    SMALL                   YES                     @ZA16446 19300099
         CH    R15,RC44                RC=44                   @ZA16446 19310099
         BNE   ERR                     NO - UNUSUAL CONDITION  @ZA16446 19320099
         SPACE 2                                                 Y02918 19350002
*        RETURN CODE INDICATES THAT THE WORK AREA WAS TOO SMALL  Y02918 19400002
*        IF REQUEST WAS SUPERLOCATE, EXTRA ENTRIES ARE NOT       Y02918 19450002
*        NEEDED. IF REQUEST WAS GENERIC LOCATE, TRY TO GET CORE  Y02918 19500002
*        NEEDED TO RE-ISSUE THE REQUEST.                         Y02918 19550002
SMALL    LTR   R1,R1                   SUPERLOCATE             @ZA16446 19600099
         BP    RET4                    YES - ACCEPT ERROR        Y02918 19650002
         SR    R9,R9                                             Y02918 19700002
         ICM   R9,3,GLWANLEN           SET FEEDBACK AREA SIZE  @ZA10928 19750037
         ST    R9,GLFDBK               SAVE                      Y02918 19800002
         BAL   R14,GLFREE              FREE ORIGINAL WORK AREA   Y02918 19850002
         L     R9,GLFDBK               SET FEEDBACK SIZE         Y02918 19900002
         ST    R9,GLSIZE               SAVE                      Y02918 19950002
         LA    R6,CTGWKA               SET WORK AREA PTR ADDR    Y02918 20000002
         GETMAIN EC,LV=(R9),A=(R6)     ISSUE COND. GETMAIN       Y02918 20050002
         L     R6,CTGWKA               SET WORK AREA BASE        Y02918 20100002
         LTR   R15,R15                 WAS GETMAIN SUCCESSFUL    Y02918 20150002
         BNZ   NOSPC                   NO                        Y02918 20200002
*        RETURN AT NSI + 4 - SPACE INSUFFICIENT                  Y02918 20250002
RET4     LA    R15,D4                  SET RETURN OFFSET         Y02918 20300002
         B     RETB                    RETURN                    Y02918 20350002
         SPACE 2                                                 Y02918 20400002
*        COULD NOT OBTAIN SPACE REQUIRED FOR THE GENERIC LOCATE. Y02918 20450002
*        ISSUE MESSAGE IEH351I AND RETURN AT OFFSET +8.          Y02918 20500002
NOSPC    L     R3,ADSGM2               SET MESSAGE ADDRESS       Y02918 20550002
*        LINK TO IEHMVESU TO PRINT ERROR MESSAGE                 Y02918 20600002
MSGLNK   LINK  EP=IEHMVESU             PRINT MESSAGE             Y02918 20650002
         LTR   R15,R15                 PERM. I/O ERROR           Y02918 20700002
         BP    ALLDNE                  YES - TERMINATE RUN       Y02918 20750002
*        RETURN AT NSI + 8 - ERROR MESSAGE PRINTED               Y02918 20800002
         LA    R15,D8                  SET RETURN OFFSET         Y02918 20850002
         B     RETB                    RETURN                    Y02918 20900002
         SPACE 2                                                 Y02918 20950002
*        LOCATE WAS SUCCESSFUL. IF NO NAMES WERE RETURNED FOR    Y02918 21000002
*        GENERIC LOCATE REQUEST, ISSUE MESSAGE IEH348I AND       Y02918 21050002
*        RETURN AT OFFSET +8.                                    Y02918 21100002
ANYNMS   LTR   R1,R1                   GENERIC LOCATE            Y02918 21150002
         BZ    NONMS                   YES                       Y02918 21200002
*        RETURN AT NSI - CONTINUE PROCESSING                     Y02918 21250002
RET0     SR    R15,R15                 SET RETURN OFFSET         Y02918 21300002
RETB     L     R14,SVRTN               RESTORE RETURN ADDRESS    Y02918 21350002
         B     D0(R15,R14)             RETURN                    Y02918 21400002
*        NO NAMES WERE FOUND FOR DSGROUP SPECIFIED.              Y02918 21450002
NONMS    L     R3,ADSGM1               SET MESSAGE ADDRESS       Y02918 21500002
*        FREE GOTTEN CORE - REQUEST WILL BE TERMINATED           Y02918 21550002
MSGFRE   BAL   R14,GLFREE              FREE GENERIC LOCATE AREA  Y02918 21600002
         B     MSGLNK                  PRINT MESSAGE             Y02918 21650002
         SPACE 2                                                 Y02918 21700002
*        RETURN CODE INDICATES AN UNUSUAL CONDITION.             Y02918 21750002
*        FOR GENERIC LOCATE, ISSUE MESSAGE IEH354I.              Y02918 21800002
*        FOR SUPERLOCATE, ISSUE MESSAGE IEH356I. RETURN AT       Y02918 21850002
*        OFFSET +8.                                              Y02918 21900002
ERR      L     R3,AERRMT(R1)           SET MESSAGE MODEL ADDR    Y02918 21950002
         MVC   ERRMSG,D0(R3)           MOVE MESSAGE TO WORK AREA Y02918 22000002
         LA    R3,ERRMSG               SET MESSAGE ADDRESS       Y02918 22050002
         LR    R9,R1                   SET LOCATE TYPE OFFSET    Y02918 22100002
         SRL   R9,B1                   DIVIDE OFFSET BY 2        Y02918 22150002
         SR    R4,R4                                             Y02918 22200002
         LH    R4,ARCT(R9)             SET RC OFFSET             Y02918 22250002
         LA    R4,D0(R4,R3)            SET RC ADDRESS            Y02918 22300002
         CVD   R15,CVTAR               CONVERT RC TO EBCDIC      Y02918 22350002
         OI    CVTAR+D7,HEX0F                                    Y02918 22400002
         UNPK  D0(L3,R4),CVTAR+6(L2)   PLACE RC IN MESSAGE       Y02918 22450002
         LTR   R1,R1                   SUPERLOCATE               Y02918 22500002
         BZ    MSGFRE                  NO - TERMINATE            Y02918 22550002
         SR    R4,R4                                             Y02918 22600002
         LH    R4,ADSNM                SET DSNAME OFFSET         Y02918 22650002
         LA    R4,D0(R4,R3)            SET DSNAME ADDRESS        Y02918 22700002
         MVC   D0(L44,R4),GLDSNM       PUT DSNAME IN MESSAGE     Y02918 22750002
         B     MSGLNK                  SKIP DATA SET             Y02918 22800002
         EJECT                                                   Y02918 22850002
*        THIS ROUTINE FREES THE CORE OBTAINED FOR THE            Y02918 22900002
*        GENERIC LOCATE WORK AREA                                Y02918 22950002
GLFREE   ST    R14,GLFSV               SAVE RETURN ADDRESS       Y02918 23000002
         L     R9,GLSIZE               SET AREA SIZE             Y02918 23050002
         FREEMAIN R,LV=(R9),A=(R6)     FREE CORE                 Y02918 23100002
         L     R14,GLFSV               RESTORE RETURN ADDRESS    Y02918 23150002
         BR    R14                     RETURN                    Y02918 23200002
         EJECT                                                   Y02918 23250002
*        THIS ROUTINE WRITES A RECORD ON SYSUT1                  Y02918 23300002
RCDWRT   ST    R14,SVRTN               SAVE RETURN ADDRESS       Y02918 23350002
         SR    R9,R9                                             Y02918 23400002
         ICM   R9,M3,UT1VLLEN          SET VOL LIST LENGTH       Y02918 23450002
         AH    R9,RCDOVHD              ADD OVERHEAD              Y02918 23500002
         L     R4,IEHMVV40             SET SYSUT1 DCB ADDRESS    Y02918 23550002
         L     R3,IEHMVV40+4           SET SYSUT1 DECB ADDRESS   Y02918 23600002
         WRITE (R3),SF,(R4),UT1RCD,(R9),MF=E                     Y02918 23650002
         CHECK (R3)                                              Y02918 23700002
         L     R14,SVRTN               RESTORE RETURN ADDRESS    Y02918 23750002
         BR    R14                     RETURN                    Y02918 23800002
*********************************************************************** 23800404
*       LINES 238020-241109 WERE REACTIVATED                   @Z40CSJH 23800804
*       IN SUPPORT OF THE MVS EXTENDED                         @Z40CSJH 23801204
*       CVOL FUNCTION                                          @Z40CSJH 23801604
*********************************************************************** 23801704
CVOLNTRY EQU   *                                                        23802004
         TM    XSWITCHS,X'08'          IS CLOSE SW ON                   23810004
         BO    CLOSE2                  BRANCH IF YES                    23820004
         L     R4,IEHMVV30+8  ADDR OF BEGINNING OF PERM WORK AREA       23830004
*                             USED BY DSGROUP LOAD 1                    23840004
         ST    R4,IEHMVV10             RECLAIM PERM WORK AREA           23842004
         OI    XSWITCHS,X'08'          TURN ON CLOSE SW                 23844004
CLOSE2   DS    0H                                                       23846004
         TM    XSWITCHS,X'80'           IS FIRST IN SW ON               23848004
         BO    REQCOMP                                                  23848404
         MVC   XPOINTER(4),IEHMVV10                                     23848804
         L     R5,IEHMVV41             LOAD UT2 DCB ADDR                23849204
         BAL   R10,POINT                GO TO POINT ROUTINE             23849604
READ1    L     R4,IEHMVV40+4            LOAD UT1 DECB ADDR              23849704
         L     R5,IEHMVV40              LOAD UT1 DCB ADDR               23849804
         L     R6,XPOINTER                                              23849904
*XXXXX   R6 CONTAINS THE ADDRESS OF THE PERM WORK AREA                  23866604
READ2    READ  (R4),SF,(R5),(R6),'S',MF=E                               23876604
         CHECK (R4)                                                     23878604
         CLI   19(R6),X'FF'                                             23880604
         BE    DWRITE1                                                  23882604
         CLI   19(R6),X'00'                                             23883004
         BE    REQSET                                                   23883104
****** POINTER TO BLOCK IN R6 REFERS TO DATA *****                      23883204
****** READ FROM SYSUT1 INTO THE PERM WORK AREA **                      23888804
WRITE1   L     R6,XPOINTER              POINTER TO BLOCK IN R6          23890804
         SR    R3,R3                                                    23892804
         IC    R3,17(R6)                FIRST L OF LL                   23893204
         SLL   R3,8                                                     23893604
         IC    R3,18(R6)                SECOND L OF LL                  23894004
      LA   R3,12(R3)         UP LENGTH                                  23894104
         L     R4,IEHMVV41+4            LOAD DECB ADDR                  23894204
         L     R5,IEHMVV41              LOAD DCB ADDR                   23894304
****** R4 HAS THE DECB ADDR OF SYSUT2 *****                             23908204
****** R5 HAS THE DCB ADDR OF SYSUT2  *****                             23918204
****** WRITE3 WRITES A BLOCK FROM PERM*****                             23920204
****** WORK AREA TO SYSUT2            *****                             23920604
WRITE3   WRITE (R4),SF,(R5),(R6),(R3),MF=E                              23921004
         CHECK (R4)                                                     23921404
         TM    XSWITCHS,X'40'           IS END OF UT1 SW ON             23921804
         BO    CATOPT                                                   23921904
         B     READ1                                                    23922004
DWRITE1  OI    XSWITCHS,X'40'           TURN ON END OF UT1 SW           23922104
         B     WRITE1                                                   23926704
POINT    LA    R0,256         SET TTR2 OF 0010 IN REG                   23928704
         ST    R0,IEHMVV00                                              23930704
         LR    R0,R12         PLACE ADDR OF COMM AREA IN R0             23931104
         L     R1,IEHMVV40              LET R1 POINT AT UT1 DCB         23931204
***** REPOSITION SYSUT1 TO READ THE NEXT BLOCK *****                    23931304
         POINT (1),(0)                  REPOSITION UT1                  23931404
         L     R1,IEHMVV41              LET R1 POINT AT UT2 DCB         23936004
         LR    R0,R12                                                   23938004
***** REPOSITION SYSUT2 TO WRITE THE NEXT BLOCK *****                   23940004
         POINT (1),(0)                  REPOSITION UT2                  23940404
         BR    R10            GO TO READ1                               23940504
REQCOMP  L     R6,XPOINTER                                              23940604
         L     R7,IEHMVV10             R7 NOW CONTAINS A PTR TO A LIST  23940704
*                                      OF VOL ENTRIES FOR THE DATA SET  23952504
*                                      THAT WAS JUST HANDLED            23962504
         ST    R6,IEHMVV10                                              23964504
         NI    IEHMVV20+1,X'FC'         INITIALIZE COMM SWITCHES        23968404
         NI    IEHMVV20+2,X'6E'                                         23970404
         NI    IEHMVV20+3,X'77'                                         23972404
         TM    IEHMVV20+2,X'41'         ARE ABORT BITS ON               23976304
         BNE   REQCOMP1                 BRANCH IF YES                   23978304
         SR    R2,R2                                                    23980304
         IC    R2,1(R7)                INSERT COUNT OF TO VOL ENTRIES   23984204
         LA    R3,12                                                    23986204
         MR    R2,R2                                                    23988204
         LR    R4,R3                    SAVE LENGTH                     23998504
         LA    R3,1(R3)                                                 24008504
         LR    R2,R7                   LOAD PTR TO TO VOL ENTRIES       24008604
         EX    R3,EXCINST                                               24008704
         LA    R4,46(R4)                BUMP LENGTH BY 46               24012104
         STC   R4,18(R6)                                                24014104
         SRL   R4,8                                                     24014504
         STC   R4,17(R6)                STORE COUNT IN RECORD           24014904
         MVC   12(3,6),IEHMVV82+4 PUT NEW TTR IN SYSUT1 RECORD   S21042 24015304
         XC    IEHMVV82+4(3),IEHMVV82+4 CLEAR TTR FIELD          S21042 24015404
         B     WRITE1                                                   24015504
REQCOMP1 NI    IEHMVV20+2,X'BE'         TURN OFF ABORTS BITS            24015604
         B     READ1                                                    24019004
EXCINST  MVC   64(1,R6),0(R2)                                           24021004
REQSET   LA    R7,20(R6)                                                24021404
***** STORE ADDR OF FROM DSNAME *****                                   24021804
         ST    R7,IEHMVV21                                              24022204
         MVC   IEHMVV82(3),12(6)       SAVE OLD DSCBTTR          S21042 24022304
         ST    R6,XPOINTER             SAVE ADDRESS OF RECORD    A27712 24022404
         SR    R7,R7                   CLEAR  REGISTER SEVEN     A27712 24022504
         IC    R7,17(R6)               IN0ERT EN R8  557 8       A27712 24025904
         SLL   R7,8                    COMPUTE LENGTH            A27712 24027904
         IC    R7,18(R6)               OF RECORD                 A27712 24028304
         AR    R6,R7                                             A27712 24028704
         LA    R6,28(R6)          POINTER TO AVAIL FREE AREA     A27712 24029104
         ST    R6,IEHMVV22             ADDRESS OF VOLUME ENTRIES A27712 24029204
         L     R5,XPOINTER             FIND OLD VOLUME LIST      A27712 24029304
         SR    R7,R7                   CLEAR REG 7               A27712 24029404
         IC    R7,65(R5)               NUMBER OF ENTRIES IN LIST A27712 24032804
         LTR   R7,R7                   IS VOL. COUNT 0?          A30287 24034804
         BZ    READ1                   YES-INDEX WITH NO DATA    A30287 24035204
*                                      WAS FOUND. IGNORE IT.     A30287 24035604
         STC     R7,IEHMVV22           SAVE NUMBER OF ENTRIES    A27712 24036004
         LA    R5,66(R5)               POINT TO OLD LIST         A27712 24036104
****     R5=ADDRESS OF OLD 12 BYTE ENTRY  R6=ADDRESS OF NEW      A27712 24036204
****     17 BYTE ENTRY   R7=NUMBER OF ENTRIES IN LIST            A27712 24036304
LOOP     MVC   0(12,R6),0(R5)          MOVE VOLUME LIST          A27712 24037404
         XC    12(5,R6),12(R6)         CLEAR AREA FOR VOLMOUNT   A27712 24039404
         LA    R6,17(R6)               POINT TO NEXT ENTRY       A27712 24039504
         LA    R5,12(R5)               POINT TO NEXT ENTRY       A27712 24039604
         BCT   R7,LOOP                 ANY MORE ENTRIES          A27712 24048204
         LA    R6,3(R6)                ALIGN FOR NEST FULL WORD  A27712 24050204
         SRL   R6,2                    BOUNDRY                   A27712 24052204
         SLL   R6,2                                              A27712 24054204
         ST    R6,IEHMVV10         SAVE ADDRESS FOR NEXT MODULE  A27712 24056204
         OI    IEHMVV20,X'21'          TURN ON DSNAME AND FROM   A27712 24056604
         OI    XSWITCHS,X'80'          TURN ON FIRST IN SW              24056704
         B     EXIT1                                                    24056804
EXIT1  IEHPOST (14,1),T                                                 24056904
         XCTL  (2,12),EP=IEHMVESZ                                       24068504
EXIT2  TM  IEHMVV20,X'10'              IS DSGROUP SW ON        @Z40CSJH 24070504
         BO    EXIT3                    YES-CATLGING ALL DONE  @Z40CSJH 24074504
       IEHPOST (14,1),T                                                 24078504
         XCTL  (2,12),EP=IEHMVETA                                       24078904
EXIT3    TM    IEHMVV20+2,X'20'                                         24079304
         BO    EXIT4                                                    24079704
       IEHPOST (14,1),T                                                 24080104
         XCTL  (2,12),EP=IEHMVEST                                       24080204
EXIT4  IEHPOST (14,1),T                                                 24080304
         XCTL  (2,12),EP=IEHMVESK                                       24081104
CATOPT   OI    IEHMVV20,X'04'           TURN ON CATALOG REQ BIT         24081504
         TM    IEHMVV20,X'80'           IS MOVE BIT ON                  24081904
         BZ    CATOPT1                                                  24082304
         TM    IEHMVV20+1,X'20'         IS UNCATLG BIT ON               24082704
         BZ    CATOPT4                                                  24085604
         MVC   IEHMVV23(4),IEHMVV24                                     24087604
         B     EXIT2                                                    24089604
CATOPT4  DS    0H                                                       24090004
         NI    IEHMVV20,X'7F'           TURN OFF MOVE BIT               24090404
         OI    IEHMVV20,X'40'           TURN ON  COPY BIT               24090804
         OI    IEHMVV20+1,X'20'         TURN ON  UNCATLG BIT            24091204
         MVC   IEHMVV23(4),IEHMVV24    MOVE CVOL PTR TO TO VOL SLOT     24091304
         B     EXIT2                                                    24093404
CATOPT1  TM    IEHMVV20+1,X'30'         CATLG OR UNCATLG BIT ON         24095404
         BZ    EXIT3                                                    24097404
         BO    CATOPT2                                                  24097804
         TM    IEHMVV20+1,X'20'         IS UNCATLG ON                   24101204
         BO    CATOPT3                                                  24103204
         B     EXIT2                                                    24103604
CATOPT2  NI    IEHMVV20,X'BF'           TURN OFF COPY BIT               24104004
         OI    IEHMVV20,X'80'           TURN ON  MOVE BIT               24104404
         NI    IEHMVV20+1,X'DF'        TURN OFF UNCATLG BIT             24104804
         B     EXIT2                                                    24104904
CATOPT3  NI    IEHMVV20,X'BF'           TURN OFF COPY BIT               24108504
         OI    IEHMVV20,X'80'           TURN ON MOVE BIT                24110504
         B     EXIT2                                                    24110904
         TITLE ' IEHMVESH - CONSTANTS'                           Y02918 24112404
*                                                                Y02918 24116004
*        CONSTANTS                                               Y02918 24119604
*                                                                Y02918 24123204
ADSGM1   DC    A(DSGNONE)              NO D/S IN GROUP MSG       Y02918 24126804
ADSGM2   DC    A(DSGNOSPC)             NO SPACE FOR NAMES MSG    Y02918 24138404
AERRMT   DC    A(DSGSRFL)              DSGROUP LOCATE FAILED MSG Y02918 24150002
         DC    A(DSESRFL)              D/S LOCATE FAILED MSG     Y02918 24200002
ARCT     DS    0H                      RC OFFSET TABLE           Y02918 24250002
         DC    AL2(DSGSRFLR-DSGSRFL)   DSGROUP MESSAGE           Y02918 24300002
         DC    AL2(DSESRFLR-DSESRFL)   DATA SET MESSAGE          Y02918 24350002
ADSNM    DC    AL2(DSESRFLN-DSESRFL)   DSNAME OFFSET             Y02918 24400002
RCD1     DC    F'256'                  TTRZ = 0010               Y02918 24450002
C904     DC    F'904'                  INIT. GENERIC LOCATE      Y02918 24500002
*                                      * WORK AREA SIZE          Y02918 24550002
NMOV     DC    H'4'                    OVERHEAD - GENERIC NAMES  Y02918 24600002
VLLEN    DC    H'600'                  MAX LENGTH FOR VOL LIST   Y02918 24650002
MAXVC    DC    H'50'                   MAX VOL COUNT             Y02918 24700002
ONEVOL   DC    H'1'                    COUNT OF 1 VOLUME         Y02918 24750002
VLELEN   DC    H'12'                   VOLUME ENTRY LENGTH       Y02918 24800002
VLOVHD   DC    H'46'                   OVERHEAD FOR VOL LIST     Y02918 24850002
RCDOVHD  DC    H'20'                   OVERHEAD FOR UT1 RECORD   Y02918 24900002
MAXNL    DC    H'43'                   MAX GENERIC NAME LENGTH   Y02918 24950002
RC8      DC    H'8'                    RETURN CODE OF 8          Y02918 25000002
RC40     DC    H'40'                   RETURN CODE OF 40         Y02918 25050002
RC44     DC    H'44'                   RETURN CODE OF 44       @ZA16446 25060099
GLWAELEN DC    H'45'                   GENERIC LOCATE NAME       Y02918 25100002
SAVEREG3 DS    F                       SAVE AREA FOR REG3      @ZA26030 25110099
SAVEREG7 DS    F                       SAVE AREA FOR REG7      @ZA26030 25120099
NLENGTH  DC    H'00'                   SAVE LENGTH OF NAME     @ZA26030 25130099
*                                      * ENTRY LENGTH            Y02918 25150002
PATCH    DC    20F'0'                  PATCH AREA                Y02918 25200002
         TITLE ' IEHMVESH - DSECTS'                              Y02918 25250002
*                                                                Y02918 25300002
*        DSECTS                                                  Y02918 25350002
*                                                                Y02918 25400002
GLWA     DSECT                         GENERIC LOCATE WORK AREA  Y02918 25450002
GLWALEN  DS    XL2                     SIZE OF AREA PROVIDED     Y02918 25500002
GLWANLEN DS    XL2                     SIZE OF AREA USED         Y02918 25550002
GLWAFNME EQU   *                       FIRST NAME ENTRY ADDRESS  Y02918 25600002
*                                                                Y02918 25650002
GLNAME   DSECT                         GENERIC LOCATE NAME ENTRY Y02918 25700002
GLENTYP  DS    CL1                     ENTRY TYPE                Y02918 25750002
GLDSNM   DS    CL44                    DATA SET NAME             Y02918 25800002
*                                                                Y02918 25850002
UT1RCD   DSECT                         SYSUT1 RECORD             Y02918 25900002
UT1OVHD  DS    0XL20                   OVERHEAD LENGTH           Y02918 25950002
UT1KEY   DS    XL12                    KEY - NOT USED            Y02918 26000002
UT1TTR   DS    XL3                     DSCB TTR FOR 1 VOL D/S    Y02918 26050002
         DS    XL2                     NO USED - ALWAYS 0        Y02918 26100002
UT1VLLEN DS    XL2                     LENGTH OF VOL LIST        Y02918 26150002
UT1CDE   DS    XL1                     CODE                      Y02918 26200002
UT1NAME  DS    CL44                    DATA SET NAME             Y02918 26250002
UT1VLCT  DS    XL2                     VOLUME COUNT              Y02918 26300002
UT1VLST  EQU   *                       VOLUME LIST ADDRESS       Y02918 26350002
         EJECT                                                   Y02918 26400002
         IEHMVV                                                  Y02918 26450002
XSWITCHS EQU   IEHMVV27+12                                              26460004
*****XSWITCHS IS USED AS THE CLOSE SWITCH                               26470004
XPOINTER EQU   IEHMVV27+16                                              26480004
         EJECT                                                   Y02918 26500002
         IEZCTGWA                                                Y02918 26550002
         EJECT                                                   Y02918 26600002
         IEZCTGVL                                                Y02918 26650002
MVEVLVOL EQU   CTGVL+D4                MOVE VOLSER               Y02918 26700002
MVEVLDEV EQU   CTGVL                   MOVE DEVICE CODE          Y02918 26750002
         EJECT                                                   Y02918 26800002
         IEZCTGPL                                                Y02918 26850002
         SPACE 2                                                 Y02918 26900002
*                                                                Y02918 26950002
*        MODULE WORK AREA                                        Y02918 27000002
*                                                                Y02918 27050002
GLREQNM  DS    CL100                   GENERIC LOCATE NAME ENTRY Y02918 27100002
*                                      * AND CVOL RETURN AREA    Y02918 27150002
ERRMSG   DS    CL121                   RC ERROR MSG AREA         Y02918 27200002
TEMPVL   DS    CL6                     VOLSER SAVE AREA          Y02918 27250002
CVTAR    DS    D                       CONVERSION WORK AREA      Y02918 27300002
SVRTN    DS    F                       SUBROUTINE SAVE WORD      Y02918 27350002
GLFSV    DS    F                       GLFREE ROUTINE SAVE WORD  Y02918 27400002
GLSIZE   DS    F                       GENERIC LOCATE WORK AREA  Y02918 27450002
*                                      * SIZE                    Y02918 27500002
GLFDBK   DS    F                       GENERIC LOCATE WORK AREA  Y02918 27550002
*                                      * FEEDBACK SIZE           Y02918 27600002
SPWA     EQU   *                       SUPERLOCATE WORK AREA     Y02918 27650002
         TITLE ' IEHMSGSH - MESSAGE CSECT'                       Y02918 27700002
IEHMSGSH CSECT                                                   Y02918 27750002
*        MESSAGE CSECT FOR IEHMVESH                              Y02918 27800002
DSGNONE  DC    CL121' IEH348I NO DATA SETS FOUND FOR DSGROUP SPECIFIED.X27850002
               '                                                 Y02918 27900002
DSGNOSPC DC    CL121' IEH351I SUFFICIENT SPACE NOT AVAILABLE FOR ALL DAX27950002
               TA SETS IN DSGROUP.'                              Y02918 28000002
DSGSRFL  DC    CL52' IEH354I DSGROUP CATALOG SEARCH FAILED. RETURN CODEX28050002
               '                                                 Y02918 28100002
DSGSRFLR DC    CL69'000 .'                                       Y02918 28150002
DSESRFL  DC    CL18' IEH356I DATA SET '                          Y02918 28200002
DSESRFLN DS    CL44                                              Y02918 28250002
         DC    CL36' CATALOG SEARCH FAILED. RETURN CODE '        Y02918 28300002
DSESRFLR DC    CL23'000 .'                                       Y02918 28350002
         END   IEHMVESH                                          Y02918 28400002
