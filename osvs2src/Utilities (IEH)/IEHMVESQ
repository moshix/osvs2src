         TITLE 'IEHMVESQ09 --- DATA SET WRAPUP FOR A MOVE OPERATION'    00020000
*                                                                     * 00040000
*TITLE 'IEHMVSSQ'                                                     * 00060000
*                                                                     * 00080000
*FUNCTION/OPERATION: THIS ROUTINE HANDLES THE WRAPUP PROCEDURE FOR ALL* 00100000
*'MOVE' REQUESTS THIS INCLUDES SCRATCHING THE 'FROM' DATA SET, RE-    * 00120000
*NAMEING THE 'TO' DATA SET IF BOTH THE 'TO' AND 'FROM' DATA SETS START* 00140000
*ED ON THE SAME VOLUME, AND UNCATALOGING OR CATALOGING THE DATASET    * 00160002
*IF IT WAS FOUND VIA A CATALOG.                                       * 00180000
* ON MOVE DSNAME AND MOVE PDS OPERATIONS FOR WHICH THE SOURCE DATA    * 00190002
* SET WAS CATALOGED, THE ASSUMPTION IS MADE THAT THE RECEIVING DATA   * 00192002
* SET CAN BE CATALOGED IN PLACE OF THE SOURCE DATA SET.               * 00194002
* IF THE RECEIVING DATA SET IS TO BE CATALOGED, THE SOURCE DATA SET IS* 00196002
* UNCATALOGED AND THE RECEIVING DATA SET CATALOGED. THE RECATALOG     * 00198004
* SET MUST BE UNCATALOGED TO ALLOW THE USER TO MOVE THE CATALOG ENTRY * 00198402
* FROM ONE CATALOG TO ANOTHER SINCE CVOL IS NOT ALLOWED. THE RECATALOG* 00198802
* MACRO WILL ONLY UPDATE THE VOLUME LIST IN THE SPECIFIED CATALOG AND * 00199202
* NOT ALLOW A CHANGE OF CATALOGS AS THE UNCATALOG-CATALOG SEQUENCE    * 00199602
* WILL.                                                               * 00199702
*                                                                     * 00200000
*ENTRY POINTS: IEHMVESQ                                               * 00220000
*                                                                     * 00240000
*INPUT: NONE                                                          * 00260000
*                                                                     * 00280000
*OUTPUT: NONE                                                         * 00300000
*                                                                     * 00320000
*EXTERNAL ROUTINES- IEHMVSSU(MESSAGE WRITER)                          * 00340000
*                                                                     * 00360000
*EXITS- N O R M A L   IEHMVSSK(FINAL WRAPUP)                          * 00380000
*                                                                     * 00400000
*                     IEHMVSSH(DSGROUP WRAPUP)                        * 00420000
*                                                                     * 00440000
*                     IEHMVSSZ(CONTINUE MOVING DATA SETS)             * 00460000
*                                                                     * 00480000
*                     IEHMVSST(CARD SCANNER)                          * 00500000
*                                                                     * 00520000
*       E R R O R S   IEHMVSSK(FINAL WRAPUP)                          * 00540000
*                                                                     * 00560000
*TABLES/WORK AREAS: NONE                                              * 00580000
*                                                                     * 00600000
*ATTRIBUTES: REENTRANT                                                * 00620000
*                                                                     * 00640000
*NOTE: THIS MODULE WILL PRINT OUT A VOLUME LIST THAT CONTAINS MORE    * 00660000
*THAN FIVE VOLUMES.                                                   * 00680000
*                                                                     * 00700000
         EJECT                                                          00720000
*                                                                       00740000
*********************************************************************   00760000
**                                                                      00780000
**                            IEHMVSSQ                                  00800000
**                                                                      00820000
*********************************************************************   00840000
*                                                                       00860000
IEHMVSSQ CSECT                                                     000H 00870017
* 092800                                                         A35444 00872020
* 039200,044800,047800,048600,049000,092800-094200               S21042 00875421
*                                                                A37862 00877021
* 051000,057000,094200                                           A38740 00879021
*                                                                A41787 00879421
*A087100-087200,092700,094500                                    A41824 00879821
*A016900-017200,057619-057663,077400-077560,087020-087020-087040 A48782 00879922
*A094540-094560                                                  A48782 00886622
*D017000-017240,077400,083600                                    A48782 00888622
*C013720,017800-19200,057666,083400,084200,084600                A48782 00890622
*A1900-1997                                                     YL026VC 00892602
*C1600,35200,36000,36200,37200,37360,38000,38600,46400,50000    YL026VC 00893002
*C51000,52200,92740                                             YL026VC 00893102
*D33000-34600,38800-46200,47000-48900,51100=51120,57120-57593   YL026VC 00893202
*D92760-94300                                                   YL026VC 00899902
*A31700-31760,32700,95220                                        Y)2918 00901902
*D32000,32400-32600,32800                                        Y02918 00903902
*C016800,017000,028600                                         @ZM30153 00905903
*A016920,028500                                                @ZM30153 00906303
*D001980-001984                                                @Z40CSJH 00911100
*A031700-032000,034200-034300,037188-037320                    @Z40CSJH 00913100
*A092744-092757                                                @Z40CSJH 00915100
*A037058-037078                                                @Z40CSJH 00915500
*A018336-018344                                                @ZA11951 00916037
*C018352                                                       @ZA11951 00920837
*A036924-036969                                                @ZA18380 00922800
*C036923,037025                                                @ZA18380 00924800
A0       EQU   0                                                        00925602
A1       EQU   1                                                        00930402
A2       EQU   2                                                        00935200
A3       EQU   3                                                        00940000
A4       EQU   4                                                        00960000
A5       EQU   5                                                        00980000
A6       EQU   6                                                        01000000
A7       EQU   7                                                        01020000
A8       EQU   8                                                        01040000
A9       EQU   9                       IEHMVESQ BASE REGISTER           01060000
A10      EQU   10                      BASE REGISTER FOR MESSAGES       01080000
A11      EQU   11                                                       01100000
A12      EQU   12                      BASE REG FOR COMMUNICATION AREA  01120000
A13      EQU   13                                                       01140000
A14      EQU   14                                                       01160000
A15      EQU   15                                                       01180000
         ENTRY IEHMVESQ                                                 01200000
IEHMVESQ BALR  A9,0                                                     01220000
         USING *,A9                                                     01240000
         USING IEHMVV,A12               ESTABLISH ADDR TO COMMUNICATION 01260000
         EJECT                                                          01280000
*                                                                       01300000
*          V O L U M E    L I S T                                       01320000
*                                                                       01340000
*********************************************************************** 01360000
*       *NUMBER *              *                      *               * 01380000
*BINARY *OF     *              *                      * TAPE          * 01400000
* ZEROS *ENTRIES* DEVICE TYPE  * VOLUME  SERIAL       *    SEQUENCE   * 01420000
*       *IN     *              *       NUMBER         *      NUMBER   * 01440000
*       * LIST  *              *                      *               * 01460000
*       *       *              *                      *               * 01480000
*********************************************************************** 01500000
*       *       *              *                      *               * 01520000
*1-BYTE *1-BYTE *4-BYTES       *6-BYTES               *2-BYTES        * 01540000
*                                                                       01560000
**N O T E S --- THE FIRST TWO BYTES PICTURED ABOVE ARE PRESENT ONLY     01580000
**              IN THE FIRST ENTRY OF THE LIST,THE FIRST BYTE OF        01600000
**              WHICH IS NOT USED. THE TAPE SEQUENCE NUMBER IS ZERO     01620000
**              FOR DASD.                                               01640000
*                                                                       01660000
         L     A3,IEHMVV30+12           ADDR OF 'FROM' DD      @ZM30153 01680003
         XC    FROMVOLL,FROMVOLL        INDICATE NO GETMAIN DONE A48782 01690022
         SR    A1,A1                    CLEAR REGISTER         @ZM30153 01692003
         ICM   A1,3,14(A3)              GET UCB ADDR           @ZM30153 01700003
         LR    A3,A1                                             A48782 01710022
         USING UCB,A3                                            A48782 01720022
         TM    UCBID,X'FF'                                              01728013
         DROP  A3                                                A48782 01732022
         BC    12,SCRH2321                                              01736013
         TM    18(A1),X'20'             TEST FOR FROM VOL BEING         01740000
         BZ    SCRTCHOK                  DIRECT ACCESS - IF NOT BRANCH  01760000
SCRH2321 L     A4,IEHMVV10              ADDR OF 'TO' VOL LIST    A48782 01780022
         SR    A7,A7                                             A48782 01790022
         IC    A7,1(A4)                 NO OF VOLS IN 'TO'LIST   A48782 01792022
         LA    A5,12                    LENGTH OF ENTRY IN LIST  A48782 01794022
         MR    A6,A5                    TOTAL LENGTH OF ENTRIES  A48782 01796022
         LA    A4,3(A4,A7)              ADDR OF END OF 'TO' LIST A48782 01798022
         SRL   A4,1                     PLUS ONE                 A48782 01798422
         SLL   A4,1                     ROUNDED TO HALFWORD BDRY A48782 01798822
         ST    A4,FROMVOLA              SAVE BEGIN OF NEW LIST   A48782 01799222
         SR    A7,A7                                             A48782 01799622
         IC    A7,IEHMVV22              NO OF VOLS IN FROM LIST  A48782 01799722
         LR    A8,A7                    SAVE                     A48782 01799822
         MR    A6,A5                    LENGTH OF ENTRIES IN NEW A48782 01799922
         LA    A0,2(A7)                 LENGTH OF NEW FROM LIST  A48782 01806622
         AR    A4,A0                    END OF NEW FROM LIST     A48782 01808622
         L     A7,IEHMVV10+4            END OF WORKAREA          A48782 01810622
         LA    A7,1(A7)                                          A48782 01812622
         CR    A4,A7                    CHECK IF NEW LIST FITS   A48782 01813022
*                                       IN WORKAREA              A48782 01813122
         BNH   BUILDLST                 IF YES, USE WORKAREA     A48782 01813222
         GETMAIN R,LV=(0)               IF NOT, GETMAIN NEW AREA A48782 01819922
         STH   A0,FROMVOLL              SAVE LENGTH OF AREA      A48782 01821922
         LA    A1,0(A1)                                          A48782 01823922
         ST    A1,FROMVOLA              SAVE ADDR OF VOL LIST    A48782 01825922
BUILDLST L     A7,IEHMVV22              ADDR OF OLD FROM LIST    A48782 01826322
         L     A4,FROMVOLA              LOAD ADDR OF VOL LIST    A48782 01826422
         STH   A8,0(A4)                 STORE NO OF VOLS IN NEW  A48782 01826522
         LA    A6,2(A4)                 SET TO FIRST VOL ENTRY   A48782 01831222
MOVENTRY MVC   0(12,A6),0(A7)           MOVE ENTRY INTO NEW LIST A48782 01833222
         CLI   3(A6),X'00'              IS UNIT TYPE ZERO      @ZA11951 01833737
         BNE   NEXT                     NO, BRANCH             @ZA11951 01834237
         MVC   0(4,A6),16(A3)           GET DEV TYPE FROM UCB  @ZA11951 01834737
NEXT     AR    A6,A5                    NEXT ENTRY IN NEW LIST @ZA11951 01835237
         LA    A7,17(A7)                NEXT ENTRY IN OLD LIST   A48782 01835622
         BCT   A8,MOVENTRY              REPEAT IF MORE ENTRIES   A48782 01835722
         LR    A0,A3                    GET UCB ADDRESS          A48782 01835822
         L     A1,SCRHCODE              LOAD SCRATCH CONTROLBITS A48782 01837222
         L     A2,IEHMVV21              LOAD ADDR OF 'FROM' DSN  A48782 01840022
         SR    A3,A3                    CLEAR A3                 A48782 01920022
         STM   A1,A4,IEHMVV00           STORE PARAMETERS FOR SCRATCH    01940000
         SCRATCH IEHMVV00               SCRATCH THE 'FROM' DATA SET     01960000
         LTR   A15,A15                 TEST RETURN CODE                 01980000
         BZ    SCRTCHOK                ZERO --- SCRATCH OK              02000000
         B     BADSCR                  NON-ZERO SCRATCH NO GOOD - ERROR 02020000
SCRTCHOK DS    0H                                                       02040000
         BAL   A14,BIGMSG          ******    LINK TO WRITE MSG          02060000
         B     RENAME                                                   02080000
         EJECT                                                          02100000
BADSCR   DS    0H                                                       02120000
         BAL   A14,BIGMSG          ******    LINK TO WRITE MSG          02140000
         LA    A8,IEHMVV00+1       ******                               02160000
         LA    A15,16                   *                               02180000
         BAL   A14,MSGCLEAR             *                               02200000
         BAL   A14,MSGDS                *    WRITE MESSAGE-             02220000
         LA    A15,20                   *       'DS XX MAY STILL EXIST' 02240000
         BAL   A14,MSG                  *                               02260000
         BAL   A2,LINEPR                *                               02280000
         LA    A15,ANY                 *                         A37862 02290021
         BAL   A14,MSGVOL               *                               02300000
         BAL   A2,LINEPR           ******                               02320000
         B     RENAME                                                   02340000
BIGMSG   ST    A14,BIG14           ******                               02360000
         LA    A8,IEHMVV00+1            *                               02380000
         LA    A15,4                    *                               02400000
         BAL   A14,MSGCLEAR             *                               02420000
         BAL   A14,MSGDS                *                               02440000
         LA    A15,8                    *                               02460000
         BAL   A14,MSG                                                  02480000
         BAL   A2,LINEPR                *                               02500000
         SR    A15,A15                  *    WRITE MESSAGE-             02520000
         BAL   A14,MSGVOL               *       'DS XX MOVED TO VOL X   02540000
         BAL   A2,LINEPR                *           AND NOW NAMED YY'   02560000
         TM    IEHMVV20+3,RENAM                                         02580000
         BZ    BIGDONE                  *                               02600000
         LA    A8,IEHMVV00+1            *                               02620000
         LA    A15,12                   *                               02640000
         BAL   A14,MSGCLEAR             *                               02660000
         SR    A15,A15                  *                               02680000
         BAL   A14,MSGDS                *                               02700000
         BAL   A2,LINEPR                *                               02720000
BIGDONE  L     A14,BIG14                *                               02740000
         BR    A14                      *                               02760000
         EJECT                                                          02780000
RENAME   TM    IEHMVV20+2,PHONYTO      WAS 'TO' DSNAME FAKED            02800000
         BZ    FROMKEY                 NO - BRANCH                      02820000
         L     A1,IEHMVV31+8           YES -- GET ADDRESS OF 'TO' DDNAM 02840000
         SR    A0,A0                    CLEAR REGISTER         @ZM30153 02850003
         ICM   A0,3,14(A1)              LOAD UCB ADDR          @ZM30153 02860003
         L     A1,RENMCODE              LOAD RENAME CONTROL BITS        02880000
         L     A2,IEHMVV21+4            LOAD ADDR OF 'TO' DS NAME       02900000
         L     A3,IEHMVV21              LOAD ADDR OF 'FROM' DS NAME     02920000
         L     A4,IEHMVV10             ADDR OF TO VOL LIST MADE BY SN   02940000
         STM   A1,A4,IEHMVV00           STORE PARAMETERS FOR RENAME     02960000
         RENAME IEHMVV00                RENAME THE 'TO' DATA SET        02980000
         LTR   A15,A15                 TEST RETURN CODE -- ZERO IS OK   03000000
         BZ    FROMKEY                 RENAME WORKED OK                 03020000
         LA    A8,IEHMVV00+1       ******                               03040000
         LA    A15,24                   *    WRITE MESSAGE -            03060000
         BAL   A14,MSGCLEAR             *       'DS MAY HAVE GEN NAME'  03080000
         BAL   A2,LINEPR                *                               03100000
         SR    A15,A15                  *                               03120000
         BAL   A14,MSGVOL               *                               03140000
         BAL   A2,LINEPR           ******                               03160000
**********************************************************************  03170004
*        LINES 032100-034796 WERE REACTIVATED IN SUPPORT       @Z40CSJH 03180004
*        OF THE EXTENDED MVS CVOL FUNCTION                     @Z40CSJH 03190004
**********************************************************************  03192004
FROMKEY  MVI   IEHMVV00+16,X'00'       CLEAR SW                         03260004
         TM    IEHMVV20+1,X'40'         WAS CVOL SPECIFIED              03320004
         BO    CVOLCAT                  YES-TO CATLG CVOL               03330004
         TM    IEHMVV20,X'10'          TEST FOR GROUP OPERATION         03360004
         BO    RECATRSA                 IF SO- CHECK FOR NAME           03410004
         TM    IEHMVV20,X'01'           IS FROM BIT SET        @Z40CSJH 03420004
         BO    RETURN                   YES - TO RETURN        @Z40CSJH 03430004
         TM    IEHMVV20,X'20'           DSNAME SPECIFIED                03460004
         BO    RECATRES                 YES-TO VSAM CATLG               03470004
         TM    IEHMVV20,X'08'           PDS SPECIFIED                   03472004
         BO    RECATRES                 YES-TO VSAM CATLG               03472404
         B     FROMKEYA                 TO CHECK UNCATLG                03472804
RECATRSA TM    IEHMVV20+5,X'20'         DSGRP NAME SPEC.                03473204
         BO    RECATRES                 YES=TO VSAM CATLG               03473604
         B     RECATRSC                 TO SYSRES HNDLING               03473704
FROMKEYA TM    IEHMVV20+1,X'20'         WAS UNCATALOG SPECIFIED         03474004
         BO    UNCATRES                   IF SO ---                     03476004
         B     RECATRSC                   IF NOT ---                    03478004
CVOLCAT  DS    0H                                                       03478404
         TM    IEHMVV20+1,X'20'         WAS UNCATALOG SPECIFIED         03478804
         BO    UNCATVOL                   IF SO ---                     03479204
         B     RECATVOL                   IF NOT ---                    03479604
         EJECT                                                          03480000
********************************************************************    03500000
**       HANDLES UNCATALOGING IF UNCATLG KEYWORD SPECIFIED              03520002
********************************************************************    03540000
UNCATRES L     A1,CATCODE1              LOAD UNCATALOG CONTROL BITS     03560000
         L     A2,IEHMVV21              LOAD ADDR OF 'FROM' DSNAME      03580000
         SR    A3,A3                    INDICATE NO CVOL                03600002
         SR    A4,A4                    SET SWITCH                      03620002
         B     CATALOGY                                                 03640004
*********************************************************************   03650004
*                                                                       03652004
*     THIS ROUTINE HANDLES UNCATALOGING-CATALOGING OF A DATA SET        03654004
*     IF IT WAS DEFINED IN THE VSAM MASTER CATALOG                      03656004
*                                                                       03658004
*********************************************************************   03658404
RECATRES EQU   *                                                        03668404
         L     A2,IEHMVV21              GET @ OF FROM DSNAME            03670404
         L     A4,IEHMVV10              GET @ OF TO VOL LIST            03672404
         SR    A3,A3                    INDICATE NO CVOL                03674404
         L     A1,CATCODE1              UNCATLG CONTROL BITS            03676404
         MVI   IEHMVV00+16,X'FF'                                        03676504
         B     CATALOG                  BR TO CATALOG OPER.             03682304
REDOCAT  EQU   *                                               @ZA18380 03692300
         L     A2,IEHMVV21+4            GET @ OF TO DSNAME     @ZA18380 03692400
         TM    IEHMVV20+3,X'04'         RENAME SPECIFIED       @ZA18380 03692500
         BO    RENAME1                  YES, BRANCH AROUND     @ZA18380 03692600
         L     A2,IEHMVV21              GET @ OF FROM DSNAME   @ZA18380 03696900
RENAME1  L     A1,CATCODE5             LOAD CATLG CONTROL BITS @ZA18380 03702500
CATALOG1 LA    A10,IEHMVV82+4           GET @ OF TTR FIELD              03706804
         ST    A10,IEHMVV00+16          STORE IN PARM LIST              03711104
CATALOG  STM   A1,A4,IEHMVV00           STORE PARM LIST                 03715404
         CATALOG IEHMVV00                                               03719704
         LTR   A15,A15                  TEST RETURN CODE                03724004
         BC    7,CATBAD                 BR + OR -,0 OK                  03728304
         LTR   A4,A4                    WAS UNCATLG ATTEMPTED           03732604
         BZ    UNCATOK                  YES - BRANCH                    03736904
         TM    IEHMVV20+1,X'20'         WAS UNCATLG SPEC'D     @Z40CSJH 03741204
         BO    UNCATOK                  BRANCH IF YES          @Z40CSJH 03745504
         CLI   IEHMVV00+16,X'FF'        CATLG/UNCATLG PAIR              03749804
         BE    REDOCAT                  IF SO ---                       03754104
         LA    A8,IEHMVV00+1            *****                           03758404
         LA    A15,32                   *   WRITE MESSAGE-              03762704
         BAL   A14,MSGCLEAR             * 'DS MOVED-RECATLG             03767004
         BAL   A2,LINEPR                *****                           03771304
         B     RETURN                   TO NEXT MODULE                  03775604
*                                                                       03779904
********************************************************************    03784204
*        LINES 031700-058271 WERE REACTIVATED IN SUPPORT       @Z40CSJH 03788504
*        OF THE EXTENDED MVS CVOL FUNCTION                     @Z40CSJH 03792804
*                                                              @Z40CSJH 03797104
********************************************************************    03801404
**                                                                      03805704
**       HANDLES RECATALOGING ON SYS RES                                03810004
**                                                                      03860004
********************************************************************    03910004
*                                                                       03960004
RECATRSC L     A1,CATCODE2              LOAD RECATALOG CONTROL BITS     04010004
         L     A2,IEHMVV21              LOAD ADDR OF 'FROM' DSNAME      04060004
         L     A4,IEHMVV10             ADDR OF TO VOL LIST MADE BY SN   04110004
         SR    A3,A3                    CLEAR A3                        04160004
         TM    IEHMVV20+3,X'04'        WAS RENAME SPEC                  04210004
         BO    RERECAT1                   IF SO ---                     04260004
         B     CATALOGX                                          S21042 04310004
*                                                                       04360004
********************************************************************    04410004
**                                                                      04460004
**       HANDLES UNCATALOGING ON A CVOL                                 04510004
**                                                                      04560004
********************************************************************    04610004
*                                                                       04660004
UNCATVOL L     A1,CATCODE3              LOAD UNCATALOG CONTROL BITS     04710004
         L     A2,IEHMVV21              LOAD ADDR OF FROM DS NAME       04760004
         L     A3,IEHMVV24              LOAD ADDR OF CVOL LIST          04810004
         LA    A3,4(A3)                 BUMP POINTER TO VOL ID          04860004
         SR    A4,A4                    CLEAR A4                        04910004
         B     CATALOGY                                                 04960004
*                                                                       05010004
********************************************************************    05060004
**                                                                      05110004
**       HANDLES RECATALOGING ON A CVOL                                 05160004
**                                                                      05210004
********************************************************************    05260004
*                                                                       05310004
RECATVOL L     A1,CATCODE4              LOAD RECATALOG CONTROL BITS     05360004
         L     A2,IEHMVV21              LOAD ADDR OF 'FROM' DS NAME     05410004
         L     A3,IEHMVV24              LOAD ADDR OF CVOL LIST          05460004
         LA    A3,4(A3)                 BUMP TO POINT TO VOL ID         05510004
         L     A4,IEHMVV10             ADDR OF TO VOL LIST MADE BY SN   05560004
         TM    IEHMVV20+3,X'04'        WAS RENAME SPEC                  05610004
         BO    RERECAT2                   IF SO ---                     05660004
         B     CATALOGX                                          S21042 05710004
*                                                                       05720004
*********************************************************************   05730004
**                                                                      05740004
**       HANDLES RECATALOGING A RENAMED DATA SET                        05750004
**                                                                      05752004
*********************************************************************   05754004
*                                                                       05756004
RERECAT1 L     A1,CATCODE1             LOAD CATALOG CONTROL BITS        05758004
         MVI   IEHMVV00+16,X'FF'                                        05758404
         B     CATALOGY                                                 05758804
RERECAT2 L     A1,CATCODE3             LOAD CATALOG CONTROL BITS        05759204
         MVI   IEHMVV00+16,X'FF'                                        05759604
         B     CATALOGY                                                 05759704
REDOCATA L     A2,IEHMVV21+4           LOAD ADDR OF TO DSNAME           05759804
         TM    IEHMVV20+1,X'40'        WAS CVOL SPEC                    05763804
         BO    CATCVOL                    IF SO ---                     05765804
         L     A1,CATCODE5             LOAD CATALOG CONTROL BITS        05767804
         B     CATALOGX                                          S21042 05767904
CATCVOL  L     A1,CATCODE6             LOAD CATALOG CONTROL BITS        05769204
*        B     CATALOGX BE CARE *** NO INSTRUCTION *** COMMENT   S21042 05771204
*                                                                       05771604
********************************************************************    05771704
**                                                                      05771804
**       THIS ROUTINE ISSUES THE 'CATALOG' MACRO FOR UNCATALOGING       05771904
**         OR RECATALOGING THE MOVED DATA SET                           05776204
**                                                                      05778204
********************************************************************    05780204
*                                                                       05780604
CATALOGX LA    A10,IEHMVV82+4          LOAD ADDRESS TTR FIELD    S21042 05781004
         ST    A10,IEHMVV00+16         STORE IT IN PARAMETERLIST S21042 05781104
CATALOGY STM   A1,A4,IEHMVV00           STORE PARAMETER LIST            05781204
         CATALOG  IEHMVV00              UNCATALOG OR RECATALOG          05782104
         CH    A15,=H'16'              MISSING INDEX             A38740 05782504
         BE    BUILDX                  IF SO, BUILD INDEX        A38740 05782904
         LTR   A15,A15                 TEST RETURN CODE                 05783304
         BC    7,CATBAD                BRANCH ON PLUS OR MINUS - ZERO   05783704
*                                      IS THE ONLY CODE THATS OK        05783804
         LTR   A4,A4                   TEST TO SEE IF UNCATALOG WAS     05783904
         BZ    UNCATOK                   ATTEMPTED - IF SO BRANCH       05784904
         CLI   IEHMVV00+16,X'FF'       IS THIS A RENAME,RECATALOG       05786904
         BE    REDOCATA                   IF SO ---                     05787904
         LA    A8,IEHMVV00+1       ******                               05789904
         LA    A15,32                   *    WRITE MESSAGE-             05790904
         BAL   A14,MSGCLEAR             *       'DS JUST MOVED-RECTLG   05792904
         BAL   A2,LINEPR           ******                               05793204
         B     RETURN                                                   05793604
UNCATOK  DS    0H                                                       05793704
         LA    A8,IEHMVV00+1       ******                               05793804
         LA    A15,28                   *    WRITE MESSAGE-             05793904
         BAL   A14,MSGCLEAR             *       'DS JUST MOVED-UNCTLG   05794704
         BAL   A2,LINEPR           ******                               05796704
         B     RETURN                                                   05797004
CATBAD   LTR   A4,A4                    TEST TO SEE IF UNCATALOG WAS    05797404
         BZ    UNCATBAD                   ATTEMPTED -- IF SO BRANCH     05797804
         LA    A8,IEHMVV00+1       ******                               05797904
         LA    A15,40                   *    WRITE MESSAGE-             05798004
         BAL   A14,MSGCLEAR             *       'DS JUST MOVED-NOT RECT 05798104
         BAL   A2,LINEPR           ******                               05798204
         B     RETURN                                                   05801604
UNCATBAD DS    0H                                                       05803604
         LA    A8,IEHMVV00+1       ******                               05805604
         LA    A15,36                   *    WRITE MESSAGE-             05805704
         BAL   A14,MSGCLEAR             *       'DS JUST MOVED-NOT UNCT 05805804
         BAL   A2,LINEPR           ******                               05805904
         B     RETURN                                            A38740 05806304
BUILDX   LTR   A5,A5                   CHECK FOR FIRST TIME      A38740 05806704
         BZ    CATBAD                  IF NOT ---                A38740 05806804
         L     A1,CATCODE7             LOAD BUILDX CONTROL BITS  A38740 05806904
         ST    A1,IEHMVV00             STORE IN PARAMETER LIST   A38740 05807004
         SR    A5,A5                   CLEAR A5 FOR FIRST TIME IN CHECK 05808104
         L     A3,IEHMVV21+4           ADDRESS OF TO-DSNAME      A38740 05810104
         LA    A2,44(A3)               ADDRESS OF END OF DSNAME  A38740 05810204
FINDPER  CLI   0(A3),C'.'              CHECK FOR PERIOD          A38740 05811304
         BE    DOBUILD                   IF SO ---               A38740 05813304
         CR    A3,A2                   CHECK FOR END OF NAME     A38740 05813404
         BE    DOCAT                   IF SO ---                 A38740 05814304
BUMP     LA    A3,1(A3)                BUMP POINTER UP ONE       A38740 05816304
         B     FINDPER                                           A38740 05816804
DOCAT    L     A1,CATCODE6             LOAD CATALOG CONTROL BITS A38740 05817204
         L     A2,IEHMVV21+4                                     A38740 05817604
         L     A4,IEHMVV10                                       A38740 05818004
         L     A3,IEHMVV24             LOAD ADDR OF CVOL LIST  @XA04175 05818104
         LA    A3,4(A3)                BUMP TO POINT TO VOL ID @XA04175 05821304
         B     CATALOGY                GO AND CATALOG          @XA04175 05823304
DOBUILD  MVI   0(A3),C' '              REPLACE . WITH BLANK      A38740 05823704
         INDEX IEHMVV00                BUILD INDEX               A38740 05824104
         MVI   0(A3),C'.'              MOVE . BACKM IN           A38740 05824504
         B     *+4(A15)                                          A38740 05824604
         B     BUMP                                              A38740 05824704
         B     CATBAD                                            A38740 05825204
         B     BUMP                                              A38740 05825604
         B     CATBAD                                            A38740 05826004
         B     CATBAD                                            A38740 05826104
         B     CATBAD                                            A38740 05826204
         B     CATBAD                                            A38740 05826304
         B     CATBAD                                            A38740 05827104
         EJECT                                                          05829004
RETURN   LH    A0,FROMVOLL              LENGTH OF GETMAIN AREA   A48782 05829804
         LTR   A0,A0                    CHECK LENGTH             A48782 05831204
         BZ    RETURN1                  IF ZERO, NO GETMAIN DONE A48782 05834404
         FREEMAIN R,LV=(0),A=FROMVOLA   IF NOT ZERO, FREE AREA   A48782 05837604
RETURN1  IEHPOST ,TC                                             A48782 05840804
         L     14,12(0,13)             RESTORE REG 14 TO KEEP PTR HOME  05844004
         TM    IEHMVV20,X'10'          TEST FOR GROUP OPERATION         05847204
         BO    ENDGRP                     IF SO ---                     05850404
         TM    IEHMVV20,X'02'          TEST FOR VOLUME OPERATION        05853604
         BO    ENDVOL                     IF SO -----                   05856804
         TM    IEHMVV20+2,X'20'        TEST FOR END BIT                 05860000
         BO    END                        IF ON ---                     05880000
         LA    A1,EST                  GO TO CARD SCANNER               05900000
EOJ      XCTL  (2,12),EPLOC=(A1)                                        05920000
END      LA    A1,ESK                  GO TO FINAL WRAPUP               05940000
         B     EOJ                                                      05960000
ENDGRP   LA    A1,ESH                  GO TO GROUP WRAPUP               05980000
         B     EOJ                                                      06000000
ENDVOL   LA    A1,ESZ                  CONTINUE VOLUME OPERATION        06020000
         B     EOJ                                                      06040000
         SPACE 4                                                        06060000
         DS    0D                                                       06080000
EST      DC    CL8'IEHMVEST'           CARD SCANNER ROUTINE             06100000
ESK      DC    CL8'IEHMVESK'           FINAL WRAPUP ROUTINE             06120000
ESH      DC    CL8'IEHMVESH'           GROUP WRAPUP ROUTINE             06140000
ESZ      DC    CL8'IEHMVESZ'           VOLUME MOVE ROUTINE              06160000
         EJECT                                                          06180000
*                                                                       06200000
*********************************************************************   06220000
**                                                                      06240000
**                            MESSAGE MOVER                             06260000
**                                                                      06280000
**       THIS SUBROUTINE IS LINKED TO IN ORDER TO MOVE MESSAGES         06300000
**       FROM THE MESSAGE CSECT TO THE PRINT AREA (IEHMVV00)            06320000
**       THE LINKAGE IS AS FOLLOWS:          A8= LOCATION FOR MSG       06340000
**                                 A14= RETURN ADDR                     06360000
**                       A15= DISPLACEMENT OF ADCON OF CORRECT MSG      06380000
**       WHEN THIS ROUTINE IS DONE A8  WILL POINT ONE SPACE PAST        06400000
**       THE MOVED MESSAGE --- ALL REGISTERS ARE TRANSPARENT            06420000
**       EXCEPT REGISTERS A1 AND A15 -- THE PRINT AREA IS CLEARED       06440000
**       IF THE INSTRUCTION 'MSGCLEAR' IS LINKED TO                     06460000
**                                                                      06480000
*********************************************************************   06500000
*                                                                       06520000
MSGCLEAR MVI   IEHMVV00,C' '           CLEAR THE PRINT AREA             06540000
         MVC   IEHMVV00+1(120),IEHMVV00                                 06560000
MSG      L     A1,MSGAD                 GET ADDR OF MSG CSECT           06580000
         AR    A1,A15                   ADD DISP OF CORRECT ADCON       06600000
         L     A1,0(A1)                 LOAD ADDR OF MSG-1              06620000
         IC    A15,0(A1)               LOAD LENGTH OF MSG               06640000
         EX    A15,MSGMOVE              EXECUTE MOVE                    06660000
         AR    A8,A15                   CALC ADDR OF END OF MSG         06680000
         LA    A8,2(A8)                BUMP REG TO END OF MSG +1        06700000
         BR    A14                      RETURN                          06720000
MSGMOVE  MVC   0(1,A8),1(A1)           MOVE MSG                         06740000
         EJECT                                                          06760000
*                                                                       06780000
*********************************************************************   06800000
**                                                                      06820000
**                            DATA SET NAME MOVER                       06840000
**                                                                      06860000
**       THIS SUBROUTINE IS LINKED TO IN ORDER TO MOVE DATA SET         06880000
**       NAMES INTO A MESSAGE THE LINKAGE IS AS FOLLOWS:                06900000
**                                           A8= LOCATION FOR NAME      06920000
**                                 A14= RETURN ADDR                     06940000
**                       A15= CODE TO DEFINE WHICH DS NAME              06960000
**                             IF A15=0 ---MOVE 'TO' DS NAME            06980000
**                             IF A15= NOT 0 --- MOVE 'FROM' DS NAME    07000000
**       WHEN THIS ROUTINE IS DONE A8 WILL POINT ONE SPACE PAST         07020000
**       THE MOVED NAME                                                 07040000
**                                                                      07060000
*********************************************************************   07080000
*                                                                       07100000
MSGDS    LTR   A15,A15                  TEST FOR A15=0                  07120000
         BZ    TODS                       IF SO BRANCH                  07140000
         L     A15,IEHMVV21             GET ADDR OF 'FROM' DS NAME      07160000
         B     DSMOVE                                                   07180000
TODS     L     A15,IEHMVV21+4           GET ADDR OF 'TO' DS NAME        07200000
DSMOVE   MVC   0(44,A8),0(A15)          MOVE DS NAME TO PRINT AREA      07220000
CHKEND   CLI   0(A8),C' '              CHECK FOR END OF NAME            07240000
         BE    NAMEEND                    IF REACHED BRANCH ---         07260000
         LA    A8,1(A8)                 BUMP POINTER TO PRINT AREA      07280000
         B     CHKEND                                                   07300000
NAMEEND  LA    A8,1(A8)                 ALLOW FOR SPACE AFTER NAME      07320000
         BR    A14                      RETURN                          07340000
         EJECT                                                          07360000
*                                                                       07380000
********************************************************************    07400000
**                                                                      07420000
**                            MESSAGE WRITE CALLER                      07440000
**                                                                      07460000
**       THIS ROUTINE WILL BE LINKED TO WHENEVER A LINE OF OUTPUT       07480000
**       IS TO BE WRITTEN ON 'SYSPRINT' IT WILL HAVE NO PARAMETERS      07500000
**       AND ASSUME THAT THE LINE TO BE WRITTEN IS LOCATED AT IEHMVV00  07520000
**       AFTER THE WRITE IS COMPLETE, CONTROL WILL BE PASSED BACK VIA   07540000
**       A2 UNLESS A PERMANENT I/O ERROR WAS ENCOUNTERED                07560000
**                                                                      07580000
********************************************************************    07600000
*                                                                       07620000
LINEPR   LA    A3,IEHMVV00             LOAD ADDRESS OF PRINT AREA       07640000
         LINK EP=IEHMVESU              GO TO MSG WTR                    07660000
         LTR   A15,A15                 CHECK RETURN CODE                07680000
         BZ    0(A2)                   IF ZERO WRITE OK - IF NOT EOJ    07700000
* E R R O R    E X I T                                                  07720000
         LH    A0,FROMVOLL              LENGTH OF GETMAIN AREA   A48782 07740022
         LTR   A0,A0                    CHECK LENGTH             A48782 07750022
         BZ    ERREXIT                  IF ZERO, NO GETMAIN DONE A48782 07752022
         FREEMAIN R,LV=(0),A=FROMVOLA   IF NOT ZERO, FREE AREA   A48782 07754022
ERREXIT  IEHPOST ,TC                                             A48782 07756022
         L     14,12(0,13)              RESTORE REG 14                  07760000
         SPACE 2                                                        07780000
         XCTL  (2,12),EP=IEHMVESK                                       07800000
         EJECT                                                          07820000
*                                                                       07840000
*********************************************************************   07860000
**                                                                      07880000
**                            VOLUME LIST MOVER                         07900000
**                                                                      07920000
**       THIS ROUTINE IS LINKED TO  IN ORDER TO MOVE A VOLUME LIST      07940000
**       TO THE PRINT AREA PLUS 20 BYTES(IEHMVV00+20)                   07960000
**       THE LINKAGE IS AS FOLLOWS                                      07980000
**                                 A14= RETURN ADDRESS                  08000000
**       THE FORMAT OF THE LIST IS AS FOLLOWS                           08020000
**         FOR DIRECT ACCESS --- 123 7986 A1763 IBM403                  08040000
**         FOR TAPE          --- 24,0001 7987,0007                      08060000
**         FOR UNIT RECORD   --- UNIT RECORD EQUIP -- UNIT = HR         08080000
**                                                                      08100000
**                            A15= CODE TO DEFINE WHICH VOL LIST        08120000
**                                 IF A15=0 --- 'TO' VOL LIST           08140000
**                                 IF A15= NOT ZERO --- 'FROM' VOL LIST 08160000
*********************************************************************   08180000
*                                                                       08200000
MSGVOL   MVI   IEHMVV00,C' '           CLEAR PRINT AREA                 08220000
         MVC   IEHMVV00+1(120),IEHMVV00                                 08240000
         ST    A14,SAVE14               SAVE RETURN ADDR                08260000
         XR    A7,A7                   CLEAR A7                         08280000
         LTR   A15,A15                  CHECK WHICH LIST TO MOVE        08300000
         BZ    TOVOL                      IF 'TO' LIST ---              08320000
         L     A5,FROMVOLA             ADDRESS OF FROM VOL LIST  A48782 08340022
         B     MOVEVOL                                                  08380000
TOVOL    L     A5,IEHMVV10             LOAD ADR OF 'TO' VOLUME LIST     08400000
MOVEVOL  IC    A7,1(A5)                LOAD NO OF VOLS IN TO LST A48782 08420022
         LA    A5,2(A5)                BUMP PTR TO START OF VOL LIST    08440000
         TM    2(A5),X'08'             TEST DEVTYPE UNIT RECORD  A48782 08460022
         BO    UNITVOL                    IF SO ---                     08480000
         CLI   IEHMVV74+12,X'FF'  WAS OUTPUT ON NL TAPE          A19476 08500018
         BE    UNITVOL                    IF SO ---                     08520000
         LA    A6,8                    LOAD MAX VOLUME COUNT PER LINE   08540000
PRTLIST  DS    0H                                                       08560000
         LA    A11,IEHMVV00+20         LOAD ADDRESS OF PRINT AREA       08580000
         CR    A7,A6                   COMPARE MAX VALUE TO ACTUAL      08600000
         LR    A0,A7                   LOAD COUNT IN CASE NOT HIGH      08620000
         BNH   CHKLIST                 IF NOT HIGHER CONTINUE NORMALLY  08640000
         LR    A0,A6                   MOVE MAX TO LOOP CONTROL REG     08660000
CHKLIST  MVC   0(6,A11),4(A5)          MOVE VOLUME SERIAL NUMBER        08680000
         LA    A11,6(A11)              BUMP PTR PAST VOLUME SERIAL NO.  08700000
         CLI   2(A5),X'80'             CHECK TAPE                A48782 08702022
         BNE   SETBLNK                 IF NOT, OMIT SEQNO IN LST A48782 08704022
         MVC   SEQNR(2),10(A5)    MOVE VOL. SEQ.NR.              A41824 08710021
         LH    A14,SEQNR          LOAD VOL. SEQ.NR.              A41824 08720021
         MVI   0(A11),C','             MOVE COMMA TO PRINT AREA         08780000
         CVD   A14,IEHMVV00+128         CONVERT TO DEC                  08800000
         UNPK  1(4,A11),IEHMVV00+128(8) UNPACK TAPE SEQUENCE NUMBER     08820000
         OI    4(A11),X'F0'            RESET SIGN TO PRINTABLE CHAR.    08840000
         LA    A11,5(A11)              BUMP PTR PAST TAPE SEQUENCE NO.  08860000
SETBLNK  LA    A11,1(A11)              LEAVE SPACE IN PRINT AREA        08880000
         LA    A5,12(A5)               BUMP PTR TO NEXT ENTRY IN LIST   08900000
         BCTR  A7,A0                   REDUCE INITIAL VOLUME COUNT ALSO 08920000
         BCT   A0,CHKLIST               LOOP IF MORE VOL ID.S           08940000
         OR    A0,A7                   TEST FOR VOLUME LIST FINISHED    08960000
         BZ    NOMORE                  INITIAL COUNT ZERO ALSO - END    08980000
         BAL   A2,LINEPR               BRANCH TO PRINT FIRST LINE       09000000
         MVI   IEHMVV00,C' '           CLEAR PRINT AREA AFTER PRINTING  09020000
         MVC   IEHMVV00+1(120),IEHMVV00                                 09040000
         B     PRTLIST                 REPEAT LOOP TO PRINT REST OF LST 09060000
NOMORE   DS    0H                                                       09080000
         L     A14,SAVE14               RESTORE REG A14                 09100000
         BR    A14                      RETURN                          09120000
UNITVOL  L     A15,MSGAD                LOAD ADDR OF MSG CSECT          09140000
         L     A15,0(A15)               LOAD ADDR OF FIRST MSG          09160000
         MVC   IEHMVV00+20(26),1(A15)      MOVE MSG TO PRINT            09180000
         MVI   IEHMVV74+12,X'00'  TURN NL TAPE SWITCH OFF        A19476 09190018
         BR    A14                      RETURN                          09200000
*                                                                       09220000
*          C O N S T A N T S                                            09240000
*                                                                       09260000
         DS    0F                                                A41824 09270021
SCRHCODE CAMLST  SCRATCH,MSGAD,,MSGAD                            S21042 09270121
RENMCODE CAMLST  RENAME,MSGAD,MSGAD,MSGAD                        S21042 09272021
CATCODE1 CAMLST  UNCAT,MSGAD         UNCATALOG ON SYSRES         S21042 09274002
**********************************************************************  09274404
* LINES 092760,093280,093780,094280,094380 WERE                @Z40CSJH 09274804
* REACTIVATED IN SUPPORT OF THE EXTENDED MVS                   @Z40CSJH 09275204
* CVOL FUNCTION                                                @Z40CSJH 09275604
**********************************************************************  09275704
CATCODE2 CAMLST RECAT,MSGAD,,MSGAD,DSCBTTR=MSGAD RECAT ON SYSRES S21042 09276004
CATCODE5 CAMLST CAT,MSGAD,,MSGAD,DSCBTTR=MSGAD CATALOG ON SYSRES S21042 09278021
CATCODE3 CAMLST  UNCAT,MSGAD,MSGAD           UNCATALOG ON CVOL   S21042 09328004
CATCODE4 CAMLST RECAT,MSGAD,MSGAD,MSGAD,DSCBTTR=MSGAD   CVOL     S21042 09378004
CATCODE6 CAMLST CAT,MSGAD,MSGAD,MSGAD,DSCBTTR=MSGAD    CVOL      S21042 09428004
CATCODE7 DC    XL4'84400000'           FOR BUILD INDEX           A38740 09438004
SAVE14   DS    F                       AREA TO SAVE REG 14 FOR PRT LOOP 09440000
SEQNR    DS    H                  AREA TO SAVE VOL.SEQ.NR.       A41824 09450021
FROMVOLL DS    H                       LENGTH OF GETMAIN AREA    A48782 09452022
FROMVOLA DS    F                       ADDRESS OF GETMAIN AREA   A48782 09454022
MSGAD    DC    V(IEHMVMSQ)             ADDRESS OF MESSAGE MODULE        09460000
BIG14    DS    F                       REG 14 SAVE AREA FOR BIGMSG ROUT 09480000
RENAM    EQU   X'04'                                                    09500013
PHONYTO  EQU   X'10'                                                    09520013
DSGRP    EQU   X'10'                   GROUP OPERATION           Y02918 09522002
ANY      EQU   1                       ANY VALUE NOT ZERO        A37862 09530021
PATCH    DS    10F                      PATCH AREA                      09532004
         IEHMVV                                                         09540000
UCB      DSECT                                                          09546013
         IEFUCBOB                                                       09552013
         END                                                            09560000
