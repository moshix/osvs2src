*TITLE ' IEHMVSST                                                     * 00020000
*ENTRY POINTS: IEHMVEST                                               * 00040000
*INPUT: POINTER TO IEHMOVE1 WORKAREA IN REG 12                        * 00060000
*EXTERNAL ROUTINES:  IEHMVSSS (CARD                                   * 00080002
*PARAMETER ANALIZER) IEHMVSSJ (CARD SCANNER RTN) IEHMVSSA (MESSAGE    * 00100000
*MODULE)                                                              * 00120000
*EXITS - NORMAL IEHMVSSH FOR DSGROUP OPERATION - IEHMVSSZ FOR ALL     * 00140002
*OTHER OPERATIONS                                                     * 00160000
*TABLES/WORK AREAS: WORK AREA POINTED TO BY REG 12 IS DESCRIBED BY    * 00180000
*DSECT IEHMVV                                                         * 00200000
*                                                                       00220000
*                                                                       00240000
*                                                                       00260000
*                                                                       00280000
*        PURPOSE                         THIS MODULE IS COMPOSED OF     00300000
*                                       THE ROUTINES TO PERFORM FOUR    00320000
*                                       SEPERATE FUNCTIONS   ALL  OF    00340000
*                                       WHICH ARE CONNECTED WITH        00360000
*                                       ANALIZING AN IEHMOVE REQUEST    00380000
*                                                                       00400000
*                                        THE FOUR FUNCTIONS ARE         00420000
*                                                                       00440000
*                                         1  INITIALIZATION OF THE      00460000
*                                            WORKING STORAGE PRIOR TO   00480000
*                                            SETTING IT UP FOR A        00500000
*                                            REQUEST                    00520000
*                                                                       00540000
*                                         2  WRITE APPRORRIATE DATA     00560000
*                                             INCLUDES                  00580000
*                                             EXCLUDES                  00600000
*                                             REPLACE                   00620000
*                                             SELECT                    00640000
*                                            ON WORK FILES UT1 AND UT2  00660000
*                                                                       00680000
*                                              3  FIND  FROM  VOLUME    00700000
*                                                 INFORMATION IN THE    00720000
*                                                 CATALOG WHEN          00740000
*                                                 NECESSARY             00760000
*                                                                       00780000
*                                              4  ANALIZE THE           00800000
*                                                 INFORMATION PROVIDED  00820000
*                                                 IN THE REQUEST PRIOR  00840000
*                                                 TO GOING TO MODULES   00860000
*                                                 THAT ACT UPON THE     00880000
*                                                 REQUEST               00900000
*                                                                       00920000
*BYTES USED AS                                                          00940000
*SWITCHES                A ONE EQUALS ON                                00960000
*                                                                       00980000
*LABEL OF SWITCH    LOOKFOR    INDICATES WHAT PARAM CARD SCANNER        01000000
*                              IS LOOKING FOR.                          01020000
*                                                                       01040000
*               BIT POS 8      KEYWORD DDNAME                           01060000
*                       4      ANY KEYWORD                              01080000
*                       2      A TYPE CODE                              01100000
*                       1      A VOL ID                                 01120000
*                       8      SEQ NUMBER                               01140000
*                       4      A DATA SET NAME                          01160000
*                       2      A MEMBER NAME                            01180000
*                       1      EXPAND DATA                              01200000
*                 ALL BITS OF  COMMAND                                  01220000
*                                                                       01240000
*                                                                       01260000
*                   LOOKFOR+1                                           01280000
*                                                                       01300000
*                                                                       01320000
*               BIT POS 8     I,E,R FILL  FILLING INCLUDE,EXCLUDE       01340000
*                             REPLACE BLOCK IN PERM WORK AREA           01360000
*                       4     ON WHEN PROCESSING INC EXC OR REP OR SEL  01380000
*                             CARDS                                     01400000
*                       2     COMPLEX  MORE THAN ONE TYPE-VOLID-SEQNO   01420000
*                             IN TO OR FROM LIST.                       01440000
*                       1     INCLUDE BLOCK WRITE OUT SW  ON WHEN BLOCK 01460000
*                             HAS BEEN WRITTEN ON WORK FILE  UT1        01480000
*                       8     EXCLUDE BLOCK WRITE OUT  ON WHEN BLOCK    01500000
*                             HAS BEEN WRITTEN ON UT2                   01520000
*                       4     INCLUDE CARD ENCOUNTERED                  01540000
*                       2     EXCLUDE ENCOUNTERED                       01560000
*                       1     SELECT  CARD ENCOUNTERED                  01580000
*                                                                       01600000
*                                                                       01620000
*                   IEHMVV74 + 14  CHECKS THE CONTENTS                  01640019
*                   OF INCLUDE BLOCK                                    01660000
*                                                                       01680000
*               BIT POS 8     DSNAME                                    01700000
*                       4     FROM  (TYPE-VOLID-SEQNO)                  01720000
*                       2     CVOL  (TYPE-VOLID-SEQNO)                  01740000
*                       1     MEMBER NAME                               01760000
*                       8     UNUSED                                    01780000
*                       4     UNUSED                                    01800000
*                       2     UNUSED                                    01820000
*                       1     UNUSED                                    01840000
*                                                                       01860000
*                                                                       01880000
*                        XSWITCHS                                       01900000
*                                                                       01920000
*               BIT  POS 8     SELECT CARD HAS BEEN OR IS BEING         01940000
*                             PROCESSED                                 01960000
*                       4     COMPLEX MEMBER  (MEMBER NAME LIST)        01980000
*                                                                       02000000
*                       2     MEMBER RENAME                             02020000
*                       1     UNUSED                                    02040000
*                       8     UNUSED                                    02060000
*                       4     UNUSED                                    02080000
*                       2     UNUSED                                    02100000
*                       1     UNUSED                                    02120000
*                                                                       02140000
*                                                                       02160000
*                        SWITCHRD       SET BY CARD SCANNER RTN         02180000
*                                                                       02200000
*               BIT  POS 8     SCAN ERROR     SYNTAX ERROR              02220000
*                                                                       02240000
*                       4     BYPASS   IF ON-NEXT ENTRY TO SCAN WILL    02260000
*                             RETURN OPERATOR FLD OF NEXT CARD          02280000
*                       2     END OF FILL ON SYSIN                      02300000
*                       1     SCAN RTN FIRST TIME IN                    02320000
*                                                                       02340000
*                       8     OPERATOR                                  02360000
*                                                                       02380000
*                       4     KEYWORD                                   02400000
*                                                                       02420000
*                       2     PARAMETER                                 02440000
*                                                                       02460000
*                       1     RIGHT PARENTHESIS                         02480000
*                                                                       02500000
*                                                                       02520000
*NOTE    ABOVE SWITCHES EXCEPT SWITCHRD ARE RESET TO ZEROS BEFORE       02540000
*        PROCESSING EACH IEHMOVE REQUEST                                02560000
*                                                                       02580000
*        SWITCHRD IS RESET TO ZEROS PRIOR TO GOING TO CARD SCANNER      02600000
*        FOR FIRST TIME ONLY                                            02620000
*                                                                       02640000
*                                                                       02660000
*                                                                       02680000
*                                                                       02700000
*                                                                       02740000
*                                                                       02760000
IEHMVSST CSECT                                                          02764008
*A128200-128360                                                @ZA07411 02768008
*C028800                                                       @ZA07411 02772008
*D128200                                                       @ZA07411 02776008
         EJECT                                                          02780000
*D109200-109400,110000-110200,110600-110800,111400,111600        A50958 02802822
*D11440                                                          A50958 02803222
*A109900-110400                                                  A50958 02804822
*D130816-132400                                                  A48781 02806400
*A131310-132348                                                  A48781 02809200
*A131114-131115                                                  A45139 02812000
*C131102                                                         A45139 02814800
*   ALL CODE FLAGGED S20201 WAS ADDED FOR RPS SUPPORT            S20201 02817600
* 130820,131050                                                  A33297 02820400
* 016400,067200,093000,099600,103200                             A27307 02823200
* 036600                                                         S21042 02826000
* 053000-053600,068800,078400,079600,082200                      A27307 02828800
*                                                                  I276 02831600
* 113600                                                         A15815 02834400
*A29900,89300,91500,106300-106320,107900-107940,108100          YL026VC 02836402
*C800,108400,134600                                             YL026VC 02836802
*D34600-35200,90600-91000,91800-104400,105400-105800            YL026VC 02836902
*D107200-107400                                                 YL026VC 02837002
*C1400,130810                                                    Y02918 02839002
*A33500-33520,130740                                             Y02918 02839102
*A034900-035200,093700-094084,097600-098900,090400-090900      @Z40CSJH 02849104
*A103600,105336,107500-107520,130760-130800,107700-107720      @Z40CSJH 02849504
*A130910-131110,134520,134700,105502,031900,104593-104596      @Z40CSJH 02855604
*D108100                                                       @Z40CSJH 02857604
*C108400,105502                                                @Z40CSJH 02859604
         ENTRY IEHMVEST                                                 02861704
         USING IEHMVV,12                                                02867804
         USING IEHMVEST,BASE                                            02873904
IEHMVEST SAVE  (14,12),T,IEHMVEST-OZ07411                      @ZA07411 02880008
         LR    BASE,15                                                  02900000
        IEHPRE (14,1),TFC                                               02920000
RO       EQU   0                                                        02940000
SCANAD   EQU   1                                                        02960000
LENGTH   EQU   2                                                        02980000
BADLOC   EQU   20                      BAD LOCATE MESSAGE CODE  YL026VC 02990002
DBR1     EQU   3                                                        03000000
DBR3     EQU   4                                                        03020000
DBCOMPR  EQU   5                                                        03040000
R6       EQU   6                                                        03060000
R7       EQU   7                                                        03080000
DBNXRPTR EQU   7                                                 A28295 03090019
BASE     EQU   8                                                        03100000
R9       EQU   9                                                        03120000
R10      EQU   10                                                       03140000
NXRPTR   EQU   11                                                       03160000
R12      EQU   12                                                       03180000
R15      EQU   15                                              @Z40CSJH 03190004
SAVEREG  EQU   13                                                       03200000
RETURN   EQU   14                                                       03220000
GOTO     EQU   15                                                       03240000
R1       EQU   1                                                        03260000
R2       EQU   2                                                        03280000
R3       EQU   3                                                        03300000
R4       EQU   4                                                        03320000
R5       EQU   5                                                        03340000
L8       EQU   8                       LENGTH OF 8               Y02918 03350002
D12      EQU   12                      DISPLACEMENT OF 12        Y02918 03352002
*                                                                     * 03360000
*              ANALIZE ENTRY CONTROL AND GIVE CONTROL TO              * 03380000
*              THE PROPER ROUTINE                                     * 03400000
*                                                                     * 03420000
*                                                                     * 03440000
         TM    IEHMVV20+4,X'10'         RETURN FROM VXSF       @Z40CSJH 03490004
         BZ    *+12                     BRANCH IF NOT          @Z40CSJH 03500004
         NI    IEHMVV20+4,X'EF'         CLEAR VXSF BIT         @Z40CSJH 03510004
         B     MNT3                     BR TO CHECK ON MOUNT   @Z40CSJH 03520004
         SR    R1,R1                                                    03540000
         IC    R1,ESTENTRY             INSERT ENTRY SW BYTE             03560000
         MVI   ESTENTRY,X'00'                                           03580000
         EX    0,BRANCH(R1)                                             03600000
BRANCH   B     INIT                                                     03620000
         B     FINDFROM                                                 03640000
         B     PREWRUT1          USER DID SPECIFY 'FROM' VOLUME  S21042 03650021
         B     SCAEXIT1                                                 03680000
*                                                                     * 03700000
*                                                                     * 03720000
*              INITIALIZE WORKING STORAGE  IEHMVV  AS NECESSARY       * 03740000
*              PRIOR TO SETTING UP AN IEHMOVE REQUEST                 * 03760000
*                                                                     * 03780000
*              POINT WORK FILES UT1 AND UT2  TO BEGINING OF FILES     * 03800000
*                                                                     * 03820000
*                                                                     * 03840000
INIT     DS    0H                                                       03860000
         MVI   IEHMVV51,X'60'                                           03880000
         XC    IEHMVV20+5(35),IEHMVV20+5  COMMAREA CLEAR         S20201 03900020
         XC    IEHMVV27+5(27),IEHMVV27+5  COMMAREA CLEAR                03920000
         NC    IEHMVV20(6),MASK1 TURN OFF ALL BUT PRINT CNTRL    A37919 03940021
*                                      AND RPS INDICATORS        S20201 03960020
         XC    IEHMVV61(8),IEHMVV61     CLEAR PDS RTN WORDS IN COMM     03980000
*                                       AREA                            04000000
         L     NXRPTR,FAADD             IS FIRST AVILIBLE ADDR POINTER  04020000
         LTR   NXRPTR,NXRPTR            ZERO                            04040000
         BNE   INIT1                    BRANCH IF ND                    04060000
         L     DBR1,NXTPTR              SET UP FIRST AVAILIBLE ADDR     04080000
         LA    DBR1,1(DBR1)             HALF WORD ALIGN THE BEGINING    04100000
         SRL   DBR1,1                   ADDR OF THE WORK AREA USED BY   04120000
         SLL   DBR1,1                   THE CONTROL CARD PARAMETER      04140000
         ST    DBR1,FAADD               RTN                             04160000
         ST    DBR1,NXTPTR                                              04180000
         B     INIT2                                                    04200000
INIT1    ST    NXRPTR,NXTPTR                                            04220000
INIT2    L     NXRPTR,NXTPTR                                            04240000
         XC    0(256,NXRPTR),0(NXRPTR)  CLEAR 256 BYTES OF PERM WORK    04260000
         LA    1,256                   TTRZ OF 0010                     04280000
         ST    1,SARG                                                   04300000
         LA    1,SARG                  ADDR OF 0010                     04320000
         LR    0,1                                                      04340000
         L     1,IEHMVV40              LOAD UT1 DCB PTR                 04360000
         POINT (1),(0)                                                  04380000
         LA    0,SARG                                                   04400000
         L     1,IEHMVV41              LOAD UT2 DCB PTR                 04420000
         POINT (1),(0)                                                  04440000
         CLI   ESSENTRY,X'10'          ESS ENTRY TO MOVE RTN            04460000
         BE    ESSEXIT                                                  04480000
         CLI   ESSENTRY,X'14'          ESS ENTRY FOR COPY RTN           04500000
         BE    ESSEXIT                                                  04520000
         B     ESJEXIT                                                  04540000
*                                       AREA FOR CC PARAMETER RTN       04560000
TRANS2   MVI   ESSENTRY,X'0C'                                           04580000
         B     ESSEXIT                                                  04600000
TRANS3   MVI   ESSENTRY,X'08'                                           04620000
         B     ESSEXIT                                                  04640000
*                                                                     * 04660000
*                                                                     * 04680000
*              THIS ROUTINE IS USED TO WRITE WORK FILES UT1 AND UT2   * 04700000
*                                                                     * 04720000
*              IT WILL GET AN INCLUDE  EXCLUDE  REPLACE  OR A SELECT  * 04740000
*              BLOCK OF INFORMATION THAT HAS PREVIOUSLY BEEN FORMED   * 04760000
*              IN WORKING STORAGE AND PLACE THE INFORMATION IN THE    * 04780000
*              PROPER RECORD FORMAT AND WRITE IT ON THE PROPER WORK   * 04800000
*              FILE                                                   * 04820000
*                                                                     * 04840000
*                                                                     * 04860000
         EJECT                                                          04880000
*              THE RECORD FORMATS ARE AS FOLLOWS                        04900000
*                                                                       04920000
*                1  RECORD PRODUCED BY AN  INCLUDE  REPLACE AND A       04940000
*                   SELECT ASSOCIATED WITH A PDS REQUEST    ON UT1      04960000
*                                                                       04980000
*                   BYTES IN KEY                                        05000000
*                                                                       05020000
*                     4       DEVICE TYPE CODE                          05040000
*                     6       VOLUME ID                                 05060000
*                     2       DEQUENCE NUMBER                           05080000
*                                                                       05100000
*                   BYTES IN DATA                                       05120000
*                                                                       05140000
*                     5       CCHHR OF THIS RECORD                      05160000
*                     1       BLOCK IDENTIFIER  I  E  R  ETC  EBCDIC    05180000
*                     44      DATA SET NAME                             05200000
*                     8       MEMBER NAME                               05220000
*                     4       DEVICE TYPE CODE                          05240000
*                     6       VOLUME ID                                 05260000
*                     2       DEQUENCE NUMBER                           05280000
*                     5       SPECIFIC UNIT IF SPECIFIED           DT0I 05300018
*                     8       MEMBER RENAME     V                  DT0I 05320018
*                                                                       05340018
*                  TOTAL  95  BYTES KEY AND DATA                   DT0I 05360018
         EJECT                                                          05380000
*                2  RECORD PRODUCED BY AN INCLUDE ASSOCIATED WITH     * 05400000
*                   A DSGROUP REQUEST   ON UT1                        * 05420000
*                                                                     * 05440000
*                   BYTES  IN KEY                                     * 05460000
*                                                                     * 05480000
*                     12      UNUSED                                  * 05500000
*                                                                     * 05520000
*                   BYTES  IN DATA                                    * 05540000
*                                                                     * 05560000
*                     5       UNUSED                                  * 05580000
*                     2       BINARY  LENGTH OF REMAINDER OF RECORD   * 05600000
*                     1       CODE BINARY ZERO FOR DSGROUP INCLUDE    * 05620000
*                     44      DATA SET NAME                           * 05640000
*                     2       BINARY COUNT OF 12 BYTE VOL ENTRIES     * 05660000
*                             TO FOLLOW  ALWAYS 1 ON DSGROUP INCLUDE  * 05680000
*                     4       DEVICE TYPE CODE                        * 05700000
*                     6       VOLUME ID                               * 05720000
*                     2       SEQUENCE NUMBER                         * 05740000
*                                                                     * 05760000
*                                                                     * 05780000
*                                                                     * 05800000
*                                                                     * 05820000
*                                                                     * 05840000
         EJECT                                                          05860000
*                                                                     * 05880000
*                                                                     * 05900000
*                   RECORD PRODUCED BY AN EXCLUDE OR REPLACE          * 05920000
*                   ASSOCIATED WITH A PDS REQUEST       ON  UT2       * 05940000
*                                                                     * 05960000
*                   BYTES  IN KEY                                     * 05980000
*                                                                     * 06000000
*                     8       MEMBER NAME                             * 06020000
*                                                                     * 06040000
*                   BYTES  IN DATA                                    * 06060000
*                                                                     * 06080000
*                     1       BLOCK IDENTIFIER                        * 06100000
*                     9       UNUSED                                  * 06120000
*                                                                     * 06140000
*                                                                     * 06160000
*                                                                     * 06180000
*                                                                     * 06200000
*                                                                     * 06220000
*                                                                     * 06240000
*                                                                     * 06260000
*                                                                     * 06280000
*                                                                     * 06300000
*                                                                     * 06320000
PREWRUT1 XC    IEHMVV82(3),IEHMVV82 FROM VOL SPEC, CLEAR DSCBTTR S21042 06330021
WRITEUT1 DS    0H                                                       06340000
         L     DBR1,IEHMVV40            LOAD ADDR OF UT1 DCB            06360000
         TM    LOOKFOR+1,X'10'          FIRST TIME IN                   06380000
         BZ    OPENUT1                  BRANCH IF YES                   06400000
WRITE1   L     R6,IEHMVV26              I,E,R BLOCK PTR                 06420000
         LR    R10,R6                                                   06440000
         SRL   R6,24                    DROP ADDR AND RETAIN COUNT      06460000
         SLL   R10,8                                                    06480000
         SRL   R10,8                    DROP COUNT AND RETAIN ADDR      06500000
         LR    NXRPTR,R10                                               06520000
         ST    NXRPTR,NXTPTR            RECLAIM PERM WORK AREA USED     06540000
*                                       FOR I,E,R BLOCK                 06560000
         ST    NXRPTR,IEHMVV26          STORE BLOCK PTR WITHOUT COUNT   06580000
WRITE4   CLI   0(R10),C'I'              IS THIS AN INCLUDE BLOCK        06600000
         BE    IWRITE                   BRANCH YES                      06620000
         CLI   0(R10),C'E'                         EXCLUDE BLOCK        06640000
         BE    EWRITE                   BRANCH YES                      06660000
         CLI   0(R10),C'R'                         REPLACE BLOCK        06680000
         BE    EWRITE                                                   06700000
CWRITE   MVC   WRITAREA+17(78),0(R10)  MOVE BLOCK TO WRITE AREA  A27307 06720019
         XC    WRITAREA(12),WRITAREA    ZERO KEY AREA                   06740000
CWRITE1  DS    0H                                                       06760000
         L     DBR1,IEHMVV40            COMPARE KL+DL+20 TO TRACK BAL   06780000
         L     R3,IEHMVV40             POINT TO SYSUT1 DCB         7972 06800000
         L     R3,12(0,R3)             POINT TO DEVICE TABLE       7972 06820000
         SR    R4,R4                   CLEAR REG                   7972 06840000
         IC    R4,7(0,R3)              LAST RECORD OVERHEAD        7972 06860000
         LA    R4,95(0,R4)             KEY DATA AND OVERHEAD CT    DT0I 06880018
         L     R3,IEHMVV40             POINT TO SYSUT1 DCB         7972 06900000
         CH    R4,18(0,R3)             WILL RECORD FIT ON TRACK    7972 06920000
         BH    CWRITE2                 NO  WILL NOT FIT            7972 06940000
         MVC   WRITAREA+12(5),8(DBR1)   MOVE CCHAR FROM DCB TO WRITAREA 06960000
         SR    DBR3,DBR3                                                06980000
         IC    DBR3,WRITAREA+16                                         07000000
         LA    DBR3,1(DBR3)             BUMP R OF CCHHR BY ONE          07020000
         STC   DBR3,WRITAREA+16                                         07040000
         B     CWRITE3                                                  07060000
CWRITE2  DS    0H                                                       07080000
         SR    DBR3,DBR3                                                07100000
         STH   DBR3,18(DBR1)                                            07120000
         L     2,IEHMVV40               LOAD UT1 DCB ADDR               07140000
         LA    2,5(2)                                                   07160000
         LA    1,39(2)                  LOAD ADDR OF DEBAD              07180000
         L     1,0(1)                   LOAD DEB ADDR                   07200000
         L     15,16                                                    07220000
         L     15,32(0,15)              ADDR OF MBBCCHHR TO TTR RTN     07240000
         STM   14,12,12(13)                                             07260000
         LA    13,88(13)                                                07280000
         LR    5,13                                                     07300000
         BALR  14,15                                                    07320000
         LR    13,5                                                     07340000
         LA    3,88                                                     07360000
         SR    13,3                                                     07380000
         LM    8,12,52(13)                                              07400000
         SRL   0,8                                                      07420000
         AH    0,DBCTONE          ADD ONE TO T IN TTR                   07440000
         IC    0,DBCTONE               SET R OF TTR TO ONE              07460000
         SLL   0,8                                                      07480000
         L     1,IEHMVV40               LOAD UT1 DCB ADDR               07500000
         LA    1,44(1)                  PLUS 44 TO DEBAD IN DCB         07520000
         L     1,0(1)                   LOAD DEB ADDR                   07540000
         LA    2,IEHMVV00+150           LOAD WORK AREA ADDR 8 BYTES     07560000
         L     15,16                    LOAD CVT PTR                    07580000
         L     15,28(0,15)              ADDR OF TTX TO MBBCCHHR RTN     07600000
         LA    13,88(13)                                                07620000
         LR    5,13                                                     07640000
         BALR  14,15                                                    07660000
         LR    13,5                                                     07680000
         LA    3,88                                                     07700000
         SR    13,3                                                     07720000
         LM    14,12,12(13)                                             07740000
         MVC   WRITAREA+12(5),IEHMVV00+153                              07760000
CWRITE3  DS    0H                                                       07780000
         L     DBR1,IEHMVV40            UT1 DCB ADDR                    07800000
         L     DBR3,IEHMVV40+4          UT1 DECB ADDR                   07820000
         LA    LENGTH,83               LENGTH                      DT0I 07840018
         LA    NXRPTR,WRITAREA          REC ADDR                        07860000
         BAL   R7,WRITE3                                                07880000
WRITE7   BCTR  R6,0                     REDUCE COUNT BY ONE             07900000
         LTR   R6,R6                    IS COUNT ZERO                   07920000
         BZ    TRANS2                   LEAVE RTN IF YES                07940000
         LA    R10,78(R10)             MOVE PTR TO NXT BLOCK TO BE DT0I 07960018
         B     WRITE4                   WRITTEN                         07980000
IWRITE   TM    IEHMVV20,X'10'           DSGROUP BIT ON                  08000000
         BZ    IWRITE1                                                  08020000
         MVI   WRITAREA+17,X'00'        BLOCK                           08040000
         MVI   WRITAREA+18,X'3A'       LENGTH                    A27307 08060019
         MVI   WRITAREA+19,X'00'        BLOCK CODE ZERO                 08080000
         MVC   WRITAREA+20(44),1(R10)  MOVE INTO BLOCK DSNAME           08100000
         MVI   WRITAREA+64,X'00'        VOL ENTRY COUNT                 08120000
         MVI   WRITAREA+65,X'01'                                        08140000
         MVC   WRITAREA+66(12),53(R10) MOVE VOL ENTRY INTO BLOCK        08160000
         B     CWRITE1                                                  08180000
IWRITE1  DS    0H                                                       08200000
         MVC   WRITAREA+17(78),0(R10)  MOVE I BLOCK INOT WRITE AREADT0I 08220018
         MVC   WRITAREA(12),53(R10)    MOVE VOL ENTRY TO KEY            08240000
         B     CWRITE1                                                  08260000
EWRITE   MVC   WRITAREA(8),45(R10)      MOVE MEMBER NAME TO WRITE AREA  08280000
         MVC   WRITAREA+8(1),0(R10)     MOVE BLOCK CODE TO WRITE AREA   08300000
         XC    WRITAREA+9(9),WRITAREA+9 CLEAR 9 BYTES OF DATA REC       08320000
         BAL   R7,WRITE5                                                08340000
         CLI   0(R10),C'R'              IS THIS BLOCK A REPLACE BLOCK   08360000
         BE    IWRITE                   BRANCH YES                      08380000
         B     WRITE7                                                   08400000
OPENUT1  EQU   *                                                        08420000
         L     1,IEHMVV40               ADDR OF UT1 DCB                 08440000
         MVI   18(1),X'7F'              SET MAX TRACK BALANCE           08460000
         MVI   19(1),X'FF'                                              08480000
         B     WRITE1                                                   08500000
OPENUT2  EQU   *                                                        08520000
         L     DBR1,IEHMVV41                                            08540000
         OI    LOOKFOR+1,X'08'          TURN ON WRITE OUT EXC SW        08560000
         B     WRITE6                                                   08580000
WRITE5   TM    LOOKFOR+1,X'08'          IS EXC WRITE OUT SW ON          08600000
         BZ    OPENUT2                                                  08620000
WRITE6   L     DBR3,IEHMVV41+4          UT2 DECB ADDR                   08640000
         L     DBR1,IEHMVV41            UT2 DCB ADDR                    08660000
         LA    LENGTH,10                LENGTH                          08680000
         LA    NXRPTR,WRITAREA                                          08700000
         WRITE (DBR3),SF,(DBR1),(NXRPTR),(LENGTH),MF=E                  08720000
         CHECK (DBR3)                                                   08740000
         BR    R7                                                       08760000
WRITE3   WRITE (DBR3),SF,(DBR1),(NXRPTR),(LENGTH),MF=E                  08780000
         CHECK (DBR3)                                                   08800000
         TM    LOOKFOR+1,X'10'          FIRST REC WRITTEN SW            08820000
         BO    0(R7)                                                    08840000
         NOTE  (DBR1)                                                   08860000
         ST    1,NOTEAREA               SAVE TTR IN AREA                08880000
         OI    LOOKFOR+1,X'10'         TURN ON FIRST REC WRITTEN SW     08900000
         BR    R7                                                       08920000
*********************************************************************** 08930002
*                                                                     * 08940000
*                                                                     * 08960000
*              THIS ROUTINE IS USED TO FIND  FROM VOLUME INFORMATION  * 08980000
*              THAT IS LOCATED IN THE CATALOG WHEN FROM VOLUME        * 09000000
*              INFORMATION IS NOT GIVEN WITH THE  REQUEST             * 09020000
*        LINES 091600-105265 WERE REACTIVATED                  @Z40CSJH 09040004
*        FOR MVS EXTENDED CVOL SUPPORT.                        @Z40CSJH 09090004
*                                                                     * 09140000
*********************************************************************** 09150002
FINDFROM DS    0H                                                       09160000
         TM    LOOKFOR+1,X'80'          IER SW ON                       09210004
         BO    CHECK2                                                   09260004
         TM    IEHMVV20+1,X'40'         IS CVOL BIT ON                  09310004
         BO    MOUNTVOL                                                 09360004
         TM    IEHMVV20,X'10'         DSGROUP SPECIFIED        @Z40CSJH 09370004
         BO    CHKNAME                YES-CHECK FOR NAME       @Z40CSJH 09380004
         TM    IEHMVV20,X'20'         DSNAME SPECIFIED         @Z40CSJH 09390004
         BO    LOCATE1B               YES-LOCATE DATA SET      @Z40CSJH 09400004
         TM    IEHMVV20,X'08'         PDS SPECIFIED            @Z40CSJH 09402004
         BO    LOCATE1B               YES-LOCATE DATA SET      @Z40CSJH 09404004
         B     FINDRES                GET SYSRES VOLID         @Z40CSJH 09406004
CHKNAME  TM    IEHMVV20+5,X'20'       WAS NAME SPECIFIED       @Z40CSJH 09408004
         BO    LOCATE1B               YES-DO LOCATE            @Z40CSJH 09408404
         B     FINDRES                                                  09410004
CHECK2   L     R1,IEHMVV26                                              09460004
         TM    IEHMVV74+14,X'20'     TEST IER CHEDK BIT FOR CVOL A27307 09510004
         BO    MOUNTVOL                                                 09560004
         B     LOCATE1B                IF OFF GO TO FIND RES   @Z40CSJH 09610004
FINDRES  L     R2,16                   LOAD ADDR OF CVT                 09660004
         L     R2,40(R2)               LOAD ADDR OF UCB PTR TABLE       09710004
VON      SR    R3,R3                  CLEAR UCB REG            @Z40CSJH 09760004
         ICM   R3,3,0(R2)             GET UCB ADDR             @Z40CSJH 09810004
         N     R3,CLEARMSK              SAVE 16 BITS           @Z40CSJH 09830004
         TM    0(R2),X'FF'              LAST ENTRY             @Z40CSJH 09840004
         BO    ERROUT                   BR IF NO UCB FOUND     @Z40CSJH 09890004
         LTR   R3,R3                   CHECK FOR BLANK UCB ADDR         09910004
         BZ    NOTAUCB                    IF SO ---                     09960004
         TM    18(R3),X'20'            IS THIS UCB FOR D.A.             10010004
         BZ    NOTAUCB                    IF NOT ---                    10060004
         TM    3(R3),X'02'             IS THIS UCB FOR SYSRES           10110004
         BO    FIND                       IF SO ---                     10160004
NOTAUCB  LA    R2,2(R2)                LOAD ADDR OF NEXT UCB            10210004
         B     VON                                                      10260004
         DS    0F                                                       10310004
CLEARMSK DC    X'0000FFFF'             UCB MASK                @Z40CSJH 10360004
FIND     LR    R2,R3                   LOAD R2 WITH SYSRES UCB ADDR     10410004
         TM    LOOKFOR+1,X'80'     TEST IERFILL SW                      10420004
         BO    IERCVOL                                                  10430004
         L     R3,NXTPTR                LOAD WORK AREA PTR              10440004
         XC    0(12,R3),0(R3)           ZERO 12 BYTE AREA               10450004
         MVC   0(4,R3),16(R2)           MOVE TYPE INTO LIST             10452004
         MVC   4(6,R3),28(R2)           MOVE VOL ID INTO LIST           10454004
         ST    R3,IEHMVV24              STORE IN CVOL LIST PTR          10456004
         LA    R3,12(R3)                BUMP PTR                        10458004
         ST    R3,NXTPTR                SAVE PTR                        10458404
         LA    R3,1                                                     10458804
         STC   R3,IEHMVV24              PUT COUNT OF ONE ENTRY IN PTR   10459204
         C     R15,CLEARMSK            DSGRP-W/NO NAME-OR CVOL @Z40CSJH 10459304
         BNE   LOCATE1                  BR IF NOT TRUE         @Z40CSJH 10459404
         OI    IEHMVV20+1,X'40'         SET CVOL=SYSRES        @Z40CSJH 10459504
         B     TOESIA                   TO ESI EXIT            @Z40CSJH 10459604
IERCVOL  L     R3,IEHMVV26              LOAD PTR TO INC LBOCK           10459804
         LA    R3,53(R3)                BUMP PTR TO FROM VOL SLOT       10459904
         XC    0(17,R3),0(R3)          CLEAR FROM LIST AREA      A27307 10460004
         MVC   0(4,R3),16(R2)      PUT TYPE IN LIST                     10466604
         MVC   4(6,R3),28(R2)           MOVE VOL ID INTO LIST           10468604
         B     MOUNTVOL                                                 10470604
MOUNTVOL DS    0H                                                       10472604
         TM    LOOKFOR+1,X'80'          I,E,R FILL                      10473004
         BO    MNT1                                                     10473104
         L     R1,IEHMVV24              PTR TO CVOL LIST                10473204
         B     MNT2                                                     10479904
MNT1     L     R1,IEHMVV26              I,E,R BLOCK                     10481904
         LA    R1,53(R1)                                                10483904
         B     MNT2                                                     10485904
MNT2     DS    0H                                                       10486304
         LR    R3,R1                                                    10486404
         LH    R4,ST                                                    10486504
    MVC  IEHMVV00+5(3),IEHMVV50+5        SET UP INTERNAL TABLE  POINTER 10493204
    MVC  IEHMVV00+10(1),IEHMVV50+4      SET  UP INTERNAL TABLE COUNT    10495204
     MVI  IEHMVV00+11,X'01'         SET UP NUMBER OF REQUESTS           10497204
         MVC   IEHMVV00+12(17),0(R1)                             A27307 10499204
     LA   3,IEHMVV00                                                    10499604
    MVI   IEHMVV00+4,X'10'      SET UP INDICATOR BYTE                   10499704
       IEHPOST (14),T                                                   10499804
         XCTL  (5,12),EP=IEHMVXSF                                       10499904
MNT3     TM    IEHMVV00+4,X'01'         WAS VOL MOUNTED                 10516504
         BZ    ERROUT                                                   10526504
LOCATE1  MVC   IEHMVV00(4),LOCSW2       FIRST WORD LOCATE LIST @Z40CSJH 10533604
LOCATE1A TM    LOOKFOR+1,X'80'          IS I,E,R. SW ON        @Z40CSJH 10550204
         BO    LOCATE2                  BRANCH YES                      10566804
         MVC   IEHMVV00+4(4),IEHMVV21   SECOND WORD OF LIST FOR LOCATE  10583404
         L     R1,IEHMVV24              CVOL LIST PTR                   10593404
         LA    R1,4(R1)                                                 10595404
         ST    R1,IEHMVV00+8            THIRD WORD OF LIST FOR LOCATE   10597404
LOCATE3  LA    R1,IEHMVV00+16                                           10600000
         ST    R1,IEHMVV00+12           FORTH WORD FOR LOCATE           10620000
         B     LOCATE4                                                  10640000
LOCATE2  L     R1,IEHMVV26              LOAD ADDR OF I E R BLOCK        10660000
         LA    R1,1(R1)                                                 10680000
         ST    R1,IEHMVV00+4            SECOND WORD OF LOCATE LIST      10700000
         LA    R1,56(R1)                                       @Z40CSJH 10750004
         ST    R1,IEHMVV00+8            THIRD WORD-LOCATE      @Z40CSJH 10752004
         B     LOCATE3                                                  10760000
LOCATE1B MVC   IEHMVV00(4),LOCSW        SET OPTION BYTES       @Z40CSJH 10770004
         B     LOCATE1A                 CONT. CAMLST SETUP     @Z40CSJH 10772004
LOCATE4 LOCATE IEHMVV00                                                 10780000
*********************************************************************** 10790002
* IF UNABLE TO LOCATE THE DATA SET, PRINT IEH471I AND QUIT            * 10792002
*********************************************************************** 10794002
         LA    15,0(15)                                                 10800000
         LTR   15,15                                                    10820000
         BNE   ERROUT                    BRANCH IF NOT SUCCESS @Z40CSJH 10840004
         TM    LOOKFOR+1,X'80'          I,E,R SW ON                     10860000
         BO    SETLIST1                                                 10880000
         LH    R3,IEHMVV00+16          LOAD COUNT OF VOL ENTRIES        10900000
         BCT   R3,*+10                 1 VOL, THEN SAVE DSCBTTR  S21042 10910021
         MVC   IEHMVV82(3),IEHMVV00+268 SAVE DSCBTTR             S21042 10912021
         LA    R3,1(R3)                 RESET R3                 S21042 10914021
         L     R1,NXTPTR               LOAD PERM WORK AREA PTR          10960000
         LA    R1,2(R1)                SKIP TWO BYTES                   10980000
         ST    R1,IEHMVV22              STORE PTR TO FROM LIST   A50958 10990022
         ST    R1,IEHMVV22+4            PTR TO ACTIVE FROM LIST  A50958 11000022
         LA    R4,IEHMVV00+18           FIRST CATALOG ENTRY      A50958 11030022
MOVELIST MVC   0(12,R1),0(R4)           MOVE ENTRY TO FROM LIST  A50958 11032022
         XC    12(5,R1),12(R1)          CLEAR UNIT FIELD         A50958 11034022
         LA    R1,17(R1)                NEXT FROM VOL LIST ENTRY A50958 11036022
         LA    R4,12(R4)                NEXT CATALOG ENTRY       A50958 11038022
         BCT   R3,MOVELIST              MOVE NEXT ENTRY IF ONE   A50958 11038422
         LA    R1,3(R1)                 ADD 3 TO PTR TO          A50958 11038522
         SRL   R1,2                     SET PTR TO NEXT          A50958 11038822
         SLL   R1,2                     FULLWORD BOUNDARY        A50958 11039222
         ST    R1,NXTPTR                STORE PERM WORK AREA PTR A50958 11040022
         TM    LOOKFOR+1,X'80'         IER FILL                         11100000
         BO    LOCATE5                                                  11120000
         IC    R1,IEHMVV00+17          INSERT COUNT OF ENTRIESIN LIST   11180000
         STC   R1,IEHMVV22             STORE IN HIGH ORDER BYTE OF PTR  11200000
LOCATE5  EQU   *                                                        11220000
         B     TRANS3                                                   11240000
SETLIST1 L     R1,IEHMVV26              LOAD ADDR OF IER BLOCK          11260000
         MVC   53(12,R1),IEHMVV00+18    MOVE VOL LIST INTO IER BLOCK    11280000
         B     WRITEUT1                                                 11300000
ERROUT   EQU   *                                                        11320000
         LA    R3,12                   LOAD MSG NO IN RS                11340000
LABEL    LA    R2,16                   RETURN TO ESK             A28295 11343019
         TM    IEHMVV90,X'20'          IS THIS END OF INPUT      A15815 11352019
         BO    OUT                     YES-- GO TO OUT           A15815 11358019
         LA    R2,12                                             A15815 11364019
OUT      MVI   ESTENTRY,X'00'          EST ENTRY TO INITIALIZE RTN15815 11370019
         MVI   ESTENTRY,X'00'          EST ENTRY TO INITIALIZE RTN      11380000
         DELETE EP=DEVNAMET            DELETE DEVICE NAME TABLE    I276 11386019
         XC    IEHMVV74+16(4),IEHMVV74+16        CLEAR ADDRESS     I276 11392019
       IEHPOST (14),T                                                   11400000
         XCTL  EP=IEHMVESA                                              11420000
*                                                                       11460000
*                                                                       11480000
*                                                                       11500000
*              THIS ROUTINE IS ENTERED IMMEDIATLY PRIOR TO TRANSFERING  11520000
*              CONTROL TO THE REQUEST HANDLING MODULES                  11540000
*                                                                       11560000
*              IT WILL ANALIZE THE INFORMATION PASSED BY THE REQUEST    11580000
*              TO INSURE THAT AT LEAST A MINIMUM OF INFORMATION         11600000
*              IS PRESENT                                               11620000
*                                                                       11640000
*                                                                     * 11660000
*              IT WILL WRITE DUMMY OR FILE TEXMINATOR RECORDS ON      * 11680000
*              UT1 AND UT2 IF EITHER FILE HAS BEEN WRITTEN ON         * 11700000
*              FOR THIS REQUEST     EXCEPT FOR A DSGROUP REQUEST      * 11720000
*                                                                     * 11740000
*                                                                     * 11760000
*                                                                     * 11780000
SCAEXIT1 TM    IEHMVV20,X'3E'           IS SUB OPERATION BIT ON         11800000
         BNE   *+12                                                     11820000
         LA    R3,11                                                    11840000
         B     ERROUT+4                                                 11860000
         TM    IEHMVV20,X'10'          IS DS GROUP BIT ON               11880000
         BO    EX3                                                      11900000
         TM    LOOKFOR+1,X'10'          IS UNC WRITE OUT SW ON          11920000
         BZ    SCANEX1                                                  11940000
         MVC   IEHMVV26+1(3),NOTEAREA   MOVE TTR TO COMM AREA           11960000
         MVI   IEHMVV26,X'FF'                                           11980000
SCANEX1  DS    0H                                                       12000000
         MVI   WRITAREA,C' '            MOVE BLANK TO FIRST BYTE OF KEY 12020000
         TM    LOOKFOR+1,X'10'          IS INC WRITE OUT SW ON          12040000
         BO    DUMUT1                                                   12060000
EX2      TM    LOOKFOR+1,X'08'          IS EXC WRITE OUT SW ON          12080000
         BO    DUMUT2                   BRANCH YES                      12100000
         B     EX3                                                      12120000
DWRITE   WRITE (DBR3),SF,(DBR1),WRITAREA,82,MF=E                        12140000
         CHECK (DBR3)                                                   12160000
         BR    DBCOMPR                                                  12180000
DUMUT1   L     DBR3,IEHMVV40+4          LOAD DECB ADDR                  12200000
         L     DBR1,IEHMVV40            LOAD DCB ADDR                   12220000
         BAL   DBCOMPR,DWRITE                                           12240000
         MVC   IEHMVV39(5),8(DBR1)      MOVE CCHHR TO COMM AREA         12260000
         B     EX2                                                      12280000
DUMUT2   L     DBR3,IEHMVV41+4          LOAD DECB ADDR                  12300000
         L     DBR1,IEHMVV41            LOAD DCB ADDR                   12320000
         BAL   DBCOMPR,DWRITE                                           12340000
         MVC   IEHMVV41+8(5),8(DBR1)    MOVE CCHHR TO COMMAREA          12360000
         B     EX3                                                      12380000
EX3      DS    0H                                                       12400000
         TM    IEHMVV20+1,X'80'         IS TO VOL BIT ON                12420000
         LA    R3,11                                                    12440000
         BZ    ERROUT+4                 BRANCH IF NO                    12460000
         MVI   LOOKFOR,X'00'                                            12480000
         TM    LOOKFOR+1,X'10'         IS INC WRITE OUT SW ON           12500000
         BZ    SET1                     BRANCH IF NO                    12520000
         OI    XSWITCHS+1,X'08'                                         12540000
SET1     TM    LOOKFOR+1,X'08'          IS EXC WRITE OUT SW ON          12560000
         BZ    SET2                     BRANCH IF NO                    12580000
         OI    XSWITCHS+1,X'04'         TURN ON ANY EXC REP SW          12600000
SET2     TM    LOOKFOR+1,X'01'          SEL INPUT BIT ON                12620000
         BZ    SET3                     BRANCH NO                       12640000
         OI    XSWITCHS+1,X'02'         TURN ON ANY SEL SW              12660000
SET3     DS    0H                                                       12680000
         MVC   IEHMVV20+2(1),XSWITCHS+1                                 12700000
         L     NXRPTR,NXTPTR            ALIGN PERM WORK AREA PTR        12720000
         LA    NXRPTR,4(NXRPTR)        BUMP BY 4                        12740000
         SRL   NXRPTR,2                                                 12760000
         SLL   NXRPTR,2                                                 12780000
         ST    NXRPTR,IEHMVV10                                          12800000
         TM    IEHMVV20+3,X'40'        TODD SW ON              @ZA07411 12820008
         BNO   OK                      NO STOP CHECKING        @ZA07411 12822008
         TM    IEHMVV20,X'02'          VOLUME SW ON            @ZA07411 12824008
         BNO   OK                      NO STOP CHECKING        @ZA07411 12826008
         L     R9,IEHMVV23             CHECK IF TO DEVICE      @ZA07411 12828008
         TM    2(R9),X'80'             IS TAPE OR NOT          @ZA07411 12830008
         BO    OK                      IF TAPE OK              @ZA07411 12832008
         NI    IEHMVV20+3,X'BF'        IF NOT RESET TODD SW    @ZA07411 12834008
OK       TM    IEHMVV20,X'10'          IS DSGROUP SW ON        @ZA07411 12836008
         BO    ESIEXIT                                                  12840000
         B     ESZEXIT                                                  12860000
ESSEXIT  EQU   *                                                        12880000
       IEHPOST (14),T                                                   12900000
         XCTL  (4,12),EP=IEHMVESS                                       12920000
ESZEXIT  EQU   *                                                        12940000
         TM    IEHMVV20+3,X'04'        RENAME SWITCH ON?         A28295 12941019
         BZ    TOESZ                   NO - BRANCH               A28295 12942019
         BAL   R9,RENAMCHK             CHECK FOR VALID RENAME    A28295 12943019
TOESZ    DELETE  EP=DEVNAMET           DELETE DEVICE NAME TABLE  A28295 12944019
         XC    IEHMVV74+16(4),IEHMVV74+16        CLEAR ADDRESS     I276 12952019
       IEHPOST (14),T                                                   12960000
         XCTL  (4,12),EP=IEHMVESZ                                       12980000
ESJEXIT  EQU   *                                                        13000000
       IEHPOST (14),T                                                   13020000
    XCTL   (4,12),EP=IEHMVESJ                                           13040000
ESIEXIT  EQU   *                                                        13060000
         TM    IEHMVV20+3,X'04'        RENAME SWITCH ON?         A28295 13061019
         BZ    TOESI                   NO - BRANCH               A28295 13062019
         BAL   R9,RENAMCHK             CHECK FOR VALID RENAME    A28295 13063019
TOESI    DELETE  EP=DEVNAMET           DELETE DEVICE NAME TABLE  A28295 13064019
         XC    IEHMVV74+16(4),IEHMVV74+16        CLEAR ADDRESS     I276 13072019
         XC    IEHMVV27+D12(L8),IEHMVV27+D12  CLEAR AREA         Y02918 13074002
         TM    IEHMVV20+5,X'20'       WAS NAME SPECIFIED       @Z40CSJH 13076004
         BO    TOESH                  YES-TO VESH              @Z40CSJH 13078004
         TM    IEHMVV20+1,X'40'         WAS CVOL SPECIFIED     @Z40CSJH 13078404
         BO    TOESIA                   BR IF YES              @Z40CSJH 13078804
         L     R15,CLEARMSK             SET R15 SWITCH         @Z40CSJH 13079204
         B     FINDRES                  GET SYSRES VOLID       @Z40CSJH 13079604
TOESIA IEHPOST (14),T                                          @Z40CSJH 13080004
         XCTL  (4,12),EP=IEHMVESI                                Y02918 13081004
TOESH    EQU   *                      IEHMVESH EXIT            @Z40CSJH 13091004
         TM    IEHMVV20+1,X'40'         IS CVOL BIT ON         @Z40CSJH 13093004
         BO    TOESIA                   YES-TO VESI            @Z40CSJH 13095004
         IEHPOST (14),T                                        @Z40CSJH 13101004
         XCTL  (4,12),EP=IEHMVESH     GENERIC LOCATE           @Z40CSJH 13111004
*********************************************************************** 13131022
*                                                                     * 13133022
*                                                                     * 13135022
*  THE FOLLOWING ROUTINE CHECKS THE VALIDITY OF THE             A48781* 13137022
*  DATA SET NAME, AS SPECIFIED IN THE RENAME-PARAMETER.         A48781* 13137422
*  EACH NAME OR SUBNAME (FOR CATALOGUED DATA SETS CORRESPONDING A48781* 13137522
*  TO THE LEVELS) MAY CONSIST ONLY OF ALPHAMERIC OR NATIONAL OR A48781* 13137622
*  HYPHEN OR +0 (I.E. A 12-0 MULTIPUNCH) CHARACTERS,WHILE THE   A48781* 13143222
*  FIRST ONE IN EACH NAME OR SUBNAME MUST BE ALPHABETIC OR      A48781* 13145222
*  NATIONAL. FURTHERMORE EACH NAME MUST CONTAIN 1 TO 8 CHARAC-  A48781* 13147222
*  TERS.                                                        A48781* 13147622
*                                                                     * 13148022
*                                                                     * 13148422
*********************************************************************** 13148522
RENAMCHK L     DBR1,IEHMVV21        FIND FROM- AND TO-DATA SET-  A48781 13150522
         L     DBNXRPTR,IEHMVV21+4  NAME-ADDRESSES               A48781 13152522
         CLC   0(44,DBNXRPTR),0(DBR1) COMPARE FROM-WITH NEW-NAME A48781 13154522
         BNE   TESTNAME             IF UNEQUAL,CHECK VALIDITY    A48781 13154622
         NI    IEHMVV20+3,X'FB'     OTHERWISE,TURN OFF RENAMEBIT A48781 13154722
         B     0(R9)                AND CONTINUE PROCESSING      A48781 13154822
TESTNAME LA    DBCOMPR,44(DBNXRPTR) INITIALISATION OF END OF NEW A48781 13155822
         BCTR  DBNXRPTR,0           DATA SET NAME                A48781 13158022
CHKCHAR1 SR    DBR1,DBR1            INITIALISATION OF COUNTER    A48781 13159022
*                                   FOR CHARS IN EACH NAME       A48781 13160022
         LA    DBNXRPTR,1(DBNXRPTR) POINTER TO NEXT CHAR IN DSN. A48781 13160922
         CR    DBNXRPTR,DBCOMPR     CHECK FOR END OF DSNAME AFTERA48781 13161322
         BE    INVALID              HAVING FOUND A PERIOD        A48781 13167722
TEST     CLI   0(DBNXRPTR),X'5B'    CHECK FOR DOLLAR-SIGN        A48781 13169722
         BE    VALID                DOLLAR-SIGN ALLOWED          A48781 13171722
         CLI   0(DBNXRPTR),X'7B'    CHECK FOR NUMBER-SIGN        A48781 13173722
         BE    VALID                NUMBER-SIGN ALLOWED          A48781 13174122
         CLI   0(DBNXRPTR),X'7C'    CHECK FOR @-SIGN             A48781 13174222
         BE    VALID                @-SIGN ALLOWED               A48781 13174322
         CLI   0(DBNXRPTR),X'C1'    CHECK FOR                    A48781 13176222
         BL    INVALID                    ALPHABETIC CHARACTERS  A48781 13178222
         CLI   0(DBNXRPTR),X'CA'    ALPHABETIC CHARACTERS A      A48781 13178622
         BL    VALID                      THROUGH I ALLOWED      A48781 13179022
         CLI   0(DBNXRPTR),X'D1'    CHECK FOR                    A48781 13179422
         BL    INVALID                    ALPHABETIC CHARACTERS  A48781 13179822
         CLI   0(DBNXRPTR),X'DA'    ALPHABETIC CHARACTERS J      A48781 13179922
         BL    VALID                      THROUGH R ALLOWED      A48781 13185622
         CLI   0(DBNXRPTR),X'E2'    CHECK FOR                    A48781 13187622
         BL    INVALID                    ALPHABETIC CHARACTERS  A48781 13189622
         CLI   0(DBNXRPTR),X'EA'    ALPHABETIC CHARACTERS S      A48781 13190022
         BL    VALID                      THROUGH Z ALLOWED      A48781 13190422
INVALID  LA    DBR1,18              INDIC. MSG. IEH390I-INVALID  A48781 13190822
         B     LABEL                DSNAME IN RENAME-PARAMETER   A48781 13191222
VALID    LA    DBR1,1(DBR1)         UPDATE CTR FOR NMBR OF       A48781 13191322
         CH    DBR1,DBEIGHT         VALID CHARACTERS IN DSNAME   A48781 13191422
         BH    INVALID              ERROR IF MORE THAN 8 CHAR.   A48781 13192122
         LA    DBNXRPTR,1(DBNXRPTR) POINTER TO NEXT CHAR. IN DSN.A48781 13192522
         CR    DBNXRPTR,DBCOMPR     CHECK FOR END OF VALID       A48781 13192922
         BE    0(R9)                DSNAME WITH 44 CHARACTERS    A48781 13193322
         CLI   0(DBNXRPTR),X'40'    CHECK FOR END OF VALID       A48781 13193422
         BE    0(R9)                DSNAME WITH LESS THAN 44CHAR A48781 13193522
         CLI   0(DBNXRPTR),X'4B'    CHECK FOR PERIOD             A48781 13195122
         BE    CHKCHAR1             IF PERIOD,RESET CTR ANDBRANCHA48781 13197122
         CLI   0(DBNXRPTR),X'60'    CHECK FOR HYPHEN             A48781 13197522
         BE    VALID                HYPHEN ALLOWED AS NOT-FIRST  A48781 13197922
*                                                  CHARACTER     A48781 13198322
         CLI   0(DBNXRPTR),X'C0'    CHECK FOR 12-0 MULTIPUNCH    A48781 13203522
         BE    VALID                12-0 MULTIPUNCH ALLOWED      A48781 13205522
*                                       AS NON-FIRST CHARACTER   A48781 13207522
         CLI   0(DBNXRPTR),X'F0'    CHECK FOR NUMERIC CHARACTERS A48781 13207922
         BL    TEST                 NUMERIC CHARACTERS           A48781 13208322
         CLI   0(DBNXRPTR),X'FA'    ALLOWED AS                   A48781 13208722
         BL    VALID                NON-FIRST CHARACTERS IN NAME A48781 13210122
         B     INVALID              TEST FOR ALPHABETIC OR       A48781 13212122
*                                       NATIONAL CHARACTERS      A48781 13212522
        IEHMVV                                                   A48781 13212922
IEHMVSST CSECT                                                   A48781 13214322
WRITAREA EQU   IEHMVV00                                          A48781 13219222
FAADD    EQU   IEHMVV27                                          A48781 13224422
SARG     EQU   IEHMVV27+12                                       A48781 13229622
NOTEAREA EQU   IEHMVV27+20                                       A48781 13234822
LOOKFOR  EQU   IEHMVV27+24                                              13240000
ESSENTRY EQU   IEHMVV27+4                                               13260000
ESTENTRY EQU   IEHMVV27+5                                               13280000
XSWITCHS EQU   IEHMVV27+28                                              13300000
NXTPTR   EQU   IEHMVV10                                                 13320000
MASK1    DC    XL6'000000300400'                                 A37919 13340021
         DS    0H                                                       13360020
DBCTONE  DC    XL4'01000000'                                            13380000
FUDJFACT DC    HL2'114'                                                 13400000
ST       DC    C'ST'                                                    13420000
         DS    0F                                                       13440000
DBEIGHT  DC    XL2'08'                                           A33297 13450020
LOCSW2   DC    XL4'C0000000'            LOC OPTIONS            @Z40CSJH 13452004
LOCSW    CAMLST  NAME,LOCSW,,LOCSW   LOCATE BY NAME WITHOUT CVOLYL026VC 13460002
PATCH    DS    10F                      PATCH AREA             @Z40CSJH 13470004
         END                                                            13480000
