 TITLE 'IEHMVETG-HANDLES INCLUDE, REPLACE AND SELECT REQS FOR A PDS'    00010017
*        IEHMVETG                                                       00020000
*                                                                       00040000
* FUNCTION                                                              00060000
*                                                                       00080000
*THIS IS THE MODULE THAT WILL HANDLE ALL INCLUDE AND REPLACE REQUESTS   00100000
*FOR A  MOVE OR COPY PDS.       THE INCLUDE REPLACE LIST IS PUT ON A    00120000
*WORK FILE IN ANY SEQUENCE,JUST THE WAY THEY ARE RECEIVED FROM THE USER 00140000
*THE MODULE WILL FIRST CHECK TO SEE IF THERE ARE ANY INC/REP FROM THE   00160000
*ORIGINAL VOLUME THAT CONTAINED THE PDS TO BE COPIED OR MOVED.IF NONE   00180000
*EXIST, THEN THE PROGRAM WILL READ THE FIRST INC/REP REQUEST FROM THE   00200000
*WORKFILE,AND HAVE THAT VOLUME MOUNTED.IT WILL THEN CHECK THE DSCB  TO  00220000
*MAKE SURE THE INCLUDE IS COMPATABLE WITH THE DATA SET ALREADY MOVED.   00240000
*THE FOLLOWING ARE CHECKED FOR COMPATABILITY                            00260000
*                                                                       00280000
* 1)TEST IS MADE TO SEE IF DATA SET IS A PDS                            00300000
* 2)TEST IS MADE TO INSURE THAT RECORD FORMATS ARE THE SAME             00320000
* 3)TEST IF BLKSIZE OF INCLUDE DS FITS ON THE ORIGINAL FROM DS          00340000
* 4)TEST TO SEE IF KEY LENGTHS ARE EQUAL                                00360000
*                                                                       00380000
*IF ALL THESE TESTS ARE MET, THEN WE CHECK TO SEE IF THE APPROPRIATE    00400000
*VOLUME IS MOUNTED. IF NOT, THEN WE GO TO A VOLUME MOUNT ROUTINE  WITH  00420000
*REG1 POINTING TO VOLUME INFO. WHICH THEN HAS THE CORRECT VOLUME MOUNTD 00440000
*ONCE WE'VE DETERMINED THAT THE CORRECT VOLUME IS MOUNTED,WE ARE READY  00460000
*TO OPEN THIS DATA SET. WE USE THE OPENJ MACRO,FOR WHICH WE HAVE TO     00480000
*BUILD A MODEL JFCB AND SET IT UP WITH DSNAME, MEMBER NAME, VOLUME      00500000
*INFO IN IT. THERE IS ALSO AN EXIT LIST POINTER IN MY DCB TO A LIST FOR 00520000
*OPENJ. THIS OPENS OUR DATA SET AND LET'S US  GET THE CORRECT DIRECTRY  00540000
*ENTRY BY USING BLDL. ONCE WE HAVE THE DIRECTORY ENTRY WE WRITE IT OUT  00560000
*ON A WORK FILE. THE FORMAT OF THIS WORKFILE IS:                        00580000
*                                                                       00600000
* 4 BYTE KEY OF  ATTR                                                   00620000
*       A=00 IF THE NAME IS A TRUE MEMBER NAME                          00640000
*       A=80 IF THE NAME IS AN ALIAS                                    00660000
*     TTR=IS THE TTR TAKEN FOLLOWING THE MEMBER NAME IN THE DIR ENTRY   00680000
*FOLLOWED BY A VARIABLE SIZE DATA RECORD MAX SIZE OF 87 BYTES           00700000
*THE DATA PORTION IS BROKEN DOWN INTO THE FOLLOWING PARTS               00720000
*       1)FIRST 5 BYTES IS THE CCHHR OF THE RECORD ITSELF               00740000
*       2)THE NEXT (X) BYTES IS THE DIRECTORY ENTRY                     00760000
*       3)FOLLOWING THE DIR ENTRY WE HAVE AN 8 BYTE FIELD WHICH CON     00780000
*         TAINS A MEMBER NAME TO BE USED TO STOW WITH. THIS LAST FIELD  00800000
*         IS FOR THE RENAME OPTION.                                     00820000
*                                                                       00840000
*ONCE WE HAVE PROCESSED ALL THE ENTRIES THAT PERTAIN TO A CERTAIN DATA  00860000
*SET ON A CERTAIN VOLUME THEN WE TCLOSE BOTH THE INPUT AND OUTPUT WORK  00880000
*FILES AND TRANSFER CONTROL TO THE MOVE/COPY PDS MODULE.                00900000
*EVERYTIME AN ENTRY IS PROCESSED AND PUT ON THE OUTPUT WORKFILE THAT    00920000
*ENTRY'S KEY IS ZEROED OUT ON THE INPUT WORKFILE WHICH PREVENTS US FROM 00940000
*PROCESSING IT AGAIN.                                                   00960000
*ONCE EVERYTHING HAS BEEN PROCESSED THE INC/REP BIT ON IEHMVV IS TURNED 00980000
*OFF WHICH TELLS THE MOVE/COPY PDS MODULE NOT TO TRANSFER CONTROL TO    01000000
*THE INC/REP MODULE                                                     01020000
*                                                                       01040000
*                                                                       01060000
* INPUT        A WORKFILE AS DESCRIBED IN THE MODULE FUNCTION.          01080000
*                                                                       01100000
* OUTPUT       A WORKFILE OF 4 BYTES OF KEY AND A MAXIMUM DATA PORTION  01120000
*              OF 87 BYTES. FIRST FIVE BYTES ARE CCHHR FOLLOWED BY A    01140000
*              DIRECTORY ENTRY WHICH CAN BE FOLLOWED BY A RENAME FIELD. 01160000
*                                                                       01180000
* EXTERNAL RTN VOLUME MOUNT ROUTINE                                     01200000
*              WRAP UP MODULE (IEHMVESN)                                01220000
*                                                                       01240000
* EXITS        PRINT MSG MODULE(IEHMVESU) VIA LINK                      01260000
*                                                                       01280000
* WORK AREA    WORK AREA FOR 'OBTAIN' MACRO                             01300000
*              WORK AREA FOR I/O BUFFERS                                01320000
*                                                                     * 01340000
* ATTRIBUTES NON-REEENTRANT                                             01350004
*                                                                       01360004
IEHMVSTG CSECT                                                          01370004
*                                                                       01380004
*A034264-034268                                                @ZA11945 01382099
*C035000                                                       @ZA11945 01384099
*A034220-034360                                                @ZA07033 01390004
*A024210-024260                                                @ZA01247 01440802
*C037660,037920,038060,038840,038880,039100,039320,039400      @ZA01247 01440902
*C039480,039620,039680,040040,040080,040120,040490,040550      @ZA01247 01441002
*C040600,041120,041300,041320,142745,142763                    @ZA01247 01441102
*D037740-037796                                                @ZA01247 01441202
*A37730-37790                                                   YM00561 01441302
*D24210-24260                                                   YM00561 01441402
*C37660,37920,38060,38840,38880,39100,39320,39400,39480,39620   YM00561 01442000
*C39680,40040,40080,40120,40490,40550,40600,41120,41300,41320   YM00561 01442500
*C142745,142763                                                 YM00561 01443000
*C040900,041460,046400,107200                                    YM5087 01443500
*A109700                                                         YM5086 01444000
*A017880-017988,024210-024260,037600-041890,                    YA01217 01444516
*A107220-107420,110400,111600,113200,114600,115800,117000,118200YA01217 01445016
*A119400,121200-121560,122400,123100,123260-123320,124400,124700YA01217 01445516
*A127500,142700-142790,147620-147720,157766-157790              YA01217 01446016
*D017840,017880-017940,037600-042000,107220-107600              YA01217 01446516
*D108200-108400,110000,110400-110600,111000,111600-111800,112200YA01217 01447016
*D113200-113400,113800,114600-114800,115200-116000,116400       YA01217 01447516
*D117000-117200,117600,118200-118400,118800,119400-119600,120000YA01217 01448016
*D121200-121400,121800,122400-122600,124400,125600,127800,142400YA01217 01448516
*D142700                                                        YA01217 01449016
*C126000,126400,048400                                          YA01217 01449516
*D049060                                                          M0121 01450416
*D043000,043200                                                   M2686 01450516
*C043400                                                          M2686 01451016
*A049000                                                          M2686 01451516
*A107264-107268                                                  A45202 01452022
*C026300                                                         A38742 01460021
*030000-030800,055400-057000,059800,070800-078390,083060-083120, S20201 01460120
*135600                                                                 01460220
* ALL CODE FLAGGED S20201 WAS ADDED OR CHANGED FOR RLSE 20.2     S20201 01460320
*   RPS SUPPORT                                                  S20201 01460420
* 023800,024400                                                  A27790 01460520
* 107226-107232                                                  A25562 01461019
REG0     EQU   0                                                        01480000
REG1     EQU   1                                                        01500000
REG2     EQU   2                                                        01520000
REG3     EQU   3                                                        01540000
REG4     EQU   4                                                        01560000
REG5     EQU   5                                                        01580000
REG6     EQU   6                                                        01600000
REG7     EQU   7                                                        01620000
REG8     EQU   8                                                        01640000
REG9     EQU   9                                                        01660000
BASE10   EQU   10                                                       01680000
REG11    EQU   11                                                       01700000
REG12    EQU   12                                                       01720000
REG13    EQU   13                                                       01740000
REG14    EQU   14                                                       01760000
REG15    EQU   15                                                       01780000
CCWS     EQU   216                     BYTES IN CCW CHAIN        S20201 01782020
RPS      EQU   4                       RECORD READY FEATURE      S20201 01786020
PO       EQU   X'02'               DSORG PARTITIONED            YA01217 01788016
F        EQU   X'80'               RECFM FIXED                  YA01217 01788616
V        EQU   X'40'                     VARIABLE               YA01217 01789216
U        EQU   X'C0'                     UNDEFINED              YA01217 01790016
T        EQU   X'20'                     TRACK OVERFLOW         YA01217 01791016
B        EQU   X'10'                     BLOCKED                YA01217 01792016
S        EQU   X'08'                     STANDARD / SPANNED     YA01217 01793016
KEYLEN0  EQU   X'01'                     DCB KEYLEN ZERO        YA01217 01794016
TFEATURE EQU   X'40'               UCBTYP TRACK OVERFLOW FEATUREYA01217 01795016
ALL      EQU   X'FF'                                            YA01217 01796016
ZERO     EQU   X'00'                                            YA01217 01797016
BLANK    EQU   C' '                                             YA01217 01798016
         SPACE 2                                                YA01217 01799016
IEHMVETG SAVE  (14,12),T,ETG-SEPT-8/65                                  01800000
         BALR  BASE10,0                                                 01820000
         USING *,BASE10                                                 01840000
         ENTRY IEHMVETG                 THIS IS MY ENTRY POINT          01860000
         USING IEHMVV,REG12             USE REG12 TO GET TO COMTABLE    01880000
         USING CORE,REG11                                               01900000
         USING GETCORE,REG9     USING AS A BASE REGISTER                01920000
         USING MESSAGES,REG7        BASE FOR MSG CSECT                  01940000
         TM    IEHMVV20+4,X'10'         IS THIS RET FROM VOL MNT        01960000
         BZ    SAVE                           IF NOT ---                01980000
         NI    IEHMVV20+4,X'EF'            TURN OFF VOL RET BIT         02000000
         B     VOLRET                                                   02020000
SAVE EQU *                                                              02040000
         IEHPRE ,FT                                                     02060000
*                                                                       02080000
* THIS POINT IS DONE ONCE FOR EVERY TIME THE PROGTAM IS ENTERED         02100000
*                                                                       02120000
         NI    IEHMVV20+2,X'7F'        TURN OFF ALAIS SWITCH       9312 02140000
         L     REG1,IEHMVV42    ADDRESS OF SYSUT3 DCB                   02160000
         LA    REG0,POINT   ADDRESS OF TTR0=0010                        02180000
         POINT (1),(0)   POINT TO BEG OF SYSUT3                         02200000
         L     REG2,IEHMVV42        ADDR OF SYSUT3 DCB                  02220000
         MVI   18(REG2),X'7F'       SET TRK BAL TO MAX                  02240000
         MVI   19(REG2),X'FF'       SET TRK BAL TO MAX                  02260000
*NOW WE SET UP THE PROGRAM BASE,DO,SOME GETMAINS AND DO SOME GENERAL    02280000
*HOUSEKEEPING AND CLOSE THE OLD INPUT DCB                               02300000
*                                                                       02320000
REPEAT   L     REG2,IEHMVV30   ADDRESS OF INPUT DCB                     02340000
         LA    REG2,0(0,REG2)        CLEAR HIGH ORDER BYTE              02360000
         CLOSE ((2),REREAD)             CLOSE THE OLD INPUT DCB  A27790 02380019
         L     REG2,IEHMVV31       ADDRESS OF OUTPUT DCB                02400000
* THIS RTN SAVES THE VOL SER NBR AND FILE SEQ NBR FOR IEHMVESN   A43752 02401021
         TM    IEHMVV82+24,X'80'       VOL SER NBR ALREADY SAVED A43752 02401221
         BO    SKIPSAVE                YES SKIP THE SAVE RTN     A43752 02401421
         TM    48(REG2),X'10'          DCB OPEN                  A43752 02401621
         BNO   SKIPSAVE                NO SKIP THE SAVE RTN      A43752 02401821
         L     REG9,44(REG2)           DEB ADDRESS               A43752 02402021
         SR    REG2,REG2               CLEAR FOR INSERT          A43752 02402521
         IC    REG2,16(REG9)           NBR OF EXTENTS            A43752 02403021
         TM    28(REG9),X'04'          TO DEVICE DA              A43752 02404021
         BO    OFFS16                  YES FIND LAST EXTENT      A43752 02405021
         LA    REG9,28(REG9)           SCAN THE EXTENTS          A43752 02406021
NEXTEXT1 LA    REG9,4(REG9)            JUMP TO NEXT EXTENT       A43752 02407021
         BCT   REG2,NEXTEXT1           SCAN FURTHER              A43752 02408021
         B     SAVEUCB                 STORE UCB ADDR            A43752 02409021
OFFS16   DS    0H                                                A43752 02410021
         LA    REG9,16(REG9)                                     A43752 02411021
NEXTEXT2 LA    REG9,16(REG9)           JUMP TO NEXT EXTENT       A43752 02412021
         BCT   REG2,NEXTEXT2           SCAN FURTHER              A43752 02413021
SAVEUCB  L     REG9,0(REG9)             GET UCB ADDRESS          A43752 02414021
         MVC   IEHMVV82+24(2),38(REG9) SAVE LOG FILE SEQ NBR     A43752 02415021
         MVC   IEHMVV82+26(6),28(REG9) SAVE THE VOL SER NBR      A43752 02415521
         OI    IEHMVV82+24,X'80'       SET THE SWITCH FOR IEHMVESN      02416021
         L     REG2,IEHMVV31           RESTORE THE DCB ADDR      A43752 02417021
SKIPSAVE DS    0H                                                A43752 02418021
         LA    REG2,0(0,REG2)    CLEAR HIGH ORDER BYTE                  02420000
         USING IHADCB,REG2             ADDRESS 'TO' DCB        @ZA01247 02421002
         MVC   SAVRECFM,DCBRECFM       SAVE 'TO' DCB RECFM     @ZA01247 02422002
         MVC   SAVLRECL,DCBLRECL                     LRECL     @ZA01247 02423002
         MVC   SAVBLKSI,DCBBLKSI                     BLKSIZE   @ZA01247 02424002
         MVC   SAVKEYLE,DCBKEYLE                     KEYLEN    @ZA01247 02425002
         DROP  REG2                                            @ZA01247 02426002
*                                       CLOSE OUTPUT DCB         A27790 02430019
         CLOSE ((2),REREAD)             (WILL BE REOPENED)       A27790 02440019
         B     GET                                                      02460000
*TN TO TEST FIRST TIME SW, SET UP A CHUNK OF PERM WKAREA,SET UP BASE    02480000
*FOR PERM WKAREA,MOVE VOLUME INFO OF PDS PREVIOUSLY MOVED/COPIED        02500000
*                                                                       02520000
GET      TM    IEHMVV61,X'01'      TEST FOR FIRST TIME THRU             02540000
         BC    1,BLA                                                    02560000
         OI    IEHMVV61,X'01'      SET FIRST TIME THRU SWITCH           02580000
         L     REG2,IEHMVV10       ADDR OF BEGNG OF PERMANENT WKAREA    02600000
         LR    REG9,REG2     SET UP BASE FOR PERM WKAREA                02620000
         LA    REG2,124(0,REG2) INCREMENT BY NO OF BYTES NEEDED A38742  02630021
         MVC   IEHMVV61+1(3),IEHMVV10+1    MOVE START ADDRESS           02660000
         ST    REG2,IEHMVV10       RESET THE START ADDRESS              02680000
         L     REG2,IEHMVV30+12         GET ADDRESS OF FROM DDNAME      02700000
         MVC   DDNAME(8),0(REG2)        SAVE FROM DDNAME                02720000
         L     REG2,IEHMVV22       ADDRESS OF FROM VOLUME LIST          02740000
         MVC   SEARCH(17),0(REG2)      MOVE 17 BYTE ENTRY IN SEARCHDT0I 02760018
         L     REG2,IEHMVV40          ADDR OF SYSUT1 DCB                02780000
         LA    REG2,0(0,REG2)     CLEAR HIGH ORDER BYTE                 02800000
         MVC   HOLDTTR(3),IEHMVV26+1     SAVE TTR OF SYSUT1             02820000
BLA      EQU   *                                                        02840000
         GETMAIN  R,LV=1016                                      S20201 02860020
         LR    REG11,REG1                                               02880000
         MVC   PREFACE(4),FORBLDL  SET UP WORD INDICATOR FOR BLDL       02900000
NOTFIRST L     REG2,IEHMVV61       ADDRESS OF MY CHUNK OF PERM WKAREA   02920000
         LR    REG9,REG2           THIS SETS UP REGISTER 9              02940000
         TM    IEHMVV61,X'04'    ANOTHER DS PENDING                     02960000
         BO    TESTDSCB       IF SO ---                                 02980000
SETEXCP  MVI   INPUT,X'FF'          INDICATE EXIT TYPE FROM EXCP S20201 03083020
         BAL   REG7,MYEXCP            GO-EXECUTE CHANNEL PROG    S20201 03086020
         CLI   INPUT,X'FF'             ARE FF'S STILL THERE      S20201 03089020
         BC    8,NOREAD                IF YES,SEARCH ID= WAS HIT S20201 03092020
         B     TESTDSCB                CHECK IF DS OPEN FOR DSCB S20201 03095020
*                                                                       03100000
*ROUTINE WILL CHECK TO SEE IF                                           03120000
*1) A DATA SET IS ALREADY OPEN AND READY TO USE                         03140000
*2) IF NOT,THEN THE DSCB FOR A DS IS READ INTO CORE AND CHECKED AGAINST 03160000
*   THE 'FROM' DSCB                                                     03180000
*3) IF ANY DISCREPENCIES ARE DETECTED THE INCLUDE IS DROPPED AND THE    03200000
*   NEXT ONE PICKED UP                                                  03220000
*4) IF DS IS OPEN, THEN THE DSNAMES ARE CHECKED AND IF THIS INCLUDE     03240000
*   BELINGS TO THAT DATA SET AN ENTRY IS MADE ON SYSUT3                 03260000
*                                                                       03280000
*                                                                       03300000
TESTDSCB TM    IEHMVV61,X'20'      IS A DS ALREADY OPEN                 03320000
         BC    1,TESTDSNM          IF YES,IS THIS INC FORM THIS DS      03340000
         TM    IEHMVV61,X'10'        DO ANY VOLUMES HAVE TO BE MNTED    03360000
         BC    1,GOTORON                                                03380000
RONRTN   MVC   DSNAME(44),INPUT+6       DSNAME ON INC/REP JUST READ     03400000
         GETMAIN R,LV=500          THIS FOR 'OBTAIN'                    03420000
         L     REG2,IEHMVV31           ADDRESS OF TO DCB       @ZA07033 03422004
         LA    REG2,0(0,REG2)          CLEAR HIGH ORDER BYTE   @ZA07033 03424004
         USING IHADCB,REG2             ADDRESS TO DCB          @ZA07033 03426004
         TM    DCBOFLGS,X'10'          IS TO DCB OPEN          @ZA11945 03426499
         BZ    OBLIST                  NO, BRANCH              @ZA11945 03426899
         MVC   SAVRECFM,DCBRECFM       SAVE TO DCB RECFM       @ZA07033 03428004
         MVC   SAVLRECL,DCBLRECL                   LRECL       @ZA07033 03430004
         MVC   SAVBLKSI,DCBBLKSI                   BLKSIZE     @ZA07033 03432004
         MVC   SAVKEYLE,DCBKEYLE                   KEYLEN      @ZA07033 03434004
         DROP  REG2                                                     03436004
*                                                                       03440000
*WE NOW BUILD A LIST FOR OBTAIN, WHICH GETS THE DSCB FOR US             03460000
*                                                                       03480000
OBLIST   ST    REG1,LIST+12           ADDR OF WKAREA           @ZA11945 03500099
         LA    REG1,INPUT+6        ADDRESS OF DSNAME                    03520000
         ST    REG1,LIST+4         PLUGGED INTO LIST FOR OBTAIN         03540000
         MVI   LIST,X'C1'          INDICATES A SEARCH ON DSNAME         03560000
         MVC   LIST+1(3),ZEROS     CLEAR OUT OTHER THREE BYTES          03580000
         LA    REG1,SEARCH+4       ADDRESS OF VOL SERIAL NUMBER         03600000
         ST    REG1,LIST+8      ADDR OF VOL SER                         03620000
         LA    REG1,LIST           FOR 'OBTAIN'                         03640000
         OBTAIN (1)                GET ME THE DSCB                      03660000
         B     *+4(REG15)          TESTING RETURN CODE IN REG15         03680000
         B     *+12                NORMAL RETURN                        03700000
         B     MSG2                VOLUME NOT MOUNTED                   03720000
         B     MSG3                DSCB NOT FOUND IN VTOC               03740000
*                                                               YA01217 03760016
*  TEST DATA SET ORGANIZATION, RECORD FORMAT, BLOCKSIZE, RECORD YA01217 03762016
*  RECORD LENGTH AND KEYLENGTH OF INCLUDED OR REPLACING DATA SETYA01217 03764016
*  COMPATIBLE WITH 'TO' DATA SET                               @ZA01247 03766002
*                                                               YA01217 03768016
         L     REG2,LIST+12            INC/REP DSCB ADDRESS + 44YA01217 03770016
         SH    REG2,LENGTH44           ADJUST DSCB POINTER      YA01217 03772016
         USING IECSDSL1,REG2                                    YA01217 03780016
         L     REG3,IEHMVV30+8         FROM DSCB ADDRESS        YA01217 03782016
*                                                               YA01217 03784016
         TM    DS1DSORG,PO             TEST INC/REP DSORG       YA01217 03786016
         BNO   MSG4                    IGNORE IF NOT PARTITIONEDYA01217 03788016
*                                                               YA01217 03790016
         CLC   DS1KEYL,SAVKEYLE        COMPARE KEYLEN INC - TO @ZA01247 03792002
         BNE   MSG7                    MUST BE EQUAL            YA01217 03800016
*                                                               YA01217 03803016
         MVC   TORECFM,SAVRECFM      WORK-COPIES OF TO AND INC @ZA01247 03806002
         MVC   INCRECFM,DS1RECFM       RECFM ALLOWING BIT RESET.YA01217 03809016
*                                                               YA01217 03812016
         TM    INCRECFM,T              TEST INC/REP DS          YA01217 03815016
         BNO   CTESTNOT                IF WRITTEN WITH TRACK    YA01217 03820016
         TM    SEARCH+1,TFEATURE       OVERFLOW, THE DEVICE     YA01217 03822016
         BNO   MSG9                    SHOULD HAVE THIS FEATURE.YA01217 03824016
         NI    INCRECFM,ALL-T          T-BITS NOT USED IN OTHER YA01217 03826016
CTESTNOT NI    TORECFM,ALL-T-KEYLEN0   TESTS OF THE RECFM.      YA01217 03828016
*                                                               YA01217 03830016
         TM    TORECFM,U               BRANCH TO ROUTINE FOR:   YA01217 03832016
         BO    CTESTU                  RECFM UNDEFINED          YA01217 03840016
         TM    TORECFM,F               RECFM FIXED (BLOCKED)    YA01217 03842016
         BO    CTESTF                                           YA01217 03844016
         TM    TORECFM,V+S             RECFM VARIABLE SPANNED   YA01217 03846016
         BO    CTESTVS                                 (BLOCKED)YA01217 03848016
         TM    TORECFM,V               RECFM VARIABLE           YA01217 03850016
         BO    CTESTV                                           YA01217 03852016
*                                      IF NOT SPECIFIED, HANDLE YA01217 03860016
*                                      AS UNDEFINED             YA01217 03863016
*                                                               YA01217 03866016
CTESTU   EQU   *                       - RECFM UNDEFINED.       YA01217 03869016
         TM    INCRECFM,U              INCLUDE RECFM HAS TO BE  YA01217 03872016
         BM    MSG4A                   UNDEFINED OR NOT SPECIFIDYA01217 03875016
         NI    TORECFM,ALL-U           RESET BITS TO COMPARE    YA01217 03880016
         NI    INCRECFM,ALL-U          ONLY CONTROL-CHAR-BITS   YA01217 03882016
         CLC   INCRECFM,TORECFM        TEST RECFM INC/REP - TO @ZA01247 03884002
         BNE   MSG4A                   IF NOT EQUAL INCOMPATIBLEYA01217 03886016
         CLC   DS1BLKL,SAVBLKSI        COMPARE BLKSIZE INC -TO @YA03857 03888002
         BNH   CTESTETJ                GOOD IF NOT LARGER.      YA01217 03890016
         CLC   DS1BLKL,DS1BLKL-DS1DSNAM(REG3)  IF BLKSIZE OF INCYA01217 03892016
         BH    MSG5                    NOT LARGER THAN FROM DS, YA01217*03900016
                                       USER RESPONSIBILITY.     YA01217 03902016
         B     CTESTETJ                NORMAL COPY (IEHMVETJ)   YA01217 03904016
*                                                               YA01217 03906016
CTESTF   EQU   *                       - RECFM FIXED (BLOCKED)  YA01217 03908016
         CLC   INCRECFM,TORECFM        COMPARE RECFM INC - TO  @ZA01247 03910002
         BE    CTESTF1                 IF EQUAL, RECFM OK.      YA01217 03912016
         NI    INCRECFM,ALL-B-S        RESET BITS TO COMPARE    YA01217 03920016
         NI    TORECFM,ALL-B-S         (BLOCKED AND STANDRD OFF)YA01217 03923016
         CLC   INCRECFM,TORECFM        COMPARE REMAINING BITS   YA01217 03926016
         BNE   MSG4A                   MUST BE EQUAL            YA01217 03929016
         CLC   DS1LRECL,SAVLRECL       COMPARE LRECL INC - TO  @ZA01247 03932002
         BNE   MSG6                    MUST BE EQUAL            YA01217 03935016
         TM    SAVRECFM,S              TEST TO DS STANDARD     @ZA01247 03940002
         BNO   CTESTF2                                          YA01217 03942016
         TM    DS1RECFM,S              TEST INC/REP DS STANDARD YA01217 03944016
         BO    CTESTF2                                          YA01217 03946016
         CLI   DS1KEYL,ZERO            IF TO DS S BUT INC NOT, @ZA01247 03948002
         BNE   MSG4A                   REBLOCKING REQUIRED BUT  YA01217 03950016
         B     CTESTESL                ONLY POSSIBLE IF KEY ZEROYA01217 03952016
CTESTF1  EQU   *                                                YA01217 03960016
         CLC DS1LRECL,SAVLRECL         COMPARE LRECL INC - TO  @ZA01247 03962002
         BNE   MSG6                    MUST BE EQUAL            YA01217 03964016
CTESTF2  EQU   *                                                YA01217 03966016
         CLC   DS1BLKL,SAVBLKSI        COMPARE BLKSIZE INC -TO @ZA01247 03968002
         BE    CTESTETJ                IF EQAUL, NORMAL COPY    YA01217 03970016
         CLI   DS1KEYL,ZERO            IF NOT EQUAL AND KEYLEN  YA01217 03972016
         BE    CTESTESL                ZERO, CAN BE REBLOCKED.  YA01217 03980016
         CLC   DS1BLKL,SAVBLKSI        NO REBLOCKING POSSIBLE:  YA01217 03983016
         BH    MSG5                    IF TO BLKSIZE LARGER AND YA01217 03986016
         TM    SAVRECFM,S              NO STANDARD BLOCKS, THE  YA01217 03989016
         BO    MSG5                    SMALLER BLOCKS ARE COPIEDYA01217 03992016
         B     CTESTETJ                                         YA01217 03995016
*                                                               YA01217 04000016
CTESTVS  EQU   *                       - RECFM VARIABLE SPANNED YA01217 04002016
         CLC   INCRECFM,TORECFM        COMPARE RECFM INC - TO  @ZA01247 04004002
         BNE   MSG4A                   MUST BE EQUAL            YA01217 04006016
         CLC   DS1BLKL,SAVBLKSI        COMPARE BLKSIZE INC -TO @ZA01247 04008002
         BNE   MSG5                    V(B)S CANNOT BE REBLOCKEDYA01217 04010016
         CLC   DS1LRECL,SAVLRECL       COMPARE LRECL INC - TO  @ZA01247 04012002
         BNH   CTESTETJ                GOOD IF LOW OR EQUAL     YA01217 04020016
         CLC   DS1LRECL,DS1LRECL-DS1DSNAM(REG3)  IF HIGH, ALLOW YA01217 04022016
         BH    MSG6                    COPY WHEN USER TOOK SAME YA01217 04024016
         B     CTESTETJ                IF GOOD, NORMAL COPY     YA01217 04026016
*                                                               YA01217 04028016
CTESTV   EQU   *                       - RECFM VARIABLE         YA01217 04030016
         XC    INCRECFM,TORECFM        SET NOT-MATCHING BITS IN YA01217 04032016
         TM    INCRECFM,ALL-B            RECFM, OF WHICH ONLY B YA01217 04040016
         BNZ   MSG4A                     (BLOCKED) MAY DIFFER.  YA01217 04043016
         XC    INCRECFM,TORECFM        RESET RECFM              YA01217 04046016
         TM    TORECFM,B               TEST TO DS BLOCKED      @ZA01247 04049002
         BNO   CTESTV3                   BRANCH IF NOT BLOCKED  YA01217 04052016
*                                      - TO DS IS BLOCKED      @ZA01247 04055002
         CLC   SAVBLKSI,DS1BLKL        COMPARE BLKSIZE TO -INC @ZA01247 04060002
         BL    CTESTV1                   LOW                    YA01217 04062016
         BH    CTESTV2                   HIGH                   YA01217 04064016
*                                        EQUAL                  YA01217 04066016
         TM    INCRECFM,B              TEST INC DS BLOCKED      YA01217 04068016
         BO    CTESTETJ                IF BLOCKED, NORMAL COPY  YA01217 04070016
         B     CTESTV2                 IF NOT, TEST KEY TO REBLKYA01217 04072016
CTESTV1  EQU   *                                                YA01217 04080016
         TM    INCRECFM,B              TEST INC DS BLOCKED      YA01217 04082016
         BO    CTESTV4                 IF YES, TEST KEY TO REBLKYA01217 04084016
         TM    DS1RECFM-DS1DSNAM(REG3),B  IF INC NOT BLOCKED ANDYA01217 04086016
         BO    MSG5                    FROM-DS BLOCKED, NOT COPDYA01217 04088016
         CLC   DS1BLKL,DS1BLKL-DS1DSNAM(REG3)  FROM DS NOT BLKED YM5087 04090000
         BL    MSG5                    THEN BLKSIZE MUST BE LOW.YA01217 04092016
CTESTV2  EQU   *                                                YA01217 04100016
         CLI   DS1KEYL,ZERO            TEST FOR KEY             YA01217 04103016
         BZ    CTESTESM                IF NO KEY, REBLOCK       YA01217 04106016
         B     CTESTETJ                ELSE, COPY ASIS          YA01217 04109016
CTESTV3  EQU   *                       - TO DS IS NOT BLOCKED  @ZA01247 04112002
         TM    INCRECFM,B              TEST INC DS BLOCKED      YA01217 04115016
         BNO   CTESTV5                   BRANCH IF NOT          YA01217 04120016
CTESTV4  EQU   *                       INC DS IS BLOCKED        YA01217 04122016
         CLI   DS1KEYL,ZERO            TEST FOR KEY             YA01217 04124016
         BZ    CTESTESM                IF NO KEY, REBLOCK       YA01217 04126016
         B     MSG5                    ELSE REBLOCKING IMPOSSIBLYA01217 04128016
CTESTV5  EQU   *                       INC AND TO DS NOT BLKED @ZA01247 04130002
         CLC   SAVBLKSI,DS1BLKL        COMPARE BLKSIZE TO -INC @ZA01247 04132002
         BNL   CTESTETJ                IF NOT SMALLER, NORMAL C.YA01217 04140016
         TM    DS1RECFM-DS1DSNAM(REG3),B  TEST FROM-DS BLOCKED  YA01217 04142016
         BO    MSG5                    IF SO, BLKSIZE TOO LARGE YA01217 04144016
         CLC   DS1BLKL,DS1BLKL-DS1DSNAM(REG3)  IF NOT, AND BLKSZ YM5087 04146000
         BNL   CTESTETJ                NOT SMALLER, TAKE SAME   YA01217*04148016
                                       RISK AS FOR FROM DS      YA01217 04150016
         B     MSG5                    IF SMALLER, NO COPY      YA01217 04152016
*                                                               YA01217 04160016
CTESTESM MVC   MODULEND,SM             VARIABLE REBLOCKING      YA01217 04163016
         B     SETUPDCB                RETURN TO IEHMVESM       YA01217 04166016
*                                                               YA01217 04169016
CTESTESL MVC   MODULEND,SL             FIXED REBLOCKING         YA01217 04172016
         B     SETUPDCB                RETURN TO IEHMVESL       YA01217 04175016
*                                                               YA01217 04180016
CTESTETJ MVC   MODULEND,TJ             NORMAL MOVE/COPY         YA01217 04185016
*                                      RETURN TO IEHMVETJ       YA01217 04190016
         DROP  REG2                                             YA01217 04195016
*                                                                       04220000
*THIS ROUTINE WILL SET UP A DCB SO IT CAN BE OPENED AND THE DIRECTORY   04240000
*CAN BE ACCESSED BY BLDL                                                04260000
*                                                                       04280000
SETUPDCB MVI   FAKEDCB,X'00'  THIS WILL CLEAR OUT THE WHOLE       M2686 04300016
         MVC   FAKEDCB+1(87),FAKEDCB    DCB AND WE CAN NOW INITIALIZE   04360000
         LA    REG1,1                   PUT CONSTANT OF 1 IN REG1       04380000
         STC   REG1,FAKEDCB+23           INITIALIZES                    04400000
         STC   REG1,FAKEDCB+31            PART OF                       04420000
         STC   REG1,FAKEDCB+55             THE DCB                      04440000
         STC   REG1,FAKEDCB+59              TO WHAT                     04460000
         STC   REG1,FAKEDCB+71               IT LOOKS                   04480000
         STC   REG1,FAKEDCB+75                LIKE                      04500000
         STC   REG1,FAKEDCB+79                 BEFORE                   04520000
         STC   REG1,FAKEDCB+87                  OPEN                    04540000
         LA    REG1,2                   MORE                            04560000
         STC   REG1,FAKEDCB+48           INITIALIZING                   04580000
         MVC   FAKEDCB+50(2),MACRF MACRO FORMAT,WE ARE GOING TO READ    04600000
         MVC   FAKEDCB+26(2),FILETYPE   THIS A PDS                      04620000
         MVC   FAKEDCB+36(1),84(REG2) RECFM FROM DSCB OF THIS DS YM5087 04640000
         MVC   FAKEDCB+37(3),EXITLST+1  MOVE EXITLIST PTR TO DCB        04660000
         MVI   JFCB,X'00'               CLEAR JFCB OUT                  04680000
         MVC   JFCB+1(175),JFCB                                         04700000
         MVC   JFCB(44),INPUT+6         MOVE DSNAME IN                  04720000
         MVI   JFCB+44,X'40'      MOVE BL TO MEMBER NAME                04740000
         MVI   JFCB+117,X'01'           1 VOL ID TO FOLLOW              04760000
         MVC   JFCB+118(6),SEARCH+4     VOL ID                          04780000
         MVI   JFCB+124,X'40'                                           04800000
         MVC   FAKEDCB+40(8),DDNAME     SET UP DDNAME                   04820000
         LA    REG1,44(REG2)           RESET PTR TO DSCB        YA01217 04840016
         L     REG2,IEHMVV30       ADDRESS OF 'FROM' DCB                04860000
         MVC   0(88,REG2),FAKEDCB  MOVE BUILT DCB TO COMTAB             04880000
         MVC   62(2,REG2),42(REG1)     MOVE BLKSIZE TO DCB              04900000
         FREEMAIN R,LV=500,A=(1) FREE CORE GOTTEN FOR DSCB        M2686 04912016
         LA    REG2,0(0,REG2)        CLEAR HIGH ORDER BYTE              04920000
         MVC   RENTOPEN(TAG-OPENJ),OPENJ     THIS MAKES                 04940000
         OPEN  ((2)),TYPE=J,MF=(E,RENTOPEN)  OPEN REENTRANT             04960000
         OI    IEHMVV61,X'20'      INDICATE WE HAVE AN OPEN DS          04980000
*                                                                       05000000
*NOW READY TO PASS SOME INFORMATION TO BLDL,SO WE CAN GET A DIRECTORY   05020000
*ENTRY ONTO SYSUT3                                                      05040000
*                                                                       05060000
BLDLINFO MVC   BLDL(8),INPUT+50    MOVE MEMBER NAME TO BLDL LIST        05080000
         L     REG1,IEHMVV30       ADDRESS OF DCB                       05100000
         LA    REG1,0(0,REG1)      CLEAR HIGH ORDER BYTE FOR BLDL       05120000
         LA    REG0,PREFACE        ADDRESS OF LIST FOR BLDL             05140000
         BLDL  (1),(0)                                                  05160000
         CLI   BLDL+10,X'00'       CHECKING FOR NOFOUND FROM BLDL       05180000
         BC    8,MSG8              IF EQUAL,PRINT MSG                   05200000
         B     PUTONUT3                                                 05220000
*                                                                       05240000
*IF A DS IS OPEN,WE ENTER THIS ROUTINE WHICH CHECKS TO SEE IF THIS INC  05260000
*BELONGS TO THIS DS. IF NOT,THE A SWITCH IS SET THAT SAYS ANOTHER INC   05280000
*EXISTS ON THIS VOLUME,SO NO MOUNTING WILL BE REQUIRED TO PRECESS INCL- 05300000
*UDES FROM AT LEAST ONE MORE DS.                                        05320000
*                                                                       05340000
TESTDSNM CLC   DSNAME(44),INPUT+6  THIS INC BELONG TO THIS DS           05360000
         BC    8,BLDLINFO     IF YES,GIVE ITS INFO TO BLDL              05380000
         OI    IEHMVV61,X'04' SW THAT SAYS ANOTHER INC DS ON THIS VOL   05400000
         B     YES1                                                     05420000
*                                                                       05440000
*ROUTINE WILL  PUT DIRECTORY ENTRY ON SYSUT3 WITH A KEY OF ATTR,A BEING 05460000
*EQUAL TO 00 IF A TRUE MEMB NAME AND 80 IF AN ALIAS. IT WILL ALSO MAKE  05480000
*THE FIRST 5 BYTES OF THE DATA PORTION CCHHR                            05500000
*                                                                       05520000
PUTONUT3 L     REG2,IEHMVV42           SYSUT3 DCB ADDRESS        S20201 05530020
         USING IHADCB,REG2                                       S20201 05540020
         L     REG1,DCBDVTBL           ADDRESS THE DEVICE CHARAC-S20201 05550020
*                                      TERISTICS TABLE           S20201 05560020
         USING UNITABLE,REG1                                     S20201 05570020
         SR    REG3,REG3               TO GET THE DEVICE OVERHEADS20201 05580020
         TM    UNITFLAG,X'08'          2-BYTE OVHD FACTOR        S20201 05590020
         BZ    OVH1                    *B IF NOT-GET 1 BYTE      S20201 05600020
         LH    REG3,UNITOVHI           GET 2-BYTE OVHEAD         S20201 05610020
         B     ADD87                   *B TO ADD KEY+DATALENGTH  S20201 05620020
OVH1     IC    REG3,UNITOVHL           GET 1-BYTE OVHEAD         S20201 05630020
ADD87    LA    REG3,KEYLEN+DATALEN(0,REG3)  TOTAL LENGTH         S20201 05640020
         MVC   BLDL+11(63),BLDL+13     WIPE OUT BLDL EXTRA BYTES S20201 05650020
         CH    REG3,DCBTRBAL           WILL RECORD FIT ON TRACK  S20201 05660020
         BC    2,NEWTRK                NO BUMP TO NEXTTRACK      S20201 05670020
         MVC   CCHHR(4),DCBFDAD+3      MOVE CCHH FROM DCB        S20201 05680020
         IC    REG1,DCBFDAD+7          INSERT R BYTE OF CCHHR    S20201 05690020
         LA    REG1,1(0,REG1)      UP IT BY ONE                         05720000
         STC   REG1,CCHHR+4        STORE IN OUTPUT AREA                 05740000
MOVEDIR  MVC   DATA(74),BLDL       MOVE DIREC ENTRY TO OUTPUT AREA      05760000
         MVC   KEY+1(3),BLDL+8     MOVE TTR TO KEY AREA                 05780000
         TM    BLDL+11,X'80'       IS THIS AN ALIAS ENTRY               05800000
         BC    1,ALIAS             YES IT IS                            05820000
         MVI   KEY,X'00'           TRUE MEMBER NAME                     05840000
         B     *+12                                                     05860000
ALIAS    MVI   KEY,X'80'           AN ALIAS ENTRY                       05880000
         OI    IEHMVV20+2,X'80'        TURN ON ALAIS SWITCH        9312 05900000
         L     REG5,IEHMVV42+4   ADDRESS OF DECB FOR WRITE              05920000
         LA    REG5,0(0,REG5)      CLEAR HIGH ORDER BYTE                05940000
         LA    REG4,KEY            ADDRESS OF OUTPUT AREA               05960000
         LA    REG3,DATALEN            GET DATALENGTH FOR WRITE  S20201 05970020
KEYLEN   EQU   4                                                 S20201 05980020
DATALEN  EQU   87                                                S20201 05990020
         LA    REG1,CCHHR+79     WHERE RENAME GOES                      06000000
         NI    IEHMVV61,X'FB'    TURN OFF DS PENDING BIT                06020000
         MVC   0(8,REG1),INPUT+75      MOVE NEW NAME AT END OF UT3 DT0I 06030018
*                                      RECORD                      DT0I 06040018
         WRITE (5),SF,(2),(4),(3),MF=E     WRITE MACRO                  06060000
         L     REG1,IEHMVV42+4     ADDRESS OF DECB FOR CHECK            06080000
         LA    REG1,0(0,REG1)    CLEAR HIGH ORDER BYTE                  06100000
         CHECK (1)                                                      06120000
         OI    IEHMVV61,X'08'      SHOWS AN ENTRY ON SYSUT3             06140000
         B     SETEXCP                                                  06160000
*                                                                       06180000
*ROUTINE TO UP IT OF TTR BY ONE, SET TRACK BALANCE TO ZERO SET R OF TTR 06200000
*TO ONE                                                                 06220000
*                                                                       06240000
NEWTRK   L     REG1,44(REG2)       ADDRESS OF DEB                       06260000
         LA    REG2,5(REG2)        ADDR OF MBBCCHHR IN DCB              06280000
         LR    REG4,BASE10         SAVE MY BASE REGISTER                06300000
         LR    REG5,REG11          SAVE BASE OF MY GOTTEN CORE          06320000
         STM   9,13,SAVEREG        SAVE THE OTHERS                      06340000
         L     REG15,16            16 CONTAINS ADDR OF COM VEC TBL      06360000
         L     REG15,32(0,REG15)   ADDRESS OF IECPRLTV                  06380000
         BALR  REG14,REG15         CONVERT MBBCCHHR TO TTR              06400000
         LR    BASE10,REG4         REINSTATE BASE REG                   06420000
         LR    REG11,REG5          REINSTATE MY GOTTEN CORE BASE REG    06440000
         LM    9,13,SAVEREG        RESTORE OTHERS                       06460000
         SRL   REG0,8              GET R BYTE IN LOW ORDER              06480000
         IC    REG0,ZEROS          MAKE R ZERO                          06500000
         A     REG0,UPTTR          THIS ADDS ONE TO IT PORTION OF TTR   06520000
         SLL   REG0,8                                                   06540000
         L     REG2,IEHMVV42       ADDRESS OF DCB                       06560000
         L     REG1,44(REG2)       DEB ADDR                             06580000
         LA    REG2,DATA      TEMPORARY AREA TO PUT MBBCCHHR            06600000
         LR    REG4,BASE10         SAVE MY BASE                         06620000
         LR    REG5,REG11          SAVE BASE OF MY GOTTEN CORE          06640000
         STM   9,13,SAVEREG                                             06660000
         L     REG15,16            16 CONTAINS ADDR OF COM VEC TBL      06680000
         L     REG15,28(0,REG15)   ADDRESS OF IEC                       06700000
         BALR  REG14,REG15         CONVERT TTR TO MBBCCHHR              06720000
         LR    BASE10,REG4         REINSTATE MY BASE                    06740000
         LR    REG11,REG5          REINSTATE MY GOTTEN CORE BASE REG    06760000
         LM    9,13,SAVEREG                                             06780000
         MVC   CCHHR(4),DATA+3     MOVES CCHH TO MY OUTPUT AREA         06800000
         IC    REG1,DATA+7         INSERT R BYTE OF CCHHR               06820000
         LA    REG1,1(0,REG1)      UP THE R BYTE BY ONE                 06840000
         STC   REG1,CCHHR+4        STORE THIS R BYTE IN OUTPUT AREA     06860000
         L     REG2,IEHMVV42       ADDR OF DCB                          06880000
         MVC   18(2,REG2),ZEROS  ZERO OUT TRACK BALANCE                 06900000
         B     MOVEDIR                                                  06920000
*                                                                       06940000
*THIS ROUTINE WILL SET UP THE MBBCCHHR FOR THE SEEK(FIRST TIME ONLY)    06960000
*AND WILL ISSUE AN EXCP AND WAIT AND THE INTEROGATE THE RETURN BY IOS   06980000
*                                                                       07000000
*                                                                       07020000
MYEXCP   TM    IEHMVV61,X'02'      FIRST TIME THRU EXCP                 07040000
         BO    IOERROUT           I/O ERR, TERMINATE               7632 07060000
         XC    CCWVOL(CCWS),CCWVOL  CLEAR CHAN PROG AREA         S20201 07070020
         LA    REG2,FIRST         PTR TO FIELD THAT WILLCONTAIN  S20201 07080020
*                                 CCHHR OF START OF INCL/REPL    S20201 07090020
*                                 LIST ON SYSUT1                 S20201 07100020
         ST    REG2,CCWVOL        STORE IN 2ND CHAN PROG         S20201 07110020
         ST    REG2,CHANPROG      STORE IN 1ST CHAN PROG         S20201 07120020
*                                                                S20201 07130020
         LA    REG2,CCWVOL        PTR TO SIDEQ OF 2ND CHANPROG   S20201 07140020
         ST    REG2,CCWVOL+8      STORE IN SUBSEQUENT TIC        S20201 07150020
         ST    REG2,RPSCCW+8      AND IN TIC FOLLOWING SET SECTORS20201 07160020
*                                                                S20201 07170020
         LA    REG2,IEHMVV39      PTR TO CCHHR OF LAST UT1 REC   S20201 07180020
         ST    REG2,ANTHRSRC      STORE IN CCW THAT LOOKS UP END S20201 07190020
         ST    REG2,CCWSRCH       SAME FOR 1ST CHANPROG          S20201 07200020
*                                                                S20201 07210020
         LA    REG2,KEYNZERO      PTR TO CCW THAT LOOKS FOR NON- S20201 07220020
*                                 ZERO-ED KEY                    S20201 07230020
         ST    REG2,ANTHRSRC+8    STORE IN TIC FOLLOWING SIDEQ   S20201 07240020
*                                                                S20201 07250020
         LA    REG2,ZEROS         COMPARAND FOR SKH CCW          S20201 07260020
         ST    REG2,KEYNZERO      PUT IN 2ND CHANPROG            S20201 07270020
         ST    REG2,ZEROOUT+16    ALSO USED TO CLOBBER FOUND REC S20201 07280020
         ST    REG2,RPSCCW        AND AS 1ST SECTOR VALUE        S20201 07290020
         ST    REG2,RPSCHAN       IN BOTH CHAN PROGS             S20201 07300020
*                                                                S20201 07310020
         LA    REG2,ANTHRSRC      PTR TO CCW THAT LOOKS FOR      S20201 07320020
*                                 END OF UT1                     S20201 07330020
         ST    REG2,KEYNZERO+8    STORE IN TIC FOLLOWING SKH CCW S20201 07340020
*                                                                S20201 07350020
         LA    REG2,INPUT         PTR TO INPUT AREA              S20201 07360020
         ST    REG2,KEYNZERO+16   STORE IN READ CCW 2ND CHANPROG S20201 07370020
         ST    REG2,SRCHKEY+16    STORE IN READ CCW 1ST CHANPROG S20201 07380020
         ST    REG2,ZEROOUT       AND IN SIDEQ OF DESTROYER      S20201 07390020
*                                                                S20201 07400020
         LA    REG2,CHANPROG      PTR TO SIDEQ OF 1ST CHANPROG   S20201 07410020
         ST    REG2,CHANPROG+8    STORE IN SUBSEQUENT TIC        S20201 07420020
         ST    REG2,RPSCHAN+8     AND IN TIC FOLLOWING SET SECTORS20201 07430020
*                                                                S20201 07440020
         LA    REG2,SRCHKEY       PTR TO CCW LOOKING FOR MATCHINGS20201 07450020
*                                 VOLUME INFORM (=KEY)           S20201 07460020
         ST    REG2,CCWSRCH+8     STORE IN TIC                   S20201 07470020
*                                                                S20201 07480020
         LA    REG2,SEARCH        PTR TO KEY TO LOOK FOR         S20201 07490020
         ST    REG2,SRCHKEY       PUT IN SKEQ CCW                S20201 07500020
*                                                                S20201 07510020
         LA    REG2,CCWSRCH       PTR TO CCW THAT LOOKS FOR END  S20201 07520020
         ST    REG2,SRCHKEY+8     STORE IN TIC AFTER SKEQ CCW    S20201 07530020
*                                                                S20201 07540020
         LA    REG2,ZEROOUT       PTR TO START OF DESTROYER      S20201 07550020
         ST    REG2,ZEROOUT+8     PUT IN SUBSEQUENT TIC          S20201 07560020
         ST    REG2,READSEC+16    AND IN TIC FOLLOWING READ/SET  S20201 07570020
*                                 SECTOR CCW SEQUENCE            S20201 07580020
         LA    REG2,SECTOR        PTR TO FIELD TO CONTAIN SECTOR S20201 07590020
         ST    REG2,READSEC       STORE IN READ SECTOR CCW       S20201 07600020
         ST    REG2,READSEC+8     AND IN SET SECTOR CCW          S20201 07610020
*                                                                S20201 07620020
         TM    IEHMVV20+RPS,RPS   SYSUT1 ON RPS DEVICE           S20201 07630020
         BZ    NORPS              *B IF NOT                      S20201 07640020
         LA    REG2,READSEC       CCW TO TIC TO AFTER SUCCESFULL S20201 07650020
*                                 READING DATA                   S20201 07660020
         B     *+8                GO TO STORE IN TIC             S20201 07670020
NORPS    LA    REG2,ZEROOUT       NO RPS -NEXT SEQ CCW           S20201 07680020
         ST    REG2,TIC           STORE IN TIC                   S20201 07690020
*                                                                S20201 07700020
**  SET COMMAND CODES,FLAGS AND LENGTHS IN CHANNEL PROGRAM ******S20201 07710020
*                                                                S20201 07720020
         OC    CCWVOL(CCWS),MYCHNLPG                             S20201 07730020
*                                                                S20201 07740020
**** CHANNEL PROGRAM COMPLETED-NOW TAKE CARE OF IOB ************ S20201 07750020
SETIOB   XC    IOB(40),IOB             CLEAR IOB                 S20201 07859020
         LA    REG1,ECB    ADDRESS OF MY ECB                            07880000
         ST    REG1,IOB+4    STICK ECB PTR IN MY IOB                    07900000
         L     REG1,IEHMVV40      ADDRESS OF SYSUT1 DCN                 07920000
         ST    REG1,DCBADR     STICK UT1 DCB PTR IN MY IOB              07940000
         STM   2,13,SAVEREG        SAVE REGISTERS FOR CONVERT ROUTINE   07960000
         LR    REG3,BASE10                                              07980000
         LR    REG4,REG11       SAVE REG11 TO REINSTATE REGISTERS       08000000
         L     REG0,HOLDTTR        TTR OF SYSUT1                        08020000
         IC    REG0,ZEROS          CLEAR OUT TO MAKE TTR0               08040000
         L     REG2,IEHMVV40       ADDRESS OF DCB                       08060000
         L     REG1,44(REG2)       ADDRESS OF DEB IN REG1 FOR CONVERT   08080000
         LA    REG2,MBBCCHHR   WHERE ABSOLUTE ADDRESS IS TO GO          08100000
         L     REG15,16            ADDRESS OF SYSTEM COMMUNICATION TBL  08120000
         L     REG15,28(0,REG15)   ADDRESS OF CONVERT ROUTINE           08140000
         BALR  REG14,REG15         GO TO CONVERT ROUTINE                08160000
         LR    BASE10,REG3                                              08180000
         LR    REG11,REG4       REINSTATE REG11                         08200000
         MVC   FIRST(4),MBBCCHHR+3    MOVE CCHHR TO 'FIRST'             08220000
         IC    REG3,MBBCCHHR+7     INSERT R IN REG3                     08240000
         BCTR  REG3,0      REDUCE REG3 BY ONE                           08260000
         STC   REG3,FIRST+4    START SEARCH AT BEGINNING                08280000
         LM    2,13,SAVEREG        RESTORE THE REGISTERS                08300000
         TM    IEHMVV20+RPS,RPS        RPS BIT ON TEST           S20201 08318020
         BZ    SKPNORM                 NO - BRANCH               S20201 08324020
         LA    REG1,RPSCHAN            ADDRESS OF CCW LIST       S20201 08330020
         B     NORM1                   CONTINUE                  S20201 08336020
SKPNORM  LA    REG1,CHANPROG           S20201                           08342020
NORM1    ST    REG1,START              STORE IN IOB              S20201 08348020
         MVC   ECB(4),ZEROS             CLEAR OUT ECB BEFORE EXCP       08360000
         EXCP  IOB            EXECUTE CHANNEL PROGRAM                   08380000
         L     REG1,IOB+4          ADDRESS OF ECB FOR WAIT              08400000
         WAIT  ECB=(1)      W AIT FOR THIS EVENT TO COMPLETE            08420000
         L     REG1,IEHMVV40       ADDRESS OF DCB                       08440000
         TM    44(REG1),X'C0'                                           08460000
         BC    1,MSG1         GO TO A ROUTINE THAT SAYS PERM I/O ERROR  08480000
         BR    REG7                                                     08500000
*                                                                       08520000
*THIS THE ROUTINE WE GO TO, TO HAVE A VOLUME MOUNTED. WE BUILD THE      08540000
*APPROPRIATE LIST AND PICK UP THE ADDRESS OF VOLUME MOUNT FROM THE COM- 08560000
*TAB AND WHEN HE RETURNS, THE REQUIRED VOLUMES SHOULD BE MOUNTED.       08580000
*                                                                       08600000
GOTORON  NI    IEHMVV61,X'EF'      SO WE WONT COME BACK TO VOLUME MOUNT 08620000
         LA    REG1,SEARCH     POIMTER TO TYPE,VOL ID, SEQ #            08640000
VMGEN    EQU   0                                                        08660000
VMINDICA EQU   4                                                        08680000
VMIT     EQU   4                                                        08700000
VMVMR    EQU   11                                                       08720000
VMITC    EQU   10                                                       08740000
VMDEV    EQU   12                                                       08760000
VMVSN    EQU   16                                                       08780000
VMRTA     EQU    22                                                     08800000
VMUNIT   EQU   24                                                       08810018
*                                                                       08820000
*                                  TO CALL VOL MOUNT                    08840000
*                                       NO VALID OLD REQUESTS           08860000
*                                  REG 1  POINTS TO                     08880000
*                                                                       08900000
*                                       DEVICE TYPE    4 BYTES          08920000
*                                       VOL ID         6 BYTES          08940000
*                                                                       08960000
         MVC   IEHMVV00+VMIT(4),IEHMVV50+4   PTR TO IT TABLE            08980000
         MVC   IEHMVV00+VMITC(1),IEHMVV50+4  IT ENTRY COUNT             09000000
         MVI   IEHMVV00+VMVMR,X'01'          NUMBER OF REQUESTS         09020000
         MVI   IEHMVV00+VMINDICA,X'90'       SET UP INDICATOR           09040000
         MVC   IEHMVV00+VMDEV(10),0(1)       SET UP DEVICE TYPE         09060000
         MVC   IEHMVV00+VMUNIT(5),12(REG1)  SET UP SPEC UNIT       DT0I 09070018
         LA    3,IEHMVV00                                               09080000
         L     4,AATG                                                   09100000
         XCTL  EP=IEHMVXSF                                              09120000
VOLRET   EQU   *                                                        09140000
*                                                                       09160000
         TM    IEHMVV00+VMIT,X'01'           WAS VOLUME MOUNTED         09180000
         BZ    NOMOUNT            NO MOUNTING INITIATED ERROR MSG       09200000
         L     1,IEHMVV00+VMIT                    YES                   09220000
         AH    1,IEHMVV00+VMRTA                                         09240000
         L     1,0(0,1)                      GET POINTER TO DDNAME      09260000
*                                                                       09280000
         MVC   DDNAME(8),0(REG1)        SAVE DDNAME FROM VOL MOUNT      09300000
         B     RONRTN         RETURN TO MY PROGRAM                      09320000
         DS    0F                                                       09340000
AATG     DC    CL4'AATG'                                                09360000
*                                                                       09380000
*THIS ROUTINE WILL CHECK SYSUT1 TO SEE IF ANY MORE INCLUDES ARE PRESENT 09400000
*IF SO IF WILL READ THE FIRST NON-ZERO KEY RECORD AND USE IT'S VOLUME   09420000
*INFORMATION TO HAVE A NEW VOLUME MOUNTED. IF NO MORE INCLUDES, THEN    09440000
*THE INC/REP BIT IS TURNED OFF AND WE GO TO IEHMVETJ FOR THE LAST TIME. 09460000
*                                                                       09480000
VOLEXCP  MVI   INPUT,X'FF'    TO SEE IF I READ ANYTHING                 09500000
         TM    IEHMVV20+RPS,RPS        RECORD READY FEATURE TEST S20201 09508020
         BZ    VOLNORM                 NO-CONTINUE AS USUAL      S20201 09516020
         LA    REG1,RPSCCW             ADDRESS OF CCW LIST       S20201 09524020
         B     NORM2                   CONTINUE                  S20201 09532020
VOLNORM  LA    REG1,CCWVOL            ADDRESS OF CHANNEL PROGRAM S20201 09540020
NORM2    ST    REG1,START              STORE ADDRESS IN MY IOB   S20201 09548020
         MVC   ECB(4),ZEROS             CLEAR OUT ECB BEFORE EXCP       09560000
         EXCP  IOB                 EXECUTE CHANNEL PROGRAM              09580000
         L     REG1,IOB+4     ADDRESS OF ECB FOR WAIT MACRO             09600000
         WAIT  ECB=(1)      W AIT FOR THIS EVENT TO COMPLETE            09620000
         L     REG1,IEHMVV40  ADDRESS OF SYSUT1 DCB                     09640000
         TM    44(REG1),X'C0' CHECKING FOR PERM I/O ERROR               09660000
         BC    1,MSG1         ABDRT AT THIS POINT                       09680000
         CLI   INPUT,X'FF'    TO SEE IF WE READ SOMETHING               09700000
         BC    8,ALLDONE      IF EQUAL, THE NO MORE INCLUDES            09720000
         MVC   SEARCH(17),INPUT+58     MOVE VOL INFO TO            DT0I 09730018
*                                      SEARCH AREA             O   DT0I 09740018
         OI    IEHMVV61,X'10' THIS MEANS VOL MOUNTING REQUIRED          09760000
         B     YES1                                                     09780000
ALLDONE  TM    IEHMVV61,X'08'     ANYTHING ON UT3                  7632 09800000
         BC    1,TRANSFER     IF SO ----                                09820000
IOERROUT NI    IEHMVV20+2,X'F7'   TURN OFF INC/REP BIT             7632 09840000
         NI    IEHMVV61,X'FD'     TURN OFF ERR INDICATOR BIT       7632 09860000
         LR    REG1,REG11     ADDR OF GOTTEN CORE                       09880000
         FREEMAIN  R,LV=1016,A=(1)     FREE DSECT                S20201 09900020
         IEHPOST   ,T                                                   09920000
         L     14,12(0,13)             PRESERVE REG 14 ACROSS XCTL S    09940000
         XCTL   (2,12),EP=IEHMVESN       GO TO WRAP UP                  09960000
*                                                                       09980000
*ROUTINE WILL START DOING SOME CHECKING AS TO WHERE WE STAND AS FAR AS  10000000
*UT3 IS CONCERNED                                                       10020000
*                                                                       10040000
NOREAD   TM    IEHMVV61,X'08'   ANYTHING ON SYSUT3                      10060000
         BC    1,YES1         YES                                       10080000
         B     VOLEXCP        NO,CHECK TO SEE IF ANY MORE INCLUDES      10100000
YES1     EQU   *                                                        10120000
         NI    IEHMVV61,X'DF' TURN OFF ALREADY OPEN BIT                 10140000
         TM    IEHMVV61,X'08' ANY ENTRIES ON UT3                        10160000
         BC    1,TRANSFER     TIME TO CLOSE,REINSTATE AND XCTL          10180000
         NI    IEHMVV61,X'F7' CLEAR THIS SWITH FOR NEXT RUN             10200000
         B     REPEAT         MIGHT NOT HAVE FIT THE ORIGINAL 'FROM' DS 10220000
TRANSFER L     REG2,IEHMVV40  ADDRESS OF UT1 DCB                        10240000
         LA    REG2,0(0,REG2)        CLEAR HIGH ORDER BYTE              10280000
         NI    IEHMVV61,X'F7'                                           10300000
         L     REG2,IEHMVV42  ADDRESS OF SYSUT3 DCB                     10320000
         LA    REG2,0(0,REG2)        CLEAR HIGH ORDER BYTE              10340000
         L     REG5,IEHMVV42+4   ADDRESS OF DECB FOR WRITE              10360000
         LA    REG5,0(0,REG5)      CLEAR HIGH ORDER BYTE                10380000
         WRITE (5),SF,(2),KEY,5,MF=E    WRITE MACRO                     10400000
         L     REG1,IEHMVV42+4     DECB PTR                             10420000
         CHECK (1)                                                      10440000
         MVC   IEHMVV42+8(5),8(REG2)    MOVE CCHHR TO COMM TAB          10460000
         NI    IEHMVV61,X'F7' CLEAR OUT THIS SWITCH                     10480000
         L     REG2,IEHMVV31        FROM DCB FOR REOPENING              10500000
         LA    REG2,0(0,REG2)   CLEAR HIGH ORDER BYTE                   10520000
         MVC   RENTOPEN(TAG1-OPENJ1),OPENJ1   REOPEN OUTPUT DATA SET    10540000
         L     1,IEHMVV21+4     ADDR OF TO DSNAME                       10560000
         MVC    JFCB(44),0(1)       MOVE DSNAME TO JFCB                 10580000
         L     1,IEHMVV23       ADDR OF TO VOLID                        10600000
         MVC   JFCB+118(6),4(1)      MOVE VOL ID TO JFCB                10620000
         LA    1,JFCBPTR         ADDR OF EXIT LIST                      10640000
         ST    1,36(2)         PUT IN DCB                               10660000
         OPEN  ((2)),TYPE=J,MF=(E,RENTOPEN)   THIS MAKES OPEN REENTRANT 10680000
         LR    REG1,REG11          ADDRESS OF SOME GOTTEN CORE          10700000
         FREEMAIN R,LV=1016,A=(1)  FREE CORE MAN                 YM5087 10720000
         LA    REG2,MODULNAM           ADDRESS OF MODULENAME    YA01217 10722016
         IEHPOST ,T                                             YA01217 10742016
         L     REG14,12(0,13)                                           10780000
         XCTL  (2,12),EPLOC=(2)     TRANSFER CONTROL TO MOVE/PDS        10800000
MIDABORT OI    IEHMVV20+2,X'40'   SET MID-ABORT BIT                     10860000
         IEHPOST   ,T                                                   10880000
         LA    REG2,FINAL     ENTRY POINT TO WRAP UP                    10900000
         L     REG14,12(0,13)                                           10920000
         XCTL  (2,12),EPLOC=(2)     TRANSFER CONRTOL TO WRAP-UP         10940000
MSG1     BAL   REG6,CLEAR                                               10960000
         NI    44(REG1),X'3F'          SET OFF PERM ERROR FLAGS  YM5086 10970000
         OI    IEHMVV61,X'02'     TURN ON ERROR INDICATOR          7632 10980000
         MVC   PRINT+1(72),M172   ERROR MSG. TO PRINT BUFFER       7632 11020000
         B     PRINTMSG                                         YA01217 11040016
MSG2     BAL   REG6,CLEAR                                               11080000
         MVC   PRINT+1(80),M173    ERROR MSG TO PRINT BUFFER            11120000
         MVC   PRINT+32(6),SEARCH+4 MOVE VOLUME ID TO ERROR MSG         11140000
         B     FREEDSCB                                         YA01217 11160016
MSG3     BAL   REG6,CLEAR                                               11200000
         MVC   PRINT+1(16),M174         PART OF ERROR MSG TO BUFFER     11240000
         MVC   PRINT+17(44),INPUT+6     DSNAME TO PRINT BUFFER          11260000
         MVC   PRINT+62(59),M174A       REST OF ERROR MSG TO BUFFER     11280000
         MVC   PRINT+79(6),SEARCH+4     VOL ID TO ERROR MSG             11300000
         B     FREEDSCB                                         YA01217 11320016
MSG4     BAL   REG6,CLEAR                                               11360000
         MVC   PRINT+1(16),M175         PART OF ERROR MSG TO BUFFER     11400000
         MVC   PRINT+17(44),INPUT+6     DSNAME TO PRINT BUFFER          11420000
         MVC   PRINT+62(55),M175A       REST OF ERROR MSG               11440000
         B     FREEDSCB                                         YA01217 11460016
MSG4A    BAL   REG6,CLEAR                                               11500000
         MVC   PRINT+1(92),M176         ERROR MSG TO PRINT BUFFER       11540000
         MVC   PRINT+48(7),M176A        RECORD FORMAT NOT COMPATIBLE    11560000
         B     FREEDSCB                                         YA01217 11580016
MSG5     BAL   REG6,CLEAR                                               11620000
         MVC   PRINT+1(92),M176         ERROR MSG TO RPINT BUFFER       11660000
         MVC   PRINT+48(7),M176B        BLKSIZE LARGER ON INCLUDE       11680000
         B     FREEDSCB                                         YA01217 11700016
MSG6     BAL   REG6,CLEAR                                               11740000
         MVC   PRINT+1(92),M176         ERROR MSG TO PRINT BUFFER       11780000
         MVC   PRINT+48(7),M176C        LRECL NOT EQUAL                 11800000
         B     FREEDSCB                                         YA01217 11820016
MSG7     BAL   REG6,CLEAR                                               11860000
         MVC   PRINT+1(92),M176         ERROR MSG TO PRINT BUFFER       11900000
         MVC   PRINT+48(7),M176D        KEY LENGTHS NOT EQUAL           11920000
         B     FREEDSCB                                         YA01217 11940016
MSG8     BAL   REG6,CLEAR                                               11980000
         MVC   PRINT+1(15),M180         FIRST PART OF ERROR MSG         12020000
         MVC   PRINT+16(8),INPUT+50     MEMBER NAME TO ERROR MSG        12040000
         MVC   PRINT+25(21),M180A       SECOND PART OF ERROR MSG        12060000
         MVC   PRINT+47(44),INPUT+6     DATA SET NAME TO ERROR MSG      12080000
         MVC   PRINT+92(29),M180B       THIRD PART OF ERROR MSG         12100000
         B     PRINTMSG                                         YA01217 12120016
MSG9     BAL   REG6,CLEAR                                       YA01217 12124016
         MVC   PRINT+1(L'M177),M177    ERROR MSG TO PRINT BUFFERYA01217 12128016
         MVC   PRINT+2+L'M177(44),INPUT+6 DSNAME TO PRINT BUFFERYA01217 12132016
         LA    REG2,PRINT+46+L'M177    PTR BEHIND DSNAME IN BUFFYA01217 12136016
MSG9LOOP BCTR  REG2,0                  PTR TO PREVIOUS BYTE     YA01217 12140016
         CLI   0(REG2),BLANK           CHECK FOR LAST CHAR IN   YA01217 12144016
         BE    MSG9LOOP                DSNAME.                  YA01217 12148016
         MVC   2(L'M177A,REG2),M177A   REST OF MSG TO BUFFER    YA01217 12152016
         B     FREEDSCB                                         YA01217 12156016
NOMOUNT  BAL   REG6,CLEAR                                               12160000
         MVC   PRINT+1(80),M173         ERROR MSG TO PRINT BUFFER       12200000
         MVC   PRINT+32(6),SEARCH+4  MOVE VOLUME ID TO ERROR MSG        12220000
         B     PRINTMSG                                         YA01217 12240016
CLEAR    MVI   PRINT,X'40'    MOVE A BLANK IN FIRST POS OF PRINT AREA   12280000
         MVC   PRINT+1(120),PRINT     CLEAR OUT PRINT AREA              12300000
         L     REG7,MSGCONST           SET UP BASE FOR MSG CSECTYA01217 12310016
         BR    REG6       GO TO APPROPRIATE MSG RTN                     12320000
FREEDSCB L     REG1,LIST+12            GET ADDRESS OF GETMAIN   YA01217 12326016
         FREEMAIN R,LV=500,A=(1)       FREE CORE GOTTEN FOR DSCBYA01217 12332016
PRINTMSG ST    REG3,IEHMVV00+128       SAVE REG 3                       12340000
         LA    REG3,PRINT              LOAD ADDR OF PRINT AREA          12360000
         LINK EP=IEHMVESU              GO TO MSG WTR                    12380000
         L     REG3,IEHMVV00+128        RESTORE REG 3                   12400000
         B     *+4(REG15)      INTERPRET THE ERROR RETURNS IF ANY       12420000
         B     SETEXCP                 NO ERRORS                YA01217 12440016
         B     MIDABORT        PERM ERROR ON SYSPRINT                   12460000
         DS    0F                                               YA01217 12470016
UPTTR    DC    X'00000100'         TO UP TTR                            12480000
JFCBPTR  DC    X'87'                    OPENJ                           12500000
         DC    AL3(JFCB)                POINTER TO MY JFCB              12520000
FORBLDL  DC    X'0001004A'         PUT IN PREFACE ONCE                  12540000
POINT    DC    X'00000100'          USED TO POINT TO BEG OF UT3         12580000
M176A    DC    C' RECFM '                                       YA01217 12600016
M176B    DC    C'BLKSIZE'                                               12620000
M176C    DC    C' LRECL '                                       YA01217 12640016
M176D    DC    C'KEYLGTH'                                               12660000
FAKEDCB  DC    22F'0'              WHERE PRE-OPEND DCB IS BUILT         12680000
JFCB     DS    44F      USED FOR JFCB IN OPENJ                          12700000
FILETYPE DC    X'0200'             SIGNIFIES A PDS                      12720000
ZEROS    DC    5F'0'               CONSTANT OF ZEROS                    12740000
LENGTH44 DC    H'44'                   LENGTH OF DATA SET NAME  YA01217 12750016
MACRF    DC    X'2400'             SIGNIFIES A REA                      12760000
EODADDR  DC    A(NOREAD)           MY EOD ADDRESS                       12800000
EXITLST  DC    A(JFCBPTR)          ADDCON FOR OPEN WHEN DOING AN OPENJ  12820000
MSGCONST DC    A(MESSAGES)                                              12840000
OPENJ    OPEN  (,(INPUT)),MF=L                                          12860000
TAG      DS    F           TO BE ABLE TO GET CORRECT BYTES IN OPEN      12880000
OPENJ1   OPEN  (,(OUTPUT)),MF=L        PART OF RE-                      12900000
TAG1     DS    F                       ENTRANT OPEN                     12920000
*                                                                       12940000
*CHANNEL PROGRAM THAT SEARCHES THE SYSUT1 FILE FOR ANY MORE INCLUDES    12960000
*IF ANY EXIST THEN VOLUME INFORMATION IS PICKED UP FOR THE NEXT ENTRY   12980000
*INTO THE PROGRAM. THIS CODE WILL BE DUMPED IN GOTTEN CORE SO IT CAN BE 13000000
*REENTRANT.                                                             13020000
*                                                                       13040000
         DS    0D                                                       13060000
MYCHNLPG DC    X'31'               SEARCH ID EQUAL                      13080000
         DC    AL3(0)             ID OF FIRST SYSUT1 REC         S20201 13100020
         DC    X'40000005'                                              13120000
         DC    X'08'                                                    13140000
         DC    AL3(0)             TO SIDEQ                       S20201 13160020
         DC    X'40000001'                                              13180000
         DC    X'B1'               SEARCH ID EQUAL WITH M/T BIT SET     13200000
         DC    AL3(0)             ID OF LAST SYSUT1 REC          S20201 13220020
         DC    X'40000005'                                              13240000
         DC    X'08'                                                    13260000
         DC    AL3(0)             TO SEARCH KEY HIGHER THAN 0000 S20201 13280020
         DC    X'40000001'                                              13300000
         DC    X'03'                                                    13320000
         DC    X'000000'           NOP,HIT THE LAST RECORD              13340000
         DC    X'00000001'                                              13360000
         DC    X'C9'               SEARCH KEY HIGH WITH M/T BIT SET     13380000
         DC    AL3(0)             FOR NON-ZERO-ED KEY            S20201 13400020
         DC    X'60000011'        OF 17 BYTES VOL INFO           S20201 13420020
         DC    X'08'                                                    13440000
         DC    AL3(0)             TO SIDEQ FOR END OF UT1        S20201 13460020
         DC    X'40000001'                                              13480000
         DC    X'06'                                                    13500000
         DC    AL3(0)             READ DATA INTO INPUT AREA      S20201 13520020
         DC    X'00000053'                                         DT0I 13540018
         DC    X'31'               SEARCH ID EQUAL                      13580000
         DC    AL3(0)             OF FIRST SYSUT1 REC            S20201 13600020
         DC    X'40000005'                                              13620000
         DC    X'08'                                                    13640000
         DC    AL3(0)             TIC TO SIDEQ                   S20201 13660020
         DC    X'40000001'                                              13680000
         DC    X'B1'                                                    13700000
         DC    AL3(0)             ID OF LAST UT1 REC             S20201 13720020
         DC    X'40000005'                                              13740000
         DC    X'08'                                                    13760000
         DC    AL3(0)             TIC TO LOOK FOR MATCHING KEY   S20201 13780020
         DC    X'40000001'                                              13800000
         DC    X'03'                                                    13820000
         DC    X'000000'           NO OPERATION,STOPS THE COMMAND CHAIN 13840000
         DC    X'00000001'                                              13860000
         DC    X'29'                                                    13880000
         DC    AL3(0)             SEARCH MATCHING KEY            S20201 13900020
         DC    X'60000011'        OF 17 BYTES VOL INFO           S20201 13920020
         DC    X'08'                                                    13940000
         DC    AL3(0)             TIC TO LOOK FOR END OF UT1     S20201 13960020
         DC    X'40000001'                                              13980000
         DC    X'06'                                                    14000000
         DC    AL3(0)             READ INTO INPUT                S20201 14020020
         DC    X'40000053'                                         DT0I 14040018
         DC    X'08'                   TIC TO NEXT INSTRUCTION   S20201 14045020
         DC    AL3(0)                  OR TO READ SECTOR IF      S20201 14050020
         DC    X'40000001'             RPS DEVICE                S20201 14055020
         DC    X'31'                                                    14060000
         DC    AL3(0)             SIDEQ OF RECORD JUST READ      S20201 14080020
         DC    X'40000005'                                              14100000
         DC    X'08'                                                    14120000
         DC    X'000000'                                                14140000
         DC    X'00000001'                                              14160000
         DC    X'0D'                                                    14180000
         DC    AL3(0)             CLOBBER KEY OF REC JUST READ   S20201 14200020
         DC    X'20000011'                                              14220000
         DC    X'23'                   SET SECTOR TO 0           S20201 14220920
         DC    AL3(0)                                            S20201 14221820
         DC    X'40000001'                                       S20201 14222720
         DC    X'08'                   TIC TO CCWVOL             S20201 14223620
         DC    AL3(0)                                            S20201 14224520
         DC    X'40000001'                                       S20201 14225420
         DC    X'23'                   SET SECTOR TO 0           S20201 14226320
         DC    AL3(0)                                            S20201 14227220
         DC    X'40000001'                                       S20201 14228120
         DC    X'08'                   TIC TO CHANPROG           S20201 14229020
         DC    AL3(0)                                            S20201 14229920
         DC    X'40000001'                                       S20201 14230820
         DC    X'22'                   READ SECTOR VALUE INTO    S20201 14231720
         DC    AL3(0)                  'SECTOR'                  S20201 14232620
         DC    X'40000001'                                       S20201 14233520
         DC    X'23'                   SET SECTOR TO THE VALUE   S20201 14234420
         DC    AL3(0)                  IN 'SECTOR'               S20201 14235320
         DC    X'40000001'                                       S20201 14236220
         DC    X'08'                   TIC BACK TO REGULAR CCWS  S20201 14237120
         DC    AL3(0)                                            S20201 14238020
         DC    X'40000001'                                       S20201 14238920
FINAL    DC    C'IEHMVESN'                                              14260000
MODULNAM DC    CL6'IEHMVE'             1ST PART OF MODULE NAME  YA01217 14270016
MODULEND DS    CL2                     2ND PART OF MODULE NAME  YA01217 14270916
TJ       DC    CL2'TJ'                 END FOR MODULE IEHMVETJ  YA01217 14271816
SM       DC    CL2'SM'                 END FOR MODULE IEHMVESM  YA01217 14272716
SL       DC    CL2'SL'                 END OF MODULE IEHMVESL   YA01217 14273616
TORECFM  DS    C                   WORK COPY OF TO-DS RECFM    @ZA01247 14274502
INCRECFM DS    C                   WORK-COPY OF INC/REP-DS RECFMYA01217 14275416
SAVRECFM DS    C                       SAVE 'TO' DCB RECFM     @ZA01247 14276302
SAVLRECL DS    CL2                                   LRECL      YA01217 14277216
SAVBLKSI DS    CL2                                   BLKSIZE    YA01217 14278116
SAVKEYLE DS    C                                     KEYLEN     YA01217 14279016
*                                                                       14280000
* THE FOLLOWING CSECT IS FOR ALL ERROR MESSAGES TO BE CONTAINED IN      14300000
* THIS LOAD MODULE.  IT ALSO CONTAINS THE ERROR CODES WHICH PRECEDE     14320000
* EACH MESSAGE.                                                         14340000
*                                                                       14360000
MESSAGES CSECT                                                          14380000
M172     DC    CL8'IEH372I '                                            14400000
         DC    CL32'I/O ERROR IN WORK FILE. SOME SUB'              7632 14420000
         DC    CL32'ORDINATE REQUESTS MAY BE IGNORED'              7632 14440000
M173     DC    CL8'IEH373I '                                            14460000
         DC    CL32'UNABLE TO MOUNT VOLUME XXXXXX. S'                   14480000
         DC    CL32'OME INCLUDE OR REPLACE REQUESTS '                   14500000
         DC    CL8'IGNORED.'                                            14520000
M174     DC    CL8'IEH374I '                                            14540000
         DC    CL8'DATASET '                                            14560000
M174A    DC    CL29'NOT FOUND ON VOL XXXXXX. INCL'                      14580000
         DC    CL30'UDE OR REPLACE REQUEST IGNORED'                     14600000
M175     DC    CL8'IEH375I '                                            14620000
         DC    CL8'DATASET '                                            14640000
M175A    DC    CL32'IS NOT PARTITIONED. INCLUDE OR R'                   14660000
         DC    CL23'EPLACE REQUEST IGNORED.'                            14680000
M176     DC    CL8'IEH376I '                                            14700000
         DC    CL32'RECORD CHARACTERISTICS NOT COMPA'                   14720000
         DC    CL32'TIBLE (       ). INCLUDE OR REPL'                   14740000
         DC    CL20'ACE REQUEST IGNORED.'                               14760000
M177     DS    0CL16                                            YA01217 14762016
         DC    CL8'IEH377I '                                    YA01217 14764016
         DC    CL8'DATA SET'                                    YA01217 14766016
M177A    DS    0CL58                                            YA01217 14768016
         DC    CL33'REQUIRES TRACK OVERFLOW FEATURE. '          YA01217 14770016
         DC    CL25'INCL/REPL REQUEST IGNORED'                  YA01217 14772016
M180     DC    CL8'IEH380I '                                            14780000
         DC    CL7'MEMBER '                                             14800000
M180A    DC    CL21'NOT FOUND IN DATASET '                              14820000
M180B    DC    CL29'INCLUDE REPLACE REQUEST IGNRD'                      14840000
*                                                                       14860000
* ANOTHER DSECT THAT I GET CORE FOR                                     14880000
*                                                                       14900000
CORE     DSECT      REG 11 USED AS A BASE                               14920000
KEY      DS    F       KEY PORTION OF OUTPUT REC                        14940000
CCHHR    DS    FL5       STUCK IN TO SCRATCH USED RECDS                 14960000
DATA     DS    FL3        START OF DATA PORTION                         14980000
         DS    22F     REMAINING DATA PORTION AND RENAME FIELD          15000000
FIRST    DS    FL5                 CCHHR OF RECORD PRIOR TO BEGINNING   15020000
VOLLIST  DS    5F                  USED BY VOLUME MOUNT ROUTINE         15040000
SAVEREG  DS    16F       TO SAVE REGS                                   15060000
LIST     DS    4F        LIST AREA FOR OBTAIN                           15080000
PREFACE  DS    1F        1 WORD HDR FOR BLDL                            15100000
BLDL     DS    19F    AREA FOR BLDL                                     15120000
DSNAME   DS    11F       44 BYTE DATA SET NAME IN UT1 REC               15140000
PRINT    DS    31F      PRINT BUFFER FOR MSG WRITER                     15160000
*                                                                       15180000
*THE IOB I USE WHEN EXECUTING MY CHANNEL PROGRAM                        15200000
*                                                                       15220000
         DS    0D                  FORCE TO A DOUBLE WORD  BOUNDRY      15240000
IOB      DS    1F                  FLAGS AND STATUS BYTES               15260000
         DS    1F                  PTR TO YOUR EVENT CONTROL BLK (ECB)  15280000
IOBCSW   DS    2F                  CSW POSTED HERE                      15300000
START    DS    1F                  PTR TO MY CHANNEL PROGRAM            15320000
DCBADR   DS    1F                  ADDRESS OF DCB ASSOCIATED WITH CHAN  15340000
         DS    2F                                                       15360000
MBBCCHHR DS    2F                  ADDRESS USED TO SEEK BY IOS          15380000
ECB      DS    1F                  EVENT CONTROL BLOCK FOR MY EXCP      15400000
SECTOR   DS    F                     FIRST BYTE FOR SECTOR VALUE S20201 15410020
CCWVOL   DS    2D                  WHERE                                15420000
ANTHRSRC DS    6F                   MY REENTRANT                        15440000
KEYNZERO DS    6F                    CHANNEL                            15460000
CHANPROG DS    4F                     PROGRAM                           15480000
CCWSRCH  DS    6F                      WILL BE                          15500000
SRCHKEY  DS    6F                          CONSTRUCTED                  15520000
TIC      DS    2F                      DUMMY TIC                 S20201 15530020
ZEROOUT  DS    6F                                                       15540000
RPSCCW   DS    4F                      SET SECTOR AND TIC        S20201 15545020
RPSCHAN  DS    4F                      SET SECTOR AND TIC        S20201 15550020
READSEC  DS    6F                      READ,SET SECTOR AND TIC   S20201 15555020
RENTOPEN DS    6F        WHERE REENTRANT OPEN GOES                      15560000
*                                                                       15580000
*DSECT FOR A CHUNK OF PERM WK AREA                                      15600000
*                                                                       15620000
GETCORE  DSECT      REG 9 USED AS A BASE                                15640000
HOLDTTR  DS    1F        TTR OF BEG OF SYSUT 1                          15660000
SEARCH   DS    5F   DEV TYPE,VOLID,SEQ NO, UNIT                    DT0I 15680018
IOBADDR  DS    1F        ADDR OF OLD IOB IN UT1 DCB                     15700000
EODAD    DS    1F        ADDR OF OLD EOD IN UT1 DCB                     15720000
DDNAME   DS    2F                  DDNAME TO BE REINSTATED              15740000
INPUT    DS    21F     UT1 READ IN AREA                                 15760000
*                                                                S20201 15761020
** DSECT TO DESCRIBE DEVICE CHARACTERISTICS TABLE ************** S20201 15762020
*                                                                S20201 15763020
UNITABLE DSECT                                                   S20201 15764020
UNITSICC DS    H                                                 S20201 15765020
UNITSIHH DS    H                                                 S20201 15766020
UNITTRLN DS    H                                                 S20201 15767020
UNITOVHI DS    CL1                                               S20201 15768020
UNITOVHL DS    CL1                                               S20201 15769020
UNITOVHK DS    CL1                                               S20201 15770020
UNITFLAG DS    CL1                                               S20201 15771020
UNITTOLR DS    CL1                                               S20201 15772020
*                                                                S20201 15773020
**  DSECT TO DESCRIBE THE DCB ***********************************S20201 15774020
*                                                                S20201 15775020
         DCBD  DSORG=PS,DEVD=DA                                  S20201 15776020
         EJECT                                                  YA01217 15776616
DSCBDSEC DSECT                                                  YA01217 15777216
         SPACE 1                                                YA01217 15777816
         IECSDSL1 (1)                                           YA01217 15778416
         SPACE 2                                                YA01217 15779016
         IEHMVV                                                         15780000
         END                                                            15800000
