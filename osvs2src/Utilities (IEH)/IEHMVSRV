 TITLE 'IEHMVSRV-IEHMOVE COPY-UNLOAD-LOAD-ABORT ROUTINE'          10943 00020014
*FUNCTION/OPERATION: THIS MODULE DETERMINES IF THE DATA SET UNDER     * 00040000
*CONSIDERATION CAN BE MOVED OR UNLOADED OR NEITHER.                   * 00060002
*ENTRY POINTS: IEHMVESV                                               * 00100000
*INPUT: NONE                                                          * 00120000
*OUTPUT: SWITCH SETTINGS IN MOVE/COPY COMMUNICATIONS TABLE            * 00140000
*EXTERNAL ROUTINES: NONE                                              * 00160000
*EXITS-NORMAL RETURN TO CALLING ROUTINE-IEHMVSRZ                      * 00180000
*ERRORS I/O ERROR; SECURITY DATA SET IN DSGROUP; BDAM UNMOVEABLE      * 00200000
*TRACK OVERFLOW ERRORS  MORE THAN 5 VOLUMES                             00220000
*DATA SET                                                             * 00240000
*MESSAGES: MESSAGES WHICH CAN BE PRINTED DUE TO TESTS IN THIS MODULE *  00240515
*          ARE THESE:                                                *  00241015
*                                                                    *  00241515
*   DATA SET -                                                       *  00242015
*              UNLOADED BECAUSE -                                    *  00242515
*                                 I/O ERROR ON FROM VOLUME           *  00243015
*                                                                    *  00243515
*                                 SECURITY PROTECTED                 *  00244015
*                                                                    *  00244515
*                                 DATA SET MARKED UNMOVEABLE         *  00245015
*                                                                    *  00245515
*                                                                    *  00246015
*                                                                    *  00246515
*              NOT MOVED/COPIED BECAUSE -                            *  00247015
*                                    ACCESS METHOD NOT COMPATIBLE    *  00247515
*                                                                    *  00248015
*                                    RECORD LENGTH NOT COMPATIBLE    *  00248515
*                                                                    *  00249015
*                                    DATA SET MARKED UNMOVEABLE      *  00249515
*                                                                    *  00250015
*                                    SUBORDINATE REQUEST WHILE LOADING  00250515
*                                                                    *  00251015
*                                                                    *  00251515
*                                                                    *  00252015
*                                                                    *  00254515
*   IEH450I REQUEST TERMINATED BECAUSE DATA SET SPANS MORE THAN 5 VOL.  00255015
*                                                                    *  00255515
*   TRACK OVERFLOW FEATURE REQUESTED/REQUIRED ON DEVICE THAT DOES    *  00256015
*   NOT HAVE TRACK OVERFLOW                                          *  00256515
*                                                                    *  00257015
****    ****    ****    ****    ****    ****    ****    ****    ****    00257515
*TABLES/WORK AREAS: NONE                                              * 00260000
*ATTRIBUTES: REUSEABLE                                                * 00280000
*  NOTES  THIS MODULE IS PART OF LOAD MODULE  IEHMVESX                  00300000
*        THIS MODULE TEST FOR TRACK OVERFLOW FEATURE USED/REQUESTED     00320000
*        AND IN THE UNIT BEFORE A DECISION IS MADE TO UNLOAD    YA01696 00340002
IEHMVSRV CSECT                                                  YA01696 00341002
*C040700                                                       @ZA28978 00341299
*A100496                                                       @ZA24602 00342899
*D027500-027520,027540-027560                                  @ZA13732 00343099
*A023100-023120                                                @ZA13711 00343700
*A088300-088780                                                @ZA04396 00347103
*D088300-088850                                                @ZA04396 00349803
*A090460-090520                                                @ZA03378 00352503
*C030000                                                       @ZA01733 00355203
*D 032930-032960                                               @ZA01656 00357902
*A032930-032940                                                @ZA01239 00360602
*A027500-027560                                                @ZA01234 00363302
*D027500-027600,139700-139720,147500                           @ZA01234 00366002
*A028200-028600                                                 YA01696 00368702
*D028200-028600                                                         00371402
*A032940                                                        YA01671 00374102
*C102100,105600,106000                                          YA01218 00376802
*                                                                       00379502
*                                                                       00382202
*                                                                       00384902
*                                                                       00387602
*A083620-083720                                                 OY01193 00390302
*D100000-100200,C100220,A100530                                  A50960 00393002
*A100244,100248                                                  A48802 00395722
*C100300                                                         A48802 00398422
*065400                                                          A45188 00401122
*A103300-103388,132900                                           A45144 00403822
*A080600,D085400,A085500,D085600-085800,086400,A086500           A37919 00406522
* 006400-007000,008000-008400                                    A44302 00409222
* 027800                                                         A32041 00411922
*                                                                A32032 00414622
* 112000-112800,119400-120000                                    A30084 00417319
*                                                                A29052 00420019
*088400,088800-089000,089250-089300                              A25286 00460119
* 045250,046000,046200-048400,146250                             A25631 00460219
*                                                                A22664 00460518
* 114000-116600,117600-119200,120200-120800                      A17911 00461018
*                                                                A17911 00462018
* 059400,089400                                                  A21645 00463018
*                                                                A21645 00464018
*  042600-043800                                                 A35460 00464520
*A040700,040720,134900                                           A35460 00464921
*                                                                  UL0H 00465017
*0055 004000,025000,025400-026000,066200,146800                    UL0H 00470017
*                                                                  UL0H 00475017
*                                                                  0310 00477002
*0055  110800-111800                                               0310 00479002
*                                                                  0310 00479402
*C600,12000,16000                                               YL026VC 00479802
*D800,2525-2540,10220,10380,12200-12400,12800-13400,67200-69200 YL026VC 00479902
*D70130-70160,123200-131600,132200-132600,133000                YL026VC 00481602
*A27500-27580,139700-139720,147500                              YM07033 00483602
*C27600                                                         YM07033 00484002
*A39100                                                         YM06314 00484402
*A010220-010284,013100-013200,067100-067400                    @Z40CSJH 00484804
*A070120-070140,083620-083680,123100-123400                    @Z40CSJH 00484904
*A130600,131000,132683-132787,133000                           @Z40CSJH 00489904
IEHMVESV SAVE  (14,12),T,IEHMVSRV-OZ28978                      @ZA28978 00495099
         ENTRY IEHMVESV                                                 00500000
         LR    BASE,LINK                                                00520000
         USING IEHMVV,MCTABLE                                           00540000
         USING DSCBDSEC,DSCB                                            00560000
         USING IEHMVESV,BASE                                            00580000
         IEHPRE (14,1),TFC                                              00600000
         USING IEHMVV,MCTABLE                                           00620000
* OBTAIN FROM AND TO DEVICE TYPE CODES                           A44302 00630021
          STM  DEV14,DEV1,DEVSAVE                                       00720000
         L     DEV14,IEHMVV30+12   ADDRESS OF FROM DDNAME.              00740000
         LA    DEV1,0(0,DEV14)                                          00760000
         DEVTYPE (1),DEVT1         OBTAIN  UCB DEVICE TYPE.   (FROM)    00780000
         L     DEV14,IEHMVV31+8    RETRIEVE ADDRESS  OF  TO  DDNAME.    00860000
         LA    DEV1,0(0,DEV14)                                          00880000
         DEVTYPE  (1),DEVT2        OBTAIN UCB DEVICE TYPE    (TO)       00900000
IEHMVRSA LM    DEV14,DEV1,DEVSAVE                                       00920000
*                                       TEST SECURITY ROUTINE           00940000
         B     IEHMVESM                                                 00960000
IEHMVRSM DS  0H                   LOAD TEST ROUTINE                     00980000
         B     IEHMVERH                                                 01000000
IEHMVRRH DS  0H                   ACCESS METHOD TEST                    01020000
**********************************************************************  01022004
*                                                                       01022404
* LINES 010300-010396 WERE REACTIVATED IN                      @Z40CSJH 01024004
* SUPPORT OF THE EXTENDED MVS CVOL FUNCTION                    @Z40CSJH 01026004
*                                                                       01028004
**********************************************************************  01028404
         TM    IEHMVV20,CATALOG+FROM IS UNLOADED CATALOG EXPECTED 10943 01030004
         BC    14,IEHMVESW             NO, BRANCH                 10943 01032004
         TM    IEHMVV20+1,LOAD         HAS LOAD CONDITION BEEN SET10943 01034004
         BO    IEHMVESW                YES, BRANCH                10943 01036004
*                                      NO, WRITE ERROR MSG        10943 01038004
         MVI   IEHMVV61,FROMERR        MSG NUMBER                 10943 01038404
         L     LINK,PREAB              SET UP TO PREABORT         10943 01038804
         BR    LINK                                               10943 01039204
*                                                                 10943 01039604
         B     IEHMVESW                                                 01040000
IEHMVRSW DS  0H                                                         01060000
*                                                                       01080000
         TM    IEHMVV20+1,UNLOAD        UNLOAD CONDITION                01100000
         BO    IEHMVRTE           YES,SKIP TEST RECORD LENGTH           01120000
*                                                                       01140000
*                                       RECORD LENGTH TEST              01160000
         B     IEHMVETE                                                 01180000
IEHMVRTE DS  0H                   CHECK FOR LOAD CONDITION      YL026VC 01200002
*                                                                       01260000
         TM    IEHMVV20+1,CATLG    CATALOG REQUEST             @Z40CSJH 01310004
         BO    YESCATLG            YES                         @Z40CSJH 01320004
RTNCATLG DS  0H                   CHECK FOR LOAD CONDITION              01330004
*                                                                       01340004
         TM    IEHMVV20+1,LOAD          IS THIS A LOAD CONDITION        01360000
         BO    IEHMVESL           YES,GO TO UNMOVEABLE TEST             01380000
         L     ACCE,IEHMVV22+4                                          01400000
         CLI   2(ACCE),DASD             FROM DEVICE DASD                01420000
         BNE   IEHMVRSL           NO,OMIT UNMOVEABLE TEST               01440000
*                                                                       01460000
*                                       UNMOVEABLE TEST                 01480000
         B     IEHMVESL                                                 01500000
IEHMVRSL DS  0H                   PREPARE TO LEAVE ROUTINE              01520000
*                                                                       01540000
        IEHPOST (14,1),TC                                               01560000
*                                                                       01580000
         MVC   12(4,SAVE),MNOP    SET RETURN TO COPYRTN IN IEHMVSRZ     01600002
         RETURN (14,12),T                                               01620000
GOOUT    L     LINK,PREAB                                               01640000
         BR    LINK                                                     01660000
*                                                                       01680000
*                                                                       01700000
MNOP     DC    A(COPYRTN)                                               01720000
         EXTRN COPYRTN                                                  01740000
         EJECT                                                          01760000
*                                                                       01780000
IEHMVERH DS  0H     THIS IS A LOAD TEST ROUTINE. IF PHYSICAL SEQUENTIAL 01800000
*                   ORGANIZATION, A JFCB IS READ AND THE DATA SET IS    01820000
*                    OPENED. A TEST IS MADE FOR UNLOADED DATA SET OR    01840000
*                   THE DSCB IS FILLED                                  01860000
*                   NORMAL EXIT IS TO IEHVESW                           01880000
         L     ACCE,IEHMVV22+4          FROM DEVICE DASD                01900000
         CLI   2(ACCE),DASD                                             01920000
         BNE   LTOPEN                   NO, GO TO OPEN DATA SET         01940000
*                                                                       01960000
*                                       YES, TEST ACCESS METHOD         01980000
         L     DSCB,IEHMVV30+8          GET DSCB POINTER                02000000
         CLI   DS1DSORG,BSAM            DSORG EQUAL PHYSICAL SEQ.       02020000
         BE    LTOPEN                                                   02040000
*                                                                       02060000
         CLI   DS1DSORG,AZERO     NO,TEST FOR NO ORGANIZATION GIVEN     02080000
         BE    LTOPEN             YES,BRANCH TO OPEN                    02100000
*                                                                       02120000
*                                                                       02140000
LTRETURN DS  0H                   BRANCH TO ACCESS METHOD TEST          02160000
*                                                                       02180000
         B     IEHMVRRH                                                 02200000
*                                                                       02220000
*                                                                       02240000
*                                                                       02260000
*                                                                       02280000
LTOPEN   DS  0H                   OPEN J                                02300000
         TM    IEHMVV20+5,X'40'        UNLOAD REQUEST          @ZA13711 02310099
         BO    IEHMVRRH                YES,BRANCH              @ZA13711 02312099
         L     ACCE,IEHMVV10            GET PTR TO PER WORK AREA        02320000
         LA    ACCO,96(ACCE)            UP PTR                          02340000
         ST    ACCO,IEHMVV10            YES, CONTINUE, STORE PER WORK   02360000
         ST    ACCE,IEHMVV30            STORE DCB PTR                   02380000
         L     ACCO,LENGTHDC            MOVE DCB                        02400000
         EX    ACCO,MOVELT                                              02420000
         LR    M7,ACCE                                                  02440000
         ST    M7,IEHMVV30              SET UP FROM DCB POINTER         02460000
         L     M5,IEHMVV30+12                                           02480000
         LA    ACCE,IEHMVV70                                       UL0H 02500017
         ST    ACCE,DCBEXLST-IHADCB(0,M7)    EXIT LIST POINTER          02520000
         LA    ACCE,IEHMVV00                                            02540000
         ST    ACCE,UDCBJFCB           SET UP JFCB POINTER         UL0H 02550017
         MVI   UDCBJFCB,X'87'          FLAG AS JFCB DCBEXLST ENTRY UL0H 02560017
         MVC   UDCBDCBE(4),DCBXX       SET UP DCB ENTRY IN EXLIST  UL0H 02570017
         MVC   UDCBIHLE(4),ADIHLR      SET UP INPUT HDR LBL RTN    UL0H 02580017
         MVI   UDCBIHLE,ACTIVIHL       ENTRY IN DCB EXLIST         UL0H 02590017
         TM    IEHMVV20+3,FRDDKEY FROMDD KEYWORD                        02620000
         BO    FROMDD              YES                                  02640000
*                                                                       02660000
*                                                                       02680000
         MVI   IEHMVV00,AZERO     ZERO AREA FOR JFCB IN WORK AREA       02700000
         MVC   IEHMVV00+1(175),IEHMVV00                                 02720000
         MVI   JFCBLTYP,LABEL     INDICATE LABELED TAPE                 02740000
         MVI   JFCBIND2,X'40'    SET DISP OLD                  @ZA01234 02753002
FROMBACK EQU   *                                                        02763020
         TM    JFCBLTYP,SL             STANDARD LABEL                   02766020
         BNO   FDSN               *B IF NO-USE EXISTING RECFM    A32041 02769020
*                                                        BLKSIZE A32041 02772020
*                                                        LRECL   A32041 02775020
         XC    JFCRECFM(1),JFCRECFM  ELSE ZERO JFCB FIELDS SO    A32041 02778020
         XC    JFCDSORG(1),JFCDSORG         DCB FIELDS WILL      A32041 02781020
         XC    JFCBLKSI(2),JFCBLKSI         BE FILLED FROM THE   A32041 02784020
         XC    JFCLRECL(2),JFCLRECL         STANDARD LABEL       A32041 02787020
*                                                                A32041 02790020
FDSN     L     ACCE,IEHMVV21      RETURN FROM USING FROMDD       A32041 02793020
         MVC   JFCBDSNM(44),0(ACCE)     SET UP DSNAME                   02800000
         TM    IEHMVV20+3,FRDDKEY      FROMDD KEYWORD           YA01696 02820002
         BO    FROMDD1                 YES KEEP DDNAME IN DCB   YA01696 02830002
         L     ACCE,IEHMVV30+12        FROM DDNAME ADDRESS      YA01696 02840002
         MVC   DCBDDNAM-IHADCB(8,M7),0(ACCE) PUT DDNAME IN DCB  YA01696 02850002
FROMDD1  MVI   JFCBELNM,BLANK          PUT IN ELEMENT NAME      YA01696 02860002
         MVC   JFCBELNM+1(7),JFCBELNM                                   02880015
*                                                                       02900000
*                                                                       02920000
         LA    M6,JFCBVOLS         POINTER TO JFCB VOL LIST             02940000
         SR    ACCO,ACCO                                                02960000
         IC    ACCO,IEHMVV22       COUNT OF VOL IDS                     02980000
         LA    M5,6                MAX COUNT OF 5 VOL IDS      @ZA01733 03000003
         L     ACCE,IEHMVV22       POIHTER TO VOL LIST                  03020000
         MVC   JFCBFLSQ(2),10(ACCE)                                     03040000
VOLIDLP  DS  0H                                                         03060000
         MVC   0(6,M6),4(ACCE)   MOVE VOL ID                            03080000
         LA    M6,6(0,M6)          UP JFCB POINTER                      03100000
         LA    ACCE,17(0,ACCE)     UP FROM VOL POINTER           A32032 03120020
         BCT   M5,NVOLIDS          MOVED 5 VOL IDS                      03140000
         MVI   IEHMVV61,NONTOF    MORE THAN FIVE VOLUMES SET UP MSG     03160000
         L     LINK,PREAB                                               03180000
         BR    LINK                                                     03200000
NVOLIDS  BCT  ACCO,VOLIDLP         MOVED ALL OF THE  VOL IDS            03220000
         MVC   JFCBNVOL(1),IEHMVV22                                     03240000
         MVI   0(M6),BLANK                                              03260000
FDDRTN   DS  0H                   OPEN - FROM DCB                       03280000
         MVC   JFCBDSNM+53(3),IEHMVV82   PUT TTR IN JFCB         S21042 03290021
         XC    IEHMVV82(3),IEHMVV82    AFTER IT, CLEAR           S21042 03292021
         OPEN  ((M7),(INPUT)),TYPE=J                                    03300000
         OI    IEHMVV10-4,OK      INDICATE FROM DCB OPENED              03320000
         CLI   IEHMVV10-5,AZERO   BRANCH IF OPEN SUCCESSFUL             03340000
         BE    NOMSS                                                    03360015
         IC    ACCE,IEHMVV61                                            03380000
         MVC   IEHMVV61(1),IEHMVV10-5                                   03400000
         L    LINK,GOTOMESS                                             03420015
         BALR  RETURN,LINK                                              03440015
         STC   ACCE,IEHMVV61                                            03460000
NOMSS    DS    0H                                                  UL0H 03466017
         CLI   IEHMVV74+4,X'FF'         I/O ERR IN U.L. EXIT RTN   UL0H 03472017
         BE    IOERRMSG                 YES, TELL USER             UL0H 03478017
ERMSGRET DS    0H                                                  UL0H 03484017
*                                       TEST FOR UNLOADED DATA SET UL0H 03490017
*                                                                       03500000
         L     M5,IEHMVV22                                              03520015
         CLI   2(M5),UNITRCD            IS THIS UNIT RECORD             03540000
         BNE   AAAAKK                                                   03560000
         LA    ACCO,80                                                  03580000
         B     LTCON                                                    03600000
AAAAKK   DS  0H                                                         03620000
         LA    ACCO,80            INITIALIZE REG. 3 TO DECIMAL 80  8952 03624013
         L     ACCE,IEHMVV22      PTR. TO FROM LIST                8952 03628013
         TM    2(ACCE),UNITRCD    IS DEVICE UNIT RECORD?           8952 03632013
         BO    LTCON              IF YES, SET TO READ FIRST RECORD 8952 03636013
         L     ACCE,IEHMVV30                                            03640000
         CH    ACCO,DCBLRECL-IHADCB(0,ACCE)                             03680000
         BNE   NOLT                     NO, STOP LOAD TEST              03700000
         CLI   2(M5),TAPE              TEST FOR FROM DEVICE TAPE        03720000
         BE    PATCH                   SKIP KEYLENTGH TEST              03740000
         CLI   DCBKEYLE-IHADCB(ACCE),AZERO   TEST KEY LENGTH            03760000
         BNE   NOLT                    NO LOAD                          03780000
PATCH    LA    ACCO,800          GET SET TO TEST FOR BLKSIZ OF 800 8952 03820013
         CH    ACCO,DCBBLKSI-IHADCB(0,ACCE)  BLOCKSIZE EQUAL TO 800     03860000
         BNE   NOLT                                                     03880000
LTCON    DS  0H                                                         03900000
         LR    ACCE,ACCO          SET BLOCKSIZE                 YM06314 03910002
         LR    ZERO,ACCO          GET BLOCK LENGTH                      03920000
         GETMAIN R,LV=(0)               GET CORE                        03940000
         L     M5,IEHMVV30+4            GET DECB POINTER                03960000
         OI    IEHMVV30+4,OK      TURN ON BUFFER BIT                    03980000
*                                                                       04000000
         L     M7,IEHMVV30              DCB PTR                         04020000
         LA    ACCO,NOLT                                                04040000
         ST    ACCO,DCBEODAD-IHADCB(0,M7)  ADDRESS OF END OF DATA ROUT. 04060000
         MVC   DCBSYNAD+1-IHADCB(3,M7),SYNADRTN                @ZA28978 04070099
*                                       SYNADRTN - MSG I/O ERR   A35460 04072021
         LR    ACCO,1                                                   04080000
         READ  (M5),SF,(M7),(ACCO),(ACCE),MF=E                          04100000
*                                       READ THE FIRST RECORD           04120000
*                                                                       04140000
         LR    PARAM,M5           GET ADDRESS OF DECB                   04160000
         CHECK (1)                      CHECK THE READ                  04180000
         L     PARAM,12(PARAM)    GET IO AREA                           04200000
*  CHECK FIRST RECORD WRITTEN BY IEHMVSSY FOR AN UNLOADED DATA SET      04220000
         L     ACCE,LDRC                                                04240000
         CLC   2(78,PARAM),0(ACCE)   FIRST RECORD OF UNLOADED    A35460 04250020
*                                    DATA SET?                   A35460 04260020
         BE    UNLDPROC              GO TO READ UNLOADED RECORDS A35460 04270020
         TM    IEHMVV20,X'08'        IS KEYWORD 'PDS' SPECIFIED? A35460 04280020
         BZ    NOLT                  NO, BRANCH (PS DATA SET)    A35460 04290020
         MVI   IEHMVV61,X'22'        PUT ERROR CODE IN WORK AREA A35460 04300020
         L     LINK,PREAB            LOAD ADDRESS OF THE ENTRY   A35460 04310020
*                                    POINT OF THE ERROR ROUTINE  A35460 04320020
         BR    LINK                  GO TO ERROR ROUTINE         A35460 04330020
UNLDPROC LNR   ZERO,BASE             CONTINUE TO SET UP FOR      A35460 04340020
*                                    LOADING                     A35460 04350020
*                                    SET UP TO CALL BREAD TO GET A35460 04360020
*                                    DSCB                        A35460 04370020
         LA    1,IEHMVV00+40                                            04400015
         L     LINK,BREAD               GO TO BREAD ROUTINE             04420000
         BALR  RETURN,LINK                                              04440000
         B     LTBREAD(LINK)            CHECK RETURNS FROM BREAD        04460000
LTBREAD  B     LTOK                     BREAD OK                        04480000
         B     NOLT               END OF DATA                           04500000
         B     LTPIO                    PERMANT IO ERROR                04520000
         B     NOPSLT                  SEQ NUMBERS INCORRECT     A25631 04530019
         DC    X'0000'                                                  04540000
LTPIO    DS    0H                                                       04560000
         MVI   IEHMVV61,ERROR     SET ERROR MESSAGE                     04580000
EXIT     L     LINK,PREAB                                        A25631 04600019
         BR    LINK                                                     04620000
NOPSLT   MVI   IEHMVV61,PSERR                                    A25631 04626019
         B     EXIT                                              A25631 04632019
LTOK     DS  0H                                                         04640000
         MVC   DEVCHARU(4),IEHMVV00+236 PICK UP OLD DEVICE TYPE         04660000
         L     ACCE,IEHMVV30+8    GET FROM DSCB                         04680000
         MVC   0(140,ACCE),IEHMVV00+43                                  04700015
         MVC   IEHMVV25(2),IEHMVV00+183     SET UP DIRECTORY QUAN       04720015
         OI    IEHMVV20+1,LOAD          TURN ON LOAD BIT                04740000
         TM    IEHMVV00+185,MOVE  WAS UNLOAD DS UNMOVEABLE              04760000
         BZ    GNNNU              NO NOT UNMOVEABLE                     04780015
* * * * *                         YES-- UNMOVEABLE                      04800015
         OI    IEHMVV10-4,ANYINCRP TURN ON OUR UNMOVE INDICATION        04820000
GNNNU    DS    0H                                                       04840000
         SPACE 1                                                        04860000
         STM   DEV14,DEV1,DEVSAVE       SAVE THE REGISTERS TO BE USED   04880000
         TM    IEHMVV00+185,X'40'       TEST THE LOAD FLAG              04900000
         BO    DEVA                    BRANCH IF NEW UNLOAD             04920000
         MVC   IEHMVV00+186(8),DEVCONST  SET UP DEFAULT VALUES          04940000
DEVA     L     DEV14,IEHMVV31+8        GET ADDRESS OF THE 'TO'          04960000
         LA    DEV1,0(0,DEV14)          DDNAME                          04980000
         DEVTYPE (1),DEVCHAR,DEVTAB     GET THE 'TO' DEVICE CHARCTER    05000000
         TM    DEVCHAR+2,X'20'          TEST DEVICE TYPE OF 'TO' DEV    05020000
         BZ    DEVCONT                  BRANCH IF NOT DIRECT ACCESS     05040000
         MVC   DEVCHAR(4),IEHMVV00+186  GET THE SIZE OF THE DATASET     05060000
         L     DEV14,DEVCHAR            AND PUT INTO REGISTER DEV14     05080000
         LH    DEV0,DEVCHAR+12         SET UP TO DIVIDE BY THE          05100000
         AR    DEV14,DEV0              TRACK CAPACITY AND ROUND         05120000
         BCTR  DEV14,0                 UP TO GET AN ADEQUATE            05140000
         SRDA  DEV14,32                NUMBER OF TRACKS FOR THE         05160000
         DR    DEV14,DEV0              NEW ALLOCATION                   05180000
         ST    DEV15,DEVCHAR            STORE RESULT BACK INTO DSCB     05200000
         MVC   DADPQ-IECSDSL1(4,ACCE),DEVCHAR   FOR ALLOCATION          05220000
         MVC   DEVCHAR(4),IEHMVV00+190  GET THE SECONDARY QUANTITY      05240000
         L     DEV14,DEVCHAR            AND TEST FOR DEFAULT            05260000
         LTR   DEV14,DEV14              VALUES BY SEEING IF NEGATIVE    05280000
         BNL   DEVD                     SECONDARY QUANTITY              05300000
         LCR   DEV14,DEV14              MAKE POSITIVE AND SET           05320000
         MVI   DS1SCALO-IECSDSL1(ACCE),X'80'  SEC ALLOC CONTROL         05340000
DEVD     TM    DS1SCALO-IECSDSL1(ACCE),X'80'  TEST TYPE OF SEC ALLOC    05360000
         BZ    DEVCONT                  BRANCH IF ABSOLUTE OR BLOCK     05380000
         AR    DEV14,DEV0              CAPACITY AND ROUND UP            05400000
         BCTR  DEV14,0                 TO GET AN APPROPRIATE            05420000
         SRDA  DEV14,32                VALUE FOR THE SECONDARY          05440000
         DR    DEV14,DEV0               ALLOCATION REQUEST              05460000
         TM    DS1SCALO-IECSDSL1(ACCE),X'40'  TEST TYPE OF SEC ALLOC    05480000
         BZ    DEVB                    BRANCH IF TRACK                  05500000
         LR    DEV14,DEV15              SET UP TO CONVERT TO CYL        05560000
         SR    DEV0,DEV0               ALLOCATION                       05570013
         IC    DEV0,DEVCHAR+11               REQUEST AND                05580013
         AR    DEV14,DEV0              ROUND UP TO THE NEXT             05600000
         BCTR  DEV14,0                 HIGHER NUMBER OF                 05620000
         SRDA  DEV14,32                CYLINDERS ON THE                 05640000
         DR    DEV14,DEV0              DEVICE                           05660000
         B     DEVB                                                     05680000
         SPACE 1                                                        05700000
         SPACE 1                                                        05740000
DEVB     ST    DEV15,DEVCHAR            STORE THE PROPER SEC ALLOC      05760000
         MVC   DS1SCALO-IECSDSL1+1(3,ACCE),DEVCHAR+1  INTO THE DSCB     05780000
         B     DEVCONT                                                  05800000
         SPACE 2                                                        05820000
DEVCHAR  DS    5F                       DEVICE CHARACTERISTICS AREA     05840000
DEVSAVE  DS    4F                       REGISTER SAVE AREA              05860000
DEVCONST DC    F'72500'                DEFAULT VALUES GIVE A PRIMARY    05880000
         DC    F'-36250'                QUAN OF 20 TRACKS ON 2311       05900000
         SPACE 1                                                        05920000
DEVT1    DS    2F                                                A21645 05940018
DEVT2    DS    2F                      UCB TYPE FOR TO   DEVICE         05960000
DEVCHARU DS    1F                                                       05980000
         SPACE 1                                                        06000000
DEV14    EQU   14                       DEFINE THE REGISTERS USED       06020000
DEV15    EQU   15                       IN THIS DEVICE ALLOCATION       06040000
DEV0     EQU   0                                                        06060000
DEV1     EQU   1                                                        06080000
         SPACE 1                                                        06100000
DEVCONT  LM    DEV14,DEV1,DEVSAVE       RESTORE REGISTERS               06120000
         SPACE 1                                                        06140000
         B     LTRETURN                                                 06160000
NOLT     DS    0H                                                       06180000
         L     ACCE,IEHMVV22+4          IS FROM DEVICE DASD             06200000
         CLI   2(ACCE),DASD                                             06220000
         BE    LTRETURN           YES,GO TO RETURN                      06240000
*                                       NO, SET UP FOR TESTING          06260000
*                                                                       06280000
         L     ACCE,IEHMVV30            GET DCB ADDRESS                 06300000
         L     ACCO,IEHMVV30+8          GET DSCB ADDRESS                06320000
         MVC   DS1RECFM-DSCBDSEC(1,ACCO),DCBRECFM-IHADCB(ACCE)          06340000
         MVC   DS1BLKL-DSCBDSEC(2,ACCO),DCBBLKSI-IHADCB(ACCE)           06360000
         MVC   DS1LRECL-DSCBDSEC(2,ACCO),DCBLRECL-IHADCB(ACCE)          06380000
         L     ACCE,IEHMVV21            DATA SET NAME                   06400000
         MVC   DS1DSNAM-DSCBDSEC(44,ACCO),0(ACCE)                       06420000
         MVI   DS1FMTID-DSCBDSEC(ACCO),X'F1'                            06440000
         MVI   DS1DSORG-DSCBDSEC(ACCO),X'40'                            06460000
         B     LTRETURN                 RETURN                          06480000
FROMDD   DS    0H                                                       06500000
         L     1,IEHMVV28                                               06520015
         MVC   DCBDDNAM-IHADCB(8,M7),0(1)                               06540000
         L     M5,16                   FIND ADDR CVT             A45188 06541022
         L     M5,0(M5)                FIND TCB POINTERS         A45188 06542022
         L     M5,4(M5)                FIND TCB ADDR             A45188 06543022
         L     M5,12(M5)               FIND TIOT ADDR            A45188 06544022
         LA    M5,24(M5)               FIND FIRST DD ENTRY       A45188 06545022
NEXTDD   SR    M6,M6                                             A45188 06546022
         IC    M6,0(M5)                FIND ENTRY LENGTH         A45188 06547022
         CLC   4(8,M5),0(1)            DDNAME FOUND              A45188 06548022
         BE    RDJFCB                  YES CONTINUE              A45188 06549022
         AR    M5,M6                   NO GO TO NEXT ENTRY       A45188 06550022
         L     M6,0(M5)                                          A45188 06551022
         LTR   M6,M6                   END OF TIOT               A45188 06552022
         BNZ   NEXTDD                  NO COMPARE NEXT ONE       A45188 06553022
         MVI   IEHMVV61,X'26'          YES INDICATE MSG NBR      A45188 06554022
         L     LINK,PREAB                                        A45188 06555022
         BR    LINK                    TERMINATE THE REQ         A45188 06556022
RDJFCB   DS    0H                                                A45188 06557022
         RDJFCB  ((M7))                                                 06560000
         B     FROMBACK                                                 06580000
         DS    0F                                                       06600000
DCBXX    DC    X'05'                                               UL0H 06620017
         DC    AL3(MYDCBXX)                                             06640000
ZZZ      DC    X'0000'                                                  06660000
MYDCBXX  CLC   DCBBLKSI-IHADCB(2,M7),ZZZ                                06680000
         BE    MYDCBX             YES,BLOCKSIZE EQUAL TO ZERO           06700000
**********************************************************************  06710004
* LINES 067500-069380 WERE REACTIVATED IN                      @Z40CSJH 06720004
* SUPPORT OF THE EXTENDED MVS CVOL FUNCTION                    @Z40CSJH 06730004
**********************************************************************  06740004
         LA    ACCE,80            NO                                    06750004
         CH    ACCE,DCBLRECL-IHADCB(ZERO,M7)  RECL EQUAL TO 80          06800004
         BE    RTNDCBX                                                  06850004
CHKCAT   TM    IEHMVV20,CATALOG   CATLG KEYWORD                         06900004
         BZ    RTNDCBX            RETURN                                06910004
         MVI   DCBDSORG+1-IHADCB(M7),AZERO                              06920004
         MVI   DCBDSORG-IHADCB(M7),BSAM                                 06930004
         MVI   DCBBLKSI+1-IHADCB(M7),AZERO                              06932004
         MVI   DCBBLKSI-IHADCB(M7),ONE                                  06934004
         MVI   DCBKEYLE-IHADCB(M7),EIGHT                                06936004
         MVI   DCBRECFM-IHADCB(M7),FIXED+KEYL                      1719 06938004
RTNDCBX  DS    0H                                                       06940000
         RETURN   RC=0                                                  06960000
MYDCBX   DS    0H                 TEST FORMAT                           06980000
         L     M5,IEHMVV22                                              06990017
         CLI   2(M5),UNITRCD      FROM VOLUME UNIT RECORD               07000017
         BE    UUWW                                                     07010017
         TM    IEHMVV20,CATALOG  CATALOG KEYWORD ?             @Z40CSJH 07012004
         BO    CHKCAT                                          @Z40CSJH 07014004
         MVI   DCBBLKSI-IHADCB(M7),TEN                                  07019017
         MVI   DCBRECFM-IHADCB(M7),UNDEF                                07022017
         MVI   IEHMVV10-5,X'09'                                         07025017
         B     RTNDCBX                                                  07026017
ADIHLR   DC    X'01'                   INPUT HEADER LABEL ROUTINE  UL0H 07028017
         DC    AL3(IHLR)               DCBEXLIST ENTRY             UL0H 07031017
*                                                                  UL0H 07037017
* USER INPUT HEADER LABEL ROUTINE ENTERED FROM OPENJ OF INPUT DCB  UL0H 07040017
*   WITH REGISTER 1 POINTING TO A 5-WORD PARAMETER LIST. WORD 1    UL0H 07043017
*   POINTS TO THE LABEL BUFFER AREA.  IF WORD 1 IS ZERO, THERE ARE UL0H 07046017
*   NO INPUT HEADER LABELS TO BE PROCESSED.                        UL0H 07049017
*                                                                  UL0H 07052017
IHLR     DS    0H                                                  UL0H 07055017
OFFSET1  EQU   IHLR-IEHMVESV                                       UL0H 07058017
         LA    M8,OFFSET1              SET UP                      UL0H 07061017
         SR    LINK,M8                 ADDRESSABILITY              UL0H 07064017
         LR    BASE,LINK               FOR EXIT ROUTINE            UL0H 07067017
         L     M8,0(PARAM)        GET ADDR OF LABEL BUFFER AREA    UL0H 07069017
         LTR   M8,M8              ARE USER LABELS PRESENT          UL0H 07071017
         BNE   CHKIOERR           YES, IS I/O ERROR INDICATED IN   UL0H 07073017
*                                 PARAMETER LIST                   UL0H 07075017
NOLABEL  SR    LINK,LINK          NO, RETURN CODE OF ZERO TO OPEN  UL0H 07077017
*                                 TO IGNORE ADDITIONAL LABELS      UL0H 07079017
         BR    RETURN             RETURN TO OPENJ                  UL0H 07081017
*                                                                  UL0H 07083017
CHKIOERR DS    0H                                                  UL0H 07085017
         TM    8(PARAM),X'80'     PERM ERROR SHOWN IN PARM LIST    UL0H 07087017
         BC    14,CORAVAIL        NO, SEE IF CORE GOTTEN YET       UL0H 07089017
LABLERR  DS    0H                                                  UL0H 07091017
         OI    IEHMVV74+4,X'FF'         YES, SET FLAG TO OUTPUT    UL0H 07096017
*                                        MSG AFTER OPEN/CLOSE/EOV  UL0H 07101017
         MVI   UDCBIHLE,X'00'     DEACTIVATE HEADER LABEL ENTRIES  UL0H 07107017
         MVI   UDCBOHLE,X'00'     IN DCB EXIT LIST                 UL0H 07109017
         OI    IEHMVV20+2,X'40'        TELL VESN TO PUT OUT MSG    UL0H 07111017
*                                      DATA SET(S) NOT MOVED/COPIEDUL0H 07113017
         BR    RETURN             RETURN TO OPENJ ROUTINE          UL0H 07117017
CORAVAIL DS    0H                                                  UL0H 07119017
         CLC   IEHMVV72(4),ALLZERO     WAS CORE GOTTEN FOR LABELS  UL0H 07121017
         BNE   SAVLABEL           ADDR NOT ZERO, CORE GOTTEN       UL0H 07123017
         GETMAIN  R,LV=640        GET CORE IF NECESSARY            UL0H 07125017
         ST    PARAM,IEHMVV72     SAVE ADDR OF GOTTEN CORE         UL0H 07127017
         MVC   IEHMVV72+4(4),IEHMVV72  SAVE POINTER TO CURRENT     UL0H 07129017
*                                      LABEL SAVEAREA              UL0H 07131017
SAVLABEL DS    0H                                                  UL0H 07133017
         L     M9,IEHMVV72+4      GET ADDR CURRENT LBL SAVEAREA    UL0H 07135017
         MVC   0(80,M9),0(M8)     MOVE LBL TO AREA FROM LABEL      UL0H 07137017
*                                 BUFFER ADDRESSED BY PARAM LIST   UL0H 07139017
         LA    M9,80(M9)          UPDATE POINTER TO NEXT AREA      UL0H 07141017
         ST    M9,IEHMVV72+4      STORE UPDATED POINTER            UL0H 07143017
         SR    M9,M9                                               UL0H 07145017
         IC    M9,IEHMVV72+12     PICK UP COUNT OF LABELS          UL0H 07147017
         LA    M9,1(M9)           INCREMENT COUNT BY 1             UL0H 07149017
         STC   M9,IEHMVV72+12     STORE UPDATED COUNT              UL0H 07151017
         LA    LINK,4             SET RETURN CODE TO 4 FOR OPEN    UL0H 07153017
*                                 TO GET ADDITIONAL LABELS         UL0H 07155017
         BR    RETURN             RETURN TO OPENJ ROUTINE          UL0H 07157017
*                                                                       07158017
IOERRMSG DS    0H                                                  UL0H 07159017
         IC    ACCE,IEHMVV61            SAVE CURRENT MSG CODE      UL0H 07160017
         LA    M9,17                    LOAD MSG CODE AND STORE    UL0H 07161017
         STC   M9,IEHMVV61               FOR MESSAGE WRITER        UL0H 07162017
         L     LINK,GOTOMESS            GET ADDR OF MESSAGE WRITER UL0H 07163017
         LR    M9,RETURN                SAVE RETURN ADDR FOR OPENJ UL0H 07164017
         BALR  RETURN,LINK              BRANCH TO WRITE MESSAGE    UL0H 07165017
         STC   ACCE,IEHMVV61            RESTORE PREVIOUS CODE      UL0H 07166017
         LR    RETURN,M9                RESTORE RETURN ADDRESS     UL0H 07167017
         B     ERMSGRET                 RETURN TO INLINE PROCESSINGUL0H 07168017
LOADDCB  DCB  DSORG=PS,MACRF=RP,RECFM=U                                 07180000
LOADDCBE DS    0F                                                       07200000
LENGTHDC DC    A(LOADDCBE-LOADDCB)                                      07220000
MOVELT   MVC   0(1,ACCE),LOADDCB                                        07240000
BREAD    DC    A(IEHMVERK)                                              07260000
         EXTRN IEHMVERK                                                 07280000
UUWW     DS    0H                                                       07300000
         L     ACCE,IEHMVV30                                            07320015
         MVI   DCBRECFM-IHADCB(ACCE),X'80'                              07340015
         LA    ACCO,80                                                  07360015
         STH   ACCO,DCBBLKSI-IHADCB(ACCE)                               07380015
         STH   ACCO,DCBLRECL-IHADCB(ACCE)                               07400015
         MVI   DCBDSORG-IHADCB(ACCE),X'40'                              07420015
         B     RTNDCBX                                                  07440015
         EXTRN UNLREC1                                                  07460000
LDRC     DC    A(UNLREC1)         IN SRZ,FIRST RECORD OF UNLOAD DATAS.  07480000
         EJECT                                                          07500000
*                                                                       07520000
*                                                                       07540000
IEHMVESM DS    0H                 SECURITY TEST                         07560000
*                                                                       07580000
*                                                                       07600000
         L     DSCB,IEHMVV30+8          SET UP DSCB POINTER             07620000
*                                                                       07640000
         TM    DS1DSIND,SECUR           IS DATA SET SECURITY PROTECTED  07660000
         BZ    IEHMVRSM           NO,RETURN                             07680000
*                                       YES, PROCEED WITH TESTING       07700000
         TM    IEHMVV20,DSGROUP         DSGROUP FUNCTION                07720000
         BO    CONTEST                  YES, CONTINUE TEST              07740000
         TM    IEHMVV20,VOLUME          NO, PROCEED TO TEST FOR VOLUME  07760000
         BZ    IEHMVRSM           RETURN                                07780000
CONTEST  DS    0H                                                       07800000
         TM    IEHMVV20+1,SECURITY      SECURITY OPERAND GIVEN          07820000
         BO    IEHMVRSM           YES,RETURN                            07840000
*                                                                       07860000
*                                                                       07880000
*                                                                       07900000
*                                                                       07920000
         MVI   IEHMVV61,SECER     SET ERROR MESSAGE                     07940000
         L     LINK,PREAB         PREABORT                              07960000
         BR    LINK                                                     07980000
*                                                                       08000000
         EJECT                                                          08020000
*                                                                       08040000
IEHMVESW DS    0H                 ACCESS METHOD TEST                    08060000
         TM    IEHMVV20+5,X'40'  UNLOAD REQUESTED                A37919 08066021
         BO    UNLREQMS                YES GIVE MESSAGE          A37919 08072021
         L     DSCB,IEHMVV30+8          GET DSCB POINTER                08080000
         CLI   DS1DSORG,BDAM            DSORG BDAM                      08100000
         BE    TSTBDAM                  YES CHECK DEVICE TYPE           08120000
PROBDAM  DS    0H                 TEST FOR DA                           08140000
         L     ACCE,IEHMVV23+4    ACTIVE TO VOL LIST                    08160000
         CLI   2(ACCE),DASD       DIRECT ACCESS                         08180000
         BNE   TAPHYSE            NO,CONTINUE                           08200000
*                                 YES,NO UNLOAD                         08220000
*                                                                       08240000
TAGOBACK DS    0H                                                       08260000
         B     IEHMVRSW                                                 08280000
*                                                                       08300000
*                                                                       08320000
*                                                                       08340000
TAPHYSE  DS    0H                 CONTINUE TEST                         08360000
**********************************************************************  08362004
* LINES 083700-083780 WERE REACTIVATED IN                      @Z40CSJH 08364004
* SUPPORT OF THE EXTENDED MVS CVOL FUNCTION                    @Z40CSJH 08366004
**********************************************************************  08368004
         TM    IEHMVV20,CATALOG        TEST FOR CATALOG FUNCTIONXA00427 08370004
         BNO   TAPHYSEQ                IF NOT, TEST KEYLEN      XA00427 08372004
         OI    IEHMVV20+1,UNLOAD       IF CATALOG, HAS TO BE    XA00427*08374004
                                         UNLOADED               XA00427 08376004
         B     TAGOBACK                                         XA00427 08378004
TAPHYSEQ EQU   *                                                        08378404
         CLI   DS1KEYL,AZERO                                            08380000
         BNE   TAKEY              UNLOAD CONDITION                      08400000
         CLI   DS1DSORG,BSAM            IS DSORG PHYSICAL SEQUENTIAL    08420000
         BE    TAGOBACK                 YES, NOT AN UNLOAD              08440000
*                                          TABLE-PRINT MESSAGE          08460000
         CLI   DS1DSORG,AZERO     DEFAULT                               08480000
         BE    TAGOBACK                                                 08500000
TAKEY    DS    0H                 SET UNLOAD CONDITION                  08520000
         MVI   IEHMVV61,X'94'      ACCESS METHOD NOT COMPAT.     A29052 08550019
         B     WRTMSG                  WRITE MESSAGE             A37919 08560021
*                                                                       08600000
TAKEYS   DS    0H                                                       08620000
         MVI   IEHMVV61,X'A0'      DEVICE TYPES NOT COMPAT MESS  A29052 08650019
         B     WRTMSG                  WRITE MESSAGE             A37919 08651021
*                                                                       08652021
UNLREQMS DS    0H                                                A37919 08653021
         MVI   IEHMVV61,X'A4'          UNLOADREQUEST MSG         A37919 08654021
*                                                                       08655021
WRTMSG   DS    0H                                                A37919 08656021
         OI    IEHMVV20+1,UNLOAD SET THE UNLOAD-CONDITION        A37919 08657021
         L     ACCO,GOTOMESS       GO TO 'MSG' IN SRZ TO HAVE    A29052 08660019
         BALR  RETURN,ACCO            MESSAGE WRITTEN.           A29052 08670019
         B     TAGOBACK                                                 08680000
TSTBDAM  DS    0H                 TEST FOR IDENTICAL DEVICES            08700000
         L     ACCE,IEHMVV22      ADDR OF FROM VOL                      08720000
         L     ACCO,IEHMVV23+4    ADDRESS OF TO VOL                     08740000
*                                                                       08760000
*                                                                       08780000
         TM    IEHMVV20+1,LOAD          TEST FOR BDAM LOAD CONDITION    08800000
         BZ    CHEKCUR                  BRANCH IF NOT A LOAD CONDITION  08820000
         CLC   DEVCHARU+2(1),DEVT2+2   COMPARE DEV CLASS       @ZA04396 08830003
         BNE   TAKEYS                  NOT EQUAL UNLOAD BDAM   @ZA04396 08834003
         CLI   DEVCHARU+3,X'09'        FROM 3330-1             @ZA04396 08838003
         BE    TESTTO                  YES TEST TO DEVICE      @ZA04396 08842003
         CLI   DEVCHARU+3,X'0D'        FROM 3330-11            @ZA04396 08846003
         BNE   EQUAL                   NO GO TO EQUAL          @ZA04396 08850003
TESTTO   CLI   DEVT2+3,X'09'           TO 3330-1               @ZA04396 08854003
         BE    MAINLINE                YES GO ON               @ZA04396 08858003
         CLI   DEVT2+3,X'0D'           TO 3330-11              @ZA04396 08862003
         BE    MAINLINE                YES GO ON               @ZA04396 08866003
EQUAL    CLC   DEVCHARU+3(1),DEVT2+3   COMPARE                 @ZA04396 08870003
         BNE   TAKEYS                  UNLOAD BDAM             @ZA04396 08874003
MAINLINE CLC   DEVCHARU(1),DEVT2       COMPARE FIRST BYTE OF   @ZA04396 08878003
*                                      DEVICE TYPE FIELD         A25286 08890019
         BNE   TAKEYS                                            A25286 08895019
         B     TESTOVF                                                  08900000
CHEKCUR  CLC   DEVT1(4),DEVT2           COMPARE UCB TYPE FIELDS         08920000
         BE    TESTOVF             DEVICES ALIKE                 A21645 08925018
         CLI   2(ACCO),DASD       IS TO DEVICE DIRECT ACCESS     A21645 08930018
         BNE   TAKEYS             NO,UNLOAD BDAM                 A21645 08935018
         CLC  DEVT1+4(4),DEVT2+4  IS INPUT DEVICE LARGER THAN    A21645 08940018
*                                  MAXIMUM OUTPUT BLKSIZE        A21645 08945018
         BH    TAKEYS              YES,UNLOAD DATA SET           A21645 08950018
TESTOVF  TM    DS1RECFM,YESOFLOW        WAS FROM WRITTEN WITH TRACK     08960000
*                                       OVERFLOW                        08980000
         BO    OFLOW               BRANCH IF YES                        09000000
         B     IEHMVRTE           ALLOW BDAM MOVE                       09020000
OFLOW    DS    0H                                                       09040000
         TM    DEVT1+2,TAPE            FROM TAPE               @ZA03378 09046003
         BO    IEHMVRTE                YES LOAD                @ZA03378 09052003
         TM    DEVT1+1,YAOFLOW     DOES FROM DEVICE HAVE OFLOW FEATURE. 09060000
         BZ    MSG1                     IF NOT-DEVICES ARE NOT COMPA-   09080000
*                                          TABLE-PRINT MESSAGE          09100000
         B     IEHMVRTE           ALLOW MOVE                            09120000
         EJECT                                                          09140000
*                                                                       09160000
IEHMVETE DS    0H                 TEST RECORD LENGTH                    09180000
         L     ACCE,IEHMVV22+4     FROM VOLUME LIST                     09200000
         L     ACCO,IEHMVV23+4     TO VOLUME LIST                       09220000
         CLI   2(ACCO),TAPE        TO TAPE                              09240000
         BE    IEHMVRTE            YES                                  09260000
         CLI   2(ACCO),DASD        TO VOLUME DA                         09280000
         BNE   WOW                 NO                                   09300000
         CLI   2(ACCE),TAPE        FROM TAPE                            09320000
         BE    TESTDSCB                 OBTAIN DSCB                     09340000
         L     DSCB,IEHMVV30+8     NO,GET FROM DSCB POINTER             09360000
         TM    DS1RECFM,YESOFLOW   WRITTEN IN TRACK OVERFLOW            09380000
         BZ    TESTDSCB           OBTAIN DSCB                           09400000
         TM    DEVT1+1,YAOFLOW       DOES UNIT HAVE OVERFLOW FEATURE.   09420000
         BO    TESTDSCB           OBTAIN DSCB                           09440000
MSG1     MVI   IEHMVV61,NOTOF      SET OP MSG                           09460000
ABORT    L     LINK,PREAB          SET UP TO PREABORT  IN SRZ           09480000
         BR    LINK                                                     09500000
TESTDSCB DS    0H                                                       09520000
         L     ACCE,IEHMVV23      ADDR OF TO VOL LIST                   09540000
         CLI   2(ACCE),DASD       TO DEVICE DIRECT ACCESS               09560000
         BNE   TRACKCAP                                                 09580000
         XC    IEHMVV00(20),IEHMVV00    CLEAR 20 SPACES                 09600000
         MVI   IEHMVV00,MODE      INDICATE SEARCH MODE                  09620000
         MVC   IEHMVV00+4(4),IEHMVV21+4   TO DATASET NAME               09640000
         LA    ACCE,4(ACCE)         GET ADDRESS OF VOL SERIAL NO.       09660000
         ST    ACCE,IEHMVV00+8    SERIAL NUMBER                         09680000
         LA    ACCE,IEHMVV00+16    GET ADDRESS OF WORK AREA             09700000
         ST    ACCE,IEHMVV00+12    STORE ADDRESS OF WORK AREA           09720000
         OBTAIN IEHMVV00                                                09740000
         LTR   LINK,LINK          RETURN CODE EQUAL TO ZERO             09760000
         BZ    PREAL                                                    09780000
* ALL TESTING OF THE DSCB FIELDS AFTER THIS POINT, WITH THE EXCEPTION*  09786015
* OF THE TWO REFERENCES IN 'PREAL', PERTAIN TO THE 'FROM' DSCB.      *  09792015
NOPREAL  TM    DS1RECFM,YESOFLOW   WRITTEN WITH TRACK OVERFLOW          09800000
         BZ    TRACKCAP           TEST RECORD LENGTH                    09820000
TODEVTO  DS    0H                                                       09840000
         TM    DEVT2+1,YAOFLOW     DOES TO DEVICE HAVE TRACK OVERFLOW.  09860000
         BO    IEHMVRTE                                                 09880000
         B     TAKEYS                  UNLOAD DATA SET                  09900000
* WHEN ADDRESSING THE 'TO' DSCB AFTER THE OBTAIN MACRO,                 09920015
*  A DISPLACEMENT OF 44 MUST BE MADE BACK TO THE DSNAME AT THE KEY.     09940000
*  SINCE THE DSCB STARTS AT IEHMVV00+16, 28 MUST BE SUBTRACTED          09960000
*  FROM THE DSCB DISPLACEMENT.                                          09980000
PREAL    L     M10,IEHMVV22       ADDRESS OF FROM VOLUME LIST    A50960 10022022
         L     M11,IEHMVV23+4   ADDRESS OF ACTIVE TO VOLUME      S21042 10024021
         TM    IEHMVV20+3,X'04'                                  A48802 10024422
         BO    PREAL1                                            A48802 10024822
         CLC   4(6,M10),4(M11)  COMPARE VOLID OF T0 & FROM VOL   S21042 10026021
         BE    NOPREAL          EQUAL, THEN NO PREALLOCATION     S21042 10028021
PREAL1   OI    IEHMVV20+3,X'08'        INDICATE PREALLOCATION    A48802 10030022
*                                                                S21042 10032021
         L     PARAM,IEHMVV31+8        GET PTR TO 'TO' DDNAME    S21042 10034021
         LA    PARAM,0(PARAM)                                    S21042 10035021
         DEVTYPE (PARAM),INFO,DEVTAB   GET DEVICE CHARACTERISTICSS21042 10036021
         MVC   CCHHR(5),96(ACCE)       MOVE CCHHR IN ABS ADDR LOCS21042 10038021
         LH    PARAM,CCHHR             GET CC                    S21042 10038421
         MH    PARAM,TRCYL             CONVERT CC TO TT          S21042 10038821
         AH    PARAM,CCHHR+2           GET TOTAL TT              S21042 10039221
         SLL   PARAM,8                 FREE RIGHTMOST BYTE       S21042 10039621
         IC    PARAM,CCHHR+4           INSERT R                  S21042 10039721
         SLL   PARAM,8                 MOVE TTR TO LEFT 3 BYTES  S21042 10039821
         ST    PARAM,IEHMVV82+4        SAVE TTR                  S21042 10039921
*                                                                S21042 10046621
         GETMAIN R,LV=120              SAVE AREA FOR 'TO' DSCB   S21042 10048621
         OI    IEHMVV20+5,X'01'        INDICATE GETMAIN DONE   @ZA24602 10049699
         ST    PARAM,IEHMVV82+12       SAVE PTR TO THIS AREA     S21042 10050621
         XC    0(120,PARAM),0(PARAM)   CLEAR AREA                S21042 10052621
         MVC   0(117,PARAM),IEHMVV00   MOVE IN OBTAIN'S RESULT   S21042 10053021
         CLI   DS1RECFM-28-DS1DSNAM(MCTABLE),AZERO  RECFM GIVEN IN DSCB 10053122
         BE    NOPREAL            NO, SAME AS NOT PREALLOCATED   A50960 10053222
         TM    DS1RECFM-28-DS1DSNAM(MCTABLE),YESOFLOW T.O. IN TO DSCB   10053321
         BO    TODEVTO                                                  10060000
TRACKCAP STM   RETURN,PARAM,DEVSAVE   STORE REGISTERS TO BE USED        10080000
         L     DEV14,IEHMVV31+8        DDNAME OF THE 'TO' VOLUME   1719 10100015
         LA    PARAM,0(DEV0,DEV14)                                      10120000
         DEVTYPE (1),DEVCHAR,DEVTAB                                     10140000
         LH    ACCO,DEVCHAR+12     GET TRACK CAPACITY                   10160000
         LM    RETURN,PARAM,DEVSAVE   RESTORE REGISTERS                 10180000
         SR    M5,M5                                                    10200000
         L     ACCE,IEHMVV22+4         ADDR OF THE 'FROM' VOLUMEYA01218 10210002
         CLI   2(ACCE),TAPE        FROM TAPE                            10220000
         BE    SIZE                BRANCH AROUND KEYL                   10240000
         IC    M5,DS1KEYL                                               10260000
SIZE     AH    M5,DS1BLKL          ADD KEVL AND BLOCKSIZE               10280000
         CR    M5,ACCO             COMPARE LRECL TO CAPACITY            10300000
         BNH   IEHMVRTE                                                 10320000
         CLC   DS1EXT1+2(8),ZEROS       CHECK FOR MODEL-DSCB     A45144 10330022
         BNE   WOW                                               A45144 10332022
         CLC   DS1SCALO+1(3),ZEROS      CHECK FOR MODEL DSCB     A45144 10334022
         BNE   WOW                                               A45144 10336022
         CLC   DS1DSSN(6),ZEROS         CHECK FOR MODEL-DSCB     A45144 10338022
         BE    WOW                                               A45144 10338422
         B     IEHMVRTE                 IF MODEL-DSCB, BRANCH    A45144 10338822
WOW      DS    0H                 TEST FOR REBLOCKING                   10340000
         TM    DS1RECFM,BLOCKED   BLOCKED FORMAT                        10360000
*                                           FORMAT                      10380000
         BZ    NORB                    NO, GO TO SET UP UNLOAD          10400000
*                                                                       10420000
         TM    DS1RECFM,UNDEF     UNDEFINED FORMAT                      10440000
         BO    NORB                    YES, NO REBLOCKING               10460000
*                                      NO, RECFM IS FB OR VB            10480000
         LH    M5,DS1LRECL        LOGICAL REC LENGTH                    10500000
         CR    M5,ACCO             COMPARE SIZE TOCAPACITY              10520000
         BH    NORB                    NO, SET UP UNLOAD                10540000
         ST    ACCO,IEHMVV10-12                                 YA01218 10560002
         TM    DS1RECFM,FIXED     RECFM FIXED                           10580000
         BNO   VBLOCKED                NO                       YA01218 10600002
*                                                                       10620000
*                                      FIXED BLOCKED                    10640000
         OI    IEHMVV10-4,X'20'             INDICATE TO MOVE DS         10660000
         MVI   IEHMVV10-1,X'07'             ON LRECL                    10680000
         B     IEHMVRTE                                                 10700000
VBLOCKED EQU   *                       VARIABLE BLOCKED                 10720000
         OI    IEHMVV10-4,X'10'             INDICATE TO MOVE DS         10740000
         MVI   IEHMVV10-1,X'09'                                         10760000
         B     IEHMVRTE                NO UNLOAD RETURN                 10780000
NORB     DS    0H                 SET UNLOAD CONDITION                  10800000
*MESSAGE - DATA SET UNLOADED BECAUSE RECORD LENGTH NOT DEVICE           10810015
*                 COMPATIBLE                                            10820015
         MVI   IEHMVV61,X'96'                                           10840000
         OI    IEHMVV20+1,UNLOAD                                        10860000
         L     ACCO,GOTOMESS       GO TO SRZ TO HAVE             A29052 10866019
         BALR  RETURN,ACCO         MESSAGE WRITTEN.              A29052 10872019
         B     IEHMVRTE                                                 10880000
         EJECT                                                          10900000
*                                                                       10920000
IEHMVESL DS    0H                 UNMOVEABLE TEST                       10940000
*                                                                       10960000
*                                                                       10980000
*                                                                       11000000
         TM    IEHMVV10-4,UNMOVE  UNMOVEABLE DATA SET                   11020000
         BZ    IEHMVRSL           NO,                                   11040000
*                                 YES,CONTINUE WITH TEST                11060000
UNYES    DS    0H                                                  0310 11130017
*                                                                       11300000
*             TO VOLUME DIRECT ACCESS                                   11320000
         L     ACCE,IEHMVV23           GET TO VOL LIST                  11340015
         CLI   2(ACCE),DASD            IS TO VOL DIRECT ACCESS          11360015
         BNE   INMUN                   IF NO...... BRANCH               11380015
         IC    ACCE,IEHMVV61       SAVE MESSAGE CODE.            A29052 11400019
         MVI   IEHMVV61,X'15'      WRITE MESSAGE STATING THAT    A17911 11430018
         L     ACCO,GOTOMESS         UNMOVABLE DATA MUST BE      A17911 11480018
*                                    UPDATED (IEH452I).          A17911 11530018
         BALR  RETURN,ACCO         GO TO SRZ TO WRITE MESSAGE.   A17911 11580018
         STC   ACCE,IEHMVV61       RESTORE MESSAGE CODE.         A29052 11600019
         B     IEHMVRSL            RETURN TO MAIN FLOW AND EXIT. A17911 11630018
INMUN    DS    0H                  UNLOAD UNMOVABLE DATA SETS    A17911 11680018
         OI    IEHMVV20+1,UNLOAD     NOT GOING TO DIRECT ACCESS. A17911 11730018
         IC    ACCE,IEHMVV61       SAVE  MESSAGE  CODE.          A29052 11750019
         MVI   IEHMVV61,DSCBER     SET MESSAGE INDICATOR.        A17911 11780018
         L     ACCO,GOTOMESS       GO TO 'MSG' IN SRZ TO HAVE    A29052 11790019
         BALR  RETURN,ACCO         RESTORE MESSAGE CODE.         A29052 11800019
         B     IEHMVRSL            BRANCH TO MAIN FLOW AND       A17911 11830018
*                                    RETURN TO IEHMVSRZ.         A17911 11880018
**                                                                      12100000
*                                                                       12120000
*******     ******    ** * * * * * * * * * *  * **  * * * * * * *       12140000
*                                                                       12160000
         EJECT                                                          12180000
*                                                                       12200000
BADMTTO  DS    0H                 ERROR CONDITION                       12220000
         MVI   IEHMVV61,BADMT     SET MESSAGE                           12240000
         L     LINK,PREAB                                               12260000
         BR    LINK                                                     12280000
*                                                                       12300000
**********************************************************************  12310004
* LINES 123500-132361 WERE REACTIVATED IN                      @Z40CSJH 12320004
* SUPPORT OF THE MVS EXTENDED CVOL FUNCTION                    @Z40CSJH 12330004
**********************************************************************  12340004
         USING IEHMVESV,BASE                                            12350004
YESCATLG DS    0H       ALLOCATES CATALOG ON RECEIVING VOLUME           12400004
         TM    IEHMVV20+4,OK      FIRST TIME SWITCH FOR SZ              12450004
         BO    RTNCATLG                                                 12500004
         XC    IEHMVV00(140),IEHMVV00  SET TO ZEROS                     12550004
         MVI   IEHMVV00,BLANK     PUT BLANKS IN NAME OF JFCB            12600004
         MVC   IEHMVV00+1(43),IEHMVV00                                  12650004
         MVC   IEHMVV00(7),SYSCTLG                                      12700004
         MVI   IEHMVV00+44,SET                                          12750004
         MVI   IEHMVV00+94,OK                                           12800004
         MVI   IEHMVV00+97,TEN                                          12850004
         MVI   IEHMVV00+59,ONE                                          12900004
         MVI   IEHMVV00+111,TEN                                         12950004
*        SET PARAMETERS FOR SVC 32                                      13000004
         L     ACCE,IEHMVV31+8    GET POINTER TO 'TO' DDNAME            13050004
         SR    PARAM,PARAM        CLEAR REG 1(PARAM)           @Z40CSJH 13060004
         ICM   PARAM,3,DDUCB(ACCE)     @ UCB                   @Z40CSJH 13100004
         MVC   IEHMVV00+45(6),28(PARAM)                                 13150004
         ST    PARAM,IEHMVV31                                           13160004
         LA    PARAM,IEHMVV31     POINTER TO ADDRESS OF UCB             13170004
DDUCB    EQU   14                                                       13172004
         LA    ZERO,IEHMVV00      ADDRESS OF JFCB                       13174004
         LA    ACCE,2048          SET HIGH ORDER BIT TO ONE TO SHOW     13176004
         SLL   ACCE,20            FROM UTILITY                          13178004
         OR    ZERO,ACCE                                                13178404
         L     ACCE,IEHMVV23      GET TO VOL                            13178804
         CLI   2(ACCE),DASD       IS IT DIRECT ACCESS                   13179204
         BNE   TONOTDA            NO                                    13179604
         SVC   32                 SPACE ALLOCATION                      13179704
         LA    RETURN,4                                                 13179804
         SR    LINK,RETURN        SUBTRACT 4 FROM RETURN CUDE           13179904
         BC    12,BBB1            BRANCH IF SUCCESSFUL ALLOCATION OR    13186604
*                                 DUPLICATE NAME DSCB EXISTS            13188604
         MVI   IEHMVV61,ALER      SET UP MESSAGE                        13190604
         L     LINK,PREAB                                               13192604
         BR    LINK                                                     13193004
TONOTDA  DS    0H          WRITE ERROR MESSAGE                          13193104
         IC    ACCE,IEHMVV61      SAVE MSG NUMBER                       13193204
         MVI   IEHMVV61,CATER     SET UP MESSAGE                        13214904
         L     LINK,GOTOMESS                                            13224904
         BALR  RETURN,LINK                                              13234904
         STC   ACCE,IEHMVV61      RESTORE MSG NUMBER                    13235304
         NI    IEHMVV20+1,AND                                           13235704
         B     RTNCATLG                                                 13236104
GOTOMESS DC    A(MSG)                                                   13236604
         EXTRN MSG                                                      13258304
BBB1     DS    0H                                              @Z40CSJH 13268304
         OI    IEHMVV20+4,OK      SET FIRST TIME SW FOR SZ     @Z40CSJH 13278304
         B     RTNCATLG                                        @Z40CSJH 13278704
*                                                                       13280000
ZEROS    DC    2F'0'                                             A45144 13290022
SYSCTLG   DC   C'SYSCTLG'                                      @Z40CSJH 13300004
*        DATA SET INDICATORS IN DSCB                                    13320000
*                                                                       13340000
*                                                                       13360000
         DS    0F                                                       13380000
DOG      DC    C'  SZ'                                                  13400000
ABSE     DC    A(IEHMVESV)                                              13420000
LASTVOL  EQU   X'80'                                                    13440000
UNMOVE   EQU   X'08'                                                    13460000
SECUR    EQU   X'10'                                                    13480000
SYNADRTN DC    A(LTPIO)                                          A35460 13490021
PREAB    DC    A(PREABORT)                                              13500000
         EXTRN PREABORT                                                 13520000
INFO     DS    0CL20                   +                         S21042 13530021
         DS    CL10                    +DEVICE TYPE              S21042 13532021
TRCYL    DS    CL2                     +CHARACTERISTICS          S21042 13534021
         DS    CL8                     +                         S21042 13536021
CCHHR    DS    CL5                     ABS ADDR OF 'TO' DSCB     S21042 13538021
         EJECT                                                          13540000
MOVE     EQU   X'80'                                                    13560000
COPY     EQU   X'40'                                                    13580000
DSNAME   EQU   X'20'                                                    13600000
DSGROUP  EQU   X'10'                                                    13620000
PDS      EQU   X'08'                                                    13640000
CATALOG  EQU   X'04'                                                    13660000
VOLUME   EQU   X'02'                                                    13680000
FROM     EQU   X'01'                                                    13700000
TO       EQU   X'80'                                                    13720000
CVOL     EQU   X'40'                                                    13740000
UNCATLG  EQU   X'20'                                                    13760000
CATLG    EQU   X'10'                                                    13780000
SECURITY EQU   X'08'                                                    13800000
EXPAND   EQU   X'04'                                                    13820000
LOAD     EQU   X'02'                                                    13840000
UNLOAD   EQU   X'01'                                                    13860000
MIDABORT EQU   X'40'                                                    13880000
ENDINPUT EQU   X'20'                                                    13900000
PHONYTO  EQU   X'10'                                                    13920000
ANYINCRP EQU   X'08'                                                    13940000
ANYEXCRP EQU   X'04'                                                    13960000
ZERO     EQU   0                                                        13980000
PARAM    EQU   1                                                        14000000
ACCE     EQU   2                                                        14020000
ACCO     EQU   3                                                        14040000
BASE     EQU   4                                                        14060000
M5       EQU   5                                                        14080000
M6       EQU   6                                                        14100000
M7       EQU   7                                                        14120000
M8       EQU   8                                                        14140000
M9       EQU   9                                                        14160000
M10      EQU   10                                                       14180000
M11      EQU   11                                                       14200000
MCTABLE  EQU   12                                                       14220000
SAVE     EQU   13                                                       14240000
RETURN   EQU   14                                                       14260000
LINK     EQU   15                                                       14280000
DSCB     EQU   M7                                                       14300000
WORK3   EQU   ACCO                                                      14320000
WORK2   EQU   ACCE                                                      14340000
DASD    EQU   X'20'                                                     14360000
BDAM     EQU   X'20'                                                    14380000
ALER     EQU   X'05'                                                    14400000
AND      EQU   X'EF'                                                    14420000
AZERO    EQU   X'00'                                                    14440000
BADMT    EQU   X'1A'                                                    14460000
BLANK    EQU   X'40'                                                    14480000
BLOCKED  EQU   X'10'                                                    14500000
BSAM     EQU   X'40'                                                    14520000
CATER    EQU   X'07'                                                    14540000
DATAC    EQU   X'02'                                                    14560000
DSCBER   EQU   X'98'                                                    14580000
EIGHT    EQU   X'08'                                                    14600000
ERROR    EQU   X'0E'                                                    14620000
PSERR    EQU   X'17'                   MSG-DATA SET HAS          A25631 14623019
*                                      INCORRECT FORMAT          A25631 14626019
FIXED    EQU   X'80'                   BIT IN RECFM                1719 14630015
KEYL     EQU   X'01'                                                    14640015
FRDDKEY  EQU   X'02'                                                    14660000
LABEL    EQU   X'0A'              STANDARD USER LABELS             UL0H 14664017
SL       EQU   X'02'              INDICATES STANDARD LABEL       A32041 14666020
DEACTIVE EQU   X'00'              DEACTIVATE DCB EXIT LIST         UL0H 14668017
ACTIVIHL EQU   X'01'                                               UL0H 14672017
ACTIVOHL EQU   X'02'                                               UL0H 14676017
ACTIVITL EQU   X'03'                                               UL0H 14680017
ACTIVOTL EQU   X'04'                                               UL0H 14684017
ACTIVEND EQU   X'87'              JFCB ACTIVE END OF DCB EXIT LIST UL0H 14688017
ALLZERO  DC    F'0'                                                UL0H 14692017
MERROR   EQU   X'18'                                                    14700000
FROMERR  EQU   X'22'   MSG19, 'FROM' D.S. NOT IN UNLOADED FORMAT  10943 14710014
MODE     EQU   X'C1'                                                    14720000
NEW      EQU   X'C0'                                                    14740000
NONTOF   EQU   X'0D'                                                    14760000
NOTOF    EQU   X'0F'                                                    14780000
OK       EQU   X'80'                                                    14800000
ONE      EQU   X'01'                                                    14820000
PREALL   EQU   X'08'                                                    14840000
SECER    EQU   X'10'                                                    14860000
SET      EQU   X'F1'                                                    14880000
TAPE     EQU   X'80'                                                    14900000
TEN      EQU   X'0A'                                                    14920000
TLOAD    EQU   X'40'                                                    14940000
UNDEF    EQU   X'C0'                                                    14960000
UNITRCD  EQU   X'08'                                                    14980000
YAOFLOW  EQU   X'40'                                                    15000000
YESOFLOW EQU   X'20'                                                    15020000
         EJECT                                                          15040000
         TITLE 'DSCB FORMAT'                                            15060000
DSCBDSEC DSECT                                                          15080000
         IECSDSL1 (1)                                                   15100000
         ORG   DS1EXT1+3                                                15120000
DADPQ    DS    CL4                      PRIM QUAN FOR MODEL ALLOC       15140000
         IEHMVV                                                         15160000
         ORG   IEHMVV70                                            UL0H 15166017
         IEHDCBXL                                                  UL0H 15172017
         ORG   IEHMVV00                                                 15180000
         IEFJFCBN                                                       15200000
         TITLE 'DCB FORMAT'                                             15220000
         DCBD  DSORG=(PS,IS,DA,PO)                                      15240000
         END                                                            15260000
