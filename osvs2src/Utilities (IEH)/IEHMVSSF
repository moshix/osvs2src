 TITLE 'IEHMVSSF-IEHMOVE,IEHLIST,IEHPROGM VOLUME MOUNTER'          1415 00020014
*********************************************************************** 00028019
*                                                                     * 00036019
*                                                                     * 00044019
*FUNCTION/OPERATION: THE FUNCTION OF IEHMVSSF IS TO HANDLE VOLUME     * 00052019
*MOUNTING OPERATIONS. IT DECIDES WHICH DEVICE(S) THE VOLUME MAY BE    * 00060000
*MOUNTED ON AND FOR DIRECT ACCESS DEVICES CAUSES (BY USE OF OPEN TYPE * 00080000
*=J) THE ACTUAL MOUNTING OF THE VOLUME.                               * 00090019
*                                                                     * 00100019
*ENTRY POINTS: IEHMVESF                                               * 00120000
*                                                                     * 00130019
*INPUT: VOLUME ID; VOLUME DEVICE TYPE                                 * 00140000
*                                                                     * 00150019
*OUTPUT: POINTER TO DD NAME ON WHICH VOLUME IS OR CAN BE MOUNTED      * 00160019
*                                                                     * 00170019
*EXTERNAL ROUTINES: NONE                                              * 00180000
*                                                                     * 00190019
*EXITS: NORMAL - RETURN TO CALLING ROUTINE                            * 00200019
*                                                                     * 00210019
*EXITS: ERROR - RETURN TO CALLING ROUTINE WITH NOMOUNT BIT ON IN      * 00217019
*                ITHEADER                                             * 00224019
*                                                                     * 00231019
*TABLES/WORK AREAS:  INTERNAL TABLE CONTAINING POINTERS TO DD NAMES   * 00240019
*     IN TIOT,MASK OF AVAILABLE DEVICES, AND ADDRESS OF DEVICE    I276* 00249019
*     MASK TABLE                                                  I276* 00258019
*                                                                     * 00267019
*ATTRIBUTES: REUSEABLE                                                * 00280000
*                                                                     * 00290019
*NOTES: USED IN PROGRAMS IEHLIST,IEHPROGM, IEHMOVE                    * 00300000
*                                                                       00320000
*                                                                       00340000
*                                                                       00360000
*                                                                       00380000
*                                                                       00400000
*                                                                       00420000
*                                                                       00440000
*                                                                       00460000
*                                                                       00480000
*                                                                       00500000
*                                                                       00520000
*                                                                       00560000
*              PURPOSE   THE VOLUME MOUNTING ROUTINE CAUSES VOLUMES     00580000
*                        TO BE MOUNTED ON DEVICES ALLOCATED TO THE      00600000
*                        CALLING PROGRAM.  FOR DIRECT ACCESS MOUNTABLE  00620000
*                        DEVICES THE ACTUAL MOUNTING IS ACCOMPLISHED.   00640000
*                        FOR OTHER DEVICE TYPES THE ROUTINE RETURNS A   00660000
*                        POINTER TO A DDNAME WHICH PROVIDES THE         00680000
*                        ALLOCATION FOR A DEVICE ON WHICH THE VOLUME    00700000
*                        CAN BE MOUNTED.  THE CALLING PROGRAM CAN THEN  00720000
*                        EFFECT THE ACTUAL MOUNTING.                    00740000
*                                                                       00760000
*                                                                       00780000
*              CALLING FORMATS                                          00800000
*                                                                       00820000
*                   THE CALLING SEQUENCE                                00840000
*                                                                       00860000
*        L     R1,ADDRESS OF PARAMETER LIST                             00880000
*        L     R13,ADDRESS OF SAVE AREA                                 00900000
*        L     R15,ADDRESS OF VOLUME MOUNTING ROUTINE                   00920000
*        BALR  R14,R15                                                  00940000
*                                                                       00960000
*                                                                       00980000
*                   PARAMETER LIST                                      01000000
*                                                                       01020000
*        THE PARAMETER LIST IS COMPOSED OF N ENTRIES:                   01030019
*              THE 12 BYTE INTERNAL TABLE HEADER                        01040019
*              AND N-1 17 BYTE VOLUME MOUNTING REQUESTS            DT0I 01050019
*                                                                       01060019
*                                                                       01100000
*              FOR DESCRIPTION OF ENTRIES SEE THE WRITTEN DOCUMENTATION 01120000
*              ON VOLUME MOUNTING ROUTINE.                              01140000
*                                                                       01144019
*                                                                       01148019
*********************************************************************** 01152019
*                                                                       01156019
IEHVOLMT CSECT                                                          01158020
*A100888,C101600,D102600-102800,104200-104800                    A45128 01158122
*A134200,134800,136000,136400,137200,152400,164400,165600,C167000A45128 01158422
*A134326,134332,136146,136152,137230                              M3250 01159200
* 025000                                                          M0313 01160020
*058400,110600-111800,113400-113800,145870-146050,146160-146196,  M0313 01162020
*147330-147380,147630-147690 MAKE AN 18 FW SAVE AREA AVAILABLE    M0313 01164020
* 144450-144460                                                  S20201 01166820
*145870-146050,146169-146196,247330-147380,147630-147690,         M0487 01166920
* 180820-180840                                                   M0487 01167020
*                                                                A31436 01167420
*                                                                A32626 01168120
* 095600,096000-096800,097400-097600,098000-098800,099600,100000     CT 01168820
*  100004,112000,112400-112800                                       CT 01169520
*  IMPROVEMENT OF COMMENTS (RELEASE 20)                              CT 01170220
* 092680,092920,114600                                           A29718 01171519
* 018800-019000,094170-094175,103400-103600                      A25651 01172019
* 113000                                                         A27790 01173019
*                                                                A27909 01174019
* 022400,082000,145600,179600                                      I276 01176019
*C144400                                                       @Z30AAAG 01178003
*A094032,111,114086900,920,087300,400,100914,944,948,          @ZM30153 01180403
*A109220,500,144384,495,160800,900,164424,428,180620           @ZM30153 01180503
*C087400,094031,144495086800,164440-660                        @ZM30153 01180803
*D087000,094126                                                @ZM30153 01180903
*  LOADING THE DEVICE MASK TABLE AND STORING ITS ADDRESS IN THE    I276 01181019
*  INTERNAL TABLE                                                  I276 01186019
* 056800-057600,058600-058800,060400-061800,069200-070000,       HEADRS 01191019
*  073600-077400,094200,108400-108800,114000,114200-114400,      HEADRS 01196019
*  117400,117800,179000                                          HEADRS 01201019
*  ADDITION OF HEADERS FOR EASE IN FOLLOWING FLOW                HEADRS 01206019
* 018600,081800,092800,093200,094160-094165,094660,094720,           CS 01207019
*  103000-103200                                                     CS 01208019
*  IMPROVEMENT OF COMMENTS                                           CS 01209019
* 144420-144480                                                  A23794 01211019
*                                                                00GM0I 01223018
*0646135200,137400                                                 7296 01227017
*0646091200                                                      PTM404 01235017
*2018                                                              UL0H 01243017
*                                                                  UL0H 01251017
*2357054200,068800,094150,094190,103800,106000,115000                   01255018
*A109210                                                       @ZA25503 01256099
*D109500                                                       @ZA25503 01257099
*                             REGISTER NOTATION AND USAGE               01260000
*                                                                       01280000
R0       EQU   0                                                        01300000
PARAMPTR EQU   1                        PARAM REG                       01320000
ACCE     EQU   2                        WORK REG                        01340000
ACCO     EQU   3                        WORK REG                        01360000
WORK     EQU   4                                                        01380000
TIOT     EQU   4                                                        01400000
INLOOP   EQU   5                        LOOP CONTROL REG                01420000
SEARCH   EQU   6                        SEARCH INDICATOR REG            01440000
IT       EQU   7                        INTERNAL TABLE REG              01460000
LOOP     EQU   8                        LOOP CONTROL REG                01480000
VMREQUST EQU   9                        BASE FOR VOLUME MOUNT REQUEST   01500000
BASE     EQU   10                       BASE FOR IEHMVSSF               01520000
WORK2    EQU   11                                                       01540000
WORK3    EQU   12                                                       01560000
R13      EQU   13                       SAVE REG                        01580000
RETURN   EQU   14                       RETURN REG                      01600000
LINK     EQU   15                       ENTRY POINT REG                 01620000
R2       EQU   2                                                        01640000
R3       EQU   3                                                        01660000
R4       EQU   4                                                        01680000
R5       EQU   5                                                        01700000
R6       EQU   6                                                        01720000
R7       EQU   7                                                        01740000
R8       EQU   8                                                        01760000
R11      EQU   11                                                       01764013
R12      EQU   12                                                       01768013
R14      EQU   14                                                       01772013
R15      EQU   15                                                       01776013
*                                                                       01780000
*                                                                       01800000
*                             EQUATE STATEMENTS                         01820000
*                                                                       01840000
OFFSET0  EQU   0                                                 HEADRS 01901019
INITTO1  EQU   1                                                 HEADRS 01902019
OFFSET1  EQU   1                                                 HEADRS 01903019
ONEBIT   EQU   1                                                 HEADRS 01904019
ONEBYTE  EQU   1                                                 HEADRS 01905019
OFFSET2  EQU   2                                                 HEADRS 01906019
TWO      EQU   2                                                 HEADRS 01907019
TWOBITS  EQU   2                                                 HEADRS 01908019
TWOBYTES EQU   2                                                 HEADRS 01909019
OFFSET3  EQU   3                                                     CS 01909519
INITTO4  EQU   4                                                 HEADRS 01910019
OFFSET4  EQU   4                                                 HEADRS 01911019
VALUE4   EQU   4                                                 A23794 01912019
FIVEBITS EQU   5                                                 HEADRS 01913019
OFFSET6  EQU   6                                                 HEADRS 01913319
OFFSET7  EQU   7                                                     CS 01913619
OFFSET8  EQU   8                                                 HEADRS 01914019
OFFSET31 EQU   31                                                HEADRS 01915019
OFFSET32 EQU   32                                                HEADRS 01916019
WORDSIZE EQU   32             32 BITS IN A REGISTER              HEADRS 01917019
ADD256   EQU   256                                                      01917519
HEXFF    EQU   X'FF'          TEST FOR END OF UCB LUT            HEADRS 01918019
UCBVSN   EQU   28             OFFSET TO VOLUME SERIAL NUMBER IN UCB     01920000
UCBDEVT  EQU   18             OFFSET TO DEVICE TYPE IN UCB              01940000
UCBUNIT  EQU   13          OFFSET TO UNIT NAME IN UCB              DT0I 01950018
REMOVABL EQU   X'24'          USED TO TEST UCB FOR REMOVABLE VOLUME: CS 01952019
*                              NEITHER RESERVED NOR PERMANENTLY      CS 01954019
*                              RESIDENT                              CS 01956019
TRKOFLOW EQU   X'40'          USED TO TEST DEVICE TYPE FOR       A31436 01956820
*                              TRACK-OVERFLOW OPTION             A31436 01957620
DASD     EQU   X'20'          USED TO TEST DEVICE TYPE FOR       A31436 01958420
*                              DIRECT-ACCESS DEVICE CLASS        A31436 01959220
COMTAB   EQU   16             POINTER TO COMMUNICATIONS TABLE           01960000
CMTTCB2  EQU   0              TCB POINTER IN COMMUNICATIONS TABLE       01980000
TCBTIOT  EQU   12             OFFSET IN TCB FOR POINTER TO TIOT         02000000
TIOTFOUN EQU   24             FOUNDATION LENGTH OF TIOT                 02020000
TIOTLEN  EQU   0              OFFSET TO TIOT LENGTH FIELD               02040000
TIOTDDNA EQU   4              OFFSET TO DDNAME FIELD IN TIOT            02060000
TIOTUCB  EQU   14             OFFSET FROM DDNAME IN TIOT TO UCB POINTER 02080000
TIOTENTR EQU   20             OFFSET TO ENTRY BLOCK LENGTH IN TIOT      02100000
IUCB     EQU   40             OFFSET FROM CVT FOR POINTER TO UCB TABLE  02120000
ONEVOL   EQU   X'01'          USE TO INDICATE JFCB IS FOR ONE VOLUME CT 02123020
MOUNTREQ EQU   17                      SIZE OF VOL MOUNT REQUEST   DT0I 02126018
SLASH    EQU   X'61'                                               DT0I 02132018
*                                                                       02140000
*                                                                       02160000
*                             ENTRY AND EXTRN STATEMENTS                02180000
*                                                                       02200000
         ENTRY IEHMVESF                                                 02220000
*                                                                       02260000
*                                                                       02280000
*                             ASSEMBLER USING STATEMENTS                02300000
*                                                                       02320000
         USING IEHMVESF,BASE            ADDRESSABILITY FOR THIS PROGRAM 02340000
         USING ITHEADER,PARAMPTR        ADDRESSABILITY FOR THE INTERNAL 02360000
*                                      TABLE                            02380000
         USING REQUEST,VMREQUST         ADDRESSABILITY FOR VOLUME       02400000
*                                       MOUNTING REQUEST TABLE          02420000
*                                                                       02440000
*********************************************************************** 02442019
*********************************************************************** 02444019
**                                                                   ** 02446019
**                    ENTRY POINT INTO IEHVOLMT                      ** 02448019
**                           (IEHMVESF)                              ** 02450019
**                                                                   ** 02452019
*********************************************************************** 02454019
*********************************************************************** 02456019
*                                                                       02458019
IEHMVESF SAVE  (14,12),T,ESF                                            02460000
         LR    BASE,LINK               SET UP BASE REGISTER       M0313 02463020
         LA    R2,SAVE18F              ADDRESS OF NEW SAVE AREA   M0313 02466020
         ST    R2,8(R13)               ADDRESS OF NEW SAVE AREA   M0313 02469020
         ST    R13,4(R2)               ADDRESS OF CURRENT SAVE AREM0313 02472020
         LR    R13,R2                  CURRENT=NEW                M0313 02475020
*                                                                       02480000
*                                                                       02520000
*                             DSECTS FOR THE INTERNAL TABLE AND FOR     02540000
*                             THE VOLUME MOUNTING REQUEST TABLE FOLLOW  02560000
*                                                                       02580000
*  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  02586019
*  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  02592019
*                                                                       02600000
*                   DESCRIPTION INTERNAL TABLE HEADER                   02620000
ITHEADER DSECT                                                          02640000
GENERICC DS    CL1                      GENERIC NAME COUNT              02660000
GENERICP EQU   GENERICC                 POINTER TO GENERIC DDNAMES      02680000
         DS    CL3                                                      02700000
INDICATO DS    CL1                      INDICATOR BYTE                  02720000
MOUNT    EQU   X'80'                         BIT O     MOUNT INDICATION 02740000
SELECT   EQU   X'40'                         BIT 1     SELECTIVE        02760000
*                                                           DISMOUNT    02780000
OLDVALID EQU   X'20'                         BIT 2     IGNORE OLD       02800000
*                                                           REQUESTS    02820000
TABLE    EQU   X'10'                         BIT 3     INTERNAL TABLE   02840000
*                                                                       02860000
YESMOUNT EQU   X'01'                         BIT 7     MOUNTED A VOLUME 02880000
NOMOUNT  EQU   X'02'                         BIT 6     COULD NOT MOUNT  02900000
*                                                           A VOLUME    02920000
PTRINTAB EQU   INDICATO                 POINTER TO INTERNAL TABLE       02940000
         DS    CL3                                                      02960000
LENINTAB DS    CL2                      LENGTH OF INTERNAL TABLE        02980000
*                                                                       03000000
CNTINTAB DS    CL1                      COUNT OF INTERNAL TABLE ENTRIES 03020000
*                                                                       03040000
CNTVMR   DS    CL1                      COUNT OF VOLUME MOUNTING        03060000
*                                            REQUESTS                   03080000
*  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  03100000
*  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  03120000
*                                                                       03120819
*                                                                       03121619
*                                                                       03122419
*                      DIAGRAM OF INTERNAL TABLE                        03123219
*                                                                       03124019
*                                                                       03124819
*        *--------- 2 BYTES -------* *-------- 2 BYTES --------*        03125619
*                                                                       03126419
*                                                                       03127219
*        *******************************************************        03128019
*        *          LENGTH          *         OFFSET TO        *        03128820
*        *        (IN BYTES)        *    DEVICE MASK SIZES     *        03129619
*        *******************************************************        03130419
*        *     USAGE   *              POINTER TO               *        03131219
*        *     CODE    *           DD ENTRY IN TIOT            *        03132019
*                                                                       03132819
*        *                          *                          *        03133619
*                                                                       03134419
*        *                          *                          *        03135219
*                                                                       03136019
*        *                          *                          *        03136819
*                                                                       03137619
*        *******************************************************        03138419
*        *    SIZE OF DEVICE MASK   *    SIZE OF DEVICE MASK   *        03139219
*        *  (WITHOUT 2321 SECTION)  *                          *        03140019
*        *******************************************************        03140819
*        *                     DEVICE MASK                     *        03141619
*        *     (BITS ARE ON FOR VOLUMES MATCHING DD CARDS)     *        03142419
*                                                                       03143219
*        *                          *                          *        03144019
*                                                                       03144819
*        *                          *                          *        03145619
*                                                                       03146419
*        *                          *                          *        03147219
*                                                                       03148019
*        *******************************************************        03148819
*        *      ADDRESS OF SCHEDULER'S DEVICE MASK TABLE       *   I276 03149619
*        *          (IEHVOLMT DOES A LOAD OF THE DMT)          *   I276 03150419
*        *******************************************************   I276 03151219
*                                                                       03152019
*                                                                       03152819
*                                                                       03153619
*  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  03154419
*  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  03155219
*                                                                       03156019
*                   DESCRIPTION OF A VOLUME MOUNTING REQUEST            03160000
*                                                                       03180000
REQUEST  DSECT                                                          03200000
*                                                                       03220000
DEVICE   DS    CL4                      DEVICE TYPE                     03240000
VSN      DS    CL6                      VOLUME SERIAL NUMBER            03260000
RTA      DS    CL2                      RELATIVE TABLE ADDRESS          03280000
UNIT     DS    CL5                                                 DT0I 03290018
DISMOUNT EQU   X'80'                    BIT O INDICATES A SELECTIVE     03300000
*                                            DISMOUNT ENTRY             03320000
USAGE    EQU   X'80'                    USAGE BIT IN INTERNAL TABLE     03340000
*  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  03360000
*  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  03370019
*                                                                       03380000
*                                                                       03400000
IEHVOLMT CSECT                                                          03420000
*                                                                       03440000
*********************************************************************** 03442019
*                                                                     * 03444019
*               TEST WHETHER INTERNAL TABLE IS BUILT                  * 03446019
*                                                                     * 03448019
*********************************************************************** 03450019
*                                                                       03452019
*                                  DECISION                             03460000
         TM    INDICATO,TABLE           DOES INTERNAL TABLE ALREADY     03480000
*                                            EXIST?                     03500000
         BZ    CREATEIT                                                 03520000
*                                            WHICH CALLS IEHITGEN TO    03540000
*                                            CREATE INTERNAL TABLE      03560000
*                                                                       03580000
*                                       IF YES, PROCEED TO TEST FOR     03600000
*                                            ANY MOUNT REQUESTS         03620000
*                                                                       03640000
*********************************************************************** 03642019
*                                                                     * 03644019
*                       TEST FOR VOLUME MOUNT                         * 03646019
*                       OR DISMOUNT REQUESTS                          * 03648019
*                                                                     * 03650019
*********************************************************************** 03652019
*                                                                       03660000
MOUNTDEC DS    0H             DECISION                                  03680000
         CLI   CNTVMR,X'00'            ARE THERE ARY VOLUME COUNTINE    03700000
*                                            REQUESTS                   03720000
         BE    RETURNA                  IF NO, BRANCH TO "RETURNA" TO   03740000
*                                            RETURN TO CALLING PROGRAM  03760000
*                                       IF YES, PROCEED TO TEST WHETHER 03780000
*                                            TO HONOR ANY PREVIOUS      03800000
*                                            MOUNTS                     03820000
*                                                                       03840000
*                                                                       03860000
*********************************************************************** 03862019
*                                                                     * 03864019
*               TEST WHETHER TO HONOR PREVIOUS MOUNTS                 * 03866019
*                                                                     * 03868019
*********************************************************************** 03870019
*                                                                       03872019
*                                  DECISION                             03880000
         TM    INDICATO,OLDVALID        ARE ANY OF THE OLD MOUNTS VALID 03900000
*                                                                       03920000
         BZ    NOTVALID                 IF NO, BRANCH TO "NOTVALID" TO  03940000
*                                            ZERO OUT THE USAGE BITS    03960000
*                                            IN THE INTERNAL TABLE      03980000
*                                       IF YES, PROCEED TO TEST FOR     04000000
*                                           SELECTIVE DISMOUNTING       04020000
*                                                                       04040000
*                                                                       04060000
*********************************************************************** 04062019
*                                                                     * 04064019
*              TEST FOR SELECTIVE DISMOUNT REQUESTS                   * 04066019
*                                                                     * 04068019
*********************************************************************** 04070019
*                                                                       04072019
*                                  DECISION                             04080000
         TM    INDICATO,SELECT          ARE THERE ANY SELECTIVE         04100000
*                                            DISMOUNTS?                 04120000
*                                                                       04140000
         BZ    VALHOPE                                                  04160000
*                                            MOUNT REQUESTS             04180000
*                                       IF YES, PROCEED TO HANDLE       04200000
*                                            SELECTIVE DISMOUNTS        04220000
*                                                                       04240000
*                                                                       04260000
*                                       SELECTIVE DISMOUNTING           04280000
*                                                                       04300000
*                                  INITIALIZE LOOP                      04320000
         LA    VMREQUST,12(0,PARAMPTR)  ESTABLISH POINTER TO FIRST      04340000
*                                            VOLUME MOUNTING REQUEST    04360000
         SR    LOOP,LOOP                INITIALIZE LOOP CONTROL         04380000
         IC    LOOP,CNTVMR                   REGISTER TO THE NUMBER     04400000
*                                            OF VOLUME MOUNTING         04420000
*                                            REQUESTS                   04440000
         L     IT,PTRINTAB              INITIALIZE POINTER TO INTERNAL  04460000
*                                            TABLE                      04480000
*                                                                       04500000
*                                                                       04520000
*                                  START LOOP                           04540000
DISMTLP  DS    0H                       LOOP CONTROLLED BY NUMBER OF    04560000
*                                            VOLUME MOUNTING REQUESTS   04580000
*                                                                       04600000
*                                                                       04620000
*                                  DECISION                             04640000
         TM    RTA,DISMOUNT             IS THIS VOLUME TO BE DISMOUNTED 04660000
*                                                                       04680000
         BZ    NODISMT                  IF NO, BRANCH TO "NODISMT" TO   04700000
*                                            INCREMENT LOOP CONDITION   04720000
*                                            AND TEST                   04740000
*                                       IF YES, PROCEED TO DISMOUNT     04760000
*                                            VOLUME                     04780000
*                                                                       04800000
*                                                                       04820000
*                                  PROCESS                              04840000
         NI    RTA,X'7F'                DROP HIGH ORDER BIT OF RELATIVE 04860000
         LH    ACCE,RTA                      TABLE ADDRESS AND PLACE    04880000
*                                            IN WORK REGISTER           04900000
*                                                                       04920000
*                                                                       04940000
*                                  DECISION                             04960000
         LTR   ACCE,ACCE                IS RELATIVE TABLE ADDRESS ZERO  04980000
         BZ    SETRTA                   IF YES, BRANCH TO "SETRTA" TO   05000000
*                                            PROCEED WITH LOOP          05020000
*                                       IF NO, PROCEED TO ZERO USAG     05040000
*                                            BIT IN THE INTERNAL TABLE  05060000
*                                                                       05080000
*                                                                       05100000
*                                  PROCESS                              05120000
         LA    ACCO,0(ACCE,IT)          ZERO USAGE BIT IN INTERNAL      05140000
        NI    0(ACCO),X'7F'                 TABLE                       05160000
*                                                                       05180000
*                                                                       05200000
*                                  PROCESS                              05220000
SETRTA   DS    0H                       ZERO RELATIVE TABLE ADDRESS     05240000
*                                            AND SET HIGH ORDER BIT ON  05260000
         SR    ACCE,ACCE                                                05280000
         STH   ACCE,RTA                                                 05300000
         OI    RTA,DISMOUNT                                             05320000
*                                                                       05340000
*                                                                       05360000
*                                  PROCESS                              05380000
NODISMT  DS    0H                       INCREMENT TO NEXT VOLUME ENTRY  05400000
         LA    VMREQUST,MOUNTREQ(VMREQUST)                         DT0I 05420018
*                                                                       05440000
*                                                                       05460000
*                                  LOOP CONTROL                         05480000
         BCT   LOOP,DISMTLP             HAS LAST VOLUME REQUEST BEEN    05500000
*                                            INSPECTED FOR DISMOUNTING  05520000
*                                       IF NO, BRANCH TO START OF       05540000
*                                            LOOP, "DISMTLP"            05560000
*                                                                       05562019
*********************************************************************** 05564019
*                                                                     * 05566019
*           WHEN FINISH DISMOUNTS BRANCH TO DO ANY MOUNTS             * 05568019
*                                                                     * 05570019
*********************************************************************** 05572019
*                                                                       05574019
         B     MTREQUST                 IF YES, BRANCH TO "MTREQUST" TO 05580000
*                                            MOUNT ANY REQUESTS         05600000
*                                                                       05620000
*                                                                       05640000
*                                                                       05660000
CREATEIT DS    0H                  ************************************ 05670019
*                                  *                                  * 05680019
*                                  *   THIS BRANCH POINT IS ENTERED   * 05690019
*                                  *      WHEN THE INTERNAL TABLE     * 05700019
*                                  *          IS TO BE BUILT          * 05710019
*                                  *                                  * 05720019
*                                  ************************************ 05730019
*                                                                       05780000
*                                                                       05800000
         BAL   RETURN,ENTERHER                                          05820000
         L     RETURN,4(R13)           BASE ADDRESS IS OVERLAID   M0313 05828020
         L     BASE,16(RETURN)         RESTORE IT WITH EP ADDRESS M0313 05836020
*                                                                       05845019
*                                                                       05850019
RETURNTG DS    0H                  ************************************ 05855019
*                                  *                                  * 05860019
*                                  *       RETURN FROM BUILDING       * 05865019
*                                  *          INTERNAL TABLE          * 05870019
*                                  *                                  * 05875019
*                                  ************************************ 05880019
*                                                                       05885019
*                                                                       05890019
         B     ERRETURN(LINK)           WAS AN ERROR CONDITION RETURNED 05900000
ERRETURN B     MOUNTDEC                 IF NO, CONTINUE WITH ROUTINE    05920000
ERROR    DS    0H                       IF YES,EXIT WITH ERROR CODE     05940000
         L     R13,4(R13)              CURRENT SA= OLD SA         M0313 05950020
         RETURN (14,12),T,RC=4                                          05960000
*                                                                       05980000
*                                                                       06000000
*                                                                       06020000
*********************************************************************** 06040019
*                                                                     * 06060019
*                    ENTRY POINT TO MOUNT VOLUMES                     * 06080019
*                   IF OLD MOUNTS ARE TO BE IGNORED                   * 06100019
*                                                                     * 06120019
*********************************************************************** 06140019
*                                                                       06160019
NOTVALID DS    0H                                                HEADRS 06180019
*                                  INITIALIZE LOOP                      06200000
         L     IT,PTRINTAB              INITIALIZE POINTER TO INTERNAL  06220000
*                                            TABLE                      06240000
         SR    LOOP,LOOP                                                06260000
         IC    LOOP,CNTINTAB            INITIALIZE LOOP CONTROL TO      06280000
         LTR   LOOP,LOOP     ANY DD CARDS                          8377 06286013
         BZ    VALHOPE       NO DD CARDS                           8377 06292013
*                                            NUMBER OF ENTRIES IN       06300000
*                                            INTERNAL TABLE             06320000
*                                                                       06340000
*                                                                       06360000
*                                  START LOOP                           06380000
NOUSELP  DS    0H                       LOOP CONTROLLED BY NUMBER OF    06400000
*                                            ENTRIES IN INTERNAL TABLE  06420000
*                                                                       06440000
*                                                                       06460000
*                                  PROCESS                              06480000
         NI    4(IT),X'7F'              CLEAR USAGE BIT FROM TABLE      06500000
*                                            ENTRY                      06520000
*                                                                       06540000
*                                                                       06560000
*                                  PROCESS                              06580000
         LA    IT,4(IT)                 INCREMENT TO NEXT TABLE         06600000
*                                            ENTRY                      06620000
*                                                                       06640000
*                                                                       06660000
*                                  LOOP CONTROL                         06680000
         BCT   LOOP,NOUSELP             HAS LAST TABLE ENTRY USAGE BIT  06700000
*                                            BEEN CLEARED               06720000
*                                       IF NO, BRANCH TO START OF       06740000
VALHOPE  LA    VMREQUST,12(0,PARAMPTR)                                  06760000
         SR    LOOP,LOOP                                                06780000
         IC    LOOP,CNTVMR                                              06800000
         SR    ACCO,ACCO                                                06820000
VOMLP    DS    0H                                                       06840000
         STH   ACCO,RTA                                                 06860000
         LA    VMREQUST,MOUNTREQ(0,VMREQUST)                       DT0I 06880018
         BCT   LOOP,VOMLP                                               06900000
*                                                                       06910019
*                                                                       06920019
*********************************************************************** 06930019
*                                                                     * 06940019
*                    PROCESS VOLUME MOUNT REQUESTS                    * 06950019
*                                                                     * 06960019
*********************************************************************** 06970019
*                                                                       06980019
MTREQUST DS    0H                                                HEADRS 06990019
*                                  INITIALIZE INNER LOOP "B"            07020000
         LA    VMREQUST,12(PARAMPTR)    ESTABLISH POINTER TO FIRST      07040000
*                                            VOLUME MOUNTING REQUEST    07060000
         SR    LOOP,LOOP                INITIALIZE LOOP CONTROL TO      07080000
         IC    LOOP,CNTVMR                   COUNT OF VOLUME MOUNTING   07100000
*                                            REQUESTS                   07120000
LOOPB    DS    0H                       START INNER LOOP B              07140000
         LA    SEARCH,0                 LOAD SERIAL SEARCH INDICATOR    07160000
*                                  DECISION                             07180000
         OC    RTA(2),RTA              IS RELATIVE TABLE ADDRESS ZERO   07200000
         BC    4,STEPVSN                IF NO, BRANCH TO "SETEPUSN" AND 07220000
*                                            OMIT INNER LOOP "C" FOR    07240000
*                                            THIS VOLUME MOUNTING       07260000
*                                            REQUEST                    07280000
*                                       IF YES, PROCEED TO SET UP INNER 07300000
*                                            LOOP "C"                   07320000
         LR    RETURN,LOOP                                              07340000
*                                                                       07760000
*                                                                       07780000
*                                                                       07800000
*                                  REGISTERS IN SEARCH FOR DEVICE       07820000
*                                       HAVE FOLLOWING MEANING          07840000
*                                                                       07860000
*                                       ACCE -    OUR MASK-1 WORD       07880000
*                                       IT   -    PTRINTAB, MASK LENGTH 07900000
*                                       WORK -    PTR TO OUR MASK       07920000
*                                       WORK2-    ENTRY LENGTH AND 32   07940000
*                                       INLOOP    PTR DEVICE MASK TABLE 07960000
*                                       LOOP -    NUMBER OF DMT ENTRIES 07980000
*                                                 RELATIVE TABLE ADDR.  08000000
*                                       LINK -    4  DEC. REG           08020000
*                                       ACCO -    DMT MASK- 1 WORD      08040000
*                                                 AND MASK              08060000
*                                                                       08080000
DEV      DS    0H                                                       08100000
         L     IT,PTRINTAB              GET POINTER INTERNAL TABLE      08120000
         LH    INLOOP,0(IT)             GET SIZE OF INTERNAL TABLE I276 08123019
         S     INLOOP,FOUR              SUBTRACT FOUR              I276 08126019
         L     INLOOP,0(INLOOP,IT)      GET ADDRESS OF DMT         I276 08129019
*                                        (STORED AS LAST FULLWORD  I276 08132019
*                                         IN THE INTERNAL TABLE)   I276 08135019
         LH    WORK2,2(IT)              GET MASK DISPLACEMENT           08140000
         LA    WORK,4(WORK2,IT)         POINTER TO MASK                 08160000
         LH    IT,OFFSET2(WORK2,IT)     SIZE OF MASK                 CS 08180019
*                                        (IN INTERNAL TABLE)         CS 08200019
         LA    WORK2,8(IT)              DMT ENTRY LENGTH                08220000
         LH    LOOP,0(INLOOP)           GET DMT NUMBER OF ENTRIES       08240000
         LA    INLOOP,4(INLOOP)         UP DMT PTR PAST HEADER          08260000
DMTSRCH  DS    0H                                                       08280000
*                                                                       08282019
*                                                                       08284019
*                   SEARCH THE DEVICE MASK TABLE                        08286019
*          FOR THE DEVICE TYPE OF THE VOLUME TO BE MOUNTED              08288019
*                                                                       08290019
*                                                                       08292019
         CLC   4(4,INLOOP),DEVICE       COMPARE DEVICE TYPES            08300000
         BE    DMTFOUND                 EQUAL                           08320000
         LA    INLOOP,0(WORK2,INLOOP)   UP DMT PTR                      08340000
         BCT   LOOP,DMTSRCH             LAST OF TABLE                   08360000
*                                       YES, NOT FOUND                  08380000
*                                                                       08383019
*                                                                       08386019
*             IF CAN'T FIND MATCH IN DMT, SEARCH THE UCBS               08389019
*                                                                       08392019
*                                                                       08395019
         STM   R4,R8,DMTAREA                                            08400000
         LA    ACCE,DMTENTRY                                            08420000
         USING DMTENTRY,ACCE                                            08440000
         L     R4,CVTPTR                                                08460000
         USING CVT,R4                                                   08480000
         L     R4,CVTILK2               POINTER TO UCB POINTER LIST     08500000
         DROP  R4                                                       08520000
         USING UCB,R5                                                   08540000
         SR    R6,R6                                                    08560000
         SR    R7,R7                                                    08580000
         XC    0(40,ACCE),0(ACCE)       CLEAR DMT ENTRY ENTRY           08600000
         MVC   DMTETYPE(4),DEVICE       MOVE IN DEVICE TYPE.            08620000
         LA    R8,DMTESRTS              POINTER TO FIRST BIT PATTERN WD 08640000
*                                       WORD IN NEW DMT ENTRY.          08660000
LOOP1    EQU   *                                               @ZM30153 08680003
         SR    R5,R5                   ZERO UCB REG            @ZM30153 08690003
         ICM   R5,3,0(R4)              GET UCB PTR             @ZM30153 08692003
         BZ    LOOP2                    YES                             08720000
         CLM   R5,3,FOXES+TWO          END OF UCB TABLE ?      @ZM30153 08730003
         BE    END                     BRCH IF YES             @ZM30153 08740003
*                                                                       08741020
**********                                                              08742020
*                                                                       08743020
*        SEARCH FOR MATCH OF DEVICE TYPES IN A UCB AND THE              08744020
*         VOLUME MOUNT REQUEST                                          08745020
*         (FOR DIRECT-ACCESS DEVICES, ONLY THE TRACK-OVERFLOW    A31436 08746020
*          BIT IS CHECKED IN THE OPTIONS BYTE)                   A31436 08747020
*                                                                       08748020
**********                                                              08749020
*                                                                       08750020
         TM    DEVICE+2,DASD            TEST DEVICE CLASS BYTE   A31436 08751020
*                                        OF THE VOLUME MOUNT     A31436 08752020
*                                        REQUEST'S DEVICE TYPE   A31436 08753020
         BO    TESTOPTS                 IF DIRECT ACCESS, BRANCH A31436 08754020
*                                        TO DO SPECIAL TESTS     A31436 08755020
         CLC   DEVICE(4),UCBTYP         IS THIS THE TYPE WE ARE LOOKING 08760000
*                                       FOR                             08780000
         BNE   LOOP2                    NO                              08800000
         B     HAVEMTCH                 HAVE FOUND DEVICE TYPE   A31436 08800620
*                                        MATCH                   A31436 08801220
TESTOPTS EQU   *                        ** DIRECT-ACCESS ONLY ** A31436 08801820
         CLC   DEVICE(1),UCBTYP         TEST FIRST BYTE OF THE   A31436 08802420
*                                        DEVICE TYPES            A31436 08803020
         BNE   LOOP2                    IF NOT EQUAL, BRANCH     A31436 08803620
         CLC   DEVICE+2(2),UCBTYP+2     TEST LAST TWO BYTES OF   A31436 08804220
*                                        THE DEVICE TYPES        A31436 08804820
         BNE   LOOP2                    IF NOT EQUAL, BRANCH     A31436 08805420
         TM    UCBTYP+1,TRKOFLOW        TEST TRACK-OVERFLOW BIT  A31436 08806020
*                                        IN UCB'S DEVICE MASK    A31436 08806620
         BO    TESTON                   IF ON, BRANCH            A31436 08807220
         TM    DEVICE+1,TRKOFLOW        TEST TRACK-OVERFLOW BIT  A31436 08807820
*                                        IN REQUEST'S MASK       A31436 08808420
*                                        (KNOW UCB'S BIT IS OFF) A31436 08809020
         BO    LOOP2                    IF ON, BRANCH (NO MATCH) A31436 08809620
         B     HAVEMTCH                 IF OFF, BRANCH (MATCH)   A31436 08810220
TESTON   EQU   *                                                 A31436 08810820
         TM    DEVICE+1,TRKOFLOW        TEST TRACK-OVERFLOW BIT  A31436 08811420
*                                        IN REQUEST'S MASK       A31436 08812020
*                                        (KNOW UCB'S BIT IS ON)  A31436 08812620
         BNO   LOOP2                    IF OFF, BRANCH (NO MATCH)A31436 08813220
HAVEMTCH EQU   *                                                 A31436 08813820
*                                                                       08814420
**********                                                              08815020
*                                                                       08815620
*        HAVE FOUND A UCB WITH THE CORRECT DEVICE TYPE. NOW TURN        08816220
*         ON THE UCB'S BIT IN THE MASK OF THE DUMMY DMT ENTRY           08816820
*                                                                       08817420
**********                                                              08818020
*                                                                       08818620
         AL    R6,ONE                   PUT A 1 IN THE BIT PATTERN      08820000
*                                        OF THE DUMMY DMT ENTRY         08830020
         LH    R0,DMTETYNO                                              08840000
         A     R0,ONE                   ADD ONE TO THE NO. OF DEVICES.  08860000
*                                        IN THE DUMMY DMT ENTRY         08870020
         STH   R0,DMTETYNO                                              08880000
LOOP2    LA    R7,1(0,R7)               COUNT OF UCB'S CHECKED MOD 32   08900000
         CH    R7,THIRTY2               IS THIS THE 32ND DEVICE CHECKED 08920000
         BE    LOOP3                    YES                             08940000
         SLL   R6,1(0)                                                  08960000
LOOP25   LA    R4,2(0,R4)               GET POINTER TO NEXT UCB         08980000
         B     LOOP1                                                    09000000
LOOP3    SR    R7,R7                                                    09020000
         ST    R6,0(0,R8)                                               09040000
         LA    R8,4(0,R8)               NEXT BIT PATTERN WORD           09060000
         SR    R6,R6                    CLEAR BIT PATTERN REG.          09080000
         B     LOOP25                                                   09100000
END      LA    R3,31    MAX NUMBER PLUS 1 OF POSITIONS TO SHIFT  PTM404 09120017
         SR    R3,R7                                                    09140000
         SLL   R6,0(R3)                                                 09160000
         ST    R6,0(0,R8)                                               09180000
         DROP  ACCE                                                     09200000
         DROP R5                                                        09210013
         LH    R4,DMTETYNO                                              09220000
         LTR   R4,R4                    ANY DEVICES FOUND               09240000
         LM    R4,R8,DMTAREA                                            09260000
         BZ    DTS                      NO MATCH FOUND IN UCB'S  A29718 09270019
*                                        - TAKE NOMOUNT EXIT     A29718 09280019
         LA    INLOOP,DMTENTRY                                          09300000
         B     DMTFOUND                 HAVE FOUND MATCH IN UCBS     CS 09305019
*                                       - GO CHECK WHETHER CAN       CS 09310019
*                                         ISSUE MOUNT ON THE DEVICE  CS 09315019
*                                                                       09325019
*                                                                       09335019
*          (SPECIAL PROCESSING IF HAVE FOUND MATCH FOR 2321)            09345019
*                                                                       09355019
*                                                                       09365019
MT2321   L     IT,PTRINTAB                                              09400513
         SR    LINK,LINK                                                09401013
         SR    R3,R3                                                    09401513
         IC    LINK,CNTINTAB                                            09402013
         LTR   LINK,LINK                TEST FOR ZERO DD CARDS   A29718 09402119
         BZ    DTS                      IF ZERO, TAKE NOMOUNT    A29718 09402219
*                                        EXIT                    A29718 09402319
**********                                                              09402420
*                                                                       09402520
*        2321 LOOP 1 - CHECK WHETHER THE VOLUME REQUESTED IS ALREADY    09402620
*                      MOUNTED IN A BIN                                 09402720
*                                                                       09402820
**********                                                              09402920
AGAIN    L     INLOOP,4(IT)             GET FIRST DD POINTER IN I.T.    09403020
         ICM   INLOOP,3,TIOTUCB(INLOOP) GET UCB PTR            @ZM30153 09403103
         N     INLOOP,FOXES            ZERO LEFT HALF OF REG   @ZM30153 09403203
         TM    2(INLOOP),X'FF'                                          09403513
         LA    LOOP,4(LOOP)             UP RTA FOR TABLE                09404013
         BC    12,NOWSUB                                                09404513
TRYAGAIN LA    IT,4(IT)                UP PTR TO NXT DDNAME PTR         09405013
         BCT   LINK,AGAIN                                               09405513
**********                                                              09405620
*                                                                       09405720
*       2321 LOOP 2 - CHECK WHETHER THE VOLUME REQUESTED CAN BE         09405820
*                      MOUNTED IN A BIN                                 09405920
*                                                                       09406020
**********                                                              09406120
         LTR   R3,R3                    TEST FOR SUBS FOUND IN LOOP 1   09406220
         BZ    DTS                      NO SUB - CANNOT MOUNT           09406513
         SR    LOOP,LOOP                                                09407013
         L     IT,PTRINTAB              MUST DO A DISMOUNT AND MOUNT    09407513
         IC    LINK,CNTINTAB            NUMBER OF INT TBL ENTRIES       09408013
         LA    LINK,1(LINK)                                             09408513
AGAIN2   LA    IT,4(IT)                 POINT TO DDNAME PTR             09409013
         BCTR  LINK,0                                                   09409513
         LTR   LINK,LINK                                                09410013
         BZ    DTS                                                      09410513
         L     INLOOP,0(IT)             PTR TO DD NAME                  09411013
         ICM   INLOOP,3,TIOTUCB(INLOOP) GET UCB ADDR           @ZM30153 09411103
         N     INLOOP,FOXES            ZERO LEFT HALF OF REG   @ZM30153 09411403
         TM    2(INLOOP),X'FF'          TEST FOR SUB UCB                09413803
         LA    LOOP,4(LOOP)             UP RTA FOR TABLE                09414503
         BC    12,ANYSUB                                                09415203
         B     AGAIN2                                                   09415903
NOWSUB   LA    R3,1(R3)                 INDIXATE SUB FOUND              09416603
         CLC   4(6,INLOOP),VSN          CHECK IF REQUIRED VOL PRESENT   09417303
         BE    CHKUNIT             GO CHECK IF SPECIFIC UNIT       DT0I 09418003
*                                  WAS SPECIFIED                   DT0I 09418703
         B     TRYAGAIN                                                 09419403
ANYSUB   DS    0H                                                       09420103
         TM    OFFSET3(INLOOP),REMOVABL IS THIS VOLUME REMOVABLE?    CS 09420803
         BM    AGAIN2                   NO. CANNOT DO MOUNT          CS 09421503
*                                        (RESERVED AND PERMANENTLY   CS 09422203
*                                         RESIDENT BITS MUST BE OFF  CS 09422903
*                                         IN UCB)                    CS 09423603
         TM    OFFSET2(INLOOP),SRTEBSVL IS THIS VOLUME SHARABLE? A27909 09424303
         BZ    AGAIN2                   YES. CANNOT MOUNT.       A27909 09425003
*                                        (SHARABLE IF BIT        A27909 09425703
*                                         IS OFF IN UCB)         A27909 09426403
         TM    INDICATO,MOUNT           MOUNT REQUESTED                 09427103
         BZ    ONUSE                                                    09427803
CKUNIT2  CLI   UNIT,X'00'          WAS SPECIFIC UNIT SPECIFIED     DT0I 09428503
         BE    TMNT2321            BRANCH ON NO                    DT0I 09429203
         CLI   UNIT+3,SLASH        WAS BIN NUMB SPECIFIED          DT0I 09429903
         BNE   GETMAIN             BRANCH ON NO                    DT0I 09430603
         CLC   1(1,INLOOP),UNIT+4  CHECK IF CORRECT BIN NUMB       DT0I 09431303
         BE    GETMAIN             BRANCH ON YES                   DT0I 09432003
         B     AGAIN2              GO GET ANOTHER UCB              DT0I 09432703
GETMAIN  SR    R2,R2                                               DT0I 09433403
         IC    R2,1(INLOOP)        PICK UP BIN NUMB AND            DT0I 09434103
         SLL   R2,4                CALCULATE MAIN UCB ADDR         DT0I 09434803
         LA    R2,56(R2)                                           DT0I 09435503
         SR    INLOOP,R2                                           DT0I 09436203
         CLC   UNIT(3),13(INLOOP)  IS THIS THE UNIT SPECIFIED      DT0I 09436903
         BNE   AGAIN2              NO GET ANOTHER UCB              DT0I 09437603
         B     TMNT2321            TRY TO MOUNT                    DT0I 09438303
CHKUNIT  CLI   UNIT,X'00'          WAS SPECIFIC UNIT SPECIFIED     DTOI 09439003
         BE    ONUSE               BRANCH ON NO                    DT0I 09439703
         CLI   UNIT+3,SLASH        CHECK IF BIN NUMB WAS SPECIFIED DT0I 09440403
         BNE   BACKUP              BRANCH ON NO                    DT0I 09441103
         NI    UNIT+4,X'0F'            TURN OFF ZONE BITS          DT0I 09441803
         CLC   1(1,INLOOP),UNIT+4  CHECK IF CORRECT BIN NUMB       DT0I 09442503
         BE    BACKUP              BRANCH ON YES TO CHECK UNIT     DT0I 09443203
         B     TRYAGAIN            GO CHECK ANOTHER UCB            DT0I 09443903
BACKUP   SR    R2,R2                                               DTOI 09444603
         IC    R2,1(INLOOP)        PICKUP BIN NUMB                 DT0I 09445303
         SLL   R2,4                AND CALCULTTE MAIN              DT0I 09446003
         LA    R2,56(R2)           UCB ADDR                        DT0I 09446703
         SR    INLOOP,R2                                           DT0I 09447403
         CLC   UNIT(3),13(INLOOP)  IS THIS THE SPECIFIC UNIT       DT0I 09448103
         BE    ONUSE               BRANCH ON YES                   DT0I 09448803
         B     TRYAGAIN            GO CHECK NEXT UCB               DT0I 09449503
*                                                                       09450203
*                                                                       09450903
*                                                                       09451603
*              HAVE FOUND MATCH FOR VOLUME'S DEVICE TYPE                09452303
*                                                                       09453003
*        NOW SEARCH THROUGH DEVICE MASKS FOR A UNIT MATCHING A DD       09453703
*        CARD'S ALLOCATION. (LOOP 1 - CHECK WHETHER VOLUME IS           09454403
*         ALREADY MOUNTED. LOOP 2 - LOOK FOR A VOLUME TO DISMOUNT       09455103
*         IN ORDER TO MOUNT THE VOLUME REQUESTED.)                      09455803
*                                                                       09456503
*                                                                       09457203
*                                                                       09457903
DMTFOUND DS    0H                                                HEADRS 09458603
         SR    LOOP,LOOP                SET UP FOR RTA                  09459303
         LA    LINK,4                   SET UP DECREMENT REG            09460000
         CLI   OFFSET7(INLOOP),X'05'    CHECK DEVICE TYPE IN DMT     CS 09465019
*                                        ENTRY                       CS 09470019
         BE    MT2321                   BRANCH IF 2321               CS 09475019
GETMSKS  DS    0H                                                       09480000
         L     ACCE,0(WORK)             GET A WORD OF OUR MASK          09500000
         L     ACCO,8(INLOOP)           GET DMT MASK                    09520000
         LA    WORK,4(WORK)             UP BOTH MASK POINTERS           09540000
         LA    INLOOP,4(INLOOP)          TO NEXT WORD TO CHECK       CT 09544020
*                                                                       09548020
**********                                                              09552020
*                                                                       09556020
*        'AND' A WORD OF INTERNAL TABLE MASK WITH A WORD OF THE         09560020
*         DMT MASK TO FIND MATCHING BITS                                09564020
*                                                                       09568020
**********                                                              09572020
*                                                                       09576020
         NR    ACCO,ACCE                AND REGS TO FIND MATCHES        09580000
         LA    WORK2,32                 CONTROL FOR LOOP THROUGH     CT 09590020
*                                        BITS IN REGISTERS           CT 09600020
SHIFTBOT DS    0H                                                    CT 09610020
         LTR   ACCE,ACCE                TEST AND                     CT 09620020
         SLL   ACCE,ONEBIT               SHIFT OUR MASK REGISTER     CT 09630020
*                                        ONE BIT                     CT 09640020
         BM    UPRTA                    BRANCH IF BIT ON             CT 09650020
*                                        (CORRESPONDS TO A DD CARD)  CT 09660020
TESTAN   DS    0H                                                       09700000
         LTR   ACCO,ACCO                TEST AND                        09720000
*                                                                       09724020
**********                                                              09728020
*                                                                       09732020
*        BRANCH OUT OF LOOP THROUGH MASKS WHEN FIND A BIT ON            09736020
*         (HAVE FOUND A UCB MATCHING A DD CARD)                         09740020
*                                                                       09744020
**********                                                              09748020
*                                                                       09752020
         SLL   ACCO,ONEBIT              SHIFT MATCH REGISTER         CT 09756020
*                                        ONE BIT                     CT 09760020
         BM    POSMOUNT                 BRANCH IF BIT ON             CT 09764020
*                                        (MEANS UCB MATCHES DD CARD) CT 09768020
CONSCH1  DS    0H                                                       09780000
         BCT   WORK2,SHIFTBOT           LOOP ON 32 BITS OF ANDED     CT 09800020
*                                        REGISTER                    CT 09820020
         SR    IT,LINK                  CHECK NUMBER OF WORDS LEFT   CT 09840020
*                                        TO CHECK IN MASKS           CT 09860020
         BP    GETMSKS                  IF GREATER THAN ZERO, BRANCH CT 09880020
         B     BB1(SEARCH)                                              09900000
BB1      B     SS1                                                      09920000
         L     IT,PTRINTAB                                              09940000
         B     DTS                      HAVE FAILED TO FIND A        CT 09950020
*                                        VOLUME TO DISMOUNT          CT 09960020
*                                        - TAKE ERROR EXIT           CT 09970020
SS1      LA    SEARCH,4                 LOAD DEVICE TYPE SEARCH INDIC   09980000
         B     DEV                      START SECOND LOOP THROUGH    CT 09986020
*                                        MASKS - THIS TIME LOOK FOR  CT 09992020
*                                        A DEVICE TO DISMOUNT        CT 09998020
*                                        RATHER THAN FOR A VOLUME    CT 10004020
*                                        WHICH IS ALREADY MOUNTED    CT 10010020
UPRTA    DS    0H                       INCREMENT RELATIVE TABLE ADDR   10020000
         LA    LOOP,4(LOOP)              TO NEXT DD CARD POINTER     CT 10030020
*                                        IN INTERNAL TABLE           CT 10040020
         B     TESTAN                                                   10060000
POSMOUNT EQU   *                                                        10080000
         LR    R0,IT                   SAVE REMAINING LENGTH     A45128 10081022
         L     IT,PTRINTAB             START OF INT. TABLE       A45128 10082022
         LH    WORK3,2(IT)             MASK DISPLACEMENT         A45128 10083022
         LH    IT,2(WORK3,IT)          TOTAL MASK LENGTH         A45128 10084022
         SR    IT,R0                   DETERMINE F/W FIELD       A45128 10084822
         SLL   IT,4                    OFFSET IN UCBLUT          A45128 10085622
         LA    LINK,32                 BITS PER F/W              A45128 10086022
         SR    LINK,WORK2              OFFSET IN BITS            A45128 10087022
         SLL   LINK,1                  OFFSET IN UCBLUT FIELD    A45128 10088022
         AR    LINK,IT                 OFFSET IN UCBLUT          A45128 10090022
*                                                                A45128 10091022
         L     IT,COMTAB               FIND CVT ADDRESS          A45128 10092022
         L     IT,IUCB(IT)             POINTER TO UCBLUT         A45128 10093022
         AR    IT,LINK                 ADD IN INDEX            @ZM30153 10093403
         ICM   IT,3,0(IT)              GET UCB PTR             @ZM30153 10094403
         N     IT,FOXES                ZERO LEFT HALF OF REG   @ZM30153 10094803
         LA    LINK,4                  RESTORE LINK              A45128 10095022
         B     DEVDEC1(SEARCH)                                          10100000
DEVDEC1  B     S1                                                       10120000
**********                                                              10122019
*                                                                       10124019
*        MATCH IN LOOP 2 -                                              10125020
*            TEST WHETHER THIS VOLUME CAN BE DISMOUNTED IN ORDER        10126019
*             TO MOUNT THE REQUESTED VOLUME                             10128019
*            (IF NOT, CONTINUE SEARCHING)                               10130019
*                                                                       10132019
**********                                                              10134019
D1       DS    0H                                                       10140000
         LR    WORK3,IT                 POINTER TO UCB           A45128 10160022
         L     IT,PTRINTAB              GET TABLE POINTER               10180000
         LA    IT,0(LOOP,IT)                                            10200000
         TM    0(IT),USAGE              TEST IF IN USE                  10220000
         BO    CONSCH                   IF YES CONTINUE SEARCH          10240000
         USING UCB,WORK3                                         A27909 10286019
         TM    SRTESTAT,REMOVABL        IS THIS VOLUME REMOVABLE?    CS 10292019
         BM    CONSCH                   NO. CANNOT DO MOUNT          CS 10298019
*                                        (RESERVED AND PERMANENTLY   CS 10304019
*                                         RESIDENT BITS MUST BE OFF  CS 10310019
*                                         IN UCB)                    CS 10316019
         TM    UCBTBYT3,UCB3TAPE        IS THIS VOLUME A TAPE?   A27909 10322019
         BO    SKIPTEST                 YES. DON'T TEST WHETHER  A27909 10328019
*                                        SHARABLE. (ALL TAPES    A27909 10334019
*                                        ARE NON-SHARABLE)       A27909 10340019
         TM    SRTESTAB,SRTEBSVL        IS THIS VOLUME SHARABLE? A27909 10346019
         BZ    CONSCH                   YES. CANNOT MOUNT.       A27909 10352019
*                                        (SHARABLE IF BIT        A27909 10358019
*                                         IS OFF IN UCB)         A27909 10364019
SKIPTEST DS    0H                                                A27909 10370019
         CLI   UNIT,X'00'              WAS A UNIT ADDR SPECIFIED   DT0I 10376018
         BE    TMOUNT                  NO, MOUNT VOLUME            DT0I 10380018
         CLC   UCBUNIT(3,WORK3),UNIT   IS THIS THE UNIT SPECIFIED  DT0I 10384018
         BE    TMOUNT                  BRANCH ON YES               DT0I 10388018
         B     CONSCH                                              DT0I 10392018
         DROP  WORK3                                             A27909 10396019
**********                                                              10396619
*                                                                       10397219
*        MATCH IN LOOP 1 -                                              10397520
*            TEST WHETHER THE REQUESTED VOLUME IS ALREADY MOUNTED       10397819
*                                                                       10398419
**********                                                              10399019
S1       DS    0H                                                       10400000
*                                                                       10500000
         CLI   18(IT),X'08'             UNIT RECORD DEVICE              10520000
         BE    ONUSE                    YES, INDICATE MOUNTED           10540000
*                                       COMPARE VSN S                   10560000
         CLC   UCBVSN(6,IT),VSN         VOLUME SERIALS EQUAL            10580000
         BE    CHKADR                  YES,CHECK IF MOUNTED ON     DT0I 10590018
*                                      CORRECT UNIT                DT0I 10600018
CONSCH   DS    0H                                                       10620000
         LR    IT,R0                                                    10640000
         B     CONSCH1                                                  10660000
CHKADR   EQU   *                                                   DT0I 10662018
         CLI   UNIT,X'00'               WAS UNIT ADDR SPECIFIED    DT0I 10670018
         BE    ONUSE                   BRANCH ON NO                DT0I 10672018
         CLC   UCBUNIT(3,IT),UNIT      IS THIS THE UNIT SPECIFIED  DT0I 10674018
         BE    ONUSE                   BRANCH ON YES               DT0I 10676018
         B     CONSCH                                              DT0I 10678018
TMOUNT   DS    0H                  DECISION                             10680000
         TM    INDICATO,MOUNT           IS MOUNTING BIT ON              10700000
         BZ    ONUSE                    IF NO, BRANCH TO "ONUSE" TO     10720000
*                                            SET UP USAGE BIT AND       10740000
*                                            RELATIVE TABLE ADDRESS     10760000
*                                       IF YES, PROCEED TO GET VOLUMES  10780000
*                                            MOUNTED                    10800000
*                                                                       10820000
*                                                                       10830019
*                   MOUNT VOLUME BY MEANS OF OPENJ                      10840019
*                   ******************************                      10850019
*                                                                       10860019
*               ONLY DIRECT ACCESS DEVICES ARE MOUNTED                  10870019
*                                                                       10900000
         L     ACCO,0(IT)                                               10920000
         ICM   ACCO,3,TIOTUCB(ACCO)    GET UCB ADDR            @ZA25503 10922099
         N     ACCO,FOXES              ZERO HIGH BYTES         @ZM30153 10932099
         CLI   UCBDEVT(ACCO),X'20'                                      10960000
         BNE   ONUSE                                                    10980000
TMNT2321 L     ACCE,0(IT)               POINT TO DDNAME FOR MOUNT       11000013
*             (IF NOT, CONTINUE SEARCHING)                              11030020
         STM   RETURN,PARAMPTR,SAVEREG SAVE REGISTERS PRIOR TO    M0313 11080020
*                                      OPEN & CLOSE               M0313 11130020
         MVI   JFCB+117,ONEVOL          INDICATE JFCB IS FOR ONE     CT 11190020
*                                        VOLUME                      CT 11200020
         LA    ACCO,OPENJDCB                                            11220000
         MVC   DCBDDNAM-IHADCB(8,ACCO),0(ACCE)  PUT DDNAME IN DCB    CT 11227020
*                                                FOR THE OPENJ       CT 11234020
         MVC   JFCB+118(6),VSN          PUT VOLSER IN JFCB FOR THE   CT 11241020
*                                        OPENJ                       CT 11248020
*                                       ISSUE THE OPENJ MACRO (THE   CT 11255020
*                                        OPERATOR WILL RECEIVE AN    CT 11262020
*                                        IEC101A MESSAGE TO MOUNT    CT 11269020
         OPEN  (OPENJDCB,INPUT),TYPE=J   THE VOLUME)                 CT 11276020
*                                       CLOSE THE DCB USED TO    A27790 11290019
         CLOSE (OPENJDCB,REREAD)         MOUNT THE VOLUME        A27790 11300019
*                                                                       11320000
         LM    RETURN,PARAMPTR,SAVEREG RELOAD REGISTERS           M0313 11350020
*                                                                       11381019
*                                                                       11382019
*                TURN ON USAGE BIT IN INTERNAL TABLE                    11383019
*                  AND INDICATE MOUNT IN ITHEADER                       11384019
*                ***********************************                    11385019
*                                                                       11386019
*                                                                       11387019
ONUSE    STH   LOOP,RTA                                          HEADRS 11388019
         L     IT,PTRINTAB                                       HEADRS 11389019
         LA    IT,OFFSET0(IT)           GET DD POINTER           HEADRS 11390019
         AR    IT,LOOP                  ADD IN RTA               HEADRS 11391019
         LR    LOOP,RETURN                                       HEADRS 11392019
         OI    OFFSET0(IT),USAGE        TURN ON USAGE BIT IN     HEADRS 11393019
*                                        INTERNAL TABLE          HEADRS 11394019
         OI    INDICATO,YESMOUNT        CALCULATE RTA AND        HEADRS 11395019
*                                        INDICATE A MOUNT        HEADRS 11396019
         B     STEPVSN                  BRANCH TO STEPVSN (STEP  HEADRS 11397019
*                                        TO NEXT VOLUME SERIAL   HEADRS 11398019
*                                        NUMBER)                 HEADRS 11399019
*                                                                       11400019
*                                                                       11421019
*                                                                       11427019
*                      INDICATE VOLUME NOT FOUND                        11433019
*                      *************************                        11439019
*                                                                       11445019
DTS      DS    0H                                                HEADRS 11451019
         OI    INDICATO,NOMOUNT         TURN ON NOMOUNT BIT IN   A29718 11455019
*                                        ITHEADER                A29718 11459019
         B     RETURNA                  RETURN TO CALLER         A29718 11463019
*                                        (IGNORE ANY OTHER       A29718 11467019
*                                         VOLUME MOUNT REQUESTS) A29718 11471019
STEPVSN  DS    0H                       GET VOLUME SERIAL NUMBER POINT  11480000
         LA    VMREQUST,MOUNTREQ(VMREQUST)                         DT0I 11500018
*                                                                       11520000
*                                                                       11540000
*                                  LOOP CONTROL  FOR INNER LOOP "B"     11560000
         BCT   LOOP,LOOPB               HAS LAST VOLUME SERIAL NUMBER   11580000
*                                            BEEN HANDLED               11600000
*                                       IF NO, BRANCH TO "LOOPB" TO     11620000
*                                            CONTINUE SEARCH ON VOLUME  11640000
*                                            SERIAL NUMBERS             11660000
*                                       IF YES, PROCEED TO TEST FOR     11680000
*                                            COMPLETION OF OUTER LOOP   11700000
*                                                                       11720000
*********************************************************************** 11724019
*********************************************************************** 11728019
**                                                                   ** 11732019
**                     RETURN TO CALLING PROGRAM                     ** 11736019
**                                                                   ** 11740019
*********************************************************************** 11744019
*********************************************************************** 11748019
*                                                                       11752019
RETURNA  DS    0H                                                HEADRS 11756019
         L     R13,4(R13)              CURRENT SA= OLD SA         M0313 11758020
         RETURN (14,12),T,RC=0                                          11760000
*                                                                       11763019
*********************************************************************** 11766019
*********************************************************************** 11769019
**                                                                   ** 11772019
**                ENTRY POINT TO BUILD INTERNAL TABLE                ** 11775019
**                                                                   ** 11778019
*********************************************************************** 11781019
*********************************************************************** 11784019
*                                                                       11787019
ENTERHER DS    0H                                                HEADRS 11790019
         BALR  BASE,R0                  SET UP ADDRESSABILITY           11800000
         USING *,BASE                   INFORM ASSEMBLER                11820000
*                                                                       11840000
*                                                                       11860000
*                                  PROCESS                              11880000
*                                       ESTABLISH POINTER TO TIOT       11900000
         L     ACCE,COMTAB              GET ADDRESS OF COMMUNICATIONS   11920000
*                                            TABLE                      11940000
         L     ACCE,CMTTCB2(ACCE)       GET ADDRESS OF DOUBLE WORD      11960000
*                                            TCB POINTERS               11980000
         L     ACCE,4(ACCE)             GET TCB ADDRESS                 12000000
         L     TIOT,TCBTIOT(ACCE)       GET TIOT ADDRESS                12020000
         LA    TIOT,TIOTFOUN(TIOT)      STEP TIOT ADDRESS PAST          12040000
*                                            FOUNDATION                 12060000
   CLC   41(3,ACCE),Z                                                   12080000
     BE   NOTJOBLB                                                      12100000
         CLC   TIOTDDNA(8,TIOT),JOBLIB  CHECK WHETHER FIRST TIOT A32626 12103020
*                                        ENTRY IS FOR JOBLIB DD  A32626 12106020
         BNE   NOTJOBLB                 IF NO, BRANCH (HAD STEP- A32626 12109020
*                                        LIB, NOT JOBLIB, ENTRY  A32626 12112020
*                                        IN TCB)                 A32626 12115020
    LA   TIOT,TIOTENTR(TIOT)                                            12120000
NOTJOBLB DS    0H                  PROCESS                              12140000
         LA    SEARCH,0                 SET INDEX TO BYPASS TABLE       12160000
*                                       BUILDING LOOP                   12180000
PRESET   DS    0H                  PROCESS                              12200000
*                                       (ASSUME PARAMPTR, TIOT, AND     12206019
*                                        SEARCH REGISTERS ARE PRESET)   12212019
         LR    ACCE,TIOT                SET UP POINTERS FOR NOT         12220000
         L     IT,PTRINTAB                   BUILD LOOP                 12240000
*                                       TIOT AND INTERNAL TABLE         12260000
*                                            POINTERS                   12280000
         SR    ACCO,ACCO                ZERO REGISTER TO COUNT NUMBER   12300000
*                                       OF ENTRIES NEEDED IN INT. TABLE 12320000
*                                                                       12322019
*********************************************************************** 12324019
*                                                                     * 12326019
*                    TWO-PASS LOOP TO SEARCH TIOT                     * 12328019
*                                                                     * 12330019
*********************************************************************** 12332019
*                                                                       12334019
SCHTIOT  DS    0H                  PROCESS                              12340000
         SR    LOOP,LOOP                FETCH TIOT ENTRY LENGTH         12360000
*                                                                       12380000
         IC    LOOP,TIOTLEN(ACCE)       LOOP CONTAINS TIOT LENGTH       12400000
*                                                                       12420000
*                                                                       12440000
*                                  DECISION                             12460000
         LTR   LOOP,LOOP                IS THIS LAST ENTRY IN TIOT      12480000
         BZ    ENDTIOT                  IF YES, BRANCH TO ENDTIOT TO    12500000
*                                            DETERMINE RESULTS OF TIOT  12520000
*                                           SCAN                        12540000
*                                                                       12560000
*                                                                       12580000
*                                  DECISION                             12600000
         CLC   TIOTDDNA(8,ACCE),BLANK   IS DDNAME BLANK                 12620000
         BE    UPTIOT                   IF YES, BRANCH TO UPTIOT TO     12640000
         CLC   TIOTDDNA(8,ACCE),SYSAB   IS DDNAME SYSABEND         2711 12645014
         BE    UPTIOT                   YES,BRANCH TO EXCLUDE      2711 12650014
*                                          THIS DD ENTRY           2711 12655014
         CLC   TIOTDDNA(8,ACCE),SYSUDMP  IS DDNAME SYSUDUMP        4919 12656016
         BE    UPTIOT                  YES, BRANCH TO EXCLUDE      4919 12657016
*                                      THIS DD ENTRY               4919 12658016
         CLC   TIOTDDNA(8,ACCE),STPLIB  IS DDNAME STEPLIB          SL0H 12658517
         BE    UPTIOT                   YES, BRANCH TO EXCLUDE     SL0H 12659017
*                                       THIS DD ENTRY              SL0H 12659517
*                                  PROCESS                              12660000
         SR    LOOP,LOOP                                                12680000
         IC    LOOP,GENERICC                                            12700000
*                                                                       12720000
*                                                                       12740000
*                                  DECISION                             12760000
         LTR   LOOP,LOOP                IS GENERIC COUNT ZERO           12780000
         BZ    ISBUILD                  IF YES, BRANCH TO "ISBUILD" TO  12800000
*                                            GENERIC NAME SEARCH        12820000
*                                                                       12840000
*                                                                       12860000
*                                  INITIALIZE LOOP ON GENERIC NAMES     12880000
         L     INLOOP,GENERICP          FETCH GENERIC TABLE ADDRESS     12900000
*                                  DECISION                             12920000
GENLOOP  DS    0H                       IS GENERIC NAME EQUAL TO        12940000
         CLC   TIOTDDNA(8,ACCE),0(INLOOP)   DDNAME                      12960000
         BE    UPTIOT                  IF YES, BRANCH TO UPTIOT TO      12980000
*                                            OMIT DDNAME FROM INTERNAL  13000000
*                                            TABLE                      13020000
*                                                                       13040000
*                                                                       13060000
*                                  PROCESS                              13080000
         LA    INLOOP,8(INLOOP)         INCREMENT GENERIC NAME POINTER  13100000
*                                                                       13120000
*                                                                       13140000
*                                  LOOP CONTROL                         13160000
         BCT   LOOP,GENLOOP             ARE THERE MORE GENERIC NAMES    13180000
*                                       IF YES, BRANCH TO START OF      13200000
*                                            LOOP "GENLOOP"             13220000
*                                       IF NO, PROCEED WITH TABLE       13240000
*                                            BUILDING                   13260000
ISBUILD  DS    0H             BRANCH ENTRY POINT ENTERED AFTER ALLOWING 13280000
*                             FOR GENERIC DDNAMES                       13300000
*                                  DECISION                             13320000
         B     DECIDEBL(SEARCH)         IS THIS BUILD LOOP              13340000
DECIDEBL B     NBLD                     IF NOT BUILD LOOP, BRANCH TO    13360000
*                                            NBLD                       13380000
         B     BLD                      IF BUILD LOOP BRANCH TO BLD     13400000
NBLD     DS    0H                  PROCESS                              13420000
         SR    LOOP,LOOP                                         A45128 13430022
         IC    LOOP,2(ACCE)            NBR OF DEVICES            A45128 13432022
         LTR   LOOP,LOOP         IS NUMB&R OF DEVICES 0           M3250 13432600
         BNP   UPTIOT            IF YES, NO SPACE NEEDED IN I.T.  M3250 13433200
NEXTDEV1 DS    0H                                                A45128 13434022
         LA    IT,4(IT)                 INCREMENT INTERNAL TABLE        13440000
         LA    ACCO,1(ACCO)             TABLE ADDRESS AND COUNT         13460000
*                                       OF ENTRIES NEEDED IN INT. TABLE 13480000
         BCT   LOOP,NEXTDEV1           MORE DEVICES              A45128 13490022
UPTIOT   DS    0H                  PROCESS                              13500000
         SR    LOOP,LOOP                                           7296 13510017
         IC    LOOP,TIOTLEN(ACCE)  PLACE DD ENTRY LENGTH IN LOOP   7296 13520017
         LA    ACCE,0(LOOP,ACCE) UP ACCE TO POINT TO NEXT DD ENTRY 7296 13530017
*                                                                       13540000
         B     SCHTIOT                  BRANCH TO SCHTIOT TO INSPECT    13560000
*                                            NEXT TIOT ENTRY            13580000
BLD      DS    0H             BRANCH POINT FOR BUILD LOOP               13600000
         SR    SEARCH,SEARCH                                     A45128 13610022
         SR    INLOOP,INLOOP                                     A45128 13612022
         IC    INLOOP,2(ACCE)          NBR OF DEVICES            A45128 13614022
         LTR   INLOOP,INLOOP     IS NUMBER OF DEVICES 0           M3250 13614600
         BNP   SKIP              IF YES, DON'T FILL I. T.         M3250 13615200
NEXTDEV2 DS    0H                                                A45128 13616022
         LA    LOOP,TIOTDDNA(ACCE)      PLACE DDNAME ADDRESS IN         13620000
         ST    LOOP,4(IT)                    INTERNAL TABLE             13640000
         STC   SEARCH,4(IT)            INDIC DEV POSITION        A45128 13650022
         LA    SEARCH,1(SEARCH)        FOR NEXT POSITION         A45128 13652022
*                                                                       13660000
*                                                                       13680000
*                                  PROCESS                              13700000
         LA    IT,4(IT)                 UPDATE INTERNAL TABLE POINTER   13720000
         BCT   INLOOP,NEXTDEV2         MORE DEVICES              A45128 13722022
SKIP     DS    0H                                                 M3250 13723000
         LA    SEARCH,4                RESTORE SEARCH            A45128 13724022
         SR    LOOP,LOOP                                           7296 13730017
         IC    LOOP,TIOTLEN(ACCE)  PLACE DD ENTRY LENGTH IN LOOP   7296 13740017
         LA    ACCE,0(LOOP,ACCE) UP ACCE TO POINT TO NEXT DD ENTRY 7296 13750017
*                                                                       13760000
         B     SCHTIOT                  BRANCH TO  SCHTIOT TO INSPECT   13780000
*                                            NEXT TIOT ENTRY            13800000
ENDTIOT  DS    0H             BRANCH POINT ENTERED AT END OF TIOT SEARC 13820000
         B     DECBUILD(SEARCH)         IS THIS A BUILD LOOP            13840000
DECBUILD B     CHKSPCE                  NO                              13860000
         B     CHKDUP                   YES                             13880000
*                                                                       13882019
*********************************************************************** 13884019
*                                                                     * 13886019
*         COMPUTE AMOUNT OF SPACE NEEDED FOR INTERNAL TABLE           * 13888019
*                                                                     * 13890019
*********************************************************************** 13892019
*                                                                       13894019
CHKSPCE  LA    IT,OFFSET4(IT)           IT = SPACE NEEDED FOR DD        13904019
*                                        ENTRIES + 4 BYTE HEADER        13914019
         L     LOOP,PTRINTAB            GET ADDRESS OF IT (SHOULD       13924019
*                                        BE ZEROED)                     13934019
         LA    LOOP,OFFSET0(LOOP)       ZERO OUT HIGH-ORDER BYTE        13944019
         SR    IT,LOOP                  COMPUTE IT LENGTH SO FAR        13954019
         STC   ACCO,CNTINTAB            SAVE NUMBER OF DD ENTRIES       13964019
*                                        FOR IT IN ITHEADER             13974019
         STH   IT,LENINTAB              SAVE LENGTH OF HEADER AND       13984019
*                                        DD PORTION OF IT IN            13994019
*                                        ITHEADER                       14004019
*                                                                       14014019
*                                                                       14024019
*                     CALCULATE DEVICE MASK SIZE                        14034019
*                (THIS MASK WILL BE PLACED IN THE IT,                   14044019
*                  AND USED TO COMPARE WITH DMT ENTRIES)                14054019
*                                                                       14064019
*                                                                       14074019
         LA    R0,0(IT)                 LOAD AMOUNT OF CORE NEEDED      14160000
         L     ACCE,COMTAB              GET POINTER TO COMTAB           14180000
         L     ACCE,IUCB(ACCE)          GET UCB TABLE POINTER           14200000
         SR    LOOP,LOOP                LOOP WILL HOLD COUNT OF         14210019
*                                        ENTRIES IN UCB LOOK-UP TABLE   14220019
         LR    ACCO,ACCE                SAVE ADDRESS OF UCB LUT FOR     14230019
*                                        LATER USE                      14240019
UCBLOOK  TM    OFFSET0(ACCE),HEXFF                                      14250019
         BNO   UPPTR                                                    14260019
         TM    OFFSET1(ACCE),HEXFF      HAVE FOUND X'FFFF' AT END       14270019
*                                        OF UCB LUT?                    14280019
         BO    ENDUCB                   IF SO, STOP COUNTING ENTRIES    14290019
UPPTR    LA    LOOP,ONEBIT(LOOP)        UP COUNT OF ENTRIES IN UCB LUT  14300019
         LA    ACCE,OFFSET2(ACCE)       POINT TO NEXT HALFWORD IN LUT   14310019
         B     UCBLOOK             BRANCH TO LOOP                       14360000
*                                                                       14363019
*                                                                       14366019
*             ADJUST THE MASK SIZE IF 2321S ARE SYSGENNED               14369019
*                                                                       14372019
*                                                                       14375019
ENDUCB   DS    0H                                                       14380000
         LR    ACCE,LOOP         NO. OF BITS FOR PART ONE OF MASK  1415 14390014
*                                                                       14410013
*                                                                       14412013
*                                      ACCO HAS ADDRESS OF UCB LUT      14415019
*                                                                       14418019
         SR    SEARCH,SEARCH           USE SEARCH TO KEEP COUNT OF THE  14422013
*                                         NUMBER OF 2321                14424013
         SR    LOOP,LOOP               USE LOOP FOR THE BASE REG IN     14426013
*                                         REFERANCING THE UCB           14428013
         SR    R0,R0                   USE R0 TO KEEP NUMBER OF UCB     14430013
*                                         PTRS AT END OF TIOT           14432013
         USING UCB,LOOP                                                 14434013
NEXTUCB  CLC   0(2,ACCO),Z              CHECK FOR 2 BYTES OF ZERO       14436013
         BE    NOT2321                    BRANCH ON YES                 14438013
         SR    LOOP,LOOP               ZERO WORK REG           @ZM30153 14438403
         ICM   LOOP,3,0(ACCO)           GET UCB ADDR           @Z30AAAG 14440003
         TM    UCBTYP+2,X'20'                                           14442013
         BC    12,NOT2321                                               14444013
         CLI   UCBTYP+3,X'05'          IS THIS A 2321 UCB        S20201 14445020
         BNE   NOT2321                  NO,NEXT UCB LUT ENTRY    S20201 14446020
****                                                             A23794 14448119
*                                                                A23794 14448219
*     DON'T COUNT ALTERNATE CHANNEL POINTERS TO UCBS (FOR 2321S) A23794 14448319
*                                                                A23794 14448419
****                                                             A23794 14448519
         LA    WORK2,UCBPTRS            USE WORK2 TO POINT TO    A23794 14448619
*                                        2321 POINTERS (KEPT IN  A23794 14448719
*                                        WORK SPACE)             A23794 14448819
         LTR   SEARCH,SEARCH            TEST NUMBER OF 2321S     A23794 14448919
*                                        FOUND                   A23794 14449019
         BZ    IS2321                   IF ZERO, COUNT THIS      A23794 14449119
*                                        POINTER                 A23794 14449219
         LR    WORK3,SEARCH             USE WORK3 TO BCT THROUGH A23794 14449319
*                                        2321 POINTERS           A23794 14449419
CHKPTR   CLM   LOOP,3,0(WORK2)         TEST UCB POINTERS       @ZM30153 14449503
         BE    NOT2321                  IF EQUAL, HAVE AN ALTER- A23794 14453603
*                                        NATE CHANNEL POINTER    A23794 14455203
*                                        (DON'T COUNT IT)        A23794 14456803
         LA    WORK2,TWOBYTES(WORK2)    POINT TO NEXT 2321 PTR.  A23794 14458403
         BCT   WORK3,CHKPTR             LOOP THROUGH 2321 PTRS.  A23794 14460003
****                                                                    14461603
*                                                                       14463203
*                      INCREMENT COUNT OF 2321S                         14464803
*                                                                       14466403
****                                                                    14468003
IS2321   LA    SEARCH,OFFSET1(SEARCH)   ADD ONE TO NUMBER OF 2321S      14469603
         CH    SEARCH,MAXCOUNT          TEST NUMBER OF 2321S     A23794 14471203
         BH    ITERROR                  IF > 30, DON'T HAVE      A23794 14472803
*                                        ENOUGH WORK SPACE       A23794 14474403
*                                        (TAKE ERROR EXIT)       A23794 14476003
         STH   LOOP,0(WORK2)            SAVE THIS 2321 POINTER   A23794 14477603
*                                        IN WORK SPACE           A23794 14479203
NOT2321  LA    ACCO,2(ACCO)             UPDATE UCB POINTER              14480803
         TM    0(ACCO),X'FF'            IS THIS THE END OF THE UCB      14482403
*                                         LOOK UP TABLE                 14484003
         BC    12,NEXTUCB                IF NO TAKE ONE OF THE BRANCHES 14485603
         TM    1(ACCO),X'FF'                                            14487203
         BC    12,NEXTUCB                                               14488803
*                                         FALL THROUGH IF YES           14490403
         DROP  LOOP                                                     14492003
HAVE2321 LTR   SEARCH,SEARCH           WERE THERE ANY 2321              14493603
         BZ    NORMAL                                                   14495203
         LA    ACCE,2(ACCE)   2 BYTES SEPARATING 2 PARTS OF MASK   1415 14496803
         LR    ACCO,SEARCH                                              14498403
         LR    R0,SEARCH                                                14500003
         LR    SEARCH,ACCE             SAVE PREVIOUSLY CALCULATED VALUE 14501603
         SR    ACCE,ACCE                  FOR INTERNAL TABLE            14503203
         M     ACCE,TEN                 MULTIPLY NUMBER OF 2321S        14504803
*                                        BY 10 TO GET NUMBER OF         14506403
*                                        BIN POINTERS (RESULT IS        14508003
*                                        IN REGISTER ACCO)              14509603
         AR    ACCO,SEARCH              GET TOTAL BITS IN MASK          14511203
         A     R0,ONE                                                   14512803
         SRL   R0,1                    DIVIDE BY 2                      14514403
         SLL   R0,2                    MUL BY 4                         14516003
*                                       (ROUND NUMBER OF 2321S          14517603
*                                        TO NEXT MULTIPLE OF 4)         14519203
*                                                                       14520803
         LR    ACCE,ACCO                                                14522403
*                                                                       14524003
*                                                                       14525603
*                COMPUTE SIZE OF DEVICE MASK IN BYTES,                  14527203
*                     ROUNDED TO NEXT FULLWORD                          14528803
*                                                                       14530403
*                                                                       14532003
NORMAL   LA    ACCE,31(ACCE)            ROUND TOTAL MASK LENGTH    1415 14533603
         SRL   ACCE,5                    AND CONVERT TO FULL WORDS 1415 14535203
         SLL   ACCE,2                    LENGTH                    1415 14536803
         LR    ACCO,ACCE                                                14538403
         AR    ACCO,IT                                                  14540000
         LA    ACCO,OFFSET8(ACCO)       ADD FOUR BYTES FOR MASK    I276 14544019
*                                        LENGTH AND FOUR BYTES     I276 14548019
*                                        FOR DMT ADDRESS           I276 14552019
*                                                                       14556019
*********************************************************************** 14560019
*                                                                     * 14564019
*               GET CORE SPACE FOR THE INTERNAL TABLE                 * 14568019
*                                                                     * 14572019
*********************************************************************** 14576019
*                                                                       14580019
         AR    R0,ACCO                  R0 HAS NUMBER OF BYTES TO       14584019
*                                      GETMAIN FOR IT             M0313 14588020
         LR    LOOP,PARAMPTR           SAVE PTR TO IT HEADER      M0313 14592020
         ST    R0,SAVER0               SAVE GETMAIN SIZE          M0313 14596020
*                                      ACROSS GETMAIN             M0313 14600020
*                                                                       14608019
         GETMAIN R,LV=(R0)              ISSUE GETMAIN                   14612019
         L     R0,SAVER0               RESTORE REGISTER           M0313 14616020
*                                                                       14620619
*                                                                       14621219
*                       ZERO OUT INTERNAL TABLE                         14621819
*                                                                       14622419
*                                                                       14623019
         LR    WORK2,R0                 GET LENGTH OF INTERNAL TABLE    14623619
         LR    WORK3,PARAMPTR           GET ADDRESS OF INTERNAL TABLE   14624219
         LH    INLOOP,MAXIXC            PUT 255 IN INLOOP - MAXIMUM     14624819
*                                        LENGTH FOR EXECUTE INSTRUCTION 14625419
ZEROTABL C     WORK2,MAXSIZE                                            14626019
         BNH   LASTXC                                                   14626619
         EX    INLOOP,XCINSTR           ZERO OUT 256 BYTES OF INTERNAL  14627219
*                                        TABLE                          14627819
         S     WORK2,MAXSIZE                                            14628419
         LA    WORK3,ADD256(WORK3)                                      14629019
         B     ZEROTABL                                                 14629619
LASTXC   BCTR  WORK2,0                  SUBTRACT ONE FROM LENGTH TO     14630219
*                                        PREPARE FOR EXECUTE INSTR.     14630819
         EX    WORK2,XCINSTR            ZERO OUT INTERNAL TABLE         14631419
*                                                                       14632019
*                                                                       14636019
*                PUT HEADER VALUES IN INTERNAL TABLE,                   14640019
*                      LOAD DEVICE MASK TABLE,                     I276 14644019
*             AND TURN BIT ON FOR INTERNAL TABLE BUILT                  14648019
*                                                                       14652019
*                                                                       14656019
         STH   R0,OFFSET0(PARAMPTR)     SAVE GETMAIN SIZE IN            14660019
*                                        FIRST HALFWORD OF INTER-       14664019
*                                        NAL TABLE                      14668019
         STH   IT,OFFSET2(PARAMPTR)     SAVE ((# OF DDS X 4) + 4)       14672019
*                                        IN SECOND HALFWORD             14676019
         LA    SEARCH,OFFSET31(SEARCH)  COMPUTE SIZE OF MASK            14680019
         SRL   SEARCH,FIVEBITS           WITHOUT BITS FOR 2321          14684019
         SLL   SEARCH,TWOBITS            BIN POINTERS (IF NO            14688019
*                                        2321S,SEARCH = 0)              14692019
         STH   SEARCH,OFFSET0(IT,PARAMPTR)                              14696019
*                                       SAVE SEARCH AFTER DD PTR.       14700019
*                                        SPACE IN INTERNAL TABLE        14704019
         STH   ACCE,OFFSET2(IT,PARAMPTR)                                14708019
*                                       SAVE MASK SIZE IN SECOND        14712019
*                                        HALFWORD AFTER DD SPACE        14716019
*                                        IN INTERNAL TABLE              14720019
         LR    WORK2,R0                 GET SIZE OF INTERNAL TABLE I276 14724019
         AR    WORK2,PARAMPTR           ADD ADDRESS OF INTERNAL    I276 14728019
*                                        TABLE                     I276 14732019
         STM   R0,PARAMPTR,SAVER0      SAVE REGS ACROSS LOAD      M0313 14738020
         LOAD  EP=DEVMASKT              LOAD DEVICE MASK TABLE     I276 14744019
         S     WORK2,FOUR               GET ADDRESS OF LAST WORD   I276 14748019
*                                        IN INTERNAL TABLE         I276 14752019
         ST    R0,0(WORK2)              STORE DMT ADDRESS IN LAST  I276 14756019
*                                        WORD OF INTERNAL TABLE    I276 14760019
         LM    R0,PARAMPTR,SAVER0      RESTORE REGISTERS          M0313 14766020
         IC    ACCE,INDICATO-ITHEADER(LOOP)                             14772019
*                                       TEMPORARILY SAVE INDICATO       14776019
         ST    PARAMPTR,PTRINTAB-ITHEADER(LOOP)                         14780019
*                                       STORE ADDRESS OF INTERNAL       14784019
*                                        TABLE IN ITHEADER              14788019
         STC   ACCE,INDICATO-ITHEADER(LOOP)                             14792019
*                                       RESTORE INDICATO BYTE           14796019
         LR    PARAMPTR,LOOP            RETURN ITHEADER ADDRESS         14800019
*                                        TO REGISTER 1                  14804019
         LA    SEARCH,INITTO4           SET INDEX TO ENTER TABLE        14808019
*                                        BUILDING LOOP (TO PUT          14812019
*                                        POINTERS TO DDS IN             14816019
*                                        INTERNAL TABLE)                14820019
*                                                                       14824019
         OI    INDICATO,TABLE           INDICATE INTERNAL TABLE         14828019
*                                        BUILT                          14832019
*                                                                       14836019
*********************************************************************** 14840019
*                                                                     * 14844019
*                        RETURN TO TIOT LOOP                          * 14848019
*               TO PUT DD POINTERS IN INTERNAL TABLE                  * 14852019
*                                                                     * 14856019
*********************************************************************** 14860019
*                                                                       14864019
         B     PRESET                                                   14869019
*                                                                       14875019
*********************************************************************** 14882019
*                                                                     * 14889019
*       CHECK DDS IN INTERNAL TABLE FOR DUPLICATE UCB POINTERS        * 14896019
*                  (IF FIND DUPLICATE, ADJUST COUNT)                  * 14903019
*                                                                     * 14910019
*********************************************************************** 14917019
*                                                                       14924019
CHKDUP   DS    0H                                                       14931019
         L     ACCE,PTRINTAB            SET UP FOR SEARCH OF            14940000
         LA    ACCE,4(ACCE)                                             14960000
         SR    LOOP,LOOP                     DUPLICATIONS               14980000
         IC    LOOP,CNTINTAB                                            15000000
         LTR   LOOP,LOOP               IF NO DD CARDS OMIT SEARCH       15020000
         BZ    JUMPOUT                                                  15040000
         BCT   LOOP,LOOPOUT                                             15060000
         B     JUMPOUT                                                  15080000
LOOPOUT  DS    0H             START OUTER LOOP                          15100000
*                                  PROCESS                              15120000
*                                       SET UP FOR INNER LOOP           15140000
         LA    ACCO,4(ACCE)             SET POINTER TO COMPARE DDNAME   15160000
         LR    INLOOP,LOOP              SET COUNT FOR NUMBER OF         15180000
*                                       ITERATIONS                      15200000
LOOPIN   DS    0H                  DECISION                             15220000
         SR    IT,IT                                             A45128 15225022
         IC    IT,0(ACCE)              DEV.ENTRY POSITION        A45128 15230022
         SLL   IT,2                    MULTIPLY WITH 4           A45128 15235022
         A     IT,0(ACCE)              FOR CORRECT UCB           A45128 15240022
         SR    VMREQUST,VMREQUST                                 A45128 15245022
         IC    VMREQUST,0(ACCO)        DEV.ENTRY POSITION        A45128 15250022
         SLL   VMREQUST,2              MULTIPLY WITH 4           A45128 15255022
         A     VMREQUST,0(ACCO)        FOR CORRECT UCB           A45128 15260022
*                                                                       15280000
         CLC   TIOTUCB(2,IT),TIOTUCB(VMREQUST)                          15300000
*                                                                       15320000
         BE    EQUCB                    IF EQUAL GO TO "EQUCB" TO MOVE  15340000
*                                            TABLE UP                   15360000
*                                       IF NOT EQUAL PROCEED WITH       15380000
*                                            SEARCH                     15400000
*                                                                       15420000
*                                                                       15440000
*                                  PROCESS                              15460000
         LA    ACCO,4(ACCO)             INCREMENT DDNAME POINTER        15480000
*                                                                       15500000
*                                                                       15520000
*                                  DECISION                             15540000
         BCT   INLOOP,LOOPIN            WAS THIS LAST COMPARE OF        15560000
*                                            INNER LOOP                 15580000
*                                       YES, LOOP TO LOOPIN TO CONTINUE 15600000
*                                            SEARCH                     15620000
*                                       NO.PROCEED TO TEST OUTER LOOP   15640000
X1       DS    0H                  PROCESS                              15660000
         LA    ACCE,4(ACCE)             INCREMENT DDNAME POINTER        15680000
*                                                                       15700000
*                                                                       15720000
*                                  DECISION                             15740000
         BCT   LOOP,LOOPOUT             LAST OUTER LOOP COMPARED        15760000
*                                                                       15780000
*                                       NO, BRANCH TO "LOOPOUT" TO      15800000
*                                            CONTINUE SEARCH            15820000
*                                                                       15826019
*********************************************************************** 15832019
*                                                                     * 15838019
*                        BUILD THE DEVICE MASK                        * 15844019
*                        IN THE INTERNAL TABLE                        * 15850019
*                                                                     * 15856019
*********************************************************************** 15862019
*                                                                       15868019
JUMPOUT  DS    0H             REGISTER USAGE FOR SETTING UP MASK-       15874019
*                                       ACCE IS MASK REG                15880000
*                                       LOOP IS UCB POINTER             15900000
*                                       INLOOP IS COUNT REG             15920000
*                                       LINK CONTAINS A ONE             15940000
*                                       ACCO IS MASK POINTER            15960000
         SR    R0,R0                                                    15980000
         L     IT,PTRINTAB                                              16000000
         SR    ACCE,ACCE                                                16020000
         LA    INLOOP,32                                                16040000
         LA    LINK,1                                                   16060000
         SR    ACCO,ACCO               ZERO WORK REG           @ZM30153 16080003
         ICM   ACCO,3,2(IT)            GET UCB ADDR            @ZM30153 16090003
         L     LOOP,COMTAB              GO TO LOC 16                    16100000
         L     LOOP,IUCB(LOOP)          GET POINTER TO UCB TABLE        16120000
TESTUCBS TM    OFFSET0(LOOP),HEXFF                                      16130019
         BNO   SHIFT                                                    16140019
         TM    OFFSET1(LOOP),HEXFF      HAVE FOUND X'FFFF' AT END       16150019
*                                        OF UCB LUT?                    16160019
         BO    ENDMASK                  IF SO, STOP CHECKING ENTRIES    16170019
SHIFT    DS    0H                                                       16180019
         SLL   ACCE,ONEBIT              SHIFT DEVICE MASK REGISTER      16190019
         CLC   OFFSET0(TWOBYTES,LOOP),Z TEST THE UCB POINTER            16200019
         BE    NOTEUCB                  IF ZERO, DON'T LOOK FOR MATCH   16210019
*                                                                       16300000
*                                                                       16320000
         SR    WORK,WORK                GET NUMBER OF TABLE ENTRIES     16340000
         IC    WORK,CNTINTAB                                            16360000
      LTR   WORK,WORK            ARE THERE ANY DD  CARDS                16380000
     BZ    NOTEUCB           NO  OMIT   TEST                            16400000
         L     IT,PTRINTAB              POINTER TO INTERNAL TABLE       16420000
COMHERE  DS    0H                                                A45128 16425022
         TM    4(IT),X'FF'             UCB FOUND BEFORE          A45128 16430022
         BO    ANYMORE                 YES  CONTINUE             A45128 16435022
         SR    WORK2,WORK2             NO  COMPARE               A45128 16440022
         IC    WORK2,4(IT)             DEV.ENTRY POSITION        A45128 16441022
         SLL   WORK2,2                 MULTIPLY WITH 4           A45128 16441222
         A     WORK2,4(IT)             CORRECT UCB ADDRESS       A45128 16441422
         SR    WORK3,WORK3             ZERO WORK REG           @ZM30153 16442403
         ICM   WORK3,3,TIOTUCB(WORK2)   GET UCB ADDR           @ZM30153 16442803
*        TM    2(WORK3),X'FF'           IS IT A MAIN UCB                16444003
*        BC    1,MAIN                     BRANCH ON YES                 16446003
*        SR    WORK2,WORK2                                              16448003
*        IC    WORK2,1(WORK3)           CALCULATE THE ADDRESS OF THE    16450003
*        SLL   WORK2,4                  MAIN UCB                        16452003
*        LA    WORK2,56(WORK2)                                          16454003
*        SR    WORK3,WORK2                                              16456003
*        CH    WORK3,0(LOOP)            IS THIS UCB PTR EQUAL TO THE    16458003
*                                         UCB PTR IN THE UCB LOOK UP    16460013
*                                         TABLE                         16462013
*        BE    EQUCBS                     BRANCH ON YES                 16464003
*        B ANYMORE                                             @ZM30153 16466003
MAIN     CLC   TIOTUCB(2,WORK2),0(LOOP)                                 16468013
         BE    EQUCBS                   EQUAL                           16480000
ANYMORE  LA    IT,4(IT)                                                 16500013
         BCT   WORK,COMHERE             LAST OF UCBS TO COMPARE         16520000
         B     NOTEUCB                  NO EQUAL UCBS                   16540000
EQUCBS   DS    0H                                                A45128 16541022
         OR    ACCE,LINK               TURN ON MASK BIT                 16600000
         L     WORK3,PTRINTAB                                           16620000
         AR    WORK3,R0                                                 16640000
         LA    WORK3,0(WORK3)                                           16660000
         LA    IT,0(IT)                                                 16680000
         OI    4(IT),X'FF'             THIS UCB HAS BEEN FOUND   A45128 16700022
         CR    WORK3,IT                                                 16720000
         BE    EQREG                                                    16740000
         XC    4(4,WORK3),4(IT)                                         16760000
         XC    4(4,IT),4(WORK3)                                         16780000
         XC    4(4,WORK3),4(IT)                                         16800000
EQREG    DS    0H                                                       16820000
         LR    WORK3,R0                                                 16840000
         LA    R0,4(WORK3)                                              16860000
NOTEUCB  L     IT,PTRINTAB              RELOAD IT POINTER               16880000
*                                                                       16900000
*                                                                       16920000
         BCT   INLOOP,UPUCB                                             16940000
         ST    ACCE,4(IT,ACCO)                                          16960000
         LA    ACCO,4(ACCO)                                             16980000
         SR    ACCE,ACCE                                                17000000
         LA    INLOOP,32                                                17020000
UPUCB    LA    LOOP,2(LOOP)                                             17040000
         B     TESTUCBS                                                 17060000
ENDMASK  DS    0H                                                       17080000
         LA    LINK,32                                                  17100000
         CR    LINK,INLOOP                                              17120000
   BE   SKIPST                                                          17140000
         SLL   ACCE,0(INLOOP)                                           17160000
         ST    ACCE,4(IT,ACCO)                                          17180000
SKIPST   DS    0H                                                       17200000
         LA    LINK,0                                                   17220000
         SR    WORK,WORK                                                17240000
         L     IT,PTRINTAB             GET PNTR TO INTERNAL TABLE       17260000
         IC    WORK,CNTINTAB           AND NUMBER OF TABLE ENTRIES      17280000
         LTR   WORK,WORK               CHECK FOR ZERO                   17300000
         BZ    GETOUT                                                   17320000
REPEAT   NI    4(IT),X'00'             TURN OFF UCB FOUND BIT           17340000
         LA    IT,4(IT)                GET NEXT TABLE ENTRY             17360000
         BCT   WORK,REPEAT                                              17380000
*                                                                       17382019
*********************************************************************** 17384019
*                                                                     * 17386019
*                    RETURN TO REGULAR PROCESSING                     * 17388019
*                     (INTERNAL TABLE IS BUILT)                       * 17390019
*                                                                     * 17392019
*********************************************************************** 17394019
*                                                                       17396019
GETOUT   DS    0H                                                       17400000
*                                                                       17400213
*                                                                       17400413
*                                                                       17400613
         SR    R15,R15                                                  17415413
         BR    RETURN                                                   17420000
*                                                                       17422019
*********************************************************************** 17424019
*                                                                     * 17426019
*           ERROR EXIT: ERROR WHILE BUILDING INTERNAL TABLE           * 17428019
*                                                                     * 17430019
*********************************************************************** 17432019
*                                                                       17434019
ITERROR  LA    R15,VALUE4               INDICATE ERROR CONDITION A23794 17436019
*                                       - TOO MANY POINTERS TO   A23794 17436419
*                                         2321S IN UCB LOOK-UP   A23794 17436820
*                                         TABLE (ONLY HAVE WORK  A23794 17437219
*                                         SPACE FOR 30)          A23794 17437620
         BR    RETURN                                            A23794 17438019
EQUCB    DS    0H             BRANCH POINT WHEN TWO UCB POINTERS        17440000
*                             ARE EQUAL                                 17460000
         SR    IT,IT                                                    17480000
         IC    IT,CNTINTAB                                              17500000
         S     IT,ONE                                                   17520000
         STC   IT,CNTINTAB                                              17540000
         LH    IT,LENINTAB                                              17560000
         S     IT,FOUR                                                  17580000
         STH   IT,LENINTAB                                              17600000
         LA    IT,0(ACCO)                                               17620000
         LR    VMREQUST,INLOOP                                          17640000
         BCT   VMREQUST,LPHERE                                          17660000
         B     TTOK                                                     17680000
LPHERE   DS    0H                                                       17700000
         MVC   0(4,IT),4(IT)                                            17720000
         LA    IT,4(IT)                                                 17740000
         BCT   VMREQUST,LPHERE                                          17760000
         BCT   INLOOP,TOK                                               17780000
TTOK     BCT   LOOP,X1                                                  17800000
         B     JUMPOUT                                                  17820000
TOK      BCT   LOOP,LOOPIN                                              17840000
         B     JUMPOUT                                                  17860000
*                                                                       17880000
*                                                                       17888019
*              ASSEMBLER DC,DS STATEMENTS AND DCB MACROS                17896019
*              *****************************************                17904019
*                                                                       17912019
*                                                                       17920000
Z        DC    X'000000'                                                17940000
         DC    X'00'                                                    17950013
*                                                                       17980000
ONE      DC    F'1'                                                     18000000
BLANK    DC    CL8'        '                                            18020000
SYSAB    DC    CL8'SYSABEND'                                       2711 18030014
SYSUDMP  DC    CL8'SYSUDUMP'                                       4919 18035016
STPLIB   DC    CL8'STEPLIB '                                       SL0H 18037017
JOBLIB   DC    CL8'JOBLIB  '                                     A32626 18038020
*                                                                       18040000
FOUR     DC    F'4'                                                     18060000
FOXES    DC    X'0000FFFF'             USED TO 'AND' OUT REG   @ZM30153 18062003
EIGHT    DC    F'8'                                                     18064013
TEN      DC    F'10'                                                    18068013
SIXTEEN  DC    F'16'                                                    18072013
MAXSIZE  DC    F'256'                   MAXIMUM LENGTH TO USE WITH      18073019
*                                        EXECUTE                        18074019
MAXIXC   DC    H'255'                                                   18075019
XCINSTR  XC    OFFSET0(0,WORK3),OFFSET0(WORK3)                          18076019
THIRTY2  DC    H'32'                                                    18080000
MAXCOUNT DC    H'30'                    30 2321 UCB PTRS. MAX.   A23794 18085020
*                                                                A23794 18086020
*                    15 WORD WORK SPACE FOR 2321S                A23794 18087020
*          (HOLDS MAXIMUM OF 30 POINTERS TO UCBS FOR 2321S)      A23794 18088020
*                                                                A23794 18089020
UCBPTRS  DC    30H'00'                                           A23794 18090020
ZAPAREA  DC    5F'0'                    SPACE AVAILABLE FOR             18091020
*                                        SUPERZAP FIXES                 18092020
DMTAREA  DS    5F                                                       18100000
SAVER0   EQU   DMTAREA+8                                          M0313 18106020
SAVEREG  EQU   DMTAREA                                            M0313 18112020
DMTENTRY DS    10F                      DYNAMICALLY BUILT DMT AREA.     18120000
DMTETYNO EQU   DMTENTRY+2               NO. OF DEVICES IN BIT PATTERN   18140000
DMTETYPE EQU   DMTENTRY+4               DEVICE TYPE CODE                18160000
DMTESRTS EQU   DMTENTRY+8               BIT PATTERN                     18180000
*                                           TABLE                       18200000
*                                                                       18220000
*                                                                       18240000
         DS    0F                                                       18260000
JFCB     DC    44X'04'                                                  18280000
         DC    8C' '                                                    18300000
         DC    12XL10'00'                                               18320000
OPENJDCB DCB   DSORG=PS,MACRF=R,EXLST=VOLMLIST                          18340000
         DS    0F                                                       18360000
VOLMLIST DC    X'87'                                                    18380000
         DC    AL3(JFCB)                                                18400000
SAVE18F  DS    18F                                                M0313 18410020
         DCBD  DSORG=PS                                                 18420000
*                                                                       18422019
*                                                                       18424019
*                           DUMMY SECTIONS                              18426019
*                           **************                              18428019
*                                                                       18430019
*                                                                       18432019
CVT      DSECT                                                          18440000
         CVT                                                            18460000
UCB      DSECT                                                          18480000
         IEFUCBOB                                                       18500000
         END                                                            18520000
