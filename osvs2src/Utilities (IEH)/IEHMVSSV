*TITLE 'IEHMVSSV                                                      * 00020000
*FUNCTION/OPERATION: THIS MODULE HANDLES THE MOUNTING OF THE FROM, TO * 00040000
*AND CVOL VOLUMES; AND OBTAINING THE DSCB ON THE FROM DATA SET IF IT  * 00060000
*RESIDES ON A DIRECT ACCESS DEVICE                                    * 00080000
*ENTRY POINTS: IEHMVESV                                               * 00100000
*INPUT: MOVE/COPY COMMUNICATIONS TABLE                                * 00120000
*OUTPUT: DSCB IN MOVE/COPY COMMUNICATIONS TABLE                       * 00140000
*EXTERNAL ROUTINES: IEHMVXSF                                          * 00160000
*EXITS-NORMAL XCTL IEHMVXSF; RETURN TO CALLING ROUTINE IEHMVSSZ       * 00180000
*ERRORS: UNABLE TO MOUNT REQUIRED VOLUMES                             * 00200000
*TABLES/WORKAREAS: MOVE/COPY COMMUNICATIONS TABLE                     * 00220000
*ATTRUBUTES: REUSEABLE                                                * 00240000
*NOTES: PART OF LOAD MODULE IEHMVESZ                                  * 00260000
*2050022200-024600                                                 4173 00270016
*2892074000                                                        DT0I 00275018
         EJECT                                                          00280000
IEHCULAT CSECT                                                          00300000
*A023946-023952,065460-065520                                  @ZA28250 00300199
*A023800-023940                                                @ZA16493 00300299
*C023960                                                       @ZA16493 00300399
*C056400,056600                                                @ZM30153 00300799
*A056500,089500,089520                                         @ZM30153 00300803
* 019100                                                         A29225 00301019
*                                                                A17911 00302018
* 014600-014800,025800-026800,027200-027400                      A17911 00304018
*                                                                A17911 00306018
* 014800,027600-027700                                           A24209 00310018
*036000-039400,040200-040800,046200-047200,087800                S21042 00312021
*                                                                       00320000
*                             REGISTER NOTATION AND USAGE               00340000
*                                                                       00360000
ZERO     EQU   0                                                        00380000
PARAM    EQU   1                                                        00400000
ACCE     EQU   2                                                        00420000
WORK2    EQU   2                                                        00440000
WORK3    EQU   3                                                        00460000
ACCO     EQU   3                                                        00480000
BASE     EQU   4                        BASE FOR IEHMVESV               00500000
M5       EQU   5                                                        00520000
M6       EQU   6                                                        00540000
DSCB     EQU   7                        BASE FOR DSCB DSECT             00560000
MCTABLE  EQU   12                       BASE FOR IEHMVV, WORK AREA      00580000
SAVE     EQU   13                      SAVE REG                         00600000
RETURN   EQU   14                       RETURN REG                      00620000
LINK     EQU   15                      ENTRY POINT REG                  00640000
*                                                                       00660000
*                             ASSEMBLER EQUATE STATEMENTS               00680000
*                                                                       00700000
CODE03   EQU   X'03'                    UNABLE TO LOCATE VOL INFO       00720000
CODE08   EQU   X'08'                    UNABLE TO MOUNT FROM VOLUME     00740000
CODE10   EQU   X'0A'                    DATA SET NOT FOUND              00760000
CODE12   EQU   X'0C'                    UNABLE TO COPY ON SAME VOLUME   00780000
*                                       WITHOUT RENAME FUNCTION         00800000
CODE19   EQU   X'13'                    DSORG FIELD IS INCORRECT A24209 00810018
CODE26   EQU   X'1A'                    UNABLE TO MOUNT TO VOL          00820000
UNMOVE   EQU   X'08'                                                    00840000
RENAME   EQU   X'04'                                                    00860000
COMTAB   EQU   16                       POINTER TO THE CVT              00880000
SYSRES   EQU   X'02'                                                    00900000
DASD     EQU   X'20'                                                    00920000
COPY     EQU   X'40'                                                    00940000
CATALOG  EQU   X'04'                                                    00960000
VOLUME   EQU   X'02'                                                    00980000
FROM     EQU   X'01'                                                    01000000
CVOL     EQU   X'40'                                                    01020000
*                                                                       01040000
*                             ENTRY AND EXTRN STATEMENTS                01060000
*                                                                       01080000
         ENTRY IEHMVESV                                                 01100000
         ENTRY RTNVM                                                    01120000
         ENTRY CALLMT                                                   01140000
         EXTRN COPYRTN                                                  01160000
         EXTRN KK1                                                      01180000
         EXTRN KK2                                                      01200000
         EXTRN PREABORT                                                 01220000
*                                                                       01240000
*                             ASSEMBLER USING STATEMENTS                01260000
*                                                                       01280000
         USING IEHMVV,MCTABLE                                           01300000
         USING DSCBDSEC,DSCB                                            01320000
         USING IEHMVESV,BASE                                            01340000
*                                                                       01360000
*                                                                       01380000
IEHMVESV SAVE  (14,12),T,IEHMVSSV-OZ28250                      @ZA28250 01400099
         LR    BASE,LINK                SET UP ADDRESSABILITY           01420000
         IEHPRE (14,1),TFC                                              01440000
         B     IEHMVESP                 OTHERWISE, GOTO MOUNT FROM VOL  01500000
IEHMVRSP DS    0H             ENTRY POINT TO TEST FOR COPY OPERATION    01520000
     TM   IEHMVV20,COPY                                                 01540000
    BO   COPYYES                                                        01560000
    TM   IEHMVV20,CATALOG                                               01580000
    BO   COPYYES                                                        01600000
NOTCOPY  DS    0H             ENTRY POINT TO FIND THE FROM DSCB.        01620000
*                             THE PERMANENT WORK AREA POINTER IS        01640000
*                             DISPLACED BY 140 BYTES TO BE OCCUPIED BY  01660000
*                             THE DSCB. IF THE FROM DEVICE IS DIRECT    01680000
*                             ACCESS, THE DSCB IS OBTAINED. OTHERWISE,  01700000
*                             NO MOUNTING OPERATION TAKES PLACE AND     01720000
*                             CONTROL IS RETURNED TO THE CALLER         01740000
         L     ACCE,IEHMVV10                                            01760000
         LA    ACCO,140(ACCE)                                           01780000
         ST    ACCO,IEHMVV10                                            01800000
         ST    ACCE,IEHMVV30+8               DSCB POINTER               01820000
     XC   0(140,ACCE),0(ACCE)                                           01840000
         L     ACCE,IEHMVV22+4          FROM DEVICE DASD                01860000
         CLI   2(ACCE),DASD                                             01880000
         BNE   IEHMVEEJ                PREPARE TO EXIT           A29225 01910019
         L     ACCE,IEHMVV30+8                                          01920000
*                                                                S21042 01930021
*  IF THE TTR OF THE 'FROM' DSCB IS AVAILABLE, IT IS CONVERTED   S21042 01932021
*  TO CCHHR AND THE DSCB OBTAIN'D BY SEEK CCHHR. IF NO TTR IS    S21042 01934021
*  AVAILABLE OR THE OBTAIN FAILS A SEARCH DSNAME OBTAIN IS DONE  S21042 01936021
*                                                                S21042 01938021
         OC    IEHMVV82(3),IEHMVV82    IS TTR ZERO ?             S21042 01938421
         BZ    SEARCH                  YES, SEARCH DSCB BY NAME  S21042 01938821
         L     PARAM,IEHMVV30+12       GET PTR TO 'FROM' DDNAME  S21042 01939221
         LA    PARAM,0(PARAM)    CLEAR HIGH-ORDER BYTE           S21042 01939421
         DEVTYPE (PARAM),INFO,DEVTAB   GET DEVICE CHARACTERISTICSS21042 01939621
         L     PARAM,IEHMVV82          GET TTR OF 'FROM' DSCB    S21042 01939721
         SRL   PARAM,8                 MOVE R TO RIGHTMOST BYTE  S21042 01939821
         STC   PARAM,CCHHR+4           SAVE R                    S21042 01939921
         SRL   PARAM,8                 MOVE TT TO RIGHTMOST BYTESS21042 01946621
         SR    ZERO,ZERO               CLEAR REG FOR DIVISION    S21042 01948621
         LH    M5,TRCYL                PICK UP NR OF TRKS/CYL    S21042 01950621
         DR    ZERO,M5                 DIVIDE TT BY TRKS/CYL     S21042 01952621
         STH   PARAM,CCHHR             SAVE CC                   S21042 01953021
         STH   ZERO,CCHHR+2            SAVE HH                   S21042 01953121
         LA    PARAM,CCHHR             GET ADDR OF CCHHR         S21042 01953221
         MVI   IEHMVV00,X'C0'          +INDICATE                 S21042 01959921
         MVI   IEHMVV00,X'80'          +SEEK MODE                S21042 01960021
         ST    PARAM,IEHMVV00+4        SET UP PTR TO CCHHR       S21042 01962021
         L     ACCO,IEHMVV22+4         +                         S21042 01964021
         LA    ACCO,4(ACCO)            +SET UP VOL SEQ NUMBER    S21042 01966021
         ST    ACCO,IEHMVV00+8         +                         S21042 01966421
         LA    ACCO,IEHMVV00+16        SET UP PTR                S21042 01966521
         ST    ACCO,IEHMVV00+12        TO WORK AREA              S21042 01973221
         OBTAIN IEHMVV00                                         S21042 01973321
*                                                                S21042 01975321
         LTR   LINK,LINK               OBTAIN SUCCESSFUL ?       S21042 01977321
         BNZ   SEARCH                  NO, SEARCH DSCB BY NAME   S21042 01979321
         L     ACCO,IEHMVV21           GET PTR TO 'FROM' DSNAME  S21042 01979721
         CLC   IEHMVV00+16(44),0(ACCO) SAME DSNAMES ?            S21042 01979821
         BNE   SEARCH                  NO, SEARCH DSCB BY NAME   S21042 01979921
         MVC   0(140,ACCE),IEHMVV00+16 MOVE DSCB                 S21042 01986521
         B     SKIPMT                  SKIP DSCB SEARCH BY NAME  S21042 01986621
*                                                                S21042 01988621
*  OBTAIN BY SEARCH DSNAME                                       S21042 01990621
SEARCH   DS    0H                                                S21042 01992621
         XC    IEHMVV00(20),IEHMVV00    INDICATE SEARCH MODE            01993621
         OI    IEHMVV00,X'C1'                                           02000221
         MVC   IEHMVV00+4(4),IEHMVV21   SET UP DSNAME                   02006821
         L     ACCO,IEHMVV22+4                                          02013421
         LA    ACCO,4(ACCO)             SET UP VOLUME SEQUENCE NUMBER   02020000
         ST    ACCO,IEHMVV00+8                                          02040000
         LA    ACCO,IEHMVV00+16         SET UP POINTER TO WORK AREA     02060000
         ST    ACCO,IEHMVV00+12                                         02080000
*                                                                       02100000
*                                                                       02120000
         OBTAIN IEHMVV00                                                02140000
*                                                                       02160000
         B     CUOBT(LINK)              CHECK OBTAIN RETURNS            02180000
CUOBT    DS    0H                                                       02200000
*                       RTN CODE       MEANING                     4173 02220016
         B     OBOK          0         DSCB FOUND                  4173 02240016
         B     EOBTAIN       4         VOL NOT MOUNTED, PRINT MSG  4173 02260016
         B     NTINVTOC      8         DSCB NOT FOUND IN VTOC      4173 02280016
         B     SVC27ERR      12        I/O ERR RETN FROM SVC27     4173 02300016
         B     SVC27ERR      16        WORK AREA ALLOC ERR SVC 27  4173 02320016
         B     SVC27ERR      20        VTOC EXTENT VIOLATED SVC 27 4173 02340016
NTINVTOC MVI   IEHMVV61,X'0A'          CODE FOR MSG MODULE         4173 02360016
         L     ACCO,IEHMVV23+4        ADDRESS OF ACTIVE TO VOL @ZA16393 02380099
         LA    ACCO,0(ACCO)            CLEAR HIGH ORDER BYTE   @ZA16393 02382099
         CLI   2(ACCO),X'80'           TO DEV TAPE ?           @ZA16393 02384099
         BNE   MSGNOUT                 NO, PRINT MSG IEH406I   @ZA16493 02386099
         TM    IEHMVV20,X'16'          DSGROP/VOLUME/CATALOG   @ZA16493 02388099
         BM    MSGNOUT                 YES, PRINT MSG IEH406I  @ZA16493 02390099
         OI    IEHMVV20+5,X'08'      SET TO WRITE A DUMMY FILE @ZA16493 02392099
         OI    IEHMVV20+1,X'01'        SET UNLOAD SWITCH       @ZA16493 02394099
         B     IEHMVEEJ                MOUNT TO VOLUME         @ZA28250 02394699
DUMMY    EQU   *                                               @ZA28250 02395299
         B     MSGNOUT                 PRINT MSG IEH406I       @ZA16493 02396099
SVC27ERR MVI   IEHMVV61,X'0E'          THIS WILL CAUSE THE MSG     4173 02400016
*                                      MODULE TO ISSUE THE I/O ERR 4173 02420016
*                                      MSG FOR THREE DIFF RTNS,NB  4173 02440016
MSGNOUT  L     LINK,PREAB              PREPARE TO LEAVE MODULE     4173 02460016
         BR    LINK                                                     02480000
OBOK     DS    0H                                                       02500000
         L     ACCO,IEHMVV21                                            02520000
         MVC   0(44,ACCE),0(ACCO)       MOVE DSNAME                     02540000
         MVC   44(96,ACCE),IEHMVV00+16  MOVE DSCB                       02560000
         L     ACCO,IEHMVV00+12        GET PTR TO WORKAREA       S21042 02610021
         L     PARAM,IEHMVV30+12       GET PTR TO 'FROM' DDNAME  S21042 02660021
         LA    PARAM,0(PARAM)    CLEAR HIGH ORDER BYTE           S21042 02665021
         DEVTYPE (PARAM),INFO,DEVTAB   GET DEVICE CHARACTERISTICSS21042 02670021
         MVC   CCHHR(5),96(ACCO)       MOVE CCHHR IN ABS ADDR LOCS21042 02680021
         LH    PARAM,CCHHR             GET CC                    S21042 02690021
         MH    PARAM,TRCYL             CONVERT CC TO TT          S21042 02692021
         AH    PARAM,CCHHR+2           GET TOTAL TT              S21042 02694021
         SLL   PARAM,8                 FREE RIGHTMOST BYTE       S21042 02696021
         IC    PARAM,CCHHR+4           INSERT R                  S21042 02698021
         SLL   PARAM,8                 MOVE TTR TO LEFT 3 BYTES  S21042 02698421
         ST    PARAM,IEHMVV82          SAVE TTR                  S21042 02698821
SKIPMT   DS    0H                                                       02700000
         TM    IEHMVV20,X'04'           IS THIS A CATALOG MOVE   A24209 02745018
         BZ    IEHMVEEJ                 NO. GO MOUNT TO VOLUME   A24209 02750018
  TM   DS1DSORG-DS1DSNAM(ACCE),X'E2'    IS DSORG =0              A24209 02755018
         BZ    IEHMVEEJ                 YES. GO MOUNT TO VOLUME  A24209 02760018
         MVI   IEHMVV61,CODE19          CATALOG HAS WRONG DSORG  A24209 02765018
         B     MSGNOUT                  GO TO PRINT MESSAGE      A24209 02770018
IEHMVREJ DS    0H             ENTRY POINT FOR LEAVING THIS PROGRAM      02780000
        IEHPOST (14,1),TC                                               02800000
*                                                                       02820000
         MVC   12(4,SAVE),MNOP          SET UP ADDRESS FOR ENTRY INTO   02840000
*                                       IEHMVSSZ. ENTRY POINT IS        02860000
*                                       CALLED COPYRTN.                 02880000
         RETURN (14,12),T                                               02900000
COPYYES  DS    0H             ENTRY POINT FOR COPY OPERATION            02920000
         TM    IEHMVV20+3,RENAME       IS RENAME SPECIFIED              02940000
         BO    NOTCOPY                  YES ALLOW COPY ON SAME VOLUME   02960000
         L     ACCE,IEHMVV22            NO. GET POINTERS TO THE FROM    02980000
*                                       AND TO VOLUME LISTS AND COMPARE 03000000
*                                       THE VOLUME SERIAL NUMBERS       03020000
         L     ACCO,IEHMVV23+4                                          03040000
         CLC   4(6,ACCE),4(ACCO)                                        03060000
         BNE   NOTCOPY                  IT THE VOLUME IDS ARE NOT EQUAL 03080000
*                                       CONTINUE PROCESSING             03100000
         MVI   IEHMVV61,CODE12          IF EQUAL, ABORT STEP WITH MSG   03120000
*                                       UNABLE TO COPY ON SAME VOLUME   03140000
*                                       STEP WILL BE TERMINATED IF AN   03160000
*                                       ATTEMPT IS MADE TO COPY ONTO    03180000
*                                       THE SAME VOLUME WITHOUT         03200000
*                                       SPECIFYING THE RENAME FUNCTION  03220000
GOOUT    L     LINK,PREAB                                               03240000
         BR    LINK                                                     03260000
EOBTAIN  DS    0H             ENTRY POINT TO ABORT A REQUEST IF THE     03280000
*                             FROM VOLUME CANNOT BE MOUNTED             03300000
         MVI   IEHMVV61,CODE08          SET MSG CODE UNABLE TO MOUNT    03320000
*                                       FROM VOLUME                     03340000
         B     GOOUT                                                    03360000
IEHMVESP DS    0H             ENTRY POINT FOR MOUNTING THE FROM VOLUME  03380000
         TM    IEHMVV20,FROM            FROM VOL SPECIDIED              03400000
         BO    MTFROM                   YES,PROCEED TO MOUNT FROM VOL   03420000
*                                                                       03440000
*                                       NO, TEST FOR CVOL               03460000
         TM    IEHMVV20+1,CVOL          CVOL SPECIFIED                  03480000
         BO    MTCVOL                   YES, PROCEED TO MOUNT CVOL      03500000
*                                                                       03520000
      TM    IEHMVV20,CATALOG            CATALOG FUNCTION                03540000
         BO    SYSCAT         IF YES, CHECK TO SEE IF SYSTEM RESIDENCE  03560000
*                             VOLUME HAS BEEN MOUNTED                   03580000
GOLO     DS    0H                                                       03960000
         L     M5,IEHMVV10                                              03980000
         LA    M5,4(M5)                                                 04000000
         IC    ACCE,IEHMVV22           GET NUMBER OF VOLUMES     S21042 04020021
         LA    ACCO,12                                                  04100000
         MR    ACCE,ACCO                GET LENGTH OF LIST              04120000
         EX    ACCO,LOMO                MOVE THE VOLUME LIST TO THE     04140000
*                                       PERMANENT WORK AREA, READJUST   04160000
*                                       POINTER TO THE BEGINNING OF     04180000
*                                       THIS WORK AREA AND GO TO MOUNT  04200000
*                                       THE FROM VOLUME                 04220000
         AR    M5,ACCO                                                  04240000
         ST    M5,IEHMVV10                                              04260000
         B     MTFROM                                                   04280000
MTCVOL   DS    0H             ENTRY POINT FOR MOUNTING CONTROL VOLUME   04300000
*                             WHEN CVOL IS SPECIFIED                    04320000
         L     PARAM,IEHMVV24           GET PNTR TO CVOL LIST           04340000
         MVI   IEHMVV00+4,X'90'         SET UP INDICATOR                04360000
         MVI   IEHMVV00+400,X'00'       SET CODE FOR VOLUME MOUNTING    04380000
*                                       ROUTINE TO RETURN HERE          04400000
         BAL   RETURN,CALLMT            GO TO VOLUME MOUNTER            04420000
RTN100   DS    0H             RETURN IS HERE FROM VOLUME MOUNTER WITH   04440000
*                             RETURN CODES IN REGISTER 15 AS FOLLOWS    04460000
*                                                                       04480000
*                             0 =  VOLUME NOT MOUNTED                   04500000
*                             4 =  VOLUME MOUNTED                       04520000
         B     TETMTR(LINK)                                             04540000
TETMTR   B     BADMT                                                    04560000
         TM    IEHMVV20,CATALOG         CATALOG ;UNCTION                04580000
     BO   CVOLCAT                                                       04600000
         B     GOLO                    READJUST PTR TO WORKAREA  S21042 04620021
*                                       INFORMATION FOR NEXT DATA SET   04740000
*                                       TO BE MOVED                     04760000
MTFROM   DS    0H             ENTRY POINT FOR MOUNTING FROM VOLUME      04780000
         L     PARAM,IEHMVV22           GET PNTR TO FROM VOLUME LIST    04800000
         MVI   IEHMVV00+4,X'90'         SET UP INDICATOR                04820000
         MVI   IEHMVV00+400,X'04'       SET CODE FOR VOLUME MOUNTER TO  04840000
*                                       TO RETURN HERE                  04860000
         BAL   RETURN,CALLMT            GO TO VOLUME MOUNTER            04880000
RTN200   DS    0H             RETURN FROM VOLUME MOUNTER HERE           04900000
*                             RETURN CODES ARE                          04920000
*                                                                       04940000
*                             0 = VOLUME NOT MOUNTED                    04960000
*                             4 = VOLUME MOUNTED                        04980000
         B     TESTMTR(LINK)            MOUNT OK                        05000000
TESTMTR  B     BADMT                    NO                              05020000
         ST    PARAM,IEHMVV30+12        IF MOUNT OK, SAVE POINTER TO    05040000
*                                       FROM DDNAME RETURNED BY VOLUME  05060000
*                                       MOUNTER                         05080000
         MVC   IEHMVV22+4(4),IEHMVV22   UPDATE ACTIVE FROM VOL LIST     05100000
         B     IEHMVRSP                 PNTR AND RETURN TO CHECK FOR    05120000
*                                       COPY OPERATION                  05140000
BADMT    DS    0H             ENTRY POINT FOR ABORTING REQUEST IF       05160000
*                             VOLUME NOT MOUNTED                        05180000
         MVI   IEHMVV61,CODE08          SET MSG CODE UNABLE TO MOUNT    05200000
*                                       FROM VOLUME AND ABORT THE       05220000
*                                       REQUEST                         05240000
         L     LINK,PREAB                                               05260000
         BR    LINK                                                     05280000
LOMO     MVC   0(1,M5),IEHMVV00+18                                      05300000
CVOLCAT  DS    0H             ENTRY POINT FOR UPDATING THE FROM VOLUME  05320000
*                             LIST POINTER FOR A CATALOG MOVE REQUEST   05340000
    MVC   IEHMVV22(4),IEHMVV24                                          05360000
         B     MTFROM                   RETURN TO MOUNT FROM VOLUME     05380000
SYSCAT   DS    0H             ENTRY POINT FOR CHECKING IF THE SYSTEM    05400000
*                             RESIDENCE VOLUME IS MOUNTED               05420000
         L     WORK2,COMTAB             GET POINTER TO THE CVT          05440000
         L     WORK2,40(WORK2)          AND POINTER TO THE UCB TABLE    05460000
*                                       OF ADDRESSES                    05480000
*                             AT THIS POINT THE UCB TABLE IS SEARCHED   05500000
*                             FOR THE SYSTEM RESIDENCE UCB. IF NOT      05520000
*                             FOUND, THE STEP IS ABORTED. IF FOUND,     05540000
*                             DEVICE CLASS AND VOLUME INFORMATION ARE   05560000
*                             MOVED FROM THE UCB TO THE PERMANENT       05580000
*                             WORK AREA AND CONTROL IS RETURNED TO      05600000
*                             MOUNT SYSTEM RESIDENCE AS THE FROM VOLUME 05620000
VON      ICM   WORK3,3,0(WORK2)         GET UCB PTR            @ZM30153 05640003
         N     WORK3,FOXES              ZERO LEFT HALF OF REG  @ZM30153 05650003
         C     WORK3,FOXES              END OF UCB TABLE?      @ZM30153 05660003
         BE    BADMT                    YES. ABORT                      05680000
         TM    3(WORK3),SYSRES          NO. IS THIS THE SYS RES UCB     05700000
         BO    VFIND                    YES                             05720000
NNVV     DS    0H                                                       05740000
         LA    WORK2,2(WORK2)           NO.INCREMENT PNTR TO UCB TABLE  05760000
         B     VON                      AND CONTINUE SEARCH             05780000
VFIND    DS    0H                                                       05800000
         CLI   18(WORK3),DASD           IS DEVICE CLASS DIRECT ACCESS   05820000
*                             IF NO, RETURN TO UCB TABLE SEARCH. IF YES 05840000
*                             MOVE DEVICE CLASS AND VOLUME SERIAL       05860000
*                             NUMBER FROM THE UCB TO THE PERMANET WORK  05880000
*                             AREA, UPDATE THE ACTIVE FROM VOL LIST     05900000
*                             PNTR AND THE PERMANENT WORK AREA PNTR     05920000
*                             AND RETURN TO MOUNT THE FROM VOLUME       05940000
   BNE  NNVV                                                            05960000
    L    ACCE,IEHMVV10                                                  05980000
    LA   ACCE,4(ACCE)                                                   06000000
     XC    10(2,ACCE),10(ACCE)                                          06020000
     MVC   0(4,ACCE),16(WORK3)                                          06040000
       MVC   4(6,ACCE),28(WORK3)                                        06060000
    ST    ACCE,IEHMVV22                                                 06080000
    LA   ACCO,1                                                         06100000
         STC   ACCO,IEHMVV22                                            06120000
   MVC    IEHMVV22+4(4),IEHMVV22                                        06140000
     LA   ACCO,12(ACCE,0)                                               06160000
    ST   ACCO,IEHMVV10                                                  06180000
     B    MTFROM                                                        06200000
IEHMVEEJ DS    0H             ENTRY POINT FOR MOUNTING THE TO VOLUME    06220000
         L     PARAM,IEHMVV23+4         GET PNTR TO ACTIVE TO VOL       06240000
         MVI   IEHMVV00+4,X'B0'         INDICATE TO VOLUME MOUNTER THAT 06260000
*                                       OLD MOUNTS ARE VALID            06280000
         MVI   IEHMVV00+400,X'08'       SET CODE FOR VOLUME MOUNTER TO  06300000
*                                       RETURN HERE                     06320000
         BAL   RETURN,CALLMT            GO TO VOLUME MOUNTER            06340000
RTN300   DS    0H             RETURN HERE FORM VOLUME MOUNTER           06360000
*                             RETURN CODES ARE                          06380000
*                                                                       06400000
*                             0 =  TO VOLUME HAS NOT BEEN MOUNTED       06420000
*                             4 =  TO VOLUME MOUNTED                    06440000
         B     TOTST(LINK)                                              06460000
TOTST    DS    0H                                                       06480000
         B     BADMTTO                  VOLUME NOT MOUNTED, ABORT       06500000
         ST    PARAM,IEHMVV31+8         YES.SAVE PNTR TO THE DDNAME     06520000
*                                       RETURNED BY VOLUME MOUNT AND    06540000
         TM    IEHMVV20+5,X'08'  SHALL A DUMMY FILE BE WRITTEN @ZA28250 06546099
         BO    DUMMY                    YES, BRANCH BACK       @ZA28250 06552099
         B     IEHMVREJ                 EXIT FROM THE PROGRAM           06560000
BADMTTO  DS    0H                                                       06580000
         MVI   IEHMVV61,CODE26          SET MSG CODE UNABLE TO MOUNT    06600000
*                                       TO VOLUME AND ABORT REQUEST     06620000
         L     LINK,PREAB                                               06640000
         BR    LINK                                                     06660000
CALLMT   DS    0H             ENTRY POINT FOR SETTING UP VOLUME         06680000
*                             MOUNTING REQUEST AND GIVING CONTROL TO    06700000
*                             IEHMVXSF WHICH IS THE VOLUME MOUNTING     06720000
*                             ROUTINE                                   06740000
*                                                                       06760000
*                             REGISTER 1 CONTAINS A POINTER TO THE      06780000
*                             VOLUME LIST WHICH THE VOLUME MOUNTING     06800000
*                             ROUTINE USES TO DETERMINE WHAT VOLUME TO  06820000
*                             MOUNT.                                    06840000
*                                                                       06860000
*                             THE VOLUME MOUNTING REQUEST IS BUILT BY   06880000
*                             THIS ROUTINE AT IEHMVV00                  06900000
*                                                                       06920000
*                             IEHMVSSZ CONTAINS EXTERNAL REFERENCES TO  06940000
*                             THIS ROUTINE                              06960000
*                             IEHMVSSZ USES THIS ROUTINE TO MOUNT THE   06980000
*                             FROM AND TO VOLUMES WHEN A VOLUME MOVE    07000000
*                             OPERATION IS REQUESTED                    07020000
*                                                                       07040000
*                             PARAMETERS PASSED TO IEHMVXSF ARE         07060000
*                                                                       07080000
*                             REGISTER 3     PNTR TO THE VOLUME         07100000
*                                            MOUNTING REQUEST           07120000
*                             REGISTER 4     RETURN INDICATOR 'SZ'      07140000
*                                            SPECIFIES THAT IEHMVXSF    07160000
*                             IS TO GIVE CONTROL TO IEHMVSSZ AFTER THE  07180000
*                             VOLUME HAS BEEN MOUNTED                   07200000
*                             IF THE VOLUME HAS BEEN MOUNTED, IEHMVSSZ  07220000
*                             RETURNS CONTROL TO THIS MODULE AT         07240000
*                             ALTERNATE ENTRY POINT, RTNVM.             07260000
         DROP  BASE                                                     07280000
         BALR  LINK,ZERO                                                07300000
         USING *,LINK                                                   07320000
         MVC   IEHMVV00+5(3),IEHMVV50+5 SET UP PNTR TO INTERNAL TABLE   07340000
         MVC   IEHMVV00+10(1),IEHMVV50+4                                07360000
         MVI   IEHMVV00+11,X'01'        SET UP NUMBER OF REQUESTS       07380000
         MVC   IEHMVV00+12(19),0(PARAM)  SET UP DEVICE CLASS       DT0I 07390018
*                                      AND VOLUME                  DT0I 07400018
*                                       SERIAL NUMBER                   07420000
         LA    ACCO,IEHMVV00            SET UP PARAMETERS, PNTR TO      07440000
         L     BASE,DOG                 VOLUME MOUNTING REQUEST AND     07460000
*                                       SUFFIX OF MODULE TO BE GIVEN    07480000
*                                       CONTROL BY IEHMVXSF             07500000
         TM    IEHMVV00+400,X'F0'                                       07520000
         BM    OVERPOST                                                 07540000
         IEHPOST (14,1),T                                               07560000
OVERPOST DS    0H             PASS CONTROL TO IEHMVXSF VIA XCTL         07580000
         BALR  M6,ZERO                                                  07600000
         USING *,M6                                                     07620000
         DROP  LINK                                                     07640000
    XCTL  EP=IEHMVXSF                                                   07660000
         DROP  M6                                                       07680000
         USING *,RETURN                                                 07700000
         EJECT                                                          07720000
RTNVM    DS    0H             ALTERNATE ENTRY POINT FOR THIS MODULE     07740000
*                             GIVEN CONTROL BY IEHMVSSZ                 07760000
*                             THIS ROUTINE TESTS FOR GOOD VOLUME        07780000
*                             MOUNTING OPERATION                        07800000
*                                                                       07820000
*                             IT RETURNS A CODE IN REGISTER 15 TO THE   07840000
*                             ROUTINE WHICH REQUESTED THE VOLUME        07860000
*                             MOUNTING AS FOLLOWS                       07880000
*                                                                       07900000
*                             0 = VOLUME NOT MOUNTED                    07920000
*                             4 = VOLUME MOUNTED                        07940000
*                                                                       07960000
*                             IF THE VOLUME WAS MOUNTED, REGISTER 1     07980000
*                             CONTAINS A POINTER TO THE DDNAME USED     08000000
*                                                                       08020000
*                             THIS ROUTINE DETERMINES WHICH MODULE IS   08040000
*                             TO RECEIVE CONTROL NEXT ON THE BASIS OF   08060000
*                             A CODE PLACED AT IEHMVV00+400 BY THE      08080000
*                             ROUTINE WHICH REQUESTED THE VOLUME        08100000
*                             MOUNTING.                                 08120000
         SR    LINK,LINK                SETUP RETURN CODE 0             08140000
         TM    IEHMVV00+4,X'01'         WAS VOLUME MOUNTED              08160000
         BZ    NOMOUNT                  NO                              08180000
         LA    LINK,4                   YES.RETURN CODE 4 GOOD MOUNT    08200000
         L     PARAM,IEHMVV00+4         GET PNTR TO INTERNAL TABLE      08220000
         LA    PARAM,0(PARAM)           ZERO HIGH ORDER BYTE            08240000
         AH    PARAM,IEHMVV00+22        ADJUST PNTR TO RELATIVE TABLE   08260000
*                                       ADDRESS WITHIN THE INTERNAL TAB 08280000
         L     PARAM,0(PARAM)           GET PNTR TO DDNAME              08300000
NOMOUNT  DS    0H                                                       08320000
         TM    IEHMVV00+400,X'F0'                                       08340000
         L     BASE,ABSE                                                08360000
         BM    OVERPRE                                                  08380000
         DROP  RETURN                                                   08400000
         USING IEHMVESV,BASE                                            08420000
         IEHPRE (14,1),T                                                08440000
OVERPRE  SR    RETURN,RETURN                                            08460000
         IC    RETURN,IEHMVV00+400      PICK UP VALUE TO BE USED IN     08480000
*                                       COMPUTING CORRECT RETURN        08500000
*                                       LOCATION. VALUES ARE AS         08520000
*                                       INDICATED BELOW.                08540000
         B     DDRTN(RETURN)                                            08560000
DDRTN    B     RTN100              00 = RETURN TO SSV                   08580000
         B     RTN200              04 = RETURN TO SSV                   08600000
         B     RTN300              08 = RETURN TO SSV                   08620000
         B     RTN100              12 = RETURN TO SSV                   08640000
         B     AB101               16 = RETURN TO SSZ                   08660000
         L     RETURN,AB200        20 = RETURN TO SSZ                   08680000
         BR    RETURN                                                   08700000
AB101    L     RETURN,AB100                                             08720000
         BR    RETURN                                                   08740000
         EJECT                                                          08760000
*                                      DC AND DS STATEMENTS      S21042 08780021
*                                                                       08800000
AB100    DC    A(KK1)         EXTERNAL REFERENCE TO IEHMVSSZ            08820000
AB200    DC    A(KK2)         EXTERNAL REFERENCE TO IEHMVSSZ            08840000
MNOP     DC    A(COPYRTN)     EXTERNAL REFERENCE TO IEHMVSSZ            08860000
ABSE     DC    A(IEHMVESV)    ENTRY POINT FOR THIS MODULE               08880000
PREAB    DC    A(PREABORT)    EXTERNAL REFERENCE TO IEHMVSSZ            08900000
         DS    0F                                                       08920000
FF       DC    4X'FF'                                                   08940000
FOXES    DC    X'0000FFFF'              BIT SETTINGS TO        @ZM30153 08950003
*                                       CLEAR REGISTER         @ZM30153 08952003
DOG      DC    C'  SZ'                                                  08960000
INFO     DS    0CL20                   +                         S21042 08970021
         DS    CL10                    +DEVICE TYPE              S21042 08972021
TRCYL    DS    CL2                     +CHARACTERISTICS          S21042 08974021
         DS    CL8                     +                         S21042 08976021
CCHHR    DS    CL5                     ABS ADDR OF 'FROM' DSCB   S21042 08978021
         EJECT                                                          08980000
ITHEAD   DSECT                                                          09000000
GENERICC DS    CL1                      GENERIC NAME COUNT              09020000
GENERICP EQU   GENERICC                 POINTER TO GENERIC DDNAMES      09040000
         DS    CL3                                                      09060000
INDICATO DS    CL1                      INDICATOR BYTE                  09080000
*                                                                       09100000
MOUNT    EQU   X'80'                                                    09120000
SELECT   EQU   X'40'                                                    09140000
OLDVALID EQU   X'20'                                                    09160000
TABLE    EQU   X'10'                                                    09180000
YESMOUNT EQU   X'01'                                                    09200000
*                                                                       09220000
         DS    CL3                                                      09240000
PTRINTAB EQU   INDICATO                                                 09260000
LENINTAB DS    CL2                                                      09280000
CNTINTAB DS    CL1                                                      09300000
CNTVMR   DS    CL1                                                      09320000
         TITLE 'DSCB FORMAT'                                            09340000
DSCBDSEC DSECT                                                          09360000
         IECSDSL1 (1)                                                   09380000
         TITLE 'MOVE-COPY COMMUNICATIONS TABLE'                         09400000
         IEHMVV                                                         09420000
         ORG   IEHMVV00                                                 09440000
         IEFJFCBN                                                       09460000
         TITLE 'DCB FORMAT'                                             09480000
         DCBD  DSORG=(PS,IS,DA,PO)                                      09500000
         END                                                            09520000
