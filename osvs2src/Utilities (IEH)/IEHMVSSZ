 TITLE 'IEHMVSSZ-VOLUME OPERATIONS FOR IEHMOVE LOAD MODULE ESZ'         00020017
*TITLE -IEHMVSSZ                                                        00030017
*FUNCTION/OPERATION: TO HANDLE VOLUME OPERATIONS AND TO HANDLE ERROR  * 00040000
*RETURNS FROM CALLED ROUTINES.                                        * 00060000
*ENTRY POINTS: IEHMVESZ                                               * 00080000
*INPUT: MOVE/COPY COMMUNICATIONS TABLE                                * 00100000
*OUTPUT: NONE                                                         * 00120000
*EXTERNAL ROUTINES: IEHMVSSVA                                         * 00140000
*EXITS-NORMAL XCTL TO IEHMVESX                                        * 00160000
*ERRORS: NONE                                                         * 00180000
*TABLES/WORK AREAS: MOVE/COPY COMMUNICATIONS TABLE                    * 00200000
*ATTRIBUTES: REUSEABLE                                                * 00220000
*NOTES: PART OF LOAD MODULE IEHMVESZ                                  * 00240000
*                                                                       00260000
         TITLE 'SINGLE DATA SET CONTROL'                                00280000
*                                                                       00300000
*                                  LOAD MODULE  IEHMVL20                00320000
*                                               SINGLE DATE SET         00340000
*                                                                       00360000
*                                                                       00380000
IEHMVSSZ CSECT                                                          00400000
*A048300                                                       @ZA26443 00400199
*A026100,036440-036560                                         @ZA16493 00400200
*A34100-34120,40500,108100                                      YM05783 00400402
*C34400                                                         YM05783 00400802
*A19404-19435,19448-19514,20100-20180,21300-21340,57900         YL026VC 00401802
*A58420-58796,97300-97700,98700                                 YL026VC 00402202
*C12500,14400,98200,98800                                       YL026VC 00402602
*D100,12200-12400,12600-14200,27800-30800,58000-58400           YL026VC 00403002
*D77800-78000,97800-9800,098400-98600                           YL026VC 00403402
*C19431,20120-20140                                              Y02918 00403502
*A19432-19433                                                    Y02918 00403702
*A086820,086920                                                  YM5081 00403802
*C084920,086800-090320,095000,096100,100000-100700              YA01220 00405602
*A105050-105150                                                 YA01220 00407402
*D105800-106000,107400-107600                                   YA01220 00409202
*A014300                                                        YA01195 00411002
*A085700                                                         A48757 00412802
*C085800                                                         A48757 00414602
*A014400                                                         A43752 00416402
* 090000                                                         A24006 00418202
*1980 004200                                                       UL0H 00420017
*                                                                       00440000
*  017600-017800                                                 A17911 00450018
* 088400,089200,090400-091800,096200,096600-096800,097400-097600 S21042 00452021
* 100400,101400-101600,109200                                    S21042 00454021
*D019456-019458                                                @Z40CSJH 00456004
*A012100-012200,027800-027820,078100-078120                    @Z40CSJH 00458004
*A098820-098860                                                @Z40CSJH 00458404
*D034600                                                       @ZA06522 00458899
*                                                                       00460000
*              LOAD MODULE ENTRY POINT  IEHMVESZ               @ZA16493 00480099
IEHMVESZ SAVE (14,12),T,IEHMVSSZ-OZ26443                                00490099
         ENTRY IEHMVESZ                                                 00520000
*                                                                       00540000
    USING  IEHMVV,MCTABLE                                               00560000
*                                                                       00580000
*              REGISTERS                                                00600000
*                                                                       00620000
PASSA    EQU   0                                                        00640000
PASSB    EQU   1                                                        00660000
R2       EQU   2                                                        00680000
R3       EQU   3                                                        00700000
ACCE     EQU   4                                                        00720000
ACCO     EQU   5                                                        00740000
BASE     EQU   6                                                        00760000
R7       EQU   7                                                        00780000
R8       EQU   8                                                        00800000
R9       EQU   9                                                        00820000
R10      EQU   10                                                       00840000
R11      EQU   11                                                       00860000
MCTABLE  EQU   12                                                       00880000
SAVE     EQU   13                                                       00900000
RETURN   EQU   14                                                       00920000
LINK     EQU   15                                                       00940000
         BALR  BASE,0                                                   00960000
         USING *,BASE                                                   00980000
SINGLE   DS    0H                  LABEL CARD ONLY                      01000000
*                       FIRST TIME SWITCH QUESTIONS VOLUME MOUNTING     01020000
         TM    IEHMVV20+4,TEN      IS THIS VOLUME MOUNTED               01040000
         BZ    ABCB                          RE-ENTER                   01060000
         NI    IEHMVV20+4,OFF      YES,TURN FIRST TIME SWITCH OFF       01080000
         L     RETURN,RRR                                               01100000
         BR    RETURN                                                   01120000
ABCB     DS    0H                  LABEL CARD ONLY                      01140000
    IEHPRE  (14,1),TFC,                                                 01160000
         TM    IEHMVV20,VOLUME          VOLUME MOVE                     01180000
         BO    VOLUMEMV                 YES                             01200000
         TM    IEHMVV20,CATALOG         MOVE CATALOG FUNCTION  @Z40CSJH 01210004
         BO    SETCAT                   YES                    @Z40CSJH 01220004
SINGLEOK DS    0H                      LABEL CARD ONLY                  01250002
         XC    IEHMVV62(4),IEHMVV62    CLEAR PTR                YA01195 01430002
         XC   IEHMVV10-12(12),IEHMVV10-12     CLEAR SWITCH AREA         01440002
         XC    IEHMVV82+16(12),IEHMVV82+16                       A43752 01450021
         L     ACCE,IEHMVV10                                            01460000
         LA    ACCO,28(0,ACCE)                                          01480000
         ST    ACCE,IEHMVV30+4                                          01500000
         LA    ACCE,28(0,ACCO)                                          01520000
         ST    ACCO,IEHMVV31+4                                          01540000
         ST    ACCE,IEHMVV10                                            01560000
         TM    IEHMVV20+3,RENAME   TEST FOR RENAME INDICATION           01580000
         BO    NOCH                                                     01600000
         MVC   IEHMVV21+4(4),IEHMVV21  CHANGE'TO'DSNAME ADDRESS         01620000
NOCH     DS    0H                  LABEL CARD ONLY                      01640000
         XC    IEHMVV30(4),IEHMVV30    BLANK ADDRESS OF FROM DCB        01660000
*                                                                       01680000
*                                  PROCESS                              01700000
*                                       CALL COPY-UNLOAD-LOAD-ABORT     01720000
*                                                                       01740000
         TM    IEHMVV20,X'02'      IS THIS A VOLUME MOVE ?       A17911 01750018
         BO    COPYRTN             YES--DO NOT GO TO IEHCULAT.   A17911 01760018
         L     LINK,COPYTEST       GET ADDRESS OF IEHMVESV (EN-  A17911 01770018
*                                    TRY POINT OF CSECT IEHCULAT)A17911 01780018
         BALR  RETURN,LINK         BRANCH TO IEHCULAT.           A17911 01790018
         DROP  BASE                                                     01800000
COPYRTN  DS    0H                      LABEL CARD ONLY                  01820000
         BALR  LINK,0                                                   01840000
         USING *,LINK                                                   01860000
         L     BASE,ASIN                                                01880000
         DROP  LINK                                                     01900000
         USING SINGLE,BASE                                              01920000
*                                                                       01940000
**********************************************************************  01940402
*                                                                    *  01940802
* THIS SECTION TESTS FOR DATA SET ORGANIZATION.  IEHMOVE CANNOT      *  01941202
* PROCESS VSAM DATA SET/SPACES OR ISAM DATA SETS                     *  01941604
* ALTHOUGH FOR VOLUME OPERATIONS THE DATA SET ORGANIZATION COULD     *  01941702
* HAVE BEEN TESTED IN THE XRAYVTOC SECTION, ALL TESTING OF DATA      *  01941802
* SET ORGANIZATION IS DONE HERE.                                     *  01941902
* IF IEHMOVE CANNOT PROCESS THE DATA ORGANIZATION, MESSAGE IEH474I   *  01942102
* IS PRINTED.  FOR A SINGLE DATA SET OPERATION THE RETURN CODE IS 12 *  01942502
* AND ALL PROCESSING STOPS FOR THAT REQUEST.  IF IT IS A VOLUME      *  01942602
* REQUEST, THE RETURN CODE IS 4 AND IEHMOVE GETS THE NEXT ENTRY      *  01943002
* FROM THE VTOC TO BE MOVED/COPIED. IF IT IS A DSGROUP REQUEST,      *  01943102
* THE RETURN CODE IS 4 AND IEHMOVE GETS THE NEXT DATA SET OF         *  01943202
* THE GROUP.                                                         *  01943302
*                                                                    *  01943402
**********************************************************************  01943502
         L     ACCE,IEHMVV30+8     GET ADDR OF 'FROM' DSCB.      A17911 01944602
         TM    83(ACCE),VSAM           IS VSAM ORGANIZATION     YL026VC 01944802
         BO    ORGERR                  ERROR IF VSAM            YL026VC 01945002
         TM    82(ACCE),ISAM           IS ISAM ORGANIZATION     YL026VC 01945202
         BO    ORGERR                  ERROR IF ISAM            YL026VC 01945402
         TM    IEHMVV20,VOLORDSG       VOLUME OR DSGROUP        YL026VC 01946002
         BZ    TESTMOV                 IF NOT, DO NOT PRINT     YL026VC 01947102
         MVI   IEHMVV61,NAME           SET UP TO PRINT NAME     YL026VC 01949102
         BAL   RETURN,MSG              PRINT DSNAME             YL026VC 01951102
TESTMOV  EQU   *                       TEST FOR UNMOVEABLE DATA YL026VC 01951402
         TM    82(ACCE),X'01'      CHECK DSORG FIELD OF 'FROM'   A17911 01952002
*                                    DSCB FOR UNMOVABLE DATA.    A17911 01954402
         BZ    NOTUNMOV            NOT UNMOVABLE -- EXIT         A17911 01957602
         NI    82(ACCE),X'FE'      UNMOVABLE DATA--TURN OFF      A17911 01960802
         OI    IEHMVV10-4,X'08'      UNMOVABLE BIT IN DSCB AND   A17911 01964002
*                                    TURN ON UNMOVABLE BIT IN    A17911 01967202
*                                    IEHMOVE SWITCH AREA.        A17911 01970402
NOTUNMOV EQU   *                   LABEL CARD                    A17911 01973602
     IEHPOST  (14,1),TFC,                                               01976802
         L     RETURN,12(SAVE)                                          01980000
   XCTL   (2,12),EP=IEHMVESX                                            02000000
ORGERR   MVI   IEHMVV61,BADORG         INDICATOR FOR IEH474I    YL026VC 02010002
         TM    IEHMVV20,VOLORDSG       VOLUME OR DSGROUP         Y02918 02012002
         BM    PREABORT                RETURN CODE WILL BE 4     Y02918 02014002
         OI    IEHMVV41+13,X'10'       SET RETURN CODE TO 12    YL026VC 02016002
         B     PREABORT                PRINT MESSAGE            YL026VC 02018002
***** CONSTANTS *****                                                   02020000
COPYTEST DC    A(IEHMVESV)                                              02040000
         EXTRN IEHMVESV                                                 02060000
         ENTRY COPYRTN                                                  02080000
RRR      DC    A(RTNVM)                                                 02100000
         EXTRN RTNVM                                                    02120000
VSAM     EQU   X'08'                  VSAM INDICATOR            YL026VC 02130002
ISAM     EQU   X'80'                  ISAM INDICATOR            YL026VC 02132002
BADORG   EQU   27                     INDICATOR FOR IEH474I     YL026VC 02134002
NINETY   EQU X'90'                                                      02140000
TEN      EQU   X'10'                                                    02160000
OFF      EQU   X'EF'                                                    02180000
CATALOG  EQU   X'04'                                                    02200000
VOLORDSG EQU   X'12'                                                    02220000
NAME     EQU   X'8B'                                                    02240000
RENAME   EQU   X'04'                                                    02260000
F1       EQU   X'F1'                                                    02280000
DEACTIVE EQU   X'00'                                               UL0H 02290017
ZERO     EQU   X'00'                                                    02300000
LIST     EQU   X'87'                                                    02320000
DASDY    EQU   X'20'                                                    02340000
BO       EQU   X'B0'                                                    02360000
FOURTEEN EQU   X'14'                                                    02380000
EDRETURN EQU   140                                                      02400000
FC       EQU   X'FC'                                                    02420000
F2       EQU   X'2F'                                                    02440000
ONE      EQU   X'01'                                                    02460000
EIGHT    EQU   X'08'                                                    02480000
IA       EQU   X'1A'                                                    02500000
OE       EQU   X'0E'                                                    02520000
BLANK    EQU   C' '                                                     02540000
FOUR     EQU   X'04'                                                    02560000
S        EQU   X'E2'                                                    02580000
T        EQU   X'E3'                                                    02600000
Y        EQU   X'E8'                                           @ZA16493 02610099
K        EQU   X'D2'                                                    02620000
H        EQU   X'C8'                                                    02640000
FF       EQU   X'FF'                                                    02660000
I        EQU   X'C9'                                                    02680000
F7       EQU   X'7F'                                                    02700000
EOF      EQU   X'20'                                                    02720000
VOLUME   EQU   X'02'                                                    02740000
FVOLUME  EQU   X'80'                                                    02760000
**********************************************************************  02770004
* LINES 028100-030996 WERE REACTIVATED IN SUPPORT              @Z40CSJH 02780004
* OF THE EXTENDED MVS CVOL FUNCTION                            @Z40CSJH 02790004
**********************************************************************  02800004
ANDBITS  DC    X'C088207180'                                            02810004
ORBITS   DC    X'0440000000'                                            02860004
CAT4VOL  NC    IEHMVV20(5),ANDBITS      RESET VARIOUS VOLUME OPERATIONS 02910004
         OC    IEHMVV20(5),ORBITS       TURN ON SWITCHES FOR CATALOG    02960004
         MVC   IEHMVV24(4),IEHMVV22     FROM VOL BECOMES A CVOL         03010004
         MVC   IEHMVV10(4),IEHMVV30+8   RESET PERMANENT WORK AREA       03060004
SETCAT   MVC   IEHMVV61(8),IEHMVV21     SET UP CAT INCLUDE AND EXCLUDE  03070004
         MVC   IEHMVV86(4),IEHMVV62    SAVE EXC ADR FOR ESC    @XA02965 03080004
         L     ACCE,IEHMVV10                                            03090004
         LA    ACCO,44(ACCE)            UP WORK AREA POINTER            03092004
         ST    ACCO,IEHMVV10                                            03094004
         MVI   0(ACCE),BLANK           BLANK OUT WORKAREA DSNAME FIELD  03096004
         MVC   1(43,ACCE),0(ACCE)                                       03098004
         MVC   0(7,ACCE),SYSCTLG        SET UP SYSCTLG DSNAME           03098404
         ST    ACCE,IEHMVV21            PLACE ADDRESS IN WORK AREA      03098804
         B     SINGLEOK                                                 03099204
SYSCTLG  DC    CL7'SYSCTLG'                                             03099604
      DS     0H                                                         03100000
         TITLE 'PRE ABORT ROUTINE'                                      03120000
PREABORT DS    0H                      LABEL CARD ONLY                  03140000
         ENTRY PREABORT                                                 03160000
         BALR  LINK,0                                                   03180000
         USING *,LINK                                                   03200000
    L   BASE,ASIN                                                       03220000
         DROP  LINK                                                     03240000
    USING   SINGLE,BASE                                                 03260000
         TM    IEHMVV10-4,FVOLUME      FROM VOLUME TO BE CLOSED         03280000
         BO    CLOSEF                  YES.GO TO CLOSE FROM VOLUME      03300000
FCLOSE   TM    IEHMVV10-4,BLANK        TO VOLUME TO BE CLOSED           03320000
         BO    CLOSET                  YES.GO TO CLOSE TO VOLUME        03340000
TCLOSE   DS    0H                      LABEL CARD ONLY                  03360000
         BAL   RETURN,MSG               GO TO MESSAGE WRITER            03380000
         IEHPOST (14,1),TFC,                                            03400000
         CLI   MV61SV,BADORG           IEH474I ISSUED           YM05783 03410002
         BE    NOPOST                  NO                       YM05783 03412002
   IEHPOST  (14,1),TFC,                                                 03420000
NOPOST   OI    IEHMVV41+13,X'01'   RET CODE = 4                 VS05783 03440002
         TM    IEHMVV20,VOLUME         TEST FOR VOLUME OPERATION        03480000
   BO  SINGLE                                                           03500000
         MVC   IEHMVV00(6),MODNAME                                      03520000
         MVI   IEHMVV00+6,S            ADD LETTER'S' TO MODULE NAME     03540000
         TM    IEHMVV20,TEN            DSGROUP OPERATION                03560000
         BO    GODSG                                                    03580000
         TM    IEHMVV20+2,EOF                                           03600000
         BO    GOHOME                                                   03620000
         MVI   IEHMVV00+7,T            ADD LETTER'T' TO MODULE NAME     03640000
         TM    IEHMVV20+5,X'08'        SHOULD A DUMMY FILE     @ZA16493 03644099
*                                      BE WRITTEN              @ZA16493 03648099
         BNO   ALLDONE                                         @ZA16493 03652099
         MVI   IEHMVV00+7,Y            YES GO TO IEHMVESY      @ZA16493 03656099
ALLDONE  DS    0H                      LABEL CARD ONLY                  03660000
         XCTL  (2,12),EPLOC=(12)                                        03680000
GOHOME   MVI   IEHMVV00+7,K            ADD LETTER 'K' TO MODULE NAME    03700000
         B     ALLDONE                                                  03720000
GODSG    DS    0H                      LABEL CARD ONLY                  03740000
         MVI   IEHMVV00+7,H            ADD LETTER'H' TO MODULE NAME     03760000
         B     ALLDONE                                                  03780000
CLOSEF   DS    0H                      LABEL CARD ONLY                  03800000
         MVI   IEHMVV70+8,DEACTIVE                                 UL0H 03810017
         L     ACCE,IEHMVV30           LOAD ADDRESS OF FROM DCB         03820000
         CLOSE ((ACCE))                CLOSE FROM DATA SET              03840000
         B     FCLOSE                                                   03860000
CLOSET   DS    0H                      LABEL CARD ONLY                  03880000
         MVI   IEHMVV70+12,DEACTIVE    DEACTIVATE O'PUT TRLR EXIT  UL0H 03890017
         L     ACCE,IEHMVV31           LOAD ADDRESS OF TO DCB           03900000
         CLOSE ((ACCE))                CLOSE TO DATA SET                03920000
         B     TCLOSE                                                   03940000
MODNAME  DC    CL6'IEHMVE'                                              03960000
         TITLE 'MESSAGE HANDLER'                                        03980000
         DROP  BASE                                                     04000000
MSG      DS    0H                      LABEL CARD ONLY                  04020000
         STM   PASSA,LINK,200(MCTABLE) STORING REGISTERS                04040000
         MVC   MV61SV,IEHMVV61         SAVE MSG CODE            YM05783 04050002
         BALR  LINK,0                  SET UP ADDRESSABILITY            04060000
         USING *,LINK                                                   04080000
    L     BASE,ASIN                                                     04100000
         DROP  LINK                    DROP BASE REGISTERS              04120000
      USING    SINGLE,BASE                                              04140000
         LR    R7,RETURN                                                04160000
         MVI   IEHMVV00,FF             SET UP MESSAGE AREA              04180000
         MVI   IEHMVV00+1,BLANK        BLANK OUT PRINT LINE             04200000
         MVC   IEHMVV00+2(120),IEHMVV00+1                               04220000
         TM    IEHMVV61,ONE       DATA SET MESSAGE OR NORMAL MESSAGE    04240000
         BO    NORMMES            ODD NUMBER IN VV61 IS NORMAL MESSAGE  04260000
*                        PROCESS DATA SET MESSAGES                    * 04280000
*                                  HERE                               * 04300000
*                         EVEN NUMBER IN VV61                         * 04320000
         MVC   IEHMVV00+1(4),IEH4       SET UP MSG NUMBER               04340000
         LA    ACCE,127                 GET IEH4                        04360000
         SR    ACCO,ACCO                                                04380000
         IC    ACCO,IEHMVV61                                            04400000
         NR    ACCO,ACCE                                                04420000
         L     R3,ADIEH4DD             SET UP MESSAGE DIAGNOSTIC CODE   04440000
         LA    ACCO,0(R3,ACCO)                                          04460000
    MVC   IEHMVV00+5(2),0(ACCO)                                         04480000
         MVI   IEHMVV00+7,I            END CODE WITH LETTER 'I'         04500000
         L     ACCE,MSGH                SET UP MSG HEADER               04520000
         LA    ACCO,7                                                   04540000
         BAL   R8,MSGMOVE                                               04560000
         TM     IEHMVV20,X'02'         IS THIS A VOL REQUEST            04580000
         BZ     CONT                   NO  BRANCH                       04600000
         TM     IEHMVV20+3,FVOLUME     YES  IS THIS THE FIRST DATA SET  04620000
         BO     CONT                   NO   BRANCH                      04640000
         LA     ACCE,TEMPNAME          YES   SET UP DSNAME OF VOL       04660000
         LA     ACCO,5                 NAME LENGTH                      04680000
         B      VOLNAME                                                 04700000
CONT     L      ACCE,IEHMVV21          SET UP DSNAME                    04720000
         LA    ACCO,43                                                  04740000
VOLNAME  BAL    R8,MSGMOVE                                              04760000
         TM    IEHMVV61,FVOLUME        UNLOAD MESSAGE OR NOT MOVED      04780000
         BO    MSGUNLD                       UNLOAD MSG                 04800000
         LA    ACCE,2                        NOT MOVED                  04820000
         OI    IEHMVV20+2,X'40'        SET MIDABORT            @ZA26443 04830099
MSGAA    DS    0H                      LABEL CARD ONLY                  04840000
         BAL   R8,MSGDMOVE              SET UP FINAL PART               04860000
         SR    ACCE,ACCE                                                04880000
         IC    ACCE,IEHMVV61                 OF MSG                     04900000
         BAL   R8,MSGDMOVE                                              04920000
PRINTMES  SR   0,0                      TO PRINT A NORMAL MESSAGE       04940000
         LA    3,IEHMVV00                                               04960000
         LINK  EP=IEHMVESU        GO TO PRINT ROUTINE WITH (3) AS PARAM 04980000
         B     MSGCHECK(LINK)           CHECK RETURNS                   05000000
MSGCHECK B     GOODMSG                  GOOR WRITE                      05020000
         XCTL  EP=IEHMVESK              I/O ERROR                       05040000
GOODMSG  LR    RETURN,R7                                                05060000
         MVI   IEHMVV61,ZERO           MOVE ZERO INTO MESSAGE INDICATOR 05080000
         LM    PASSA,LINK,200(MCTABLE) RESTORE REGISTERS                05100000
         BR    RETURN                  BRANCH BACK TO CALLING ROUTINE   05120000
MSGUNLD  DS    0H                      LABEL CARD ONLY                  05140000
         NI    IEHMVV61,F7             TURN OFF UNLOAD MESSAGE BIT      05160000
         LA    ACCE,0                                                   05180000
         B     MSGAA                                                    05200000
MSGDMOVE DS    0H                      LABEL CARD ONLY                  05220000
    SLL   ACCE,1                                                        05240000
         L     R3,ADMSGST              LOAD ADDRESS OF MSGSTART         05260000
         LH    ACCO,2(R3,ACCE)         ACCESSING PROPER MESSAGE         05280000
         LH    ACCE,0(R3,ACCE)                                          05300000
         A     ACCE,MSGH                                                05320000
MSGMOVE  DS    0H                      LABEL CARD ONLY                  05340000
         LA    R9,IEHMVV00+121                                          05360000
MSGLOOP  CLI   0(R9),BLANK             THIS LOOP WILL FIND FIRST BLANK  05380000
         BNE   MSGPL                         CHARACTER IN               05400000
         BCT   R9,MSGLOOP                    MSG AREA                   05420000
MSGPL    DS    0H                      LABEL CARD ONLY                  05440000
         EX    ACCO,MSMOVE             MOVE MESSAGE IN PRINTOUT AREA    05460000
         BR    R8                      BRANCH BACK TO FINISH MESSAGE    05480000
NORMMES  DS    0H                      LABEL CARD ONLY                  05500000
         SR    ACCE,ACCE                                                05520000
         IC    ACCE,IEHMVV61            GET MESSAGE NUMBER              05540000
     LA   ACCO,127                                                      05560000
    NR   ACCE,ACCO                                                      05580000
         LA    ACCE,1(0,ACCE)                                           05600000
         SLL   ACCE,1                                                   05620000
         L     R3,ADNORMAL             LOAD ADDRESS OF NORMAL MESSAGE   05640000
         L     ACCE,0(R3,ACCE)         GET MESSAGE POINTER              05660000
         SR    ACCO,ACCO                                                05680000
         IC    ACCO,0(ACCE,0)           GET MESSAGE LENGTH              05700000
         LA    ACCE,1(0,ACCE)                                           05720000
         EX    ACCO,NORMM               MOVE MESSAGE TO PRINT AREA      05740000
         TM    IEHMVV61,FVOLUME        IS VOLUME OPERATION      YL026VC 05790002
         BO    ADDNAME                 PUT NAME AT END          YL026VC 05842002
**********************************************************************  05844002
*                                                                    *  05846002
* FOR MESSAGE IEH474I, BAD ORGANIZATION, THE DATA SET/SPACE NAME     *  05848002
* IS PUT AT THE BEGINNING OF THE MESSAGE.                            *  05848402
*                                                                    *  05848502
**********************************************************************  05848802
         CLI   IEHMVV61,BADORG         BAD ORGANIZATION MSG.    YL026VC 05850002
         BNE   PRINTMES                PRINT MESSAGE            YL026VC 05860002
         LA    R9,IEHMVV00+7           START OF DSNAME MINUS 2  YL026VC 05870002
         LA    ACCO,43                 LENGTH OF DSNAME MINUS 1 YL026VC 05872002
         L     ACCE,IEHMVV21           ADDRESS OF DSNAME        YL026VC 05874002
         EX    ACCO,MSMOVE             MOVE DSNAME INTO MESSAGE YL026VC 05876002
         B     PRINTMES                PRINT MESSAGE            YL026VC 05878002
ADDNAME  LA    ACCO,43                 LENGTH OF DSNAME MINUS 1 YL026VC 05878402
         L     ACCE,IEHMVV21           ADDRESS OF DSNAME        YL026VC 05878802
         BAL   R8,MSGMOVE              MOVE NAME TO START OF MSG.Y02063 05879202
         B     PRINTMES                PRINT MESSAGE            YL026VC 05879602
NORMM    MVC   IEHMVV00+1(1),0(ACCE)                                    05880000
IEH4     DC    CL4'IEH4'                                                05900000
MSMOVE   MVC   2(1,R9),0(ACCE)                                          05920000
MSGH     DC    A(MSGHEAD)               POINTER TO MESSAGES             05940000
         ENTRY MSG                                                      05960000
         EXTRN IEH4DD                                                   05980000
         EXTRN MSGSTART                                                 06000000
         EXTRN NORMALM                                                  06020000
         EXTRN MSGHEAD                                                  06040000
ADMSGST  DC    A(MSGSTART)                                              06060000
ADNORMAL DC    A(NORMALM)                                               06080000
ADIEH4DD DC    A(IEH4DD)                                                06100000
         EJECT                                                          06120000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 06140000
*                                                                     * 06160000
*   THIS ROUTINE HANDLES THE OPENING OF THE VTOC TO MOVE ONE DATASET  * 06180000
*   OF A VOLUME MOVE OPERATION AND MOUNTING OF THE TO AND FROM VOLUMES* 06200000
*                                                                     * 06220000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 06240000
IEHMVSSZ CSECT                                                          06260000
VOLUMEMV DS    0H                                                       06280000
         BALR  LINK,0                                                   06300000
         USING *,LINK                                                   06320000
    L   BASE,ASIN                                                       06340000
         DROP  LINK                                                     06360000
    USING  SINGLE,BASE                                                  06380000
         TM    IEHMVV20+3,FVOLUME       FIRST DS OF VOLUME MOVE         06400000
        BO    NOT1                     NO                               06420000
         L     PASSB,IEHMVV22          YES                              06440000
         CLI   2(PASSB),DASDY          IS FROM VOLUME DIRECT ACCESS     06460000
         BNE   NOMOVEVO                 NO                              06480000
*                                       YES                             06500000
*                                                                       06520000
*                                       CALL VOL MOUNT FOR VOLUME       06540000
*                                                                       06560000
         XC    IEHMVV00(12),IEHMVV00                                    06580000
         MVI   IEHMVV00+4,NINETY       SET INDICATOR FOR VOLUME MOUNT   06600000
         L     LINK,CALMT                                               06620000
         MVI   IEHMVV00+400,TEN        SET UP VOLUME MOUNT RETURN CODE  06640000
         BALR  RETURN,LINK              GO TO CALL VOL MOUNT            06660000
KK1      DS    0H                      LABEL CARD ONLY                  06680000
         ENTRY KK1                                                      06700000
         DROP  BASE                                                     06720000
         USING KK1,RETURN                                               06740000
         L     BASE,ASIN                                                06760000
         DROP  RETURN                                                   06780000
         USING SINGLE,BASE                                              06800000
         B     VOLOKMT(LINK)            CHECK VOLUME MOUNTING           06820000
VOLOKMT  B     NOVOLMT                  NOT MOUNTED                     06840000
         ST    PASSB,IEHMVV30+12   MOUNTED (STORE ADDR OF FROM DDNAME)  06860000
        MVC   IEHMVV22+4(4),IEHMVV22   ACTIVE FROM                      06880000
*                                       CALL VOL MOUNT FOR TO VOLUME    06900000
         XC    IEHMVV00(12),IEHMVV00                                    06920000
         MVI   IEHMVV00+4,BO           SET INDICATOR FOR VOLUME MOUNT   06940000
         L     PASSB,IEHMVV23+4        PASS TO VOLUME LIST ENTRY POINT  06960000
         L     LINK,CALMT                                               06980000
         MVI   IEHMVV00+400,FOURTEEN   SET UP VOLUME MOUNT RETURN CODE  07000000
         BALR  RETURN,LINK              GO TO CALL VOL MOUNT            07020000
KK2      DS    0H                      LABEL CARD ONLY                  07040000
         ENTRY KK2                                                      07060000
         DROP  BASE                                                     07080000
         USING KK2,RETURN                                               07100000
         L     BASE,ASIN                                                07120000
         DROP  RETURN                                                   07140000
         USING SINGLE,BASE                                              07160000
         B     VOLTOA(LINK)             VOLUME MOUNTED                  07180000
VOLTOA   B     NOTOMT                   NO                              07200000
         ST    PASSB,IEHMVV31+8      YES (STORE ADDR OF TO DDNAME)      07220000
GOTOED   DS    0H                      LABEL CARD ONLY                  07240000
         L     LINK,ED                                                  07260000
         BALR  RETURN,LINK                                              07280000
         L     ACCE,IEHMVV30+8      'FROM'DSCB POINTER FROM XRAYVTOC    07300000
         SR    LINK,LINK                                                07320000
         IC    LINK,EDRETURN(ACCE)      CHECK RETURNS                   07340000
         B     CKED(LINK)                                               07360000
CKED     B     VOLIOERR                 IO ERROR ON FROM VOLUME         07380000
         B     AEOF                     EOF ON VTOC                     07400000
*                                       RETURNED A DSCB                 07420000
         ST    ACCE,IEHMVV21            SET UP FROM DS NAME             07440000
         B     SINGLEOK                 RETURN TO NORMAL PROCESSING     07460000
NOT1     MVC   IEHMVV10(4),IEHMVV30+8                                   07480000
         NI    IEHMVV20+1,FC           RESET COMMUNICATIONS AREA        07500000
         NI    IEHMVV20+2,F2                  INDICATORS AND            07520000
         XC    IEHMVV21(8),IEHMVV21                                     07540000
         XC    IEHMVV30(12),IEHMVV30                                    07560000
         XC    IEHMVV31(8),IEHMVV31     CLEAR SOME AREAS OF             07580000
    XC   IEHMVV43(8),IEHMVV43                                           07600000
         XC    IEHMVV60(16),IEHMVV60                                    07620000
         B     GOTOED                   GO TO GET ANOTHER DSCB          07640000
NOMOVEVO DS 0H                                                          07660000
         MVI   IEHMVV61,ONE            INDICATE MESSAGE TYPE FOR WRITER 07680000
    B    PRESTOP                                                        07700000
PRESTOP  BAL   RETURN,MSG               GO TO MESSAGE WRITER            07720000
         OI    IEHMVV41+13,X'01'   RET CODE = 4                         07740000
AEOF     DS    0H                      LABEL CARD ONLY                  07760000
         TM    IEHMVV20+4,ONE          CATLG TO BE MOVED       @Z40CSJH 07810004
         BO    CAT4VOL                  YES ..... BRANCH       @Z40CSJH 07812004
         MVC   IEHMVV00(6),MODNAME                                      07820000
         MVI   IEHMVV00+6,S            ADD LETTER 'S' TO MODULE NAME    07840000
         TM    IEHMVV20+2,EOF                                           07860000
         BO    VEOF                                                     07880000
         MVI   IEHMVV00+7,T            ADD LETTER 'T' TO MODULE NAME    07900000
LEAVEVOL DS    0H                      LABEL CARD ONLY                  07920000
    IEHPOST  (14,1),TFC,                                                07940000
*                                                                       07960000
         XCTL  (2,12),EPLOC=(12)                                        07980000
VEOF     MVI   IEHMVV00+7,K            ADD LETTER 'K' TO MODULE NAME    08000000
         B     LEAVEVOL                                                 08020000
CALMT    DC    A(CALLMT)                                                08040000
         EXTRN CALLMT                                                   08060000
NOVOLMT  MVI   IEHMVV61,EIGHT          SET INDICATOR FOR MESSAGE WRITER 08080000
         B     PRESTOP                                                  08100000
NOTOMT   MVI   IEHMVV61,IA             SET INDICATOR FOR MESSAGE WRITER 08120000
         B     PRESTOP                                                  08140000
VOLIOERR MVI   IEHMVV61,OE             SET &ND&CATO- FO- MESSAGE W-ITER 08160000
         B     PRESTOP                                                  08180000
ED       DC    A(XRAYVTOC)                                              08200000
ASIN     DC    A(SINGLE)                                                08220000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 08240000
*                                                                     * 08260000
*                               XRAYVTOC                              * 08280000
*     THIS ROUTINE OBTAINS ONE FORMAT ONE DSCB FROM THE VTOC FOR A    * 08300000
*     VOLUME MOVE OPERATION. FOR EACH DSCB ONE DATASET WILL BE MOVED  * 08320000
*                                                                     * 08340000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 08360000
XRAYVTOC SAVE  (14,12)             SAVE REGISTERS                       08380000
         ST    SAVE,XXREG13            SAVE POINTER TO SAVE AREA        08400000
         LA    SAVE,XXSAVE             SET UP SAVE AREA FOR CALLED RTN  08420000
         L     R11,IEHMVV10            ADDRESS OF PERMANENT WORK AREA   08440000
         USING XXDSCB,R11                                               08460000
         USING XRAYVTOC,LINK                                            08480000
         TM    IEHMVV20+3,FVOLUME     IS THIS FIRST VOLUME ENTRY S21042 08490021
         BO    XXEODAD                                          YA01220 08492002
         MVI   XXJFCB,FOUR             PLACE THE NAME OF THE            08500000
         MVC   XXJFCB+1(43),XXJFCB      VTOC INTO THE JFCB AND          08520000
         MVI   XXMEMBER,BLANK          STORE BLANKS INTO THE            08540000
         MVC   XXMEMBER+1(7),XXMEMBER   MEMBER NAME FIELD.              08560000
         MVI   XX00,X'08'              DON'T WRITE BACK THE JFCB A48757 08570022
         XC    XX00+1(139),XX00+1                                A48757 08580022
         MVI   XXVOLID-1,ONE                                            08600000
         L     R3,IEHMVV22+4           POINT AT ACTIVE FROM VOLUME      08620000
         MVC   XXVOLID(6),4(R3)        PUT VOLUME SERIAL NO. INTO JFCB  08640000
         MVI   XXVOLID+6,BLANK         BLANK OUT NEXT BYTE              08660000
         LA    PASSA,XXDCBL            LENGTH OF DCB            YA01220 08680002
         LR    R7,LINK                 SAVE REGISTER 15          YM5081 08682002
         GETMAIN R,LV=(0)              GET AREA FOR DCB         YA01220 08690002
         LR    LINK,R7                 RESTORE REGISTER 15       YM5081 08692002
         LA    R3,0(PASSB)             CLEAR HIGH ORDER BYTE    YA01220 08700002
         ST    R3,IEHMVV82+8           SAVE DCB ADDRESS         YA01220 08710002
         USING IHADCB,R3                                                08720002
         MVC   IHADCB(XXDCBL),XXDCBSTT SAVE DCB                 YA01220 08730002
         LA    PASSB,XXFULL            EXIT LIST ADDRES         YA01220 08740002
         O     PASSB,DCBEXLST          SAVE FIRST BYTE OF EXLST YA01220 08750002
         ST    PASSB,DCBEXLST          STORE EXLST ADDR IN DCB  YA01220 08760002
         ST    MCTABLE,XXFULL          PUT JFCB ADDRESS IN EXLSTYA01220 08770002
         MVI   XXFULL,LIST             INDICATE JFCB EXIT ONLY  YA01220 08780002
         L     PASSB,IEHMVV30+12       ADDRESS OF DDNAME        YA01220 08790002
         MVC   DCBDDNAM,0(PASSB)       PUT DDNAMEIN DCB         YA01220 08800002
         LR    R7,LINK                 SAVE REGISTER 15         YA01220 08810002
         OPEN  ((R3),INPUT),TYPE=J     OPEN THE VTOC            YA01220 08820002
         LR    LINK,R7                 RESTORE REGISTER 15      YA01220 08830002
         B     XXREAD                  GO TO READ THE VTOC      YA01220 08840002
         SPACE 1                                                YA01220 08850002
XXEODAD  EQU   *                       ROUTINE TO RESET EODAD   YA01220*08860002
                                       AND SYNAD ADDRESSES IN   YA01220*08870002
                                       DCB WHEN REENTRING MODULEYA01220 08880002
         SPACE 1                                                YA01220 08890002
         L     R3,IEHMVV82+8           LOAD DCB ADDRESS         YA01220 08900002
         LA    PASSB,XXEND             ADDRESS OF EODAD ROUTINE YA01220 08910002
         IC    PASSA,DCBEODAD          SAVE FIRST BYTE(DCBBFTEK)YA01220 08920002
         ST    PASSB,DCBEODAD          STORE EODAD ADDR IN DCB  YA01220 08930002
         STC   PASSA,DCBEODAD          RESET FIRST BYTE         YA01220 08940002
         LA    PASSB,XXERR             ADDRESS OF SYNAD ROUTINE YA01220 08950002
         IC    PASSA,DCBSYNAD          SAVE FIRST BYTE (DCBIOBL)YA01220 08960002
         ST    PASSB,DCBSYNAD          STORE SYNAD ADDR IN DCB  YA01220 08970002
         STC   PASSA,DCBSYNAD          RESET FIRST BYTE         YA01220 08980002
         DROP  R3                                               YA01220 08990002
         SPACE 1                                                YA01220 09000002
XXREAD   READ  XXDECB,SF,(R3),(R11),'S',MF=E  READ A DSCB       YA01220 09010002
         CHECK XXDECB                                                   09200000
         USING *,RETURN                                                 09220000
         L     LINK,XXBASEAD           RESET BASE REGISTER              09240000
         DROP  RETURN                                                   09260000
         TM    IEHMVV20+3,FVOLUME      IS THIS THE FIRST VOLUME ENTRY   09280000
         BO    XXLOOK41            NO ..... BRANCH                      09300018
         CLC   XXDSCB(44),XXJFCB       SEARCH FOR BEGINNING OF VTOC     09320018
         BNE   XXREAD                                                   09340018
         CLI   XXFORMAT,ZERO           IS THIS A FORMAT ZERO DSCB       09360018
         BNE   XXSETSW             NO ..... BRANCH                      09380018
         AR    PASSB,BASE              UP THE TTR 1 FOR COMPATIBILITY   09400018
         SRL   PASSB,8                 TTRZ BECOMES ZTTR                09420018
         ST    PASSB,XXCODE            SAVE TTR                         09440018
         MVI   XXJFCB,FOUR                                              09460018
         MVC   XXJFCB+1(43),XXJFCB     44 BYTES OF HEX '04' TO SEARCH   09480018
         B     XXREAD                  GO TO READ NEXT DSCB     YA01220 09500002
XXSETSW  OI    IEHMVV20+3,FVOLUME      SET FIRST ENTRY SWITCH TO 1=OFF  09520018
         B     XXREAD                                                   09540018
XXLOOK41 CLI   XXFORMAT,F1             IS THIS A FORMAT 1 DSCB          09560018
         BNE   XXREAD              NO ..... BRANCH                      09600000
         NOTE  (R3)                    GET TTR OF THIS DSCB     YA01220 09610002
         USING *,RETURN                                                 09640000
         ST    PASSB,IEHMVV82          SAVE TTR FOR CAT. LATER ONS21042 09650021
         L     LINK,XXBASEAD           RESET ADDRESSABILITY             09700000
         DROP  RETURN                                                   09720000
**********************************************************************  09730002
*                                                                    *  09740002
* IF THERE ARE IEHMVOVE UTILITY DATA SETS ON THE VOLUME, THEY ARE    *  09750002
* ARE NOT INCLUDED IN THE VOLUME MOVE/COPY.  UTILITY DATA SETS ARE   *  09760002
* SYSUT1, SYSUT2, AND SYSUT3.  IEHMOVE TRIES TO MAKE THE UTILITY DATA*  09762002
* SET DISTINCTIVE BY STARTING THE DATA SET NAME WITH '**'.  NOW THE  *  09764002
* USER CAN NAME VSAM DATA SET/SPACES STARTING WITH '**' SO FIRST A   *  09766002
* TEST MUST BE MADE FOR VSAM THEN A TEST FOR UTILITY DATA SETS.      *  09768002
* VSAM DATA SETS/SPACES WILL BE CAUGHT AS AN ERROR IN ANOTHER SECTION*  09768402
* OF IEHMVSSZ IN ORDER TO CENTRALIZE ERROR CHECKING.                 *  09768802
*                                                                    *  09769202
**********************************************************************  09769602
         TM    XXDSCB+83,VSAM          IS VSAM ORGANIZATION     YL026VC 09770002
         BO    XXNORM                  ERROR NOTICED LATER      YL026VC 09820002
         CLC   XXDSCB(2),XXASTER       IEHMOVE UTILITY DATA SET?YL026VC 09870002
         BE    XXREAD                  IGNORE UTILITY DATA SETS YL026VC 09880002
**********************************************************************  09882004
*                                                                       09882404
* LINES 098900-098960 WERE REACTIVATED IN SUPPORT              @Z40CSJH 09884004
* OF THE EXTENDED MVS CVOL FUNCTION                            @Z40CSJH 09886004
*                                                                       09886404
**********************************************************************  09888004
         CLC   XXDSCB(8),XXSYSCAT       IS THIS A SYSCTLG DATA SET      09890004
         BNE   XXNORM                                                   09892004
         OI    IEHMVV20+4,ONE          TURN ON SYSCATLG BIT             09894004
         B     XXREAD                   GO GET ANOTHER DSCB             09896004
XXNORM   MVI   XXCODE,EIGHT            POST NORMAL RETURN CODE          09900000
XXCLOSE  ST    R11,IEHMVV30+8          POST ADDRESS OF FROM DSCB        09920000
         LA    R11,148(R11)            INCREMENT PERMANENT WORK ADDRESS 09940000
         ST    R11,IEHMVV10            STORE IT                         09960000
         TM    IEHMVV20+3,FVOLUME  IS THIS FIRST VOLUME ENTRY    S21042 09970021
         BO    OVERCLOS      NO......BRANCH                      S21042 09972021
         OI    IEHMVV20+3,FVOLUME SET FIRST VOL ENTRY TO 1 (=OFF)S21042 09974021
         CLOSE ((R3))                  CLOSE VTOC                       09980000
         LA    PASSA,XXDCBL            LENGTH OF DCB            YA01220 10000002
         LR    PASSB,R3                ADDRESS OF DCB           YA01220 10020002
         FREEMAIN R,LV=(0),A=(1)       FREE DCB AREA            YA01220 10040002
OVERCLOS DS    0H     LABEL CARD ONLY                            S21042 10072021
         L     SAVE,XXREG13            ACCESS SAVE AREA                 10080000
         RETURN (14,12)            RETURN                               10100000
XXEND    MVI   XXCODE,FOUR             POST END OF FILE                 10120000
          BALR RETURN,0                                          S21042 10130021
         USING *,RETURN                                          S21042 10132021
         L     LINK,XXBASEAD            RESET ADDRESSABILITY     S21042 10134021
         DROP  RETURN                                            S21042 10136021
         TM    IEHMVV20+4,X'01'        SYSCATLG BIT ON?          S21042 10138021
         BZ    *+10                     NO, SKIP                 S21042 10138421
         XC    IEHMVV82(3),IEHMVV82 CLEAR TTR FIELD WHEN M/C CAT S21042 10138821
         B     OVERERR                                           S21042 10139221
XXERR    MVI   XXCODE,ZERO             POST  I/O ERROR                  10180000
         BALR  RETURN,0                                                 10200000
         USING *,RETURN                                                 10220000
         L     LINK,XXBASEAD           RESET ADDRESSABILITY             10240000
         DROP  RETURN                                                   10260000
OVERERR  NI    IEHMVV20+3,X'7F' SET FIRST VOLUME ENTRY TO 0 (=ON)S21042 10270021
         B     XXCLOSE                                                  10280000
XXASTER  DC    C'**'                    TO IDENTIFY WORK FILES          10300000
XXSYSCAT DC    CL8'SYSCTLG '            TO IDENTIFY THE CATALOG         10320000
TEMPNAME DC    C'VOLUME'                                                10340000
XXDCBSTT DS    0F                  LABEL THE START OF THE DCB           10360000
XXLEN1   DS    0H                      LABEL CARD ONLY                  10380000
         DCB   DSORG=PS,MACRF=(RP),RECFM=U,                            .10400000
               KEYLEN=44,BLKSIZE=96,                                   .10420000
               EODAD=XXEND,SYNAD=XXERR                                  10440000
XXLEN2   DS    0H                      LABEL CARD ONLY                  10460000
XXDCBL   EQU   XXLEN2-XXLEN1       LENGTH -1 OF THE DCB                 10480000
XXBASEAD DC    A(XRAYVTOC)                                              10500000
         SPACE 3                                                YA01220 10505002
         DCBD  DSORG=PS,DEVD=DA        MAP OF DCB               YA01220 10510002
         SPACE 3                                                YA01220 10515002
         IEHMVV                                                         10520000
         ORG   IEHMVV00                                                 10540000
XXJFCB   DS    25D            USED FOR BUILDING A JFCB                  10560000
         DS    F              NOT USED                                  10620000
XXREG13  DS    F                                                        10640000
XXSAVE   DS    20F            REGISTER SAVE AREA FOR READ               10660000
XXMEMBER EQU   XXJFCB+44      8 BYTE MEMBER NAME  -WILL BE BLANKS-      10680000
XX00     EQU   XXMEMBER+8     SPACE 139 BYTES = 0, 1 BYTE = 1           10700000
XXVOLID  EQU   XXJFCB+118     6 BYTE VOLUME ID FIELD                    10720000
XXFULL   DS    F              WORK AREA ON A FULL WORD                  10780000
XXDECB   DC    5F'0'                                                    10800000
MV61SV   DS    CL1                     SAVE MSG CODE            YM05783 10810002
         ORG                                                            10820000
XXDSCB   DS    11F            DATA SET NAME                             10840000
XXFORMAT DS    X              DSCB FORMAT ID                            10860000
         DS    95X            DSCB INFORMATION FIELDS                   10880000
XXCODE   DS    X              FOR POSTING RETURN STATUS                 10900000
         ORG                                                            10940000
         END   IEHMVESZ                                                 10960000
