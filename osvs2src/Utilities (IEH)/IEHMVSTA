*TITLE                                                                * 00050004
*   'IEHMVSTA-MOVE/COPY/LOAD/UNLOAD CATALOG'                          * 00100004
*FUNCTION/OPERATION                                                   * 00150004
*   THIS ROUTINE PUTS THE CATALOG OR PART OF THE CATALOG ON A         * 00200004
*   SPECIFIED DEVICE. IF MOVE IS SPECIFIED THE ORIGINAL CATALOG       * 00250004
*   ENTRIES ARE UNCATALOGED. IF UNLOAD IS SPECIFIED THE CATALOG       * 00300004
*   ENTRIES ARE WRITTEN ON THE OUTPUT DATA SET IN UNLOADED FORMAT.    * 00350004
*   IF LOAD IS INDICATED THE ENTRIES FROM THE INPUT DATA SET ARE      * 00400004
*   CATALOGED. NORMALLY CATALOG ENTRIES ARE TAKEN FROM THE ORIGINAL   * 00450004
*   CATALOG BY IEHMVSSC AND WRITTEN ON A WORK DATA SET WHICH IS READ  * 00500004
*   BY THIS ROUTINE. IF THE NECESSARY INDEX STRUCTURE DOES NOT EXIST  * 00550004
*   ON THE 'TO' VOLUME IT IS BUILT.                                   * 00600004
*ENTRY POINTS                                                         * 00650004
*   IEHMVETA-ONLY ENTRY POINT                                         * 00700004
*   CALLING SEQUENCE   L     14,12(0,13)                              * 00750004
*                      XCTL  (2,12),EP=IEHMVETA                       * 00800004
*INPUT                                                                * 00850004
*   WORK DATA SET CONSISTING OF RECORDS CONTAINING NAME AND VOLUME    * 00900004
*   INFORMATION OBTAINED BY IEHMVSSC FROM THE ORIGINAL ('FROM')       * 00950004
*   CATALOG.                                                          * 01000004
*OUTPUT                                                               * 01050004
*   ENTRIES IN THE 'TO' VOLUME CATALOG.                               * 01100004
*EXTERNAL ROUTINES                                                    * 01150004
*   IEHMVSRK  READS UNLOADED FORMAT DATA SETS.                        * 01200004
*   IEHMVSRM  WRITES UNLOADED FORMAT RECORDS                          * 01250004
*EXITS-NORMAL                                                         * 01300004
*   END OF INPUT - WRITE MESSAGE,FREEMAIN,TRANSFER CONTROL TO IEHMVEST* 01350004
*       IF MORE REQUESTS,TRANSFER CONTROL TO IEHMVESK IF NONE.        * 01400004
*      ERRORS                                                         * 01450004
*   I/O ERRORS, MACRO ERRORS - WRITE MESSAGE,INDICATE REQUEST NOT     * 01500004
*       COMPLETED,FREEMAIN,TRANSFER CONTROL TO IEHMVEST IF MORE       * 01550004
*       REQUESTS,TRANSFER CONTROL TO IEHMVESK IF NONE.                * 01600004
*TABLES/WORK AREAS                                                    * 01650004
*   TABLE OF MESSAGE TEXT.                                            * 01700004
*   TABLE OF MACRO CODES.                                             * 01750004
*   WORK AREA OF 900 BYTES.                                           * 01800004
*ATTRIBUTES                                                           * 01850004
*   REENTRANT,READ ONLY,REUSABLE.                                     * 01900004
*                                                                       01950004
*                                                                       02000004
***** REGISTER DESIGNATION *****                                        02050004
*                                                                       02100004
*                                                                       02150004
REG0     EQU   0                                                        02200004
REG1     EQU   1                                                        02250004
REG2     EQU   2                                                        02300004
REG3     EQU   3                                                        02350004
REG4     EQU   4                                                        02400004
REG5     EQU   5                                                        02450004
REG6     EQU   6                                                        02500004
REG7     EQU   7                                                        02550004
REG8     EQU   8                                                        02600004
REG9     EQU   9                                                        02650004
REG10    EQU   10                                                       02700004
REG11    EQU   11                                                       02750004
REG12    EQU   12                                                       02800004
REG13    EQU   13                                                       02850004
REG14    EQU   14                                                       02900004
REG15    EQU   15                                                       02950004
IEHMVSTA CSECT                                                          03000004
* 029120,032600,091600                                           A37886 03050004
*A019300,019320,034300,056040-056096,056420,067900-067960        A48776 03100004
*A096700,105700                                                  A48776 03150004
*C019000,034200,080600,084400                                    A48776 03200004
*                                                                A27719 03250004
* 091000,092000                                                  A29225 03300004
*033600,056200                                                   A23930 03350004
*2164                                                             21076 03400004
*  033750-033800,105200                                          S21042 03450004
*A032487,032489,033704-033719                                    A52004 03500004
*C032450,032486,032488,032490,032500                             A52004 03550004
*D032444-032448,032484                                           A52004 03600004
*A 052700                                                      @XA04148 03650004
*A 054230-054350,055660-055720,067946-067952                   @XA05827 03700004
*C 055200                                                      @XA05827 03750004
*                                                              @Z40CSJH 03760004
*      THE ENTIRE MODULE WAS REACTIVATED IN SUPPORT            @Z40CSJH 03770004
*      OF THE EXTENDED MVS CVOL FUNCTION                       @Z40CSJH 03780004
*                                                                       03790004
         EXTRN IEHMVERM                                                 03800004
         EXTRN IEHMVERK                                                 03850004
         ENTRY A                                                        03900004
         ENTRY B                                                        03950004
         ENTRY C                                                        04000004
         ENTRY D                                                        04050004
         ENTRY E                                                        04100004
         ENTRY F                                                        04150004
         ENTRY G                                                        04200004
         ENTRY H                                                        04250004
         ENTRY J                                                        04300004
         ENTRY  MYEOD                                                   04350004
         EXTRN TATBL1                                                   04400004
         EXTRN TAEODAD                                                  04450004
         EXTRN MSGTERM                                                  04500004
         EXTRN MSG300                                                   04550004
         EXTRN MSG301                                                   04600004
         ENTRY IEHMVETA                                                 04650004
IEHMVETA SAVE  (14,12),T,TA9/15                                         04700004
         IEHPRE ,TF                                                     04750004
         BALR  10,0                                                     04800004
         USING IEHMVV,REG12                                             04850004
         USING TADSECT,REG8                                             04900004
         USING *,REG10                                                  04950004
         TM    IEHMVV20,DSGROUP         IS THIS A DSGROUP FUNCTION      05000004
         BZ    TA00                    NO                               05050004
         L     REG2,IEHMVV41           DCB ADDR-SYSUT2                  05100004
         MVI   16(REG2),KEYLN           PUT KEY LENGTH IN DCB           05150004
         B     *+8                                                      05200004
TA00     L     REG2,IEHMVV40           DCB ADDR-SYSUT1                  05250004
         MVC   57(3,REG2),TASYNAD      PUT SYNAD IN DCB                 05300004
         MVC   33(3,REG2),MYEOD                                         05350004
         GETMAIN  R,LV=944              GET 900 BYTES OF WORK AREA      05400004
         LR    REG8,REG1               ADDR OF STORAGE ACQUIRED         05450004
         MVI   CATNAME,X'40'      BLANK DSNAME                   A48776 05500004
         MVC   CATNAME+1(43),CATNAME  SAVE AREA                  A48776 05550004
         POINT (2),TATTRK                                               05600004
*                                                                       05650004
*                                                                       05700004
***** INITIALIZE MACRO PARAMETER LISTS *****                            05750004
*                                                                       05800004
*                                                                       05850004
         MVI   TALST1,X'00'                                             05900004
         MVC   TALST1+1(47),TALST1     CLEAR PARAM LIST AREA            05950004
         MVI   TALST1,CATMAC            CODE FOR CATALOG MACRO          06000004
         MVI   TALST2,UNCATMAC          CODE FOR UNCATALOG              06050004
         TM    IEHMVV20+1,CVOL          WAS CVOL SPECIFIED              06100004
         BZ    TA02                    NO                               06150004
         OI    TALST2,CVOLIND           CVOL INDICATOR                  06200004
         L     REG2,IEHMVV24           ADDR OF CVOL ID                  06250004
         LA    REG2,4(0,REG2)          ADD 4                            06300004
         ST    REG2,TALST2+8           PUT IN UNCAT LIST                06350004
TA02     L     REG2,IEHMVV23           ADDR OF 'TO' VOL ID              06400004
         LA    REG2,4(0,REG2)          ADD 4                            06450004
         ST    REG2,TALST1+8           PUT IN CATALOG LIST              06500004
         ST    REG2,TALST3+8           PUT IN INDEX LIST                06550004
         LA    REG2,TAWRK+3            ADDR OF NAME                     06600004
         ST    REG2,TALST1+4           PUT IN CATALOG LIST              06650004
         ST    REG2,TALST2+4           PUT IN UNCAT LIST                06700004
         ST    REG2,TALST3+4           PUT IN INDEX LIST                06750004
         LA    REG2,TAWRK+47           ADDR OF VOLUME LIST              06800004
         ST    REG2,TALST1+12          PUT IN CATALOG LIST              06850004
*                                                                       06900004
*                                                                       06950004
***** GET A CATALOG ENTRY FROM WORK FILE *****                          07000004
*                                                                       07050004
*                                                                       07100004
TA04     TM    IEHMVV20+1,LOAD          IS THIS A LOAD SITUATION        07150004
         BO    TA03                    YES                              07200004
         TM    IEHMVV20,DSGROUP         IS THIS A DSGROUP FUNCTION      07250004
         BZ    TA04A                   NO                               07300004
         L     REG2,IEHMVV41           DCB ADDR-SYSUT2                  07350004
         L     REG3,IEHMVV41+4         DECB ADDR                        07400004
         B     TA04B                                                    07450004
TA04A    L     REG2,IEHMVV40           DCB ADDR-SYSUT1                  07500004
         L     REG3,IEHMVV40+4         DECB ADDR                        07550004
TA04B    LA    REG4,TAPRE              INPUT AREA ADDR                  07600004
         LA    REG2,0(0,REG2)          CLEAR                            07650004
         LA    REG3,0(0,REG3)          UPPER BYTES                      07700004
         LA    REG4,0(0,REG4)          OF REGISTERS                     07750004
         READ  (REG3),SF,(REG2),(REG4),'S',MF=E                         07800004
         LA    REG3,0(0,REG3)           CLEAR HIGH ORDER BYTE           07850004
         CHECK (REG3)                                                   07900004
         CLI   TAWRK+2,X'FF'           LAST RECORD                      07950004
         BE    TAEOD                   YES                              08000004
         TM    IEHMVV74+13,X'20'       IS VCB BIT ON?            A27719 08050004
         BO    TAREBLD1                                          A27719 08100004
         CLC   TAPRE+12(5),EXTEND      IS THIS SPEC VCB RECORD   A37886 08150004
         BE    TAREBLD                 GO BUILD VCB REC          A27719 08200004
*                                                                       08250004
*                                                                       08300004
***** DETERMINE TYPE OF ENTRY AND TAKE APPROPRIATE ACTION *****         08350004
*                                                                       08400004
*                                                                       08450004
TA11     CLI   TAWRK+2,VALIND           IS INDICATOR VALID              08500004
         BH    TA17                    NO                               08550004
         TM    IEHMVV20+1,UNLOAD        IS THIS AN UNLOAD SITUATION     08600004
         BO    TA06                    YES                              08650004
         TM    IEHMVV20+1,UNCATLG       UNCATALOG REQUEST (DSGROUP)     08700004
         BO    TA12                    YES                              08750004
TA11A    SR    REG1,REG1                                                08800004
         IC    REG1,TAWRK+2            INDICATOR FROM ENTRY             08850004
         L     REG3,TATBL2(REG1)       GET CODE FROM LIST               08900004
         ST    REG3,TALST3             PUT CODE IN INDEX PARAM LIST     08950004
         L     REG3,TATBL3(REG1)       GET ADDR FROM LIST               09000004
         BR    REG3                                                     09050004
*                                                                       09100004
*                                                                       09150004
*****  REBUILD LONG VCB RECORD  *****                                   09200004
*                                                                       09250004
*                                                                       09300004
TAREBLD  TM    IEHMVV20+1,UNLOAD       UNLOAD SITUATION?         A27719 09350004
         BO    TABLD1                  YES -                     A27719 09400004
         SR    REG2,REG2                                         A27719 09450004
         IC    REG2,TAWRK              PICK UP LENGTH            A27719 09500004
         SLL   REG2,8                  OF RECORD AND             A27719 09550004
         IC    REG2,TAWRK+1            ADD THE BASE OF 20.       A27719 09600004
         AH    REG2,TWENTY             GETMAIN FOR THAT          A27719 09650004
         LA    REG2,8(REG2)            ALLOW FOR REGISTER SAVE   A27719 09700004
         LA    REG2,240(REG2)          ADD SAFTY FACTOR          A27719 09750004
         LR    REG0,REG2               CORE FOR THE RECONSTRUCT  A27719 09800004
         GETMAIN  R,LV=(0)             RECORD                    A27719 09850004
         LR    REG9,REG1               REG9 WILL POINT TO MY AREAA27719 09900004
         LR    REG3,REG1               REG3 WILL VARY AS INFOR-  A27719 09950004
         ST    REG2,SAVCORE            SAVE THE LENGTH OF CORE   A27719 10000004
         LA    REG3,8(REG3)            INCREMENT PAST REG AREA   A27719 10050004
         MVC   0(46,REG3),TAWRK+3      MOVE DSNAME AND VCB COUNT A27719 10100004
         LA    REG3,46(REG3)           START OF VCB ENTRIES      A52004 10150004
         SR    REG2,REG2               CLEAR REG FOR VCB COUNT   A27719 10200004
         IC    REG2,TAVCBS             MATION IS ADDED TO RECORD A27719 10250004
         SLL   REG2,8                  PUT NUMBER OF VCBS IN     A27719 10300004
         IC    REG2,TAVCBS+1           REGISTER                  A27719 10350004
         STM   REG2,REG3,0(REG9)       SAVE THE REGS             A27719 10400004
TAREBLD1 LM    REG2,REG3,0(REG9)                                 A27719 10450004
         LA    REG5,TAINFO             INPUT VCB'S               A27719 10500004
         LA    REG1,2                  LOOP CONTROL              A27719 10550004
LOOPD    MVC   0(240,REG3),0(REG5)                               A27719 10600004
         LA    REG3,240(REG3)          INCREMENT R3 BY NO. MOVE  A27719 10650004
         LA    REG5,240(REG5)          INCREMENT R5 BY NO. MOVE  A27719 10700004
         SH    REG2,TWENTY             SUBTRACT VCBS MOVED       A27719 10750004
         BNP   TA11                    FINISHED LAST REC         A27719 10800004
         BCT   REG1,LOOPD                                        A27719 10850004
         STM   REG2,REG3,0(REG9)                                 A27719 10900004
         OI    IEHMVV74+13,X'20'       TURN OF VCB BIT           A27719 10950004
         B     TARERD                  YES-READ NEXT RECORD      A52004 11000004
CLRVCBS  LA    REG2,16            SET REG2 TO 16                 A52004 11050004
         SR    REG2,REG15         IS RETURN CODE CTLG 16         A52004 11100004
         BZ    BLDINDX            YES -BUILD INDEX FIRST         A52004 11150004
         NI    IEHMVV74+13,X'DF'       TURN OFF VCB BIT          A52004 11200004
         L     REG0,SAVCORE            LOAD LENGTH OF GETAREA    A27719 11250004
         ST    REG15,SAVCORE           SAVE RETURN FROM CATALOG  A27719 11300004
         FREEMAIN  R,LV=(0),A=(9)                                A27719 11350004
         L     REG15,SAVCORE           PICK UP RETURN CODE       A27719 11400004
BLDINDX  LA    REG2,TAWRK+3            ADDR OF NAME              A52004 11450004
         ST    REG2,TALST1+4           PUT IN CATALOG LIST       A27719 11500004
         LA    REG2,TAWRK+47           ADDR OF VOLUME LIST       A27719 11550004
         ST    REG2,TALST1+12          PUT IN CATALOG LIST       A27719 11600004
         B     TA16                                              A27719 11650004
TABLD1   MVI   TAWRK+47,X'EE'          VCB BUILD CODE            A27719 11700004
         MVC   TALNG(2),TAWRK          PUT TRUE LENGTH IN SAFTY  A27719 11750004
         MVI   TAWRK,X'02'             PUT LENGTH OF RECORD TO   A27719 11800004
         MVI   TAWRK+1,X'17'           UNLOAD IN PLACE           A27719 11850004
         CLI   IEHMVV74+13,X'05'       FIRST EXTEND BLOCK        A37886 11900004
         BE    *+12                    NO CONTINUE               A37886 11950004
         LA    REG9,46                 TO CHECK NUMBER OF        A37886 12000004
         MVI   IEHMVV74+13,X'05'       EXTEND BLOCKS PROCESSED   A37886 12050004
         B     TA06                    GO TO UNLOAD              A27719 12100004
TABLD2   MVI   TAWRK+47,X'00'          PUT ZEROS IN COUNT FIELD  A27719 12150004
         TM    IEHMVV74+13,X'20'       IS VCB BIT ON?            A27719 12200004
         BO    TAREBLD1                SKIP SETUP IF YES         A27719 12250004
         MVC   TAWRK(2),TALNG          SET UP TOTAL LENGTH       A27719 12300004
         B     TAREBLD                 GO BUILD LONG VCB RECORD  A27719 12350004
TARERD   TM    IEHMVV20+1,LOAD         IS THIS A LOAD SITUATION? A27719 12400004
         BO    TA03                    YES- READ FROM TAPE       A27719 12450004
         B     TA04A                   NO- READ FROM SYSUT1      A27719 12500004
*                                                                       12550004
***** CATALOG ENTRY ON 'TO' VOLUME *****                                12600004
*                                                                       12650004
*                                                                       12700004
TA11B    CLI   TAWRK+47,X'FF'          IS INDEX SWITCH ON        A23930 12750004
         BE    TA11E                   IF SO GO TO TURN          A23930 12800004
*                                      SWITCH OFF                A23930 12850004
         CLI   TAWRK+47,X'EE'          IS THIS A LOADED VCB?     A27719 12900004
         BE    TABLD2                  GO PREPARE RECORD         A27719 12950004
         CLI   TAWRK+48,X'00'          IS VOL COUNT = ZERO       A23930 13000004
         BE    TA11D                   IF SO GO TO TURN          A23930 13050004
*                                      INDEX SWITCH ON           A23930 13100004
         TM    IEHMVV74+13,X'20'       VCB BIT ON?               A52004 13150004
         BZ    TA11BA                  NO  -                     A52004 13200004
         LA    REG2,8(REG9)            INCREMENT PAST REG AREA   A52004 13250004
         ST    REG2,TALST1+4           ADDRESS OF NAME IN CTLG   A52004 13300004
         LA    REG2,44(REG2)           OBTAIN AND STORE ADDRESS  A52004 13350004
         ST    REG2,TALST1+12          OF VCB IN CATLG LIST      A52004 13400004
TA11BA   EQU   *                                                 A52004 13450004
         CLI   TAWRK+48,X'02'          HOW MUCH VOLS?            S21042 13500004
         BNL   NORMCAT                 MORE THAN 1,BRACH         S21042 13550004
         OI    TALST1+1,X'02'     1 VOL THEN TTRPOINTER BIT ON   S21042 13600004
         LA    REG1,TAPRE+12           PUT ADDRESS OF TTR IN REG1S21042 13650004
         ST    REG1,TALST1+16     STORE ADDRESS IN PARAMETERLIST S21042 13700004
NORMCAT  CATALOG TALST1                                          S21042 13750004
         NI    TALST1+1,X'FD'          SET OFF INDICATION OF TTR S21042 13800004
         TM    IEHMVV74+13,X'20'       VCB BIT ON?               A27719 13850004
         BO    CLRVCBS                 YES -                     A27719 13900004
         B     TA16                                                     13950004
TA11C    MVC   CATNAME(L'CATNAME),TAWRK+3  SAVE DSNAME           A48776 14000004
         TM    IEHMVV20+1,UNCATLG UNCATLG REQ                    A48776 14050004
         BO    TA04                    YES                              14100004
*                                                                       14150004
*                                                                       14200004
***** UNCATALOG ENTRY FROM CVOL IF MOVE SPECIFIED *****                 14250004
*                                                                       14300004
*                                                                       14350004
TA12     TM    IEHMVV20+1,LOAD          IS THIS A LOAD SITUATION        14400004
         BO    TA03                    YES                              14450004
         CLI   TAWRK+2,ZERO             DATA SET ENTRY                  14500004
         BNE   TA04                    NO                               14550004
         TM    IEHMVV20+1,UNCATLG       UNCATALOG REQUEST (DSGROUP)     14600004
         BO    *+12                    YES                              14650004
         TM    IEHMVV20,MOVE            MOVE CATALOG                    14700004
         BZ    TA04                    NO                               14750004
         LA    REG2,TALST2             ADDR OF UNCAT LIST               14800004
         CATALOG (2)                                                    14850004
         LTR   REG15,REG15             ENTRY UNCATALOGED                14900004
         BNE   TA16                    NO                               14950004
         TM    IEHMVV20,MOVE            MOVE REQUEST                    15000004
         BZ    TA11A                   NO-RECAT REQUEST                 15050004
         LA    REG15,124(0,0)          RETURN CODE                      15100004
         B     TA16                                                     15150004
*                                                                       15200004
*                                                                       15250004
***** INTERPRET RETURN CODE *****                                       15300004
*                                                                       15350004
*                                                                       15400004
TA16     CL    REG15,TAMXCD            CODE VALID                       15450004
         BH    TA17                    NO                               15500004
         SLL   REG15,1                 DOUBLE CODE                      15550004
         L     REG3,ADTATBL1            GET MESSAGE ADDRESS             15600004
         L     REG11,ATATBL1            GET RETURN ADDR FROM LIST       15650004
         L     REG3,0(REG3,REG15)                                       15700004
         L     REG11,0(REG11,REG15)                                     15750004
         L     REG11,0(REG11)                                           15800004
         LTR   REG3,REG3               PRINT MSG                        15850004
         BZ    0(0,REG11)              NO                               15900004
*                                                                       15950004
*                                                                       16000004
***** GENERATE MESSAGE *****                                            16050004
*                                                                       16100004
*                                                                       16150004
TAMSG    SR    REG5,REG5                                                16200004
         MVI   TAPRNT,X'00'             CLEAR MESSAGE AREA.             16250004
         MVC   TAPRNT+1(120),TAPRNT    MESSAGE AREA                     16300004
         LA    REG1,TAPRNT+1           ADDR OF MSG AREA                 16350004
         BAL   REG2,TAMSGB             GO TO MOVE SEGMENT               16400004
         L     REG2,ADTATBL1                                            16450004
         LA    REG15,0(REG2,REG15)                                      16500004
         TM    0(REG15),NAME                                            16550004
         BZ    TAMSGA                  NO                               16600004
         LR    REG6,REG3               SAVE MSG ADDR                    16650004
         BM    TAMSGX                  INDEX NAME REQUIRED              16700004
         L     REG3,MSG300AD           ADDR OF MSG SEGMENT              16750004
         B     *+8                                                      16800004
TAMSGX   L     REG3,MSG301AD           ADDR OF MSG SEGMENT              16850004
         BAL   REG2,TAMSGB             GO TO MOVE SEGMENT               16900004
         MVC   0(44,REG1),TAWRK+3      PUT NAME IN MSG                  16950004
         LA    REG1,45(0,REG1)         ADDR OF NEXT PART OF MSG         17000004
         IC    REG5,0(0,REG6)          LGTH OF PREVIOUS MSG SEGMENT     17050004
         LA    REG3,2(REG5,REG6)       ADDR OF NEXT MSG SEGMENT         17100004
         BAL   REG2,TAMSGB             GO TO MOVE SEGMENT               17150004
TAMSGA   LA    REG3,TAPRNT             ADDR OF MSG OUTPUT AREA          17200004
         LINK  EP=IEHMVESU             GO TO MSG WRITER                 17250004
         LTR   REG15,REG15             MESSAGE WRITTEN                  17300004
         BNE   TA31                    NO                               17350004
         BR    REG11                                                    17400004
TAMSGB   IC    REG5,0(0,REG3)          LENGTH OF MSG SEGMENT            17450004
         EX    REG5,TAMVM1             PUT SEGMENT IN MSG AREA          17500004
         LA    REG1,2(REG5,REG1)       ADDR OF NEXT PART OF MSG AREA    17550004
         BR    REG2                    RETURN                           17600004
*                                                                       17650004
*                                                                       17700004
***** REQUEST NOT COMPLETELY SERVICED *****                             17750004
*                                                                       17800004
*                                                                       17850004
TA17     OI    IEHMVV32,X'04'          RETURN CODE TO WRAP-UP RTN       17900004
*                                                                       17950004
*                                                                       18000004
***** END OF   DATA EXIT FOR WORK FILE *****                            18050004
*                                                                       18100004
*                                                                       18150004
TAEOD    LA    REG15,68(0,0)           RETURN CODE                      18200004
         L     REG2,IEHMVV41           ADDR OF SYSUT2 DCB               18250004
         MVI   16(REG2),KEY             RESTORE KEY LGTH IN DCB         18300004
         TM    IEHMVV20,DSGROUP                                  A34094 18350004
         BO    TA30D                                             A34094 18400004
         B     TA16                                                     18450004
*                                                                       18500004
*                                                                       18550004
***** SYNCHRONOUS I/O ERROR EXIT FOR WORK FILE *****                    18600004
*                                                                       18650004
*                                                                       18700004
TASYN    LA    REG15,84(0,0)           RETURN CODE                      18750004
         OI    IEHMVV41+13,X'04'       RET CODE EQUAL 12       @XA04148 18800004
         B     TA16                                                     18850004
*                                                                       18900004
*                                                                       18950004
***** WHEN INDEX STRUCTURE INCOMPLETE BUILD NECESSARY INDEXES *****     19000004
*                                                                       19050004
*                                                                       19100004
TA21     LA    REG4,TAWRK+3            ADDR OF FULLY QUALIFIED NAME     19150004
TA22     LA    REG4,1(0,REG4)          ADD 1                            19200004
         CLI   TAWRK+2,GDG             GDG ENTRY ?             @XA05827 19250004
         BE    TA22C                   YES....BRANCH           @XA05827 19300004
         LA    REG15,TAWRK+47          MASK FOR NAME=44 BYTES  @XA05827 19350004
TA22A    CR    REG4,REG15              NAME 44 OR 35 BYTES ?   @XA05827 19400004
         BNL   TA22B                   YES....BRANCH           @XA05827 19450004
         CLI   0(REG4),PERIOD           IS THIS BYTE A PERIOD           19500004
         BE    TA23                    YES                              19550004
         CLI   0(REG4),BLANK            IS THIS BYTE A BLANK            19600004
         BNE   TA22                    NO                               19650004
TA22B    CLI   TAWRK+2,GDG              GDG INDEX              @XA05827 19700004
         BE    TA25D                   YES                              19750004
         B     TA11B                                                    19800004
TA22C    LA    REG15,TAWRK+38          MASK FOR NAME=35 BYTES  @XA05827 19850004
         B     TA22A                   BRANCH TO TEST          @XA05827 19900004
*                                                                       19950004
TA23     MVI   0(REG4),BLANK            BLANK OUT PERIOD                20000004
         LA    REG15,TAWRK+4      COMPUTE LENGTH OF NAME         A48776 20050004
         LR    REG5,REG4          SAVE VALUE                     A48776 20100004
         SR    REG5,REG15         LENGTH FOR EXECUTE             A48776 20150004
         EX    REG5,CLC1          COMPARE NAMES                  A48776 20200004
***CLC1  CLC   CATNAME(1),TAWRK+3 COMMENT ONLY                   A48776 20250004
         BNE   TA23A              *B IF NOT EQUAL                A48776 20300004
         SR    REG15,REG15        SIMULATE RC OF INDEX=0         A48776 20350004
         B     AFTINDEX           BYPASS SVC 26                  A48776 20400004
TA23A    LA    REG2,TALST3             ADDR OF INDEX             A23930 20450004
*                                      MACRO PARAM LIST          A23930 20500004
         INDEX (2)                                                      20550004
AFTINDEX EQU   *                                                 A48776 20600004
         CLI   TAWRK+47,X'AA'          IS LOW LEVEL SWITCH ON    A23930 20650004
         BE    TA04                    GO TO GET ANOTHER         A23930 20700004
*                                      ENTRY FROM WORK FILE      A23930 20750004
         MVI   0(REG4),PERIOD           RESTORE PERIOD IN NAME          20800004
         LA    REG15,32(0,REG15)       ADD 32 TO RETURN CODE            20850004
         B     TA16                    GO TO TEST RETURN CODE           20900004
TA11D    MVI   TAWRK+47,X'FF'          TURN INDEX SW ON          A23930 20950004
         B     TA21                    BLDX FOR INCOMPLETE       A23930 21000004
*                                      STRUCTURE                 A23930 21050004
TA11E    MVI   TAWRK+47,X'AA'          TURN LOW LEVEL SW ON      A23930 21100004
         B     TA23A                   BLDX FOR LOW LEVEL        A23930 21150004
*                                                                       21200004
*                                                                       21250004
***** BUILD ALIAS CATALOG ENTRY OR CVOL CATALOG ENTRY *****             21300004
*                                                                       21350004
*                                                                       21400004
*                                                                       21450004
TA24B    MVI   TALST3,CHANGE            CHANGE INDEX                    21500004
         MVI   TALST3+1,MACODE          MACRO CODE                      21550004
TA24     LA    REG2,TAWRK+12       POINT TO ALIAS NAME             7622 21600004
         ST    REG2,TALST3+12          PUT IN INDEX MACRO LIST          21650004
         B     TA27                    GO TO ISSUE INDEX MACRO          21700004
*                                                                       21750004
*                                                                       21800004
***** BUILD GENERATION INDEX AND PUT MODEL DSCB ON 'TO' VOLUME *****    21850004
*                                                                       21900004
*                                                                       21950004
TA25     MVC   TALST3+3(1),TAWRK+39    PUT MAX NO OF GEN IN PARAM LIST  22000004
         TM    TAWRK+38,EMPTY           OPTION = EMPTY                  22050004
*                                                                       22100004
         BZ    TA25A                   NO                               22150004
         OI    TALST3+2,EMTCODE         PUT EMPTY CODE IN PARAM LIST    22200004
TA25A    TM    TAWRK+38,DELETE          OPTION = DELETE                 22250004
         BZ    TA25C                   NO                               22300004
         OI    TALST3+2,DELCODE         PUT DELETE CODE IN PARAM LIST   22350004
TA25C    CLI   TAWRK+40,X'BB'  IS THIS A GDG WITH NO DSCB         21076 22400004
         BE    TA21          YES                                  21076 22450004
         MVI   TAWRK+38,BLANK  PUT BLANKS                         21076 22500004
         MVC   TAWRK+39(7),TAWRK+38    ON END OF NAME                   22550004
         MVI   TAWRK+62,ZERO            NO OF EXTENTS                   22600004
         MVI   TAWRK+101,ZERO           SET                             22650004
         MVC   TAWRK+102(41),TAWRK+101 ALLOCATION QTY                   22700004
         GETMAIN  R,LV=140                                              22750004
         LR    REG7,REG1                                                22800004
         MVC   0(43,REG7),TAWRK+3                                       22850004
         MVI   43(REG7),X'40'                                           22900004
         MVI   44(REG7),X'F1'                                           22950004
       MVC   51(89,REG7),TAWRK+47                                       23000004
         L     REG1,IEHMVV31+8                                          23050004
         LH    REG1,14(0,REG1)                                          23100004
         MVC   45(6,REG7),28(REG1)                                      23150004
         L     REG1,IEHMVV31+8         ADDR IN TIOT                     23200004
         LA    REG1,12(0,REG1)                                          23250004
         LR    REG0,REG7                                                23300004
         O     REG0,TAMSK1                                              23350004
         SVC   32                                                       23400004
         LR    REG1,REG7                                                23450004
         LR    REG7,REG15                                               23500004
         FREEMAIN  R,LV=140,A=(1)                                       23550004
         LA    REG15,4            PREPARE FOR TEST TO SEE IF.....  7130 23600004
         CR    REG7,REG15         MODEL DSCB IS ON TO VOLUME ?     7130 23650004
         BNH   TA21               YES, TA21 .... NO, DROP THROUGH  7130 23700004
         LA    REG15,116               RETURN CODE                      23750004
         B     TA16                                                     23800004
TA25D    MVI   TALST3+1,INDMAC          CHANGE INDEX MACRO CODE         23850004
*                                                                       23900004
*                                                                       23950004
         MVC   CATNAME(35),TAWRK+3 SAVE GDG NAME                 A48776 24000004
         MVI   CATNAME+35,X'40'   BLANK REST OF SAVE AREA        A48776 24050004
         MVC   CATNAME+36(8),CATNAME+35                          A48776 24100004
         MVI   TAWRK+38,X'40'          BLANK GDG INFORMATION   @XA05827 24150004
         MVC   TAWRK+39(8),TAWRK+38                            @XA05827 24200004
*                                                                A48776 24250004
         B     TA27                                                     24300004
***** DETERMINE TYPE OF INDEX BUILT AND TAKE APPROPRIATE ACTION *****   24350004
*                                                                       24400004
*                                                                       24450004
TA26     CLI   TALST3+1,NORINDX         NORMAL INDEX                    24500004
         BNE   TA04                    NO                               24550004
         CLI   TAWRK+2,RNALIAS          REAL NAME FOR ALIAS             24600004
         BE    TA24B                   YES                              24650004
         B     TA22                                                     24700004
*                                                                       24750004
*                                                                       24800004
***** USE INDEX MACRO TO CONSTRUCT DESIRED INDEX *****                  24850004
*                                                                       24900004
*                                                                       24950004
TA27     LA    REG2,TALST3             ADDR OF PARAM LIST               25000004
         INDEX (2)                                                      25050004
         CLI   TAWRK+2,RNALIAS         IS THIS AN ALIAS?         A27719 25100004
         BE    TA27B                   YES - BRANCH              A27719 25150004
         CLI   TALST3+1,NORINDX         NORMAL INDEX                    25200004
         BE    TA27A                   YES                              25250004
         CLI   TAWRK+2,CVOLENT          CVOL ENTRY                      25300004
         BH    TA27B                   NO-GDG ENTRY                     25350004
         BE    TA27A                   YES                              25400004
         MVC   TAWRK+3(8),TAWRK+48     PUT ALIAS IN PLACE OF REAL NAME  25450004
TA27A    MVI   TAWRK+11,BLANK           BLANK OUT                       25500004
         MVC   TAWRK+12(35),TAWRK+11   REST OF NAME AREA                25550004
TA27B    LA    REG15,32(0,REG15)       ADD 32 TO RETURN CODE            25600004
         B     TA16                    GO TO TEST RETURN CODE           25650004
*                                                                       25700004
*                                                                       25750004
***** PROCEDURE WHEN CATALOG STRUCTURE INCONSISTENT AFTER CATALOG ***** 25800004
***** MACRO HAS BEEN ISSUED                                             25850004
*                                                                       25900004
*                                                                       25950004
TA28     LA    REG15,88(0,REG1)        PUT ADJUSTED CODE IN  REG 15     26000004
         B     TA16                                                     26050004
*                                                                       26100004
*                                                                       26150004
***** PROCEDURE WHEN CATALOG STRUCTURE INCONSISTENT AFTER INDEX *****   26200004
***** MACRO HAS BEEN ISSUED                                             26250004
*                                                                       26300004
*                                                                       26350004
TA29     CH    REG1,TAK12              INDEX BLOCK FOUND BY LOCATE MACR 26400004
         BZ    TA26                    YES                              26450004
         LA    REG15,88(0,REG1)        PUT ADJUSTED CODE IN REG 15      26500004
         B     TA16                                                     26550004
*                                                                       26600004
*                                                                       26650004
***** PROCEDURE FOR I/O ERROR IN SYSOUT *****                           26700004
*                                                                       26750004
*                                                                       26800004
TA31     OI    IEHMVV32,WRAPCODE        RETURN CODE TO WRAP-UP ROUTINE  26850004
*                                                                       26900004
*                                                                       26950004
***** PROCEDURE FOR ENDING FUNCTION *****                               27000004
*                                                                       27050004
*                                                                       27100004
TA30     TM    IEHMVV20+1,UNLOAD        IS UNLOAD SPECIFIED             27150004
         BZ    TA30A                   NO                               27200004
         LR    REG0,REG10              INDICATE END OF DATA SET         27250004
         L     REG15,TABWRT            ADDR OF WRITER                   27300004
         BALR  REG14,REG15                                              27350004
         L     REG5,IEHMVV31      TO DCB ADDR                           27400004
* THIS ROUTINE SAVES THE VOL SER NBR AND FILE SEQ NBR OF IEHMVESN       27450004
         TM    48(REG5),X'10'          DCB OPEN                  A43752 27500004
         BNO   SKIPSAVE                NO SKIP THE SAVE RTN      A43752 27550004
         L     REG4,44(REG5)           DEB ADDRESS               A43752 27600004
         SR    REG2,REG2               CLEAR FOR INSERT          A43752 27650004
         IC    REG2,16(REG4)           NBR OF EXTENTS            A43752 27700004
         TM    28(REG4),X'04'          DA DEVICE                 A43752 27750004
         BO    OFFS16                  YES FIND LAST EXTENT      A43752 27800004
         LA    REG4,28(REG4)           SCAN THE EXTENTS          A43752 27850004
NEXTEXT1 LA    REG4,4(REG4)            JUMP TO NEXT EXTENT       A43752 27900004
         BCT   REG2,NEXTEXT1           SCAN FURTHER              A43752 27950004
         B     SAVEUCB                 STORE UCB ADDR            A43752 28000004
OFFS16   DS    0H                                                A43752 28050004
         LA    REG4,16(REG4)                                     A43752 28100004
NEXTEXT2 LA    REG4,16(REG4)           JUMP TO NEXT EXTENT       A43752 28150004
         BCT   REG2,NEXTEXT2           SCAN FURTHER              A43752 28200004
SAVEUCB  L     REG4,0(REG4)            GET UCB ADDR              A43752 28250004
         MVC   IEHMVV82+24(2),38(REG4) SAVE LOG FILE SEQ NBR     A43752 28300004
         MVC   IEHMVV82+26(6),28(REG4) SAVE THE VOL SER NBR      A43752 28350004
         OI    IEHMVV82+24,X'80'       SET SWITCH TO IND         A43752 28400004
SKIPSAVE DS    0H                                                A43752 28450004
         CLOSE   ((REG5))                                               28500004
         IEHPOST ,T                                                     28550004
         FREEMAIN R,LV=944,A=(8)                                 A48776 28600004
         L     REG14,12(0,REG13)       RESTORE REG 14                   28650004
         XCTL  (2,12),EP=IEHMVESN                                       28700004
TA30A    TM    IEHMVV20+1,LOAD          IS LOAD SPECIFIED               28750004
         BZ    TA30C                   NO                               28800004
         L     REG5,IEHMVV30           ADDR OF FROM DCB                 28850004
         CLOSE ((5))                                                    28900004
TA30C    TM    IEHMVV32,REQABORT        REQUEST ABORTED                 28950004
         BO    TA30D                   YES                              29000004
         L     REG3,MSGTRMAD           ADDR OF MESSAGE                  29050004
         MVI   TAPRNT,X'00'             CLEAR PRINT AREA                29100004
         MVC   TAPRNT+1(120),TAPRNT    MESSAGE AREA                     29150004
         SR    REG5,REG5                                                29200004
         LA    REG1,TAPRNT+1           ADDR OF MSG AREA                 29250004
         BAL   REG2,TAMSGB             GO TO MOVE MSG                   29300004
         L     REG2,IEHMVV23           ADDR OF TO VOL ID                29350004
         MVC   0(6,REG1),4(REG2)       PUT VOL ID IN MSG                29400004
         BAL   REG11,TAMSGA                                             29450004
TA30D    IEHPOST ,T                                                     29500004
         FREEMAIN R,LV=944,A=(8)                                 A48776 29550004
         L     REG14,12(0,REG13)     RESTORE REG 14                     29600004
         TM    IEHMVV32,SYSERR          SYSOUT ERROR                    29650004
         BO    TA30B                   YES                              29700004
         TM    IEHMVV20+2,EOI           ANY OTHR REQUESTS--END OF INPUT 29750004
         BO    TA30B                   NO                               29800004
         XCTL  (2,12),EP=IEHMVEST                                       29850004
TA30B    XCTL  (2,12),EP=IEHMVESK                                       29900004
*                                                                       29950004
*                                                                       30000004
***** PROCEDURE FOR LOAD SITUATION *****                                30050004
*                                                                       30100004
*                                                                       30150004
TA03     SR    REG0,REG0                                                30200004
         LA    REG1,TAWRK              ADDR OF INPUT AREA               30250004
         L     REG15,TABRD             ADDR OF RTN WHICH READS          30300004
*                                        UNLOADED CATALOG               30350004
         BALR  REG14,REG15             GO TO GET CATALOG ENTRY          30400004
         LTR   REG15,REG15             ENTRY FOUND                      30450004
         BZ    TA11                    YES                              30500004
         LA    REG15,68(0,REG15)       ADD 68 TO RETURN CODE            30550004
         B     TA16                    GO TO TEST RETURN CODE           30600004
*                                                                       30650004
*                                                                       30700004
***** PROCEDURE FOR UNLOAD SITUATION *****                              30750004
*                                                                       30800004
*                                                                       30850004
TA06     SR    REG0,REG0                                                30900004
         LA    REG1,TAWRK              ADDR OF OUTPUT AREA              30950004
         L     REG15,TABWRT            ADDR OF RTN TO WRITE             31000004
*                                       UNLOADED CATALOG                31050004
         BALR  REG14,REG15             GO TO WRITE ENTRY                31100004
         LTR   REG15,REG15             ENTRY WRITTEN                    31150004
         BNE   TA06A                   NO                        A29225 31200004
         TM    TAWRK+2,DSENT            DATA SET ENTRY                  31250004
         BM    TA12                    NO                               31300004
         CLI   TAWRK+48,X'00'          IS THIS AN INDEX ENTRY    A23930 31350004
*                                      WITHOUT DATA SET          A23930 31400004
         BE    TA04                    YES-DO NOT WRITE MESSAGE  A23930 31450004
*                                      GO TO GET ANOTHER ENTRY   A23930 31500004
         CLI   IEHMVV74+13,X'05'       EXTENDED VCBS             A37886 31550004
         BNE   WRTMSG                  NO CONTINUE               A37886 31600004
         LA    REG9,480(REG9)          YES  UPDATE EXT LENGTHCT  A37886 31650004
         CH    REG9,TALNG              LAST BLOCK PROCESSED      A37886 31700004
         BL    TA12                    NO READ NEXT              A37886 31750004
         MVI   IEHMVV74+13,X'00'       YES  TURN OFF INDIC       A37886 31800004
WRTMSG   LA    REG15,120(0,0)          RETURN CODE               A37886 31850004
         B     TA16                                                     31900004
TA06A    LA    REG15,60(0,REG15)       ADD 60 TO RETURN CODE     A29225 31950004
         B     TA16                    GO TO TEST RETURN CODE           32000004
*                                                                       32050004
*                                                                       32100004
***** CONSTANTS *****                                                   32150004
*                                                                       32200004
*                                                                       32250004
TAMXCD   DC    F'124'                                                   32300004
TAMSK1   DC    X'80000000'                                              32350004
TAK12    DC    H'12'                                                    32400004
TAK8     DC    H'8'                                                     32450004
TATTRK   DC    A(256)                                                   32500004
EXTEND   DC    CL5'XVCBS'                                        A27719 32550004
TWENTY   DC    H'20'                                             A27719 32600004
SAVCORE  DS    1F                                                A27719 32650004
*                                                                       32700004
*                                                                       32750004
***** ADDRESS CONSTANTS *****                                           32800004
*                                                                       32850004
*                                                                       32900004
TASYNAD  DC    AL3(TASYN)                                               32950004
TABWRT   DC    A(IEHMVERM)                                              33000004
TABRD    DC    A(IEHMVERK)                                              33050004
*                                                                       33100004
*                                                                       33150004
***** INSTRUCTIONS PERFORMED THRU EXECUTE *****                         33200004
*                                                                       33250004
CLC1     CLC   CATNAME(1),TAWRK+3                                A48776 33300004
*                                                                       33350004
TAMVM1   MVC   0(1,REG1),1(REG3)       MOVE MSG TEXT TO MSG AREA        33400004
A        DC    A(TA11C)                                                 33450004
B        DC    A(TA28)                                                  33500004
C        DC    A(TA21)                                                  33550004
D        DC    A(TA26)                                                  33600004
E        DC    A(TA29)                                                  33650004
F        DC    A(TA30)                                                  33700004
G        DC    A(TA04)                                                  33750004
H        DC    A(TA17)                                                  33800004
J        DC    A(TA12)                                                  33850004
MYEOD    DC    A(TAEOD)                                                 33900004
ADTATBL1 DC    A(TATBL1)                                                33950004
ATATBL1  DC    A(TATBL1+4)                                              34000004
ATAEODAD DC    A(TAEODAD)                                               34050004
MSGTRMAD DC    A(MSGTERM)              CATALOG MOVED/COPIED             34100004
MSG300AD DC    A(MSG300)                                                34150004
MSG301AD DC    A(MSG301)                                                34200004
*                                                                       34250004
*                                                                       34300004
***** TABLE OF CODES FOR INDEX MACRO *****                              34350004
*                                                                       34400004
*                                                                       34450004
TATBL2   DS    0F                                                       34500004
         DC    X'84400000'             BLDX                             34550004
         DC    X'84400000'             BLDA                             34600004
         DC    X'C4080000'             LINKX                            34650004
         DC    X'84400000'             BLDG (HIGHER INDEX LEVELS)       34700004
***** TABLE OF ROUTINE ADDRESSES FOR DIFFERENT TYPES OF ENTRIES *****   34750004
TATBL3   DS    0F                                                       34800004
         DC    A(TA11B)                DATA SET                         34850004
         DC    A(TA27)             ALIAS                           7622 34900004
         DC    A(TA24)                 CVOL                             34950004
         DC    A(TA25)                 GDG INDEX                        35000004
*                                                                       35050004
*                                                                       35100004
***** DEFINE WORK STORAGE *****                                         35150004
*                                                                       35200004
*                                                                       35250004
TADSECT  DSECT                                                          35300004
TAPRNT   DS    121C                                                     35350004
TAST1    DS    F                                                        35400004
TALST1   DS    5F                                                S21042 35450004
TALST2   DS    4F                                                       35500004
TALST3   DS    4F                                                       35550004
CATNAME  DS    CL44               SAVE DS- & GDG NAMES           A48776 35600004
TAPRE    DS    17C                                                      35650004
TAWRK    DS    C                                                        35700004
*                                                                       35750004
*                                                                       35800004
***** E Q U A T E S  *****                                              35850004
*                                                                       35900004
*                                                                       35950004
DSGROUP  EQU   X'10'                                                    36000004
KEYLN    EQU   X'0C'                                                    36050004
BLANK    EQU   C' '                                                     36100004
CATMAC   EQU   X'E4'                                                    36150004
UNCATMAC EQU   X'0C'                                                    36200004
CVOL     EQU   X'40'                                                    36250004
CVOLIND  EQU   X'80'                                                    36300004
LOAD     EQU   X'02'                                                    36350004
VALIND   EQU   X'0C'                                                    36400004
UNLOAD   EQU   X'01'                                                    36450004
UNCATLG  EQU   X'20'                                                    36500004
MOVE     EQU   X'80'                                                    36550004
NAME     EQU   X'FF'                                                    36600004
KEY      EQU   X'08'                                                    36650004
PERIOD   EQU   C'.'                                                     36700004
GDG      EQU   X'0C'                                                    36750004
CHANGE   EQU   X'C4'                                                    36800004
MACODE   EQU   X'10'                                                    36850004
EMPTY    EQU   X'01'                                                    36900004
EMTCODE  EQU   X'08'                                                    36950004
DELETE   EQU   X'02'                                                    37000004
DELCODE  EQU   X'40'                                                    37050004
ZERO     EQU   X'00'                                                    37100004
INDMAC   EQU   X'20'                                                    37150004
NORINDX  EQU   X'40'                                                    37200004
RNALIAS  EQU   X'04'                                                    37250004
CVOLENT  EQU   X'08'                                                    37300004
WRAPCODE EQU   X'08'                                                    37350004
REQABORT EQU   X'04'                                                    37400004
SYSERR   EQU   X'08'                                                    37450004
EOI      EQU   X'20'                                                    37500004
DSENT    EQU   X'FF'                                                    37550004
TAVCBS   EQU   TAWRK+47                                          A27719 37600004
TAINFO   EQU   TAWRK+49                                          A27719 37650004
TALNG    EQU   TAWRK+529                                         A27719 37700004
         IEHMVV                                                         37750004
         END                                                            37800004
