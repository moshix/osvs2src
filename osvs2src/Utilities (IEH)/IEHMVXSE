*TITLE ' IEHMVSSE                                                     * 00020000
*                                                                       00040000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 00060000
*   THIS MODULE WILL GET AND INITIALIZE A WORKING STORAGE AREA        * 00080000
*FOR THE USE OF ALL THE MODULES OF THE IEHMOVE PROGRAM.               * 00100000
*   THE WORKING STORAGE WILL BE POINTED TO BY REGISTER 12             * 00120000
*THROUGHOUT THE COURSE OF THE PROGRAM.                                * 00140000
*   THE WORKING STORAGE IS DEFINED BY THE DSECT,IEHMVV.               * 00160000
*   THE PARAMETER LIST PASSED IN REGISTER 1 BY THE INVOKING           * 00180000
*PROGRAM WILL BE ACTED UPON IN THIS MODULE.                           * 00200000
*   CONTROL WILL BE PASSED TO BOTH THE VOLUME MOUNTING ROUT-          * 00220000
*INE AND THE MESSAGE WRITER FOR INITIALING PURPOSES.                  * 00240000
*   THREE WORK FILES ASSOCIATED WITH THE SYSUT1 DD CARD WILL          * 00260000
*BE ALLOCATED INTERNALLY BY THIS MODULE.                              * 00280000
*   THEY WILL BE OPENED IN THIS MODULE AND WILL REMAIN                * 00300000
*OPEN FOR THE DURATION OF THE IEHMOVE PROGRAM.                        * 00320000
*    THIS MODULE WILL PASS CONTROL VIA XCTL TO MODULE                 * 00340000
*IEHMVSST AND IT WILL NOT BE ENTERED AGAIN DURING THE COURSE          * 00360000
*OF THIS PROGRAM.                                                     * 00380000
*********************************************************************** 00400000
*                                                                       00420000
*ENTRY POINTS: 1. IEHMVXSE (IEHMVSSD LINKS TO THIS E.P.)              * 00440000
*2. IEHMVESE (ALL ENTRYES EXCEPT IEHMVSSD USE THIS ENTRY POINT)       * 00460000
*INPUT: POINTER TO IEHMDVE1 WORKAREA IN REG 12 - EXCEPT ENTRY TO      * 00480000
*IEHMVXSE                                                             * 00500000
*OUTPUT: REGISTER 12 POINTS TO IEHMOVE1 COMM AREA (COMM AREA IS       * 00520000
*DESCRIBED BY DSECT IEHMVV IN THIS LISTING)                           * 00540000
*EXTERNAL ROUTINES: IEHMVXSF (VOLUME MOUNTING ROUTINE)                * 00560000
*IEHMVSSA (MSG. WRITER ROUTINE)                                       * 00580000
*EXITS - NORMAL IEHMVSST (CONTROL CARD ANALIZER RIN.)                 * 00600000
*TABLES/WORK AREAS: WORK AREA DSECT IEHMVV IS USED THROUGH OUT THE    * 00620000
*IEHMOVE1 PROGRAM AS A WORK AREA AND COMMUNICATIONS AREA. A POINTER TO* 00640000
*THIS WORK AREA IS MAINTAINED IN REGISTER 12.                         * 00660000
IEHMVSSE CSECT                                                          00662002
*A104810-104950,121260-121320                                  @ZA07393 00662104
*C017000                                                       @ZA07393 00662204
*C017000,091000                                                @ZA07392 00662504
*A138100,139300,140500                                         @ZA07360 00663004
*C017000                                                       @ZA07360 00664004
*C106500                                                       @ZA03372 00665003
*A044150-044234                                                @ZA01726 00668003
*D044150-044250                                                @ZA01726 00671003
*C124200,127800                                                @ZM33040 00674003
         TITLE 'IEHMVXSE-IEHMOVE WORK AREA SETUP, PARAM ANLYZR'         00677003
*A105000-116400,022200,122850,137000,138200,139400             @ZA00101 00680003
*D105000-117000,122200-122600,130200-132000,137000-137600      @ZA00101 00680403
*D138200-138800,139400-140000                                  @ZA00101 00680803
*C093600                                                       @ZM30153 00682003
*A082000-082150                                                @ZA01246 00683002
*A093700,155408                                                @ZM30153 00684003
*D082000                                                       @ZA01246 00686002
*A052680-052840,122900                                          YA01194 00690016
*D072600,072800,073400,073600                                    A48763 00700122
*A073700-073933,155404                                           A48763 00700222
*C154800                                                         A48763 00700322
*C155000                                                         A44310 00700421
* 093200                                                         A38756 00701021
* 107200,108600,111000,112400,115400,116800,166000               A37897 00702021
* 104060-104120                                                  S20201 00703100
*                                                                A30471 00707000
* 018600,027400,082000                                             I276 00710000
* 081520,082000,083200,083400                                    A24913 00713000
* 123600                                                         A23994 00716000
* 118800-119200                                                  S21042 00718021
*0313-127400                                                       9754 00719000
*0313083600,084800,157680-157800,159400-159600                     BS0H 00722000
*0313042600,042800,043000,043600,044200,053400,053600-054600       7356 00725000
*03130085000-085200                                                7356 00728000
* 066000,066400,066600,066800                                    A21460 00731000
*0313                                                           PTM663  00734000
*113000                                                          A37871 00734220
*                             REGISTER NOTATION AND USAGE               00737000
R0       EQU   0                                                        00740000
DEV0     EQU   0                                                        00760000
DEV1     EQU   1                                                        00780000
R1       EQU   1                                                        00800000
R2       EQU   2                                                        00820000
ECR2     EQU   2                                                        00840000
DEV2     EQU   2                                                        00860000
R3       EQU   3                                                        00880000
ECR3     EQU   3                                                        00900000
DBR1     EQU   3                        WORK REG                        00920000
DEV3     EQU   3                                                        00940000
DBR3     EQU   4                        WORK REG                        00960000
DBCOMPR  EQU   5                                                        00980000
R6       EQU   6                                                        01000000
DADR1    EQU   6                                                        01020000
INVOKE1  EQU   6                                                        01040000
R7       EQU   7                                                        01060000
INVOKE2  EQU   7                                                        01080000
BASE     EQU   8                        BASE REG FOR IEHMVXSE           01100000
R10      EQU   10                                                       01120000
R12      EQU   12                                                       01140000
COMMAREA EQU   12                       BASE REG FOR COMMUNICATION AREA 01160000
R13      EQU   13                                                       01180000
R14      EQU   14                                                       01200000
DEV14    EQU   14                                                       01220000
DEV15    EQU   15                                                       01240000
R15      EQU   15                                                       01260000
*                                                                       01280000
*                                                                       01300000
*                             ENTRY AND EXTRN STATEMENTS                01320000
         ENTRY IEHMVXSE                                                 01340000
         ENTRY IEHMVESE                                                 01360000
*                             EQUATE STATEMENTS                         01380000
VOLMNTSW EQU   X'10'                                                    01400000
SWTCHOFF EQU   X'EF'                                                    01420000
DIGIT    EQU   X'F0'                                                    01440000
ZERO     EQU   X'00'                                                    01460000
VMIT     EQU   4                                                        01480000
VMITC    EQU   10                                                       01500000
VMVMR    EQU   11                                                       01520000
BLANK    EQU   X'40'                                                    01540000
OPEN     EQU   X'10'                                                    01560000
DCBFLG   EQU   48                                                       01580000
TOLANCE  EQU   X'01'                    DEVICE TOLERANCE MASK.          01600000
PARMERR  EQU   X'1FF'                                                   01610017
OVHED    EQU   14                      DEVICE OVERHEAD CONSTANT  S20201 01611020
OVHED1   EQU   17                      OVERHEAD BIT IF 2-BYTE    S20201 01612020
CVTAD    EQU   16                      ADDRESS OF ADDRESS OF CVT S20201 01613020
RPS      EQU   1                       DEVICE CHARISTICS BYTE    S20201 01614020
LEFTJUS  EQU   24                      BITS IN 3 BYTE SHIFT      S20201 01615020
*                                                                       01620000
*                                                                       01640000
         USING IEHMVXSE,BASE                                            01660000
         USING IEHMVV,COMMAREA           ADDRESSABILITY TO COMM DSECT   01680000
IEHMVXSE SAVE  (14,12),T,IEHMVXSE-OZ07393                      @ZA07393 01700004
         LR    BASE,R15                 SET UP ADDRESSABILITY           01720000
        IEHPRE (14,1),TFC                                               01740000
         LR    DBR1,R1                 PUT ADDRESS OF STAE EXIT  A30471 01750019
*                                      IN REG. FOR STAE MACRO    A30471 01751019
*                                                                     * 01760000
*              GETMAIN FOR THE WORKING STORAGE TO BE USED             * 01780000
*              BY THE IEHMOVE PROGRAM                                 * 01800000
*              THE FIRST 2000 BYTES ARE CLEARD TO BINARY ZEROS        * 01820000
*                                                                       01840000
         GETMAIN R,LV=3040                                         I276 01860019
         LR    COMMAREA,R1              SET UP ADDRESSABILITY FOR       01880000
*                                       MOVE/COPY COMMUNICATION AREA    01900000
         LA    R0,2000                                                  01920000
         BAL   R14,CLEAR                BRANCH TO CLEAR ROUTINE TO      01940000
*                                       CLEAR 2000 BYTE AREA            01960000
         STAE  (DBR1),CT,PARAM=(12),XCTL=YES                     A30471 01970019
         B     SKIPENTR                BRANCH AROUND ALTERNATE ENTRY    01980000
*                                                                     * 02000000
*              THIS IS AN ALTERNATE ENTRY POINT THAT IS USED          * 02020000
*              WHEN CONTROL IS PASSED TO THIS MODULE FROM THE MESSAGE * 02040000
*              WRITER MODULE OR THE VOLUME MOUNTING VOLUME            * 02060000
*                                                                     * 02080000
         USING *,R15                                                    02100000
IEHMVESE S     R15,ACON                 SET UP ADDRESSABILITY FOR       02120000
         LR    BASE,R15                 ALTERNATE ENTRY                 02140000
         DROP  R15                                                      02160000
         USING IEHMVXSE,BASE                                            02180000
         BALR  R15,R0                                                   02200000
         SAVE  (14,12),T,ESE                                            02220000
        IEHPRE (14),TFC                                                 02240000
         TM    IEHMVV20+4,VOLMNTSW      IS RETURN FROM VOLUME MOUNT     02260000
*                                       SWITCH ON?                      02280000
         BZ    TESTENTR                                                 02300000
         NI    IEHMVV20+4,SWTCHOFF     TURN SWITCH OFF                  02320000
         B     MNTIN                                                    02340000
TESTENTR DS    0H                                                       02360000
         B     FINDUCB                                                  02380000
SKIPENTR DS    0H                                                       02400000
*                                                                     * 02420000
*              INITIALIZATION OF THE WORKING STORAGE BEGINS HERE      * 02440000
*                                                                     * 02460000
*              GENERALLY THE FOLLOWING THING WILL TAKE PLACE          * 02480000
*                                                                     * 02500000
*               1   SET UP BEGINNING AND END ADDRESS OF PERMANENT     * 02520000
*                   WORK AREA                                         * 02540000
*               2   SET ASIDE 144 BYTES FOR THE CARD SCAN MODULE      * 02560000
*                   IEHMVSSJ                                          * 02580000
*               3   MOVE SYSIN  SYSPRINT AND  THREE WORK FILE DCBS    * 02600000
*                   AND ASSOCIATED DECB S TO PERMANENT WORK AREA      * 02620000
*              THE ABOVE ITEMS WILL REMAIN IN THE WORKING STORAGE     * 02640000
*              DURING THE COURSE OF THE IEHMOVE PROGRAM               * 02660000
*                                                                     * 02680000
         LA    DBR1,IEHMVV90             INITIALIZE BEGINING AND END    02700000
         ST    DBR1,IEHMVV10             ADDRESS OF PERMANENT WORK      02720000
         LA    DBR1,IEHMVV00                                       I276 02730019
         LA    DBR1,3039(DBR1)         END OF DSECT                I276 02740019
         ST    DBR1,IEHMVV10+4                                          02760000
         L     DBR1,IEHMVV10                                            02780000
         LA    DBR1,144(DBR1)           AREA FOR IEHMVESJ CARD SCAN RTN 02800000
         ST    DBR1,IEHMVV10                                            02820000
         S     DBR1,DISP1               CALC DCB ADDR ACCORDING TO      02840000
         ST    DBR1,IEHMVV32            OFFSET IN MACRO EXPANSION       02860000
         L     DBR1,IEHMVV10                                            02880000
         MVC   0(LOC2-LOC1,DBR1),LOC1   MOVE DCB TO PERM WORK AREA      02900000
         LA    DBR1,LOC2-LOC1(DBR1)                                     02920000
         LA    DBR1,20(DBR1)                                            02940000
         ST    DBR1,IEHMVV10            UPDATE NEXT AVIL ADDR           02960000
         L     DBR1,IEHMVV10             CALC DCB ADDRESS ACCORDING TO  02980000
         S     DBR1,DISP2                THE EQU STATEMENT WITHIN THE   03000000
         ST    DBR1,IEHMVV33             DCB MACRO EXPANSION            03020000
         L     DBR1,IEHMVV10                                            03040000
         MVC   0(LOC3-LOC2,DBR1),LOC2    MOVE DCB TO WORK AREA          03060000
         LA    DBR1,LOC3-LOC2(DBR1)                                     03080000
         LA    DBR1,20(DBR1)                                            03100000
         ST    DBR1,IEHMVV10             UPDATE NEXT AVALIBLE ADDR PTR  03120000
         L     DBR1,IEHMVV10             CALC DCB ADDRESS ACCORDING TO  03140000
         S     DBR1,DISP3                THE EQU STATEMENT IN THE       03160000
         ST    DBR1,IEHMVV40             DCB MACRO EXPANSION            03180000
         L     DBR1,IEHMVV10                                            03200000
         MVC   0(LOC4-LOC3,DBR1),LOC3    MOVE DCB TO WORK AREA          03220000
         LA    DBR1,LOC4-LOC3(DBR1)                                     03240000
         ST    DBR1,IEHMVV40+4           STORE DECB ADDRESS             03260000
         LA    DBR1,20(DBR1)                                            03280000
         ST    DBR1,IEHMVV10             UPDATE NEXT AVAILIABE ADDR PTR 03300000
         L     DBR1,IEHMVV10           CALC DCB ADDR ACCORDING TO       03320000
         S     DBR1,DISP4              THE EQU STSTEMENT IN THE         03340000
         ST    DBR1,IEHMVV41           DCB MACRO EXPANSION              03360000
         L     DBR1,IEHMVV10                                            03380000
         MVC   0(LOC5-LOC4,DBR1),LOC4  MOVE DCB TO PERM WORK AREA       03400000
         LA    DBR1,LOC5-LOC4(DBR1)                                     03420000
         ST    DBR1,IEHMVV41+4         STORE DECB ADDR                  03440000
         LA    DBR1,20(DBR1)                                            03460000
         ST    DBR1,IEHMVV10           UPD ATE NEXT AVILAB. ADDR        03480000
         L     DBR1,IEHMVV10            CALC DCB ADDRESS ACCORDING TO   03500000
         S     DBR1,DISP5               THE EQU STATEMENT IN THE        03520000
         ST    DBR1,IEHMVV42            DCB MACRO EXPANSION             03540000
         L     DBR1,IEHMVV10                                            03560000
         MVC   0(LOC6-LOC5,DBR1),LOC5                                   03580000
         LA    DBR1,LOC6-LOC5(DBR1)                                     03600000
         ST    DBR1,IEHMVV42+4          STORE DECB ADDR                 03620000
         LA    DBR1,20(DBR1)                                            03640000
         ST    DBR1,IEHMVV10                                            03660000
         LA    DBR1,60                  SET UP LINE COUNT OF 60         03680000
         STH   DBR1,IEHMVV51+8                                          03700000
         LA    DBR1,1                                                   03720000
         STH   DBR1,IEHMVV51+12        SET PAGE NO. TO 01               03740000
         MVC   IEHMVV00+176(24),DDNAMES MOVE KNOWN DDNAMES TO VOLITAL   03760000
*                                       WORK AREA                       03780000
*                                                                     * 03800000
*                                                                     * 03820000
*              INVOKER PARAMETERS WILL BE CONSIDERED IN THIS SECTION  * 03840000
*                                                                     * 03860000
*              THE ITEMS THAT WILL BE CONSIDERED ARE                  * 03880000
*               1   LINE COUNT                                        * 03900000
*               2   SYSIN  SYSPRINT  AND SYSUT1 DD CARD NAME          * 03920000
*                   SUBSTITUTIONS                                     * 03940000
*               3   PAGE NUMBER                                       * 03960000
*                                                                     * 03980000
*                                                                     * 04000000
         GETMAIN  R,LV=56              GET 56 BYTES OF CORE        VS0H 04020017
         USING ECSAVE,R1                USE DSECT,ECSAVE TO ADDRESS     04040000
*                                       THIS AREA                       04060000
         STM   R2,INVOKE2,ECSAVE        SAVE REGISTERS                  04080000
         L     R2,0(R6)                 GET ADDRESS OF PARM FIELD SET   04100000
         LA    DBR1,1             INITIALIZE REG TO DEFAULT        4942 04106015
*                                 VALUE OF POWER PARM (1)          4942 04112015
*                                                                       04120000
         AH    R2,0(R2)                 ADDRESS + LENGTH=END OF         04140000
         LA    R2,2(R2)       LENG IN LL FIELD DOES NOT INCLUDE LL 4942 04146015
*                             LL FIELD, BUMP PTR TO END OF PARM(+2)4942 04152015
*                                       PARM LIST                       04160000
         L     R6,0(0,R6)              POINTER TO PARM LIST        000F 04167017
         CLI   1(R6),ZERO    SEE IF LENGTH INDICATER FOR PARM LIST VS0H 04168017
*                            IS ZERO                               VS0H 04169017
         BE    HERE          IF THERE ARE NO PARMS 20/20/40 IS     VS0H 04170017
*                            ASSUMED                               VS0H 04171017
         LA    R6,2(R6)       BUMP REG BY 2 TO POINT TO ACTUAL PARM4942 04175015
ECLOOP1  CLC   ECKEY(6),0(R6)           CHECK FOR PARMETER POWER=  000F 04181017
         BE    CKDIGIT                  NO,UP POINTER              000F 04187017
         LA    R6,1(0,R6)                                          000F 04193017
         CR    R6,R2                    CHECK FOR END OF PARM      000F 04199017
         BNL   HERE     NO MATCH, DEFAULT IS 20/20/40              4942 04206015
         B     ECLOOP1                                                  04210014
CKDIGIT  LA    R6,6(0,R6)               BUMP PARM POINTER BY SIX   000F 04220017
         LR    R7,R6                    POINTER FOR DIGITS TO BE   000F 04230017
         CR    R6,R2                    CHECK FOR END OF LIST      000F 04240017
         BNL   PARMERR1                ERROR                       7356 04260017
         CLI   0(R6),X'F0'             CHECK DIGIT RANGE OF 1-9    000F 04270017
         BL    PARMERR1                ERROR                       7356 04280017
         CLI   0(R6),X'F9'                                         000F 04290017
         BH    PARMERR1                ERROR                       7356 04300017
         LA    R6,1(0,R6)               CHECK FOR END OF LIST      000F 04310017
         CR    R6,R2                                               000F 04320017
         BNL   ECFIND                                              4942 04330015
         CLI   0(R6),X'6B'             DELIMITER FOR THIS PARAM    7356 04333017
         BE    ECFIND                  IF YES, THEN FINISHED       7356 04336017
         LA    DBR1,1(0,DBR1)           UPDATE BYTE COUNTER        000F 04344017
         CLI   0(R6),X'F0'              CHECK DIGIT RANGE OF 1-9   000F 04352017
         BL    PARMERR1                ERROR                       7356 04360017
         CLI   0(R6),X'F9'                                         000F 04370017
         BH    PARMERR1                ERROR                       7356 04380017
         LA    R6,1(0,R6)               UPDATE PARM POINTER        000F 04388017
         CR    R6,R2                    CHECK POINTERS             000F 04396017
         BNL   ECFIND                                              000F 04404017
         CLI   0(R6),X'6B'            DELIMITER FOR THIS PARAM @ZA01726 04415003
         BE    ECFIND                 IF YES, THEN FINISHED    @ZA01726 04416003
         LA    DBR1,1(0,DBR1)          UPDATE BYTE COUNTER     @ZA01726 04417003
         CLI   0(R6),X'F0'             CHECK DIGIT RANGE 1-9   @ZA01726 04418003
         BL    PARMERR1                ERROR                   @ZA01726 04419003
         CLI   0(R6),X'F9'                                     @ZA01726 04420003
         BH    PARMERR1                ERROR                   @ZA01726 04421003
         LA    R6,1(0,R6)              UPDATE PARM POINTER     @ZA01726 04422003
         CR    R6,R2                   CHECK POINTERS          @ZA01726 04423003
         BNL   ECFIND                                          @ZA01726 04424003
         CLI   0(R6),X'6B'            DELIMITER SHOULD BE HERE @ZA01726 04425003
         BNE   PARMERR1               AS ONLY THREE DIGITS FOR @ZA01726 04426003
*                                     POWER ARA SUPPORTED      @ZA01726 04427003
ECFIND   BCTR  DBR1,0                   REDUCE BYTE COUNT BY ONE   000F 04434017
*                                          FOREXECUTE OF PACK      000F 04443017
         EX    DBR1,ECPACK              PACK THE NUMBER            000F 04452017
         CVB   DBR1,ECDBL               AND CONVERT IT             000F 04461017
HERE     LA    R2,20      ASSUME 20 TRACKS                         4942 04470015
         MR    R2,R2                   INCREASE 20 BY POWER        000F 04480017
         B     ECEND                                                    04490014
PARMERR1 OI    PARMERR(COMMAREA),X'01' SET PARAM ERROR BIT         7356 04493017
         B     ECEND                   SKIP TO PROCESS NEXT PARAM  7356 04496017
         SPACE 3                                                        04500014
ECPACK   PACK  ECDBL(8),0(R0,R7)   EXECUTED PACK INSTRUCTION       4942 04510015
         SPACE 3                                                        04520014
ECEND    ST    DBR1,IEHMVV50            PLACE THE ALLOCATION       000F 04550017
*                                          AMOUNT IN THE WORK AREA 000F 04580017
         LM    R2,R7,ECSAVE             RELOAD REGISTERS                04620000
         FREEMAIN  R,LV=56,A=(1)       FREE 56 BYTES OF GOTTEN COREVS0H 04640017
         DROP  R1                                                       04660000
INVOPT   L     INVOKE2,0(0,INVOKE1)     SET UP POINTER TO BYTE COUNT    04680000
         LH    DBR1,0(0,INVOKE2)         BYTE COUNT IN REG              04700000
         LTR   DBR1,DBR1                 IS BYTE COUNT ZERO             04720000
         BZ    INVOPT1                   BRANCH IF YES                  04740000
         B     INVOPT2                                                  04760000
INVOPT1  MVI   XSEENTRY,ZERO            SET ENTRY SWITCH TO ZERO        04780000
         L     INVOKE2,0(0,INVOKE1)                                     04800000
         LTR   INVOKE2,INVOKE2           IS THE POINTER MINOS           04820000
         BM    INVEXIT                   BRANCH IF YES                  04840000
         B     INVDD                     GO TO DD NAME RTN IF NO        04860000
INVOPT2  SH    DBR1,DSIX                 SCAN FOR LINECNT=              04880000
         AR    INVOKE2,DBR1                                             04900000
INVOPT4  CLC   LINECNT(8),0(INVOKE2)     LOOK FOR LINECNT=              04920000
         BE    INVOPT3                   BRANCH IF FOUND                04940000
         BCTR  INVOKE2,R0                                               04960000
         BCT   DBR1,INVOPT4              BRANCH IF NOT FOUND            04980000
         B     INVOPT1                   LOOP AND LOOK FURTHER          05000000
INVOPT3  LA    INVOKE2,8(INVOKE2)        IS PARAM FOLLOWING EQUAL ONE   05020000
         CLI   0(INVOKE2),X'EF'          OR TWO BYTES                   05040000
         BNH   INVOPT5                   BRANCH IF FIRST BYTE IS DELIM  05060000
         CLI   1(INVOKE2),X'EF'          IS SECOND BYTE A DELIMITER     05080000
         BNH   INVOPT7                   BRANCH IF YES                  05100000
  LA  DBR1,1  SET  COUNT                                                05120000
         B     INVOPT6                                                  05140000
INVOPT7  SR  DBR1,DBR1   SET  COUNT                                     05160000
INVOPT6  EX    DBR1,INVOPT8              MOVE LINE COUNT TO COMM AREA   05180000
         B     INVOPT9                                                  05200000
INVOPT8  PACK  IEHMVV00(8),0(1,INVOKE2)    PACK  NUMBER                 05220000
INVOPT9  DS    0H                                                       05240000
         CVB   DBR3,IEHMVV00            CONVERT IT TO BINARY            05260000
         C     DBR3,FOUR               CHECK IF LINE COUNT IS   YA01194 05268016
*                                       EQUAL OR GREATER THAN 4 YA01194 05276016
         BL    INVOPT5                 NO , GO TO INVOPT5       YA01194 05284016
         STH   DBR3,IEHMVV51+8          STORE IT IN COMM. AREA          05292022
         B     INVOPT1                                                  05300000
INVOPT5  DS    0H                                                       05320000
         OI    PARMERR(COMMAREA),X'01' SET PARAM ERROR BIT         7356 05330017
         B     INVEXIT                 GO OPEN SYSPRINT AND ABORT  7356 05340017
INVDD    L     INVOKE2,4(INVOKE1)  SET UP POINTER TO DDNAME LIST        05480000
         LH    DBR1,0(INVOKE2)     LOAD AREA COUNT IN A REG             05500000
         LTR   DBR1,DBR1           IS COUNT ZERO                        05520000
         BZ    INVDD1              BRANCH IF YES                        05540000
         B     INVDD2                                                   05560000
INVDD1   L     INVOKE2,4(INVOKE1)  SET UP POINTER TO DDNAME LIST        05580000
         LTR   INVOKE2,INVOKE2     IS POINTER MINUS                     05600000
         BM    INVEXIT             EXIT IF YES                          05620000
         B     INVPG               GO TO PAGE NO. RTN IF NO             05640000
INVDD2   EQU *                                                          05660000
         LA    DBR3,34             LOAD 34 INTO A REG                   05680000
         CLR   DBR1,DBR3           COMPARE COUNT TO REG                 05700000
         BNH   INVDD1              BRANCH IF LOW OR EQUAL               05720000
         LA    INVOKE2,2(INVOKE2)                                       05740000
         LM    R14,R15,32(INVOKE2)                                      05760000
         BCTR  INVOKE2,R0                                               05780000
         BCTR  INVOKE2,R0                                               05800000
         LTR   R14,R14                  IS THE NAME ZEROS?              05820000
         BZ    INVDD3              BRANCH IF YES                        05840000
         STM   R14,R15,IEHMVV00+176     REPLACE SYSIN DDNAME            05860000
         L     DBR3,IEHMVV32            CHANGE NAME IN SYSIN DCB        05880000
         STM   R14,R15,40(DBR3)                                         05900000
INVDD3   LA    DBR3,42             LOAD 40 INTO A REG                   05920000
         CLR   DBR1,DBR3           COMPARE COUNT TO REG                 05940000
         BNH   INVDD1              BRANCH IF LOW OR EQUAL               05960000
         LA    INVOKE2,2(INVOKE2)                                       05980000
         LM    R14,R15,40(INVOKE2)                                      06000000
         BCTR  INVOKE2,R0                                               06020000
         BCTR  INVOKE2,R0                                               06040000
         LTR   R14,R14                  IS THE NAME ZERO?               06060000
         BZ    INVDD4              BRANCH IF YES                        06080000
         STM   R14,R15,IEHMVV00+184     REPLACE SYSPRINT DDNAME         06100000
         L     DBR3,IEHMVV33            CHANGE NAME IN SYSPRINT DCB     06120000
         STM   R14,R15,40(DBR3)                                         06140000
INVDD4   LA    DBR3,58                  LOAD REG WITH 58                06160000
         CLR   DBR1,DBR3                COMPARE COUNT TO REG            06180000
         BNH   INVDD1                   BRANCH IF LOW OR EQUAL          06200000
         LA    INVOKE2,2(INVOKE2)                                       06220000
         LM    R14,R15,56(INVOKE2)                                      06240000
         BCTR  INVOKE2,R0                                               06260000
         BCTR  INVOKE2,R0                                               06280000
         LTR   R14,R14                  IS THE NAME ZERO?               06300000
         BZ    INVDD1                   BRANCH IF YES                   06320000
         STM   R14,R15,IEHMVV00+192     REPLACE SYSUT1 DDNAME           06340000
         L     DBR3,IEHMVV40            CHANGE NAME IN SYSUT1 DCB       06360000
         STM   R14,R15,40(DBR3)                                         06380000
         L     DBR3,IEHMVV41            CHANGE DD NAME IN SYSUT2 DCB    06400000
         STM   R14,R15,40(DBR3)                                         06420000
         L     DBR3,IEHMVV42            CHANGE DD NAME IN SYSUT3 DCB    06440000
         STM   R14,R15,40(DBR3)                                         06460000
         B     INVDD1                                                   06480000
INVPG1   PACK  IEHMVV00(8),2(1,INVOKE2) MOVE PAGE # TO COMM AREA A21460 06490018
INVPG    L     INVOKE2,8(INVOKE1)       SET POINTER TO PAGE NO POINTER  06500000
         LH    DBR1,0(INVOKE2)          LOAD AREA COUNT                 06520000
         LTR   DBR1,DBR1                IS COUNT ZERO                   06540000
         BZ    INVEXIT                  BRANCH IF YES                   06560000
         BCTR  DBR1,0                   DECREASE COUNT BY 1 FOR  A21460X06566018
                                        EX INSTRUCTION           A21460 06573018
         EX    DBR1,INVPG1              MOVE PAGE NO. TO COMM AREA      06580000
         CVB   INVOKE2,IEHMVV00         CONVERT IT TO BINARY            06620000
         STH   INVOKE2,IEHMVV51+12     STORE BACK IN COMM AREA   A21460 06660018
INVEXIT  DS    0H                                                       06700000
*                                                                     * 06720000
*                                                                     * 06740000
*              AT THIS POINT A LIST OF DD NAMES ASSOCIATED WITH       * 06760000
*              DATA SETS THAT WILL BE ACTIVE THROUGH OUT THE COURSE   * 06780000
*              OF THE IEHMOVE PROGRAM   WORK FILES  ETC WILL BE PASSED* 06800000
*              TO THE VOLUME MOUNTING ROUTINE                         * 06820000
*              THE VOLUME MOUNTING ROUTINE WILL INITIALIZE ITS SELF   * 06840000
*              SO AS TO PREVENT THE VOLUMES ON WHICH THESE DATA SETS  * 06860000
*              RESIDE FROM BEING  DISMOUNTED                          * 06880000
*                                                                     * 06900000
*                                                                     * 06920000
         LA    R1,IEHMVV00+176          SET UP VOLUME MOUNTING REQUEST  06940000
         ST    R1,IEHMVV00                                              06960000
         LA    R1,3                                                     06980000
         STC   R1,IEHMVV00                                              07000000
         MVI   IEHMVV00+VMVMR,X'00'     NUMBER OF REQUESTS              07020000
         LA    DBR1,IEHMVV00       PTR TO LIST FOR VOL MNT              07040000
         LH    DBR3,SE                                                  07060000
       IEHPOST (14),T                                                   07080000
         XCTL  EP=IEHMVXSF                                              07100000
MNTIN    DS    0H                                                       07120000
         LR    R1,DBR1                                                  07140000
         L     R15,VMIT(0,R1)           GET ADDRESS OF INTERNAL TABLE   07160000
         SR    R0,R0                                                    07180000
         IC    R0,VMITC(R0,R1)          GET NUMBER OF IT ENTRIES        07200000
         LH    R14,0(R0,R15)            GET LENGTH OF TABLE             07220000
         L     R1,IEHMVV10              POINTER TO PERMANENT WORK AREA  07240000
         ST    R1,IEHMVV50+4            SET UP POINTER TO IT TABLE      07300000
         STC   R0,IEHMVV50+4            SET UP NUMBER OF IT ENTRIES     07320000
         LA    R10,255          TO MOVE 256 BYTES BY EX-INSTR.   A48763 07370022
MVCINTBL CH    R14,H256         IS INT. TBL. LONGER THAN 256 BTS A48763 07372022
         BNH   LASTMVC          IF NOT, BYPASS LOOP TO MOVE IT   A48763 07374022
         EX    R10,ITMOVER      IF YES,MOVE IT IN STEPS OF 256BTSA48763 07376022
         SH    R14,H256         ADJUST NR OF BYTES, TO BE MOVED  A48763 07378022
         LA    R15,256(R15)     ADJUST ADDRESS,FROM WHICH TO MOVEA48763 07378422
         LA    R1,256(R1)       ADJUST ADDRESS,TO WHICH TO MOVE  A48763 07378822
         B     MVCINTBL         BRANCH FOR MOVE OF THE REST OF ITA48763 07379222
LASTMVC  BCTR  R14,R0           SUBTRACT ONE FOR EX-INSTRUCTION  A48763 07379622
         EX    R14,ITMOVER      MOVE REMAINING PART OF INT. TABLEA48763 07379722
         LA    R1,1(R1,R14)     ADJUST NEW WORKAREA-POINTER      A48763 07379822
         ST    R1,IEHMVV10      SAVE NEW WORKAREA-POINTER        A48763 07379922
         LR    R1,DBR1                                           A48763 07386622
         L     R15,VMIT(R0,R1)  GET ADDRESS OF I.T. FOR FREEMAIN A48763 07388622
         LH    R14,0(R0,R15)    GET LENGTH OF I.T. FOR FREEMAIN  A48763 07390622
         LR    R0,R14                                            A48763 07393322
         LR    R1,R15                                                   07400000
         FREEMAIN R,LV=(0),A=(1)        FREE TABLE AREA                 07420000
         B     ITMOVEO                                                  07440000
ITMOVER  MVC   0(1,R1),0(R15)           USED FOR MOVING INTERNAL TABLE  07460000
ITMOVEO  DS    0H                                                       07480000
*                                                                     * 07500000
*                                                                     * 07520000
*              SYSIN  AND  SYSPRINT  DCB S  WILL BE OPENED HERE       * 07540000
*                                                                     * 07560000
*              AFTER SYSPRINT IS OPENED CONTROL WILL BE PASSED        * 07580000
*              TO THE MESSAGE WRITER SO THAT IT CAN INITIALIZE        * 07600000
*              ITS SELF   SKIP FORMS                                  * 07620000
*                         PRINT HEADER  AND PAGE NUMBER               * 07640000
*                         ETC                                         * 07660000
*                                                                     * 07680000
*                                                                     * 07700000
         L     DBR1,IEHMVV32                                            07720000
         L     DBR3,IEHMVV33                                            07740000
         MVC   37(3,DBR1),DCB1+37  UPDATE ADDRESS OF EXITLISTS  PTM663  07746017
         MVC   37(3,DBR3),DCB2+37   AFTER XCTLS - ESP FOR MVT   PTM663  07752017
         L     DBCOMPR,IEHMVV10                                         07760000
         MVC   0(RENT2-RENT1,DBCOMPR),RENT1                             07780000
         MVI   IEHMVV20,X'00'          SET SWITCH FOR SYSIN DCB    BS0H 07786017
*                                         EXIT                     BS0H 07792017
         BALR  R10,DBCOMPR             GO TO OPEN DCBS                  07800000
*                                                                       07820000
         TM    PARMERR(COMMAREA),X'01' IS PARAM ERROR BIT ON       7356 07826017
         BO    LINKAGE                 IF SO GO TO BAD PARAM ABORT 7356 07832017
*                                                                       07840000
*    THE FOLLOWING CODE CHECKS THE FLAG FIELDS OF THE SYSIN AND         07860000
* SYSPRINT DCBS FOR A SUCCESSFUL OPEN.                                  07880000
*                                                                       07900000
*    IF SYSPRINT HAS NOT BEEN OPENED SUCCESSFULLY, NO SYSPRINT          07920000
* DD STATEMENT HAS BEEN SUPPLIED.                                       07940000
*                                                                       07960000
*    CONSEQUENTLY, NO MESSAGE TO THIS EFFECT CAN BE PRINTED.            07980000
* CODE 16 IS RETURNED TO THE SCHEDULER AND THE JOB IS TERMINATED.       08000000
*                                                                       08020000
*    IF SYSIN HAS NOT BEEN OPENED SUCCESSFULLY, NO SYSIN                08040000
* DD STATEMENT HAS BEEN SUPPLIED.                                       08060000
*                                                                       08080000
*    A MESSAGE TO THIS EFFECT IS PRINTED, CODE 16 IS RETURNED           08100000
* TO THE SCHEDULER AND THE JOB IS TERMINATED.                           08120000
*                                                                       08140000
         CLI   IEHMVV20,X'F0'          BLOCKSIZE CHECK PASSED      BS0H 08146017
         BNE   BLKOK                   YES. BLOCKSIZE CHECK PASSED BSOH 08153018
         TM    DCBFLG(DBR3),OPEN       HAS SYSPRINT BEEN OPENED OK      08160000
         BO    TSTSYSIN                YES. GOTO TEST SYSIN             08180000
NOGOOD   TM    DCBFLG(DBR1),OPEN       HAS SYSIN BEEN OPENED   @ZA01246 08200002
         BZ    FREE                     NO SKIP CLOSE          @ZA01246 08205002
         CLOSE ((DBR1))                 YES CLOSE SYSIN        @ZA01246 08210002
FREE     LA R0,3040                    PREPARE TO ABORT        @ZA01246 08215002
         LR    R1,COMMAREA             LOAD PARAM REGS TO FREE STORAGE  08220000
*                                      ACQUIRED FOR COMMUNICATIONS      08240000
*                                      AREA.                            08260000
         FREEMAIN R,LV=(0),A=(1)       ISSUE FREEMAIN                   08280000
         IEHPOST (14,1),T              RESTORE PNTR TO SAVE AREA        08300000
         LA    R15,8                   LOAD ABORT RETURN CODE    A24913 08320018
         RETURN (14,12),RC=(15)        RETURN TO STEM                   08340000
BLKOK    TM    DCBFLG(DBR3),OPEN       HAS SYSPRINT BEEN OPENED  A24913 08343018
         BZ    NOGOOD                  NO. PREPARE TO ABORT      A24913 08346018
TSTSYSIN TM    IEHMVV20,X'FF'          CHECK FOR IMPROPER BLKSI    BS0H 08350017
         BC    1,LINKAGE               YES, INCOMPLETE OPERN       BS0H 08360017
         TM    DCBFLG(DBR1),OPEN       HAS SYSIN BEEN OPENED OK    BS0H 08370017
         BO    OKAY                    YES. CONTINUE PROCESSING THIS    08380000
*                                      REQUEST.                         08400000
*                            IF NO, GO TO MESSAGE WRITER TO PRINT       08420000
*                            HEADER AND RETURN TO SET UP MESSAGE        08440000
*                            UNABLE TO OPEN SYSIN DATA SET.             08460000
         B     LINKAGE                                             BS0H 08461017
EXITSYS  OC    62(2,DBR1),62(DBR1)     HAS BLOCK SIZE BEEN PROVIDEDBS0H 08462017
         BNZ   DIVIDE                  YES, GO TO CHECK FOR A      BS0H 08463017
*                                         MULTIPLE OF LRECL        BS0H 08464017
         MVC   62(2,DBR1),82(DBR1)     ASSUME BLOCKSIZE=80         BS0H 08465017
         RETURN                                                         08466017
DIVIDE   SR    R2,R2                                               BS0H 08466817
         LH    R15,82(DBR1)            PICK UP LRECL               BS0H 08467617
         LR    R1,DBR1                  SAVE REGISTER              BS0H 08468417
         LH    R3,62(DBR1)             PICK UP BLOCK SIZE          BS0H 08469217
         DR    R2,R15                  DIVIDE BLOCKSIZE BY LRECL   BS0H 08470017
         LR    DBR1,R1                                             BS0H 08470817
         LTR   R2,R2                    CHECK FOR REMAINDER        BS0H 08471617
         BCR   8,R14                   RETURN TO OPERN IF DIVIDE   BS0H 08472417
*                                         SUCCESSFUL               BS0H 08473217
         MVI   IEHMVV20,X'FF'          SET FOR S\SIN UNOPENED      BS0H 08474017
         MVC   62(2,DBR1),82(DBR1)      MOVE LRECL TO BLKSIZE      BS0H 08474817
         RETURN                                                         08476017
DCBPRTS  OC    62(2,DBR3),62(DBR3)     BLOCKSIZE PROVIDED          BS0H 08477017
         BNZ   CHECKD                  YES, BLOCK SIZE PROVIDED    BS0H 08478017
         MVC   62(2,DBR3),82(DBR3)     SET BLOCKSIZE = LRECL       BS0H 08479017
         RETURN                                                         08480017
CHECKD   SR    R2,R2                                               BS0H 08481017
         LH    R3,62(DBR3)             PICK UP BLOCKSIZE           BS0H 08482017
         LH    R15,82(DBR3)            PICK UP LRECL               BS0H 08483017
         DR    R2,R15                  DIVIDE BLOCK SIZE BY LRECL  BS0H 08484017
         L     DBR1,IEHMVV32           RESTORE SYSIN DCB POINTER   BS0H 08485017
         LTR   R2,R2                                               BS0H 08486017
         BCR   8,R14                   NO REMAINDER RETURN TO OPEN BS0H 08487017
         MVI   IEHMVV20,X'F0'          SET ERROR CODE              BS0H 08488017
         MVC   62(2,DBR3),82(DBR3)      MOVE LRECL TO BLKSIZE      BS0H 08489017
         RETURN                                                         08490017
LINKAGE  LINK  EP=IEHMVESU                                         BS0H 08491017
         TM    PARMERR(COMMAREA),X'01' IS PARAM ERROR BIT ON       7356 08492017
         BZ    *+12                    IF NOT SYSIN NOT OPENED     7356 08493017
         LA    R3,8                    PARAM ERR MSG CODE FOR ESA  7356 08494017
         B     *+8                     SKIP UNOPENED SYSIN CODE    7356 08495017
         LA    R3,17                   SET UNOPENED SYSIN CODE     7356 08496017
         LA    R2,16                   FORCE ENTRY TO IEHMVESK, THE     08540000
*                                      WRAP UP ROUTINE. AFTER IEHMVESA  08560000
*                                      HAS CAUSED THE ABOVE MSG TO BE   08580000
*                                      PRINTED, IT WILL PASS CONTROL    08600000
*                                      TO IEHMVESK ON THE BASIS OF      08620000
*                                      THE CODE FOUND IN REGISTER 2.    08640000
         OI    IEHMVV41+13,X'08'       SET RETURN CODE BYTE AT 16       08660000
*                                      THIS BYTE WILL BE LOADED INTO    08680000
*                                      REGISTER 15 BY IEHMVESK PRIOR    08700000
*                                      TO RETURNING TO THE STEM.        08720000
         B     ESAEXIT                 GO TO IEHMVESA                   08740000
OKAY     DS    0H                                                       08760000
         L     R3,MINUS                 SET CODES FOR REENTRY           08780000
         LA    R2,4                     TO IEHMVXSE                     08800000
ESAEXIT  DS    0H                                                       08820000
       IEHPOST (14),T                                                   08840000
         XCTL  EP=IEHMVESA                                              08860000
*                                                                     * 08880000
*                                                                     * 08900000
*              THE THREE WORK FILES WILL BE ALLOCATED BY THIS ROUTINE * 08920000
*                                                                     * 08940000
*              A JFCB WILL BE CONSTRUCTED AND PASSED TO DADSM FOR     * 08960000
*              ALLOCATION OF EACH OF THE UNIQUELY NAMED FILES         * 08980000
*                                                                     * 09000000
*                                                                     * 09020000
FINDUCB  MVI   XSEENTRY,ZERO            SET ENTRY SWITCH TO ZERO        09040000
         L     DBR1,16                  LOAD PTR TO CVT                 09060000
         L     DBR1,0(DBR1)             LOAD POINTER TO TCB POINTE      09080000
         L     DBR1,4(DBR1)            LOAD CURRENT TCB        @ZA07392 09100004
         L     DBR1,12(DBR1)            LOAD TIOT POINTER               09120000
         LA    DBR1,24(DBR1)            ADJ TIOT POINTER TO POINT TO DD 09140000
         L     DBCOMPR,IEHMVV40                                         09160000
UCB1     CLC   40(8,DBCOMPR),4(DBR1)                                    09180000
         BE    UCBFOUND                 BRANCH IF YES                   09200000
     SR   DBR3,DBR3                                                     09220000
    IC  DBR3,0(DBR1)                                                    09240000
         AR    DBR1,DBR3                BUMP POINTER TO NEXT DD ENTRY   09260000
    IC  DBR3,0(DBR1)                                                    09280000
         LTR   DBR3,DBR3                IS LENGTH ZERO                  09300000
         BZ    NOFIND1                 YES NO DD MATCH WAS MADE  A38756 09320021
         B     UCB1                     LOOP TO CONTINUE SEARCH         09340000
UCBFOUND EQU   *                                               @ZM30153 09360003
         SR    R1,R1                    CLEAR REGISTER         @ZM30153 09362003
         ICM   R1,3,18(DBR1)            LOAD UCB PTR           @ZM30153 09370003
         ST    R1,IEHMVV31                                              09380000
         XC    IEHMVV39+5(3),IEHMVV39+5 CLEAR NAME GENERATEOR COUNTS    09400000
         MVI   IEHMVV31,X'80'                                           09420000
*                                       *** BUILD JFCB TO CALL DADSM**  09440000
         SPACE 1                                                        09460000
*              COMPUTE THE NUMBER OF TRACKS FOR ANY DIRECT ACCESS       09480000
*              DEVICE BY USING THE DEVICE CHARACTERISTICS               09500000
         SPACE 1                                                        09520000
         STM   DEV14,DEV3,DEVSAVE                                       09540000
         L     DEV14,IEHMVV40          GET ADDRESS OF SYSUT1 DDNAME     09560000
         LA    DEV1,40(0,DEV14)         FROM SYSUT1 DCB                 09580000
         DEVTYPE (1),DEVCHAR,DEVTAB     GET DEVICE CHARACTERISTICS      09600000
         TM    DEVCHAR+2,X'20'         TEST FOR DIRECT ACCESS           09620000
         BZ    DEVCONT                 BRANCH IF NOT D. A.              09640000
         TM    DEVCHAR+RPS,X'10'     RECORD READY FEATURE AVAIL. S20201 09645020
         BZ    ALLOC                   NO - CONTINUE             S20201 09650020
         OI    IEHMVV20+VMIT,X'04'     TURN ON RECORD READY BIT  S20201 09655020
ALLOC    L     DEV15,IEHMVV50          GET THE NO. OF TRACKS NOW S20201 09665020
         LA    DEV15,0(0,DEV15)        COMPUTED AND PLACE IN REGISTER   09680000
         SR    DEV0,DEV0                                                09700000
         LR    DEV2,DEV0                                                09720000
         LA    DEV1,88                  PICK ASSUMED KEYED RECORD       09740000
*                                          LENGTH OF 88 BYTES           09760000
         TM    DEVCHAR+17,TOLANCE       TEST FOR DEVICE TOLERANCE       09780000
         BZ    NOTOL                    BRANCH IF NO TOLERANCE          09800000
         MH    DEV1,DEVCHAR+18          MULTIPLY BY TOLERANCE           09820000
         SRL   DEV1,9                   DIVIDE RESULT BY 512            09840000
NOTOL    LH    DEV3,DEVCHAR+12          PICK UP MAXIMUM TRACK LENGTH    09860000
         SR    DEV3,DEV1                SUBTRACT OFF RECORD SIZE TIMES  09880000
*                                          TOLERANCE IF ANY             09900000
         TM    DEVCHAR+OVHED1,X'08'    2-BYTE COUNT TEST         S20201 09904020
         BZ    NOTOL1                  NO - CONTINUE             S20201 09908020
         LH    DEV0,DEVCHAR+OVHED      GET OVERHEAD VALUE        S20201 09912020
         B     CHANGED                 CONTINUE                  S20201 09916020
NOTOL1   IC    DEV0,DEVCHAR+15         PICK UP OVERHEAD FACTOR   S20201 09926020
*                                          KEYED LAST RECORD            09940000
         SR    DEV3,DEV0                SUBTRACT OFF OVERHEAD FACTOR    09960000
         IC    DEV0,DEVCHAR+14          PICK UP OVERHEAD FACTOR FOR     09980000
*                                          KEYED NON LAST RECORD        10000000
CHANGED  AR    DEV1,DEV0            SUBTRACT OFF OVERHEAD FACTOR S20201 10020020
         DR    DEV2,DEV1                DIVIDE TRACK LENGTH MINUS LAST  10040000
*                                          RECORD LENGTH BY NON LAST    10060000
*                                          RECORD LENGTH                10080000
         LA    DEV3,1(DEV3)             INCREMENT RECORD COUNT BY ONE   10100000
*                                          FOR LAST RECORD              10120000
         LA    DEV14,21                 PICK UP NUMBER OF 88 BYTE       10140000
*                                          KEYED RECORDS THAT WILL FIT  10160000
*                                          ON ONE TRACK OF A 2311       10180000
         MR    DEV14,DEV14              CALCULATE TOTAL NUMBER OF       10200000
*                                          RECORDS NEEDED               10220000
         DR    DEV14,DEV3               CALCULATE NUMBER OF RECORDS     10240000
*                                          BY NUMBER THAT WILL FIT ON   10260000
*                                          A TRACK OF DEVICE TO BE      10280000
*                                          USED                         10300000
         ST    DEV15,IEHMVV50           STORE, NUMBER OF TRACKS NEEDED  10320000
DEVCONT  LM    DEV14,DEV3,DEVSAVE                                       10340000
         SPACE 1                                                        10360000
         MVC   IEHMVV00(176),JFCB1      MOVE SKELETON JFCB TO WORK AREA 10380000
         MVC   IEHMVV00+152(3),IEHMVV50+1   NUMBER OF TRKS TO JFCB      10400000
         CLI   DEVCHAR+3,X'05'          TEST FOR 2321            S20201 10406000
         BC    7,NOT2321                                         S20201 10412000
         MVC   IEHMVV00+118(6),4(R1)    IF YES DISPLACEMENT TO VOL      10418013
*                                          SER IS DIFFERENT SINCE       10424013
*                                          A SUB UCB IS POINTED TO      10430013
         B     GO                                                       10436013
NOT2321  MVC   IEHMVV00+118(6),28(R1)   MOVE VOL SER FROM UCB TO JFCB   10442013
GO       MVI   IEHMVV00+124,X'40'       VOL SER NO DELIMETER            10448013
         MVC   IEHMVV00(2),ASTRISK     PROTECT DSNAME WITH PRECEDING    10460000
*                                      ASTRISK                          10480000
         ST    R1,SAVEREG1             SAVE REG1               @ZA07393 10481004
         TIME  ,                                               @ZA07393 10482004
         XC    DW,DW                   CLEAR CONVERSION AREA   @ZA07393 10483004
         LR    R6,R1                   GET DATE IN REG6        @ZA07393 10484004
         STH   R1,DW+6                 STORE DAY 'DDC'         @ZA07393 10485004
         CVB   R1,DW                   CONVERT TO BINARY       @ZA07393 10486004
         STH   R1,DW+6                 STORE IT                @ZA07393 10487004
         MVC   IEHMVV00+81(2),DW+6     MOVE DAY INTO JFCB      @ZA07393 10488004
         SRDL  R6,4                    PUT 'C' INTO REG7       @ZA07393 10489004
         SRL   R6,12                   REMOVE DAY 'DDD'        @ZA07393 10490004
         SLDL  R6,4                    PUT BACK 'C'            @ZA07393 10491004
         STH   R6,DW+6                 STORE YEAR 'YYC'        @ZA07393 10492004
         CVB   R1,DW                   CONVERT TO BINARY       @ZA07393 10493004
         STC   R1,IEHMVV00+80          MOVE YEAR INTO JFCB     @ZA07393 10494004
         L     R1,SAVEREG1             RESET REG1              @ZA07393 10495004
DUPNAME  TIME  ,                       GET TIME                @ZA00101 10500002
         ST    R0,DV                   STORE CLOCK TIME        @ZA00101 10530002
         OI    DV+3,X'0F'              SET SIGN BYTE           @ZA00101 10560002
         UNPK  IEHMVV00+10(7),DV(4)    UNPACK                  @ZA00101 10590002
         MVC   IEHMVV00+2(8),DDNAMES+16 MOVE SYSUT1.T TO JFCB  @ZA00101 10620002
         MVC   IEHMVV87(8),IEHMVV00+9  SAVE TIME FOR SCRATCH   @ZA03372 10650003
         LA    R3,IEHMVV00             ADDRESS OF VOLITAC      @ZA00101 10680002
*                                      WORK AREAA              @ZA00101 10710002
         ST    R3,IEHMVV31+4           STORE ADDRESS           @ZA00101 10740002
         BAL   DBCOMPR,CALLDAD         ALLOCATE **SYSUT1       @ZA00101 10770002
         SR    R15,R6                  CHECK RETURN CODE       @ZA00101 10800002
         BZ    DUPNAME                 DUPLICATE NAME          @ZA00101 10830002
         BM    DAD1                    GOOD ALLOCATE           @ZA00101 10860002
NOFIND1  MVC   IEHMVV39+5(3),XFF       INDICATE NONE OF THE    @ZA00101 10890002
*                                      WORKFILES WAS ALLOCATED @ZA00101 10920002
         B     NOFIND                  AND ABORT               @ZA00101 10950002
DAD1     DS    0H                                              @ZA00101 10980002
         MVC   TTRSAVE(3),IEHMVV00+53  SAVE TTR FOR OPEN       @ZA00101 11010002
         MVI   IEHMVV00+7,X'F2'        MAKE NAME **SYSUT2.T    @ZA00101 11040002
         BAL   DBCOMPR,CALLDAD         ALLOCATE **SYSUT2       @ZA00101 11070002
         SR    R15,R6                  CHECK RETURN CODE       @ZA00101 11100002
         BM    DAD2                    GOOD ALLOCATE           @ZA00101 11130002
         MVC   IEHMVV39+6(2),XFF       INDICATE **SYSUT2 AND   @ZA00101 11160002
*                                      **SYSUT3 NOT ALLOCATED  @ZA00101 11190002
         B     NOFIND                  AND ABORT               @ZA00101 11220002
DAD2     DS    0H                                              @ZA00101 11250002
         MVC   TTRSAVE+3(3),IEHMVV00+53 SAVE TTR FOR OPEN      @ZA00101 11280002
         MVI   IEHMVV00+155,X'44'      PREP JFCBCTRI FOR SLL   @ZA00101 11310002
         L     DBCOMPR,IEHMVV00+152    DOUBLE THE ALLOCATION   @ZA00101 11340002
         SLL   DBCOMPR,1               FOR SYSUT3 WORK FILE    @ZA00101 11370002
         ST    DBCOMPR,IEHMVV00+152    PUT IT IN JFCB          @ZA00101 11400002
         MVI   IEHMVV00+7,X'F3'        MAKE NAME **SYSUT3.T    @ZA00101 11430002
         BAL   DBCOMPR,CALLDAD         ALLOCATE **SYSUT3       @ZA00101 11460002
         SR    R15,R6                  CHECK RETURN CODE       @ZA00101 11490002
         BM    DAD3                    GOOD ALLOCATE           @ZA00101 11520002
         MVC   IEHMVV39+7(1),XFF       INDICATE **SYSUT3 NOT   @ZA00101 11550002
*                                      ALLOCATED               @ZA00101 11580002
         B     NOFIND                  AND ABORT               @ZA00101 11610002
DAD3     DS    0H                                              @ZA00101 11640002
         MVC   TTRSAVE+6(3),IEHMVV00+53    SAVE TTR FOR OPEN     S21042 11710021
         B     CALLDAD1                                                 11720000
CALLDAD  DS    0H                                                       11740000
         LA    R1,IEHMVV31                                              11760000
         L     R0,IEHMVV31+4                                            11780000
         SVC   32                       CALL DADSM                      11800000
         LA    DADR1,4                  TEST RETURNS FROM DADSM         11820000
         SLL   R15,8                    CLEAR LEFTMOST BYTE OF REG 15   11840000
         SRL   R15,8                                                    11860000
         B     0(DBCOMPR)              RETURN TO CALLER          S21042 11880021
*                                                                       11940000
*                             ASSEMBLER DC STATEMENTS                   11960000
*                                                                       11980000
ACON     DC    A(IEHMVESE-IEHMVXSE)     USED TO SET UP ADDRESSABILITY   12000000
*                                       FOR ALTERNATE ENTRY,IEHMVESE    12020000
ECKEY    DC    C'POWER='                                                12040000
LINECNT  DC    CL8'LINECNT='            USED FOR PAGE CONTROL           12060000
DSIX     DC    H'06'                                                    12080000
DEVSAVE  DS    6F                       REGISTER SAVE AREA              12100000
DEVCHAR  DS    5F                      DEVICE CHARACTERISTICS AREA      12120000
DW       DS    D                                               @ZA07393 12126004
SAVEREG1 DS    F                                               @ZA07393 12132004
*                             FOLLOWING ARE THE DDNAMES NORMALLY USED   12140000
*                             BY THE MOVE/COPY PROGRAM                  12160000
DDNAMES  DC    CL8'SYSIN'                                               12180000
         DC    CL8'SYSPRINT'                                            12200000
         DC    CL8'SYSUT1.T'                                   @ZA00101 12220002
TTRSAVE  DS    9X    DSCBTTR SAVE AREA FOR SYSUT WORKFILES       S21042 12270021
ASTRISK  DC    C'**'                                                    12280000
DV       DS    F                                               @ZA00101 12285002
FOUR     DC    F'4'                                             YA01194 12290016
JFCB1    DS    0F                                                       12300000
JDSNAME  DC    22X'4040'                                                12320000
         DC    8X'40'                                                   12340000
JTSDM    DC    1X'08'                  SUPPRESS OPEN FROM        A23994 12350018
*                                      PUTTING THE JFCB ON THE Q A23994 12360018
         DC    13X'00'                                                  12380000
         DC    1X'00'                                                   12400000
         DC    1X'00'                                          @ZM33040 12420003
         DC    2X'00'                                                   12440000
         DC    2X'00'                                                   12460000
         DC    8X'00'                                                   12480000
         DC    3X'00'                                                   12500000
         DC    3X'00'                                                   12520000
         DC    1X'00'                                                   12540000
         DC    1X'C0'                                                   12560000
         DC    24X'00'                                                  12580000
         DC    4X'00'                                                   12600000
         DC    1X'00'                                                   12620000
         DC    1X'01'                                                   12640000
JVOLSER  DC    30X'00'                                                  12660000
         DC    1X'00'                                                   12680000
         DC    3X'00'                                                   12700000
JPRIQUAN DC    FL3'20'                                                  12720000
JSPACPAR DC    X'88'                                               9754 12740017
         DC    XL3'00'                                                  12760000
         DC    1X'00'                                          @ZM33040 12780003
         DC    3X'00'                                                   12800000
         DC    3X'00'                                                   12820000
         DC    2X'00'                                                   12840000
         DC    3X'00'                                                   12860000
         DC    3X'00'                                                   12880000
         DC    X'00'                                                    12900000
         DC    X'00'                                                    12920000
*                                                                       12940000
*                                                                       12960000
*                             THIS ROUTINE BUILDS UNIQUE DSNAMES        12980000
*                             FOR THE WORK FILES                        13000000
*                                                                     * 13220000
*                                                                     * 13240000
*              THE UNIQUE NAME THAT EACH WORK FILE WAS ALLOCATED      * 13260000
*              WITH IS AGAIN DEVELOPED AND PLUGGED INTO A JFCB        * 13280000
*              AND EACH WORK FILE IS OPENED   USING  OPEN J           * 13300000
*                                                                     * 13320000
*                                                                     * 13340000
CALLDAD1 DS    0H                                                       13360000
         L     R6,IEHMVV40                                              13380000
         L     R7,IEHMVV41                                              13400000
         L     R2,IEHMVV42                                              13420000
         L     DBCOMPR,IEHMVV10         LOAD ADDR OF PERM WORK AREA     13440000
         LA    DBR1,IEHMVV00+176        LOAD ADDR OF WORD PAST JFCB     13460000
         ST    DBR1,IEHMVV00+176        STORE THE ADDR IN THE WORD      13480000
         L     DBR1,IEHMVV40            LOAD ADDR OF SYSUT1 DCB         13500000
         MVC   37(3,DBR1),IEHMVV00+177  MOVE 3 BYTE --ADDR OF DCB EXLST 13520000
         L     DBR1,IEHMVV41           LOAD ADDR SYSUT2 DCB             13540000
         MVC   37(3,DBR1),IEHMVV00+177 MOVE EXLIST PTR TO UT2  DCB      13560000
         L     DBR1,IEHMVV42           LOAD ADDR OF SYSUT3 DCB          13580000
         MVC   37(3,DBR1),IEHMVV00+177 MOVE EXLST PTR INTO UT3 DCB      13600000
         LA    DBR1,IEHMVV00            LOAD ADDR OF JFCB FOR OPEN J    13620000
         ST    DBR1,IEHMVV00+176        STORE ADDR IN EXIT LIST         13640000
         MVI   IEHMVV00+176,X'87'       SET CODE IN LEFT BYTE OF EXLST  13660000
         MVC   IEHMVV00(2),ASTRISK      MOVE DSNAME PROTECTION ASTRISK  13680000
         MVI   IEHMVV00+7,X'F1'        MAKE NAME **SYSUT1.T    @ZA00101 13700002
         MVC   0(RENT3-RENT2,DBCOMPR),RENT2 MOVE OPEN TO WORK AREA      13780000
         MVC   IEHMVV00+53(3),TTRSAVE  DSCBTTR IN JFCB FOR OPEN  S21042 13790021
         BALR  R10,DBCOMPR             BRANCH TO OPEN DCB               13800000
         XC    37(3,R6),37(R6)       CLEAR SYSUT1 DCB EXITLIST @ZA07360 13810004
         MVI   IEHMVV00+7,X'F2'        MAKE NAME **SYSUT2.T    @ZA00101 13820002
         MVC   0(RENT4-RENT3,DBCOMPR),RENT3 MOVE OPEN TO WORK AREA      13900000
         MVC   IEHMVV00+53(3),TTRSAVE+3 DSCBTTR IN JFCB FOR OPEN S21042 13910021
         BALR  R10,DBCOMPR              BRAMCH TO OPEN DCB              13920000
         XC    37(3,R7),37(R7)       CLEAR SYSUT2 DCB EXITLIST @ZA07360 13930004
         MVI   IEHMVV00+7,X'F3'        MAKE NAME **SYSUT3.T    @ZA00101 13940002
         MVC   0(RENT5-RENT4,DBCOMPR),RENT4 MOVE OPEN TO WORK AREA      14020000
         MVC   IEHMVV00+53(3),TTRSAVE+6 DSCBTTR IN JFCB FOR OPEN S21042 14030021
         BALR  R10,DBCOMPR              BRAMCH TO OPEN DCB              14040000
         XC    37(3,R2),37(R2)       CLEAR SYSUT3 DCB EXITLIST @ZA07360 14050004
         XC    IEHMVV00(200),IEHMVV00   CLEAR VOLITAL WORK AREA         14060000
         XC    0(100,DBCOMPR),0(DBCOMPR) CLEAR THE PERM WORK AREA       14080000
         MVI   XSEENTRY,ZERO            RESET REENTRY SWITCH            14100000
*                                                                     * 14120000
*                                                                     * 14140000
*              AT THIS POINT CONTROL IS TRANSFERD TO THE IEHMOVE      * 14160000
*              REQUEST ANALIZER ROUTINES   THE FIRST MODULE IS        * 14180000
*              IEHMVSST                                               * 14200000
*                                                                     * 14220000
*                                                                     * 14240000
      IEHPOST (14),T                                                    14260000
         L     R14,12(R0,R13)                                           14280000
         XCTL  (2,12),EP=IEHMVEST                                       14300000
NOFIND   LA    R2,16                    CAUSE RENTRY TO ESK             14320000
         LA    R3,16                    MESSAGE NUMBER                  14340000
         B     ESAEXIT                                                  14360000
RENT1    DS    0F                                                       14380000
         DROP  BASE                                                     14400000
         USING *,DBCOMPR                                                14420000
         OPEN  ((DBR1),INPUT,(DBR3),OUTPUT)                             14440000
         BR    R10                      RETURN TO MAIN FLOW             14460000
         DROP  DBCOMPR                                                  14480000
         USING IEHMVXSE,BASE                                            14500000
RENT2    DS    0F                                                       14520000
         DROP  BASE                                                     14540000
         USING *,DBCOMPR                                                14560000
         OPEN  ((R6),OUTIN),TYPE=J                                      14580000
         BR    R10                      RETURN TO MAIN FLOW             14600000
         DROP  DBCOMPR                                                  14620000
         USING IEHMVXSE,BASE                                            14640000
RENT3    DS    0F                                                       14660000
         DROP  BASE                                                     14680000
         USING *,DBCOMPR                                                14700000
         OPEN  ((R7),OUTIN),TYPE=J                                      14720000
         BR    R10                      RETURN TO MAIN FLOW             14740000
         DROP  DBCOMPR                                                  14760000
         USING IEHMVXSE,BASE                                            14780000
RENT4    DS    0F                                                       14800000
         DROP  BASE                                                     14820000
         USING *,DBCOMPR                                                14840000
         OPEN  ((R2),OUTIN),TYPE=J                                      14860000
         BR    R10                      RETURN TO MAIN FLOW             14880000
         DROP  DBCOMPR                                                  14900000
         USING IEHMVXSE,BASE                                            14920000
RENT5    DS    0F                                                       14940000
*                             THIS ROUTINE IS USED TO CLEAR 2000 BYTES  14960000
*                             OF THE MOVE/COPY COMMUNICATION REGION     14980000
*                                                                       15000000
CLEAR    LTR   R0,R0                    IS LENGTH ZERO?                 15020000
         BE    0(R0,R14)                YES.RETURN TO MAIN FLOW         15040000
         MVI   0(R1),ZERO               SET PROPAGATION BYTE            15060000
         BCTR  R0,R0                                                    15080000
         LTR   R0,R0                    IS LENGTH ZERO?                 15100000
         BE    0(R0,R14)                YES.RETURN TO MAIN FLOW         15120000
         LA    R15,255                  PUT MAXIMUM PROPAGATION         15140000
*                                       FACTOR IN REG 15                15160000
CLEAR3   CLR   R0,R15                   IS MAXIMUM LARGER THAN LENGTH   15180000
*                                       TO BE CLEARED?                  15200000
         BNH   CLEAR2                   YES                             15220000
         EX    R15,CLEAR1               EXECUTE MOVE INSTRUCTION,       15240000
         SR    R0,R15                   REDUCT LENGTH TO BE CLEARED,    15260000
         AR    R1,R15                   ADJUST POINTER TO NEXT AREA AND 15280000
         B     CLEAR3                   LOOP BACK TO EXECUTE MOVE AGAIN 15300000
CLEAR2   LTR   R0,R0                                                    15320000
         BE    0(R0,R14)                IF FINISHED RETURN              15340000
         XR    R15,R0                                                   15360000
         XR    R0,R15                                                   15380000
         XR    R15,R0                   OTHERWISE, CLEAR REMAINING      15400000
         EX    R15,CLEAR1               AREA AND RETURN                 15420000
         BR    R14                                                      15440000
CLEAR1   MVC   1(1,R1),0(R1)                                            15460000
         DS    0F                                                A48763 15480022
H37      DC    XL2'13'                 NMBR OF '.*'              A44310 15500021
SE       DC    C'SE'                                                    15520000
MINUS    DC    X'80000000'                                              15540000
H256     DC    H'256'                                            A48763 15540422
FOXES    DC    X'0000FFFF'              ZERO LEFT HALF         @ZM30153 15540803
SYSDCB   DS    0F                                                  BS0H 15542017
         DC    X'85'                   SYSIN DCB EXIT              BS0H 15544017
         DC    AL3(EXITSYS)                                        BS0H 15546017
DCBPRT   DS    0F                                                  BS0H 15548017
         DC    X'85'                   DCB EXIT FOR SYSPTINT       BS0H 15550017
         DC    AL3(DCBPRTS)                                        BS0H 15552017
DISP1    DC    A(LOC1-DCB1)                                             15560000
DISP2    DC    A(LOC2-DCB2)                                             15580000
DISP3    DC    A(LOC3-DCB3)                                             15600000
DISP4    DC    A(LOC4-DCB4)                                             15620000
DISP5    DC    A(LOC5-DCB5)                                             15640000
LOC1     DS    0F                                                       15660000
DCB1     DCB   DSORG=PS,                                               C15680000
               MACRF=(GM),                                             C15700000
               RECFM=FB,                                               C15720000
               LRECL=80,                                               C15740000
               EXLST=SYSDCB,                                       BS0HC15770017
               BUFNO=1,                                                C15800000
               DDNAME=SYSIN                                             15820000
LOC2     DS    0F                                                       15840000
DCB2     DCB   DDNAME=SYSPRINT,                                        C15860000
               DSORG=PS,                                               C15880000
               RECFM=FBA,                                              C15900000
               LRECL=121,                                              C15920000
               EXLST=DCBPRT,                                       BS0HC15950017
               BUFNO=1,                                                C15980000
               MACRF=(PM)                                               16000000
LOC3     DS    0F                                                       16020000
DCB3     DCB   DDNAME=SYSUT1,                                          *16040000
               DSORG=PS,                                               *16060000
               MACRF=(RCP,WCP),                                        X16080000
               DEVD=DA,                                                *16100000
               KEYLEN=12,                                              X16120000
               RECFM=U,                                                C16140000
               BLKSIZE=666,                                            C16160000
               BUFNO=1,                                                *16180000
               NCP=1                                                    16200000
LOC4     DS    0F                                                       16220000
DCB4     DCB   DDNAME=SYSUT1,                                          C16240000
               MACRF=(RCP,WCP),                                        X16260000
               DSORG=PS,                                               X16280000
               DEVD=DA,                                                X16300000
               KEYLEN=8,                                               X16320000
               RECFM=U,                                                C16340000
               BLKSIZE=666,                                            C16360000
               NCP=1                                                    16380000
LOC5     DS    0C                                                       16400000
DCB5     DCB   DDNAME=SYSUT1,                                          C16420000
               MACRF=(RCP,WCP),                                        C16440000
               DSORG=PS,                                               X16460000
               DEVD=DA,                                                X16480000
               KEYLEN=4,                                               X16500000
               RECFM=U,                                                X16520000
               BLKSIZE=87,                                             C16540000
               NCP=1                                                    16560000
LOC6     DS    0C                                                       16580000
PRNTAREA DC    15XL8'0'                                                 16600000
XFF      DC    XL3'FFFFFF'                                       A37897 16610021
ECDSECT  DSECT                                                          16620000
ECSAVE   DS    6F                      SAVE AREA FOR 2-7                16640000
         DS    D                                                        16660000
ECDBL    DS    D                       DBL WORD WORK AREA               16680000
         IEHMVV                                                         16700000
XSEENTRY EQU   IEHMVV27+4                                               16720000
         END                                                            16740000
