 TITLE  'IEHPROG2-IEHPROGM ISSUE SVC, ANALYZE RETURN'             11482 00020002
**********************************************************************  00040002
*                                                                     * 00060002
* MODULE NAME -- IEHPROG2                                      YL026VC* 00070002
*                                                              YL026VC* 00072002
* DESCRIPTIVE NAME -- IEHPROGM ISSUE SVC, ANALYZE RETURN       YL026VC* 00074002
*                                                              YL026VC* 00076002
* COPYRIGHT -- NONE                                            YL026VC* 00078002
*                                                              YL026VC* 00078402
* STATUS -- 'IEHPROG2' OS/VS2 PROLOGUE MODIFICATION            YL026VC* 00080002
*    NOVEMBER 1972                                             YL026VC* 00100002
*                                                              YL026VC* 00110002
* FUNCTION -- THIS MODULE ISSUES ALL THE SVC'S FOR THE IEHPROGM       * 00120002
*    PROGRAM.  IT IS THE INTERFACING MODULE TO THE DATA MANAGEMENT    * 00140002
*    FUNCTIONS:                                                       * 00160002
*                                                                     * 00180002
*    SCRATCH                                                          * 00340002
*    RENAME                                                           * 00380002
*    ADD                                                              * 00400002
*    DELETEP                                                          * 00420002
*    REPLACE                                                          * 00440002
*    LIST                                                             * 00460002
*    IT ALSO CHECKS ALL OF THE RETURN CODES FROM THE ABOVE            * 00480002
*    INTERFACES AND INITIATES ERROR OR DIAGNOSTIC MESSAGES            * 00500002
*    WHERE APPLICABLE.                                                * 00520002
*                                                                     * 00540002
* ENTRY POINTS --                                                     * 00560002
*         IEHPROG2 IS THE INITIAL ENTRY POINT OF THE MODULE           * 00580002
*    'IEHPROG2' AND IS ENTERED FROM THE MODULE 'IEHPROG5' IF ALL      * 00600002
*    VOLUME MOUNTING WAS RESOLVED NORMALLY.                           * 00620002
*         IEHPROG7 IS A SECONDARY ENTRY POINT TO THE MODULE           * 00640002
*    'IEHPROG2' AND IS USED IF THE VOLUME MOUNTING ROUTINE 'IEHPROG5' * 00660002
*    ENCOUNTERED A PROBLEM.  IT PROVIDES AN IMMEDIATE RETURN TO       * 00680002
*    THE MODULE 'IEHPROG1' TO THE POINT WHERE 'IEHPROG1' CALLED       * 00700002
*    'IEHPROG5'.                                                      * 00720002
*                                                                     * 00740002
* INPUT -- ALL INPUT INFORMATION IS CONTAINED IN THE COMMUNICATIONS   * 00760002
*    AND WORK AREA POINTED TO BY REGISTER 12 AND DESCRIBED BY THE     * 00780002
*    DSECT NAMED DSECT AND BEGINNING IEHECHAR.                        * 00800002
*                                                                     * 00820002
* OUTPUT -- THIS MODULE INITIATES THE OUTPUT OF ERROR AND             * 00840002
*    DIAGNOSTIC MESSAGES BY CALLING 'IEHPROG3'.  OTHER OUTPUT         * 00860002
*    IS THE RETURN CODE INFORMATION PASSED BACK FROM THE SVC          * 00880002
*    ROUTINES.                                                        * 00900002
*                                                                     * 00920002
* EXTERNAL REFERENCES --                                              * 00940002
*         IEHPROG3 IS CALLED UPON TO PRINT ANY ERROR OR DIAGNOSTIC    * 00960002
*    MESSAGES NECESSARY.                                              * 00980002
*         IEHPROG1 IS THE RETURN POINT FOR BOTH NORMAL AND ERROR      * 01000002
*    CONDITION RETURNS FROM THE MODULE 'IEHPROG2'.                    * 01020002
*         IEHPROG5 CALLS THIS MODULE AFTER IT HAS PROCESSED THE       * 01040002
*    VOLUME MOUNTING INFORMATION.                                     * 01060002
*                                                                     * 01080002
* EXITS, NORMAL -- 'IEHPROG2' RETURNS TO 'IEHPROG1' VIA A BRANCH      * 01100002
*    ON REGISTER 15 WHICH CONTAINS THE ADDRESS OF ENTRY IEHPROG9.     * 01120002
*                                                                     * 01140002
* EXITS,ERROR -- AN ERROR RETURN IS EXECUTED EXACTLY AS A NORMAL      * 01160002
*    EXIT, HOWEVER 'IEHPROG3' WILL HAVE ALREADY BEEN CALLED UPON      * 01180002
*    TO ISSUE ANY MESSAGES NECESSARY TO INDICATE THE ERROR(S).        * 01200002
*                                                                     * 01220002
* TABLES/WORK AREAS--                                                 * 01240002
*    DSECT IS THE COMMON COMMUNICATIONS AND WORK AREA POINTED TO BY   * 01260002
*    REGISTER 12 AND DESCRIBED BY THE DSECT NAMED DSECT AND           * 01280002
*    BEGINNING IEHECHAR.                                              * 01300002
*    BRANTAB IS A BRANCH TABLE USED TO CONTROL PROGRAM FLOW BY        * 01320002
*    INTERPRETING THE RETURN CODES FROM THE DATA MANAGEMENT           * 01340002
*    ROUTINES.                                                        * 01360002
*    LISTS OF 'DC'S STARTING AT MEMBER WHICH ACT AS A CONTROL         * 01380002
*    FOR BUILDING THE APPROPRIATE MESSAGES.                           * 01400002
*                                                                     * 01420002
* ATTRIBUTES -- THIS MODULE OPERATES AS ONE LEG OF AN OVERLAY         * 01440002
*    STRUCTURE.                                                       * 01460002
*                                                                     * 01480002
* CHARACTER CODE DEPENDENCY -- THIS MODULE MUST BE ASSEMBLED IN       * 01500002
*    EBCDIC AND RUN IN EBCDIC TO INSURE COLLATING SEQUENCE AND        * 01520002
*    INTERNAL REPRESENTATION OF CERTAIN CHARACTERS.                   * 01540002
*                                                                     * 01560002
* NOTES -- APPROXIMATELY 4000 BYTES OF STORAGE ARE NEEDED     @Z40RSDS* 01580008
*    FOR CODE.                                                @Z40RSDS* 01590008
*                                                                     * 01600002
* CHANGE ACTIVITY -- FOLLOWS PROLOGUE                          YL026VC* 01610002
*                                                              YL026VC* 01612002
*********************************************************************** 01620002
         EJECT                                                          01640002
IEHPROG2 CSECT                                                    M2838 01660002
*            VS2 SU32 DELETIONS                                @G32DSFS 01664032
*D041942-041944,194610-194710,239520,241850-242700,            @G32DSFS 01668032
*D253970-254070                                                @G32DSFS 01672032
*                                                              @G32DSFS 01676032
*A195240                                                         YM5077 01680002
*A140320,168300-168799,C55000,57800                              A57261 01700002
*A72570,88385-88530,C177000                                      YM5076 01720002
*C1800-13000                                                      M2838 01740002
*A120000-120100,123810-123910                                    A50977 01760002
*                                                                  I276 01780002
*2764                                                              BS0H 01800002
*2764                                                              3520 01820002
*2359                                                              DT0I 01840002
*2359117420                                                        WG0I 01860002
*                                                                  M737 01880002
*                                                                M2422  01900002
*                                                                A25564 01920002
*                                                                A28547 01940002
*                                                                A29705 01960002
*A700-784,1100,16100-16200                                      YL026VC 01970002
*C800-1000                                                      YL026VC 01972002
*D200-320,360                                                   YL026VC 01974002
*A 030602-030604                                                YA01695 01976002
*C 031300,041560                                                YA01695 01978002
*A90420-90500                                                   YM07026 01978402
*C106800                                                        YM07026 01978802
*A123995,124145                                                 YM04431 01979202
*C086800-087000,090420-090500,106800,115800,121600-121800,     @VS30028 01979303
*C122800-123200,124175-125000,176200,236200,239200-239600,     @VS30028 01979403
*C240800-241200,241800-242600,249600,251800,311200,311800      @VS30028 01979603
*C015800,176400-176600,239520,241840-241860,254000,254600,     @Z40RSDS 01979808
*C311450,311530,311560,311800                                  @Z40RSDS 01979908
*C114200                                                       @Z30AAAG 01980603
*D115000                                                       @Z30AAAG 01981603
*A114210,810,820                                               @Z30AAAG 01982603
*C128160                                                       @ZM30018 01992603
*D123995                                                       @ZM30018 01994603
*A123995,123999,124045                                         @ZM32753 01996603
*A 219900                                                      @ZA01695 01996808
*A 114100,114804,115700,117201-117345                          @ZA06552 01996908
*A123600-124100,121820-121840                                  @Z40CSJH 01998808
*D 120000,120200                                               @ZA07322 01998908
*C139000,141000,143000,145000                                  @Z40CSJH 02000808
*C147000,149000,152200,259400                                  @Z40CSJH 02000908
*A 044300,044520,047100-047140,223300,223320                   @ZA13801 02002008
*A 226900-226992,312740                                        @ZA13801 02003008
*C 044600,223200,223600                                        @ZA13801 02004008
*D 312400,312600                                               @ZA13801 02005008
*                   *****     REGISTER  USAGE     *****                 02006008
ZERO     EQU   0        ----------------------------------------        02010008
R0       EQU   0                       EQUATE FOR REGISTER 0   @VS30028 02015008
R1       EQU   12                                                       02020002
R2       EQU   2                                                        02040002
R3       EQU   3             REGISTERS ZERO THROUGH                     02060002
R4       EQU   4             TEN ARE WORK REGISTERS                     02080002
R5       EQU   5                                                        02100002
R6       EQU   6             REGESTERS ELEVEN AND                       02120002
S        EQU   6                                                   WG0I 02140002
R7       EQU   7             TWELVE ARE BASE REGISTERS                  02160002
R8       EQU   8             FOR THE PROGRAN AND THE                    02180002
R        EQU   8                                                   WG0I 02200002
R9       EQU   9             DUMMY SECTION RESPECTIVELY                 02220002
R10      EQU   10                                                       02240002
RB       EQU   11            THIRTEEN POINTS TO A REGISTER              02260002
RBD      EQU   12                                                       02280002
SAVEREG  EQU   13            SAVE AREA                                  02300002
RETURN   EQU   14                                                       02320002
LINKREG  EQU   15            FIFTEEN AND FOURTEEN ARE LINK              02340002
PARAMREG EQU   0             AND RETURN REGISTERS RESPECTIVELY          02360002
LISTREG  EQU   1        -----------------------------------------       02380002
FOUR     EQU   4                  DECREMENT FOR TABLE            S21046 02400002
EIGHT    EQU   8                  CONDITION CODE OF 8            S21046 02420002
CODE12   EQU   12                 RETURN CODE OF 12              S21046 02440002
CODE16   EQU   16                 RETURN CODE OF 16              S21046 02460002
LISTMASK EQU   X'04'              LIST OPERATION MASK            S21046 02480002
WTORMASK EQU   X'10'              MASK FOR WTOR                  S21046 02500002
PW2MASK  EQU   X'04'              CHECKS FOR PASWORD2            S21046 02520002
PW1MASK  EQU   X'20'              CHECKS FOR PASWORD1            S21046 02540002
CONTROL  EQU   X'80'              CHECK FOR CONTROL PASSWORD     S21046 02560002
RW       EQU   X'01'              CHECK FOR READ/WRITE PROTECTIONS21046 02580002
FIXBYTE  EQU   X'F0'              FIX HIGH ORDER BYTE AFTER      S21046 02600002
*                                 UNPACK OPERATION               S21046 02620002
PROMASK  EQU   X'FF'              PROTECT INDICATION MASK        S21046 02640002
RTNREG   EQU   15                 RETURN CODE REGISTER           S21046 02660002
MSG60    EQU   60                 PRINT MESSAGE 60               S21046 02680002
*                                 MPDS DOES NOT EXIST            S21046 02700002
MSG61    EQU   61                 PRINT MESSAGE 61               S21046 02720002
*                                 TAPE DATA SET NOT PROTECTED    S21046 02740002
MSG62    EQU   62                 PRINT MESSAGE 62               S21046 02760002
*                                 DUPLICATE ENTRIES IN MPDS      S21046 02780002
MSG63    EQU   63                 PRINT MESSAGE 63               S21046 02800002
*                                 FIVE INVALID PASSWORDS         S21046 02820002
MSG64    EQU   64                 PRINT MESSGE 64                S21046 02840002
*                                 DSCB NOT UPDATED               S21046 02860002
MSG65    EQU   65                 PRINT MESSGE 65                S21046 02880002
*                                 I/O ERROR IN MPDS              S21046 02900002
MSG66    EQU   66                 PRINT MESSGE 66                S21046 02920002
*                                 MPDS FULL                      S21046 02940002
MOVE1    EQU   1                  MOVE CALL CODE                 S21046 02960002
MOVE2    EQU   2                  MOVE 2 CHAR. FOR UNPACK        S21046 02980002
MOVE3    EQU   3                  FOR UNPACK AND ADDR MOVES      S21046 03000002
MOVE4    EQU   4                  MOVE FOUR CHARACTERS           S21046 03020002
MOVE6    EQU   6                  MOVE ACCESS COUNT              S21046 03040002
MOVE8    EQU   8                  MOVE PASSWORDS, AND JOB, STEP, S21046 03060002
*                                 AND CARD NAMES                 S21046 03080002
MOVE9    EQU   9                  MOVE READ ONLY                 S21046 03100002
MOVE10   EQU   10                 MOVE READ/WRITE                S21046 03120002
MOVE12   EQU   12                 MOVE TYPE OF PASSWORD          S21046 03140002
MOVE19   EQU   19                 MOVE DATA FIELD HEADER         S21046 03160002
MOVE21   EQU   21                 MOVE MODE BYTE HEADER          S21046 03180002
MOVE24   EQU   24                 MOVE ACCESS COUNT HEADER       S21046 03200002
MOVE27   EQU   27                 MOVE MODE BYTE HEADER          S21046 03220002
MOVE36   EQU   36                 MOVE OPERATOR FAILURE MESSAGE  S21046 03240002
MOVE54   EQU   54                 MOVE OBTAIN FAILURE MESSAGE    S21046 03260002
MOVE77   EQU   77                 MOVE DATA FIELD AND LOCATE     S21046 03280002
*                                 FAILURE MESSAGE                S21046 03300002
OFFSET1  EQU   1                  OFFSET TO PW1MASK, UPDATE      S21046 03320002
*                                 POINTER TO TABLE, AND STEP     S21046 03340002
*                                 UP ONE BYTE IN PARAMETER LIST  S21046 03360002
OFFSET2  EQU   2                  OFFSET FOR ERROR CODE IN ERRFLDS21046 03380002
*                                 AND INTO PARMFLD               S21046 03400002
OFFSET3  EQU   3                  OFFSET TO CALL CODE AND OFFSET S21046 03420002
*                                 TO DATA FIELD IN MPDS RECORD   S21046 03440002
OFFSET4  EQU   4                  OFFSET TO ECB IN WTORLIST      S21046 03460002
OFFSET5  EQU   5                  OFFSET TO ACCESS COUNT         S21046 03480002
OFFSET6  EQU   6                  OFFSET TO LOCATE AND OBTAIN    S21046 03500002
*                                 RETURN CODES IN DBLWORD        S21046 03520002
OFFSET8  EQU   8                  OFFSET TO STEPNAME, AND        S21046 03540002
*                                 PARAM3 IN IEHEMAC1             S21046 03560002
OFFSET12 EQU   12                 OFFSET TO PARAM5 IN IEHEMAC1   S21046 03580002
*                                 FOR CPASWORD                   S21046 03600002
OFFSET16 EQU   16                 OFFSET INTO TIOT FOR STEPNAME  S21046 03620002
OFFSET19 EQU   19                 OFFSET FOR DATA IN MESSAGE     S21046 03640002
OFFSET20 EQU   20                 OFFSET INTO WTORLIST FOR       S21046 03660002
*                                 JOBNAME                        S21046 03680002
OFFSET21 EQU   21                 OFFSET INTO IEHEMAC1 FOR       S21046 03700002
*                                 PASSWORD ADDRESS               S21046 03720002
OFFSET24 EQU   24                 OFFSET TO ACCESS COUNT IN MSG  S21046 03740002
OFFSET27 EQU   27                 OFFSET INTO MSG TO PROTECT     S21046 03760002
*                                 MODE BYTE                      S21046 03780002
OFFSET29 EQU   29                 OFFSET TO FIX HIGH ORDER BYTE  S21046 03800002
*                                 OF PROTECT MODE                S21046 03820002
OFFSET30 EQU   30                 OFFSET INTO WTORLIST OF STEP   S21046 03840002
*                                 NAME                           S21046 03860002
OFFSET33 EQU   33                  OFFSET FOR PROTECT TYPE       S21046 03880002
OFFSET36 EQU   36                 OFFSET INTO MSG FOR PASSWORD   S21046 03900002
OFFSET40 EQU   40                 OFFSET INTO WTORLIST FOR CARD  S21046 03920002
*                                 NAME                           S21046 03940002
OFFSET51 EQU   51                 OFFSET TO LOCATE RETURN CODE   S21046 03960002
*                                 IN MESSAGE                     S21046 03980002
OFFSET52 EQU   52                 OFFSET TO HIGH ORDER BYTE      S21046 04000002
OFFSET61 EQU   61                 OFFSET INTO WTORLIST FOR       S21046 04020002
*                                 PASSWORD                       S21046 04040002
OFFSET74 EQU   74                 OFFSET INTO MSG FOR INDICES    S21046 04060002
OFFSET75 EQU   75                 OFFSET TO HIGH ORDER BYTE      S21046 04080002
OFFSET80 EQU   80                 OFFSET TO LOCATE CODES         A31333 04100002
ZERO4    EQU   4                  ZERO OUT FOUR BYTES OF IEHEMAC1S21046 04120002
DNWBBIT  EQU   X'08'              TURN ON THE DO NOT WRITE BACK  A38610 04140002
*                                 BIT IN THE JFCB                A38610 04160002
DWOFFSET EQU   52                 OFFSET TO DON'T WRITE BACK BIT A38610 04180002
CODEA    EQU   X'0A'              RENAME ERROR HANDLER RETURN  @VS30028X04182003
                                  CODE CORRESPONDING TO STOW   @VS30028X04184003
                                  ERROR X'14' (DCB NOT OPEN)   @VS30028 04186003
STATUS   EQU   13                 OFFSET TO STATUS CODE BYTE   @VS30028X04188003
                                  IN SCRATCH/RENAME VOL LIST   @VS30028 04188403
PSWDERR  EQU   X'02'              SCRATCH/RENAME PASSWORD ERR  @VS30028 04190003
IOERROR  EQU   X'04'              SCRATCH/RENAME I/O ERROR     @VS30028 04192003
OPENDS   EQU   X'07'              SCRATCH/RENAME OPEN D/S ERR  @VS30028 04194003
SCRMASK  EQU   X'40'              SCRATCH OPTION BYTE 2 MASK   @Z40RSDS 04195008
*                                                                       04200002
*                   *****     SWITCH USAGE        *****                 04220002
NDSWMSK  EQU   128       END SWITCH  BIT POS ZERO  SWITCH 1             04240002
COMMENTS EQU   64                                                       04260002
CONTINUE EQU   32                                                       04280002
FIRSTONE EQU   16                                                       04300002
BIGSHIFT EQU   8                                                        04320002
SHIFTLOC EQU   4                                                        04340002
VOLSW    EQU   2                                                        04360002
         SAVE  (14,12)            SAVE OLD REGS                   M2838 04380002
         BALR  R10,0                                                    04400002
         USING *,R10                                                    04420002
         L     RB,SCNDBASE                                     @ZA13801 04430008
         L     R10,CSECT2AD                                             04440002
         AR    RB,R10                                          @ZA13801 04450008
         USING IEHPROG2,R10,RB    ESTABLISH ADDRESSABILITY     @ZA13801 04460008
         USING IEHECHAR,RBD                                             04480002
         ST    SAVEREG,SAVEREG2+4 KEEP OLD SAVE REG               M2838 04500002
         LA    SAVEREG,SAVEREG2   ESTABLISH NEW SAVE AREA         M2838 04520002
         L     R3,DECB2                 GET ADDRESS OF ADCONS           04540002
         L     R3,24(R3)                GET RETURN ADDRESS              04560002
         ST    R3,DECB2+4               POST IT                         04580002
         SR    R3,R3                                                    04600002
         IC    R3,FINUSE+3        GET NUMBER OF REQUIRED TABLE          04620002
         SLL   R3,2                                                     04640002
         EX    0,LATAB-4(R3)      GET ADDRESS OF THE TABLE              04660002
         ST    R3,FINUSE                                                04680002
         B     FDLD                    TABLE NUMBER                     04700002
SCNDBASE DC    F'4096'               CONSTANT FOR SECOND BASE  @ZA13801 04705008
CSECT2AD DC    A(IEHPROG2)           ADDR OF MAIN ENTRY POINT  @ZA13801 04710008
MSGRTNAD DC    V(IEHPROG3)           ADDR OF MESSAGE ROUTINE   @ZA13801 04715008
IEHPROG7 BR    RETURN             RETURN TO POINT OF CALL         M2838 04720002
         ENTRY IEHPROG7                                           M2838 04740002
*   THE FOLLOWING INSTRUCTIONS LOAD THE ADDRESS OF THE CODE      S21046 04760002
*   TO BE EXECUTED DEPENDING UPON THE OPERATION SCANNED IN THE   S21046 04780002
*   FIRST MODULE. THE NUMBER TO THE RIGHT OF THE INSTRUCTION     S21046 04800002
*   REFERS TO THE CODE THAT CAUSES THAT LA TO BE EXECUTED.       S21046 04820002
*                                                                S21046 04840002
LATAB    LA    R3,CATALOG                    1                          04860002
         LA    R3,UNCATLG                    2                          04880002
         LA    R3,DELETEX                    3                          04900002
         LA    R3,CONNECT                    4                          04920002
         LA    R3,RELEASE                    5                          04940002
         LA    R3,BUILDA                     6                          04960002
         LA    R3,DELETEA                    7                          04980002
         LA    R3,SCRATCH                    8                          05000002
         LA    R3,BUILDX                     9                          05020002
         LA    R3,RENAME                     10                         05040002
         LA    R3,VTOCDCS                    11                         05060002
         LA    R3,BLDG                       12                         05080002
         LA    R3,MEMBER                     13                         05100002
         LA    R3,ADD                        14                  S21046 05120002
         LA    R3,DELETEP                    15                  S21046 05140002
         LA    R3,REPLACE                    16                  S21046 05160002
         LA    R3,LIST                       17                  S21046 05180002
*                                                                       05200002
*                                                                       05220002
ENT2FDLD ST    LISTREG,FINUSE          SAVE ADDRESS OF LIST    @VS30028 05230003
FDLD     L     R9,FINUSE           GET ADDRESS OF LIST IN USE           05240002
         LA    R6,4(R9)                                                 05260002
         ST    R6,FINUSE           UPDATE THE LIST ADDRESS              05280002
         SR    R2,R2                                                    05300002
         IC    R2,0(R9)                                                 05320002
         SLL   R2,2                SELECT THE ROUTINE TO BE PERFORMED   05340002
         LA    RETURN,FDLD              PROVIDE A RETURN                05360002
         EX    0,*+4(R2)           GO THERE                             05380002
*                                                                       05400002
* ONE OF THESE BRANCH INSTRUCTIONS ARE EXECUTED AS DETERMINED FROM      05420002
*        THE FIRST BYTE OF THE  DATA LIST  FOR THE FUNCTION IN USE      05440002
         B     XCONTROL           EXECUTE FOR A ZERO OP                 05460002
         B     *                                                        05480002
         B     *                                                        05500002
         B     *                   B TO *  ONLY TAKE UP SPACE           05520002
         B     LINKSAVE                                                 05540002
         B     DCRETURN                                                 05560002
         B     GETAMSG                                                  05580002
         B     EXECUTE                                                  05600002
         B     CLOSVTOC                                                 05620002
         B     STTRESET                                                 05640002
         B     WTORPAS1           BRANCH TO WTOR FOR PASWORD1    S21046 05660002
         B     WTORPAS2           BRANCH TO WTOR FOR PASWORD2    S21046 05680002
         B     PASSETUP           PUT CALL CODE IN IEHEMAC1      S21046 05700002
         B     LISTPARM           PUT ADDRESS OF RECIEVE AREA    S21046 05720002
FRECOVER MVC   FINUSE(4),FLSTADDR                                       05740002
         B     FDLD                                                     05760002
XCONTROL L     R2,0(R9)                                                 05780002
         BR    R2             GO TO LOCATION IN THE DATA LIST           05800002
LINKSAVE MVC   DCSAVEAD(4),FINUSE       SAVE LIST ADDRESS               05820002
         MVC   FINUSE(4),0(R9)          GET NEW LIST ADDRESS            05840002
         B     FDLD                                                     05860002
DCRETURN MVC   FINUSE(4),DCSAVEAD                                       05880002
         B     FDLD                                                     05900002
GETAMSG  L     PARAMREG,0(R9)                                           05920002
         L     LINKREG,MSGRTNAD                                         05940002
         BR    LINKREG                                                  05960002
PASSETUP XC    IEHEMAC1(ZERO4),IEHEMAC1 ZERO OUT IEHEMAC1        S21046 05980002
         MVC   IEHEMAC1(MOVE1),OFFSET3(R9)  MOVE CALL CODE TO    S21046 06000002
*                                           IEHEMAC1             S21046 06020002
         B     FDLD               GO TO NEXT TABLE ENTRY         S21046 06040002
*                                                                S21046 06060002
*        13 OP PUT ADDRESS OF BUFFER IN THE PARAMETER FOR LIST   S21046 06080002
*                                                                S21046 06100002
LISTPARM LA    R6,PARAM4                LOAD ADDRESS OF BUFFER   S21046 06120002
         ST    R6,DUMMY                 STORE THE ADDRESS        S21046 06140002
         MVC   IEHEMAC1+OFFSET1(MOVE3),DUMMY+OFFSET1             S21046 06160002
*                                       MOVE ADDRESS TO PARAM    S21046 06180002
         B     FDLD                     GO TO NEXT ENTRY IN TAB  S21046 06200002
*                                                                S21046 06220002
*      FIRST PASS FOR WTOR FOR PASWORD1, IF SPECIFIED ON CARD    S21046 06240002
*      MOVE ON IF NOTINITIALIZE TO PROMPT OPERATOR FOR PASWORD1  S21046 06260002
*                                                                S21046 06280002
WTORPAS1 TM    DUPSW+OFFSET1,PW1MASK   WAS PASWORD1 SPECIFIED    S21046 06300002
*                                       ON CARD                  S21046 06320002
         BO    FDLD               THEN DO NOT NEED TO PROMPT     S21046 06340002
         IC    R4,TOTALPS         GET TOTAL WTOR COUNT           S21046 06360002
         LA    R4,OFFSET1(R4)           UP THE COUNT BY 1        S21046 06380002
         STC   R4,TOTALPS         STORE THE NEW COUNT            S21046 06400002
*                                                                S21046 06420002
*      RETURN CODE OF 8 FROM PROTECT. PASWORD1 GIVEN WAS         S21046 06440002
*      INVALID, INITIALIZE FOR WTOR                              S21046 06460002
*                                                                S21046 06480002
RTNCODE8 LA    R2,PARAM3          LOAD ADDRESS FOR PASWORD1      S21046 06500002
         ST    R2,IEHEMAC1+OFFSET8     STORE ADDR IN PARAM LIST  S21046 06520002
         LA    R6,PASWDCT1        LOAD ADDRESS FOR PASWORD1 CNT  S21046 06540002
         LA    R7,MSGE1           ADDRESS OF WTOR MESSAGE        S21046 06560002
         TM    DUPSW+OFFSET1,PW1MASK   WAS PSW SPECIF IN CARD   YA01695 06570002
         BO    BLNKPSWD              YES BRANCH TO MESSAGE      YA01695 06572002
         B     OPSETUP            GO SET UP THE WTOR             S21046 06580002
*                                                                S21046 06600002
*      IF PASWORD2 WAS NOT SPECIFIED ON CARD INITIALIZE FOR WTOR S21046 06620002
*                                                                S21046 06640002
WTORPAS2 TM    DUPSW+OFFSET1,PW2MASK  IS PASWORD2 IN PARAM LIST  S21046 06660002
         BO    FDLD               THEN DO NOT NEED TO PROMPT     S21046 06680002
         LA    R2,PARAM7          LOAD ADDRESS FOR PASWORD2      S21046 06700002
         ST    R2,DUMMY           STORE ADDRESS TO BE MOVED      S21046 06720002
         MVC   IEHEMAC1+OFFSET21(MOVE3),DUMMY+OFFSET1            S21046 06740002
*                                 MOVE THE ADDRESS TO PARM       S21046 06760002
         LA    R7,MSGE2           ADDRESS OF WTOR MESSAGE        S21046 06780002
         B     WRITE              GO WRITE TO OPERATOR           S21046 06800002
*                                                                S21046 06820002
*      EITHER CPASWORD WAS NOT SPECIFIED ON CARD OR IT WAS       S21046 06840002
*      INVALID, INITIALIZE FOR WTOR                              S21046 06860002
*                                                                S21046 06880002
RTNCOD12 LA    R2,PARAM5          LOAD ADDRESS FOR CPASWORD      S21046 06900002
         ST    R2,IEHEMAC1+OFFSET12 STORE ADDRESS IN PARM LIST   S21046 06920002
         LA    R6,PASWDCT3        LOAD ADDRESS OF CPASWORD CNT   S21046 06940002
         LA    R7,MSGE3           ADDRESS OF WTOR MESSAGE        S21046 06960002
*                                                                S21046 06980002
*      RETRIEVE THE COUNTER FOR THE PASSWORD TO BE PROMPTED FOR  S21046 07000002
*                                                                S21046 07020002
OPSETUP  SR    R3,R3              ZERO OUT REG 3                 S21046 07040002
         IC    R3,ZERO(R6)        GET THE COUNTER TO BE UPDATED  S21046 07060002
         BCT   R3,GOWTOR          UPDATE COUNTER BRANCH NOT 0    S21046 07080002
*                                                                S21046 07100002
*      IF THE OPERATOR DID NOT SUPPLY A PASSWORD OR IF THE       S21046 07120002
*      NUMBER OF ATTEMPTS FOR A PARTICULAR PASSWORD EXCEEDED THE S21046 07140002
*      MAXIMUM PERMISSIBLE INITIALIZE TO PRINT ERROR MESSAGE     S21046 07160002
*                                                                S21046 07180002
BLNKPSWD EQU   *                  OPERATOR DID NOT SUPPLY A      S21046 07200002
*                                 PASSWORD                       S21046 07220002
         MVC   MSGOUT(MOVE36),OPFAIL MOVE FIRST PART OF MSG      S21046 07240002
         MVC   MSGOUT+OFFSET16(MOVE8),ZERO(R7)                  YA01695 07250002
*                                 WHICH PASSWORD TO MSG AREA     S21046 07280002
         SR    PARAMREG,PARAMREG  ZERO REG 0                     S21046 07300002
         B     MSGRTN             WRITE MSG FOR OPERATOR FAILURE S21046 07320002
*                                                                S21046 07340002
*      IF MORE THAN FIVE INVALID PASSWORDS WRER GIVEN IN THIS    S21046 07360002
*      JOB INITIALIZE TO PRINT ERROR MESSAGE AND TERMINATE       S21046 07380002
*                                                                S21046 07400002
GOWTOR   STC   R3,ZERO(R6)        STORE THE UPDATED COUNTER      S21046 07420002
         IC    R3,TOTALPS         UPDATE TOTAL WTOR COUNT        S21046 07440002
         BCT   R3,NXTWTOR         HAS COUNTER REACHED ZERO       S21046 07460002
         LA    PARAMREG,MSG63     MESSAGE 63 FOR TOO AMNY        S21046 07480002
         MVI   ERRFLD+OFFSET2,CODE16 OPERATOR FAILED MAX TIMES   S21046 07500002
         B     MSGRTN             PRINT MESSAGE                  S21046 07520002
*                                                                S21046 07540002
*      STORE UPDATED TOTAL WTOR COUNT, CHECK TO SEE IF           S21046 07560002
*      LIST FORM OF WTOR HAS BEEN MOVED, INITIALIZE FOR AND ISSUES21046 07580002
*      PROTECT MACRO                                             S21046 07600002
*                                                                S21046 07620002
NXTWTOR  STC   R3,TOTALPS         NO STORE NEW COUNT             S21046 07640002
WRITE    TM    IEHESW2,WTORMASK   IS WTOR LIST MOVED             S21046 07660002
         BC    EIGHT,WTORINIT     GO MOVE WTOR LIST              S21046 07680002
WTORFNSH MVC   ZERO(MOVE8,R2),UPPERFLD                           S21046 07700002
*                                 BLANK OUT OPERATOR REPLY FIELD S21046 07720002
         MVC   WTORLIST+OFFSET61(MOVE8),ZERO(R7)                 S21046 07740002
*                                 MOVE THE PROPER PASSWORD       S21046 07760002
         MVC   WTORLIST+OFFSET40(MOVE8),CCNAME                   S21046 07780002
*                                 MOVE CONTROL CARD NAME         S21046 07800002
         MVI   WTORECB,ZERO       ZERO OUT ECB                   S21046 07820002
         WTOR  ,(R2),8,WTORECB,MF=(E,WTORLIST)                   S21046 07840002
         WAIT  ECB=WTORECB        WAIT FOR OPERATOR RESPONSE     S21046 07860002
         CLC   ZERO(MOVE8,R2),UPPERFLD                           S21046 07880002
*                                 DID OPERATOR REPLY WITH BLANKS S21046 07900002
         BE    BLNKPSWD           IF SO PRINT MESSAGE            S21046 07920002
         OC    ZERO(MOVE8,R2),UPPERFLD FOLD ALL OF REPLY TO CAPS S21046 07940002
         B     FDLD               GO TO NEXT ENTRY IN TABLE      S21046 07960002
*                                                                S21046 07980002
*      MOVE IN THE LIST FORM OF WTOR AND GET THE JOBNAME AND     S21046 08000002
*      STEPNAME WITH THE EXTRACT MACRO                           S21046 08020002
*                                                                S21046 08040002
WTORINIT MVC   WTORLIST(WTORSTOP-WTORLFRM),WTORLFRM              S21046 08060002
*                                 MOVE THE LIST FOR WTOR         S21046 08080002
         LA    R3,WTORECB         LOAD ADDRESS OF ECB FOR WTOR   S21046 08100002
         ST    R3,WTORLIST+OFFSET4 STORE THE ADDRESS OF THE ECB  S21046 08120002
         MVC   EXTRACTO(EXSTP-EXTRACT1),EXTRACT1                 S21046 08140002
         LA    R8,TIOTADRS        ADDRESS TO RETURN TIOT ADDRESS S21046 08160002
*  MOVE THE EXTRACT PARAMETER LIST TO GET MAIN AREA              S21046 08180002
         EXTRACT (8),'S',FIELDS=(TIOT),MF=(E,EXTRACTO)           S21046 08200002
*   GET ADDRESS OF TIOT TO GET JOBNAME AND STEP NAME             S21046 08220002
         L     R8,TIOTADRS        GET ADDRESS OF TIOT            S21046 08240002
         CLC   UPPERFLD(MOVE8),OFFSET16(R8)                      S21046 08260002
*                                 IS THIS A PROCEDURE            S21046 08280002
         BE    ALLBLANK           NO  BRANCH                     S21046 08300002
         MVC   WTORLIST+OFFSET30(MOVE8),OFFSET16(R8)             S21046 08320002
*                                 MOVE THE STEP NAME FOR THE JOB S21046 08340002
         B     MVCMSG             SET UP REST OF MESSAGE         S21046 08360002
ALLBLANK MVC   WTORLIST+OFFSET30(MOVE8),OFFSET8(R8)              S21046 08380002
*                                 MOVE THE STEP NAME FOR JOB     S21046 08400002
MVCMSG   MVC   WTORLIST+OFFSET20(MOVE8),ZERO(R8)                 S21046 08420002
*                                 MOVE THE JOBNAME FOR MSG       S21046 08440002
         B     WTORFNSH           GO FINISH WTOR SETUP           S21046 08460002
EXECUTE  L     LINKREG,0(R9)                                            08480002
         EX    0,0(LINKREG)                                             08500002
         B     FDLD                                                     08520002
MVECT    MVC   IEHEMAC1+3(1),PARAM4+1  NUMBER OF ENTRIES TO LST    4621 08540002
CLOSVTOC CLOSE ((R3))             CLOSE THE VTOC HERE                   08560002
         ORG   *-18                                                     08580002
         LA    1,FULLWORD                                               08600002
         LA    R3,DCB4VTOC                                              08620002
         ORG                                                            08640002
         B     FDLD                                                     08660002
STTRESET EQU   *                                                        08720002
         L     SAVEREG,SAVEREG2+4 GET OLD SAVE AREA ADDRESS       M2838 08740002
         LM    14,12,12(13)       RESTORE REGS                    M2838 08760002
         L     15,DECB2                                                 08780002
         L     15,4(15)                 GET ADDRESS OF IEHRESET         08800002
         BR    15                       RETURN TO THE FIRST LOAD        08820002
*                                                                S21046 08840002
*      INITIALIZE FOR AND ISSUE THE PROTECT MACRO                S21046 08860002
*                                                                S21046 08880002
SVCPRO   EQU   *                                                 S21046 08900002
         PROTECT  IEHEMAC1        ISSUE THE PROTECT SVC          S21046 08920002
         MVI   ERRFLD,PROMASK     INDICATE PROTECT RETURN        S21046 08940002
         STC    RTNREG,ERRFLD+OFFSET1 STORE RETURN CODE          S21046 08960002
DECODE   EX    ZERO,PROTAB(RTNREG) INTERPRET THE RETURN CODE     S21046 08980002
MSGRTN   L     LINKREG,MSGRTNAD   LOAD ADDRESS OF MESSAGE WRITER S21046 09000002
         BALR  RETURN,LINKREG     GO TO MSG WRITER               S21046 09020002
         B     STTRESET           RETURN                         S21046 09040002
*                                                                S21046 09060002
*      THIS BRANCH TABLE IS USED TO INTERPRET THE RETURN CODE    S21046 09080002
*      FROM THE PROTECT MACRO                                    S21046 09100002
*                                                                S21046 09120002
PROTAB   B     OKPROTCT           NORMAL END FOR PROTECT         S21046 09140002
         LA    PARAMREG,MSG62     DUPLICATE KEYS IN MPDS         S21046 09160002
         B     DSNOTFD            PASWORD1 NOT FOUND IN MPDS     S21046 09180002
         B     CPASWD             NEED A CONTROL PASSWORD        S21046 09200002
         B     UNKERR             PRINT UNKNOWN ERROR MESSAGE    S21046 09220002
*                                 AN INVALID PARAMETER LIST WAS  S21046 09240002
*                                 PASSED TO PROTECT              S21046 09260002
         B     IOMPDS             I/O ERROR IN MPDS              S21046 09280002
         LA    PARAMREG,MSG66     THE MPDS IS FULL               S21046 09300002
         B     UNKERR             PRINT UNKNOWN ERROR MESSAGE    S21046 09320002
*                                 VALIDITY CHECK FOR BUFFER AREA S21046 09340002
*                                 FAILED                         S21046 09360002
         B     LOCATFAL           LOCATE MACRO FAILED            S21046 09380002
         B     OBTANFAL           OBTAIN MACRO FAILED            S21046 09400002
         LA    PARAMREG,MSG64     UNABLE TO UPDATE DSCB          S21046 09420002
         LA    PARAMREG,MSG60     MPDS DOES NOT EXIST            S21046 09440002
         LA    PARAMREG,MSG61     TAPE DATA SET NOT PROTECTED    S21046 09460002
         LA    PARAMREG,MSG64     ENQ FAILURE IN SCV98           S21046 09480002
*                                                                S21046 09500002
*      PROTECT WORKED, IF THE REQUEST WAS A LIST MOVE THE DATA   S21046 09520002
*      RECIEVED TO THE PROPER MESSAGE AND HAVE THE MESSAGES      S21046 09540002
*      PRINTED.                                                  S21046 09560002
*                                                                S21046 09580002
OKPROTCT CLI   IEHEMAC1,LISTMASK  IS THIS RETURN FOR LIST OP     S21046 09600002
         BNE   OKEND              DO NOT PRINT LISTING           S21046 09620002
         SR    R5,R5              ZERO REGISTER 5                S21046 09640002
         LH    R5,PARAM4          LOAD THE ACCESS COUNT          S21046 09660002
         CVD   R5,DBLWORD         CONVERT IT TO PACKED DECIMAL   S21046 09680002
         MVC   MSGOUT(MOVE24),ACCESSCT                           S21046 09700002
*                                 MOVE HEADING FOR ACCESS CNT    S21046 09720002
         UNPK  MSGOUT+OFFSET24(MOVE6),DBLWORD+OFFSET5(MOVE3)     S21046 09740002
*                                 UNPACK THE ACCESS COUNT        S21046 09760002
         OI    MSGOUT+OFFSET29,FIXBYTE FIX LAST BYTE OF COUNT    S21046 09780002
         SR    PARAMREG,PARAMREG  ZERO OUT REGISTER 0            S21046 09800002
         L     LINKREG,MSGRTNAD   ADDRESS OF MESSAGE WRITER      S21046 09820002
         BALR  RETURN,LINKREG     BRANCH TO THE MESSAGE WRITER   S21046 09840002
         MVC   MSGOUT(MOVE21),MODEBYTE MOVE HEADER FOR MOBE BYTE S21046 09860002
         TM    PARAM4+OFFSET2,CONTROL                            S21046 09880002
*                                 IS THIS A CONTROL PASSWORD     S21046 09900002
         BC    1,CONBIT           GO PUT IN CONTROL              S21046 09920002
         MVC   MSGOUT+OFFSET21(MOVE12),SECNDRY                   S21046 09940002
*                                 MOVE SECONDARY TO MESSAGE      S21046 09960002
         B     TESTNEXT           SKIP NEXT INSTRUCTION          S21046 09980002
CONBIT   MVC   MSGOUT+OFFSET21(MOVE12),CONTRL                    S21046 10000002
*                                 MOVE CONTROL TO MESSAGE        S21046 10020002
TESTNEXT TM    PARAM4+OFFSET2,RW  READ WRITE PROTECTION          S21046 10040002
         BC    1,RWBIT            IF SO GO MOVE READ/WRITE       S21046 10060002
         MVC   MSGOUT+OFFSET33(MOVE9),READ                       S21046 10080002
*                                 MOVE READ TO MESSAGE           S21046 10100002
         B     SR                 SKIP NEXT INSTRUCTION          S21046 10120002
RWBIT    MVC   MSGOUT+OFFSET33(MOVE10),READWRT                   S21046 10140002
*                                 MOVE READ/WRITE TO MESSAGE     S21046 10160002
SR       EQU   *                                                 S21046 10180002
         SR    PARAMREG,PARAMREG  ZERO OUT REGISTER 0            S21046 10200002
         L     LINKREG,MSGRTNAD   ADDRESS OF MESSAGE WRITER      S21046 10220002
         BALR  RETURN,LINKREG     BRANCH TO THE MESSAGE WRITER   S21046 10240002
         MVC   MSGOUT(MOVE19),DATAFILD MOVE DATA AREA HEADER     S21046 10260002
         MVC   MSGOUT+OFFSET19(MOVE77),PARAM4+OFFSET3            S21046 10280002
*                                 MOVE THE DATA TO MSGOUT        S21046 10300002
         SR    PARAMREG,PARAMREG  ZERO OUT REGISTER 0            S21046 10320002
         L     LINKREG,MSGRTNAD   ADDRESS OF MESSAGE WRITER      S21046 10340002
         BALR  RETURN,LINKREG     BRANCH TO THE MESSAGE WRITER   S21046 10360002
         B     OKEND              GO TO NORMAL END ROUTINE       S21046 10380002
*                                                                S21046 10400002
*      LOCATE MACRO FAILED DURING PROTECT, MOVE THE RETURN CODES S21046 10420002
*      TO THE ERROR MESSAGE AND HAVE MESSAGE PRINTED             S21046 10440002
*                                                                S21046 10460002
LOCATFAL MVC   MSGOUT(MOVE77),LOCATMSG MOVE THE LOCATE FAILMSG   S21046 10480002
         CVD   LISTREG,DBLWORD    CONVERT THE RETURN CODE TO DEC S21046 10500002
         UNPK  MSGOUT+OFFSET51(MOVE2),DBLWORD+OFFSET6(MOVE2)     S21046 10520002
*                                 UNPACK CODE TO BE PRINTED      S21046 10540002
         OI    MSGOUT+OFFSET52,FIXBYTE FIX LAST BYTE FOR PRINT   S21046 10560002
         CVD   ZERO,DBLWORD       CONVERT NUMBER INDEX SEARCHED  S21046 10580002
         UNPK  MSGOUT+OFFSET74(MOVE2),DBLWORD+OFFSET6(MOVE2)     S21046 10600002
*                                 UNPACK INDICES TO PRINT        S21046 10620002
         OI    MSGOUT+OFFSET75,FIXBYTE FIX NUMBER TO PRINT       S21046 10640002
MSGWRT   SR    PARAMREG,PARAMREG  ZERO OUT REG 0                 S21046 10660002
MSGRTNA  L     LINKREG,MSGRTNAD   LOAD ADDR OF MESSAGE WRITER  @VS30028 10670003
         BALR  RETURN,LINKREG     GO TO MESSAGE WRITER         @VS30028 10680003
         LA    PARAMREG,MSG64     UNABLE TO UPDATE DSCB        @VS30028 10690003
         B     MSGRTN             ISSUE MESSAGE                 YM07026 10692003
*                                                                S21046 10700002
*      OBTAIN MACRO FAILED DURING PROTECT, MOVE RETURN CODE TO   S21046 10720002
*      ERROR MESSAGE AND HAVE MESSAGE PRINTED                    S21046 10740002
*                                                                S21046 10760002
OBTANFAL MVC   MSGOUT(MOVE54),OBTANMSG MOVE MSG FOR OBTAIN FAILU S21046 10780002
         CVD   LISTREG,DBLWORD    CONVERT THE RETURN CODE TO DEC S21046 10800002
         UNPK  MSGOUT+OFFSET51(MOVE2),DBLWORD+OFFSET6(MOVE2)     S21046 10820002
*                                 UNPACK CODE TO BE PRINTED      S21046 10840002
         OI    MSGOUT+OFFSET52,FIXBYTE  SET UP LAST BYTE TO PRIN S21046 10860002
         B     MSGWRT             GET READY FOR WRITING OF MSG   S21046 10880002
*                                                                S21046 10900002
*      AN I/O ERROR OCCURRED WHILE ACCESSING PASSWORD DATA SET   S21046 10920002
*      ISSUE ERROR MESSAGE                                       S21046 10940002
*                                                                S21046 10960002
IOMPDS   LA    PARAMREG,MSG65     PRINT I/O ERROR MPDS MESSAGE   S21046 10980002
         MVI   ERRFLD+OFFSET1,CODE12  RETURN CODE OF 12          S21046 11000002
         B     MSGRTN             GO ISSUE MESSAGE               S21046 11020002
*                                                                S21046 11040002
*   KEY NOT FOUND IN PASSWORD DATA SET , INITIALIZE TO REISSUE   S21046 11060002
*   WTOR IF MAX ATTEMPTS NOT YET REACHED                         S21046 11080002
*                                                                S21046 11100002
DSNOTFD  LA    R5,RTNCODE8        WTOR FOR PASWORD2              S21046 11120002
         B     DOWNTABL           SET ADDRESS IN TABLE CORRECT   S21046 11140002
*                                                                S21046 11160002
*      EITHER THE CONTROL PASSWORD WAS NOT GIVEN WHEN REQUIRED   S21046 11180002
*      OR WAS INVALID, PREPARE TO ISSUE WTOR                     S21046 11200002
*                                                                S21046 11220002
CPASWD   LA    R5,RTNCOD12        WTOR FOR CPASWORD              S21046 11240002
DOWNTABL L     R9,FINUSE          LOAD ADDRESS IN TABLE          S21046 11260002
         LA    R6,FOUR            AMOUNT TO DECREMENT TABLE ADD  S21046 11280002
         SR    R9,R6              DECREMENT TABLE TO CALL SVC    S21046 11300002
*                                 WHEN WE ARE AT FDLD            S21046 11320002
         ST    R9,FINUSE          STORE THE NEW ADD IN FINUSE    S21046 11340002
         BR    R5                 GO WTOR FOR THE NECESSARY PASW S21046 11360002
*                                                                       11380002
SVCSCR   EQU   *                                                        11400002
         BAL   RETURN,DEVCHECK         GO TO ADJUST DEVICETYPE @ZA06552 11410008
         SR    R0,R0                   ZERO WORK REG           @Z30AAAG 11420003
         ICM   R0,3,UCBAD1             GET UCB ADDR            @Z30AAAG 11421003
         SCRATCH  IEHEMAC1        SCRATCH A DATA SET                    11440002
         B     SVCRET                                                   11460002
SVCRENAM EQU   *                                                        11480002
         BAL   RETURN,DEVCHECK         GO TO ADJUST DEVICETYPE @ZA06552 11480408
         SR    R0,R0                   ZERO WORK REG           @Z30AAAG 11481003
         ICM   R0,3,UCBAD1             GET UCB ADDR            @Z30AAAG 11482003
         RENAME  IEHEMAC1         RENAME A DATA SET                     11520002
         B     SVCRET                                                   11540002
SVCMEMB  EQU   *                  VERIFY THAT DATA SET EXISTS      1513 11560002
         BAL   RETURN,DEVCHECK         GO TO ADJUST DEVICETYPE @ZA06552 11570008
         SR    R0,R0                   CLEAR THE UCB REGISTER  @VS30028X11580003
                                       SINCE NO VOL TO MOUNT   @VS30028 11590003
         RENAME IEHEMAC1          ISSUE RENAME TO SEE IF DATA SET  1513 11600002
         LA    R2,8               EXISTS                           1513 11620002
         CR    R2,15              IS RETURN CODE 8                 1513 11640002
         BNE   SVCRET             NO,BR TO STORE ERROR CODE        1513 11660002
         CLI   PARAM4+13,X'03'    DOES DATA SET EXIST              1513 11680002
         BNE   SVCRET             NO,BR TO STORE ERROR CODE        1513 11700002
         B     MEMBERET           BYPASS STORING ERROR CODE        1513 11720002
DEVCHECK STM   R3,R5,REGSAVE           SAVE REGISTERS          @ZA06552 11720108
         L     R2,IEHEMAC1+12          GET ADDR OF VOLLIST     @ZA06552 11720508
         SR    R3,R3                   ZERO REG 3              @ZA06552 11721008
         LH    R3,0(R2)                NUMBER OF VOLUMES       @ZA06552 11721508
         LTR   R3,R3                   ANY VOLUMES?            @ZA06552 11722008
         BZ    GG                      NO, RETURN              @ZA06552 11722508
         LA    R2,2(R2)         GET ADDR OF FIRST VOLUME ENTRY @ZA06552 11723008
AA       CLC   2(2,R2),USERASS   DIRECT ACC, USER ASSIGN NAME? @ZA06552 11723508
         BNE   FF                  NO, TEST NEXT VOLUME ENTRY  @ZA06552 11724008
         L     R4,16               GET ADDR TO CVT             @ZA06552 11724508
         L     R4,40(R4)           GET ADDR OF UCB LOOKUP TBL  @ZA06552 11725008
BB       SR    R5,R5               ZERO REG 5                  @ZA06552 11725508
         ICM   R5,3,0(R4)          GET UCB ADDR                @ZA06552 11726008
         TM    0(R4),X'FF'         END OF UCB LOOKUP TBL       @ZA06552 11726508
         BNO   CC                  NO, BRANCH                  @ZA06552 11727008
         TM    1(R4),X'FF'       REAL END OF UCB LOOKUP TBL?   @ZA06552 11727508
         BO    FF                  YES, TEST NEXT VOLUME ENTRY @ZA06552 11728008
CC       LTR   R5,R5               IS THIS A ZERO ENTRY        @ZA06552 11728508
         BZ    DD                  YES, BRANCH TO NEXT ENTRY   @ZA06552 11729008
         CLI   18(R5),X'20'        UCB A DIRECT ACCESS ?       @ZA06552 11729508
         BNE   DD                 NO, BRANCH TO NEXT UCB ENTRY @ZA06552 11730008
         CLC   28(6,R5),4(R2)     THE RIGHT VOLUME ?           @ZA06552 11730508
         BE    EE                  YES,BRANCH                  @ZA06552 11731008
DD       LA    R4,2(R4)            UPDATE TO NEXT UCB ENTRY    @ZA06552 11731508
         B     BB                  GO TO CHECK THIS UCB        @ZA06552 11732008
EE       MVC   0(4,R2),16(R5)  MOVE DEVICETYPE TO VOLUME ENTRY @ZA06552 11732508
FF       LA    R2,12(R2)           UPDATE TO NEXT VOLUME ENTRY @ZA06552 11733008
         BCT   R3,AA    BRANCH IF NOT ALL VOLUME ENTRY CHECKED @ZA06552 11733508
GG       LM    R3,R5,REGSAVE       RESTORE REGISTERS           @ZA06552 11733608
         BCR   15,RETURN           RETURN                      @ZA06552 11734008
REGSAVE  DS    3F                  SAVE AREA                   @ZA06552 11734108
USERASS  DC    X'2000'           LAST TWO BYTES OF DEVICETYPE  @ZA06552 11734508
SVCLNKX  LA    R3,PARAM4+2                                         UC0H 11740002
         ST    R3,IEHEMAC1+12                                           11760002
SVCCAT   EQU   *                                                        11780002
         MVI   PARAM2+44,X'40'     PROVIDE BLANK DELIM FOR CATLG   3520 11800002
SVCINDX  EQU   *                                                        11820002
         MVC   IEHERSAV(44),PARAM2  SAVE INDEX OR DSNAME                11840002
      CATALOG  IEHEMAC1     SVC TO BUILDX OR CATALOG                    11860002
         MVC   PARAM2(44),IEHERSAV  RESTORE THE INDEX OR DSNAME         11880002
AFTERCAT EQU   *                                                 A25564 11900002
         CLC   FNSA+1(7),UNCATCON      IS REQUEST UNCATLG?       A25564 11920002
         BNE   SVC26RET                NO, STORE RETURN CODE FROMA25564 11940002
*                                      CATALOG SVC               A25564 11960002
         LA    R2,8                                              A25564 11980002
         CR    R2,15                   RETURN CODE FROM CATALOG  A25564 12040002
*                                      AN 8?                     A25564 12060002
         BE    MEMBERET                YES, BYPASS STORING CODE  A25564 12080002
         LA    R2,16                                             A25564 12100002
         CR    R2,15                   RETURN CODE FROM CATALOG  A25564 12120002
*                                      16?                       A25564 12140002
         BE    MEMBERET                YES,BYPASS STORING CODE @VS30028 12160003
SVC26RET EQU   *                                               @VS30028 12164003
         STC   RTNREG,ERRFLD           SAVE SVC RETURN CODE    @VS30028 12168003
MEMBERET SRL   RTNREG,2                XLATE ERROR RETURN CODE @VS30028 12172003
         L     R2,FINUSE               FROM CATALOG AND INDEX  @VS30028 12176003
         IC    RTNREG,0(RTNREG,R2)     TO MORE SPECIFIC CODES  @VS30028 12180003
         C     RTNREG,=F'9'             IS CATLGD D/S MISSNG   @Z40CSJH 12182008
         BNE   SHIFT                    BR IF NOT              @Z40CSJH 12182408
         C     R0,=F'56'                A SECURITY FAILURE?    @Z40CSJH 12182808
         BNE   SHIFT                    NO,BRANCH              @Z40CSJH 12183608
         LA    RTNREG,X'13'             PRINT MORE APPROP MSG  @Z40CSJH 12183708
SHIFT    SLL   RTNREG,2                FOR THIS OPERATION      @Z40CSJH 12184008
         EX    0,BRANTAB(RTNREG)       TAKE THE PROPER BRANCH  @VS30028 12188003
*                                                              @VS30028 12192003
SVCRET   EQU   *                                                 A25564 12200002
         EX    15,*+4                  POST THE ERROR RETURN     A25564 12220002
         OI    ERRFLD,X'00'            FROM THE SVC              A25564 12240002
         B     MEMBERET                CONTINUE PROCESSING       A25564 12260002
INDEX8   EQU   *                                                 A25564 12340002
         LA    RTNREG,OFFSET80(LISTREG) REG 15 = (REG 1) + 80  @Z40CSJH 12360008
         B     MEMBERET                 GO TRANSLATE CODE      @Z40CSJH 12410008
EXTRACT1 EXTRACT ,'S',FIELDS=(TIOT),MF=L                         S21046 12520002
EXSTP    EQU   *                  ADDRESSABILITY FOR END OF LIST S21046 12540002
*                                                                S21046 12560002
*      PROTECT MESSAGES                                          S21046 12580002
*                                                                S21046 12600002
*   THE FOLLOWING SEVEN MESSAGES ARE PARTS OF THE FORMATTED      S21046 12620002
*   LISTING OF THE USER DATA FIELD OF THE PASSWORD DATA SET      S21046 12640002
*                                                                S21046 12660002
ACCESSCT DC    CL24' DECIMAL ACCESS COUNT = '                    S21046 12680002
MODEBYTE DC    CL21' PROTECT MODE BYTE = '                       S21046 12700002
CONTRL   DC    CL12'CONTROL   , '                                S21046 12720002
SECNDRY  DC    CL12'SECONDARY , '                                S21046 12740002
READWRT  DC    CL10'READ/WRITE'                                  S21046 12760002
READ     DC    CL9'READ ONLY'                                    S21046 12780002
DATAFILD DC    CL19' USER DATA FIELD = '                         S21046 12800002
*   THIS WTOR IS ISSUED WHEN EITHER A PASSWORD IS FOUND TO BE    S21046 12840002
*   INCORRECT OR WAS NOT SUPPLIED ON A CONTROL CARD              S21046 12860002
*                                                                S21046 12880002
WTORLFRM WTOR  'IEH220A JOBNAMES, STEPNAME, CARDNAME, REPLY WITH PASSWOR12900002
               RD',,8,ROUTCDE=(9),DESC=2,MF=L                    S21046 12920002
WTORSTOP EQU   *                                                 S21046 12940002
*                                                                S21046 12960002
*   THE FOLLOWING THREE MESSAGE PARTS ARE USED IN MESSAGES       S21046 12980002
*   IEH228I AND IEH220A TO INDICATE WHICH PASSWORD IS EITHER     S21046 13000002
*   INCORRECT OR WAS NOT SUPPLIED                                S21046 13020002
MSGE1    DC    C'PASWORD1'                                       S21046 13040002
MSGE2    DC    C'PASWORD2'                                       S21046 13060002
MSGE3    DC    C'CPASWORD'                                       S21046 13080002
*                                                                S21046 13100002
*   THIS DATA AREA IS USED TO FOLD ALL OPERATOR REPLIES TO       S21046 13120002
*   CAPITAL LETTERS                                              S21046 13140002
*                                                                S21046 13160002
UPPERFLD DC    X'4040404040404040'                               S21046 13180002
*                                                                S21046 13200002
*   THE FOLLOWING THREE MESSAGES ARE ISSUED WHEN THE OPERATOR    S21046 13220002
*   FAILS TO SUPPLY A CORRECT PASSWORD, THE LOCATE MACRO FAILS , S21046 13240002
*   OR THE OBTAIN MACRO FAILS RESPECTIVELY                       S21046 13260002
*                                                                S21046 13280002
OPFAIL   DC    C'IEH228I INVALID PASSWORD SPECIFIED  '          YA01695 13290002
LOCATMSG DC    C' IEH226I LOCATE MACRO FAILED.  LOCATE RETURN CODE'     13320002
         DC    C' =XX.  INDEXES SEARCHED =XX.'                   S21046 13340002
OBTANMSG DC    C' IEH227I OBTAIN MACRO FAILED.  OBTAIN RETURN CODE'     13360002
         DC    C' =XX.'                                          S21046 13380002
*                                                                       13400002
*                                 ----- MEMBER -----                    13420002
*                                                                       13440002
MEMBER   DS    0F                                                       13460002
         DC    A(SVCMEMB)                                          1513 13480002
         DC    X'00101200'                                         1513 13500002
*                                                                       13520002
*                                 ----- CATALOG -----                   13540002
*                                                                       13560002
CATALOG  DS    0F                                                       13580002
         DC    A(SVCCAT)                                                13600002
         DC    X'0102030005060708'                                      13620002
         DC    FL4'0'                                                   13640002
         DC    FL4'0'                                            A31333 13660002
         DC    X'00001400'                                              13680002
         DC    X'0902050A0B0C0800'                                      13700002
*                                                                       13720002
*                        -----UNCATALOG-----                            13740002
*                                                                       13760002
UNCATLG  DS    0F                                                       13780002
         DC    A(SVCCAT)                                                13800002
         DC    X'010203000E000008'                                      13820002
         DC    FL4'0'                                                   13840002
         DC    FL4'0'                                            A31333 13860002
         DC    X'00001400'                                       A31333 13880002
         DC    X'13020E0A0E0C0800'                             @Z40CSJH 13900008
*                                                                       13920002
*                           -----DELETE INDEX-----                      13940002
*                                                                       13960002
DELETEX  DS    0F                                                       13980002
         DC    A(SVCINDX)                                               14000002
         DC    X'010203040F060008'                                      14020002
         DC    FL4'0'                                                   14040002
         DC    FL4'0'                                            A31333 14060002
         DC    X'00001400'                                       A31333 14080002
         DC    X'13020F000B0C0800'                             @Z40CSJH 14100008
*                                                                       14120002
*                            -----CONNECT -----                         14140002
*                                                                       14160002
CONNECT  DS    0F                                                       14180002
         DC    AL4(SVCLNKX)                                             14200002
         DC    X'0102030000060008'                                      14220002
         DC    FL4'0'                                                   14240002
         DC    FL4'0'                                            A31333 14260002
         DC    X'00001400'                                       A31333 14280002
         DC    X'1302000A0B0C0800'                             @Z40CSJH 14300008
*                                                                       14320002
*                            ------ RELEASE ------                      14340002
*                                                                       14360002
RELEASE  DS    0F                                                       14380002
         DC    AL4(SVCINDX)                                             14400002
         DC    X'010203000F000008'                                      14420002
         DC    FL4'0'                                                   14440002
         DC    FL4'0'                                            A31333 14460002
         DC    X'00001400'                                       A31333 14480002
         DC    X'13020F0A0C0C0800'                             @Z40CSJH 14500008
*                                                                       14520002
*                                 ----- BUILD ALIAS -----               14540002
*                                                                       14560002
BUILDA   DS    0F                                                       14580002
         DC    AL4(SVCINDX)                                             14600002
         DC    X'010203000F060008'                                      14620002
         DC    FL4'0'                                                   14640002
         DC    FL4'0'                                            A31333 14660002
         DC    X'00001400'                                       A31333 14680002
         DC    X'13020F130C0C0800'                             @Z40CSJH 14700008
*                                                                       14720002
*                                 ----- DELETE ALIAS -----              14740002
*                                                                       14760002
DELETEA  DS    0F                                                       14780002
         DC    AL4(SVCINDX)                                             14800002
         DC    X'010203000F060008'                                      14820002
         DC    FL4'0'                                                   14840002
         DC    FL4'0'                                            A31333 14860002
         DC    X'00001400'                                       A31333 14880002
         DC    X'13020F0A0C0C0800'                             @Z40CSJH 14900008
*                                                                       14920002
*                            ----- SCRATCH -----                        14940002
*                                                                       14960002
SCRATCH  DS    0F                                                       14980002
         DC    AL4(SVCSCR)                                              15000002
         DC    X'0110101500'                                     A57261 15020002
*                                                                       15040002
*                            ----- BUILDX -----                         15060002
*                                                                       15080002
BUILDX   DS    0F                                                       15100002
         DC    AL4(SVCINDX)                                             15120002
BLDXERRS DC    X'0102030005060008'                                      15140002
         DC    FL4'0'             RESERVED FOR EXPANSION                15160002
         DC    FL4'0'                                            A31333 15180002
         DC    X'00001400'        ENTRY NUMBER 14 IN BRANTAB     A31333 15200002
         DC    X'1302050A0B0C0800'                             @Z40CSJH 15220008
*                                                                       15240002
*                            ----- RENAME -----                         15260002
*                                                                       15280002
RENAME   DS    0F                                                       15300002
         DC    AL4(SVCRENAM)                                            15320002
         DC    X'0110101500'                                     A57261 15340002
*                                                                       15360002
*                                                                S21046 15380002
*                            ----- ADD -----                     S21046 15400002
*                                                                S21046 15420002
ADD      DS    0F                                                S21046 15440002
         DC    FL1'12'            PUT CODE IN PARM               S21046 15460002
         DC    FL3'1'             ADD CODE                       S21046 15480002
         DC    X'0B'              IS PASWORD2 IN PARAM LIST      S21046 15500002
         DC    FL3'0'             FILLER                         S21046 15520002
         DC    A(SVCPRO)          ISSUE PROTECT SVC (SVC 98)     S21046 15540002
*                                                                S21046 15560002
*                            ----- DELETEP -----                 S21046 15580002
*                                                                S21046 15600002
DELETEP  DS    0F                                                S21046 15620002
         DC    FL1'12'            PUT CODE IN PARM               S21046 15640002
         DC    FL3'3'             DELETEP CODE                   S21046 15660002
         DC    X'0A'              IS PASWORD1 IN PARAM LIST      S21046 15680002
         DC    FL3'0'             FILLER                         S21046 15700002
         DC    A(SVCPRO)          ISSUE PROTECT SVC (SVC 98)     S21046 15720002
*                                                                S21046 15740002
*                            ----- REPLACE -----                 S21046 15760002
*                                                                S21046 15780002
REPLACE  DS    0F                                                S21046 15800002
         DC    FL1'12'            PUT CODE IN PARM               S21046 15820002
         DC    FL3'2'             REPLACE CODE                   S21046 15840002
         DC    X'0A'              IS PASWORD1 IN PARAM LIST      S21046 15860002
         DC    FL3'0'             FILLER                         S21046 15880002
         DC    X'0B'              IS PASWORD2 IN PARAM LIST      S21046 15900002
         DC    FL3'0'             FILLER                         S21046 15920002
         DC    A(SVCPRO)          ISSUE PROTECT SVC (SVC 98)     S21046 15940002
*                                                                S21046 15960002
*                            ----- LIST -----                    S21046 15980002
*                                                                S21046 16000002
LIST     DS    0F                                                S21046 16020002
         DC    FL1'12'            PUT CODE IN PARM               S21046 16040002
         DC    FL3'4'             LIST CODE                      S21046 16060002
         DC    FL1'13'            FILL IN ADDRESS FOR LIST BUFF  S21046 16080002
         DC    FL3'0'             FILLER                         S21046 16100002
         DC    X'0A'              IS PASWORD1 IN PARAM LIST      S21046 16120002
         DC    FL3'0'             FILLER                         S21046 16140002
         DC    A(SVCPRO)          ISSUE PROTECT SVC (SVC 98)     S21046 16160002
BADSCR   EQU   *                                                        16180002
         DC    FL1'6'                                                   16200002
         DC    FL1'1'                                                   16220002
         DC    FL2'14'                                                  16240002
         DC    FL1'6'                                                   16260002
         DC    FL2'35'                                                  16280002
         DC    FL1'15'                                                  16300002
ABEOJ    DC    FL1'6'                                                   16320002
         DC    FL1'1'                                                   16340002
         DC    FL2'16'                                                  16360002
         DC    FL1'6'                                                   16380002
         DC    FL1'2'                                                   16400002
         DC    FL2'17'                                                  16420002
         DC    X'09000000'                                              16440002
OKEND    BAL   LISTREG,ENT2FDLD                                         16460002
NORMEND  EQU   *                                                        16480002
         DC    FL1'6'              SELECT A MESSAGE                     16500002
         DC    FL1'1'              SUPPRESS PRINT                       16520002
         DC    FL2'9'              MSG NUM   = 9                        16540002
         DC    FL1'6'                                                   16560002
         DC    FL2'33'             INSERT FUNCTION NAME                 16580002
         DC    FL1'5'              AND WRITE THE MSG                    16600002
         DC    X'09000000'                                              16620002
         DS    0F                                                       16640002
NOVOL    BAL   LISTREG,ENT2FDLD                                         16660002
VOLREM   EQU   *                                                        16680002
         DC    FL1'6'                                                   16700002
         DC    FL1'1'              SELECT AND SUPPRESS                  16720002
         DC    FL2'11'             MESSAGE 11                           16740002
         DC    FL1'6'                                                   16760002
         DC    X'0200'             TACK ON MSG 17 AND  WRITE IT         16780002
         DC    FL1'17'                                                  16800002
         DC    X'09000000'                                              16820002
*                                                                       16840002
*        FOR THE HANDLING OF UNKNOWN ERRORS......                       16860002
*                                                                       16880002
         DS    0F                                                       16900002
UNKERR   BAL   LISTREG,ENT2FDLD                                         16920002
OVERSIZE EQU   *                                                        16940002
         DC    FL1'6'                                                   16960002
         DC    FL3'12'            INFORM THE USER OF AN ERROR           16980002
         DC    FL1'6'             AND THE UNDEFINED CODE                17000002
         DC    FL1'1'                                                   17020002
         DC    FL2'4'                                                   17040002
         DC    FL1'4'                                                   17060002
         DC    AL3(ABEOJ+4)                                             17080002
INTERR8  EQU   *                                                        17100002
         BALR  R7,0                                                     17120002
         USING *,R7                                                     17140002
         L     R10,CSECT2AD                                             17160002
         DROP  R7                                                       17180002
         NC    PARAM4(2),PARAM4                                         17200002
         BZ    ENDERR                                                   17220002
         LA    R3,12                                                    17240002
         LH    R4,PARAM4          NUMBER OF VOLUMES                     17260002
         MR    R2,R4              MULTIPLIED BY TWELVE                  17280002
         BCTR  R4,ZERO                                                  17300002
         STH   R4,PARAM4          DECREASE THE VOLUME COUNT             17320002
         LA    R3,PARAM4-6(R3)    POINT AT A VOLUME I.D.                17340002
         MVC   MSGOUT+12(6),0(R3) PUT THE VOL I.D. INTO MESSAGE         17360002
         MVI   MSGOUT+93,C'*'                                           17380002
         MVC   MSGOUT+94(2),MSGOUT+93                                   17400002
         IC    R2,7(R3)                                                 17420002
         SLL   R2,2                                                     17440002
         EX    0,*+4(R2)          GO TO THE PROPER ERROR ROUTINE        17460002
*                                                              @VS30028 17462003
* THE FOLLOWING BRANCH TABLE IS USED TO HANDLE VOLUME LIST     @VS30028 17464003
* RETURN CODES FROM RENAME AND SCRATCH AND THE INTERPRETED     @VS30028 17466003
* (VIA THE TABLE LABELED 'STOWTAB') STOW ERROR RETURN CODES.   @VS30028 17468003
*                                                              @VS30028 17470003
SCRESTBL EQU   *                       SCRATCH/RENAME/STOW     @VS30028X17472003
                                       BRANCH TABLE            @VS30028 17474003
         B     NOERR                                                    17480002
         B     ERR1                                                     17500002
         B     ERR2                                                     17520002
         B     ERR3                                                     17540002
         B     IOERR                                                    17560002
         B     NOVOLUME                                                 17580002
         B     NOVOLUME                                                 17600002
         B     DSOPEN                  SCRATCH/RENAME ISSUED   @VS30028X17620003
                                       WHILE DATA SET WAS OPEN @VS30028 17630003
         B     RC8TEST                 GO TEST RETURN CODE     @Z40RSDSX17640008
                                       FROM SCRATCH OR RENAME  @Z40RSDS 17650008
         DC    F'0'                    RESERVED FOR CODE X'09' @G32DSFS 17660032
         B     DSNOTOP                 DATA SET NOT OPENED     @VS30028 17665003
         B     PDSFULL                 DIRECTORY IS FULL       @Z40RSDS 17666008
         B     NOCORE                  GETMAIN FAILED IN STOW  @Z40RSDS 17670008
*                                                              @VS30028 17675003
NOERR    MVC   MSGOUT+91(6),MSGOUT+90                                   17680002
         CNOP  0,4                                                      17700002
         BAL   LISTREG,ENT2FDLD                                         17720002
         DC    FL1'6'                                                   17740002
         DC    FL1'1'                                                   17760002
         DC    FL1'28'                                                  17780002
         DC    FL1'5'                                                   17800002
         DC    FL1'6'                                                   17820002
         DC    FL2'43'                                                  17840002
         DC    FL1'23'                                                  17860002
         DC    A(INTERR8)                                               17880002
         DS    0F                                                       17900002
ERR1     EQU   *                                                        17920002
         BAL   LISTREG,ENT2FDLD                                         17940002
         DC    FL1'6'                                                   17960002
         DC    FL1'1'                                                   17980002
         DC    FL1'28'                                                  18000002
         DC    FL1'28'                                                  18020002
         DC    FL1'6'                                                   18040002
         DC    FL2'43'                                                  18060002
         DC    FL1'24'                                                  18080002
         DC    A(INTERR8)                                               18100002
         DS    0F                                                       18120002
ERR2     EQU   *                                                        18140002
         BAL   LISTREG,ENT2FDLD                                         18160002
         DC    FL1'6'                                                   18180002
         DC    FL1'1'                                                   18200002
         DC    FL1'28'                                                  18220002
         DC    FL1'28'                                                  18240002
         DC    FL1'6'                                                   18260002
         DC    FL2'43'                                                  18280002
         DC    FL1'25'                                                  18300002
         DC    A(INTERR8)                                               18320002
         DS    0F                                                       18340002
ERR3     EQU   *                                                        18360002
         TM    IEHEMAC1+2,X'40'                                         18380002
         BO    SCR4                                                     18400002
REN4     BAL   LISTREG,ENT2FDLD                                         18420002
         DC    FL1'6'                                                   18440002
         DC    FL1'1'                                                   18460002
         DC    FL1'28'                                                  18480002
         DC    FL1'28'                                                  18500002
         DC    FL1'6'                                                   18520002
         DC    FL2'43'                                                  18540002
         DC    FL1'27'                                                  18560002
         DC    A(INTERR8)                                               18580002
         DS    0F                                                       18600002
SCR4     EQU   *                                                        18620002
         BAL   LISTREG,ENT2FDLD                                         18640002
         DC    FL1'6'                                                   18660002
         DC    FL1'1'                                                   18680002
         DC    FL1'28'                                                  18700002
         DC    FL1'28'                                                  18720002
         DC    FL1'6'                                                   18740002
         DC    FL2'43'                                                  18760002
         DC    FL1'26'                                                  18780002
         DC    A(INTERR8)                                               18800002
         DS    0F                                                       18820002
IOERR    BAL   LISTREG,ENT2FDLD                                         18840002
         DC    FL1'6'                                                   18860002
         DC    FL1'1'                                                   18880002
         DC    FL1'28'                                                  18900002
         DC    FL1'28'                                                  18920002
         DC    FL1'6'                                                   18940002
         DC    FL2'43'                                                  18960002
         DC    FL1'29'                                                  18980002
         DC    A(INTERR8)                                               19000002
         DS    0F                                                       19020002
NOVOLUME EQU   *                                                        19040002
         BAL   LISTREG,ENT2FDLD                                         19060002
         DC    FL1'6'                                                   19080002
         DC    FL1'1'                                                   19100002
         DC    FL1'28'                                                  19120002
         DC    FL1'28'                                                  19140002
         DC    FL1'6'                                                   19160002
         DC    FL2'43'                                                  19180002
         DC    FL1'50'                                                  19200002
         DC    A(INTERR8)                                               19220002
         DS    0F                                                       19240002
DSOPEN   EQU   *                       SCR/RENAME RTN CODE 7   @VS30028 19241003
         BAL   LISTREG,ENT2FDLD        GET NEXT ENTRY IN TABLE @VS30028 19242003
         DC    FL1'6'                  PRINT A MESSAGE         @VS30028 19243003
         DC    FL1'1'                  SUPRESS PRINT           @VS30028 19244003
         DC    FL1'28'                 PRINT POSITION 28       @VS30028 19245003
         DC    FL1'28'                 MESSAGE NUMBER 28       @VS30028 19246003
         DC    FL1'6'                  PRINT A MESSAGE         @VS30028 19247003
         DC    FL2'43'                 PRINT POSITION 43       @VS30028 19248003
         DC    FL1'75'                 MESSAGE NUMBER 75       @VS30028 19249003
         DC    A(INTERR8)              ROUTINE ADDRESS         @VS30028 19250003
         DS    0F                      ALIGN TO FULLWORD       @VS30028 19251003
DSNOTOP  EQU   *                                                 A33374 19260002
         BAL   LISTREG,ENT2FDLD                                  A33374 19280002
         DC    FL1'6'                  PRINT A MESSAGE           A33374 19300002
         DC    FL1'1'                  SUPRESS PRINT             A33374 19320002
         DC    FL1'28'                 PRINT POSITION 28         A33374 19340002
         DC    FL1'28'                 MESSAGE NUMBER 28         A33374 19360002
         DC    FL1'6'                  PRINT A MESSAGE           A33374 19380002
         DC    FL2'43'                 PRINT POSITION 43         A33374 19400002
         DC    FL1'70'                 MESSAGE NO 70             A33374 19420002
         DC    A(INTERR8)                                        A33374 19440002
         DS    0F                      GET BOUNDRY ALIGNMENT     A33374 19460002
NOCORE   EQU   *                                                 A33374 19480002
         BAL   LISTREG,ENT2FDLD                                  A33374 19500002
         DC    FL1'6'                  PRINT A MESSAGE           A33374 19520002
         DC    FL1'1'                  SUPRESS PRINT             A33374 19540002
         DC    FL1'28'                 PRINT POSITION 28         A33374 19560002
         DC    FL1'28'                 MESSAGE NUMBER 28         A33374 19580002
         DC    FL1'6'                  PRINT A MESSAGE           A33374 19600002
         DC    FL2'43'                 PRINT POSITION 43         A33374 19620002
         DC    FL1'71'                 MESSAGE NO 71             A33374 19640002
         DC    A(INTERR8)                                        A33374 19660002
         DS    0F                      GET BOUNDRY ALIGNMENT     A33374 19680002
SCRERR8  EQU   *                       SCRATCH RAC ERROR       @Z40RSDS 19681008
         BAL   LISTREG,ENT2FDLD        GET NEXT ENTRY IN TABLE @Z40RSDS 19682008
         DC    FL1'6'                  PRINT A MESSAGE         @Z40RSDS 19683008
         DC    FL1'1'                  SUPRESS PRINT           @Z40RSDS 19684008
         DC    FL1'28'                 PRINT POSITION 28       @Z40RSDS 19685008
         DC    FL1'28'                 MESSAGE NUMBER 28       @Z40RSDS 19686008
         DC    FL1'6'                  PRINT A MESSAGE         @Z40RSDS 19687008
         DC    FL2'43'                 PRINT POSITION 43       @Z40RSDS 19688008
         DC    FL1'77'                 MESSAGE NUMBER 77       @Z40RSDS 19689008
         DC    A(INTERR8)              ROUTINE ADDRESS         @Z40RSDS 19690008
         DS    0F                      ALIGN TO FULLWORD       @Z40RSDS 19691008
PDSFULL  EQU   *                                                 YM5076 19700002
         BAL   LISTREG,ENT2FDLD                                  YM5076 19720002
         DC    FL1'6'                  PRINT A MESSAGE           YM5076 19740002
         DC    FL1'1'                  SUPRESS PRINT             YM5076 19760002
         DC    FL1'28'                 PRINT POSITION 28         YM5076 19780002
         DC    FL1'28'                 MESSAGE NUMBER 28         YM5076 19800002
         DC    FL1'6'                  PRINT A MESSAGE           YM5076 19820002
         DC    FL2'43'                 PRINT POSITION 43         YM5076 19840002
         DC    FL1'73'                 MESSAGE NUMBER 73         YM5076 19860002
         DC    A(INTERR8)                                        YM5076 19880002
         DS    0F                                                YM5076 19900002
*                                                              @Z40RSDS 19901008
* THE FOLLOWING CODE TRIES TO DETERMINE IF THE RETURN CODE OF  @Z40RSDS 19902008
* 8 WAS RETURNED BY SCRATCH OR RENAME.  IF THE FIRST 3 BYTES   @Z40RSDS 19903008
* OF IEHEMAC1 ARE EITHER X'410040' OR X'410050', THEN THE 8    @Z40RSDS 19904008
* WAS RETURNED BY SCRATCH.  IF THE FIRST 3 BYTES OF IEHEMAC1   @Z40RSDS 19905008
* ARE X'C10020', THEN THE 8 WAS RETURNED BY RENAME.            @Z40RSDS 19906008
*                                                              @Z40RSDS 19907008
RC8TEST  EQU   *                       TEST RETURN CODE OF 8   @Z40RSDS 19908008
         TM    IEHEMAC1+D2,SCRMASK     TEST IF SCRATCH OPTION  @Z40RSDS 19909008
         BO    SCRERR8                 BRANCH IF SCRATCH       @Z40RSDS 19910008
         CNOP  0,4                     ALIGN TO FULLWORD       @Z40RSDS 19911008
RENERR8  EQU   *                       RENAME RAC ERROR        @Z40RSDS 19912008
         BAL   LISTREG,ENT2FDLD        GET NEXT ENTRY IN TABLE @Z40RSDS 19913008
         DC    FL1'6'                  PRINT A MESSAGE         @Z40RSDS 19914008
         DC    FL1'1'                  SUPRESS PRINT           @Z40RSDS 19915008
         DC    FL1'28'                 PRINT POSITION 28       @Z40RSDS 19916008
         DC    FL1'28'                 MESSAGE NUMBER 28       @Z40RSDS 19917008
         DC    FL1'6'                  PRINT A MESSAGE         @Z40RSDS 19918008
         DC    FL2'43'                 PRINT POSITION 43       @Z40RSDS 19919008
         DC    FL1'78'                 MESSAGE NUMBER 78       @Z40RSDS 19919208
         DC    A(INTERR8)              ROUTINE ADDRESS         @Z40RSDS 19919408
         DS    0F                      ALIGN TO FULLWORD       @Z40RSDS 19919608
ENDERR   EQU   *                                                        19920002
         BAL   LISTREG,ENT2FDLD                                         19940002
         DC    FL1'6'                                                   19960002
         DC    FL1'1'                                                   19980002
         DC    FL2'30'                                                  20000002
         DC    FL1'4'                                                   20020002
         DC    AL3(ABEOJ+4)                                             20040002
         DS    0F                                                       20060002
RESCR8   EQU   *                                                        20080002
         BAL   LISTREG,ENT2FDLD                                         20100002
         DC    FL1'6'                                                   20120002
         DC    FL1'1'                                                   20140002
         DC    FL2'20'                                                  20160002
         DC    FL1'6'                                                   20180002
         DC    FL1'3'                                                   20200002
         DC    FL2'5'                                                   20220002
         DC    FL1'6'                                                   20240002
         DC    FL1'3'                                                   20260002
         DC    FL2'21'                                                  20280002
         DC    FL1'6'                                                   20300002
         DC    FL1'2'                                                   20320002
         DC    FL2'7'                                                   20340002
         DC    FL1'6'                                                   20360002
         DC    FL2'10'                                                  20380002
         DC    FL1'22'                                                  20400002
         DC    A(INTERR8)                                               20420002
VTOCDCS  DS    0F                 ALLIGN THE LIST                       20440002
         DC    A(TST4VTOC)                                              20460002
         DC    A(OPENVTOC)                                              20480002
         DC    FL1'6'                                                   20500002
         DC    FL1'1'                                                   20520002
         DC    FL2'36'                 PRINT MSG36                      20540002
         DC    FL1'6'                                                   20560002
         DC    FL1'2'                                                   20580002
         DC    FL2'33'                                                  20600002
         DC    FL1'6'                                                   20620002
         DC    FL1'1'                                                   20640002
         DC    FL1'30'                                                  20660002
         DC    FL1'22'                                                  20680002
         DC    FL1'6'                                                   20700002
         DC    FL2'17'                                                  20720002
         DC    FL1'32'                                                  20740002
RPTVTOC  DC    A(GETADSCB)        GO GET A DSNAME                       20760002
         DC    FL1'6'              PUT THE DATA SET                     20780002
         DC    FL1'1'              NAME INTO THE                        20800002
         DC    FL2'7'              MSG OUTPUT AREA                      20820002
         DC    A(SVCSCR)          GO SCRATCH THE DATA SET               20840002
         DC    X'11001100'                                              20860002
TST4VTOC EQU   *                                                        20880002
         BALR  R7,0                                                     20900002
         USING *,R7                                                     20920002
         L     R10,CSECT2AD                                             20940002
         DROP  R7                                                       20960002
         TM    IEHEMAC1,X'40'      VOLUME PRESENT                       20980002
         BZ    *+16                NO... BRANCH                         21000002
         CLI   PARAM4+1,X'01'                                           21020002
         BH    TRUNCVOL            TOO MANY VOLUMES TRUNCATE THE LIST   21040002
         BE    VOLOK                                                    21060002
         LA    LISTREG,BADSCR      NO VOLUME --- TERMINATE              21080002
         B     ENT2FDLD                                                 21100002
TRUNCVOL LA    R3,1                                                     21120002
         STH   R3,PARAM4                                                21140002
         LA    ZERO,35             INFORM THE USER                      21160002
         L     LINKREG,MSGRTNAD    THAT THE VOLUME LIST                 21180002
         BALR  RETURN,LINKREG      IS TRUNCATED                         21200002
         OI    ERRFLD,X'08'            STORE RETURN CODE OF 8    A25564 21220002
VOLOK    B     FDLD                                                     21240002
MEMBEROK CLI   PARAM4+13,X'03'    DOES THE DATA SET EXIST               21260002
         BNE   RESCR8             NO ..... BRANCH                       21280002
OPENVTOC EQU   *                                                        21300002
         BALR  R7,0                                                     21320002
         USING *,R7                                                     21340002
         L     R10,CSECT2AD                                             21360002
         DROP  R7                                                       21380002
         MVI   JFCB,X'04'                                               21400002
         MVC   JFCB+1(43),JFCB    VTOC NAME TO THE JFCB                 21420002
         MVI   JFCB+44,C' '                                             21440002
         MVI   JFCB+45,X'00'                                            21460002
         MVC   JFCB+46(147),JFCB+45         BUILD A JFCB                21480002
         MVC   JFCBVOL(6),PARAM4+6      PUT VOLUME ID IN JFCB           21500002
         MVI   JFCBVOL+6,C' '      BLANK IN THE NEXT VOL I.D.           21520002
         MVC   JFCBVOL-1(1),PARAM4+1    PUT VOLUME COUNT IN JFCB        21540002
         OI    JFCB+DWOFFSET,DNWBBIT   TURN ON THE 'DO NOT WRITE A38610 21560002
*                                      BACK' BIT IN THE JFCB     A38610 21580002
         LA    R3,DBLWORD                                               21600002
         IC    R4,EXLST2                                                21620002
         ST    R3,EXLST2                                                21640002
         STC   R4,EXLST2                                                21660002
         LA    R3,JFCB            FOR OPENJ                             21680002
         ST    R3,DBLWORD                                               21700002
         MVI   DBLWORD,X'87'      MAKE IT THE LAST ENTRY                21720002
         TM    DUPSW,X'08'        WAS MEMBER SPECIFIED                  21740002
         BZ    DOOPEN             NO ..... BRANCH                       21760002
         MVC   JFCB(44),PARAM2    PUT DATA SET NAME IN THE JFCB         21780002
DOOPEN   OPEN  ((R3),INOUT),TYPE=J     OPEN VTOC OR DATA SET            21800002
         ORG   *-18                                                     21820002
         LA    1,FULLWORD                                               21840002
         LA    R3,DCB4VTOC                                              21860002
         ORG                                                            21880002
         TM    DCB4VTOC+48,X'10'       IS DCB OPEN               A43352 21900002
         BNZ   GOODOPEN                BRANCH AROUND ERROR       A43352 21920002
         LA    RTNREG,CODEA            SET  CODE TO X'0A' TO   @VS30028X21940003
                                       CORRESPOND TO STOWTAB   @VS30028 21950003
         B     STOWCODE                GO TO ERROR ROUTINE       A43352 21960002
GOODOPEN EQU   *                                                 A43352 21980002
         OI    CTRLWORD,X'10'          INDICATE VTOC OPENED    @ZA01695 21990008
         LA    R2,VTOCERR                                               22000002
         XC    57(3,R3),57(R3)         PRESERVE                  M2422  22020002
*                                         IOB LENGTH BYTE WHEN   M2422  22040002
         O     R2,56(R3)                 RESETING                M2422  22060002
*                                          SYNAD IN THE DCB      M2422  22080002
         ST    R2,56(R3)               STORE SYNAD                      22100002
         LA    R2,VTOCEND                                               22120002
         ST    R2,FULLWORD                                              22140002
         MVC   33(3,R3),FULLWORD+1     STORE EODAD                      22160002
         TM    DUPSW,X'08'        WAS A MEMBER SPECIFIED                22180002
         BZ    FDLD               NO ..... BRANCH                       22200002
DOSTOW   MVC   EOCORE+8(8),PARAM3  PUT NEWNAME IN PARAMETER LIST        22220002
         LA    1,DCB4VTOC         SET THE DCB ADDRESS                   22240002
         LA    0,EOCORE           SET THE PARAMETER LIST ADDRESS        22260002
         LCR   0,0                SET DELETE ON                         22280002
         TM    DUPSW,X'20'        WAS NEWNAME SPECIFIED                 22300002
         BZ    STOW               NO ..... BRANCH              @ZA13801 22320008
         CLI   PARAM3-1,X'07'          NEWNAME EXCEEDS 8 CHAR  @ZA13801 22326008
         BH    INVALID                 YES, GIVE ERROR MSG     @ZA13801 22332008
         LCR   1,1                SET RENAME ON                         22340008
STOW     STOW  (1),(0),A          STOW WITH DELETE OR CHANGE            22360008
         ST    15,DBLWORD         SAVE THE RETURN FROM STOW             22380002
         CLOSE ((R3))                                                   22400002
         ORG   *-18                                                     22420002
         LA    1,FULLWORD                                               22440002
         LA    R3,DCB4VTOC                                              22460002
         ORG                                                            22480002
         L     15,DBLWORD          RESTORE THE ERROR CODE               22500002
         SRA   15,2               DID THE OPERATION COMPLETE OK         22520002
         BZ    OKEND              YES ..... BRANCH                      22540002
         IC    15,STOWTAB(15)     TRANSLATE THE ERROR TO BE             22560002
STOWCODE EQU   *                                                 A33374 22580002
         STC   15,PARAM4+13       COMPATIBLE WITH RENAME RETURNS        22600002
         STC   15,ERRFLD               STORE RETURN CODE FOR       M737 22620002
*                                      PROG1 ANALYSIS ROUTINE      M737 22640002
         B     RESCR8             GO TO RENAME ERROR HANDLER            22660002
*                                                                       22680002
INVALID  CLOSE ((R3))                                          @ZA13801 22682008
         CLI   ERRFLD+2,X'08'          CC HIGHER OR EQUAL 8 ?  @ZA13801 22684008
         BNL   EQMORE                  WES,BRANCH              @ZA13801 22686008
         MVI   ERRFLD+2,X'08'          SET COND CODE TO 8.     @ZA13801 22688008
EQMORE   BAL   LISTREG,ENT2FDLD        PRINT MSG               @ZA13801 22690008
         DC    FL1'6'                                          @ZA13801 22692008
         DC    FL3'59'                 MSG 59.                 @ZA13801 22694008
         DC    X'09000000'                                     @ZA13801 22696008
*                                                                       22700002
*                                                                       22720002
GETADSCB EQU   *                                                        22740002
         BALR  R7,0                                                     22760002
         USING *,R7                                                     22780002
         L     R10,CSECT2AD                                             22800002
         DROP  R7                                                       22820002
         READ  VTOCDECB,SF,DCB4VTOC,PARAM2,'S',MF=E                     22840002
         CHECK VTOCDECB                                                 22860002
         OI    FORMATID,X'F0'                                           22880002
         TM    VTOCSW,X'01'                                             22900002
         BO    PAST4                                                    22920002
         CLC   PARAM2(44),JFCB    SEARCH FOR 44HEX' 04'S '              22940002
         BNE   GETADSCB                                                 22960002
         OI    VTOCSW,X'01'       SET VTOC SW                           22980002
         B     GETADSCB                                                 23000002
PAST4    CLI   FORMATID,X'F1'     CHECK FOR  A FORMAT 1                 23020002
         BNE   GETADSCB                                                 23040002
         TM    IEHESW5,X'02'       IS THIS A 'SYS' OPTION REQUEST       23060002
         BZ    NOTSYS                IF NOT---                          23080002
         CLC   PARAM2(36),BADNAME  CHECK FOR NAME TO SCRATCH            23100002
         BE    NOTSYS                                              000E 23120002
         CLC   PARAM2(3),SYSNAME       DOES DSNAME BEGIN WITH SYS. 000E 23140002
         BNE   GETADSCB             IF NOT---                           23160002
         CLI   PARAM2+D25,BLANK        IS COL 26 BLANK             WG0I 23180002
         BE    GETADSCB                BRANCHH IF YES.             000E 23200002
*                                                                  WG0I 23220002
*        CHECK FOR NUMERICS IN NNNNN AND .T OF SYSNNNNN.T          WG0I 23240002
*                                                                  WG0I 23260002
         LA    R,5                     INDEX THRU NNNNN FIELD      WG0I 23280002
NUMCHK   LA    S,PARAM2+2(R)           S PTS TO LAST IN FIELD      WG0I 23300002
         CLI   D0(S),CZERO             CHECK FOR LOW FOR NUMERIC   WG0I 23320002
         BL    GETADSCB                TOO LOW FOR NUMERIC         WG0I 23340002
         CLI   D0(S),C9                CHECK FOR HIGH FOR NUMERIC  WG0I 23360002
         BH    GETADSCB                TOO HIGH FOR NUMERIC        WG0I 23380002
         BCT   R,NUMCHK                LOOP THRU FIVE TIMES        WG0I 23400002
*                                                                  WG0I 23420002
         CLC   PARAM2+D8(L2),DOTTEE                                WG0I 23440002
         BNE   GETADSCB                NOT SYSTEM NAME             WG0I 23460002
*                                                                  WG0I 23480002
         CLI   PARAM2+18,C'A'          WAS DSCB CREATED BY VS2. YL026VC 23500002
         BE    NOTSYS                 NEW SYSTEM GENERATED NAME.   000E 23520002
         CLI   PARAM2+18,C'F'         WAS DSCB CREATED BY MFT.     000E 23540002
         BE    NOTSYS                  NEW SYSTEM GENERATED NAME   WG0I 23560002
         CLI   PARAM2+D18,VEE          WAS DSCB CREATED BY MVT     WG0I 23580002
         BNE   GETADSCB                BRANCH IF NOT.              000E 23600002
NOTSYS   EQU   *                       SYSTEM GENERATED NAME   @VS30028 23610003
         MVI   PARAM2-1,L43            SET THE LENGTH TO 43    @VS30028 23620003
         B     FDLD                    GO SCRATCH THE DATA SET @VS30028 23630003
DOTTEE   DC    C'.T  '                 TEMPORARY DS NAME           WG0I 23640002
D0       EQU   0                                                   WG0I 23660002
D2       EQU   2                                                   WG0I 23680002
D8       EQU   8                                                   WG0I 23700002
D18      EQU   18                                                  WG0I 23720002
D25      EQU   25                                                  WG0I 23740002
FIVE     EQU   5                                                   WG0I 23760002
CZERO    EQU   X'F0'                                               WG0I 23780002
C9       EQU   X'F9'                                               WG0I 23800002
L2       EQU   2                                                   WG0I 23820002
L43      EQU   43                      LENGTH OF 43            @VS30028 23830003
VEE      EQU   C'V'                                                WG0I 23840002
SYSNAME  DC    C'SYS '                                             000E 23860002
BADNAME  DC    CL18'AAAAAAAA.AAAAAAAA.'                                 23880002
         DC    CL18'AAAAAAAA.AAAAAAAA.'                                 23900002
*                                                              @VS30028 23904003
* THE FOLLOWING ROUTINE ANALYZES THE RETURN CODE IN THE        @VS30028 23908003
* SCRATCH VOLUME LIST.  THE POSSIBLE RETURN CODES ARE -        @VS30028 23912003
*                                                              @VS30028 23916003
*        X'01' - DATA SET NOT FOUND                            @VS30028 23920003
*        X'02' - PASSWORD ERROR OR                             @VS30028 23924003
*                TRIED TO SCRATCH A VSAM DATA SPACE            @VS30028 23928003
*        X'03' - PURGE DATE NOT PAST                           @VS30028 23932003
*        X'04' - I/O ERROR                                     @VS30028 23936003
*        X'05' - VOLUME NOT VERIFIED AS MOUNTED                @VS30028 23940003
*        X'06' - OPERATOR UNABLE TO MOUNT THE VOLUME           @VS30028 23944003
*        X'07' - DATA SET WAS OPEN                             @VS30028 23948003
*        X'08' - INVALID RAC AUTHORIZATION                     @Z40RSDS 23950008
*                                                              @Z40RSDS 23954008
VTOCRET  EQU   *                                                        23980002
         BALR  R7,0                                                     24000002
         USING *,R7                                                     24020002
         L     R10,CSECT2AD                                             24040002
         DROP  R7                                                       24060002
         CLI   PARAM4+STATUS,ZERO      TEST IF SUCCESSFUL      @VS30028 24080003
         BE    DSCBGONE                BRANCH IF SUCCESSFUL    @VS30028 24100003
         MVI   MSGOUT+113,C'*'                                          24140002
         MVC   MSGOUT+114(2),MSGOUT+113                                 24160002
         CLI   PARAM4+STATUS,PSWDERR   TEST IF D/S NOT FOUND   @VS30028X24162003
                                       OR WRONG PASSWORD ERROR @VS30028 24164003
         BL    NOTFNDDS                BRANCH IF D/S NOT FOUND @VS30028 24166003
         BE    VTOC2                   BRANCH IF BAD PASSWORD  @VS30028 24168003
         CLI   PARAM4+STATUS,IOERROR   TEST IF PURGE DATE NOT  @VS30028X24170003
                                       PAST OR I/O ERROR       @VS30028 24172003
         BL    VTOC3                   BR IF PURGE DATE ERROR  @VS30028 24174003
         BE    VTOC4                   BRANCH IF I/O ERROR     @VS30028 24176003
         CLI   PARAM4+STATUS,OPENDS    TEST IF NO DEVICE ERROR @VS30028X24178003
                                       OR DATA SET WAS OPEN    @VS30028 24180003
         BL    VTOC56                  BRANCH IF NO DEVICE ERR @VS30028 24182003
         BE    VTOC7                   BRANCH IF DATA SET OPEN @Z40RSDS 24184008
         B     VTOC8                   INVALID RACF AUTHORITY  @G32DSFS 24185032
         DS    0F                                                       24280002
DSCBGONE EQU   *                                                        24300002
         BAL   LISTREG,ENT2FDLD                                         24320002
         DC    FL1'6'             SELECT A MESSAGE                      24340002
         DC    FL1'1'             SUPPRESS THE WRITE                    24360002
         DC    FL1'48'            PLACE IT IN PRINT POS. 48             24380002
         DC    FL1'5'             MESSAGE NUMBER 5                      24400002
         DC    FL1'6'             SELECT A MESSAGE                      24420002
         DC    FL2'63'            PLACE IT IN PRINT POS. 63             24440002
         DC    FL1'23'            MESSAGE NUMBER 23                     24460002
         DC    FL1'4'                                                   24480002
         DC    AL3(RPTVTOC)                                             24500002
NOTFNDDS EQU   *                                                 A50977 24520002
         BAL   LISTREG,ENT2FDLD                                  A50977 24540002
         DC    FL1'6'             SELECT A MESSAGE               A50977 24560002
         DC    FL1'1'             SUPPRESS THE WRITE             A50977 24580002
         DC    FL1'48'            PLACE IT IN PRINT POS 48       A50977 24600002
         DC    FL1'28'            USE MESSAGE NUMBER 28          A50977 24620002
         DC    FL1'6'             SELECT A MESSAGE               A50977 24640002
         DC    FL2'63'            PLACE IT IN PRINT POS 63       A50977 24660002
         DC    FL1'72'            USE MESSAGE NUMBER 72          A50977 24680002
         DC    FL1'4'                                            A50977 24700002
         DC    AL3(RPTVTOC)                                      A50977 24720002
VTOC2    EQU   *                                                        24740002
         BAL   LISTREG,ENT2FDLD                                         24760002
         DC    FL1'6'             SELECT A MESSAGE                      24780002
         DC    FL1'1'             SUPPRESS THE WRITE                    24800002
         DC    FL1'48'            PLACE IT IN PRINT POS. 48             24820002
         DC    FL1'28'            WE ARE AFTER MSG NUMBER 28            24840002
         DC    FL1'6'             SELECT A MESSAGE                      24860002
         DC    FL2'63'            PLACE IT IN PRINT POS. 63             24880002
         DC    FL1'25'            MSG NUMBER 25                         24900002
         DC    FL1'4'                                                   24920002
         DC    AL3(RPTVTOC)                                             24940002
VTOC3    EQU   *                       RETURN CODE OF X'03'    @VS30028 24960003
         BAL   LISTREG,ENT2FDLD                                         24980002
         DC    FL1'6'             SELECT A MESSAGE                      25000002
         DC    FL1'1'             SUPPRESS THE WRITE                    25020002
         DC    FL1'48'            PLACE IT IN PRINT POS. 48             25040002
         DC    FL1'28'            WE ARE AFTER MSG NUMBER 28            25060002
         DC    FL1'6'             SELECT A MESSAGE                      25080002
         DC    FL2'63'            PLACE IT IN PRINT POS. 63             25100002
         DC    FL1'26'            MSG NUMBER 26                         25120002
         DC    FL1'4'                                                   25140002
         DC    AL3(RPTVTOC)                                             25160002
VTOC4    EQU   *                       RETURN CODE OF X'04'    @VS30028 25180003
         BAL   LISTREG,ENT2FDLD                                         25200002
         DC    FL1'6'             SELECT A MESSAGE                      25220002
         DC    FL1'1'             SUPPRESS THE WRITE                    25240002
         DC    FL1'48'            PLACE IT IN PRINT POS. 48             25260002
         DC    FL1'28'            WE ARE AFTER MSG NUMBER 28            25280002
         DC    FL1'6'             SELECT A MESSAGE                      25300002
         DC    FL2'63'            PLACE IT IN PRINT POS. 63             25320002
         DC    FL1'29'            MSG NUMBER 29                         25340002
         DC    FL1'4'                                                   25360002
         DC    AL3(RPTVTOC)                                             25380002
VTOC56   EQU   *                       CODE OF X'05' OR X'06'  @VS30028 25380203
         BAL   LISTREG,ENT2FDLD        GET NEXT ENTRY IN TABLE @VS30028 25380403
         DC    FL1'6'                  SELECT A MESSAGE        @VS30028 25380603
         DC    FL1'1'                  SUPPRESS THE WRITE      @VS30028 25380803
         DC    FL1'48'                 PRINT POSITION 48       @VS30028 25381003
         DC    FL1'28'                 MESSAGE NUMBER 28       @VS30028 25381203
         DC    FL1'6'                  SELECT A MESSAGE        @VS30028 25381403
         DC    FL2'63'                 PRINT POSITION 63       @VS30028 25381603
         DC    FL1'76'                 MESSAGE NUMBER 76       @VS30028 25381803
         DC    FL1'4'                  FLAG BYTE               @VS30028 25382003
         DC    AL3(RPTVTOC)            ROUTINE ADDRESS         @VS30028 25382203
VTOC7    EQU   *                       RETURN CODE OF X'07'    @VS30028 25382403
         BAL   LISTREG,ENT2FDLD        GET NEXT ENTRY IN TABLE @VS30028 25382603
         DC    FL1'6'                  SELECT A MESSAGE        @VS30028 25382803
         DC    FL1'1'                  SUPPRESS THE WRITE      @VS30028 25383003
         DC    FL1'48'                 PRINT POSITION 48       @VS30028 25383203
         DC    FL1'28'                 MESSAGE NUMBER 28       @VS30028 25383403
         DC    FL1'6'                  SELECT A MESSAGE        @VS30028 25383603
         DC    FL2'63'                 PRINT POSITION 63       @VS30028 25383803
         DC    FL1'75'                 MESSAGE NUMBER 75       @VS30028 25384603
         DC    FL1'4'                  FLAG BYTE               @VS30028 25384803
         DC    AL3(RPTVTOC)            ROUTINE ADDRESS         @VS30028 25385003
VTOC8    EQU   *                       RETURN CODE OF X'08'    @Z40RSDS 25386008
         BAL   LISTREG,ENT2FDLD        GET NEXT ENTRY IN TABLE @Z40RSDS 25387008
         DC    FL1'6'                  SELECT A MESSAGE        @Z40RSDS 25388008
         DC    FL1'1'                  SUPPRESS THE WRITE      @Z40RSDS 25389008
         DC    FL1'48'                 PRINT POSITION 48       @Z40RSDS 25390008
         DC    FL1'28'                 MESSAGE NUMBER 28       @Z40RSDS 25391008
         DC    FL1'6'                  SELECT A MESSAGE        @Z40RSDS 25392008
         DC    FL2'63'                 PRINT POSITION 63       @Z40RSDS 25393008
         DC    FL1'77'                 MESSAGE NUMBER 77       @Z40RSDS 25394008
         DC    FL1'4'                  FLAG BYTE               @Z40RSDS 25395008
         DC    AL3(RPTVTOC)            ROUTINE ADDRESS         @Z40RSDS 25396008
VTOCERR  EQU   *                                                 A25564 25420002
         OI    ERRFLD,X'12'            STORE RETURN CODE OF 12   A25564 25440002
         CNOP  0,4                     ALIGN TO FULLWORD       @Z40RSDS 25460008
         BAL   LISTREG,ENT2FDLD                                         25480002
         DC    X'08000000'                                              25500002
         DC    FL1'6'                                                   25520002
         DC    FL1'1'                                                   25540002
         DC    FL2'29'                                                  25560002
         DC    FL1'4'                                                   25580002
         DC    AL3(ABEOJ+4)                                             25600002
VTOCEND  BAL   LISTREG,ENT2FDLD                                         25620002
         DC    X'08000000'                                              25640002
         DC    FL1'6'             SELECT A MESSAGE                      25660002
         DC    FL3'34'            EXIT THROUGH HERE                     25680002
*                                                                       25700002
*        WE NEED AN INSERT HERE TO CLOSE THE DCB FOR THE VTOC           25720002
*                                                                       25740002
         DC    X'09000000'                                              25760002
BLDG     DS    0F                                                       25780002
         DC    FL1'7'                  BRANCH TO EXECUTE           4621 25800002
         DC    AL3(MVECT)              MOVE ENTRIES TO LST         4621 25820002
         DC    A(SVCINDX)                                               25840002
         DC    X'0102030005060008'                                      25860002
         DC    FL4'0'                                                   25880002
         DC    FL4'0'                                            A31333 25900002
         DC    X'00001400'                                       A31333 25920002
         DC    X'1302050A0B0C0800'                             @Z40CSJH 25940008
*                                                                       25960002
*        THE FOLLOWING BRANCH TABLE IS USED TO INTERPRET THE            25980002
*        ERROR RETURNS FROM CATALOG AND INDEX  BY CONTROLLING           26000002
*        THE PROGRAM FLOW UPON RETURN FROM THE SUPERVISOR               26020002
*                                 CODE      AFTER TRANSLATION           26040002
BRANTAB  B     UNKERR              00       UNDEFINED ERROR             26060002
         B     OKEND               01       NORMAL E.O.J.               26080002
         B     NOVOL               02       CVOL IS NOT AVAILIBLE       26100002
         B     INDEX8              03       CHECK CODE IN REG 1         26120002
         B     IXNOTMT             04       INDEX NOT EMPTY             26140002
         B     NEEDINDX            05       HAVE TO BUILD AN INDEX      26160002
         B     NOSPACE             06       RAN OUT OF SPACE            26180002
         B     GDGNAME             07       BAD NAME FOR A GENERATION   26200002
         B     IOERRCAT            08       I/O ERROR IN SYSCATLG       26220002
         B     DSFOUNDX            09       NAME IS A DATA SET          26240002
         B     IXFOUNDX            0A       WE FOUND AN INDEX           26260002
         B     NOTIXSTR            0B       NOT AN INDEX STRUCTURE      26280002
         B     SYNTAX              0C       ERROR IN SYNTAX             26300002
         B     SCANIT              0D       BUILD ANOTHER INDEX         26320002
         B     DSNOTCAT            0E       DATA SET NOT CATALOGED      26340002
         B     XNOTHERE            0F       INDEX DOES NOT EXIST        26360002
         B     RESCR8              10       ERROR FROM SVC 29 OR 30     26380002
         B     VTOCRET             11       RETURN FROM SCRATCH VTOC    26400002
         B     MEMBEROK            12       OK TO PROCESS MEMBER        26420002
         B     APROBLEM            13       UNDETERMINABLE ERROR        26440002
         B     VTOCDOS             14       VTOC IS DOS          A31333 26460002
         B     BADVOLST            15       RC=12 FROM SVC29,30  A57261 26480002
*                                                                       26500002
*                                                                       26520002
APROBLEM DS    0F                                                       26540002
         BAL   LISTREG,ENT2FDLD                                         26560002
         DC    FL1'6'              INFORM THE USER THAT                 26580002
         DC    FL3'37'             EITHER HIS REQUEST IS NOT            26600002
         DC    FL1'6'              PROPER OR THAT IT CANNOT             26620002
         DC    FL1'1'              BE SERVICED WITHIN THE               26640002
         DC    FL2'54'             PRESENT CATALOG STRUCTURE            26660002
         DC    FL1'4'                                                   26680002
         DC    AL3(ABEOJ+4)        TAKE THE ABNORMAL EXIT               26700002
*                                                                       26720002
*                                                                       26740002
DSFOUNDX DS    0F                 FOR ALLIGNMENT                        26760002
         BAL   LISTREG,ENT2FDLD     BEGONE...TO DECODE THIS LIST        26780002
         DC    FL1'6'                                                   26800002
         DC    FL3'37'            INFORM THE USER THAT                  26820002
         DC    FL1'6'             A DATA SET HAVING                     26840002
         DC    FL1'1'             THIS NAME IS CATALOGED                26860002
         DC    FL2'7'             AND THIS INDEX CANNOT                 26880002
         DC    FL1'6'             BE BUILT FOR HIM                      26900002
         DC    FL1'3'                                                   26920002
         DC    FL2'38'                                                  26940002
         DC    FL1'4'                                                   26960002
         DC    AL3(ABEOJ+4)       TAKE THE ABNORMAL EXIT                26980002
*                                                                       27000002
*                                                                       27020002
IXNOTMT  DS    0F                  FOR ALLIGNMENT                       27040002
         BAL   LISTREG,ENT2FDLD    BE GONE.....TO DECODE THIS LIST      27060002
         DC    FL1'6'                                                   27080002
         DC    FL3'37'             INFORM THE USER THAT                 27100002
         DC    FL1'6'              THE SPECIFIED INDEX                  27120002
         DC    FL1'1'              IS NOT EMPTY OR HAS                  27140002
         DC    FL2'39'             AN ALIAS.                            27160002
         DC    FL1'4'                                                   27180002
         DC    AL3(ABEOJ+4)        TAKE THE ABNORMAL EXIT               27200002
*                                                                       27220002
*                                                                       27240002
NOSPACE  DS    0F                                                       27260002
         BAL   LISTREG,ENT2FDLD                                         27280002
         DC    FL1'6'                                                   27300002
         DC    FL3'37'             INFORM THE USER THAT                 27320002
         DC    FL1'6'              SYSCATLG DATA SET                    27340002
         DC    FL1'1'              HAS RUN OUT OF SPACE                 27360002
         DC    FL2'40'                                                  27380002
         DC    FL1'4'                                                   27400002
         DC    AL3(ABEOJ+4)        TAKE THE ABNORMAL EXIT               27420002
*                                                                       27440002
*                                                                       27460002
IXFOUNDX DS    0F                                                       27480002
         BAL   LISTREG,ENT2FDLD                                         27500002
         DC    FL1'6'                                                   27520002
         DC    FL3'37'             INFORM THE USER THAT                 27540002
         DC    FL1'6'              THE NAME THAT IS                     27560002
         DC    FL1'1'              SPECIFIED IS CURRENTLY               27580002
         DC    FL2'7'              AN EXISTING INDEX LEVEL              27600002
         DC    FL1'6'                                                   27620002
         DC    FL1'3'                                                   27640002
         DC    FL2'43'                                                  27660002
         DC    FL1'4'                                                   27680002
         DC    AL3(ABEOJ+4)        ABNORMAL EXIT                        27700002
*                                                                       27720002
*                                                                       27740002
SYNTAX   DS    0F                                                       27760002
         BAL   LISTREG,ENT2FDLD                                         27780002
         DC    FL1'6'                                                   27800002
         DC    FL3'37'             INFORM THE USER THAT A               27820002
         DC    FL1'6'              SYNTAX ERROR EXISTS IN               27840002
         DC    FL1'1'              THE SPECIFIED NAME                   27860002
         DC    FL2'46'                                                  27880002
         DC    XL4'06030007'                                            27900002
         DC    FL1'4'                                                   27920002
         DC    AL3(ABEOJ+4)        ABNORMAL EXIT                        27940002
*                                                                       27960002
*                                                                       27980002
GDGNAME  DS    0F                       ALLIGN THE LIST                 28000002
         BAL   LISTREG,ENT2FDLD                                         28020002
         DC    FL1'6'              INFORM THE USER THAT                 28040002
         DC    FL3'37'                                                  28060002
         DC    FL1'6'              HE HAS ATTEMPTED TO                  28080002
         DC    FL1'1'              CATALOG A DATA SET                   28100002
         DC    FL2'7'              NAME THAT IS NOT                     28120002
         DC    FL1'6'              VALID...                             28140002
         DC    FL1'3'                                                   28160002
         DC    FL2'41'                                                  28180002
         DC    FL1'4'                                                   28200002
         DC    AL3(ABEOJ+4)        TAKE THE ABNORMAL EXIT               28220002
*                                                                       28240002
*                                                                       28260002
IOERRCAT DS    0F                                                       28280002
         BAL   LISTREG,ENT2FDLD                                         28300002
         DC    FL1'6'              INFORM THE USER THAT                 28320002
         DC    FL3'37'                                                  28340002
         DC    FL1'6'              A PERMANENT ERROR                    28360002
         DC    FL1'1'              WAS ENCOUNTERED IN                   28380002
         DC    FL2'29'             THE SYSCTLG DATA SET                 28400002
         DC    FL1'6'                                                   28420002
         DC    FL1'3'                                                   28440002
         DC    FL2'42'                                                  28460002
         DC    FL1'4'                                                   28480002
         DC    AL3(ABEOJ+4)        ABNORMAL EXIT                        28500002
*                                                                       28520002
*                                                                       28540002
DSNOTCAT DS    0F                                                       28560002
         BAL   LISTREG,ENT2FDLD                                         28580002
         DC    FL1'6'                                                   28600002
         DC    FL3'37'             INFORM THE USER THAT                 28620002
         DC    FL1'6'              THE SPECIFIED DATA                   28640002
         DC    FL1'1'              SET NAME IS NOT                      28660002
         DC    FL2'7'              CATALOGED.                           28680002
         DC    FL1'6'                                                   28700002
         DC    FL1'3'                                                   28720002
         DC    FL2'47'                                                  28740002
         DC    FL1'4'              TAKE THE ABNORMAL EXIT               28760002
         DC    AL3(ABEOJ+4)                                             28780002
*                                                                       28800002
*                                                                       28820002
XNOTHERE DS    0F                  INFORM THE USER THAT                 28840002
         BAL   LISTREG,ENT2FDLD                                         28860002
         DC    FL1'6'              THE INDEX THAT HE                    28880002
         DC    FL3'37'             HAS SPECIFIED DOES                   28900002
         DC    FL1'6'              NOT EXIST.                           28920002
         DC    FL1'1'                                                   28940002
         DC    FL2'44'                                                  28960002
         DC    FL1'4'                                                   28980002
         DC    AL3(ABEOJ+4)        ABNORMAL EXIT                        29000002
*                                                                       29020002
*                                                                       29040002
NOTIXSTR DS    0F                                                       29060002
         BAL   LISTREG,ENT2FDLD                                         29080002
         DC    FL1'6'                                                   29100002
         DC    FL3'37'                                                  29120002
         DC    FL1'6'              NO SUCH INDEX CAN                    29140002
         DC    FL3'44'             EXIST  THE  NECESSARY                29160002
         DC    FL1'6'              INDEX STRUCTURE  IS                  29180002
         DC    FL1'1'              TERMINATED WITH A DATA               29200002
         DC    FL2'45'             SET.                                 29220002
         DC    FL1'4'                                                   29240002
         DC    AL3(ABEOJ+4)        ABNORMAL EXIT                        29260002
*                                                                A31333 29280002
*     VTOC NOT CONVERTED FROM DOS TO OS , ISSUE MESSAGE IEH230I  A31333 29300002
*                                                                A31333 29320002
VTOCDOS  DS    0F                                                A31333 29340002
         BAL   LISTREG,ENT2FDLD                                  A31333 29360002
         DC    FL1'6'                                            A31333 29380002
         DC    FL3'37'            PRINT MESSAGE 37               A31333 29400002
         DC    FL1'6'                                            A31333 29420002
         DC    FL3'68'            PRINT MESSAGE 68               A31333 29440002
         DC    FL1'6'                                            A31333 29460002
         DC    FL1'1'             SUPRESS PRINT                  A31333 29480002
         DC    FL2'69'            PRINT MESSAGE 69               A31333 29500002
         DC    FL1'4'                                            A31333 29520002
         DC    AL3(ABEOJ+4)                                      A31333 29540002
*                                                                       29560002
BADVOLST EQU   *                                                 A57261 29580002
         BAL   LISTREG,ENT2FDLD                                  A57261 29600002
         DC    FL1'6'             PRINT A MESSAGE                A57261 29620002
         DC    FL1'1'             SUPRESS THE PRINT              A57261 29640002
         DC    FL2'20'            MESSAGE NUMBER 20              A57261 29660002
         DC    FL1'6'             PRINT A MESSAGE                A57261 29680002
         DC    FL1'3'                                            A57261 29700002
         DC    FL2'5'             MESSAGE NUMBER 5               A57261 29720002
         DC    FL1'6'             PRINT A MESSAGE                A57261 29740002
         DC    FL1'3'                                            A57261 29760002
         DC    FL2'21'            MESSAGE NUMBER 21              A57261 29780002
         DC    FL1'6'             PRINT A MESSAGE                A57261 29800002
         DC    FL1'2'                                            A57261 29820002
         DC    FL2'7'             MESSAGE NUMBER 7               A57261 29840002
         DC    FL1'6'             PRINT A MESSAGE                A57261 29860002
         DC    FL2'10'            PRINT POSITION                 A57261 29880002
         DC    FL1'22'            MESSAGE NUMBER 22              A57261 29900002
         DC    A(VOLERMSG)                                       A57261 29920002
VOLERMSG EQU   *                                                 A57261 29972402
         BALR  R7,0                                              A57261 29976202
         USING *,R7                                              A57261 29980002
         L     R10,CSECT2AD                                      A57261 30000002
         DROP  R7                                                A57261 30020002
         MVI   MSGOUT+93,C'*'                                    A57261 30040002
         MVC   MSGOUT+94(2),MSGOUT+93                            A57261 30060002
         BAL   LISTREG,ENT2FDLD                                  A57261 30080002
         DC    FL1'6'             PRINT A MESSAGE                A57261 30100002
         DC    FL1'1'             SUPRESS PRINT                  A57261 30120002
         DC    FL1'28'            PRINT POSITION 28              A57261 30140002
         DC    FL1'28'            MESSAGE NUMBER 28              A57261 30160002
         DC    FL1'6'             PRINT A MESSAGE                A57261 30180002
         DC    FL2'43'            PRINT POSITION 43              A57261 30200002
         DC    FL1'74'            MESSAGE NUMBER 74              A57261 30220002
         DC    A(ENDERR)                                         A57261 30240002
*                                                                       30260002
*        THIS ROUTINE IS USED TO BUILD THE NECCESSARY INDECIES          30280002
*        THAT ARE REQUIRED TO SERVICE A REQUEST FOR CATALOGING          30300002
*        A DATA SET UNDER AN INDEX STRUCTURE THAT DOES NOT PRESENTLY    30320002
*        EXIST ON THE CONTROL VOLUME BEING ACTED UPON.                  30340002
*                                                                       30360002
NEEDINDX ST    R9,FLSTADDR        SAVE THE ORIGINAL SVC LOCATION        30380002
         LA    R3,PARAM2          START ADDRESS                         30400002
         LA    R4,1               INCREMENT                             30420002
         LA    R5,PARAM2+43       STOPADDRESS                           30440002
         STM   R3,R5,IEHESTT      STORE SEARCH DATA                     30460002
SCANIT   LM    R3,R5,IEHESTT      RETRIEVE SEARCH DATA                  30480002
         BXH   R3,R4,FRECOVER     TEST FOR END OF SEARCH                30500002
         ST    R3,IEHESTT         STORE SEARCH DATA                     30520002
         MVC   IEHECODE(1),0(R3)  SAVE THE CHARACTER                    30540002
         CLI   0(R3),C'.'         IS IT A PERIOD                        30560002
         BNE   CHKPAREN           NO .... BRANCH                        30580002
         MVI   0(R3),C' '         REPLACE WITH A BLANK                  30600002
         MVC   IEHEMAC2(4),BLDXBITS                                     30620002
         B     BUILDIT            GO BUILD THE INDEX                    30640002
CHKPAREN CLI   0(R3),C'('         IS IT A LEFT PARENTHESIS              30660002
         BNE   SCANIT             NO .... BRANCH                        30680002
         B     GDGNAME       DO NOT BUILD A GENERATION INDEX            30700002
         MVC   IEHEMAC2(4),BLDGBITS                                     30720002
BUILDIT  EQU   *                                                        30740002
         MVC   IEHEMAC2+4(12),IEHEMAC1+4                                30760002
         TM    IEHEMAC1,X'80'     ARE WE USING A CONTROL VOLUME         30780002
         BZ    *+8                NO ..... BRANCH                       30800002
         OI    IEHEMAC2,X'80'     BUILDX ON A CONTROL VOLUME            30820002
         MVC   IEHERSAV(44),PARAM2      SAVE THE INDEX NAME             30840002
      CATALOG  IEHEMAC2                 SVC TO BUILD THE INDEX          30860002
         MVC   PARAM2(44),IEHERSAV      RESTORE THE INDEX NAME          30880002
         MVC   0(1,R3),IEHECODE    RESTORE THE DELIMITER                30900002
         LA    R3,BXMATRIX                                              30920002
         ST    R3,FINUSE          POINT AT THE MATRIX TO BE USED        30940002
         B     AFTERCAT                FOR ERROR ANALYSIS..BEGONEA25564 30960002
UNCATCON DC    C'UNCATLG'                                        A25564 30980002
BXMATRIX DC    X'0D02030000060008'                                      31000002
         DC    FL4'0'             RESERVED FOR EXPANSION                31020002
         DC    FL4'0'                                            A31333 31040002
         DC    X'00001400'                                       A31333 31060002
         DC    X'0902050D0B0C0800'                                      31080002
*                                                                       31100002
* CONSTANTS AND ADDRESSES                                      @VS30028 31120003
*                                                                       31140003
*                                                              @VS30028 31141003
*        THE FOLLOWING TABLE INTERPRETS THE STOW ERROR RETURN  @VS30028 31142003
*        CODES TO CORRESPOND TO THE SCRATCH/RENAME ERROR CODE  @VS30028 31143003
*        BRANCH TABLE LABELED 'SCRESTBL'. THE INTERPRETED      @VS30028 31144003
*        CODES X'0A' - X'0C' ARE USED BY STOW ALONE.           @Z40RSDS 31145008
*                                                              @VS30028 31146003
*        STOW                              CORRESPONDING       @VS30028 31147003
*        RETURN                            ERROR CODE IN       @VS30028 31148003
*        CODE    EXPLANATION               COMMON TABLE        @VS30028 31149003
*                                                              @VS30028 31150003
*        X'04'   NEW NAME ALREADY EXISTS   X'03'               @VS30028 31151003
*        X'08'   NAME NOT FOUND            X'01'               @VS30028 31152003
*        X'0C'   DIRECTORY IS FULL         X'0B'               @Z40RSDS 31153008
*        X'10'   I/O ERROR OCCURRED        X'04'               @VS30028 31154003
*        X'14'   DCB NOT OPENED            X'0A'               @VS30028 31155003
*        X'18'   GETMAIN UNSUCCESSFUL      X'0C'               @Z40RSDS 31156008
*                                                              @VS30028 31157003
STOWTAB  EQU   *-1                                                      31160002
         DC    X'03010B040A0C'    INTERPRET STOW RETURN CODE   @Z40RSDS 31180008
BLDXBITS DC    X'04400000'        BUILD INDEX                           31200002
BLDGBITS DC    X'04200005'        BUILD GENERATION - FIVE ENTRIES       31220002
DUMP     DCB   DDNAME=DUMPIT,DSORG=PS,RECFM=VBA,BLKSIZE=1632,          X31270002
               LRECL=125,MACRF=(W)                                      31272002
         LTORG                                                 @ZA13801 31275008
         EJECT                                                 @VS30028 31278003
DSECT    DSECT                                                          31280002
IEHECHAR DS    C         CHARACTER TO BE SCANNED FOR                    31300002
IEHECOND DS    C         CONDITION CODE TO STOP ON                      31320002
IEHECODE DS    C                                                        31340002
IEHEARGL DS    C                                                        31360002
IEHESTT  DS    F                                                        31380002
IEHESTP  DS    F                                                        31400002
IEHEFND  DS    F                                                        31420002
IEHETBL  DS    F                                                        31440002
IEHEFUN  DS    F                                                        31460002
IEHESCNX DS    3F                                                       31480002
IEHEMAC1 DS    7F                 PARAMETER LIST                 S21046 31500002
IEHEMAC2 DS    6F                                                       31520002
IEHESTIN DS    F                                                        31540002
IEHENDIN DS    F                                                        31560002
IEHECCNT DS    2C                                                       31580002
IEHESW1  DS    C                                                        31600002
DUPSW    DS    2C                 SWITCHES FOR TEST OF DUPLICATE S21046 31620002
*                                 PARAMETERS                     S21046 31640002
PPARAMSW DS    CL2                                                      31660002
IEHESW5  DS    C                                                        31680002
IEHESW6  DS    C                                                        31700002
IEHECALL DS    F                                                        31720002
         DS    0D                                                       31740002
DBLWORD  DS    F                                                        31760002
FULLWORD DS    F                                                        31780002
         DS    0D                                                       31800002
DECB1    DS    24X                                                      31820002
DECB2    DS    24X                                                      31840002
VOLISTAD DS    F                                                        31860002
MATRIXIU DS    F                                                        31880002
VDTIU    DS    F                                                        31900002
VOLPAREN DS    FL2                                                      31920002
VSRCM    DS    2X                                                       31940002
VDSA     DS    X                                                        31960002
DFLG     DS    X                                                   BS0H 31980002
DFLAG    DS    X                                                   BS0H 32000002
         DS    0F                                                       32020002
FLSTADDR DS    F                                                        32040002
FNSA     DS    12X                                                      32060002
KWSA     DS    12X                                                      32080002
SCANRET  DS    F                                                        32100002
MARESAR  DS    72X                                                      32120002
IEHESPC  DS    XL20                                                     32140002
         DS    XL20                                                     32160002
IEHERSAV DS    64X                                                      32180002
PASSUNIT DS    5X                                                  DT0I 32200002
MOUNTSW  DS    X                                                   DT0I 32220002
TABLEAD  DS    F                  ADDRESS OF DEVICE NAME TABLE     I276 32240002
IEHESW2  DS    X                  PROTECT SWITCHES               S21046 32260002
*                                 BIT 1=1 IF WE ARE TO PRINT     S21046 32280002
*                                        CONTROL CARDS           S21046 32300002
*                                 BIT 3=1 INDICATES FIRST QUOTE  S21046 32320002
*                                        IN SCAN FOR DATA        S21046 32340002
*                                        OPERATION IS FOUND      S21046 32360002
*                                 BIT 4= 1 IF WTOR SETUP IS DONE S21046 32380002
*                                 BIT 6 =1 IF FIRST PARM ENTRY   S21046 32400002
*                                 WAS VALID                      S21046 32420002
*                                 BIT 7 =1 IF INVALID ENTRY MSG  S21046 32440002
*                                 HAS BEEN PRINTED               S21046 32460002
PASWDCT1 DS    1X                 NUMBER OF PROMPTS FOR PASWORD1 S21046 32480002
PASWDCT3 DS    1X                 NUMBER OF PROMPTS FOR CPASWORD S21046 32500002
TOTALPS  DS    1X                 TOTAL NO OF OPERATOR REPLIES   S21046 32520002
WTORECB  DS    1F                 EVENT CONTROL BLOCK FOR WTOR   S21046 32540002
TIOTADRS DS    1F                 TIOT ADDRESS FOR WTOR          S21046 32560002
CCNAME   DS    8C                 NAME OFF CONTROL CARD          S21046 32580002
WTORLIST WTOR  'IEH220A JOBNAMES, STEPNAME, CARDNAME, REPLY WITH PASSWOX32600002
               RD',,8,WTORECB,ROUTCDE=(9),DESC=2,MF=L            S21046 32620002
EXTRACTO EXTRACT ,'S',FIELDS=(TIOT),MF=L                         S21046 32640002
DCBAREA  DS    0F                                                       32660002
UTINDCB  DCB   DSORG=PS,MACRF=(GM)                                      32680002
CODELIST DC    C'.,=()   '        SPECIAL CHARACTERS CODED BY SCAN      32700002
MAXLINES DC    FL2'45'             MAXIMUM LINES PER PAGE               32720002
LINECNT  DC    FL2'0'              LINE COUNT FIELD                     32740002
SKIP21   DC    X'8B'               SKIP TO 1 COMMAND                    32760002
WRITEHDR DC    X'19'               SPACE 3 AFTER PRINT                  32780002
HEADER   DC    CL30'MODIFY....VERSION BETA-1......'                     32800002
         DC    CL30'LAST UPDATED....JULY 11  10 PM'                     32820002
         DC    CL30'                              '                     32840002
         DC    CL30'               PAGE 001       '                     32860002
PAGENUM  EQU   HEADER+110                                               32880002
DDNAMES  DS    3CL8                     FOR THREE DD NAMES              32900002
UTOUTDCB DCB   DSORG=PS,MACRF=(PM)                                      32920002
         DS    2F                                                       32940002
CTRLWORD DS    0F       REG 13 SAVED, SWITCHES FOR VOLUME MOUNTING      32960002
IEHESAT  DS    150X                                                     32980002
READBASE DC    F'0'                                                     33000002
ERRFLD   DS    0CL8          FOR POSTING OF ERROR RETURN CODES          33020002
PARAM1   DS    44X                                                      33040002
         DS    F              FOR  LENGTH OF  PARAM2                    33060002
PARAM2   DS    44X                                                      33080002
         DS    F                   FOR LENGTH OF PARAM3                 33100002
PARAM3   DS    44X                                                      33120002
PARAM5   DS    2F                 CPASWORD PARAMETER             S21046 33140002
PARAM6   DS    151F               VOL IDS PARAMETER              S21046 33160002
PARAM7   DS    2F                 PASSWORD2 PARAMETER            S21046 33180002
PARAM8   DS    80X                DATA PARAMETER                 S21046 33200002
DUMMY    DS    1F                 TEMPORARY STORAGE FIELD        S21046 33220002
PROTCTAD DS    1F                 ADDRESS OF WHERE TO PUT NEXT   S21046 33240002
*                                 VOL ID IN PARAM6 FOR PROTECT   S21046 33260002
FINUSE   DS    F                   ADDR OF DC LIST IN USE               33280002
DCSAVEAD DS    F                   SAVE AREA FOR ADDR OF DC LIST        33300002
INPUT    DS    40F                 TWO CARD INPUT AREA                  33320002
MSGOUT   DS    30F                 MSG OUTPUT AREA                      33340002
         DS    F                                                        33360002
         DS    0D                                                       33380002
PARAM4   DS    151F                FOR A VOLUME LIST                    33400002
EOCORE   EQU   *-12                                                     33420002
         ORG   PARAM4+20                                                33440002
VTOCDCB2 DS    0F                                                       33460002
DCB4VTOC DCB   DDNAME=VTOC,                                            .33480002
               DSORG=PS,                                               .33500002
               MACRF=R,                                                .33520002
               KEYLEN=44,                                              .33540002
               BLKSIZE=1,                                              .33560002
               RECFM=U,                                                .33580002
               EODAD=VTOCEND,                                          .33600002
               SYNAD=VTOCERR,                                          .33620002
               EXLST=VTOCEND                                            33640002
JFCB     DS    24D                                                      33660002
*        THE FOLLOWING ORG STATEMENT IS FLAGGED                  YM5077 33680002
         ORG                                                            33700002
SAVEREG2 DS    72X                SECONDARY SAVE AREA             M2838 33720002
SAVEREG3 DS    72X                THIRD LEVEL SAVE AREA           M2838 33740002
         ORG                                                            33760002
VTOCSW   EQU   JFCB+50                                                  33780002
VTOCDECB EQU   JFCB+60                                                  33800002
JFCBVOL  EQU   JFCB+118                                                 33820002
EXLST2   EQU   DCB4VTOC+36                                              33840002
FORMATID EQU   PARAM2+44                                                33860002
BLANK    EQU   64                                                       33880002
READTOO  EQU   INPUT+72                                                 33900002
COL16    EQU   READTOO+15                                               33920002
COL72    EQU   READTOO+71                                               33940002
MIDDLE   EQU   READTOO-1                                                33960002
WARE2PUT EQU   IEHEMAC1-4                                               33980002
UCBAD1   EQU   IEHESAT+16                                               34000002
         END                                                            34020002
