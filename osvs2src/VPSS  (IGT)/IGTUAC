TUAC     TITLE 'IGTUAC -- FREE SAVEAREA/WORKAREA'                       00500000
IGTUAC   CSECT ,                   FREE SAVEAREA - WORKAREA             01000000
*/* * START OF SPECIFICATIONS ************************************** */ 01500000
*/*                                                                  */ 02000000
*/*   MODULE-NAME = IGTUAC                                           */ 02500000
*/*                                                                  */ 03000000
*/*   DESCRIPTIVE-NAME = FREE SAVEAREA/WORKAREA                      */ 03500000
*/*                      (IGTYFSV MACRO SUPPORT)                     */ 04000000
*/*                                                                  */ 04500000
*/*   COPYRIGHT = NONE                                               */ 05000000
*/*                                                                  */ 05500000
*/*   STATUS = RELEASE 1, MODIFICATION LEVEL 0.                      */ 06000000
*/*                                                                  */ 06500000
*/*   FUNCTION = THIS ROUTINE WILL RELEASE THE SAVEAREA/WORKAREA     */ 07000000
*/*       OF THE EXITING SUBROUTINE.  IF ANY STORAGE AREAS WERE      */ 07500000
*/*       OBTAINED FOR THIS SUBROUTINE (DESCRIBED BY APSM),          */ 08000000
*/*       THEY ARE FREEMAINED (NOTE THAT THIS MAY INCLUDE THE        */ 08500000
*/*       SAVEAREA ITSELF).  THIS ROUTINE SUPPORTS THE IGTYFSV       */ 09000000
*/*       MACRO.                                                     */ 09500000
*/*       STORAGE MANAGEMENT IS LIFO (LAST ACQUIRED STORAGE MUST     */ 10000000
*/*       BE INITIALLY RELEASED STORAGE).                            */ 10500000
*/*                                                                  */ 11000000
*/*   NOTES =                                                        */ 11500000
*/*     THIS MACRO MUST SUPPORT PARAMETERS GENERATED BY THE          */ 12000000
*/*     FREEMAIN R,LV= MACRO (USED FOR PL/S WITH STACK OPTION)       */ 12500000
*/*                                                                  */ 13000000
*/*     DEPENDENCIES =                                               */ 13500000
*/*        REGISTER 1 MUST POINT TO A VPSS EXTENDED SAVEAREA         */ 14000000
*/*        (APSV) WHICH HAS BEEN CREATED BY IGTUAA, IGTUAC, OR       */ 14500000
*/*        IGTUAF.                                                   */ 15000000
*/*                                                                  */ 15500000
*/*     RESTRICTIONS =                                               */ 16000000
*/*        SINCE THIS ROUTINE MAY BE ENTERED IN EITHER PROBLEM OR    */ 16500000
*/*        SUPERVISOR STATE AND IN ANY KEY, THIS PROGRAM MAY NOT     */ 17000000
*/*        ISSUE PRIVLEDGED INSTRUCTIONS OR UPDATE SYSTEM CONTROL    */ 17500000
*/*        BLOCKS.                                                   */ 18000000
*/*                                                                  */ 18500000
*/*     REGISTER-CONVENTIONS = STANDARD VPSS CONVENTIONS             */ 19000000
*/*                                                                  */ 19500000
*/*     PATCH-LABEL = APPATCH                                        */ 20000000
*/*                                                                  */ 20500000
*/*   MODULE-TYPE = CSECT                                            */ 21000000
*/*                                                                  */ 21500000
*/*     PROCESSOR = VS/2 ASSEMBLER                                   */ 22000000
*/*                                                                  */ 22500000
*/*     MODULE SIZE = SEE END OF ASSEMBLER LISTING                   */ 23000000
*/*                                                                  */ 23500000
*/*     ATTRIBUTES = RE-ENTRANT.                                     */ 24000000
*/*                                                                  */ 24500000
*/*   ENTRY-POINT = IGTUAC                                           */ 25000000
*/*                                                                  */ 25500000
*/*     PURPOSE = SAME AS FUNCTION                                   */ 26000000
*/*                                                                  */ 26500000
*/*     LINKAGE = ENTERED UNLOCKED, TASK MODE, ENABLED. MAY BE       */ 27000000
*/*               IN ANY KEY AND EITHER PROBLEM OR SUPERVISOR        */ 27500000
*/*               STATE.                                             */ 28000000
*/*                                                                  */ 28500000
*/*     INPUT = THE FOLLOWING REGISTERS ARE INITIALIZED ON ENTRY     */ 29000000
*/*             (SET BY MACRO IGTYFSV) --                            */ 29500000
*/*         REGISTER  0 - IGNORED.                                   */ 30000000
*/*         REGISTER  1 - ADDRESS OF SAVEAREA/WORKAREA TO RELEASE    */ 30500000
*/*                       (MUST BE VPSS EXTENDED SAVEAREA -- APSV).  */ 31000000
*/*         REGISTER 12 - ADDRESS OF THE APCT                        */ 31500000
*/*         REGISTER 13 - IGNORED (DOES NOT HAVE TO BE SAVEAREA)     */ 32000000
*/*         REGISTER 14 - RETURN ADDRESS                             */ 32500000
*/*         REGISTER 15 - ADDRESS OF THIS ROUTINE (IGTUAC).          */ 33000000
*/*                                                                  */ 33500000
*/*     OUTPUT = THE SAVEAREA/WORKAREA POINTED TO BY REGISTER-1      */ 34000000
*/*              IS RELEASED.  IF ANY APSM WHERE ACQUIRED FOR THIS   */ 34500000
*/*              EXITING ROUTINE, THEY ARE NOW FREEMAINED.           */ 35000000
*/*                                                                  */ 35500000
*/*   EXIT-NORMAL = THE FOLLOWING REGISTERS ARE RETURNED TO THE      */ 36000000
*/*                 CALLER --                                        */ 36500000
*/*                 REGISTER  0 - UNPREDICTABLE                      */ 37000000
*/*                 REGISTER  1 - UNPREDICTABLE                      */ 37500000
*/*                 REGISTER 2-13 - SAME AS ON INPUT                 */ 38000000
*/*                 REGISTER 14 - RETURN ADDRESS                     */ 38500000
*/*                 REGISTER 15 - UNPREDICTABLE                      */ 39000000
*/*                                                                  */ 39500000
*/*   EXIT-ERROR  = NONE.                                            */ 40000000
*/*                                                                  */ 40500000
*/*   EXTERNAL-REFERENCES = THE FOLLOWING ROUTINES AND               */ 41000000
*/*                         CONTROL BLOCKS ARE USED.                 */ 41500000
*/*                                                                  */ 42000000
*/*     ROUTINES = NONE.                                             */ 42500000
*/*                                                                  */ 43000000
*/*     DATA-AREAS = NONE                                            */ 43500000
*/*                                                                  */ 44000000
*/*     CONTROL-BLOCKS =                                             */ 44500000
*/*         APCT     - R                                             */ 45000000
*/*         APSC     - R,    D                                       */ 45500000
*/*         APSM     - R,    D                                       */ 46000000
*/*         APSV     - R,    D                                       */ 46500000
*/*                                                                  */ 47000000
*/*   TABLES = NONE                                                  */ 47500000
*/*                                                                  */ 48000000
*/*   MACROS =                                                       */ 48500000
*/*       IGTXEPLG                                                   */ 49000000
*/*       FREEMAIN                                                   */ 49500000
*/*                                                                  */ 50000000
*/*   CHANGE-ACTIVITY = NONE                                         */ 50500000
*/*                                                                  */ 51000000
*/*   MESSAGES = NONE                                                */ 51500000
*/*                                                                  */ 52000000
*/*   ABEND-CODES = NONE                                             */ 52500000
*/*                                                                  */ 53000000
*/* * END OF SPECIFICATIONS **************************************** */ 53500000
         EJECT ,                                                        54000000
         COPY  IGTXSYSO            DEFINE SCP CHARACTERISTICS           54500000
         SPACE 3                                                        55000000
         USING APCT,APCTPTR        VPSS CONTROL TABLE                   55500000
         USING APSV,RTAPSV         VPSS SAVE AREA                       56000000
         USING IGTUAC,APENTRY      BASE REGISTER                        56500000
         SPACE 5                                                        57000000
         B     STARTUP             SKIP IDENTIFIER                      57500000
         DC    YL1(COREIDE-*-1)    LENGTH OF ID                         58000000
         DC    C'IGTUAC'           CSECT NAME                           58500000
         DC    C' &SYSDATE'        ASSEMBLY DATE                        59000000
COREIDE  EQU   *                   END OF ID                            59500000
         SPACE 2                                                        60000000
STARTUP  DS    0H                  START OF CODE                        60500000
         L     APSMPTR,APSVFREE    ADDRESS OF FIRST APSM                61000000
*                                  * TO FREE                            61500000
         LTR   APSMPTR,APSMPTR     ANY TO FREE ?                        62000000
         BZR   APRETURN            NO--DONE SO RETURN                   62500000
         EJECT ,                                                        63000000
*                                                                       63500000
** LOOP THROUGH APSM ENTRIES OWNED BY EXITING SAVE AREA                 64000000
** ISSUE FREEMAIN FOR EACH BLOCK, ALSO REMOVE FROM                      64500000
** RECOVERY QUEUE (APSMNEXT/APSMPREV).                                  65000000
*                                                                       65500000
         USING APSM,APSMPTR        POINTING TO FIRST ENTRY              66000000
         DROP  APENTRY             RE-USING OLD BASE REGISTER           66500000
         L     RTEMPA,APSMREGS     REGISTER SAVE AREA                   67000000
         STM   R2,R14,4*(R2-R0)(RTEMPA) SAVE INPUT VALUES               67500000
         LR    RREGSPTR,RTEMPA     SAVE POINTER TO SAVED REGISTERS      68000000
         BALR  APCODE,0            ESTABLISH NEW BASE                   68500000
         USING *,APCODE            TELL ASSEMBLER                       69000000
NEXTAPSM EQU   *                   FREE NEXT (OR FIRST) APSM            69500000
         L     RNXTAPSM,APSMAPSV   NEXT APSM TO FREE                    70000000
         LTR   RNXTAPSM,RNXTAPSM   ANY MORE ?                           70500000
         BNZ   CONTLOOP            YES--CONTINUE LOOP                   71000000
         L     RNXTAPSM,APSMPREV   NEXT APSM ON QUEUE                   71500000
         LTR   RNXTAPSM,RNXTAPSM   ANY LEFT ?                           72000000
         BZ    LASTAPSM            YES--THEN                            72500000
         SR    RTEMPB,RTEMPB       * CLEAR 'NEXT' POINTER IN            73000000
         ST    RTEMPB,APSMNEXT-APSM(,RNXTAPSM) * RECOVERY               73500000
*                                  * CHAIN SINCE ELEMENT                74000000
*                                  * FREED                              74500000
LASTAPSM EQU   *                   NEXT POINTER CLEARED                 75000000
*                                                                       75500000
** MUST RELOAD REGISTERS BEFORE LAST FREEMAIN SINCE                     76000000
** MAY BE RELEASING AREA CONTAINING REGISTER SAVEAREA.                  76500000
*                                                                       77000000
         PUSH  USING               SAVE 'USING' STATUS                  77500000
         DROP  APCODE              RE-SETTING BASE REGISTER             78000000
         LM    R2,R14,4*(R2-R0)(RREGSPTR) RELOAD INPUT REGISTERS        78500000
*                                  * NOTE: NO BASE REGISTER             79000000
         L     R0,APSMSIZE         SUBPOOL/LENGTH OF ELEMENT            79500000
         FREEMAIN R,LV=(0),A=(1)   FREE THE STORAGE                     80000000
         SPACE 2                                                        80500000
         BR    APRETURN            RETURN TO CALLER                     81000000
*                                  * SAVEAREA FREED.                    81500000
         SPACE 2                                                        82000000
         POP   USING               RESTORE BASE ADDRESSIBILITY          82500000
         SPACE 5                                                        83000000
CONTLOOP EQU   *                   NOT ON LAST APSM TO FREE             83500000
         L     R0,APSMSIZE         SUBPOOL/LENGTH OF ELEMENT            84000000
         FREEMAIN R,LV=(0),A=(1)   FREE THIS APSM                       84500000
         LR    APSMPTR,RNXTAPSM    NEXT APSM                            85000000
         B     NEXTAPSM            CONTINUE THE LOOP                    85500000
         EJECT ,                                                        86000000
********************************************************************* * 86500000
**                                                                    * 87000000
**       DEFINE REQUESTED VPSS DSECTS                                 * 87500000
**                                                                    * 88000000
********************************************************************* * 88500000
         SPACE 2                                                        89000000
         IGTXDSCT IGTXAPCT         CONTROL TABLE                        89500000
         IGTXDSCT IGTXAPSC         STORAGE MANAGEMENT CONTROL WORD      90000000
         IGTXDSCT IGTXAPSM         STORAGE MANAGEMENT CONTROL BLOCK     90500000
         IGTXDSCT IGTXAPSV         SAVEAREA/WORKAREA                    91000000
         EJECT ,                                                        91500000
         IGTXEPLG ,                DEFINE REGISTERS AND DSECTS          92000000
RTEMPB   EQU   R0                  TEMPORARY VALUE HOLDER               92500000
RTAPSV   EQU   R1                  ADDRESS OF APSV TO ELIMINATE         93000000
*                                  * (INPUT TO THIS PROGRAM)            93500000
RREGSPTR EQU   R3                  POINTER TO SAVE REGISTERS            94000000
RNXTAPSM EQU   R9                  NEXT APSM TO FREE                    94500000
RTEMPA   EQU   R15                 TEMPORARY VALUE HOLDER               95000000
         SPACE 5                                                        95500000
         END   ,                                                        96000000
