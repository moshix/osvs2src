IDDWICPI TITLE 'CHANNEL PROGRAM INTERPRETER - MODULE DESCRIPTION'       00020002
         ENTRY FRROPEND                                         YM03980 00030002
IDDWICPI CSECT                                                          00040002
*********************************************************************** 00060002
*                                                                     * 00080002
* MODULE NAME = IDDWICPI                                              * 00100002
*                                                                     * 00120002
* DESCRIPTIVE NAME = EXCP INTERCEPT PROCESSOR - CHANNEL PROGRAM       * 00140002
*                    INTERPRETER                                      * 00160002
*                                                                     * 00180002
* COPYRIGHT = NONE                                                    * 00200002
*                                                                     * 00220002
* STATUS = CHANGE LEVEL 0                                             * 00230002
*                                                                     * 00232002
* FUNCTION = THIS MODULE INTERPRETS A CHANNEL PROGRAM DIRECTED        * 00240002
*            TO A VIRTUAL DEVICE.                                     * 00260002
*                                                                     * 00280002
* NOTES = SEE BELOW                                                   * 00300002
*                                                                     * 00320002
*      DEPENDENCIES = NONE                                            * 00340002
*                                                                     * 00360002
*      RESTRICTIONS = THE FOLLOWING COMMANDS ARE CONSIDERED           * 00380002
*                     INVALID CHANNEL COMMAND OP CODES WHEN           * 00400002
*                     PRESENTED TO THE CPI:                           * 00420002
*                        COMMAND                              HEX     * 00440002
*                        SPACE COUNT                          0F      * 00480002
*                        SEARCH KEY AND DATA EQ               2D      * 00500002
*                        SEARCH KEY AND DATA HI               4D      * 00520002
*                        SEARCH KEY AND DATA EQ OR HI         6D      * 00540002
*                        CONTINUE SCAN EQ                     25      * 00560002
*                        SET STATUS MODIFIER                  35      * 00580002
*                        CONTINUE SCAN HI                     45      * 00600002
*                        CONTINUE SCAN EQ OR HI               65      * 00620002
*                        CONTINUE SCAN NO COMPARE             55      * 00640002
*                        CONTINUE SCAN SET COMPARE            75      * 00660002
*                        DIANOSTIC LOAD                       53      * 00680002
*                        DIAGNOSTIC WRITE                     73      * 00700002
*                        VARY SENSING                         27      * 00720002
*                        READ BUFFERED LOG                    24      * 00740002
*                        READ RESET BUFFER LOG                A4      * 00760002
*                        READ DIAGNOSTIC STATUS               44      * 00780002
*                        RECALIBRATE                          13      * 00800002
*                        ORIENT                               2B      * 00820002
*                        WRITE HOME ADDRESS                   19      * 00840002
*                        WRITE R0                             15      * 00860002
*                     IN ADDITION, SINCE THIS MODULE ASSUMES THAT A   * 00900002
*                     SET FILE MASK CCW WOULD HAVE BEEN PREFIXED TO   * 00920002
*                     THE CHANNEL PROGRAM, THE FOLLOWING OP CODES     * 00940002
*                     WILL GENERATE AN INVALID SEQUENCE TERMINATION   * 00960002
*                     OF THE CHANNEL PROGRAM:                         * 00980002
*                        COMMAND                              HEX     * 01000002
*                        SET FILE MASK                        1F      * 01040002
*                        READ IPL                             02      * 01060002
*                        DEVICE RELEASE                       94      * 01080002
*                        DEVICE RESERVE                       B4      * 01100002
*                                                                     * 01120002
*      REGISTER CONVENTIONS = SEE REGISTER USAGE FOLLWING INTRODUC-   * 01140002
*                             TORY COMMENTS.                          * 01140402
*                                                                     * 01142002
*      PATCH LABEL = CPIPATCH                                         * 01150002
*                                                                     * 01160002
* MODULE TYPE = CSECT                                                 * 01180002
*                                                                     * 01200002
*      PROCESSOR = BAL                                                * 01220002
*                                                                     * 01240002
*      MODULE SIZE = 3928 DECIMAL BYTES                               * 01260002
*                                                                     * 01280002
*      ATTRIBUTES = REENTERABLE, SUPERVISOR STATE, EXECUTES IN THE    * 01300002
*                   KEY OF THE USER, HOLDS BUT DOES NOT OBTAIN THE    * 01320002
*                   LOCAL MEMORY LOCK, AND RESIDES IN LPALIB.         * 01340002
*                                                                     * 01360002
* ENTRY POINT = IDDWICPI - MAIN ENTRY POINT                           * 01380002
*                                                                     * 01400002
*      PURPOSE = SEE FUNCTION. ENTERED BY MODULE IDDWITRM.            * 01460002
*                                                                     * 01480002
*      LINKAGE = R14 LOADED WITH RETURN ADDRESS                       * 01500002
*                R15 LOADED WITH ENTRY POINT ADDRESS                  * 01520002
*                ENTERED BY A DIRECT BRANCH                           * 01540002
*                                                                     * 01560002
* ENTRY POINT = FRROPEND - SECONDARY ENTRY POINT                      * 01580002
*                                                                     * 01600002
*      PURPOSE = THIS ENTRY POINT IS USED BY THE SYSTEM               * 01620002
*                RECOVERY MANAGER AFTER THE FUNCTIONAL                * 01640002
*                RECOVERY ROUTINE (MODULE IDDWIFRR) HAS               * 01660002
*                BEEN ENTERED AND DETERMINED THAT RECOVERY            * 01680002
*                WAS POSSIBLE.  THE FOLLOWING ERRORS ARE              * 01700002
*                CONSIDERED RECOVERABLE:                              * 01720002
*                   PROGRAM CHECK CAUSED BY                           * 01740002
*                      1 - INVALID CCW ADDR                           * 01760002
*                      2 - INVALID DATA ADDR IN CCW ADDR FIELD        * 01780002
*                   PROTECTION CHECK CAUSED BY                        * 01800002
*                      1 - INVALID CCW ADDR                           * 01820002
*                      2 - INVALID DATA ADDR IN CCW ADDR FIELD        * 01840002
*                THESE ERRORS OCCUR ONLY WHEN THE CHANNEL             * 01860002
*                PROGRAM INTERPRETER WAS IN CONTROL.  THE             * 01880002
*                RECOVERY ROUTINE THEREFORE INDICATES THE             * 01900002
*                CPI AS A RETRY ROUTINE AT THE SECONDARY              * 01920002
*                ENTRY POINT IN ORDER TO TERMINATE THE                * 01940002
*                CHANNEL PROGRAM AND POST THE USER'S IOB              * 01960002
*                WITH THE APPROPRIATE ERROR CONDITION.                * 01980002
*                                                                     * 02000002
*      LINKAGE = LPSW USING THE ADDRESS OF IDDWICPE                   * 02020002
*                                                                     * 02040002
* INPUT = THE FOLLOWING IS THE REGISTER INPUT FOR ENTRY IDDWICPI:     * 02060002
*            R0 - VDSCB ADDRESS                                       * 02072002
*            R1 - TRACK BUFFER ADDRESS                                * 02074002
*            R2 - IOB ADDRESS                                         * 02076002
*            R3-R11 - UNDEFINED IF NOT A RESTART SITUATION.           * 02078002
*            R3-R11 - RESTORED CONTENTS OF REGISTERS AS THEY WERE     * 02078402
*                     RETURNED TO THE TRACK MANAGER IN A RESTART      * 02078802
*                     SITUATION SUCH AS A REQUEST FOR A NEW TRACK     * 02079202
*                     OR A PCI REQUEST.                               * 02079602
*            R12 - WICB ADDRESS                                       * 02079702
*            R13 - UNDEFINED                                          * 02079802
*            R14 - RETURN ADDRESS                                     * 02079902
*            R15 - ENTRY POINT ADDRESS OF THIS MODULE                 * 02086602
*         THE FOLLOWING IS THE REGISTER INPUT FOR ENTRY CPIOPEND:     * 02088602
*            R0-R15 CONTENTS AT TIME OF ERROR                         * 02090602
*                                                                     * 02420002
* OUTPUT = R0 - VDSCB ADDRESS                                         * 02440002
*          R1 - TRACK BUFFER ADDRESS                                  * 02460002
*          R2 - IOB ADDRESS                                           * 02480002
*          R3-R11 - UNDEFINED AS OUTPUT BUT ARE TO BE SAVED           * 02500002
*                   AND RESTORED BY THE TRACK MANAGER                 * 02520002
*          R12 - WICB ADDRESS                                         * 02540002
*          R13 - VBPPL SAVE AREA ADDRESS                              * 02560002
*          R14 - RETURN ADDRESS OF TRACK MANAGER                      * 02580002
*          R15 - RETURN CODE WITH MEANINGS OF:                        * 02600002
*                  0 - RETURN CONTROL TO THE APPENDAGE INTER-         * 02620002
*                      FACE HANDLER (MODULE IDDWIAPP) AS CHAN-        * 02640002
*                      PROGRAM HAS TERMINATED OR A PCI HAS            * 02660002
*                      BEEN REQUESTED                                 * 02680002
*                  4 - A NEW TRACK IS NEEDED BEFORE THE CPI CAN       * 02700002
*                      CONTINUE WITH INTERPRETATION DUE TO            * 02720002
*                      A HEAD SWITCH ETC.                             * 02740002
*                                                                     * 02760002
* EXIT NORMAL = SEE OUTPUT                                            * 02780002
*                                                                     * 02800002
* EXIT ERROR = SAME AS EXIT NORMAL                                    * 02820002
*                                                                     * 02840002
* EXTERNAL REFERENCES = SEE BELOW                                     * 02860002
*                                                                     * 02880002
*      ROUTINES = NONE                                                * 02900002
*                                                                     * 02920002
*      DATA AREAS = VTRACK (TRACK BUFFER)                             * 02940002
*                   CHANNEL PROGRAM BUFFER                            * 02960002
*                                                                     * 02980002
*      CONTROL BLOCKS = VDSCB (VIRTUAL DATA SET CONTROL BLOCK)        * 03000002
*                       WICB (EXCP INTERCEPT PROCESSOR CONTROL BLK)   * 03020002
*                                                                     * 03040002
* TABLES = KOPMAP1, KOPMAP2, AND KMASKOP                              * 03060002
*             TO ELIMINATE INVALID CHANNEL COMMAND OP CODES.  SEE     * 03140002
*             TABLE DESCRIPTION PRECEDING TABLE KOPMAP1 FOR MORE      * 03160002
*             DETAILS.                                                * 03180002
*          KPOSTAB                                                    * 03220002
*             TO POSITION TO A GIVEN AREA WITHIN A RECORD.  SEE       * 03260002
*             TABLE DESCRIPTION PRECEDING TABLE KPOSTAB FOR AN        * 03280002
*             EXTENDED DESCRIPTION OF USE.                            * 03300002
*          KERRTAB1 AND KERRTAB2                                      * 03340002
*             TO POST THE IOB WITH THE APPROPRIATE SENSE INFORMA-     * 03380002
*             TION WHICH IS DEVICE DEPENDENT.  SEE THE DESCRIPTION    * 03400002
*             PRECEDING TABLE KERRTAB1 FOR ADDITIONAL INFORMATION.    * 03420002
*                                                                     * 03440002
* MACROS = EXECUTABLE                                                 * 03460002
*             NONE                                                    * 03470002
*          MAPPING                                                    * 03510002
*             IDDWICB                                                 * 03540002
*             IDDVDSCB                                                * 03560002
*             IDDTRACK                                                * 03580002
*             IEZIOB                                                  * 03600002
*                                                                     * 03620002
* CHANGE ACTIVITY = SEE BELOW                                         * 03640002
*                                                                     * 03660002
*      RELEASE 2 DELETIONS                                            * 03670002
*                                                              ZA00143* 03672002
*                                                                     * 03674002
*********************************************************************** 03680002
         TITLE 'CHANNEL PROGRAM INTERPRETER - EQUATES'                  03700002
*********************************************************************** 03720002
*                                                                     * 03740002
*        REGISTER USAGE                                               * 03760002
*                                                                     * 03780002
*********************************************************************** 03800002
*                                                                       03820002
RVDSCB   EQU   0                        VIRTUAL DATA SET CONTROL BLOCK  03840002
R0       EQU   0                        USED TO DECREMNT A REG BY ONE   03860002
*                                                                       03880002
RTRKBFR  EQU   1                        POINTER TO TRACK BEGINNING      03900002
*                                                                       03920002
RFROM    EQU   2                        USED IN MOVE CHAR LONG          03940002
RIOB     EQU   2                        IOB POINTER                     03960002
*                                                                       03980002
RFROMCNT EQU   3                        COUNT OF FROM ADDRESS           04000002
*                                       WHEN USED WITH REGISTER         04020002
*                                       RFROM                           04040002
RWORK    EQU   3                        WORK REGISTER                   04060002
*                                                                       04080002
RTO      EQU   4                        USED IN MOVE CHAR LONG          04100002
RWORK1   EQU   4                        GENERAL WORK REGISTER           04120002
*                                                                       04140002
RTOCNT   EQU   5                        COUNT OF TO ADDRESS             04160002
*                                       WHEN USED WITH REGISTER RTO     04180002
RWORK2   EQU   5                        GENERAL WORK REGISTER           04200002
RERRDISP EQU   5                        FOR SETTING DISPLACEMENT OF     04220002
*                                       ERROR CONDITION TO BE USED WITH 04240002
*                                       AN APPROPRIATE ERROR TABLE      04260002
*                                                                       04280002
RCURSOR  EQU   6                        CURRENT PONTER WITHIN TRACK     04300002
*                                       WCHICH IS A BYTE LOCATOR        04320002
REVNPAIR EQU   6                        EVEN REG FOR PAIRED INSTRUCTION 04340002
*                                                                       04360002
RXFERBAL EQU   7                        NUMBER OF BYTES CURRENTLY       04380002
*                                       AVAILABLE FOR AN OPERATION      04400002
RODDPAIR EQU   7                        ODD REG FOR PAIRED INSTRUCTION  04420002
*                                                                       04440002
RBFRDATA EQU   8                        CURRENT POINTER TO DATA         04460002
*                                       IN THE CHANNEL PROGRAM          04480002
*                                       BUFFER                          04500002
*                                                                       04520002
REQBAL   EQU   9                        CURRENT REQUEST BALANCE INIT-   04540002
*                                       ITIALLY SET TO CCW COUNT        04560002
*                                                                       04580002
RCCW     EQU   10                       POINTER TO CCW                  04600002
*                                                                       04620002
RCXFER   EQU   11                       CURRENTLY USED LENGTH FOR       04640002
*                                       AN OPERATION AND IS THE         04660002
*                                       SMALLER OF THAT AVAILABLE       04680002
*                                       AND THAT REQUESTED              04700002
ROPCODE  EQU   11                       MASKED OP CODE REGISTER         04720002
*                                                                       04740002
RWICB    EQU   12                       INTERCEPT PROCESSOR BLOCK       04760002
*                                                                       04780002
RLINK    EQU   13                       INTERNAL LINK REGISTER          04800002
R13      EQU   13                       SAVE AREA LOCATOR               04820002
*                                                                       04840002
RLINK2   EQU   14                       SECOND LINK REGISTER USED       04860002
R14      EQU   14                       RETURN REGISTER                 04880002
*                                                                       04900002
R15      EQU   15                       RETURN CODE REG                 04920002
RBASE    EQU   15                       ADDRESSING BASE FOR CODE        04940002
         EJECT                                                          04960002
*********************************************************************** 04980002
*                                                                     * 05000002
*        EQUATES                                                      * 05020002
*                                                                     * 05040002
*        THE FOLLOWING EQUATES ARE THOSE WHICH ARE NOT DIRECTLY       * 05060002
*        RELATED TO A CONTROL BLOCK.  THOSE EQUATES WHICH ARE RELATED * 05080002
*        TO A PARTICULAR CONTROL BLOCK APPEAR WITH THE DESCRIPTION OF * 05100002
*        THAT CONTROL BLOCK.                                          * 05120002
*                                                                     * 05140002
*                                                                     * 05160002
*********************************************************************** 05180002
*                                                                       05200002
*                                                                       05220002
*              USED FOR CLEARING ALL OR SPECIFIED BITS IN FLAG BYTES    05240002
*                                                                       05260002
FULLBYTE EQU   B'11111111'              USED IN AND INSTRUCTIONS        05280002
*                                       TO CLEAR SPECIFIED BITS         05300002
FLAGCLR  EQU   B'00000000'              TO CLEAR ONE BYTE FLAGS         05320002
*                                                                       05340002
*                                                                       05360002
*              BRANCH CONDITIONS USED FOR AN EXECUTED BRANCH INSTRUC-   05380002
*              TIONS.                                                   05400002
*                                                                       05420002
HIBRCON  EQU   X'20'                    BRANCH CONDITION CODE FOR       05440002
*                                       A HIGH SEARCH                   05460002
EQBRCON  EQU   X'80'                    BRANCH CONDITION CODE FOR       05480002
*                                       AN EQUAL SEARCH                 05500002
*                                                                       05520002
*                                                                       05540002
*              BRANCH CONDITIONS USED IN BRANCH REGISTER INSTRUCTIONS.  05560002
*                                                                       05580002
NOTLOW   EQU   11                       BR REG CONDITION OF NOT LOW     05600002
EQZERO   EQU   8                        BRANCH REG CONDITION OF 8       05620002
LOW      EQU   4                        BRANCH REG CONDITION OF 4       05640002
*                                                                       05660002
*              SHIFT REGISTER EQUATES                                   05680002
*                                                                       05700002
DIVBY512 EQU   9                        SHIFT REG TO DIVIDE BY 512      05720002
DIVBY2   EQU   1                        SHIFT REG ONE POSITION          05740002
MULBY2   EQU   1                        SHIFT REG ONE POSITION          05760002
HWSHIFT  EQU   16                       SHIFT REG BY A HALF WORD        05780002
LW3TONXT EQU   3                        DOUBLE SHIFT LOW THREE BITS     05800002
*                                       FROM ONE REG TO NEXT            05820002
HI3TOLW3 EQU   29                       PLACE THREE HIGH ODER BITS OF   05840002
*                                       REG IN LOW ORDER POSITION       05860002
*                                                                       05880002
*              RETURN CODES                                             05900002
*                                                                       05920002
NEWTRACK EQU   4                        NEW TRACK REQUESTED             05940002
*                                       FILE MASK NOT VIOLATED          05960002
*                                                                       05980002
*              SENSE BYTE LENGTHS                                       06000002
*                                                                       06020002
SEN0TO5  EQU   6                        SIX BYTES OF SENSE INFORMATION  06040002
SEN6TO23 EQU   18                       ADDITIONAL SENSE BYTES 6-23     06060002
*                                                                       06080002
*                                                                       06100002
*              MISCELLANEOUS                                            06120002
*                                                                       06140002
REG14SAV EQU   0                        DISPLACEMENT VALUE INTO SAVE    06160002
*                                       AREA FOR REG 14 SAVED           06180002
SCHKEYEQ EQU   X'29'                    SEARCH KEY EQUAL OP CODE        06200002
LOW3BITS EQU   B'00000111'              MASK FOR CHECKING 3 LOW ORDER   06220002
*                                       BITS OF A BYTE                  06240002
HWMASK   EQU   B'0011'                  MASK USED TO INSERT HALFWORDS   06260002
*                                       AS POSITIVE VALUES              06280002
ADDRMASK EQU   B'0111'                  USED FOR INSERTING AND STORING  06300002
*                                       THREE BYTE ADDRESS FIELDS       06320002
FWMASK   EQU   B'1111'                  MASK FOR ACCESSING FULL WORD    06340002
*                                                                       06360002
LOWBYTWD EQU   3                        DISP FOR LOW ORDER BYTE OF WORD 06380002
ADDRONLY EQU   0                        FOR CLEARING HIGH ORDER BYTE    06400002
*                                       OF REGISTER-DISPLACEMENT VALUE  06420002
NORMLSIO EQU   X'40'                    NORMAL SIO CONDITION CODE       06440002
BUMPONE  EQU   1                        COUNTER                         06460002
PADONE   EQU   1                        USED TO BUMP THE AMOUNT MOVED   06480002
*                                       DURING A WRITE OPERATION BY     06500002
*                                       A PADDING FACTOR OF ONE         06520002
NOKEY    EQU   X'00'                    TEST FOR ZERO KEY LENGTH        06540002
OREDBYTE EQU   0                        USED IN EXECUTED INSTRUCTIONS   06560002
*                                       FOR THE BYTE WHICH GETS OR'ED   06580002
*                                       INTO INSTRUCTION                06600002
LSECTARG EQU   1                        SECTOR ARGUMENT LENGTH          06620002
SECTZERO EQU   X'00'                    SECTOR VALUE USED FOR ALL       06640002
*                                       READ SECTORS                    06660002
SECTXFF  EQU   X'FF'                    SECTOR VALUE WHICH IS GREATER   06680002
*                                       THAN THE MAXIMUM PERMISSIBLE    06700002
*                                       VALUE BUT IS A LEGAL SECTOR     06720002
*                                       VALUE                           06740002
DUMMYOP  EQU   B'00000100'              THIS IS A DUMMY OP CODE USED    06760002
*                                       DURING THE PROCESSING OF AN     06780002
*                                       OVERFLOW RECORD AND TELLS THE   06800002
*                                       POSITION ROUTINE TO POSITION    06820002
*                                       TO THE DATA PORTION OF THE      06840002
*                                       OVERFLOW SEGMENT                06860002
*                                                                       06870002
ZERO     EQU   0                        CONSTANT = 0                    06872002
*                                                                       06874002
ONE      EQU   1                        CONSTANT = 1                    06876002
*                                                                       06876402
TWO      EQU   2                        CONSTANT = 2                    06876802
*                                                                       06878002
         TITLE 'CHANNEL PROGRAM INTERPRETER - INITIALIZATION'           06880002
         USING *,RBASE                  ADDRESSIBILITY FOR CODE         06900002
         USING IOBSTDRD,RIOB            USE STANDARD SECTION OF IOB     06920002
         USING WICB,RWICB               INTERCEPT PROCESSOR BLOCK       06940002
         USING VTRACK,RTRKBFR           VIRTUAL TRACK                   06960002
         USING CCWDES,RCCW              CCW ADDRESSABILITY              06980002
         B     XSTART                  GO TO XSTART                     06982002
         DC    C'IDDWICPI'             MODULE NAME              YM02274 06990002
*                                                                       07000002
*                                                                       07020002
XSTART   TM    WICRESTA,WICRSTRT        IS THIS A RESTART SITUATION     07040002
         BO    CPIRSTRT                 YES-GO DETERMINE TYPE           07060002
CPIINIT  EQU   *                        NEW CHANNEL PROGRAM             07080002
         XC    WICAVXFR(WICCPINT),WICAVXFR  CLEAR THE FIELDS            07100002
*                                       USED FOR EACH CHANNEL PGM AND   07120002
*                                       ARE THE FOLLOWING               07140002
*                                       WICAVXFR                        07160002
*                                       WICREQXF                        07180002
*                                       WICOFLG1                        07200002
*                                       WICOFLG2                        07220002
*                                       WICSEQFG                        07240002
*                                       WICXOFLG                        07260002
*                                       WICWORK                         07280002
*                                       WICERDSP                        07300002
*                                       WICLSTOP                        07320002
*                                       WICCUROP                        07340002
*                                       WICRESTA                        07360002
         XC    IOBSENS0(L'IOBSENS0+L'IOBSENS1),IOBSENS0  CLEAR SENSE    07364002
         XC    IOBCSW,IOBCSW            CLEAR IOB CSW FIELD             07368002
*                                                                       07380002
*        PERFORM THE NECESSARY CHECKING THAT WOULD HAVE BEEN DONE IF    07400002
*        IOS HAD CONSTRUCTED A SET FILE MASK AND TIC TO THE CHANNEL     07420002
*        PROGRAM BEING PROCESSED.                                       07440002
*                                                                       07460002
         TM    WICFMASK,WICFMVAL        CHECK FORMAT OF FILE MASK       07480002
         BNZ   CPIIOSFM                 BRANCH - REQUIRED BITS NOT ZERO 07500002
         OI    WICSEQFG,WICTICFG        SET TIC SEQUENCE FLAG SINCE     07520002
*                                       LAST OP CODE WOULD HAVE BEEN    07540002
*                                       A TIC FROM IOS                  07560002
         MVI   IOBSIOCC,NORMLSIO        SET USER'S SIO CC TO NORMAL     07580002
         L     RCCW,WICSTART            GET ADDR OF FIRST CCW           07600002
         LA    RCCW,ADDRONLY(RCCW)      CLEAR HI-ORDER BYTE             07620002
         TM    WICSTART+LOWBYTWD,LOW3BITS  COMMAND ON DOUBLE WORD       07640002
         BNZ   CPIIOSTC                 NO, 3 LOW ORDER BITS NOT ZERO   07660002
         TITLE 'CHANNEL PROGRAM INTERPRETER - OP CODE BREAKDOWN'        07680002
*********************************************************************** 07700002
*                                                                     * 07720002
*        OPERATION START ROUTINE                                      * 07740002
*                                                                     * 07760002
*        THE FOLLOWING LABEL IS USED TO START AN OPERATION            * 07780002
*        FOLLOWING THE SUCCESSFUL COMPLETION OF THE PRECEDING         * 07800002
*        OPERATION.                                                   * 07820002
*                                                                     * 07840002
*********************************************************************** 07860002
*                                                                       07880002
CPIOPROC EQU   *                        *                               07900002
         XC    WICAVXFR(WICOPINT),WICAVXFR  CLEAR FIELDS USED           07920002
*                                       FOR EACH OPERATION AND ARE      07940002
*                                       THE FOLLOWING                   07960002
*                                       WICAVXFR                        07980002
*                                       WICREQXF                        08000002
*                                       WICOFLG1                        08020002
*                                       WICOFLG2                        08040002
         BAL   RLINK,CPICCWCK           CHECK FORMAT OF CCW             08060002
         TM    WICOFLG2,WICINTRP        INTERRUPT SET BY CCW CHECK      08080002
         BO    CPIOPEND                 YES GO END CHANNEL PGM          08100002
*                                                                       08102002
*********************************************************************** 08110002
*        THE FOLLOWING CODE ELIMINATES ALL INVALID OP CODES WHICH     * 08140002
*        HAVE PASSED THE FORMAT CHECKING IN CPICCWCK.  THIS IS DONE   * 08160002
*        BY USING A BIT MAP WITH A ONE TO ONE CORRESPONDENCE BETWEEN  * 08180002
*        EACH POSSIBLE OP CODE AND ITS CORRESPONDING BIT IN THE MAP.  * 08200002
*        A BIT SETTING OF ONE DESIGNATES A VALID OP CODE.  THE        * 08220002
*        OP CODE ITSELF IS USED TO LOCATE THE CORRECT BYTE IN THE     * 08240002
*        MAP AND ALSO TO LOCATE A TEST MASK FOR THAT BYTE.  THE       * 08260002
*        BIT MAP IS KOPMAP1 AND THE TABLE OF MASKS TO USE IS KMASKOP. * 08280002
*        A TIC SCHOULD NEVER COME THROUGH HERE TO BE VALIDIDATED AS   * 08300002
*        ROUTINE CPICCWCK WILL TRANSFER TO THE TICED TO CCW.          * 08320002
*********************************************************************** 08330002
*                                                                       08340002
CPIOPVAL EQU   *                        *                               08360002
         SR    REVNPAIR,REVNPAIR        CLEAR FOR INSERT                08380002
         IC    REVNPAIR,CCWOPCDE        GET OP CODE                     08400002
         SRDL  REVNPAIR,LW3TONXT        ROPCODE TO BE USED FOR BYTE     08420002
*                                       LOCATION IN BIT MAP             08440002
         SRL   RODDPAIR,HI3TOLW3        USED FOR INDEX INTO MASK TBL    08460002
         LA    RWORK,KOPMAP1(REVNPAIR)  ADDR OF APPROPRIATE BYTE IN TBL 08480002
         IC    RODDPAIR,KMASKOP(RODDPAIR)    GET MASK FROM MASK TABLE   08500002
         EX    RODDPAIR,EXOPTEST        TEST THE APPROPRIATE BIT IN MAP 08520002
         BZ    CPIOPERR                 BRANCH-OP CODE IS INVALID       08540002
CPIOPOK  EQU   *                        CHECK OP CODE                   08560002
*                                                                       08580002
*        ALL BUT BITS 3-5 OF THE OP CODE ARE MASKED OFF.  BITS 3-5      08600002
*        ARE THEN USED FOR INDEXING INTO THE APPROPRIATE BRANCH TABLE   08620002
*        AND ALSO USED BY THE POSITIONING ROUTINE TO POSITION TO THE    08640002
*        APPROPRIATE AREA WITHIN A RECORD.  BITS 3-5 DESIGNATE THE      08660002
*        COUNT, KEY, AND DATA BITS OF THE OP CODE.                      08680002
*                                                                       08700002
         IC    ROPCODE,CCWOPCDE         LOAD COMMAND CODE               08720002
         MVC   WICLSTOP,WICCUROP        SAVE LAST OP CODE               08740002
         STC   ROPCODE,WICCUROP         SAVE CURRENT OP CODE            08760002
         N     ROPCODE,KOPBRMSK         MASK FOR BITS 3-5               08780002
*                                                                       08800002
*        DETERMINE THE TYPE OF OPERATION THAT THIS OP CODE REPRESENTS.  08820002
*        THIS IS ACCOMPLISHED BY EXAMINING BITS 6-7 OF THE OP CODE      08840002
*        IN CONJUNCTION WITH BITS 1-2 FOR THE CASE OF WRITE AND         08860002
*        SEARCH OP CODES.  BITS 6-7 REPRESENT THE TYPE OF OP CODE       08880002
*        AND ARE UNIQUE EXCEPT FOR SEARCH AND WRITE WHICH USES          08900002
*        BITS 1-2.  BITS 1-2 DESIGNATE THE EQUAL OR HIGH                08920002
*        CONDITION FOR SEARCHES AND ARE ALWAYS ZERO FOR WRITES.         08940002
*                                                                       08960002
         TM    CCWOPCDE,CCWTYPE         CHECK TYPE BITS OF OP CODE      08980002
         BO    CPICONOP                 CONTROL OP CODE BRANCH          09000002
         BZ    CPISENOP                 SENSE OP CODE BRANCH            09020002
         TM    CCWOPCDE,CCWREAD         CHECK TYPE FOR READ             09040002
         BO    CPIREAD(ROPCODE)         GO TO READ ROUTINE              09060002
         TM    CCWOPCDE,CCWHICON+CCWEQCON CHECK FOR SEARCH CONDITION    09080002
         BNZ   CPISCHOP                 SEARCH OP CODE BRANCH           09100002
         OI    WICOFLG2,WICWRTIP        SET WRITE IN PROGRESS FLAG      09120002
         B     CPIWRITE(ROPCODE)        GO TO WRITE JUMP TABLE          09140002
*                                                                       09160002
*                                                                       09180002
*              ENTERED WHEN A RESTART SITUATION EXISTS AT THE TIME      09200002
*              THE TRACK MANAGER CALLS THIS MODULE                      09220002
*                                                                       09240002
CPIRSTRT EQU   *                        *                               09260002
         TM    WICRESTA,WICTRKRS        IS THIS A RESTART FROM A NEW    09280002
*                                       TRACK REQUEST                   09300002
         BO    CPITRKRS                 YES - CONTINUE WITH TRACK       09320002
*                                       REQUEST ROUTINE                 09340002
         TM    WICRESTA,WICPCIRS        RESTART FROM PCI EXIT           09360002
         BO    CPIPCIRS                 YES, GO TO PCI RESTART          09380002
         B     CPIIOSSK                 ONLY OTHER CONDITION USING      09400002
*                                       THE RESTART BIT IS THAT         09420002
*                                       THE TRACK MANAGER DETECTED      09440002
*                                       AN INVALID INITIAL SEEK         09460002
*                                       GO INDICATE THE ERROR           09480002
         EJECT                                                          09500002
*********************************************************************** 09520002
*                                                                     * 09540002
*        THE FOLLWOING TABLES ARE USED TO ISOLATE THE OP CODE AFTER   * 09560002
*        THE TYPE HAS BEEN DETERMINED.  BITS 3-5 OF THE OP CODE WHICH * 09580002
*        ARE CURRENTLY IN REGISTER ROPCODE ARE USED TO INDEX INTO     * 09600002
*        THE CORRECT PROCESSING ROUTINE.                              * 09620002
*                                                                     * 09640002
*********************************************************************** 09660002
*                                                                       09680002
CPISCHOP EQU   *                        *                               09700002
         MVI   WICSEQFG,FLAGCLR         CLEAR SEQUENCE FLAGS            09720002
         OI    WICOFLG2,WICDATAX        INDICATE OPERATION STARTED      09740002
         TM    CCWFLAGS,CCWDC           TEST FLAGS FOR DATA CHAINING    09760002
         BO    CPIDCERR                 BRANCH-DATA CHAINING ON SEARCH  09780002
*                                       IS NOT SUPPORTED BY THIS MODULE 09800002
         B     CPISERCH(ROPCODE)        BRANCH TO ROUTINE FOR OP CODE   09820002
*                                       SEARCH                          09830002
CPISERCH EQU   *                        *                               09840002
         B     CPIDCERR                 ERROR                           09860002
         B     CPIDCERR                 ERROR                           09880002
         B     CPISKEY                  SEARCH KEY                      09900002
         B     CPIDCERR                 ERROR                           09920002
         B     CPISID                   SEARCH ID                       09940002
         B     CPIDCERR                 ERROR                           09960002
         B     CPISHA                   SEARCH HA                       09980002
         B     CPIDCERR                 ERROR                           10000002
*                                                                       10020002
CPIREAD  EQU   *                        READ                            10040002
         B     CPIRSECT                 READ SECTOR                     10060002
         B     CPIRD                    RD                              10080002
         B     CPIDCERR                 ERROR                           10100002
         B     CPIRKD                   RKD                             10120002
         B     CPIRC                    RC, DOESN'T DETECT EOF          10140002
         B     CPIRR0                   RR0                             10160002
         B     CPIRHA                   RHA                             10180002
         B     CPIRCKD                  RCKD                            10200002
*                                                                       10220002
CPIWRITE EQU   *                        WRITE                           10240002
         B     CPIWSCKD                 WRITE SPECIAL COUNT KEY DATA    10260002
*                                       OVERFLOW FEATURE                10280002
         B     CPIWD                    WD                              10300002
         B     CPIDCERR                 ERROR                           10320002
         B     CPIWKD                   WKD                             10340002
         B     CPIERASE                 ERASE                           10360002
         B     CPIDCERR                 ERROR                           10380002
         B     CPIDCERR                 ERROR                           10400002
         B     CPIWCKD                  WCKD                            10420002
*                                                                       10440002
CPICONOP EQU   *                        NOP                             10460002
         MVI   WICSEQFG,FLAGCLR         CLEAR SEQUENCE FLAGS            10480002
         TM    CCWFLAGS,CCWDC           TEST FLAGS FOR DATA CHAINING    10500002
         BO    CPIDCERR                 BRANCH-DATA CHAINING ON CONTROL 10520002
*                                       IS NOT SUPPORTED BY THIS MODULE 10540002
         B     CPICONT(ROPCODE)         BRANCH TO CORRECT CONTROL RTN   10560002
*                                       CONTROL                         10570002
CPICONT  EQU   *                        *                               10580002
         B     CPINOP                   NOP AND SET SECTOR              10600002
         B     CPISEEK                  FULL SEEK                       10620002
         B     CPISEEKC                 CYLINDER SEEK                   10640002
         B     CPIDCERR                 ERROR                           10660002
         B     CPIDCERR                 ERROR                           10680002
         B     CPIRSTOR                 RESTORE                         10700002
         B     CPISEEKH                 HEAD SEEK                       10720002
         B     CPIDCERR                 ERROR                           10740002
*                                                                       10760002
CPISENOP EQU   *                        NOP                             10780002
         MVI   WICSEQFG,FLAGCLR         CLEAR SEQUENCE FLAGS            10800002
         TM    CCWFLAGS,CCWDC           IS DATA CHAINING SPECIFIED      10820002
         BO    CPIDCERR                 BRANCH-DATA CHAINING NOT        10840002
*                                       SUPPORTED ON SENSE OPERATION    10860002
         B     CPISENSE                 GO PROCESS SENSE OPERATION      10880002
         EJECT                                                          10900002
*                                                                       10920002
*        THE FOLLOWING LABEL IS ENTERED WHEN IT HAS BEEN DETERMINED     10940002
*        THAT AN INVALID OP CODE IS BEING PROCESSED.  THE REGISTERS     10960002
*        ARE SET UP FOLLOWING LABEL CPIOPVAL AND ARE USED TO FURTHER    10980002
*        ANALYZE THE OP CODE.  THE FURTHER TESTING DONE WILL BE         11000002
*        TO FIND THOSE OP CODES WHICH ARE LEGAL BUT WHICH ARE NOT       11020002
*        ALLOWED TO BE PRECEDED BY A SET FILE MASK INSTRUCTION.         11040002
*                                                                       11060002
CPIOPERR EQU   *                        *                               11080002
         OI    WICOFLG2,WICINTRP        INDICATE THAT AN ERROR WAS      11100002
*                                       PRIOR TO STARTING OPERATION     11120002
         LA    RERRDISP,ERR01DSP        DISPLACEMENT FOR INVALID OP     11140002
*                                       CODE ERROR                      11160002
         STH   RERRDISP,WICERDSP        DISPLACEMENT WILL BE USED BY    11180002
*                                       END ROUTINE                     11200002
         LA    RWORK,KOPMAP2(REVNPAIR)  MAP FOR VALID OP CODE BUT       11220002
*                                       INVALID SEQUENCE                11240002
         EX    RODDPAIR,EXOPTEST        CHECK SECOND BIT MAP            11260002
         BZ    CPIOPEND                 BRANCH-INVALID OP CODE          11280002
*                                       GO PROCESS OPERATION END        11300002
         LA    RERRDISP,ERR02DSP        DISPLACMENT FOR INVALID SEQ     11320002
*                                       ERROR                           11340002
         STH   RERRDISP,WICERDSP        DISPLACMENT WILL BE USED BY     11360002
*                                       END ROUTINE                     11380002
         B     CPIOPEND                 BRANCH-TERMINATE CHANNEL PGM    11400002
*                                                                       11420002
*                                                                       11440002
*              THE FOLLOWING ERROR CONDITION IS ENCOUNTER WHEN THE FILE 11460002
*              MASK PASSED BY THE USER PROGRAM IS INVALID IN FORMAT.    11480002
*              THIS WOULD HAVE BEEN DETECTED BY THE SET FILE MASK       11500002
*              CCW WHICH DOES NOT NOW EXIST.                            11520002
CPIIOSFM EQU   *                        *                               11540002
         MVC   WICCCWER(L'CCW),KIOSSFM  MOVE IN SKELTON CCW FOR DUM-    11560002
*                                       MYING UP A CCW                  11580002
         LA    RCCW,WICCCWER            INDICATE THIS IS CCW            11600002
         LA    RWORK,WICFMASK           POINT TO FILE MASK USED         11620002
         STCM  RWORK,ADDRMASK,CCWDATAD+L'CCWOPCDE  SET THE ADDRESS      11640002
*                                       PORTION OF THE CCW TO POINT     11660002
*                                       TO THE FILE MASK USED           11680002
         LA    RERRDISP,ERR01DSP        DISPLACEMENT FOR INVALID FILE   11700002
*                                       MASK ERROR                      11720002
         STH   RERRDISP,WICERDSP        WILL BE USED BY THE END RTN     11740002
         OI    WICOFLG2,WICDATAX+WICERROR  INDICATE THAT AN ERROR       11760002
*                                       HAS OCCURRED AND THAT DATA      11780002
*                                       WAS BEING TRANSFERRED THAT IS   11800002
*                                       THE OPERATION HAS STARTED       11820002
         XC    WICAVXFR(L'WICAVXFR+L'WICREQXF),WICAVXFR  CLEAR THE      11824002
*                                       REQUEST BALANE AND AVAILABLE    11828002
*                                       FIELDS FOR END ROUTINE          11832002
         B     CPIOPEND                 GO END OPERATION AND CHANNEL    11840002
*                                       PROGRAM                         11860002
*                                                                       11880002
*                                                                       11900002
*                                                                       11920002
*              THE FOLLOWING ERROR CONDITION IS ENCOUNTERED WHEN        11940002
*              THE FIRST CCW IN THE CHANNEL PROGRAM DOES NOT START      11960002
*              ON A DOUBLE WORD BOUNDARY.                               11980002
CPIIOSTC EQU   *                        *                               12000002
         MVC   WICCCWER(L'CCW),KIOSTIC  MOVE IN SKELTON CCW FOR DUM-    12020002
*                                       MYING UP A CCW                  12040002
         LA    RCCW,WICCCWER            INDICATE THIS IS CCW            12060002
         MVC   CCWDATAD+L'CCWOPCDE(L'CCWDATAD-L'CCWOPCDE),WICSTART+L'CC*12080002
               WOPCDE                                                   12100002
         OI    WICOFLG2,WICINTRP        INDICATE THAT AN INTERRUPT      12120002
*                                       IS PENDING                      12140002
         OI    IOBCSWS1,IOBCSWPG        INDICATE A PROGRAM CHECK        12160002
         B     CPIOPEND                 GO PROCESS ENDING OF OPERATION  12180002
*                                                                       12200002
*                                                                       12220002
*              THE FOLLOWING ERROR CONDITION IS SET WHEN A CCW IS       12240002
*              ENCOUNTERED WHICH SPECIFIES DATA CHAINING AND DATA       12260002
*              CHAINING IS NOT SUPPORTED FOR THE OPERATION.  THIS       12280002
*              APPLIES TO SEEKS, SEARCHES, AND CONTROL OP CODES.        12300002
*                                                                       12320002
CPIDCERR EQU   *                        *                               12340002
         OI    IOBCSWS1,IOBCSWCC        INDICATE THE ERROR AS A         12360002
*                                       CHANNEL CONTROL CHECK           12380002
         OI    WICOFLG2,WICERROR        INDICATE THAT AN ERROR WAS      12400002
*                                       DETECTED PRIOR TO STARTING      12420002
*                                       THIS OPERATION                  12440002
         B     CPIOPEND                 GO PROCESS ENDING OF THIS       12460002
*                                       OPERATION AND TERMINATE THE     12480002
*                                       CHANNEL PROGRAM                 12500002
*                                                                       12520002
*                                                                       12540002
*              THE FOLLOWING IS ENTERED WHEN THE TRACK MANAGER HAS      12560002
*              DETECTED AN INVALID INITIAL SEEK ADDRESS AND HAS SET     12580002
*              THE RESTART BITS ON SO CONTROL IS PASSED HERE            12600002
*              FOR SETTING UP THE POSTING OF THE ERROR CONDITION        12620002
*                                                                       12640002
CPIIOSSK EQU   *                        *                               12660002
         MVC   WICCCWER(L'CCW),KIOSSEEK MOVE SKELTON FORM OF SEEK CCW   12680002
*                                       WHICH WOULD HAVE BEEN PREFIXED  12700002
*                                       TO THE CHANNEL PROGRAM          12720002
         LA    RCCW,WICCCWER            USE THIS AS THE CCW             12740002
         LA    RWORK,WICSKBCH           ADDR OF SEEK USED               12760002
         STCM  RWORK,ADDRMASK,CCWDATAD+L'CCWOPCDE  POINT THE CCW        12780002
*                                       TO THE SEEK ADDRESS             12800002
         OI    WICOFLG2,WICDATAX+WICERROR  INDICATE THAT AN ERROR       12844002
*                                       HAS OCCURRED AND THAT DATA      12848002
*                                       WAS BEING TRANSFERRED THAT IS   12852002
*                                       THE OPERATION HAS STARTED       12856002
         XC    WICAVXFR(L'WICAVXFR+L'WICREQXF),WICAVXFR  CLEAR THE      12856802
*                                       REQUEST BALANE AND AVAILABLE    12857602
*                                       FIELDS FOR END ROUTINE          12858402
         LA    RERRDISP,ERR03DSP        DISPLACEMENT FOR INVALID SEEK   12860002
*                                       ARGUMENT OR SEEK CHECK ERROR    12880002
         STH   RERRDISP,WICERDSP        WILL BE USED BY THE END RTN     12900002
         NI    WICRESTA,FULLBYTE-WICRSTRT-WICTRMSK  TURN OFF RESTART    12920002
         B     CPIOPEND                 GO TERMINATE CHANNEL PGM        12940002
         TITLE 'CHANNEL PROGRAM INTERPRETER - POSITIONING ROUTINE'      12960002
*********************************************************************** 12980002
*                                                                     * 13000002
*        POSITIONING ROUTINE                                          * 13020002
*                                                                     * 13040002
*        THIS ROUTINE ORIENTS A COMMAND TO THE CORRECT AREA OF A      * 13060002
*        RECORD.  A DETERMINATION IS MADE AS TO WHETHER OR NOT        * 13080002
*        THE DESIRED AREA IS WITHIN THE CURRENT RECORD AS IN-         * 13100002
*        DICATED BY THE CURRENT SETTING OF THE RELATIVE POSTION       * 13120002
*        POINTER) OR IF THE NEXT REOCRD MUST BE USED TO OBTAIN        * 13140002
*        THE DESIRED AREA.                                            * 13160002
*                                                                     * 13180002
*        IN ADDITION, THIS ROUTINE CALCULATES THE NUMBER OF BYTES     * 13200002
*        WHICH ARE AVAILABLE FOR THE REQUESTED OPERATION, AND         * 13220002
*        DETERMINES THE STARTING ADDRESS OF THE DESIRED AREA.         * 13240002
*                                                                     * 13260002
*        IF THE END OF TRACK IS REACHED WHILE TRYING TO LOCATE        * 13280002
*        THE DESIRED AREA AND THE COMMAND IS A MULTITRACK OP          * 13300002
*        CODE, THE 'NEXT TRACK ROUTINE' IS CALLED.  IF THE OP CODE    * 13320002
*        IS NOT MULTITRACK AND THE INDEX POINT HAS BEEN PASSED,       * 13340002
*        THEN A NO RECORD FOUND CONDITION EXISTS , OTHERWISE IF       * 13360002
*        IF THE INDEX POINT HAS NOT BEEN PASSED THEN THE BEGINNING    * 13380002
*        OF THE CURRENT TRACK IS USED TO LOCATE THE DESIRED AREA      * 13400002
*        AFTER SETTING THE INDEX POINT PASSED.                        * 13420002
*                                                                     * 13440002
*        A TABLE OF RELATIVE AREA VALUES IS USED BASED ON THE         * 13460002
*        BITS 3-5 OF THE OP CODE.  THE FOLLOWING VALUES DESCRIBE      * 13480002
*        THE VARIOUS AREAS WITHIN A RECORD.                           * 13500002
*              1 = BEFORE COUNT                                       * 13520002
*              2 = BEFORE KEY                                         * 13540002
*              3 = BEFORE DATA                                        * 13560002
*              4 = AFTER DATA                                         * 13580002
*              5 = BEFORE HOME ADDRESS                                * 13600002
*              6 = BEFORE R0 (AFTER A HOME ADDRESS COMMAND)           * 13620002
*              7 = AFTER R0 (FOLLOWING AN R0 COMMAND)                 * 13640002
*                                                                     * 13660002
*        INPUT - REG ROPCODE CONTAINS THE MASKED VALUE OF THE OP      * 13680002
*                    CODE (ALL BUT BITS 3-5 HAVE BEEN SET TO ZERO).   * 13700002
*                                                                     * 13720002
*        OUTPUT - REG RXFERBAL CONTAINS THE NUMBER OF BYTES THAT      * 13740002
*                     ARE AVAILABLE FOR THIS OPERATION.               * 13760002
*                 REG RCURSOR CONTAINS THE ADDRESS OF THE AREA TO     * 13780002
*                     BE USED FOR THIS OPERARION.                     * 13800002
*                                                                     * 13820002
*        ADDITIONAL REGISTERS USED - RWORK,RWORK1                     * 13840002
*                                                                     * 13860002
*********************************************************************** 13880002
*                                                                       13900002
CPIPOS   EQU   *                        *                               13920002
         SRL   ROPCODE,DIVBY2           POSITION TABLES ARE HALF WORDS  13940002
         LH    RWORK,KPOSTAB(ROPCODE)   GET DESIRED AREA ORIENTATION    13960002
         LH    RWORK1,WICRELTP          GET CURRENT AREA POSITION       13980002
         CH    RWORK,KPOSHA             HA OR R0 NEEDED                 14000002
         BNL   CPIPOSHA                 YES- GO POSITION FOR HA OR R0   14020002
         CH    RWORK1,KPOSHA            CURRENT POSITIONED TO HA OR R0  14040002
         BNL   CPIPOS60                 YES-GO DETERMINE WHERE TO BEGIN 14060002
*                                       FOR DESIRED POSITION            14080002
         L     RCURSOR,WICCAM           CURRENT RECORD ADDRESS          14100002
         CR    RWORK1,RWORK             COMPARE CURRENT POSITION TO     14120002
*                                       DESIRED POSITION                14140002
         BNH   CPIPOS10                 BR SINCE DESIRED POSITIONING    14160002
*                                       IS IN THIS RECORD               14180002
*                                                                       14200002
*        THE DESIRED AREA IS NOT IN THE CURRENT RECORD AND THEREFORE    14220002
*        THE NEXT RECORD IS LOCATED AND THE AREA WITHIN THAT RECORD     14240002
*        IS LOCATED.                                                    14260002
*                                                                       14280002
         MVI   WICSEQFG,FLAGCLR         CLEAR SEQUENCE FLAGS SINCE      14300002
*                                       A RECORD BOUNDARY HAS BEEN      14320002
*                                       CROSSED                         14340002
         LA    RCURSOR,L'CNTFIELD(RCURSOR) ADD LENGTH OF COUNT AREA     14360002
         AH    RCURSOR,WICKL            BUMP BY KEY LENGTH              14380002
         A     RCURSOR,WICDL            BUMP BY DATA LENGTH             14400002
         C     RCURSOR,WICDATND         NOW AT END OF TRACK             14420002
         BNL   CPIPOS40                 YES-BRANCH TO SEE IF IT IS      14440002
*                                       POSSIBLE TO CONTINUE            14460002
         ST    RCURSOR,WICCAM           ADDRESS OF NEW RECORD           14480002
         USING COUNTDES,RCURSOR         DESCRIBE COUNT AREA             14500002
*                                       UPDATE NEW KEY LENGTH           14520002
         MVC   WICKL+L'WICKL-L'CNTKL(L'CNTKL),CNTKL                     14540002
*                                       UPDATE NEW DATA LENGTH          14560002
         MVC   WICDL+L'WICDL-L'CNTDL(L'CNTDL),CNTDL                     14580002
         DROP  RCURSOR                  END CURRENT DESCRIPTION         14600002
*                                                                       14620002
*              DETERMINE THE ADDRESS OF THE AREA STARTING WITH THE      14640002
*              BEGINNING ADRESS OF THE RECORD.                          14660002
*                                                                       14680002
CPIPOS10 EQU   *                        *                               14700002
         CH    RWORK,KPOSKEY            DESIRED POSITION IN RELATION    14720002
*                                       TO KEY POSTION                  14740002
         BL    CPIPOS30                 BR-WANT COUNT AREA              14760002
         BE    CPIPOS20                 BR-WANT KEY AREA                14780002
*                                                                       14800002
*              DATA AREA DESIRED                                        14820002
*                                                                       14840002
         AH    RCURSOR,WICKL            BUMP BY LENGTH OF CURRENT KEY   14860002
*                                                                       14880002
*              KEY AREA DESIRED OR DATA AREA DESIRED                    14900002
*                                                                       14920002
CPIPOS20 EQU   *                         *                              14940002
         LA    RCURSOR,L'CNTFIELD(RCURSOR) BUMP BY LENGTH OF COUNT      14960002
*                                                                       14980002
*              CALCULATE THE NUMBER OF BYTES AVAILABLE FOR THIS COMMAND 15000002
*                                                                       15020002
CPIPOS30 EQU   *                        *                               15040002
         SR    RXFERBAL,RXFERBAL        CLEAR REGISTER                  15060002
         TM    CCWOPCDE,CCWUSECT        IS COUNT USED                   15080002
         BZ    CPIPOS31                 BRANCH - NO                     15100002
         LA    RWORK,BUMPONE(RWORK)     UPDATE NUMBER OF AREAS USED     15120002
         LA    RXFERBAL,L'CNTFIELD(RXFERBAL) AND NUMBER OF BYTES TO USE 15140002
CPIPOS31 EQU   *                        *                               15160002
         TM    CCWOPCDE,CCWUSEKY        IS KEY USED                     15180002
         BZ    CPIPOS32                 BRANCH - NO                     15200002
         LA    RWORK,BUMPONE(RWORK)     UPDATE NUMBER OF AREAS USED     15220002
         AH    RXFERBAL,WICKL           AND NUMBER OF BYTES TO USE      15240002
CPIPOS32 EQU   *                        *                               15260002
         TM    CCWOPCDE,CCWUSEDT        IS DATA AREA USED               15280002
         BZ    CPIPOS33                 BRANCH - NO                     15300002
         LA    RWORK,BUMPONE(RWORK)     UPDATE NUMBER OF AREAS USED     15320002
         A     RXFERBAL,WICDL           AND NUMBER OF BYTES TO USE      15340002
CPIPOS33 EQU   *                        *                               15360002
         STH   RWORK,WICRELTP           STORE THE POSITION OF THE       15380002
*                                       AREA AS IT WILL APPEAR WHEN     15400002
*                                       THE OPERATION HAS COMPLETED     15420002
*                                                                       15440002
*              DETERMINE IF THIS IS AN OPERATION PROCESSING AN OVER-    15460002
*              FLOW RECORD.                                             15480002
*                                                                       15500002
         TM    WICOFLG1,WICOVFOP        IS THIS A READ/WRITE DATA/      15520002
*                                       KEY DATA OR READ CKD            15540002
         BCR   EQZERO,RLINK             RETURN SINCE THESE ARE THE      15560002
*                                       ONLY CANDIDATES FOR OVERFLOW    15580002
*                                       RECORD PROCESSING               15600002
         TM    VTST,VTOVFL              IS THERE AN OVERFLOW REC        15620002
         BCR   EQZERO,RLINK             NO - RETURN                     15640002
         L     RWORK,WICCAM             CURRENT RECORD ADDRESS          15660002
         LA    RWORK,L'CNTFIELD(RWORK)  COUNT LENGTH                    15680002
         AH    RWORK,WICKL              CURRENT KEY LENGTH              15700002
         A     RWORK,WICDL              CURRENT DATA LENGTH             15720002
         C     RWORK,WICDATND           IS THIS THE LAST RECORD         15740002
*                                       ON THE TRACK                    15760002
         BCR   LOW,RLINK                RETURN IF THE END ADDR          15780002
*                                       OF THIS RECORD IS LESS THAN     15800002
*                                       THE END OF TRACK                15820002
         OI    WICRESTA,WICOVFIP        INDICATE THAT THIS RECORD       15840002
*                                       IS OVERFLOW                     15860002
         BR    RLINK                    RETURN TO CALLER                15880002
*                                                                       15900002
*                                                                       15920002
*              THE FOLLOWING LABEL IS ENTERED WHEN END OF TRACK HAS     15940002
*              BEEN REACHED.                                            15960002
*                                                                       15980002
CPIPOS40 EQU   *                        *                               16000002
         TM    CCWOPCDE,CCWMLTRK        MULTITRACK OPERATION            16020002
         BO    CPIPOS50                 YES-GO REQUEST NEW TRACK        16040002
*                                                                       16060002
*              SINGLE TRACK OPERATION AND END OF TRACK REACHED          16080002
*                                                                       16100002
         TM    WICXOFLG,WICNDXPT        HAS INDEX POINT BEEN PASSED     16120002
         BO    CPIPOS90                 YES-GO SET NO RECORD FOUND      16140002
         OI    WICXOFLG,WICNDXPT        SET INDEX POINT PASSED          16160002
         B     CPIPOS60                 GO ORIENT TO CORRECT RECORD     16180002
*                                                                       16200002
*              ENTERED AT END OF TRACK AND OPERATION IS MULTITRACK      16220002
*                                                                       16240002
CPIPOS50 EQU   *                        *                               16260002
         BAL   RLINK2,CPINXTRK          GO REQUEST NEXT TRACK           16280002
*                                                                       16300002
*              ENTERED TO DETERMINE IF ORIENTATION SHOULD BE TO         16320002
*              RECORD ZERO OR RECORD ONE WHEN THE BEGINNING OF          16340002
*              THE TRACK IS BEING USED.                                 16360002
*                                                                       16380002
CPIPOS60 EQU   *                        *                               16400002
         TM    WICOFLG1,WICSID          IS THIS A SEARCH ID COMMAND     16420002
         BO    CPIPOS70                 YES-GO ORIENT TO R0             16440002
*                                                                       16460002
*              ORIENT TO RECORD ONE AND IF IT EXISTS THEN CONTINUE      16480002
*              WITH THIS TRACK.  OTHERWISE, CHECK TO SEE IF A NEW       16500002
*              TRACK CAN BE REQUESTED.                                  16520002
*                                                                       16540002
         LA    RCURSOR,VTR1             ADDRESS OF R1                   16560002
         C     RCURSOR,WICDATND         IS R0 THE END OF DATA           16580002
         BNL   CPIPOS40                 RECORD ONE DOESN'T EXIST        16600002
*                                       SO GO CHECK IF A TRACK SWITCH   16620002
*                                       IS DESIRED                      16640002
         ST    RCURSOR,WICCAM           ADDRESS OF RECORD ONE           16660002
         USING COUNTDES,RCURSOR         DESCRIBE COUNT AREA             16680002
*                                       UPDATE NEW KEY LENGTH           16700002
         MVC   WICKL+L'WICKL-L'CNTKL(L'CNTKL),CNTKL                     16720002
*                                       UPDATE NEW DATA LENGTH          16740002
         MVC   WICDL+L'WICDL-L'CNTDL(L'CNTDL),CNTDL                     16760002
         DROP  RCURSOR                  END CURRENT DESCRIPTION         16780002
         B     CPIPOS10                 GO DETERMINE AREA TO USE        16800002
*                                                                       16820002
*              ENTERED FOR SEARCH ID WHEN POSITIONING                   16840002
*              IS REQUIRED TO START AT THE BEGINNING OF THE TRACK       16860002
*                                                                       16880002
CPIPOS70 EQU   *                        *                               16900002
         LA    RCURSOR,VTR0             ORIENTATION TO R0               16920002
         ST    RCURSOR,WICCAM           ADDRESS OF R0                   16940002
         USING COUNTDES,RCURSOR         DESCRIBE COUNT AREA             16960002
         MVI   WICKL+ONE,NOKEY          KEY LENGTH OF R0                16980002
*                                       UPDATE NEW DATA LENGTH          17000002
         MVC   WICDL+L'WICDL-L'CNTDL(L'CNTDL),CNTDL                     17020002
         DROP  RCURSOR                  DISCONTINUE DESCRIPTION         17040002
         MVI   WICRELTP+ONE,WICBFKEY    POSITIONING WILL BE BEFORE      17050002
*                                       KEY WHEN OPERATION IS DONE      17080002
         BR    RLINK                    RETURN TO CALLER                17100002
*                                                                       17120002
*                                                                       17140002
*                                                                       17160002
*              THE FOLLOWING IN ENTERED WHEN A NO RECORD FOUND CON-     17180002
*              DITION EXISTS.                                           17200002
*                                                                       17220002
CPIPOS90 EQU   *                        *                               17240002
         LA    RERRDISP,ERR06DSP        DISPLACEMENT FOR NO RECORD      17260002
*                                       FOUND ERROR                     17280002
         STH   RERRDISP,WICERDSP        WILL BE USED BY END ROUTINE     17300002
         SR    RWORK1,RWORK1            CLEAR REG                       17320002
         ST    RWORK1,WICAVXFR          SET AVAILABLE BYTES TO ZERO     17340002
         ST    REQBAL,WICREQXF          SET REQUESTED AMOUNT            17360002
         OI    WICOFLG2,WICERROR        NOTE AN ERROR HAS OCCURED       17380002
         LA    RWORK1,WICWORK           IF THE POSITIONING ROUTINE      17384002
*                                       WAS CALLED FROM THE MOVE RTN    17388002
*                                       FOR THE PURPOSE OF PROCESSING   17392002
*                                       AN OVERFLOW RECORD THEN RCCW    17396002
*                                       POINTS TO WICWORK INSTEAD OF    17396802
*                                       TO THE ACTUAL CCW FROM THE      17397602
*                                       CHANNEL PROGRAM AND THE         17398402
*                                       CONTENTS OF THE FIELD WICWORK   17399202
*                                       IS THE ACTUAL CCW ADDRESS -     17399302
*                                       SEE THE MOVE ROUTINE FOR MORE   17399402
*                                       DETAILS ON PROCESSING OVER-     17399502
*                                       FLOW RECORDS                    17399602
         CR    RWORK1,RCCW              IS THIS THE DUMMY CCW USED BY   17399702
*                                       THE MOVE ROUTINE                17399802
         BNE   CPIOPEND                 BR MEANS NOT CALLED FROM        17399902
*                                       MOVE ROUTINE                    17406602
*                                                                       17410602
*              CALLED BY MOVE ROUTINE WHEN PROCESSING AN OVERLOW        17411402
*              RECORD BUT THERE IS NO RECORD ON THE TRACK TO WHICH      17412202
*              THE OVERFLOW OCCURRED                                    17413002
*                                                                       17413102
         L     RCCW,WICWORK             GET THE ACTUAL CCW USED         17413202
         LA    RCCW,ADDRONLY(RCCW)      CLEAR OFF DUMMY OP CODE         17415402
         B     CPIOPEND                 GO TERMINATE OPERATION          17417802
         EJECT                                                          17420002
*                                                                       17440002
*              ENTERED WHEN POSTIONING IS DESIRED BEFORE HOME ADDRESS   17460002
*              OR RECORD ZERO.  USE THE CONDITION CODE SETTING WHICH    17480002
*              CAUSED THIS ENTRY TO DETERMINE WHICH IS DESIRED.         17500002
*                                                                       17520002
CPIPOSHA EQU   *                        *                               17540002
         BH    CPIPOSR0                 POSITION FOR R0 COMMAND         17560002
*                                                                       17580002
*              ENTERED WHEN POSITIONING IS REQUESTED FOR HOME ADDRESS   17600002
*              AND APPLIES ONLY TO READ HOME ADDRESS AS SEARCH HOME     17620002
*              ADDRESS DOES NOT CALL THE POSITIONING ROUTINE.           17640002
*                                                                       17660002
         MVI   WICSEQFG,FLAGCLR         CLEAR SEQUENCE FLAGS            17680002
         TM    CCWOPCDE,CCWMLTRK        IS THIS A MULTITRACK OP CODE    17700002
         BZ    CPIPHA10                 NO-USE THE CURRENT TRACK        17720002
         BAL   RLINK2,CPINXTRK          OTHERWISE REQUEST THE NEXT      17740002
*                                       TRACK TO BE USED                17760002
CPIPHA10 EQU   *                        *                               17780002
         LA    RXFERBAL,L'VTHA          INDICATE THAT FIVE BYTES ARE    17800002
*                                       AVAILABLE FOR THIS COMMAND      17820002
         MVI   WICKL+ONE,NOKEY          KEY LENGTH OF R0                17830002
*                                       WHEN OPERATION IS COMPLETED     17860002
*                                                                       17880002
*              SET THE CURRENT RECORD ADDRESS TO R0 AND UPDATE          17900002
*              THE CURRENT KEY AND DATA LENGTHS.                        17920002
*                                                                       17940002
         LA    RCURSOR,VTR0             POINT TO R0                     17960002
         ST    RCURSOR,WICCAM           ADDRESS OF R0                   17980002
         USING COUNTDES,RCURSOR         DESCRIBE COUNT AREA             18000002
         MVI   WICKL+ONE,NOKEY          KEY LENGTH OF R0                18020002
*                                       UPDATE NEW DATA LENGTH          18040002
         MVC   WICDL+L'WICDL-L'CNTDL(L'CNTDL),CNTDL                     18060002
         DROP  RCURSOR                  DISCONTINUE DESCRIPTION         18080002
*                                                                       18100002
*                                                                       18120002
         LA    RCURSOR,VTHA             INDICATE THAT THIS OPERATION    18140002
*                                       BEGINS AT HOME ADDRESS          18160002
         BR    RLINK                    RETURN TO CALLER                18180002
*                                                                       18200002
*              THE FOLLOWING LABEL IS ENTERED WHEN POISTIONING IS       18220002
*              DESIRED BEFORE R0 AND IS ONLY ENTERED FOR READ R0        18240002
*                                                                       18260002
CPIPOSR0 EQU   *                        *                               18280002
         MVI   WICSEQFG,FLAGCLR         CLEAR SEQUENCE FLAGS            18300002
         CR    RWORK1,RWORK             COMPARE THE CURRENT POSITION    18320002
*                                       (RWORK1) TO SIX (THE DESIRED    18340002
*                                       POSITION)                       18360002
         BE    CPIPR010                 CURRENT POSITON IS BEFORE       18380002
*                                       R0 SO USE THIS TRACK            18400002
         TM    CCWOPCDE,CCWMLTRK        IS THIS A MULTITRACK OP CODE    18420002
         BZ    CPIPR010                 N0-GO USE CURRENT TRACK         18440002
         BAL   RLINK2,CPINXTRK          OTHERWISE REQUEST NEXT TRK      18460002
*                                                                       18480002
CPIPR010 EQU   *                        *                               18500002
*                                                                       18520002
*              UPDATE THE CURRENT RECORD ADDRESS AND THE KEY AND        18540002
*              DATA LENGTHS                                             18560002
*                                                                       18580002
         LA    RCURSOR,VTR0             ADDRESS OF R0                   18600002
         ST    RCURSOR,WICCAM           AND UPDATE CONTROL BLOCK        18620002
         USING COUNTDES,RCURSOR         DESCRIBE COUNT AREA             18640002
         MVI   WICKL+ONE,NOKEY          KEY LENGTH OF R0                18660002
*                                       UPDATE NEW DATA LENGTH          18680002
         MVC   WICDL+L'WICDL-L'CNTDL(L'CNTDL),CNTDL                     18700002
         MVI   WICRELTP+ONE,WICAFR0     POSITIONING WILL BE AFTER R0    18710002
*                                       WHEN OPERATION IS COMPLETED     18740002
         DROP  RCURSOR                  DISCONTINUE DESCRIPTION         18760002
*                                                                       18780002
*              CALCULATE THE NUMBER OF BYTES AVAILABLE                  18800002
*                                                                       18820002
         LA    RXFERBAL,L'VTR0CNT+L'VTR0DATA   LENGTH OF RECORD ZERO    18840002
         BR    RLINK                    RETURN TO CALLER                18860002
         TITLE 'CHANNEL PROGRAM INTERPRETER - TRACK REQUEST ROUTINE'    18880002
*********************************************************************** 18900002
*                                                                     * 18920002
*        NEXT TRACK ROUTINE                                           * 18940002
*                                                                     * 18960002
*        THIS ROUTINE IS ENTERED WHENEVER IT HAS BEEN DETERMINED      * 18980002
*        HAS THE NEXT TRACK IS NEEDED.  THIS OCCURS DURING OVERF-     * 19000002
*        FLOW PROCESING, AND MULTITRACK OPERATIONS.  THIS ROUTINE     * 19020002
*        DETERMINES IF HEAD SWITCHING IS ALLOWED AND IF SO RETURNS    * 19040002
*        TO THE TRACK MANAGER ROUTINE WITH A REQUEST FOR A NEW        * 19060002
*        TRACK.  IF HEAD SWITCHING IS NOT ALLOWED, THE CHANNEL        * 19080002
*        PROGRAM IS POSTED IN ERROR AND TERMINATED.  A RETURN TO THE  * 19100002
*        CALLER IS ONLY TAKEN IF THE REQUEST WAS SATISFIED.           * 19120002
*                                                                     * 19140002
*        THIS ROUTINE IS ALSO USED BY THE SEEK COMMANDS WHEN A NEW    * 19160002
*        TRACK IS NEEDED.                                             * 19180002
*                                                                     * 19200002
*********************************************************************** 19220002
*                                                                     * 19240002
*                                                                     * 19260002
CPINXTRK EQU   *                        *                               19280002
         STM   RWORK,RWORK1,WICRGSV0    SAVE NON-VECTOR CONTENTS        19300002
*                                                                       19320002
*              IF ROUTINE HAS BEEN CALLED BY THE SEEK ROUTINE THEN      19340002
*              BYPASS CALCULATION OF NEW SEEK ADDRESS.                  19360002
*                                                                       19380002
         TM    WICRESTA,WICSEKRS        CALLED BY SEEK ROUTINE          19400002
         BO    CPITRK05                 YES-BYPASS NEW ADDR CALCULATION 19420002
         SR    RWORK,RWORK              CLEAR FOR INSERT                19440002
         ICM   RWORK,HWMASK,WICSKAHH    GET CURRENT HEAD VALUE          19460002
         LA    RWORK,BUMPONE(RWORK)     BUMP HEAD BY ONE                19480002
         CH    RWORK,WICMAXHH           COMPARE TO MAXIMUM HEAD         19500002
         BNL   CPITRK10                 BR TO INDICATE END OF CYLINDER  19520002
         STCM  RWORK,HWMASK,WICSKAHH    UPDATE TO REQUESTED TRACK       19540002
         TM    WICFMASK,WICFMSEK        IS HEAD SWITCHING ALLOWED       19560002
         BO    CPITRK20                 NO-GO INDICATE FILE MASK        19580002
*                                       VIOLATED                        19600002
*                                                                       19620002
*              NEXT TRACK WITHIN THIS CYLINDER AND FILE MASK HAS        19640002
*              NOT BEEN VIOLATED. RETURN TO TRACK MANAGER WITH A        19660002
*              REQUEST FOR A NEW TRACK.                                 19680002
*                                                                       19700002
CPITRK05 EQU   *                        *                               19720002
         OI    WICRESTA,WICTRKRS+WICRSTRT      INDICATE TRACK REQUEST   19740002
*                                       RESTART                         19760002
         LR    RWORK,R13                SAVE REG 13 CONTENTS            19780002
         LR    RWORK1,R14               SAVE REG 14 CONTENTS            19800002
         LR    R13,RVDSCB               VDSCB ADDRESS                   19820002
         USING VDSCB,R13                DESCRIBE CONTROL BLOCK          19840002
         L     R13,VDSVBPPL             PARAMETER LIST CONTAINS SAVE    19860002
*                                       AREA FOR LOCATING RETURN        19880002
*                                       ADDRESS                         19900002
         DROP  R13                      DISCONTINUE DESCRIPTION         19920002
         USING VBPPL,R13                DESCRIBE PARM LIST              19940002
         L     R14,VBPPLSAV+REG14SAV    GET RETURN ADDR FROM SAVE       19960002
         LA    R15,NEWTRACK             SET RETURN CODE FOR NEW TRACK   19980002
         DROP  R13                      DISCONTINUE DESCRIPTION         20000002
         BR    R14                      RETURN TO TRACK MANAGER         20020002
*                                                                       20040002
*              THE FOLLOWING LABEL IS ENTERED WHEN THE DESIRED          20060002
*              TRACK HAS BEEN OBTAINED. THE REGISTERS HAVE BEEN         20080002
*              SAVED AND RESTORED BY THE TRACK MANAGER.  THE BASE REG   20100002
*              HAS ALSO BEEN RESTORED WITH THE BASE OF THIS MODULE.     20120002
*                                                                       20140002
CPITRKRS EQU   *                        *                               20160002
         LR    R13,RWORK                RESTORE FORMER CONTENTS         20180002
         LR    R14,RWORK1               RESTORE FORMER CONTENTS         20200002
         NI    WICRESTA,FULLBYTE-WICTRKRS-WICRSTRT  CLEAR RESTART FLAGS 20220002
         MVI   WICSEQFG,FLAGCLR         CLEAR ALL SEQUENCE FLAGS        20240002
         OI    WICXOFLG,WICNDXPT        SET INDEX POINT PASSED          20260002
         LM    RWORK,RWORK1,WICRGSV0    RESTORE FORMER CONTENTS         20280002
*                                                                       20300002
*              NEW TRACK IS NOW READY SO RETURN TO CALLER               20320002
*                                                                       20340002
         BR    RLINK2                   RETURN TO CALLER                20360002
*                                                                       20380002
*                                                                       20400002
*              THE FOLLOWING LABEL IS ENTERED WHEN THE DESIRED TRACK    20420002
*              IS NOT WITHIN THE CURRENT CYLINDER.                      20440002
CPITRK10 EQU   *                        *                               20460002
         ICM   RWORK,HWMASK,WICSKACC    GET CURRENT CYLINDER            20480002
         LA    RWORK,BUMPONE(RWORK)     BUMP CYLINDER BY ONE            20500002
         SLL   RWORK,HWSHIFT            SHIFT VALUE TO SET HEAD         20520002
*                                       VALUE TO ZERO                   20540002
         STCM  RWORK,FWMASK,WICSKACC    UPDATE ADDRESS TO NEXT CYL      20560002
*                                       AND HEAD ZERO                   20580002
         LA    RERRDISP,ERR10DSP        DISPLACEMENT FOR END OF CYL     20600002
*                                       ERROR                           20620002
         B     CPITRK30                 GO SET UP FOR ENDING OPERATION  20640002
*                                                                       20660002
*              ENTERED WHEN THE DESIRED TRACK IS WITHIN THIS CYLINDER   20680002
*              BUT THE FILE MASK DOES NOT ALLOW HEAD SWITCHING.         20700002
CPITRK20 EQU   *                        *                               20720002
         LA    RERRDISP,ERR08DSP        DISPLACEMENT FOR FILE PROTECT   20740002
*                                       ERROR ON HEAD SWITCHING         20760002
*                                                                       20780002
*              PREPARE TO END OPERATION                                 20800002
*                                                                       20820002
CPITRK30 EQU   *                         *                              20840002
         SR    RWORK,RWORK              CLEAR REGISTER                  20860002
         ST    RWORK,WICAVXFR           INDICATE ZERO BYTES AVAILABLE   20880002
         ST    REQBAL,WICREQXF          STORE REQUESTED AMOUNT          20900002
         OI    WICOFLG2,WICERROR        INDICATE AN ERROR HAS OCCURRED  20920002
         TM    WICRESTA,WICOVFIP        IS OVERFLOW IN PROCESS          20940002
         STH   RERRDISP,WICERDSP        SAVE DISP FOR USE BY END RTN    20960002
         BZ    CPIOPEND                 NO-GO END OPERATION             20980002
         LA    RERRDISP,L'ERRENTRY(RERRDISP)  BUMP ERROR DISP TO        21000002
*                                       ENTRY WIHICH INCLUDES OVER-     21020002
*                                       FLOW INCOMPLETE                 21040002
*                                       THIS WILL CORRESPOND TO END     21060002
*                                       OF CYLINDER WITH OVERFLOW IN-   21080002
*                                       COMPLETE OR FILE PROTECT WITH   21100002
*                                       OVERFLOW INCOMPLETE             21120002
         STH   RERRDISP,WICERDSP        WILL BE USED BY THE END RTN     21140002
*                                       IS INCOMPLETE                   21160002
         B     CPIOPEND                 GO END OPERATION                21180002
         TITLE 'CHANNEL PROGRAM INTERPRETER -  READ ROUTINE'            21200002
*********************************************************************** 21220002
*                                                                     * 21240002
*        READ ROUTINE                                                 * 21260002
*                                                                     * 21280002
*        THE FOLLOWING ROUTINE IS ENTERED AT VARIOUS POINTS CORRES-   * 21300002
*        PONDING TO THE COMMAND.  FOR THOSE COMMANDS WHICH DETECT     * 21320002
*        END OF FILE, THE TEST IS MADE AFTER CALLING THE POSITION     * 21340002
*        ROUTINE.                                                     * 21360002
*                                                                     * 21380002
*        FOR THE READ COUNT OP CODE, A TEST IS MADE FOR A READ        * 21400002
*        COUNT-SEARCH KEY-TIC TO READ COUNT COMBINATION.  IF THIS     * 21420002
*        SEQUENCE IS PRESENT, AND CONFINED TO A SINGLE TRACK, A       * 21440002
*        BIT IS SET TO TELL THE SUBSEQUENT SEARCH KEY OF THE          * 21460002
*        COMBINATION.  FOR THIS SITUATION, THE READ COUNT IS PER-     * 21480002
*        FORMED ONCE THEN THE SEARCH IS PERFORMED IN A REPETIVE       * 21500002
*        MANNER UNTIL THE DESIRED RECORD IS FOUND OR NOT FOUND AS     * 21520002
*        THE CASE MAY BE.  AT THE END OF THE SEARCH KEY OPERATION     * 21540002
*        THE PRECEDING COUNT FIELD IS READ TO SATISFY THE DESIRED     * 21560002
*        RESULTS.                                                     * 21580002
*                                                                     * 21600002
*********************************************************************** 21620002
*                                                                     * 21640002
*                                                                       21660002
*              ENTERED FOR READ DATA/KEY DATA/COUNT KEY DATA            21680002
*                                                                       21700002
CPIRD    EQU   *                        READ DATA                       21720002
CPIRKD   EQU   *                        READ KEY AND DATA               21740002
CPIRCKD  EQU   *                        READ COUNT,KEY AND DATA         21760002
         OI    WICOFLG2,WICDATAX        NOTE OPERATION BEGUN            21780002
         OI    WICOFLG1,WICOVFOP        NOTE THAT THESE OPERATIONS      21800002
*                                       QUALIFY FOR OVERFLOW PROCESSING 21820002
         BAL   RLINK,CPIPOS             POSITION TO CORRECT AREA        21840002
         ST    REQBAL,WICREQXF          SAVE REQUESTED AMOUNT           21860002
         ST    RXFERBAL,WICAVXFR        SAVE AMOUNT AVAILABLE           21880002
         ICM   RWORK,FWMASK,WICDL       RETRIEVE DATA LENGTH            21900002
         BNZ   CPIBASRW                 NO-SINCE THIS IS NOT END OF     21920002
*                                       FILE GO PROCESS MOVE            21940002
*              END OF FILE DETECTED                                     21960002
*                                                                       21980002
         OI    IOBCSWS0,IOBCSWUE        INDICATE UNIT EXCEPTION         22000002
         OI    WICOFLG2,WICERROR        NOTE THAT AN ERROR OCCURRED     22020002
         NI    WICRESTA,FULLBYTE-WICOVFIP  DO NOT ALLOW OVERFLOW TO     22024002
*                                       OCCUR ON END OF FILE            22028002
         LTR   RXFERBAL,RXFERBAL        ARE ANY BYTES AVAILABLE FOR     22040002
*                                       MOVEMENT                        22060002
         BNZ   CPIBASRW                 YES-GO PERFORM MOVEMENT OF      22080002
*                                       THAT WHICH IS AVAILABLE         22100002
         B     CPIOPEND                 NO BYTES ARE AVAILABLE SO GO    22120002
*                                       END OPERATION AND CHANNEL PGM   22140002
*                                                                       22160002
*                                                                       22180002
*              ENTERED FOR READ R0/HA                                   22200002
*                                                                       22220002
CPIRHA   EQU   *                        READ HOME ADDRESS               22240002
CPIRR0   EQU   *                        READ RECORD ZERO                22260002
         OI    WICOFLG2,WICDATAX        INDICATE OPERATION STARTED      22280002
         BAL   RLINK,CPIPOS             GO GET DESIRED ORIENTATION      22300002
         ST    REQBAL,WICREQXF          SAVE AMOUNT REQUESTED           22320002
         ST    RXFERBAL,WICAVXFR        SAVE AMOUNT AVAILABLE           22340002
         B     CPIBASRW                 GO PERFORM DESIRED MOVE         22360002
*                                                                       22380002
*                                                                       22400002
*              ENTERED FOR READ COUNT.  END OF FILE IS NOT DETECTED     22420002
*              BY THIS COMMAND.  DETERMINE IF A RC-SCH KEY-TIC *-16     22440002
*              IS PRESENT.                                              22460002
*                                                                       22480002
CPIRC    EQU   *                        *                               22500002
         OI    WICOFLG2,WICDATAX        INDICATE OPERATION STARTED      22520002
         TM    CCWOPCDE,CCWMLTRK        IS THIS A MULTITRACK OP CODE    22540002
         BO    CPIRC10                  YES-DOESN'T QUALIFY FOR         22560002
*                                       SPECIAL PROCESSING              22580002
         TM    CCWFLAGS,CCWDC           DATA CHAINED            YM06876 22582002
         BO    CPIRC10                  YES-DOESN'T QUALIFY FOR YM06876 22584002
*                                       SPECIAL PROCESSING      YM06876 22586002
         TM    CCWFLAGS,CCWCC           COMMAND CHAINED         YM06876 22590002
         BZ    CPIRC10                  NO-DOESN'T QUALIFY FOR  YM06876 22592002
*                                       SPECIAL PROCESSING      YM06876 22594002
         LA    RWORK,L'CCW(RCCW)        ADDR OF NEXT CCW                22600002
         DROP  RCCW                     DISCONTINUE CURRENT DESCRIPTION 22620002
         USING CCWDES,RWORK             DESCRIBE THAT CCW               22640002
         CLI   CCWOPCDE,SCHKEYEQ        IS NEXT CCW A SINGLE TRACK      22660002
*                                       SEARCH KEY EQUAL                22680002
         BNE   CPIRC10                  NO-DOESN'T QUALIFY FOR SPECIAL  22700002
*                                       PROCESSING                      22720002
         TM    CCWFLAGS,CCWDC           DATA CHAINED            YM06876 22730002
         BO    CPIRC10                  YES-DOESN'T QUALIFY FOR YM06876 22732002
*                                       SPECIAL PROCESSING      YM06876 22734002
         TM    CCWFLAGS,CCWCC           IS THE SEARCH KEY EQUAL         22740002
*                                       COMMAND CHAINED                 22760002
         BZ    CPIRC10                  NO-DOESN'T QUALIFY FOR          22780002
*                                       SPECIAL PROCESSING              22800002
         LA    RWORK,L'CCW(RWORK)       GET ADDR OF CCW FOLLOWING       22820002
*                                       THE SEARCH KEY EQUAL            22840002
         TM    CCWOPCDE,LOW3BITS        LOW 3 ZERO ONLY FOR TIC         22860002
         BNZ   CPIRC10                  BR - NOT A TIC SINCE NON ZERO   22880002
         TM    CCWOPCDE,CCWTICBT        SECOND PART OF TIC TEST         22900002
         BZ    CPIRC10                  BR - NOT A TIC SO CONTINUE      22920002
*                                                                       22940002
*              SEE IF TIC IS A TIC TO READ COUNT                        22960002
*                                                                       22980002
         L     RWORK,CCWDATAD           GET ADDRESS FIELD OF CCW        23000002
         DROP  RWORK                    DISCONTINUE DESCRIPTION OF      23020002
*                                       NON-CURRENT CCW                 23040002
         USING CCWDES,RCCW              CCW ADDRESSABILITY              23060002
         LA    RWORK,ADDRONLY(RWORK)    CLEAR OP CODE FROM ADDR         23080002
         CR    RCCW,RWORK               TIC ADDR SAME AS READ COUNT     23100002
         BNE   CPIRC10                  NO-DOESN'T QUALIFY FOR SPE-     23120002
*                                       CIAL PROCESSING                 23140002
*                                                                       23160002
*              READ COUNT-SEARCH KEY EQUAL- TIC TO READ COUNT HAS       23180002
*              BEEN QUALIFIED.                                          23200002
*                                                                       23220002
         OI    WICXOFLG,WICRCSKT        NOTE HIS FACT SO SEARCH KEY     23240002
*                                       OPERATION WILL PERFORM A        23260002
*                                       REPETIVE SEARCH                 23280002
CPIRC10  EQU   *                        CONTINUE-NON-SPECIAL            23300002
         BAL   RLINK,CPIPOS             GET PROPER ORIENTATION          23320002
         ST    REQBAL,WICREQXF          SAVE AMOUNT REQUESTED           23340002
         ST    RXFERBAL,WICAVXFR        SAVE AMOUNT AVAILABLE           23360002
         B     CPIBRWLP                 GO TO READ WRITE ROUTINE        23380002
*                                       BY BYPASSING THE CLEARING       23400002
*                                       OF THE INDEX SWITCH             23420002
*                                                                       23440002
*                                                                       23460002
*              THE FOLLOWING ROUTINE OPERATES FOR THE READ COUNT SEARCH 23480002
*              KEY TIC COMBINATION AND IS USED BY THE SEARCH KEY        23500002
*              ROUTINE TO PERFORM THE READ COUNT OPERATION AT THE       23520002
*              CONCLUSION OF THE SEARCH KEY ROUTINE.  IT IS CALLED      23540002
*              REGARDLESS OF WHETHER OR NOT THE SEARCH WAS SUCESSFUL.   23560002
*                                                                       23580002
*              MUST MOVE THE COUNT FIELD OF THE CURRENT RECORD IN       23600002
*              ORDER TO SATISFY THE READ COUNT OPERATION.  AT THIS      23620002
*              POINT ONLY THE FIRST READ COUNT WAS PERFORMED AND        23640002
*              WAS DONE TO ENSURE THAT THE OPERATION WOULD GO           23660002
*              SUCCESSFULLY (THAT IS AN ERROR SITUATION DID NOT         23680002
*              NOT EXIST WITH THE READ COUNT).                          23700002
*                                                                       23720002
CPIRCSKT EQU   *                        *                               23740002
         S     RCCW,KCCWLGTH            BACK UP TO READ COUNT CCW       23760002
         SR    REQBAL,REQBAL            PREPARE FOR INSERT              23764002
         ICM   REQBAL,HWMASK,CCWCOUNT   GET REQUESTED LENGTH            23768002
         TM    CCWFLAGS,CCWSKIP         TRANSFER WANTED                 23780002
         BO    CPIRCSK5                 NO-PREPARE TO RETURN            23800002
         L     RBFRDATA,CCWDATAD        GET DATA ADDR FROM CCW          23820002
         LA    RBFRDATA,ADDRONLY(RBFRDATA)  CLEAR OP CODE OFF           23840002
         L     RCURSOR,WICCAM           GET CURRENT RECORD ADDR         23860002
         LA    RXFERBAL,L'CNTFIELD      GET AMOUNT AVAILABLE            23920002
         BAL   RLINK,CPIXMITL           GET LENGTH TO USE               23940002
         BCTR  RCXFER,R0                PREPARE FOR EXECUTE             23960002
         EX    RCXFER,EXMOVCNT          MOVE DESIRED BYTES              23980002
CPIRCSK5 EQU   *                        NO TRANSFER                     24000002
         NI    WICXOFLG,FULLBYTE-WICRCSKT   CLEAR COMBINATION FLAG      24020002
         LA    RCCW,L'CCW(RCCW)         RESTORE CCW ADDRESS OF SEARCH   24040002
*                                       KEY                             24060002
         BR    RLINK2                   RETURN TO CALLER                24080002
*                                                                       24100002
*                                                                       24120002
*                                                                       24140002
*              READ SECTOR ENTRY                                        24160002
*                                                                       24180002
CPIRSECT EQU   *                        *                               24200002
         CLI   WICSECT,WICNORPS         IF MAXIMUM SECTOR VALUE IS      24220002
*                                       ZERO THEN THIS IS NOT AN RPS    24240002
*                                       DEVICE                          24260002
         BE    CPIRSTER                 BR AS THIS OP CODE IS NOT       24280002
*                                       VALID FOR A NON RPS DEVICE      24300002
         OI    WICOFLG2,WICDATAX        INDICATE OPERATION STARTED      24320002
         LA    RXFERBAL,LSECTARG        NUMBER OF BYTES TO USE IS ONE   24340002
         ST    RXFERBAL,WICAVXFR        SAVE FOR ENDING ROUTINE         24360002
         ST    REQBAL,WICREQXF          NUMBER OF BYTES SPECIFIED       24380002
*                                       IN CCW COUNT                    24400002
XPGCK01  MVI   ADDRONLY(RBFRDATA),SECTZERO  RETURN A SECTOR OF ZERO     24420002
         MVI   WICSEQFG,FLAGCLR         CLEAR PREVIOUS SEQUENCE         24440002
         B     CPIOPEND                 GO END OPERATION                24460002
*                                                                       24480002
*                                                                       24500002
*              ENTERED FOR READ SETOR WHEN DEVICE IS NOT AN RPS DEVICE  24520002
*                                                                       24540002
CPIRSTER EQU   *                        *                               24560002
         OI    WICOFLG2,WICINTRP        INDICATE ERROR CONDITION        24580002
         LA    RERRDISP,ERR01DSP        DISPLACEMENT INTO ERROR TBL     24600002
*                                       FOR INVALID OP CODE ERROR       24620002
         STH   RERRDISP,WICERDSP        SAVE FOR ENDING RTN             24640002
         B     CPIOPEND                 GO END OPERATION                24660002
         TITLE 'CHANNEL PROGRAM INTERPRETER - MOVE ROUTINE'             24680002
*********************************************************************** 24700002
*                                                                     * 24720002
*        DATA MOVEMENT ROUTINE                                        * 24740002
*                                                                     * 24760002
*        THE FOLLOWING PERFORMS THE DATA MOVEMENT FOR THE READ AND    * 24780002
*        WRITE OPERATION AND CONTINUES PROCESSING UNTIL THE OPER-     * 24800002
*        ATION IS COMPLETE.  THIS INCLUDES DATA CHAINED CCW(S)        * 24820002
*        AND PROCESSING OF OVERFLOW RECORDS.                          * 24840002
*                                                                     * 24860002
*        INPUT - REG REQBAL CONTAINS THE CURRENT REQUESTED AMOUNT     * 24880002
*                REG RXFERBAL CONTAINS THE CURRENT AVAILABLE          * 24900002
*                REG RCURSOR IS THE CURRENT TRACK LOCATION            * 24920002
*                REG RBFRDATA IS THE CURRENT LOCATION IN THE BUFFER   * 24940002
*                                                                     * 24960002
*********************************************************************** 24980002
*                                                                       25000002
CPIBASRW EQU   *                        *                               25020002
         NI    WICXOFLG,FULLBYTE-WICNDXPT  CLEAR INDEX PASSED           25040002
*                                                                       25060002
*              ENTERED BY READ COUNT WHICH DOESN'T CLEAR INDEX          25080002
*              PASSED AND ALSO IS THE MOVE LOOP BEGINNING               25100002
*                                                                       25120002
CPIBRWLP EQU   *                        *                               25140002
         TM    WICOFLG2,WICXFCOM        TRANSFER COMPLETE OR NOT        25160002
*                                       DESIRED SUCH AS ERASE           25180002
         BO    CPIBRW40                 YES - SKIP DATA MOVEMENT        25200002
         TM    WICOFLG2,WICWRTIP        IS THIS A WRITE                 25220002
         BZ    CPIBRW20                 BR READ IN PROCESS              25240002
         OI    VTST,VTUPDATE            INDICATE TRACK UPDATE           25260002
         CR    RXFERBAL,REQBAL          COMPARE THE WRITE CONTROL       25280002
*                                       AMOUNT WHICH REPRESENTS THE     25300002
*                                       AMOUNT AVAILABLE TO THAT        25320002
*                                       WHICH IS REQUESTED OR THE       25340002
*                                       CCW AMOUNT                      25360002
         BNH   CPIBRW10                 TRACK AMOUNT IS LESS THAN       25380002
*                                       OR EQUAL TO THAT REQUESTED      25400002
*                                       WHEN BRANCH IS TAKEN            25420002
*                                                                       25440002
*              TRACK AVAILABLE AMOUNT IS GREATER THAN THE CURRENT CCW   25460002
*              REQUEST AMOUNT.  SET THE AMOUNT TO USE SUCH THAT ONE     25480002
*              BYTE OF PADDING RESULTS WHEN THE MOVE IS PERFORMED.      25500002
*              THIS IS DONE IN ORDER TO EXPLOIT THE CONDITION CODE      25520002
*              WHICH IS SET AT THE COMPLETION OF THE MOVE CHARACTER     25540002
*              LONG                                                     25560002
*                                                                       25580002
         LR    RCXFER,RXFERBAL          CALCULATE THE AMOUNT WHICH      25600002
         SR    RCXFER,REQBAL            IS THE AVAILABLE RESIDUAL       25620002
         LA    RXFERBAL,PADONE(REQBAL)  THE TO COUNT WILL BE ONE        25640002
*                                       GREATER THAN THAT WHICH IS      25660002
*                                       SPECIFIED IN THE CURRENT CCW    25680002
*                                                                       25700002
*              PERFORM THE MOVE FOR A WRITE OPERATION                   25720002
*                                                                       25740002
CPIBRW10 EQU   *                        *                               25760002
XPGCK02  MVCL  RCURSOR,RBFRDATA         MOVE DESIRED AMOUNT             25780002
         BE    CPIBRW60                 BR MEANS THAT THE REQUESTED     25800002
*                                       AND THE AVAILABLE AMOUNTS       25820002
*                                       WERE THE SAME                   25840002
         BL    CPIBRW50                 BR MEANS THAT THE CCW COUNT     25860002
*                                       EXCEEDED THE AVAILABLE AMOUNT   25880002
*                                       WHICH MEANS THAT THE AMOUNT     25900002
*                                       NOW AVAILABLE IS ZERO AND       25920002
*                                       THE REQUESTED AMOUNT IS GREATER 25940002
*                                       THAN ZERO SO GO CHECK TO SEE    25960002
*                                       IF THIS IS AN OVERFLOW RECORD   25980002
*                                                                       26000002
*              AVAILABLE AMOUNT EXCEEDED THAT REQUESTED WHICH MEANS     26020002
*              THAT THE REQUEST AMOUNT IS NOW = 0 AND THE AVAILABLE     26040002
*              AMOUNT IS STILL GREATER THAN 0                           26060002
*                                                                       26080002
         BCTR  RCURSOR,ZERO             BACK UP TRACK POINTER ONE       26130002
         LR    RXFERBAL,RCXFER          RESIDUAL OF AVAILABLE BYTES     26132002
         B     CPIBRW90                 GO SEE IF ANOTHER CCW IS        26140002
*                                       AVAILABLE FOR USE               26160002
*                                                                       26180002
*              ENTERED WHEN THE OPERATION IS A READ REQUEST AND         26200002
*              TRANSFER IS NOT COMPLETE                                 26220002
*                                                                       26240002
CPIBRW20 EQU   *                        *                               26260002
         TM    CCWFLAGS,CCWSKIP         SKIP TRANSFER FOR READ          26280002
         BO    CPIBRW40                 YES SKIP MOVE                   26300002
         LR    RCXFER,REQBAL            CALCULATE THE RESIDUAL IN CASE  26320002
         SR    RCXFER,RXFERBAL          THE REQUESTED AMOUNT IS GREATER 26340002
*                                       THAN THE AVAILABLE AMOUNT       26360002
         BNP   CPIBRW21                 BR MEANS THAT THE BUFFER IS     26380002
*                                       SMALLER THAN THE AMOUNT ON      26400002
*                                       THE TRACK SO USE THE REQUESTED  26420002
*                                       AMOUNT FOR THE TO COUNT         26440002
         LR    REQBAL,RXFERBAL          SINCE THE REQUESTED AMOUNT      26460002
*                                       IS GREATER THAN OR EQUAL TO     26480002
*                                       THAT ON THE TRACK USE THE       26500002
*                                       AVAILABLE AMOUNT FOR THE TO     26520002
*                                       COUNT TO AVOID ANY PADDING      26540002
*                                       IN THE USER'S BUFFER            26560002
*                                                                       26580002
*              PERFORM THE DATA MOVEMENT FOR A READ REQUEST             26600002
*                                                                       26620002
CPIBRW21 EQU   *                        *                               26640002
XPGCK03  MVCL  RBFRDATA,RCURSOR         MOVE DATA TO CCW BUFFER         26660002
         LTR   RCXFER,RCXFER            TEST RESIDUAL WHICH WAS         26680002
*                                       CALCULATED ABOVE                26700002
         BZ    CPIBRW60                 BR MEANS BOTH THE REQUESTED     26720002
*                                       AND THE AVAILABLE AMOUNTS       26740002
*                                       HAVE GONE TO ZERO - GO SEE      26760002
*                                       IF ANOTHER CCW FOLLOWS AND      26780002
*                                       CHECK FOR OVERFLOW PROCESSING   26800002
         BM    CPIBRW90                 BR MEANS THAT THE AVILABLE      26820002
*                                       AMOUNT WAS LARGER AND IS NOT    26840002
*                                       ZERO YET SO GO CHECK FOR NEXT   26860002
*                                       CCW DATA CHAINED                26880002
*                                                                       26900002
*              FALL THROUGH MEANS THAT THE REQUESTED AMOUNT WAS GREATER 26920002
*              THAN THAT WHICH WAS AVAILABLE SO SET THE CURRENT REQUEST 26940002
*              AMOUNT EQUAL TO THE RESIDUAL OF THIS MOVE AND THEN GO    26960002
*              CHECK TO SEE IF THIS IS AN OVERFLOW RECORD WHICH WOULD   26980002
*              MEAN THAT PROCESSING WOULD CONTINUE AS THE AVAILABLE     27000002
*              AMOUNT WOULD BE UPDATED                                  27020002
*                                                                       27040002
         LR    REQBAL,RCXFER            CURRENT REQUEST BALANCE         27060002
         B     CPIBRW50                 GO TEST FOR OVERFLOW RECORD     27080002
*                                                                       27100002
CPIBRW40 EQU   *                        *                               27120002
         BAL   RLINK,CPIXMITL           GET AMOUNT TO MOVE WHICH        27140002
*                                       IS THE SMALLER OF REQUEST       27160002
*                                       BALANCE OR TRANSFER BALANCE     27180002
         SR    RXFERBAL,RCXFER          DECREASE BYTES AVAILABLE        27200002
         SR    REQBAL,RCXFER            DECREASE BYTES REQUESTED        27220002
         AR    RCURSOR,RCXFER           BUMP TRACK CURSOR               27240002
         AR    RBFRDATA,RCXFER          BUMP BUFFER CURSOR              27260002
         CR    RXFERBAL,REQBAL          COMPARE REMAINING VALUES        27280002
         BE    CPIBRW60                 EQUAL COMPARE MEANS THAT BOTH   27300002
*                                       THE REQUESTED AMOUNT AND THAT   27320002
*                                       AVAILABLE HAVE GONE TO ZERO     27340002
*                                       GO CHECK FOR ANOTHER CCW DATA   27360002
*                                       CHAINED FROM THIS ONE AND SEE   27380002
*                                       IF THIS IS AN OVERFLOW RECORD   27400002
*                                                                       27420002
         BH    CPIBRW90                 AVAILABLE AMOUNT IS GREATER     27440002
*                                       THAN THAT REQUESTED WHICH MEANS 27460002
*                                       THAT THE REQUEST BALANCE HAS    27480002
*                                       REACHED ZERO BUT THAT AVAILABLE 27500002
*                                       IS GREATER THAN ZERO            27520002
*                                       GO CHECK FOR ANOTHER CCW DATA   27540002
*                                       CHAINED FROM THIS ONE           27560002
*                                                                       27580002
*              ENTERED WHEN THE AVAILABLE AMOUNT HAS GONE TO ZERO.      27600002
*              IF THIS IS AN OVERFLOW RECORD THEN NEXT TRACK NEEDS TO   27620002
*              BE PROCESSED                                             27640002
*                                                                       27660002
CPIBRW50 EQU   *                        *                               27680002
         TM    WICRESTA,WICOVFIP        IS THIS AN OVERFLOW REC         27700002
         BO    CPIBRW80                 YES - GO PREPARE FOR NEW TRACK  27720002
*                                                                       27740002
*              END OF MOVEMENT                                          27760002
*                                                                       27780002
         B     CPIOPEND                 GO TO OPERATION END             27800002
*                                                                       27820002
*              ENTERED WHEN BOTH THE CURRENTLY AVAILABLE BYTES AND THE  27840002
*              REQUESTED BYTES ARE ZERO                                 27860002
*                                                                       27880002
CPIBRW60 EQU   *                        *                               27900002
         TM    WICOFLG2,WICINTRP        WAS AN ERROR DETECTED WHEN      27920002
*                                       THE LAST CCW OF THIS OPERATION  27940002
*                                       WAS FETCHED                     27960002
         BO    CPIBRW50                 YES - DO NOT PROCESS NEXT CCW   27980002
*                                       AT THIS TIME BUT GO CHECK TO    28000002
*                                       SEE IF OPERATION IS DONE        28020002
         TM    CCWFLAGS,CCWDC           DATA CHAINED                    28040002
         BO    CPIBRW70                 YES - GET NEXT CCW              28060002
         OI    WICOFLG2,WICXFCOM        INDICATE NO MORE TRANSFER       28080002
         B     CPIBRW50                 GO SEE IF FINISHED              28100002
CPIBRW70 EQU   *                        *                               28120002
         OI    WICOFLG2,WICDC           INDICATE DATA CHAINING SO       28140002
*                                       CCW CHECK ROUTINE WILL          28160002
*                                       IGNORE OP CODE                  28180002
         LA    RCCW,L'CCW(RCCW)         NEXT CCW                        28200002
         BAL   RLINK,CPICCWCK           CHECK FORMAT OF NEW CCW AND     28220002
*                                       GET NEW COUNT AND ADDRESS       28240002
         L     RWORK,WICREQXF           PREVIOUS TOTAL                  28260002
         AR    RWORK,REQBAL             NEW REQUEST COUNT               28280002
         ST    RWORK,WICREQXF           AND SAVE FOR ENDING             28300002
*                                                                       28320002
*              IF OVERFLOW RECORD THEN MUST PROCESS FOR NEXT TRACK      28340002
*                                                                       28360002
         TM    WICRESTA,WICOVFIP        OVERFLOW RECORD                 28380002
         BO    CPIBRW80                 GO PREPARE FOR NEXT TRACK       28400002
         OI    WICOFLG2,WICXFCOM        INDICATE NO MORE TRANSFER       28420002
         B     CPIBRWLP                 GO THROUGH LOOP ONE MORE TIME   28440002
*                                       WITH NEW REQUEST                28460002
*                                                                       28480002
*              THE FOLLOWING LABEL IS ENTERED WHEN THE CURRENT RECORD   28500002
*              IS AN OVERFLOW RECORD.  A NEW TRACK MUST BE REQUESTED    28520002
*              AND THE TOTAL AVAILABLE BYTES UPDATED.                   28540002
*                                                                       28560002
CPIBRW80 EQU   *                        *                               28580002
         BAL   RLINK2,CPINXTRK          REQUEST NEXT TRACK              28600002
*                                                                       28620002
*              OVERFLOW RESTART LABEL ENTERED WHEN NEW TRACK READY      28640002
*                                                                       28660002
CPIOVFRS EQU   *                        *                               28680002
         NI    WICRESTA,FULLBYTE-WICOVFIP  CLEAR OVERFLOW PROCESS FLAG  28700002
*                                                                       28720002
*              THE POSITIONING ROUTINE MUST BE CALLED TO OBTAIN         28740002
*              THE DESIRED POSITION AND OBTAIN THE CURRENT AVAIL-       28760002
*              ABLE BYTES.  HOWEVER, SINCE THE REQUIRED PARAMETERS      28780002
*              MAY NOT BE SET UP AT THIS TIME, A SET OF DUMMY           28800002
*              PARAMETERS IS CONSTRUCTED TO OBTAIN THE DESIRED          28820002
*              RESULTS.  THE KEY PORTION MUST BE SKIPPED.               28840002
*                                                                       28860002
         ST    RCCW,WICWORK             SAVE CURRENT CCW                28880002
         LA    RCCW,WICWORK             SET DUMMY CCW ADDR              28900002
         MVI   CCWOPCDE,DUMMYOP         SET OP CODE OF FAKE CCW IN      28920002
*                                       THAT POSITION ROUTINE WILL      28940002
*                                       POSITION TO THE DATA FIELD OF   28960002
*                                       RECORD ONE FOR THE OVERFLOW     28980002
*                                       SEGMENT                         29000002
         SR    ROPCODE,ROPCODE          CLEAR REGISTER                  29020002
         IC    ROPCODE,CCWOPCDE         DUMMY OP CODE                   29040002
         BAL   RLINK,CPIPOS             GET POSITION AND AVAIL BYTES    29060002
         NI    WICXOFLG,FULLBYTE-WICNDXPT   CLEAR INDEX POINT PASSED    29080002
         L     RCCW,WICWORK             RESTORE CCW ADDR                29100002
         LA    RCCW,ADDRONLY(RCCW)      CLEAR OFF DUMMY OP CODE         29120002
*                                                                       29140002
*              UPDATE TOTAL AVAILABLE BYTES                             29160002
*                                                                       29180002
         L     RWORK,WICAVXFR           PREVIOUS TOTAL                  29200002
         AR    RWORK,RXFERBAL           ADD NEW AMOUNT                  29220002
         ST    RWORK,WICAVXFR           NEW TOTAL                       29240002
         B     CPIBRWLP                 CONTINUE PROCESS                29260002
*                                                                       29280002
*              ENTERED WHEN CURRENT TRANSFER BALANCE IS NOT ZERO        29300002
*                                                                       29320002
CPIBRW90 EQU   *                        *                               29340002
         TM    WICOFLG2,WICINTRP        CHANNEL PGM INTERRUPT SET       29360002
*                                       THIS WOULD BE THE CASE IF       29380002
*                                       DATA CHAINING CAUSED A NEW      29400002
*                                       CCW TO BE FETCHED WHICH RE-     29420002
*                                       SULTED IN AN ERROR              29440002
         BO    CPIBRW95                 YES - DO NOT FETCH ANOTHER      29460002
*                                       CCW BUT PERFORM A ZERO FILL     29480002
*                                       IF NEEDED                       29500002
         TM    CCWFLAGS,CCWDC           DATA CHAINING SPECIFIED         29520002
         BZ    CPIBRW95                 NO - PROCESS LONG BLOCK         29540002
         OI    WICOFLG2,WICDC           INDICATE DATA CHAINING SO       29560002
*                                       CCW CHECK ROUTINE WILL          29580002
*                                       IGNORE OP CODE                  29600002
         LA    RCCW,L'CCW(RCCW)         NEXT CCW                        29620002
         BAL   RLINK,CPICCWCK           CHECK FORMAT OF NEW CCW AND     29640002
*                                       GET NEW COUNT AND ADDRESS       29660002
         L     RWORK,WICREQXF           PREVIOUS TOTAL                  29680002
         AR    RWORK,REQBAL             NEW REQUEST COUNT               29700002
         ST    RWORK,WICREQXF           AND SAVE FOR ENDING             29720002
         B     CPIBRWLP                 CONTINUE PROCESS                29740002
*                                                                       29760002
*              ENTERED WHEN CURRENT TRANSFER BALANCE IS NOT ZERO        29780002
*              AND DATA CHAINING NOT SPECIFIED.  PROCESS LONG BLOCK.    29800002
*                                                                       29820002
CPIBRW95 EQU   *                        *                               29840002
         TM    WICOFLG2,WICWRTIP        WRITE IN PROCESS                29860002
         BZ    CPIBRW96                 NO - SET TRANSFER COMPLETE      29880002
*                                                                       29900002
*              FILL REMAINDER OF RECORD WITH ZEROES AS THIS IS A WRITE  29920002
*                                                                       29940002
         SR    REQBAL,REQBAL            INDICATE NO DATA MOVEMENT       29960002
*                                       ONLY PADDING WITH ZEROES        29980002
         MVCL  RCURSOR,RBFRDATA         WILL PAD WITH ZEROES            30000002
         OI    VTST,VTUPDATE            INDICATE TRACK UPDATED          30020002
*                                                                       30040002
CPIBRW96 EQU   *                        *                               30060002
         OI    WICOFLG2,WICXFCOM        TRANSFER IS COMPLETE            30080002
         B     CPIBRW50                 GO CHECK IF DONE                30100002
         TITLE 'CHANNEL PROGRAM INTERPRETER - WRITE COMMANDS'           30120002
*********************************************************************** 30140002
*                                                                     * 30160002
*        WRITE ROUTINE                                                * 30180002
*                                                                     * 30200002
*        THE FOLLOWING CODE IS THE COMBINED ROUTINES FOR WCKD,        * 30220002
*        WSPCKD, WD, AND WKD.  EACH OP CODE HAS ITS OWN ENTRY POINT.  * 30240002
*        WRITE PREREQUISITES ARE CHECKED AND THE FILE MASK IS         * 30260002
*        CHECKED.  FOR THE FORMATTING WRITES, THE END OF DATA IS      * 30280002
*        CALCULATED ALONG WITH THE EFFECTIVE END OF DATA.  THE        * 30300002
*        EFFECTIVE END OF DATA IS THE END OF DATA PLUS THE SUM OF     * 30320002
*        THE OVERHEADS (GAPS) WHICH WOULD HAVE BEEN REQUIRED ON AN    * 30340002
*        ACTUAL DEVICE.                                               * 30360002
*                                                                     * 30380002
*********************************************************************** 30400002
*                                                                       30420002
*              ENTERED FOR WSPCKD                                       30440002
*                                                                       30460002
CPIWSCKD EQU   *                        *                               30480002
         OI    WICOFLG1,WICWSCKD        INDICATE WSPCKD ENTRY           30500002
         B     CPIWRT10                 BR TO INDICATE FORMAT WRITE     30520002
*                                                                       30540002
*              ENTERED FOR ERASE                                        30560002
*                                                                       30580002
CPIERASE EQU   *                        *                               30600002
         OI    WICOFLG1,WICERASE        INDICATE ERASE ENTRY            30620002
         B     CPIWRT10                 BR TO INDICATE FORMAT WRITE     30640002
*                                                                       30660002
*              ENTERED FOR WCKD                                         30680002
*                                                                       30700002
CPIWCKD  EQU   *                        *                               30720002
         OI    WICOFLG1,WICWCKD         INDICATE WCKD ENTRY             30740002
CPIWRT10 EQU   *                        *                               30760002
         OI    WICOFLG1,WICFMTW         INDICATE FORMAT WRITE           30780002
*                                                                       30800002
*              PERFORM THE FUNCTIONS WHICH ARE DONE IN THE POSITION     30820002
*              ROUTINE SINCE IT WILL NOT BE CALLED.  IF THE PRE-        30840002
*              REQUISITES HAVE BEEN MET, THE POSITION IS KNOWN.         30860002
*                                                                       30880002
*              DETERMINE THE BEGINNING OF WRITE AREA ON TRACK           30900002
*                                                                       30920002
         L     RCURSOR,WICCAM           ADDR OF LAST RECORD             30940002
         LA    RCURSOR,L'CNTFIELD(RCURSOR)  BUMP OVER COUNT             30960002
         AH    RCURSOR,WICKL            PREVIOUS REC KEY LENGTH         30980002
         A     RCURSOR,WICDL            PREVIOUS REC DATA LENGTH        31000002
*                                                                       31020002
         LA    RWORK,WICAFDAT           RELATIVE POSITION WILL BE       31040002
         STH   RWORK,WICRELTP           AFTER DATA WHEN DONE            31060002
*                                                                       31080002
*              COMPUTE THE NUMBER OF BYTES INVOLVED IN WRITE            31100002
*                                                                       31120002
         USING CNTFIELD,RBFRDATA        DESCRIBE COUNT TO BE USED       31140002
         SR    RXFERBAL,RXFERBAL        CLEAR REG                       31160002
         ST    RXFERBAL,WICWORK         CLEAR WORK AREA                 31180002
XPGCK04  IC    RXFERBAL,CNTKL           GET KEY LENGTH                  31200002
         LA    RXFERBAL,L'CNTFIELD(RXFERBAL) LENGTH OF COUNT            31220002
*                                       GET LENGTH OF DATA TO WRITE     31240002
XPGCK05  MVC   WICWORK+L'WICWORK-L'CNTDL(L'CNTDL),CNTDL MOVE DATA       31260002
         A     RXFERBAL,WICWORK         ADD DATA LENGTH                 31280002
         DROP  RBFRDATA                 DISCONTINUE USE                 31300002
*                                                                       31320002
*              CHECK THE WRITE PREREQUISITES AS INDICATED BY THE        31340002
*              SEQUENCE FLAGS.                                          31360002
*                                                                       31380002
         TM    WICSEQFG,WICLWCKD        LAST OPERATION A WCKD           31400002
         BO    CPISEQOK                 BR PREREQUISITE SATISFIED       31420002
*                                                                       31440002
*              ENTERED FOR WD - CONTINUE PREREQUISITE CHECKING          31460002
*                                                                       31480002
CPIWD    EQU   *                        *                               31500002
         TM    WICSEQFG,WICFSKE         CHAINED FROM A FULL SEARCH      31520002
*                                       KEY EQUAL                       31540002
         BO    CPISEQOK                 BR PREREQUISITES SATISFIED      31560002
*                                                                       31580002
*              ENTERED FOR WKD - CONTINUE PREREQUISITE CHECKING         31600002
*                                                                       31620002
CPIWKD   EQU   *                        *                               31640002
         TM    WICSEQFG,WICFSIDE        CHAINED FROM A FULL SID EQ      31660002
         BZ    CPISEQER                 BR PREREQUISITES NOT SATISFIED  31680002
*                                       GO SET INVALID SEQUENCE         31700002
*              ENTERED WHEN WRITE PREREQUISITES VERIFIED                31720002
*                                                                       31740002
CPISEQOK EQU   *                        *                               31760002
         MVI   WICSEQFG,FLAGCLR         CLEAR PREVIOUS SEQUENCE         31780002
         TM    WICOFLG1,WICWCKD         THIS A WCKD                     31800002
         BZ    CPIWRT20                 BR DOESN'T QUALIFY AS A         31820002
*                                       PREREQUISITE FOR NEXT           31840002
         OI    WICSEQFG,WICLWCKD        INDICATE SEQUENCE OF WCKD       31860002
CPIWRT20 EQU   *                        NON-WCKD                        31880002
         TM    WICOFLG1,WICFMTW         THIS A FORMAT WRITE             31900002
         BZ    CPIWRT80                 GO PROCESS WD AND WKD           31920002
*                                                                       31940002
*              CHECK TO MAKE SURE THAT AN OVERFLOW RECORD DOES NOT      31960002
*              PRECEDE THIS RECORD TO BE WRITTEN.                       31980002
*                                                                       32000002
         TM    VTST,VTOVFL              OVERFLOW REC ON TRACK           32020002
         BZ    CPIWRT30                 NO - BR SEQUENCE ALRIGHT        32040002
         C     RCURSOR,WICDATND         OVERLAYING THE OVERFLOW REC     32060002
         BNL   CPISEQER                 NO - GO SET INVALID SEQUENCE    32080002
*                                       AS OVERFLOW REC MUST BE LAST    32100002
*                                                                       32120002
*              CHECK FILE MASK FOR FORMAT WRITE ALLOWED                 32140002
*                                                                       32160002
CPIWRT30 EQU   *                        *                               32180002
         TM    WICFMASK,WICFMWRT        FILE MASK ALLOW WRITE           32200002
         BM    CPIFMER                  NO - GO SET FILE MASK           32220002
*                                       VIOLATION ERROR                 32240002
*                                                                       32260002
*              INITIATE OPERATION                                       32280002
*                                                                       32300002
         NI    VTST,FULLBYTE-VTOVFL     TURN OFF OVERFLOW FLAG          32320002
*                                                                       32340002
*              DETERMINE IF THIS RECORD WILL CAUSE TRACK OVERRRUN.      32360002
*              THIS WILL BE ACCOMPLISHED BY CALCULATING THE TRACK       32380002
*              BALANCE FROM THE POINT THAT THIS RECORD WILL BE          32400002
*              WRITTEN.  THE CURRENT TRACK BALANCE WILL UPDATED TO      32420002
*              REFLECT ANY RECORDS WHICH ARE BEING OVERLAYED (IF        32440002
*              ANY).  THE EFFECTIVE LENGTH OF THIS RECORD (CALCU-       32460002
*              LATED AS THE LAST BLOCK) IS THE COMPARED TO THE          32480002
*              NEW TRACK BALANCE AND IF THE RECORD WILL FIT,  THE       32500002
*              TRACK BALANCE WILL BE DECREASED BY THE EFFECTIVE         32520002
*              LENGTH OF THIS RECORD CALCULATED AS NOT THE LAST         32540002
*              RECORD ON THE TRACK.                                     32560002
*                                                                       32580002
*              DETERMINE THE EFFECTIVE LENGTH OF RECORDS BEING          32600002
*              OVERLAYED.                                               32620002
*                                                                       32640002
         ST    RFROM,WICRGSV0           SAVE CONTENTS                   32660002
         ST    RTO,WICRGSV1             SAVE CONTENTS                   32680002
         LR    RFROM,RCURSOR            BEGINNING ADDR OF WRITE         32700002
         L     RTO,WICDATND             ENDING ADDR OF CURRENT          32720002
*                                       DATA                            32740002
         BAL   RLINK,CPISPACE           GET EFFECTIVE LENGTH RE-        32760002
*                                       TURNED IN RWORK                 32780002
         L     RFROM,WICRGSV0           RESTORE CONTENTS                32800002
         L     RTO,WICRGSV1             RESTORE CONTENTS                32820002
         A     RWORK,VTRKBAL            ADD TO PREVIOUS BALANCE         32840002
         ST    RWORK,VTRKBAL            UPDATE TRACK BALANCE            32860002
         LTR   RWORK,RWORK              IS NEW TRK BAL LESS THAN        32880002
*                                       OR EQUAL TO ZERO                32900002
         BNH   CPIWRT40                 BR - INDICATES TRACK IS         32920002
*                                       COMPLETLY FILLED - GO           32940002
*                                       PROCESS OVERRUN                 32960002
*                                                                       32980002
*              CALCULATE THE LENGTH OF THIS BLOCK AS THE LAST           33000002
*                                                                       33020002
         LR    RWORK,RXFERBAL           LENGTH OF REC TO WRITE          33040002
         S     RWORK,KCNTLGTH           DECREASE BY LENGTH OF COUNT     33060002
*                                       LEAVING (KL+DL)                 33080002
         AH    RWORK,WICLGAP            ADD LAST BLOCK OVERHEAD         33100002
         USING COUNTDES,RBFRDATA        DESCRIBE COUNT TO BE WRITTEN    33120002
         CLI   CNTKL,NOKEY              IS KEY PRESENT                  33140002
         DROP  RBFRDATA                 DICONTINUE DESCRIPTION          33160002
         BNE   CPIWRT35                 YES - RESULTS CORRECT           33180002
         SH    RWORK,WICKEYGP           SUBTRACT KEY CONSTANT SINCE     33200002
*                                       NOT PRESENT                     33220002
CPIWRT35 EQU   *                        *                               33240002
         C     RWORK,VTRKBAL            WILL THIS RECORD FIT            33260002
         BH    CPIWRT50                 NO - GO PROCESS OVERRUN         33280002
         TM    WICOFLG1,WICERASE        IS THIS AN ERASE                33300002
         BO    CPIWRT60                 YES - GO PROCESS ERASE          33320002
*                                                                       33340002
*              DECREASE THE TRACK BALANCE BY THE EFFECTIVE LENGTH       33360002
*              OF THIS RECORD CALCULATED AS NOT THE LAST RECORD         33380002
*              ON THE TRACK.                                            33400002
*                                                                       33420002
         ST    RFROM,WICRGSV0           SAVE REG CONTENTS               33440002
         LR    RFROM,RBFRDATA           USE START OF DATA AREA AS       33460002
*                                       BEGINNING ADDR                  33480002
         LA    RTO,ADDRONLY(RBFRDATA,RXFERBAL)  USE AN ENDING ADDR      33500002
*                                       OF LENGTH OF THIS RECORD        33520002
         BAL   RLINK,CPISPACE           GET TRACK REDUCTION AMOUNT      33540002
*                                       RWORK CONTAINS RESULTS          33560002
         L     RFROM,WICRGSV0           RESTORE CONTENTS                33580002
         L     RWORK1,VTRKBAL           GET TRACK BALANCE               33600002
         SR    RWORK1,RWORK             DECREASE BY THE AMOUNT USED     33620002
*                                       BY THIS RECORD - THIS VALUE     33640002
*                                       MAY GO NEGATIVE BUT IS COM-     33660002
*                                       PENSATED FOR ON SUBSEQUENT      33680002
*                                       USES WHEN TRACK BALANCE IS      33700002
*                                       INCREASED FOR RECORDS BEING     33720002
*                                       OVERLAYED                       33740002
         ST    RWORK1,VTRKBAL           SET NEW TRACK BALANCE           33760002
*              UPDATE THE ENDING DATA ADDRESS                           33780002
*                                                                       33800002
         LA    RWORK,ADDRONLY(RCURSOR,RXFERBAL)  BEGINNING ADDR         33820002
*                                       PLUS LENGTH OF RECORD           33840002
         ST    RWORK,WICDATND           AND SAVE                        33860002
         SR    RWORK,RTRKBFR            DISPLACEMENT FROM START OF      33880002
*                                       TRACK AREA                      33900002
         ST    RWORK,VTDATEND           AND SAVE                        33920002
         ST    RCURSOR,WICCAM           SAVE START OF THIS RECORD       33940002
         USING COUNTDES,RBFRDATA        DESCRIBE DATA COUNT             33960002
         MVC   WICKL+L'WICKL-L'CNTKL(L'CNTKL),CNTKL  SAVE KEY LENGTH    33980002
         MVC   WICDL+L'WICDL-L'CNTDL(L'CNTDL),CNTDL  AND DATA LENGTH    34000002
         DROP  RBFRDATA                 DISCONTINUE DESCPIPTION         34020002
*                                                                       34040002
*              TURN ON TRACK OVERFLOW BIT IF THIS IS A WSPCKD           34060002
*                                                                       34080002
         TM    WICOFLG1,WICWSCKD        WRITE SPECIAL                   34100002
         BZ    CPIWRTND                 NO - GO PREPARE FOR MOVE        34120002
         OI    VTST,VTOVFL              TURN ON OVERLOW SWITCH          34140002
         B     CPIWRTND                 GO PREPARE FOR MOVE             34160002
*                                                                       34180002
*              ENTERED WHEN THE TRACK BALANCE WAS ZERO OR NEGATIVE      34200002
*                                                                       34220002
CPIWRT40 EQU   *                        *                               34240002
         SR    RXFERBAL,RXFERBAL        SET THE NUMBER OF AVAILABLE     34260002
*                                       BYTES TO ZERO                   34280002
         LA    RERRDISP,ERR05DSP        DISPLACEMENT FOR TRACK OVER-    34300002
*                                       RUN ERROR                       34320002
         STH   RERRDISP,WICERDSP        WILL BE USED BY END RTN         34340002
         OI    WICOFLG2,WICERROR        INDICATE AN ERROR SITUATION     34360002
*                                       HAS BEEN ENCOUNTERED            34380002
         B     CPIWRT70                 GO INDICATE NO TRANSFER         34400002
*                                       TO TAKE PLACE                   34420002
*              ENTERED WHEN TRACK BALANCE GREATER THAN ZERO BUT         34440002
*              RECORD TO BE WRITTEN WILL CAUSE TRACK OVERRUN            34460002
*                                                                       34480002
CPIWRT50 EQU   *                        *                               34500002
         L     RXFERBAL,VTRKBAL         SET AVAILABLE BYTES AS          34520002
*                                       THE TRACK BALANCE               34540002
*                                       THAT IS CALCULATE THE   ZA00143 34542002
*                                       BYTES WHICH WOULD       ZA00143 34544002
*                                       BE WRITTEN AS           ZA00143 34546002
*                                       8 + CURRENT TRACK BAL   ZA00143 34548002
*                                       - LAST GAP OVERHEAD     ZA00143 34548402
         LA    RXFERBAL,L'CNTFIELD(RXFERBAL)  COUNT FIELD       YM04660 34550002
         SH    RXFERBAL,WICLGAP         DECREASE BY LAST GAP    ZA00143 34552002
*                                       OVERHEAD                ZA00143 34554002
         USING COUNTDES,RBFRDATA        DESCRIBE COUNT FIELD    ZA00143 34554402
         CLI   CNTKL,NOKEY              DOES RECORD COUNT FIELD ZA00143 34556002
*                                       INDICATE KEYED RECORD   ZA00143 34558002
         BNE   CPIWRT55                 YES - VALUE IS CORRECT  ZA00143 34558402
*                                       AS LAST GAP OVERHEAD    ZA00143 34558802
*                                       ASSUMES KEYED RECORD    ZA00143 34559202
         DROP  RBFRDATA                 DISCONTINUE CURRENT     ZA00143 34559602
*                                       DESCRIPTION             ZA00143 34559702
         AH    RXFERBAL,WICKEYGP        FOR NON KEYED REC       ZA00143 34559802
*                                       ADD BACK IN THE KEY     ZA00143 34559902
*                                       OVERHEAD WHICH HAS      ZA00143 34566602
*                                       BEEN ALREADY SUBTRACTED ZA00143 34568602
*                                       OUT                     ZA00143 34570602
CPIWRT55 EQU   *                        *                       ZA00143 34572602
         LTR   RXFERBAL,RXFERBAL        IF VALUE GOES NEGATIVE  ZA00143 34573002
         BM    CPIWRT40                 THEN WE DON'T HAVE      ZA00143 34573102
*                                       ENOUGH FOR OVERHEAD     ZA00143 34573202
         LA    RERRDISP,ERR05DSP        DISPLACEMENT FOR TRACK OVER-    34573302
*                                       RUN ERROR                       34580002
         STH   RERRDISP,WICERDSP        WILL BE USED BY END RTN         34600002
         OI    WICOFLG2,WICERROR        INDICATE AN ERROR SITUATION     34620002
*                                       HAS BEEN ENCOUNTERED            34640002
*                                                                       34660002
*              ENTERED WHEN AN ERASE IN PROCESS WHICH DOESN'T           34680002
*              CAUSE TRACK OVERRUN AS WELL AS FALL THROUGH FROM ABOVE   34700002
*                                                                       34720002
CPIWRT60 EQU   *                        *                               34740002
         ST    RCURSOR,WICDATND         SET END OF DATA                 34760002
         LR    RWORK,RCURSOR            CALCULATE THE DISPLACEMENT      34780002
         SR    RWORK,RTRKBFR            FROM BEGINNING OF TRACK AREA    34800002
         ST    RWORK,VTDATEND           SET NEW DATA END OFFSET         34820002
*                                                                       34840002
*              INDICATE THAT NO TRANSFER IS TO TAKE PLACE (DATA         34860002
*              MOVEMENT) AND TURN OFF WRITE IN PROCESS FLAG WHICH       34880002
*              IS USED FOR ZERO FILLS IN MOVE ROUTINE.                  34900002
*                                                                       34920002
CPIWRT70 EQU   *                        *                               34940002
         NI    WICOFLG2,FULLBYTE-WICWRTIP   TURN OFF WRITE BIT          34960002
         OI    WICOFLG2,WICXFCOM        INDICATE NO MOVE                34980002
*                                                                       35000002
*              THE FOLLOWING IS ENTERED BEFORE GOING TO THE MOVE        35020002
*              ROUTINE IN ORDER TO INITIALIZE THE SUM OF THE            35040002
*              BYTES AVAILABLE AND THE SUM OF THE BYTES REQUESTED.      35060002
*                                                                       35080002
CPIWRTND EQU   *                        *                               35100002
         OI    WICOFLG2,WICDATAX        INDICATE THAT OPERATION HAS     35120002
*                                       STARTED                         35140002
         ST    RXFERBAL,WICAVXFR        INIT BYTES AVAILABLE            35160002
         ST    REQBAL,WICREQXF          INIT BYTES REQUESTED            35180002
         B     CPIBASRW                 GO PERFORM MOVEMENT             35200002
*                                                                       35220002
*              THE FOLLOWING IS ENTERED FOR A WD AND WKD                35240002
*                                                                       35260002
CPIWRT80 EQU   *                        *                               35280002
*                                                                       35460002
*              SEE IF THE FILE MASK ALLOWS THE OPERATION                35480002
*                                                                       35500002
         TM    WICFMASK,WICFMW11        IF BITS 0-1 ARE BOTH ZERO       35520002
*                                       THEN WD OR WKD ALLOWED          35540002
         BZ    CPIRD                    FILE MASK OK SO GO USE THE      35560002
*                                       READ ROUTINE TO GET POSITION-   35564002
*                                       ING AND TO CHECK FOR END OF     35568002
*                                       FILE                            35572002
         TM    WICFMASK,WICFMW10        IF BITS 0-1 ARE NOT BOTH ZERO   35580002
*                                       THEN BIT 0 MUST BE ON TO ALLOW  35600002
*                                       OPERATION                       35620002
         BNZ   CPIRD                    FILE MASK OK SO GO USE THE      35640002
*                                       READ ROUTINE TO GE POSITION-    35644002
*                                       ING AND TO CHECK FOR END OF     35648002
*                                       FILE                            35652002
*                                                                       35740002
*              THE FOLLOWING IS ENTERED WHEN A WRITE FILE MASK          35744002
*              VIOLATION HAS OCCURRED.                                  35748002
CPIFMER  EQU   *                        *                               35752002
         OI    WICOFLG2,WICINTRP        NOTE ERROR OCCURRED BEFORE      35752802
*                                       DATA REQUESTED                  35752902
         LA    RERRDISP,ERR04DSP        DISPLACEMENT FOR FILE MASK      35753002
*                                       ERROR ON WRITE                  35754702
         STH   RERRDISP,WICERDSP        WILL BE USED BY THE END RTN     35755502
         B     CPIOPEND                 GO END OPERATION                35756302
*                                                                       35756602
*                                                                       35758302
*              THE FOLLOWING IS ENTERED WHEN AN INVALID SEQUENCE OF     35760002
*              OF CCW(S) IS DETECTED DURING WRITE PREREQUISIT CHECKING. 35780002
*              IF THE CHANNEL PROGRAM INTERPRETER WAS ENTERED WITH      35800002
*              A REQUEST TO WRITE DATA ON AN OVERFLOW RECORD AFTER      35820002
*              AN ENDING FOR FILE MASK VIOLATION ON THE PREVIOUS        35840002
*              TRACK THE THE APPENDAGE HANDLER IS IN A RESTART          35860002
*              SITUATION AND HAS NOT PRECEDED THE WRITE DATA            35880002
*              WITH A SEARCH ID EQUAL.  IF THIS IS THE CASE THEN        35900002
*              AN ERROR CONDITION DOES NOT EXISTS AND THE CHANNEL       35920002
*              PROGRAM MAY CONTINUE.                                    35940002
*                                                                       35960002
CPISEQER EQU   *                        *                               35980002
         TM    WICERPSW,WICERPWR        RESTART FROM ERP RESTART        36000002
         BZ    CPISEQ05                 BR - NO AND SO SEQUENCE IS      36020002
*                                       INVALID                         36040002
         NI    WICERPSW,FULLBYTE-WICERPWR  TURN OFF RESTART SWITCH      36060002
         B     CPISEQOK                 GO CONTINUE WITH CHANNEL PGM    36080002
*                                                                       36100002
CPISEQ05 EQU   *                        *                               36120002
         OI    WICOFLG2,WICINTRP        NOTE THAT ERROR OCCURED BE-     36140002
*                                       FORE DATA REQUESTED             36160002
         LA    RERRDISP,ERR02DSP        DISPLACEMENT FOR INVALID SEQ    36180002
*                                       ERROR                           36200002
         STH   RERRDISP,WICERDSP        WILL BE USED BY THE END RTN     36220002
         B     CPIOPEND                 GO END OPERATION AND CHANNEL    36240002
*                                       PROGRAM                         36260002
         TITLE 'CHANNEL PROGRAM INTERPRETER - SEEK COMMANDS'            36500002
*********************************************************************** 36520002
*                                                                     * 36540002
*        SEEK ROUTINE                                                 * 36560002
*                                                                     * 36580002
*********************************************************************** 36600002
*                                                                       36620002
*              ENTERED FOR SEEK HEAD COMMAND                            36640002
*                                                                       36660002
CPISEEKH EQU   *                        *                               36680002
         TM    WICFMASK,WICFMS11        IF BITS 3-4 ARE BOTH ONE THEN   36700002
*                                       ALL SEEKS INHIBITED             36720002
         BO    CPISEKE1                 SEEK NOT ALLOWED-GO INDICATE    36740002
*                                       ERROR OF FILE MASK VIOLATED     36760002
         SR    RWORK,RWORK              NOTE THAT THIS IS SEEK HEAD     36780002
         B     CPISEK20                 GO PROCESS REQUEST              36800002
*                                                                       36820002
*              ENTERED FOR SEEK CYLINDER                                36840002
*                                                                       36860002
CPISEEKC EQU   *                        *                               36880002
         TM    WICFMASK,WICFMS10        IF BIT FOUR OF MASK IS ZERO     36900002
*                                       THEN CYLINDER SEEK PERMITTED    36920002
         BO    CPISEKE1                 SEEK CYL NOT ALLOWEDSO GO       36940002
*                                       SET FILE MASK ERROR             36960002
         B     CPISEK10                 GO PROCESS REQUEST              36980002
*                                                                       37000002
*              ENTERED FOR SEEK COMMAND                                 37020002
*                                                                       37040002
CPISEEK  EQU   *                        *                               37060002
         TM    WICFMASK,WICFMS11        BITS 3-4 OF FILE MASK MUST BE   37080002
*                                       ZERO TO ALLOW FULL SEEK         37100002
         BNZ   CPISEKE1                 SEEK NOT ALLOWED SO GO SET      37120002
*                                       FILE MASK ERROR                 37140002
*                                                                       37160002
*              BRANCHED TO ONLY FOR SEEK CYLINDER AND SEEK              37180002
*                                                                       37200002
CPISEK10 EQU   *                        *                               37220002
         LA    RWORK,L'DASDCC           NOTE THIS IS SEEK/SEEK CYL      37240002
*                                                                       37260002
CPISEK20 EQU   *                        *                               37280002
         OI    WICOFLG2,WICDATAX        NOTE THAT OPERATION STARTED     37300002
         LA    RXFERBAL,L'DASDARG       INDICATE THAT SIX BYTES MUST    37320002
*                                       BE USED FOR THIS OPERATION      37340002
         CR    REQBAL,RXFERBAL          COMPARE REQUESTED LENGTH WITH   37360002
*                                       THE NECESSARY SIX BYTE LENGTH   37380002
         BL    CPISEKE2                 SEEK ARGUMENT IS LESS THAN SIX  37400002
*                                       SO GO SET SEEK CHECK ERROR      37420002
*                                                                       37440002
*              VALIDATE THE SEEK ADDRESS ARGUMENT                       37460002
*                                                                       37480002
         USING DASDADDR,RBFRDATA        DESCRIBE ARGUMENT               37500002
XPGCK06  ICM   RWORK1,HWMASK,DASDBB     INSERT BIN NUMBER FROM ARGUMENT 37520002
*                                       OF ARGUMENT TO TEST FOR ZERO    37540002
         BNZ   CPISEKE2                 NOT ZERO SO GO SET A SEEK       37560002
*                                       CHECK ERROR                     37580002
XPGCK07  CLC   DASDCC,WICMAXCC          IS THIS A VALID CYLINDER        37600002
         BNL   CPISEKE2                 NO-GO SET SEEK CHECK ERROR      37620002
XPGCK08  CLC   DASDHH,WICMAXHH          IS THIS A VALID HEAD NUMBER     37640002
         BNL   CPISEKE2                 NO-GO SET SEEK CHECK ERROR      37660002
*                                                                       37680002
*                                       IS THE DESIRED TRACK THE SAME   37700002
*                                       AS THE CURRENT                  37720002
         CLC   DASDARG(L'DASDARG),WICSEEKA+L'WICSKAM                    37740002
         BE    CPISEKND                 YES-GO PREPARE TO END OPERATION 37760002
*                                                                       37780002
*              MUST REQUEST A NEW TRACK AND WILL USE THE NEXT TRACK     37800002
*              ROUTINE TO SET UP FOR A RETURN TO THE TRACK MANAGER      37820002
*              WITH A REQUEST FOR A NEW TRACK.  A RETURN WILL INDICATE  37840002
*              THAT THE DESIRED TRACK IS READY.                         37860002
*                                                                       37880002
         OI    WICRESTA,WICSEKRS        NOTIFY 'NEXT TRACK ROUTINE'     37900002
*                                       THAT CALLER IS THE SEEK RTN     37920002
         MVC   WICSKAHH,DASDHH          UPDATE SEEK ADDRESS HEAD        37940002
         LTR   RWORK,RWORK              WAS ENTRY FROM A SEEK HEAD      37960002
         BZ    CPISEK30                 YES-BYPASS SETTING OF CYLINDER  37980002
         MVC   WICSKACC,DASDCC          UPDATE CYLINDER VALUE           38000002
*                                                                       38020002
CPISEK30 EQU   *                        *                               38040002
         BAL   RLINK2,CPINXTRK          GO REQUEST A NEW TRACK          38060002
*                                                                       38080002
*              RETURNED TO WHEN NEW TRACK IS READY                      38100002
*                                                                       38120002
         NI    WICRESTA,FULLBYTE-WICSEKRS  CLEAR SEEK RESTART FLAG      38140002
*                                                                       38160002
*              PREPARE TO END OPERATION                                 38180002
*                                                                       38200002
CPISEKND EQU   *                        *                               38220002
         ST    REQBAL,WICREQXF          SET NUMBER OF BYTES IN          38240002
*                                       SEEK ARGUMENT FOR END ROUTINE   38260002
         ST    RXFERBAL,WICAVXFR        SET NUMBER OF BYTES AVAILABLE   38280002
*                                       FOR THIS OPERATION              38300002
         B     CPIOPEND                 GO END OPERATION                38320002
*                                                                       38340002
*                                                                       38360002
*              ENTERED WHEN THE FILE MASK DOES NOT ALLOW THE SEEK       38380002
*              WHICH HAS BEEN REQUESTED.                                38400002
*                                                                       38420002
CPISEKE1 EQU   *                        *                               38440002
*                                                                       38460002
*                                       UPDATE THE SEEK ADDRESS         38480002
XPGCK09  MVC   WICSKACC(L'WICSKACC+L'WICSKAHH),DASDCC MOVE CCHH         38500002
         OI    WICOFLG2,WICINTRP        INDICATE ERROR OCCURRED BEFORE  38520002
*                                       ARGUMENT WAS REQUESTED          38540002
         LA    RERRDISP,ERR07DSP        DISPLACEMENT FOR FILE MASK      38560002
*                                       VIOLATION ON SEEK               38580002
         STH   RERRDISP,WICERDSP        WILL BE USED BY END RTN         38600002
         B     CPIOPEND                 GO END OPERATION AND END        38620002
*                                       CHANNEL PROGRAM                 38640002
*                                                                       38660002
*                                                                       38680002
*              ENTERED FOR ERROR CONDITIONS WHICH OCCUR AFTER THE       38700002
*              THE FILE MASK HAS BEEN CHECKED.                          38720002
*                                                                       38740002
CPISEKE2 EQU   *                        *                               38760002
         ST    REQBAL,WICREQXF          SET NUMBER OF BYTES OF THE      38780002
*                                       SEARCH ARGUMENT                 38800002
         ST    RXFERBAL,WICAVXFR        SET BYTES AVAILABLE             38820002
         OI    WICOFLG2,WICERROR        INDICATE AN ERROR HAS OCCURRED  38840002
         LA    RERRDISP,ERR03DSP        DISPLACEMENT FOR INVALID SEEK   38860002
*                                       ARGUMENT OR SEEK CHECK ERROR    38880002
         STH   RERRDISP,WICERDSP        WILL BE USED BY THE END RTN     38900002
         B     CPIOPEND                 GO END OPERATION AND TERMINATE  38920002
*                                       CHANNEL PROGRAM                 38940002
         DROP  RBFRDATA                 DISCONTINUE DESCRIPTION OF      38960002
*                                       ARGUMENT                        38980002
         TITLE 'CHANNEL PROGRAM INTERPRETER - SEARCH HOME ADDRESS'      39000002
*********************************************************************** 39020002
*                                                                     * 39040002
*        SEARCH HOME ADDRESS ROUTINE                                  * 39060002
*                                                                     * 39080002
*********************************************************************** 39100002
*                                                                       39120002
CPISHA   EQU   *                        *                               39140002
         TM    CCWFLAGS,CCWCC           COMMAND CHAINING SPECIFIED      39160002
         BZ    CPISHA10                 NO - SKIP SHA-TIC TEST          39180002
*                                                                       39200002
*              SEE IF THIS IS A SHA TIC *-8 COMBINATION                 39220002
*                                                                       39240002
         LA    RWORK,L'CCW(RCCW)        POINT TO NEXT CCW               39260002
         DROP  RCCW                     DISCONTINUE CURRENT DESCRIPTION 39280002
         USING CCWDES,RWORK             DESCRIBE NEXT CCW               39300002
         TM    CCWOPCDE,LOW3BITS        LOW 3 ZERO ONLY FOR TIC         39320002
         BC    7,CPISHA10               BR - NOT A TIC SINCE NON ZERO   39340002
         TM    CCWOPCDE,CCWTICBT        SECOND PART OF TIC TEST         39360002
         BZ    CPISHA10                 BR - NOT A TIC SO CONTINUE      39380002
*                                                                       39400002
*              SEE IF TIC IS A TIC TO PREVIOUS CCW                      39420002
*                                                                       39440002
         L     RWORK,CCWDATAD           GET ADDRESS FIELD OF CCW        39460002
         DROP  RWORK                    DISCONTINUE DESCRIPTION OF      39480002
*                                       NON-CURRENT CCW                 39500002
         USING CCWDES,RCCW              CCW ADDRESSABILITY              39520002
         LA    RWORK,ADDRONLY(RWORK)    CLEAR OP CODE OFF               39540002
         CR    RCCW,RWORK               ARE ADDRESSES SAME              39560002
         BNE   CPISHA10                 BR - NOT A TIC *-8              39580002
         OI    WICOFLG1,WICSCHTC        INDICATE A SEARCH TIC COMBIN-   39600002
*                                       ATION                           39620002
CPISHA10 EQU   *                        *                               39640002
         LA    RCURSOR,VTHACCHH         SET CURSOR TO ADDR PORTION      39660002
*                                       OF HOME ADDRESS                 39680002
         LA    RWORK,WICBFR0            INDICATE OPERATION WILL LEAVE   39690002
         STH   RWORK,WICRELTP           BERFORE R0                      39720002
         LA    RXFERBAL,L'VTHACCHH      AVAILABLE BYTES IS 4            39740002
*                                                                       39760002
*              GO DETERMINE NUMBER OF BYTES TO USE.  THIS WILL BE       39780002
*              SMALLER OF THAT REQUESTED OR THAT WHICH IS AVAILABE.     39800002
*                                                                       39820002
         BAL   RLINK,CPIXMITL           SEE COMMENT ABOVE               39840002
         BCTR  RCXFER,R0                FOR EXECUTING COMPARE           39860002
         CR    REQBAL,RXFERBAL          REQUESTED SEARCH FOUR BYTES     39880002
         BNE   CPISHA50                 BR - TO TEST THE SILI BIT       39900002
*                                       AND TURN OFF SID-TIC FLAG IF    39920002
*                                       SILI IS NOT ON                  39940002
CPISHALP EQU   *                        *                               39960002
         TM    CCWOPCDE,CCWMLTRK        IS THIS A MULTITRACK OP CODE    39980002
         BO    CPISHA20                 YES GO REQUEST NEXT TRACK       40000002
         TM    WICXOFLG,WICNDXPT        FOR SINGLE TRACK HAS INDEX      40020002
*                                       POINT BEEN PASSED               40040002
         BO    CPISHAER                 YES GO SET NO RECOURD FOUND     40060002
         OI    WICXOFLG,WICNDXPT        SET INDEX POINT PASSED          40080002
         B     CPISHA30                 GO PERFORM COMPARE              40100002
*                                                                       40120002
*              FOR MULTITRACK REQUEST THE NEXT TRACK                    40140002
*                                                                       40160002
CPISHA20 EQU   *                        *                               40180002
         BAL   RLINK2,CPINXTRK          REQUEST NEXT TRACK              40200002
CPISHA30 EQU   *                        *                               40220002
XPGCK10  EX    RCXFER,EXCOMPAR          DO THE ARGUMENTS COMPARE        40240002
         BNE   CPISHA40                 NO-GO SEE IF CONTINUATION       40260002
*                                       IS REQUESTED                    40280002
*                                                                       40300002
*              SEARCH HAS BEEN SATISFIED                                40320002
*                                                                       40340002
         OI    IOBCSWS0,IOBCSWSM        SET STATUS MODIFIER             40360002
*                                                                       40380002
*              PREPARE TO END OPERATION                                 40400002
*                                                                       40420002
CPISHAND EQU   *                        *                               40440002
         ST    REQBAL,WICREQXF          SET BYTES REQUESTED             40460002
         ST    RXFERBAL,WICAVXFR        SET BYTES AVAILABLE             40480002
         B     CPIOPEND                 GO END OPERATION                40500002
*                                                                       40520002
*                                                                       40540002
*              SEARCH WAS NOT SATISFIED                                 40560002
*                                                                       40580002
CPISHA40 EQU   *                        *                               40600002
         TM    WICOFLG1,WICSCHTC        WAS THIS A SEARCH TIC           40620002
         BZ    CPISHAND                 NO-GO PREPARE TO END OPERATION  40640002
         B     CPISHALP                 GO SEE IF MULTITRACKING WAS     40660002
*                                       SPECIFIED                       40680002
*                                                                       40700002
*              ENTERED WHEN THE SEARCH IS NOT FOUR BYTES                40720002
*                                                                       40740002
CPISHA50 EQU   *                        *                               40760002
         TM    CCWFLAGS,CCWSILI         SUPPRESS INCORRECT LENGTH       40780002
         BO    CPISHALP                 YES - BEGIN COMPARE             40800002
         NI    WICOFLG1,FULLBYTE-WICSCHTC  PERFORM ONLY ONE COMPARE     40820002
         B     CPISHALP                 GO SEARCH ONCE                  40840002
*                                                                       40860002
*                                                                       40880002
CPISHAER EQU   *                        *                               40900002
         ST    REQBAL,WICREQXF          THE AMOUNT REQUESTED FOR        40920002
*                                       THIS OPERATION - THE AMOUNT     40940002
*                                       AVAILABLE WAS INITIALLY SET TO  40960002
*                                       ZERO AND WILL BE SENT TO END    40980002
*                                       ROUTINE AS ZERO                 41000002
         LA    RERRDISP,ERR06DSP        DISPLACEMENT FOR NO RECORD      41020002
*                                       FOUND ERROR                     41040002
         STH   RERRDISP,WICERDSP        WILL BE USED BY END RTN         41060002
         OI    WICOFLG2,WICERROR        INDICATE AN ERROR CONDITION     41080002
         B     CPIOPEND                 GO END THIS OPERATION           41100002
*                                                                       41120002
         TITLE 'CHANNEL PROGRAM INTERPRETER - SEARCH ID COMMANDS'       41140002
*********************************************************************** 41160002
*                                                                     * 41180002
*        SEARCH ID ROUTINE                                            * 41200002
*                                                                     * 41220002
*********************************************************************** 41240002
*                                                                       41260002
*                                                                       41280002
CPISID   EQU   *                        *                               41300002
         OI    WICOFLG1,WICSID          INDICATE THIS IS A SEARCH ID    41320002
         BAL   RLINK,CPIPOS             GET INITIAL POSITIONING         41340002
         TM    CCWFLAGS,CCWCC           COMMAND CHAINING SPECIFIED      41360002
         BZ    CPISID10                 NO - SKIP SID-TIC TEST          41380002
*                                                                       41400002
*              SEE IF THIS IS A SID TIC *-8 COMBINATION                 41420002
*                                                                       41440002
         LA    RWORK,L'CCW(RCCW)        POINT TO NEXT CCW               41460002
         DROP  RCCW                     DISCONTINUE CURRENT DESCRIPTION 41480002
         USING CCWDES,RWORK             DESCRIBE NEXT CCW               41500002
         TM    CCWOPCDE,LOW3BITS        LOW 3 ZERO ONLY FOR TIC         41520002
         BC    7,CPISID10               BR - NOT A TIC SINCE NON ZERO   41540002
         TM    CCWOPCDE,CCWTICBT        SECOND PART OF TIC TEST         41560002
         BZ    CPISID10                 BR - NOT A TIC SO CONTINUE      41580002
*                                                                       41600002
*              SEE IF TIC IS A TIC TO PREVIOUS CCW                      41620002
*                                                                       41640002
         L     RWORK,CCWDATAD           GET ADDRESS FIELD OF CCW        41660002
         LA    RWORK,ADDRONLY(RWORK)    CLEAR OP CODE OFF               41680002
         CR    RCCW,RWORK               ARE ADDRESSES SAME              41700002
         BNE   CPISID10                 BR - NOT A TIC *-8              41720002
         OI    WICOFLG1,WICSCHTC        INDICATE SID TIC *-8            41740002
         DROP  RWORK                    RESUME THIS CCW                 41760002
         USING CCWDES,RCCW              CCW ADDRESSABILITY              41780002
*                                                                       41800002
CPISID10 EQU   *                        *                               41820002
*              GO DETERMINE IF SEARCH IS EQ, HI, HI OR EQ.  A FLAG      41840002
*              WILL BE SET IF IT IS A SEARCH EQUAL ONLY. IN ADDITION    41860002
*              THE APPROPRIATE BRANCH CONDITION CODE WILL BE RETURNED   41880002
*              IN REGISTER RWORK.                                       41900002
*                                                                       41920002
         BAL   RLINK,CPITYPE            SEE COMMENT ABOVE               41940002
         LA    RXFERBAL,L'CNTID         AVAILABLE BYTES IS 5            41960002
*                                                                       41980002
*              GO DETERMINE NUMBER OF BYTES TO USE.  THIS WILL BE       42000002
*              SMALLER OF THAT REQUESTED OR THAT WHICH IS AVAILABE.     42020002
*                                                                       42040002
         BAL   RLINK,CPIXMITL           SEE COMMENT ABOVE               42060002
         BCTR  RCXFER,R0                FOR EXECUTING COMPARE           42080002
         CR    REQBAL,RXFERBAL          REQUESTED SEARCH FIVE BYTES     42100002
         BNE   CPISID30                 BR - TO TEST THE SILI BIT       42120002
*                                       AND TURN OFF SCH-TIC FLAG IF    42140002
*                                       SILI IS NOT ON                  42160002
CPISIDLP EQU   *                        *                               42180002
XPGCK11  EX    RCXFER,EXCOMPAR          THIS THE ID SOUGHT              42200002
         EX    RWORK,EXBRSID            BRANCH CONDITION SET BY         42220002
*                                       CPITYPE                         42240002
*              BRANCH TO CPISIDOK WHEN SEARCH HAS BEEN SATISFIED        42260002
*                                                                       42280002
         TM    WICOFLG1,WICSCHTC        REPETITIVE SEARCH               42300002
         BZ    CPISIDND                 NO - END SEARCH                 42320002
*                                                                       42340002
*              ADVANCE TO NEXT RECORD                                   42360002
*                                                                       42380002
         LA    RCURSOR,L'CNTFIELD(RCURSOR) LENGTH OF COUNT FIELD        42400002
         AH    RCURSOR,WICKL            CURRENT KEY LENGTH              42420002
         A     RCURSOR,WICDL            CURRENT DATA LENGTH             42440002
         C     RCURSOR,WICDATND         IS THIS THE END OF TRACK        42460002
         BNL   CPISID40                 YES - GO CHECK MULTITRACK       42480002
CPISID20 EQU   *                        *                               42500002
         ST    RCURSOR,WICCAM           SAVE CURRENT RECORD ADDRESS     42520002
         USING COUNTDES,RCURSOR         DESCRIBE CURRENT COUNT FIELD    42540002
         MVC   WICKL+L'WICKL-L'CNTKL(L'CNTKL),CNTKL                     42560002
*                                       SAVE CURRENT KEY LENGTH         42580002
         MVC   WICDL+L'WICDL-L'CNTDL(L'CNTDL),CNTDL                     42600002
*                                       SAVE CURRENT DATA LENGTH        42620002
         B     CPISIDLP                 GO CONTINUE SEARCH              42640002
         DROP  RCURSOR                  DISCONTINUE DESCRIPTION         42660002
*                                                                       42680002
*                                                                       42700002
*              ENTERED WHEN A SEARCH IS NOT A FIVE BYTE SEARCH          42720002
*                                                                       42740002
CPISID30 EQU   *                        *                               42760002
         TM    CCWFLAGS,CCWSILI         SUPPRESS INCORRECT LENGTH       42780002
         BO    CPISIDLP                 YES - BEGIN SEARCH              42800002
         NI    WICOFLG1,FULLBYTE-WICSCHTC  NO - DON'T PERFORM A         42820002
*                                       REPETITIVE SEARCH               42840002
         B     CPISIDLP                 GO SEARCH ONCE                  42860002
*                                                                       42880002
*              ENTERED WHEN THE END OF TRACK HAS BEEN REACHED           42900002
*                                                                       42920002
CPISID40 EQU   *                        *                               42940002
         TM    CCWOPCDE,CCWMLTRK        IS THIS MULTITRACK OP CODE      42960002
         BO    CPISID50                 YES - GO SET UP FOR A           42980002
*                                       REQUEST FOR A NEW TRACK         43000002
         TM    WICXOFLG,WICNDXPT        INDEX POINT PASSED              43020002
         BO    CPISIDER                 BR - NON MULTITRACK AND         43040002
*                                       INDEX PASSED                    43060002
*                                                                       43080002
*              START SEARCHING THIS TRACK FROM THE BEGINNING OF THE     43100002
*              TRACK.                                                   43120002
*                                                                       43140002
         OI    WICXOFLG,WICNDXPT        SET INDEX POINT PASSED          43160002
         LA    RCURSOR,VTR0             START SEARCH AT R0              43180002
         B     CPISID20                 BRANCH TO UPDATE CURRENT        43200002
*                                       RECORD ADDR, KEY LENGTH,        43220002
*                                       AND DATA LENGTH BEFORE          43240002
*                                       CONTINUING SEARCH               43260002
*                                                                       43280002
*              ENTERED WHEN MULTITRACKING HAS BEEN SPECIFIED AND        43300002
*              A NEW TRACK MUST BE REQUESTED.                           43320002
CPISID50 EQU   *                        *                               43340002
         BAL   RLINK2,CPINXTRK          GO SET UP FOR REQUEST           43360002
         LA    RCURSOR,VTR0             RETURN MEANS THAT REQUEST WAS   43380002
*                                       SATISFIED AND THERFORE START    43400002
*                                       AT RECORD ZERO OF NEW TRACK     43420002
         LA    RWORK1,WICBFKEY          THE RELATIVE POSTION            43440002
*                                       AFTER THE SID WILL BE BEFORE    43460002
         STH   RWORK1,WICRELTP          THE KEY AREA                    43480002
         B     CPISID20                 GO UPDATE CURRENT RECORD ADDR   43500002
*                                       AND CURRENT KEY AND DATA        43520002
*                                       LENGTHS                         43540002
*                                                                       43560002
*              ENTERED WHEN THE SEARCH HAS BEEN SATISFIED               43580002
*                                                                       43600002
CPISIDOK EQU   *                        *                               43620002
         OI    IOBCSWS0,IOBCSWSM        SET STATUS MODIFIER             43640002
*                                                                       43660002
*              DETERMINE IF THIS OPERATION QUALIFIES FOR A WRITE        43680002
*              PREREQUISITE.                                            43700002
*                                                                       43720002
         TM    WICOFLG2,WICSCHEQ        WAS THIS A SEARCH EQ            43740002
         BZ    CPISIDND                 NO - DOESN'T QUALIFY            43760002
         CR    REQBAL,RXFERBAL          AMOUNT SEARCHED EQUAL TO        43780002
*                                       THAT AVAILABLE (5 BYTES)        43800002
         BL    CPISIDND                 NO - DOESN'T QUALIFY            43820002
         OI    WICSEQFG,WICFSIDE        INDICATE THAT A FULL SID        43840002
*                                       EQUAL HAS BEEN PERFORMED        43860002
*                                                                       43880002
*              ENTERED AT NORMAL END OF SEARCH ID                       43900002
*                                                                       43920002
CPISIDND EQU   *                        *                               43940002
*                                                                       43960002
*              SET UP INPUT FOR OPERATION END.  THIS INCLUDES THE       43980002
*              AMOUNT REQUESTED AND THE AMOUNT AVAILABLE TO             44000002
*              BE USED FOR INCORRECT LENGTH CHECKING.                   44020002
*                                                                       44040002
         ST    REQBAL,WICREQXF          AMOUNT REQUESTED                44060002
         ST    RXFERBAL,WICAVXFR        AMOUNT AVAILABLE                44080002
         B     CPIOPEND                 COMPLETE THIS OPERATION         44100002
*                                                                       44120002
*              ENTERED WHEN SEARCH WAS A REPETITIVE SEARCH (SID-TIC)    44140002
*              AND RECORD HAS NOT BEEN FOUND AND SEARCH WAS NOT         44160002
*              MULTITRACK                                               44180002
*                                                                       44200002
CPISIDER EQU   *                        *                               44220002
         ST    REQBAL,WICREQXF          THE AMOUNT REQUESTED FOR        44240002
*                                       THIS OPERATION - THE AMOUNT     44260002
*                                       AVAILABLE WAS INITIALLY SET TO  44280002
*                                       ZERO AND WILL BE SENT TO END    44300002
*                                       ROUTINE AS ZERO                 44320002
         OI    WICOFLG2,WICERROR        INDICATE AN ERROR CONDITION     44340002
         LA    RERRDISP,ERR06DSP        DISPLACEMENT FOR NO RECORD      44360002
*                                       FOUND ERROR                     44380002
         STH   RERRDISP,WICERDSP        WILL BE USED BY THE END RTN     44400002
         B     CPIOPEND                 GO END THIS OPERATION           44420002
         TITLE 'CHANNEL PROGRAM INTERPRETER - SEARCH CONDITION ROUTINE' 44440002
*********************************************************************** 44460002
*                                                                     * 44480002
*        SEARCH TYPE ROUTINE                                          * 44500002
*                                                                     * 44520002
*        THE FOLLOWING ROUTINE IS ENTERED BY SEARCH ROUTINES FOR      * 44540002
*        THE PURPOSE OF ESTABLISHING A BRANCH CONDITION CODE.  THIS   * 44560002
*        IS ACCOMPLISHED BY EXAMINING THE OP CODE AND COMPOSING AN    * 44580002
*        APPROPRIATE CONDITION CODE.  THE CONDITION CODE WHICH        * 44600002
*        IS ESTABLISHED IS THEN USED IN AN EXECUTED-BRANCH AFTER      * 44620002
*        THE COMPARE HAS BEEN PERFORMED.                              * 44640002
*                                                                     * 44660002
*        IN ADDITION THIS ROUTINE WILL SET A FLAG IF THE SEARCH IS    * 44680002
*        AN EQUAL ONLY SEARCH WHICH IS USED IN CONJUNCTION WITH A     * 44700002
*        FULL SEARCH TO INDICATE THAT A WRITE PREREQUISITE HAS BEEN   * 44720002
*        MET.                                                         * 44740002
*                                                                     * 44760002
*        OUTPUT - REG RWORK CONTAINS THE CONDITION CODE REQUIRED      * 44780002
*                 FOR A SATISFACTORY SEARCH                           * 44800002
*                                                                     * 44820002
*                 FLAG SET IF SEARCH EQUAL ONLY                       * 44840002
*                                                                     * 44860002
*********************************************************************** 44880002
*                                                                       44900002
*                                                                       44920002
CPITYPE  EQU   *                        *                               44940002
         SR    RWORK,RWORK              CLEAR OUPUT REG                 44960002
         OI    WICOFLG2,WICSCHEQ        ASSUME AN EQUAL ONLY SEARCH     44980002
         TM    CCWOPCDE,CCWHICON        SEARCH HIGH CONDITION           45000002
         BZ    CPITYPE2                 BR - HIGH NOT SPECIFIED         45020002
         LA    RWORK,HIBRCON(RWORK)     INCREASE CONDITION BY X'20'     45040002
         NI    WICOFLG2,FULLBYTE-WICSCHEQ  TURN OFF EQUAL ONLY FLAG     45060002
CPITYPE2 EQU   *                        *                               45080002
         TM    CCWOPCDE,CCWEQCON        EQUAL CONDITION SPECIFIED       45100002
         BCR   8,RLINK                  NO - RETURN                     45120002
         LA    RWORK,EQBRCON(RWORK)     INCREASE CONDITION BY X'80'     45140002
         BR    RLINK                    RETURN                          45160002
         TITLE 'CHANNEL PROGRAM INTERPRETER - SEARCH KEY COMMANDS'      45180002
*********************************************************************** 45200002
*                                                                     * 45220002
*        SEARCH KEY ROUTINE                                           * 45240002
*                                                                     * 45260002
*********************************************************************** 45280002
*                                                                       45300002
*                                                                       45320002
CPISKEY  EQU   *                        *                               45340002
         BAL   RLINK,CPIPOS             GET INITIAL POSITIONING         45360002
         TM    WICXOFLG,WICRCSKT        WAS A READ COUNT SEARCH KEY     45380002
*                                       TIC COMBINATION ENCOUTERED      45400002
*                                       DURING THE READ COUNT PRO-      45420002
*                                       CESSING                         45440002
         BO    CPIKEY10                 YES-GO INDICATE A REPETITIVE    45460002
*                                       SEARCH SITUATION                45480002
*                                                                       45500002
*              SEE IF THIS IS A SEARCH KEY TIC *-8 COMBINATION          45520002
*                                                                       45540002
         TM    CCWFLAGS,CCWCC           COMMAND CHAINING SPECIFIED      45560002
         BZ    CPIKEY20                 NO - SKIP SEARCH KEY-TIC TEST   45580002
         LA    RWORK,L'CCW(RCCW)        POINT TO NEXT CCW               45600002
         DROP  RCCW                     DISCONTINUE CURRENT DESCRIPTION 45620002
         USING CCWDES,RWORK             DESCRIBE NEXT CCW               45640002
         TM    CCWOPCDE,LOW3BITS        LOW 3 ZERO ONLY FOR TIC         45660002
         BC    7,CPIKEY20               BR - NOT A TIC SINCE NON ZERO   45680002
         TM    CCWOPCDE,CCWTICBT        SECOND PART OF TIC TEST         45700002
         BZ    CPIKEY20                 BR - NOT A TIC SO CONTINUE      45720002
*                                                                       45740002
*              SEE IF TIC IS A TIC TO PREVIOUS CCW                      45760002
*                                                                       45780002
         L     RWORK,CCWDATAD           GET ADDRESS FIELD OF CCW        45800002
         LA    RWORK,ADDRONLY(RWORK)    CLEAR OP CODE OFF               45820002
         CR    RCCW,RWORK               ARE ADDRESSES SAME              45840002
         BNE   CPIKEY20                 BR - NOT A TIC *-8              45860002
         DROP  RWORK                    RESUME THIS CCW DESCRIPTION     45880002
         USING CCWDES,RCCW              CCW ADDRESSABILITY              45900002
CPIKEY10 EQU   *                        *                               45920002
         OI    WICOFLG1,WICSCHTC        INDICATE REPETITIVE SEARCH      45940002
*                                                                       45960002
CPIKEY20 EQU   *                        *                               45980002
*              GO DETERMINE IF SEARCH IS EQ, HI, HI OR EQ.  A FLAG      46000002
*              WILL BE SET IF IT IS A SEARCH EQUAL ONLY. IN ADDITION    46020002
*              THE APPROPRIATE BRANCH CONDITION CODE WILL BE RETURNED   46040002
*              IN REGISTER RWORK.                                       46060002
*                                                                       46080002
         BAL   RLINK,CPITYPE            SEE COMMENT ABOVE               46100002
*                                                                       46120002
*              BEGINNING OF SEARCH LOOP                                 46140002
*                                                                       46160002
CPIKEYLP EQU   *                        *                               46180002
         LTR   RXFERBAL,RXFERBAL        CONTAINS CURRENT KEY LENDTH     46200002
         BZ    CPIKEY40                 IF ZERO GO CHECK FOR SILI       46220002
*                                       BIT ON IN FLAGS                 46240002
         CR    REQBAL,RXFERBAL          IS THE SEARCH ARGUMENT LENGTH   46260002
*                                       EQUAL TO KEY LENGTH             46280002
         BNE   CPIKEY50                 NO- GO TEST FOR SILI BIT        46300002
*                                       ON IN CCW FLAGS                 46320002
*                                                                       46340002
*              GO DETERMINE NUMBER OF BYTES TO USE.  THIS WILL BE       46360002
*              SMALLER OF THAT REQUESTED OR THAT WHICH IS AVAILABE.     46380002
*                                                                       46400002
CPIKEY23 EQU   *                        *                               46420002
         BAL   RLINK,CPIXMITL           SEE COMMENT ABOVE               46440002
         BCTR  RCXFER,R0                FOR EXECUTING COMPARE           46460002
XPGCK12  EX    RCXFER,EXCOMPAR          THIS THE ID SOUGHT              46480002
         EX    RWORK,EXBRKEY            BRANCH CONDITION SET BY         46500002
*                                       CPITYPE                         46520002
*              BRANCH TO CPIKEYOK WHEN SEARCH HAS BEEN SATISFIED.       46540002
*              OTHERWISE, CHECK TO SEE IF SEARCH IS TO CONTINUE.        46560002
*                                                                       46580002
CPIKEY25 EQU   *                        *                               46600002
         TM    WICOFLG1,WICSCHTC        REPETITIVE SEARCH               46620002
         BZ    CPIKEYND                 NO - END SEARCH                 46640002
*                                                                       46660002
*              ADVANCE TO NEXT RECORD                                   46680002
*                                                                       46700002
         AH    RCURSOR,WICKL            CURRENT KEY LENGTH              46720002
         A     RCURSOR,WICDL            CURRENT DATA LENGTH             46740002
         C     RCURSOR,WICDATND         IS THIS THE END OF TRACK        46760002
         BNL   CPIKEY60                 YES - GO CHECK MULTITRACK       46780002
CPIKEY30 EQU   *                        *                               46800002
         ST    RCURSOR,WICCAM           SAVE CURRENT RECORD ADDRESS     46820002
         USING COUNTDES,RCURSOR         DESCRIBE CURRENT COUNT FIELD    46840002
         MVC   WICKL+L'WICKL-L'CNTKL(L'CNTKL),CNTKL                     46860002
*                                       SAVE CURRENT KEY LENGTH         46880002
         MVC   WICDL+L'WICDL-L'CNTDL(L'CNTDL),CNTDL                     46900002
*                                       SAVE CURRENT DATA LENGTH        46920002
         LA    RCURSOR,L'CNTFIELD(RCURSOR)  BUMP OVER COUNT FIELD       46940002
         LH    RXFERBAL,WICKL           GET CURRENT BYTES AVAILABLE     46960002
         B     CPIKEYLP                 GO CONTINUE SEARCH              46980002
         DROP  RCURSOR                  DISCONTINUE DESCRIPTION         47000002
*                                                                       47020002
*                                                                       47040002
*              ENTERED WHEN THE CURRENT KEY LENGTH IS ZERO AND          47060002
*              IF SILI IS NOT ON IN CCW FLAGS THEN OPERATION MUST       47080002
*              BE TERMINATED.  IF ON, NO COMPARISON IS MADE BUT         47100002
*              SEARCH WILL CONTINUE.                                    47120002
*                                                                       47140002
CPIKEY40 EQU   *                        *                               47160002
         TM    CCWFLAGS,CCWSILI         IS SILI ON IN FLAGS             47180002
         BO    CPIKEY25                 YES-GO CONTINUE SEARCH AT       47200002
*                                       NEXT RECORD                     47220002
         B     CPIKEYND                 IF NOT PREPARE TO END OPERATION 47240002
*                                                                       47260002
*                                                                       47280002
*              ENTERED WHEN THE SEARCH ARGUMENT LENGTH IS NO THE        47300002
*              SAME AS THE KEY LENGTH.                                  47320002
*                                                                       47340002
CPIKEY50 EQU   *                        *                               47360002
         TM    CCWFLAGS,CCWSILI         SUPPRESS INCORRECT LENGTH       47380002
         BO    CPIKEY23                 YES - BEGIN SEARCH              47400002
         NI    WICOFLG1,FULLBYTE-WICSCHTC  NO - DON'T PERFORM A         47420002
*                                       REPETITIVE SEARCH               47440002
         B     CPIKEY23                 GO SEARCH ONCE                  47460002
*                                                                       47480002
*              ENTERED WHEN THE END OF TRACK HAS BEEN REACHED           47500002
*                                                                       47520002
CPIKEY60 EQU   *                        *                               47540002
         TM    WICXOFLG,WICRCSKT        IF THIS IS A READ COUNT SEARCH  47560002
*                                       KEY TIC COMBINATION THE BYPASS  47580002
*                                       MULTITRACK TEST AS THE COMBIN-  47600002
*                                       ATION IS CONFINED TO SINGLE     47620002
*                                       TRACK OPERATIONS                47640002
         BO    CPIKEY70                 YES-GO CHECK TO SEE IF INDEX    47660002
*                                       POINT HAS BEEN PASSED           47680002
         TM    CCWOPCDE,CCWMLTRK        IS THIS MULTITRACK OP CODE      47700002
         BO    CPIKEY80                 YES - GO SET UP FOR A           47720002
*                                       REQUEST FOR A NEW TRACK         47740002
CPIKEY70 EQU   *                        ROC-SRCK-TIC                    47760002
         TM    WICXOFLG,WICNDXPT        INDEX POINT PASSED              47780002
         BO    CPIKEYER                 BR - NON MULTITRACK AND         47800002
*                                       INDEX PASSED                    47820002
*                                                                       47840002
*              START SEARCHING THIS TRACK FROM THE BEGINNING OF THE     47860002
*              TRACK.                                                   47880002
*                                                                       47900002
         OI    WICXOFLG,WICNDXPT        SET INDEX POINT PASSED          47920002
         LA    RCURSOR,VTR1             START SEARCH AT RECORD ONE      47940002
         B     CPIKEY30                 BRANCH TO UPDATE CURRENT        47960002
*                                       RECORD ADDR, KEY LENGTH,        47980002
*                                       AND DATA LENGTH BEFORE          48000002
*                                       CONTINUING SEARCH               48020002
*                                                                       48040002
*                                                                       48060002
*              ENTERED WHEN MULTITRACKING HAS BEEN SPECIFIED AND        48080002
*              A NEW TRACK MUST BE REQUESTED.                           48100002
*                                                                       48120002
CPIKEY80 EQU   *                        *                               48140002
         BAL   RLINK2,CPINXTRK          GO SET UP FOR REQUEST           48160002
         LA    RCURSOR,VTR1             RETURN MEANS THAT REQUEST WAS   48180002
*                                       SATISFIED AND THERFORE START    48200002
*                                       AT RECORD ONE OF NEW TRACK      48220002
         C     RCURSOR,WICDATND         DOES RECORD ONE EXISTS          48240002
         BNL   CPIKEY80                 NO-GO REQUEST NEXT TRACK        48260002
*                                                                       48280002
*              RECORD ONE DOES EXIST ON NEW TRACK                       48300002
*                                                                       48320002
         LA    RWORK1,WICBFDAT          THE RELATIVE POSITION AFTER     48340002
*                                       THE SEARCH KEY WILL BE          48360002
         STH   RWORK1,WICRELTP          BEFORE THE KEY AREA             48380002
         B     CPIKEY30                 GO UPDATE CURRENT RECORD ADDR   48400002
*                                       AND CURRENT KEY AND DATA        48420002
*                                       LENGTHS                         48440002
*                                                                       48460002
*              ENTERED WHEN THE SEARCH HAS BEEN SATISFIED               48480002
*                                                                       48500002
CPIKEYOK EQU   *                        *                               48520002
         OI    IOBCSWS0,IOBCSWSM        SET STATUS MODIFIER             48540002
*                                                                       48560002
*              DETERMINE IF THIS OPERATION QUALIFIES FOR A WRITE        48580002
*              PREREQUISITE.                                            48600002
*                                                                       48620002
         TM    WICOFLG2,WICSCHEQ        WAS THIS A SEARCH EQ            48640002
         BZ    CPIKEYND                 NO - DOESN'T QUALIFY            48660002
         CR    REQBAL,RXFERBAL          AMOUNT SEARCHED EQUAL TO        48680002
*                                       THAT AVAILABLE (KL BYTES)       48700002
         BL    CPIKEYND                 NO - DOESN'T QUALIFY            48720002
         OI    WICSEQFG,WICFSKE         INDICATE THAT A FULL SEARCH KEY 48740002
*                                       EQUAL HAS BEEN PERFORMED        48760002
*                                                                       48780002
*              ENTERED AT NORMAL END OF SEARCH KEY                      48800002
*                                                                       48820002
CPIKEYND EQU   *                        *                               48840002
*                                                                       48860002
*              SET UP INPUT FOR OPERATION END.  THIS INCLUDES THE       48880002
*              AMOUNT REQUESTED AND THE AMOUNT AVAILABLE TO             48900002
*              BE USED FOR INCORRECT LENGTH CHECKING.                   48920002
*                                                                       48940002
         ST    REQBAL,WICREQXF          AMOUNT REQUESTED                48960002
         ST    RXFERBAL,WICAVXFR        SET AMOUNT AVAILABLE            48980002
         TM    WICXOFLG,WICRCSKT        IS THIS A READ COUNT SEARCH     49000002
*                                       KEY TIC COMBINATION             49020002
         BZ    CPIOPEND                 NO-GO END OPERATION             49040002
         BAL   RLINK2,CPIRCSKT          YES-GO PERFORM THE MOVING       49060002
*                                       OF THE COUNT FIELD FOR THIS     49080002
*                                       RECORD                          49100002
         B     CPIOPEND                 GO END OPERATION                49120002
*                                                                       49140002
*                                                                       49160002
*              ENTERED WHEN SEARCH WAS A REPETITIVE SEARCH (KEY-TIC)    49180002
*              AND RECORD HAS NOT BEEN FOUND AND SEARCH WAS NOT         49200002
*              MULTITRACK                                               49220002
*                                                                       49240002
CPIKEYER EQU   *                        *                               49260002
         ST    REQBAL,WICREQXF          THE AMOUNT REQUESTED FOR        49280002
*                                       THIS OPERATION - THE AMOUNT     49300002
*                                       AVAILABLE WAS INITIALLY SET TO  49320002
*                                       ZERO AND WILL BE SENT TO END    49340002
*                                       ROUTINE AS ZERO                 49360002
         OI    WICOFLG2,WICERROR        INDICATE AN ERROR CONDITION     49380002
         LA    RERRDISP,ERR06DSP        DISPLACEMENT FOR NO RECORD      49400002
*                                       FOUND ERROR                     49420002
         STH   RERRDISP,WICERDSP        WILL BE USED BY THE END RTN     49440002
         TM    WICXOFLG,WICRCSKT        IS THIS A READ COUNT SEARCH     49460002
*                                       COMBINATION                     49480002
         BZ    CPIOPEND                 NO-GO END OPERATION             49500002
         BAL   RLINK2,CPIRCSKT          GO PERFORM THE MOVING OF THE    49520002
*                                       COUNT FIELD FOR THIS RECORD     49540002
         S     RCCW,KCCWLGTH            BACK UP CCW POINTER TO THE      49544002
*                                       READ COUNT CCW                  49548002
         ST    REQBAL,WICREQXF          SET THE REQUESTED AMOUNT        49552002
*                                       EQUAL TO THE CCW COUNT OF       49556002
*                                       THE READ COUNT CCW SINCE THE    49556802
*                                       NO RECORD FOUND ENDED WITH      49557602
*                                       THE READ COUNT CCW - THIS       49558402
*                                       COUNT WAS LOADED INTO REG       49559202
*                                       REQBAL IN THE READ COUNT-       49559302
*                                       SEARCH KEY-TIC SUBROUTINE       49559402
         B     CPIOPEND                 GO TERMINATE CHANNEL PROGRAM    49560002
         TITLE 'CHANNEL PROGRAM INTERPRETER - NOP-RESTORE-SET SECTOR'   49580002
*********************************************************************** 49600002
*                                                                     * 49620002
*        NOP, RESTORE, AND SET SECTOR                                 * 49640002
*                                                                     * 49660002
*        THE RESTORE COMMAND OPERATES AS A NOP COMMAND.               * 49680002
*                                                                     * 49700002
*        INPUT - REG REQBAL CONTAINS THE CCW COUNT SPECIFIED          * 49720002
*                                                                     * 49740002
*********************************************************************** 49760002
*                                                                     * 49780002
*                                                                       49800002
*              NOP AND SET SECTOR ENTRY                                 49820002
*                                                                       49840002
CPINOP   EQU   *                        *                               49860002
         TM    CCWOPCDE,CCWEQCON        IF THE EQUAL BIT IS ON THEN THE 49880002
*                                       COMMAND IS A SET SECTOR         49900002
         BO    CPISSECT                 GO PROCESS SET SECTOR           49920002
         ST    REQBAL,WICAVXFR          SET AVAILABLE EQUAL    @YM03864 49930002
*                                       TO REQUESTED SO NO     @YM03864 49932002
*                                       INTERRUPT WILL OCCUR   @YM03864 49934002
*                                                                       49940002
*              RESTORE ENTRY                                            49960002
*                                                                       49980002
CPIRSTOR EQU   *                        *                               50000002
         OI    WICOFLG2,WICDATAX        INDICATE OPERATION STARTED      50020002
         NI    WICXOFLG,FULLBYTE-WICNDXPT    CLEAR INDEX POINT PASSED   50040002
         ST    REQBAL,WICREQXF          SAVE THE CCW COUNT - THE        50060002
*                                       AVAILABLE COUNT IS ZERO         50080002
         LA    RWORK,WICAFDAT           SET RELATIVE AREA POINTER PAST  50100002
         STH   RWORK,WICRELTP           DATA AS ORIENTATION WITHIN      50120002
*                                       THE CURRENT RECORD IS LOST      50140002
         B     CPIOPEND                 GO PROCESS END OF OPERATION     50160002
*                                                                       50180002
*                                                                       50200002
*              PROCESS SET SECTOR                                       50220002
*                                                                       50240002
CPISSECT EQU   *                        *                               50260002
         CLI   WICSECT,WICNORPS         IF MAXIMUM SECTOR VALUE IS      50280002
*                                       ZERO THEN THIS IS NOT AN        50300002
*                                       RPS DEVICE                      50320002
         BE    CPISSTE1                 INVALID OP CODE FOR NON RPS     50340002
         OI    WICOFLG2,WICDATAX        INDICATE OPERATION STARTED      50360002
         NI    WICXOFLG,FULLBYTE-WICNDXPT   CLEAR INDEX POINT           50380002
         LA    RXFERBAL,LSECTARG        NUMBER OF BYTES TO USE IS ONE   50400002
         ST    RXFERBAL,WICAVXFR        SAVE FOR ENDING ROUTINE         50420002
         ST    REQBAL,WICREQXF          BYTES SPECIFIED IN CCW CNT      50440002
XPGCK13  CLC   ADDRONLY(LSECTARG,RBFRDATA),WICSECT  IS THE SECTOR       50460002
*                                       VALUE BEING SET LESS THAN       50480002
*                                       THE MAXIMUM VALUE               50500002
         BL    CPIOPEND                 YES-VALUE IS LEGAL SO GO        50520002
*                                       END THE OPERATION               50540002
         CLI   ADDRONLY(RBFRDATA),SECTXFF  IS THE VALUE SUPPLIED A      50560002
*                                       SECTOR OF X'FF'                 50580002
         BE    CPIOPEND                 GO END OPERATION AS THIS IS     50600002
*                                       A VALID VALUE EVEN THOUGH       50620002
*                                       IT EXCEEDS THE MAXIMUM          50640002
         OI    WICOFLG2,WICERROR        INDICATE AN ERROR SITUATION     50660002
*                                       AFTER OPERATION STARTED         50680002
         B     CPISSTE2                 GO SET ERROR CODE               50700002
*                                                                       50720002
*                                                                       50740002
*              ENTERED FOR A SET SECTOR TO A NON RPS DEVICE             50760002
*                                                                       50780002
CPISSTE1 EQU   *                        *                               50800002
         OI    WICOFLG2,WICINTRP        INDICATE AN ERROR DETECTED      50820002
*                                       BEFORE STARTING                 50840002
*                                                                       50860002
CPISSTE2 EQU   *                        *                               50880002
         LA    RERRDISP,ERR01DSP        SET DISPLACEMNT INTO ERROR TBL  50900002
*                                       FOR INVALID OP CODE OR SECTOR   50920002
*                                       VALUE TOO LARGE                 50940002
         STH   RERRDISP,WICERDSP        SAVE FOR END ROUTINE            50960002
         B     CPIOPEND                 GO END OPERATION AND END        50980002
*                                       CHANNEL PROGRAM IN ERROR        51000002
         TITLE 'CHANNEL PROGRAM INTERPRETER - LENGTH TO USE ROUTINE'    51020002
*********************************************************************** 51040002
*                                                                     * 51060002
*        LENGTH TO USE ROUTINE                                        * 51080002
*                                                                     * 51100002
*        THE FOLLOWING ROUTINE CALCULATES THE NUMBER OF BYTES TO USE  * 51120002
*        FOR A GIVEN OPERATION.  THE AMOUNT TO USE IS THE SMALLER OF  * 51140002
*        THAT REQUESTED OR THAT WHICH IS AVAILABLE.                   * 51160002
*                                                                     * 51180002
*        INPUT - REG REQBAL CONTAINS THE REQUESTED AMOUNT             * 51200002
*                REG RXFERBAL CONTAINS THE AMOUNT NOW AVAILABLE       * 51220002
*                                                                     * 51240002
*        OUTPUT - REG RCXFER CONTAINS THE SMALLER OF THE INPUTS       * 51260002
*                                                                     * 51280002
*********************************************************************** 51300002
*                                                                       51320002
*                                                                       51340002
CPIXMITL EQU   *                        *                               51360002
         LR    RCXFER,RXFERBAL          ASSUME AVAILABLE SMALLER        51380002
         CR    REQBAL,RXFERBAL          COMPARE INPUTS                  51400002
         BCR   NOTLOW,RLINK             RETURN - REQUESTED IS GREATER   51420002
*                                       THAN OR EQ TO THAT AVAILABLE    51440002
         LR    RCXFER,REQBAL            USE REQUESTED SINCE IT IS LESS  51460002
         BR    RLINK                    RETURN                          51480002
         TITLE 'CHANNEL PROGRAM INTERPRETER - SENSE COMMAND'            51500002
*********************************************************************** 51520002
*                                                                     * 51540002
*        SENSE COMMAND                                                * 51560002
*                                                                     * 51580002
*        THE SENSE COMMAND RETURNS SENSE INFORMATION CONSISTING OF    * 51600002
*        ALL ZEROES.  THIS IS THE RESULT OF SENSE BEING CLEARED       * 51620002
*        AT THE BEGINNING OF THE CHANNEL PROGRAM. IF ANY CONDITION    * 51640002
*        HAS CAUSED THE SENSE TO BE SET, THE CHANNEL PROGRAM WOULD    * 51660002
*        HAVE ALREADY BEEN TERMINATED.                                * 51680002
*                                                                     * 51700002
*        INPUT - REGISTER REQBAL CONTAINS THE REQUESTED COUNT         * 51720002
*                RBFRDATA CONTAINS THE ADDRESS TO PLACE THE DATA      * 51740002
*                                                                     * 51760002
*********************************************************************** 51780002
*                                                                       51800002
CPISENSE EQU   *                        *                               51820002
         OI    WICOFLG2,WICDATAX        INDICATE OPERATION STARTED      51840002
         LA    RXFERBAL,SEN0TO5         ASSUME SIX BYTES OF SENSE       51860002
*                                       ARE AVAILABLE                   51880002
         CLI   WICDEVTP,WIC2314         IS THIS A 2314 DEVICE           51900002
         BE    CPISEN10                 BR - SIX BYTE ASSUMPTION OKAY   51920002
         LA    RXFERBAL,SEN6TO23(RXFERBAL)  INCREASE BYTES AVAILABE TO  51940002
*                                       TWENTY FOUR                     51960002
CPISEN10 EQU   *                        *                               51980002
         ST    REQBAL,WICREQXF          NUMBER OF BYTES REQUESTED       52000002
         ST    RXFERBAL,WICAVXFR        NUMBER OF BYTES AVAILABLE       52020002
         TM    CCWFLAGS,CCWSKIP         TRANSFER DESIRED                52040002
         BO    CPIOPEND                 NO - GO END OPERATION           52060002
*                                                                       52080002
         BAL   RLINK,CPIXMITL           GET SHORTER OF REQUESTED        52100002
*                                       OR AVAILABLE AMOUNTS            52120002
*                                       RESULTS IN REG RCXFER           52140002
         LR    REQBAL,RCXFER            NUMBER OF BYTES TO ZERO OUT     52160002
         SR    RXFERBAL,RXFERBAL        NO BYTES WILL BE MOVED          52180002
         L     RCURSOR,WICCAM           USE CURRENT RECORD POINTER      52200002
XPGCK14  MVCL  RBFRDATA,RCURSOR         ZERO AREA                       52220002
         B     CPIOPEND                 GO END OPERATION                52240002
         TITLE 'CPI RETRY ENTRY POINT FROM WIFRR ROUTINE'               52250002
*********************************************************************** 52252002
*                                                                     * 52254002
*        RETRY FROM FRR.                                              * 52256002
*        LOAD REG 15 WITH PROPER BASE FROM BASEADDR                   * 52258002
*        AND GO TO CPIOPEND.                                          * 52258402
*                                                                     * 52258502
*********************************************************************** 52258802
FRROPEND L     R15,BASEADDR-FRROPEND(,R15)  R15 = BASE          YM03980 52259202
         TITLE 'CHANNEL PROGRAM INTERPRETER - OP CODE END ROUTINE'      52260002
*********************************************************************** 52280002
*                                                                     * 52300002
*        OPERATION END ROUTINE                                        * 52320002
*                                                                     * 52340002
*        THE FOLLOWING CODE IS ENTERED WHEN AN OPERATION HAS COM-     * 52360002
*        EITHER SUCCESSFULLY OR NOT.  IF A PCI HAS BEEN REQUESTED     * 52380002
*        DURING THE OPERATION, IT IS TAKEN PRIOR TO THE DETERMI-      * 52400002
*        NATION OF WHETHER TO CONTINUE THE CHANNEL PROGRAM OR TO      * 52420002
*        TERMINATE IT.                                                * 52440002
*                                                                     * 52460002
*********************************************************************** 52480002
*                                                                       52500002
CPIOPEND EQU   *                        *                               52520002
         TM    WICRESTA,WICPCIRS        HAS PCI BEEN REQUESTED AS       52540002
*                                       SET IN THE CCW FORMAT           52560002
*                                       CHECKING ROUTINE CPICCWCK       52580002
         BO    CPIPCI                   YES - GO PROCESS PCI            52600002
*                                                                       52620002
*              ENTERED WHEN PCI PROCESSING HAS BEEN COMPLETED           52640002
CPIEND10 EQU   *                        *                               52660002
         SR    RWORK,RWORK              ASSUME A ZERO RESIDUAL COUNT    52680002
         TM    WICOFLG2,WICINTRP        WAS AN ERROR DETECTED BEFORE    52700002
*                                       AN OPERATION INTIATED TRANS-    52720002
*                                       FER OR DURING A CCW FETCH       52740002
*                                       AFTER TRANSFER STARTED          52760002
         BO    CPIABEND                 YES AN ERROR HAS BEEN SET       52780002
*                                                                       52800002
*              SINCE AN OPERATION HAS STARTED AND WAS NOT INTERRUPTED   52820002
*              BY A CHANNEL PROGRAM CHECK, DETERMINE IF AN INCORRECT    52840002
*              LENGTH CONDITION EXISTS.                                 52860002
*                                                                       52880002
         L     REQBAL,WICREQXF          TOTAL REQUESTED BYTE COUNT      52900002
         L     RXFERBAL,WICAVXFR        TOTAL AVAILABLE BYTE COUNT      52920002
         CR    REQBAL,RXFERBAL          COMPARE THAT REQUESTED TO       52940002
*                                       THAT WHICH WAS AVAILABLE        52960002
         BNE   CPIEND30                 GO DETERMINE IF THIS WILL       52980002
*                                       CAUSE AN INCORRECT LENGTH       53000002
*                                       INTERRRUPT                      53020002
*                                                                       53040002
*              DETERMINE IF ANY ERROR CONDITION HAS BEEN SET AFTER      53060002
*              OPERATION WAS INITIATED.                                 53080002
CPIEND20 EQU   *                        *                               53100002
         TM    WICOFLG2,WICERROR        ANY ERRORS INDICATED            53120002
         BO    CPIABE05                 YES GO PROCESS ERROR            53140002
*                                                                       53160002
*              NO ERRORS HAVE BEEN DETECTED.  DETERMINE IF CHANNEL      53180002
*              PROGRAM IS FINISHED OR IF A NEW OPERATION IS DESIRED.    53200002
*                                                                       53220002
         TM    CCWFLAGS,CCWCC           COMMAND CHAINED                 53240002
         BZ    CPINREND                 NO - GO END NORMALLY            53260002
         LA    RCCW,L'CCW(RCCW)         NEXT CCW                        53280002
         TM    IOBCSWS0,IOBCSWSM        STATUS MODIFIER SET             53300002
         BZ    CPIOPROC                 NO - PROCESS NEXT OPERATION     53320002
         LA    RCCW,L'CCW(RCCW)         SKIP A CCW                      53340002
         NI    IOBCSWS0,FULLBYTE-IOBCSWSM  CLEAR STATUS MODIFIER        53360002
         B     CPIOPROC                 GO PROCESS NEXT OPERATION       53380002
*                                                                       53400002
*              ENTERED WHEN THE NUMBER OF BYTES AVAILABLE AND THE       53420002
*              NUMBER OF BYTES REQUESTED ARE NOT THE SAME.  USE THE     53440002
*              CONDITION CODE SETTING WHICH CAUSED THIS ENTRY TO        53460002
*              DETERMINE WHICH IS GREATER.                              53480002
*                                                                       53500002
CPIEND30 EQU   *                        *                               53520002
         BL    CPIEND50                 REQUESTED LESS THAN AVAILABLE   53540002
*                                                                       53560002
*              ENTERED WHEN A PREVIOUS ERROR HAS NOT OCCURED BUT        53580002
*              THE AMOUNT REQUESTED FOR THE OPERATION WAS GREATER       53600002
*              THAN THAT AVAILABLE.                                     53620002
*                                                                       53640002
         SR    REQBAL,RXFERBAL          CALCULATE RESIDUAL              53660002
         LR    RWORK,REQBAL             SAVE RESIDUAL FOR CSW           53680002
         TM    CCWFLAGS,CCWDC           IS DATA CHAINING SPECIFIED      53700002
         BZ    CPIEND50                 NO GO TEST FOR SILI BIT         53720002
*                                       DATA CHAINING NULLIFIES THE     53740002
*                                       SILI BEING SET                  53760002
CPIEND40 EQU   *                        *                               53780002
         OI    IOBCSWS1,IOBCSWIL        INCORRECT LENGTH INTERRUPT      53800002
         B     CPIABE05                 GO END CHANNEL PROGRAM          53820002
*                                       ABNORMALLY                      53840002
*                                                                       53860002
*              ENTERED WHEN REQUESTED AMOUNT IS LESS THAN THAT          53880002
*              AVAILABLE.                                               53900002
CPIEND50 EQU   *                        *                               53920002
         TM    CCWFLAGS,CCWSILI         IS SILI BIT SET                 53940002
         BZ    CPIEND40                 NO - GO SET INCORRECT LENGTH    53960002
         B     CPIEND20                 GO CONTINUE NORMAL OPERATION    53980002
*                                       ENDING                          54000002
*                                                                       54020002
*                                                                       54040002
*              ENTERED WHEN THE CHANNEL PROGRAM IS ENDING NORMALLY.     54060002
CPINREND EQU   *                        *                               54080002
         OI    IOBCSWS0,IOBCSWCE+IOBCSWDE  SET CHANNEL END AND          54100002
*                                       DEVICE END                      54120002
*                                                                       54140002
*              ENTERED FOR BOTH NORMAL AND ABNORMAL ENDINGS             54160002
CPICPEND EQU   *                        *                               54180002
         STH   RWORK,IOBCSWBC           SET RESIDUAL COUNT              54200002
         LA    RCCW,L'CCW(RCCW)         ENDING CCW                      54220002
         STCM  RCCW,ADDRMASK,IOBCSWCA   SET STOP ADDRESS IN CSW         54240002
         MVC   WICSENSE,IOBSENS0        SAVE SENSE                      54260002
         NI    WICRESTA,FULLBYTE-WICRSTRT  CLEAR RESTART FLAG           54264002
*                                                                       54280002
*                                                                       54300002
*              END OF CHANNEL PROGRAM.  RETURN TO THE TRACK MANAGER.    54320002
*                                                                       54340002
         LR    R13,RVDSCB               VDSCB ADDRESS                   54360002
         USING VDSCB,R13                DESCRIBE CONTROL BLOCK          54380002
         L     R13,VDSVBPPL             PARAMETER LIST CONTAINS SAVE    54400002
*                                       AREA FOR LOCATING RETURN        54420002
*                                       ADDRESS                         54440002
         DROP  R13                      DISCONTINUE DESCRIPTION         54460002
         USING VBPPL,R13                DESCRIBE PARM LIST              54480002
         L     R14,VBPPLSAV+REG14SAV    GET RETURN ADDR FROM SAVE       54500002
         DROP  R13                      DISCONTINUE DESCRIPTION         54520002
         SR    R15,R15                  SET RETURN CODE FOR CHANNEL     54540002
*                                       PGM ENDING                      54560002
         BR    R14                      EXIT TO CALLER                  54580002
*                                                                       54600002
*                                                                       54620002
*                                                                       54640002
*              AN ERROR WAS DETECTED BEFORE OPEARTION WAS INITIATED     54660002
*              OR OCCURRED DURING THE OPERATION WHEN A NEW CCW          54680002
*              WAS FETCHED FOR DATA CHAINED CCWS                        54700002
*                                                                       54720002
CPIABEND EQU   *                        *                               54740002
         ICM   RWORK,HWMASK,CCWCOUNT    SET RESIDUAL AS CCW COUNT       54760002
*                                                                       54780002
*              ENTERED FOR ERRORS WHICH OCCUR AFTER AN OPERATION        54800002
*              HAS STARTED.                                             54820002
CPIABE05 EQU   *                        *                               54840002
*                                                                       54860002
*              MOVE IN THE APPROPRIATE SENSE BYTES INTO THE IOB FROM    54880002
*              THE DEVICE DEPENDENT TABLES.  IF NO ERROR HAS OCCURRED   54900002
*              WHICH WOULD HAVE SET SENSE INFORMATION THEN THE          54920002
*              DISPLACEMENT INTO THE SENSE BYTE TABLES IS ZERO          54940002
*              WHICH WILL SET BOTH SENSE BYTES TO ZERO.  THE DISPLACE-  54960002
*              MENT WHICH INDICATE ERRORS IS SET WHENEVER THE ERROR     54980002
*              WAS DETECTED.  THE ERROR TABLES USED ARE 'KERRTAB1'      55000002
*              AND 'KERRTAB2'.  THE DISPLACEMENT USED FOR THESE         55020002
*              TABLES HAS BEEN SAVE AT 'WICERDSP' IN THE WICB.          55040002
*                                                                       55060002
         LA    RERRDISP,KERRTAB2        ASSUME THAT THE SENSE BYTES     55080002
*                                       TO USE ARE FOR DEVICES OTHER    55100002
*                                       THAN A 2314                     55120002
         CLI   WICDEVTP,WIC2314         IS THE DEVICE A 2314            55140002
         BNE   CPIABE06                 NO-ASSUMPTION CORRECT           55160002
         LA    RERRDISP,KERRTAB1        ADDRESS FOR 2314 SENSE BYTES    55180002
CPIABE06 EQU   *                        *                               55200002
         AH    RERRDISP,WICERDSP        DISPLACE TO THE ERROR AS        55220002
*                                       INDICATED WHEN DETECTED         55240002
*                                       MOVE SENSE TO IOB               55260002
         MVC   IOBSENS0(L'IOBSENS0+L'IOBSENS1),ADDRONLY(RERRDISP)       55280002
         OC    IOBSENS0(L'IOBSENS0+L'IOBSENS1),IOBSENS0  ANY SENSE      55300002
         BZ    CPIABE10                 NO - CONTINUE                   55320002
         OI    IOBCSWS0,IOBCSWUC        INDICATE UNIT CHECK             55340002
CPIABE10 EQU   *                        *                               55360002
         TM    WICOFLG2,WICDATAX        WAS DATA TRANSFER STARTED       55380002
         BZ    CPICPEND                 NO - GO END CHANNEL PGM         55400002
         OI    IOBCSWS0,IOBCSWCE+IOBCSWDE  INDICATE CHANNEL END AND     55420002
*                                       DEVICE END                      55440002
         B     CPICPEND                 BR TO COMPLETE ENDING           55460002
*                                                                       55480002
*                                                                       55500002
*              ENTERED DURING THE ENDING OF AN OPERATION WHEN PCI       55520002
*              HAS BEEN REQUESTED.                                      55540002
CPIPCI   EQU   *                        *                               55560002
         MVC   WICSENSE,IOBSENS0        SAVE CURRENT SINSE              55580002
         MVC   WICCSWSV,IOBCSW          SAVE CURRENT CSW                55600002
         SR    RWORK,RWORK              CLEAR REG                       55620002
         STH   RWORK,IOBCSWS0           CLEAR CSW STATUS FOR PCI        55640002
         STH   RWORK,IOBSENS0           CLEAR SENSE FOR PCI             55660002
         LA    RWORK,L'CCW(RCCW)        ENDING ADDRESS FOR PCI          55680002
         STCM  RWORK,ADDRMASK,IOBCSWCA   AND SET IN CSW                 55700002
         OI    IOBCSWS1,IOBCSWPI        INDICATE PCI IN CSW             55720002
         OI    WICRESTA,WICRSTRT        INDICATE RESTART SITUATION      55740002
*                                                                       55760002
*              TAKE THE PCI RETURN TO THE TRACK MANAGER WHICH IS A      55780002
*              RESTART SITUATION.                                       55800002
*                                                                       55820002
         LR    R13,RVDSCB               VDSCB ADDRESS                   55840002
         USING VDSCB,R13                DESCRIBE CONTROL BLOCK          55860002
         L     R13,VDSVBPPL             PARAMETER LIST CONTAINS SAVE    55880002
*                                       AREA FOR LOCATING RETURN        55900002
*                                       ADDRESS                         55920002
         DROP  R13                      DISCONTINUE DESCRIPTION         55940002
         USING VBPPL,R13                DESCRIBE PARM LIST              55960002
         L     R14,VBPPLSAV+REG14SAV    GET RETURN ADDR FROM SAVE       55980002
         DROP  R13                      DISCONTINUE DESCRIPTION         56000002
         SR    R15,R15                  SET RETURN CODE FOR PCI EXIT    56020002
         BR    R14                      RETURN TO TRACK MANAGER         56040002
*                                                                       56060002
*              RETURNED TO AFTER THE PCI EXIT HAS BEEN TAKEN.           56080002
*              REGISTERS HAVE BEEN SAVED AND RESTORED IN THE TRACK      56100002
*              MANAGER.  THE BASE REG FOR THIS MODULE HAS BEEN          56120002
*              RESTORED.                                                56140002
*                                                                       56160002
CPIPCIRS EQU   *                        *                               56180002
         MVC   IOBSENS0(L'IOBSENS0+L'IOBSENS1),WICSENSE  RESTORE        56200002
         MVC   IOBCSW,WICCSWSV          RESTORE CSW                     56220002
         NI    WICRESTA,FULLBYTE-WICPCIRS-WICRSTRT  CLEAR RESTART FLAGS 56240002
         B     CPIEND10                 GO CONTINUE WITH THE ENDING     56260002
*                                       OF THIS OPERATION               56280002
         TITLE 'CHANNEL PROGRAM INTERPRETER - EFFECTIVE LENGTH ROUTINE' 56300002
*********************************************************************** 56320002
*                                                                     * 56340002
*        EFFECTIVE LENGTH SUMMATION ROUTINE                           * 56360002
*                                                                     * 56380002
*        THE FOLLOWING ROUTINE COMPUTES THE EFFECTIVE LENGTHS OF ALL  * 56400002
*        RECORDS BETWEEN A LOWER LIMIT AND A HIGHER LIMIT WHICH ARE   * 56420002
*        THE INPUTS.  THE CALCULATIONS ARE PERFORMED USING THE NOT    * 56440002
*        LAST RECORD ON TRACK FORMULA.                                * 56460002
*                                                                     * 56480002
*        INPUT - REG RFROM CONTAINS STARTING ADDRESS                  * 56500002
*                REG RTO CONTAINS THE ENDING ADDRESS                  * 56520002
*        OUTPUT - REG RWORK CONTAINS THE EFFECTIVE LENGTH             * 56540002
*                                                                     * 56560002
*        ADDITIONAL REGS USED - RWORK2                                * 56580002
*                                                                     * 56600002
*********************************************************************** 56620002
*                                                                       56640002
CPISPACE EQU   *                        *                               56660002
         SR    RWORK,RWORK              CLEAR EFFECTIVE SUM             56680002
CPISPALP EQU   *                        *                               56700002
         CR    RFROM,RTO                CALCULATIONS FINISHED           56720002
         BCR   NOTLOW,RLINK             YES - RETURN WITH RESULTS       56740002
         SR    RWORK2,RWORK2            CLEAR WORKING REG               56760002
         ST    RWORK2,WICWORK           CLEAR WORK AREA                 56780002
         USING COUNTDES,RFROM           DESCRIBE COUNT THIS REC         56800002
         IC    RWORK2,CNTKL             GET KEY LENGTH                  56820002
*                                       GET DATA LENGTH AND KEY LENGTH  56840002
         MVC   WICWORK+ONE(L'CNTKL+L'CNTDL),CNTKL MOVE KL AND DL        56860002
         AH    RWORK2,WICWORK+TWO       KEY LENGTH PLUS DATA LENGTH     56880002
         AR    RFROM,RWORK2             BUMP LOWER LIMIT                56900002
         CLI   WICTOLSW,WICTOLAP        DOES TOLERANCE FACTOR APPLY     56920002
         BZ    CPISPA10                 NO - THE LOW ORDER BYTE OF      56940002
*                                       THE TOLERANCE IS ZERO AND       56960002
*                                       INDICATES DOES NOT APPLY        56980002
         MH    RWORK2,WICTOL            (KL+DL) * TOLERANCE             57000002
         SRA   RWORK2,DIVBY512          ((KL+DL)*TOLERANCE)/512)        57020002
CPISPA10 EQU   *                        *                               57040002
         AH    RWORK2,WICIGAP           ADD NORMAL OVERHEAD             57060002
         CLI   WICWORK+ONE,NOKEY        IS KEY PRESENT                  57080002
         BNE   CPISPA20                 YES - RESULTS CORRECT           57100002
         SH    RWORK2,WICKEYGP          SUBTRACT KEY CONSTANT SINCE     57120002
*                                       NOT PRESENT                     57140002
CPISPA20 EQU   *                        *                               57160002
         AR    RWORK,RWORK2             SUMM EFFECTIVE LENGTHS          57180002
         LA    RFROM,L'CNTFIELD(RFROM)  BUMP BY COUNT LENGTH            57200002
         B     CPISPALP                 CONTINUE SUMMATION              57220002
         DROP  RFROM                    DISCONTINUE DESCRIPTION         57240002
         USING IOBSTDRD,RIOB            RESUME IOB DESCRIPTION          57260002
         TITLE 'CHANNEL PROGRAM INTERPRETER -  CCW FORMAT CHECK'        57280002
*********************************************************************** 57300002
*                                                                     * 57320002
*        CCW FORMAT CHECKING ROUTINE                                  * 57340002
*                                                                     * 57360002
*        THE FUNCTION OF THIS ROUTINE IS TO VALIDATE THE FORMAT OF A  * 57380002
*        CCW.  THE ROUTINE IS ENTERED WHENEVER A NEW CCW IS TO BE     * 57400002
*        USED AS A RESULT OF EITHER DATA CHAINING OR COMMAND CHAIN-   * 57420002
*        ING.  IF THE OP CODE IS A TIC,  THEN THE TICED TO CCW IS     * 57440002
*        PROCESSED AND THE NEW CCW ADDRESS IS RETURNED TO THE CALLER. * 57460002
*                                                                     * 57480002
*        INPUT -  REG RCCW CONTAINS THE ADDRESS OF THE CCW TO BE      * 57500002
*                 VALIDATED                                             57520002
*        OUTPUT - REG REQBAL CONTAINS THE CCW COUNT                   * 57540002
*                 REG RBFRDATA CONTAINS THE CCW ADDR FIELD            * 57560002
*                 REG RCCW CONTAINS THE UPDATED CCW ADDR IF THE INPUT * 57580002
*                     CCW WAS A TIC.                                  * 57600002
*********************************************************************** 57620002
*                                                                       57640002
CPICCWCK EQU   *                        *                               57660002
XPGCK15  TM    CCWOPCDE,LOW3BITS        TEST 3 LOW ORDER BITS FOR ZERO  57680002
         BZ    CPICCWTS                 POSSIBLE TIC BR TO TEST         57700002
CPICCW10 EQU   *                        *                               57720002
         SR    REQBAL,REQBAL            CLEAR REG FOR CCW COUNT         57740002
XPGCK16  TM    CCWFLAGS,LOW3BITS        LOW 3 ORDER BITS OF FLAGS ZERO  57760002
         BC    7,CPIPGMCK               NO-CHANNEL PGM CHECK            57780002
XPGCK17  ICM   REQBAL,HWMASK,CCWCOUNT   GET CCW COUNT - CONDITION CODE  57800002
*                                       IS ZERO IF COUNT INSERTED IS    57820002
*                                       ZERO AND IS ONLY VALID FOR      57840002
*                                       A TIC                           57860002
         BZ    CPIPGMCK                 YES-CHANNEL PGM CHECK           57880002
         L     RBFRDATA,CCWDATAD        GET ADDR POINTED TO BY CCW      57900002
         LA    RBFRDATA,ADDRONLY(RBFRDATA)  CLEAR OFF OP CODE           57920002
*                                                                       57940002
*              ALSO ENTERED AFTER A CHANNEL PROGRAM CHECK HAS OCCURRED  57960002
*              IN ORDER TO CHECK FOR PCI REQUESTED.                     57980002
CPICCW20 EQU   *                        *                               58000002
         TM    CCWFLAGS,CCWPCI          IS PCI REQUESTED                58020002
         BZ    CPICCW30                 NOT REQUESTED                   58040002
         OI    WICRESTA,WICPCIRS        SET PCI REQUEST FLAG            58060002
CPICCW30 EQU   *                        *                               58080002
         NI    WICSEQFG,FULLBYTE-WICTICFG   CLEAR TIC SEQ FLAG          58100002
*                                                                       58120002
*              RETURN TO CALLER WITH THE RESULTS OF FORMAT CHECKING     58140002
*              WHICH WILL INDICATE THAT AN ERROR HAS BEEN DETECTED AND  58160002
*              AND INTERRUPT IN THE CHANNEL PROGRAM IS PENDING IF ANY   58180002
*              ERROR WAS DETERMINED.  OTHERWISE THE CHECKING WAS        58200002
*              SUCCESSFUL AND THE OPERATION CAN PROCEED NORMALLY.       58220002
*                                                                       58240002
         BR    RLINK                    RETURN TO CALLER                58260002
*                                                                       58280002
CPICCWTS EQU   *                        *                               58300002
         TM    CCWOPCDE,CCWTICBT        COMPLETE TEST FOR TIC           58320002
         BZ    CPICCW40                 BRANCH-OP CODE NOT A TIC AND    58340002
*                                       IS INVALID UNLESS DATA          58360002
*                                       CHAINING IS IN EFFECT           58380002
         TM    WICSEQFG,WICTICFG        IS THIS A TIC FROM A TIC        58400002
         BO    CPIPGMCK                 BRANCH-PGM CHECK ERROR          58420002
         OI    WICSEQFG,WICTICFG        SET TIC SEQUENCE FLAG           58440002
         TM    LOWBYTWD(RCCW),LOW3BITS  TICED TO CCW ON A DOUBLE        58460002
*                                       WORD BOUNDARY                   58480002
         BNZ   CPIPGMCK                 TICED TO CCW NOT ON A DOUBLE    58500002
*                                       WORD-CHANNEL PGM CHECK          58520002
XPGCK18  L     RCCW,CCWDATAD            ADDR OF TICED TO CCW            58540002
         LA    RCCW,ADDRONLY(RCCW)      CLEAR HIAH ORDER BYTE           58560002
         B     CPICCWCK                 CHECK NEW CCW                   58580002
*                                                                       58600002
CPICCW40 EQU   *                        *                               58620002
         TM    WICOFLG2,WICDC           IS DATA CHAINING IN EFFECT      58640002
         BO    CPICCW10                 IGNORE INVALID OP CODE IF       58660002
*                                       DATA CHAINED IN EFFECT ELSE     58680002
*                                       INVALID OP CODE SINCE THE 3     58700002
*                                       LOW ORDER BITS ARE ZERO, NOT    58720002
*                                       A TIC AND THIS IS NOT DATA      58740002
*                                       CHAINING                        58760002
*              INDICATE THAT A CHANNEL PROGRAM CHECK IS PENDING AND     58780002
*              SET THE NECESSARY FLAGS TO TERMINATE THE PROCESSING.     58800002
CPIPGMCK EQU   *                        *                               58820002
         OI    IOBCSWS1,IOBCSWPG        SET CHANNEL PGM CHECK           58840002
         OI    WICOFLG2,WICINTRP        INDICATE THAT THE CHANNEL PGM   58860002
*                                       HAS BEEN INTERRUPTED WHICH      58880002
*                                       WILL PREVENT SUBSEQUENT CCWS    58900002
*                                       FROM BEING FETCH IF DATA        58920002
*                                       MOVEMENT WAS IN PROCESS         58940002
         SR    REQBAL,REQBAL            SET REQUESTED BYTES TO ZERO     58960002
         OI    WICOFLG2,WICXFCOM        INDICATE NO MORE DATA MOVEMENT  58980002
*                                       TO TAKE PLACE                   59000002
         B     CPICCW20                 GO TEST FOR PCI REQUEST         59020002
         TITLE 'CHANNEL PROGRAM INTERPRETER -  EXECUTED INSTRUCTIONS'   59040002
*********************************************************************** 59060002
*                                                                     * 59080002
*        EXECUTED INSTRUCTIONS                                        * 59100002
*                                                                     * 59120002
*********************************************************************** 59140002
*                                                                       59160002
EXOPTEST TM    ADDRONLY(RWORK),OREDBYTE USED FOR TESTING THE OP CODE    59180002
*                                       BIT MAP                         59200002
*                                                                       59220002
*              FOR USE IN A READ COUNT SEARCH KEY TIC TO READ COUNT     59240002
*              SEQUENCE AFTER THE SEARCH KEY HAS BEEN COMPLETED.        59260002
*                                                                       59280002
EXMOVCNT MVC   ADDRONLY(OREDBYTE,RBFRDATA),ADDRONLY(RCURSOR)  ABOVE     59300002
*                                                                       59320002
*              FOR USE IN SEARCH OPERATION WHERE THE SEARCH ARGUMENT    59340002
*              IS LOCATED BY REG RBFRDATA WHICH CONTAINS THE ADDRESS    59360002
*              POINTED TO BY THE CCW.                                   59380002
*                                                                       59400002
EXCOMPAR CLC   ADDRONLY(OREDBYTE,RCURSOR),ADDRONLY(RBFRDATA)  ABOVE     59420002
*                                                                       59440002
*                                                                       59460002
*              FOR USE WHEN A SEARCH ID IS BEING EXECUTED AND CAUSES    59480002
*              THE BRANCH TO BE TAKEN WHEN THE DESIRED SEARCH CONDITION 59500002
*              HAS BEEN SATISFIED.                                      59520002
*                                                                       59540002
EXBRSID  BC    OREDBYTE,CPISIDOK        SEARCH SATISFIED BRANCH         59560002
*                                                                       59580002
*              FOR USE WHEN A SEARCH KEY IS BEING EXECUTED AND CAUSES   59600002
*              THE BRANCH TO BE TAKEN WHEN THE DESIRED SEARCH CONDITION 59620002
*              HAS BEEN SATISFIED.                                      59640002
*                                                                       59660002
EXBRKEY  BC    OREDBYTE,CPIKEYOK        SEARCH SATISFIED BRANCH         59680002
         TITLE 'CHANNEL PROGRAM INTERPRETER - TABLES'                   59700002
*********************************************************************** 59720002
*                                                                     * 59740002
*        OP CODE VALIDATION TABLES                                    * 59760002
*                                                                     * 59780002
*        THE FOLLOWING TABLES ARE USED IN VALIDATING A GIVEN OP       * 59800002
*        CODE AFTER THE FORMAT OF THE CCW HAS BEEN VALIDATED.         * 59820002
*        THERE IS A ONE TO ONE CORRESPONDENCE BETWEEN THE BIT MAP     * 59840002
*        AND ALL POSSIBLE OP CODES AS EACH BIT REPRESENTS AN OP       * 59860002
*        CODE.  A VALUE OF 1 MEANS THE OP CODE IS VALID AND 0 INVALID.* 59880002
*        THE OP CODE IS USED TO INDEX INTO THE TABLE TO THE APPROPRI- * 59900002
*        ATE BYTE TO TEST.  THE OP CODE IS ALSO USED TO INSERT        * 59920002
*        A MASK VALUE FROM THE MASK TABLE TO TEST THE                 * 59940002
*        APPROPRIATE BIT WITHIN THE GIVEN BYTE.  THIS IS ACCOM-       * 59960002
*        PLISHED BY USING THE 5 HIGH ORDER BITS OF THE OP             * 59980002
*        CODE TO INDEX INTO THE BIT MAP, AND USING THE LOW            * 60000002
*        ORDER 3 BITS TO INDEX INTO THE TABLE OF MASKS.  THUS         * 60020002
*        AN OP CODE SUCH AS '1D' (B'00011-101') WOULD INDEX TO        * 60040002
*        BYTE 3 OF THE MAP TABLE AND USE THE MASK FROM THE MASK       * 60060002
*        TABLE AT AN OFFSET OF 5.  THIS MEANS THAT BYTE 3 OF THE      * 60080002
*        MAP TABLE WOULD BE TESTED WITH A MASK OF X'04'.  THIS        * 60100002
*        BIT REPRESENTS THE WCKD OP CODE.                             * 60120002
*                                                                     * 60140002
*********************************************************************** 60160002
*                                                                       60180002
         DS    0B                                                       60200002
KOPMAP1  EQU   *                        *                               60220002
* OP CODES 0X                                                           60240002
         DC    B'01011111'              WSPCKD,NOP,SENSE,WD,RD,SEEK     60260002
         DC    B'00010110'              SEEKC,WKD,RKD                   60280002
* OP CODES 1X                                                           60300002
         DC    B'01100011'              ERASE,RC,RR0,RESTORE            60320002
         DC    B'00110110'              RHA,SEEKH,WCKD,RCKD             60340002
* OP CODES 2X                                                           60360002
         DC    B'00110000'              RSEC,SETSEC                     60380002
         DC    B'01000000'              SKE                             60400002
* OP CODES 3X                                                           60420002
         DC    B'01000000'              SIDE                            60440002
         DC    B'01000000'              SHAE                            60460002
* OP CODES 4X                                                           60480002
         DC    B'00000000'              NONE                            60500002
         DC    B'01000000'              SKH                             60520002
* OP CODES 5X                                                           60540002
         DC    B'01000000'              SIDH                            60560002
         DC    B'00000000'              NONE                            60580002
* OP CODES 6X                                                           60600002
         DC    B'00000000'              NONE                            60620002
         DC    B'01000000'              SKEH                            60640002
* OP CODES 7X                                                           60660002
         DC    B'01000000'              SIDEH                           60680002
         DC    B'00000000'              NONE                            60700002
* OP CODES 8X                                                           60720002
         DC    B'00000010'              RD(MT)                          60740002
         DC    B'00000010'              RKD(MT)                         60760002
* OP CODES 9X                                                           60780002
         DC    B'00100010'              RC(MT),RR0(MT)                  60800002
         DC    B'00100010'              RHA(MT),RCKD(MT)                60820002
* OP CODES AX                                                           60840002
         DC    B'00000000'              NONE                            60860002
         DC    B'01000000'              SKE(MT)                         60880002
* OP CODES BX                                                           60900002
         DC    B'01000000'              SIDE(MT)                        60920002
         DC    B'01000000'              SHAE(MT)                        60940002
* OP CODES CX                                                           60960002
         DC    B'00000000'              NONE                            60980002
         DC    B'01000000'              SKH(MT)                         61000002
* OP CODES DX                                                           61020002
         DC    B'01000000'              SIDH(MT)                        61040002
         DC    B'00000000'              NONE                            61060002
* OP CODES EX                                                           61080002
         DC    B'00000000'              NONE                            61100002
         DC    B'01000000'              SKHE(MT)                        61120002
* OP CODES FX                                                           61140002
         DC    B'01000000'              SIDHE(MT)                       61160002
         DC    B'00000000'              NONE                            61180002
*                                                                       61200002
*                                                                       61220002
*        THE FOLLOWING TABLE IS USED TO ELIMINATE OP CODES WHICH        61240002
*        ARE VALID BUT ARE NOT ALLOWED TO BE PRECEDED BY A SET FILE     61260002
*        MASK INSTRUCTION.                                              61280002
*                                                                       61300002
         DS    0B                                                       61320002
KOPMAP2  EQU   *                        *                               61340002
*                                                                       61360002
* OP CODES 0X                                                           61380002
         DC    B'00100000'              READ IPL                        61400002
         DC    B'00000000'              NONE                            61420002
* OP CODES 1X                                                           61440002
         DC    B'00000000'              NONE                            61460002
         DC    B'00000001'              SET FILE MASK                   61480002
* OP CODES 2X                                                           61500002
         DC    B'00000000'              NONE                            61520002
         DC    B'00000000'              NONE                            61540002
* OP CODES 3X                                                           61560002
         DC    B'00000000'              NONE                            61580002
         DC    B'00000000'              NONE                            61600002
* OP CODES 4X                                                           61620002
         DC    B'00000000'              NONE                            61640002
         DC    B'00000000'              NONE                            61660002
* OP CODES 5X                                                           61680002
         DC    B'00000000'              NONE                            61700002
         DC    B'00000000'              NONE                            61720002
* OP CODES 6X                                                           61740002
         DC    B'00000000'              NONE                            61760002
         DC    B'00000000'              NONE                            61780002
* OP CODES 7X                                                           61800002
         DC    B'00000000'              NONE                            61820002
         DC    B'00000000'              NONE                            61840002
* OP CODES 8X                                                           61860002
         DC    B'00000000'              NONE                            61880002
         DC    B'00000000'              NONE                            61900002
* OP CODES 9X                                                           61920002
         DC    B'00001000'              RELEASE                         61940002
         DC    B'00000000'              NONE                            61960002
* OP CODES AX                                                           61980002
         DC    B'00000000'              NONE                            62000002
         DC    B'00000000'              NONE                            62020002
* OP CODES BX                                                           62040002
         DC    B'00001000'              RESERVE                         62060002
         DC    B'00000000'              NONE                            62080002
* OP CODES CX                                                           62100002
         DC    B'00000000'              NONE                            62120002
         DC    B'00000000'              NONE                            62140002
* OP CODES DX                                                           62160002
         DC    B'00000000'              NONE                            62180002
         DC    B'00000000'              NONE                            62200002
* OP CODES EX                                                           62220002
         DC    B'00000000'              NONE                            62240002
         DC    B'00000000'              NONE                            62260002
* OP CODES FX                                                           62280002
         DC    B'00000000'              NONE                            62300002
         DC    B'00000000'              NONE                            62320002
*                                                                       62340002
*        THE FOLLOWING TABLE CONTAINS THE MASK FOR TESTING THE OP       62360002
*        CODE BIT MAP BYTE.                                             62380002
*                                                                       62400002
         DS    0X                                                       62420002
KMASKOP  EQU   *                        *                               62440002
         DC    X'80'                    TEST BIT 0                      62460002
         DC    X'40'                    TEST BIT 1                      62480002
         DC    X'20'                    TEST BIT 2                      62500002
         DC    X'10'                    TEST BIT 3                      62520002
         DC    X'08'                    TEST BIT 4                      62540002
         DC    X'04'                    TEST BIT 5                      62560002
         DC    X'02'                    TEST BIT 6                      62580002
         DC    X'01'                    TEST BIT 7                      62600002
         EJECT                                                          62620002
*********************************************************************** 62640002
*                                                                     * 62660002
*        POSITION TABLE                                               * 62680002
*                                                                     * 62700002
*        THIS TABLE CONTAINS VALUES WHICH RELATE AN OP CODE TO A      * 62720002
*        RELATIVE POSITION WITH A RECORD OR TO A SPECIFIC AREA        * 62740002
*        ON THE TRACK SUCH AS HOME ADDRESS OR RECORD ZERO.  BITS 3-5  * 62760002
*        OF THE OP CODE DETERMINE THE AREA WHICH THE OPERATION        * 62780002
*        STARTS.  THESE THREE BITS ARE THE COUNT, KEY, AND DATA BITS  * 62800002
*        OF THE OP CODE.                                              * 62820002
*                                                                     * 62840002
*        THE FOLLOWING VALUES REPRESENT THE AREAS OF A TRACK.         * 62860002
*              1 = BEFORE COUNT                                       * 62880002
*              2 = BEFORE KEY                                         * 62900002
*              3 = BEFORE DATA                                        * 62920002
*              4 = AFTER DATA                                         * 62940002
*              5 = BEFORE HOME ADDRESS                                * 62960002
*              6 = BEFORE R0 (AFTER A HOME ADDRESS COMMAND)           * 62980002
*              7 = AFTER R0 (FOLLOWING AN R0 COMMAND)                 * 63000002
*                                                                     * 63020002
*        THE TABLE CONSISTS OF HALFWORK VALUES WHICH MAP THE          * 63040002
*        SETTINGS OF BITS 3-5 OF THE OP CODE INTO A SUBSET OF THE     * 63060002
*        VALUES ABOVE.  THIS IS DONE BY USING THE BITS (SHIFTED       * 63080002
*        ONE TO THE RIGHT) TO INDEX INTO THE TABLE.  SEE REMARKS      * 63100002
*        IN THE TABLE FOR THE RELATIONSHIP.                           * 63120002
*                                                                     * 63140002
*********************************************************************** 63160002
*                                                                       63180002
         DS    0H                       ALIGNMENT                       63200002
KPOSTAB  EQU   *                        *                               63220002
*                                       BITS 3-5  POSITION (COMMANDS)   63240002
KPOSSCKD DC    H'1'                     '000'     COUNT (SPECIAL WRITE) 63260002
KPOSDATA DC    H'3'                     '001'     DATA  (DATA)          63280002
KPOSKEY  DC    H'2'                     '010'     KEY  (KEY)            63300002
KPOSKEYD DC    H'2'                     '011'     KEY  (KEY AND DATA)   63320002
KPOSCNT  DC    H'1'                     '100'     COUNT (COUNT)         63340002
KPOSR0   DC    H'6'                     '101'     RECORD ZERO  (R0)     63360002
KPOSHA   DC    H'5'                     '110'     HOME ADDRESS  (HA)    63380002
KPOSCKD  DC    H'1'                     '111'     COUNT (CNT,KEY,DATA)  63400002
         EJECT                                                          63420002
*********************************************************************** 63440002
*                                                                     * 63460002
*        SENSE BYTE TABLES                                            * 63480002
*                                                                     * 63500002
*        THESE TABLES ARE USED TO POST THE IOB WITH THE CORRECT SENSE * 63520002
*        BYTES.  THIS IS DONE SINCE THE SENSES BYTES ARE NOT CONSIST- * 63540002
*        SISTENT ACCROSS DEVICES.  HENCE, WHEN AN ERROR IS DETECTED,  * 63560002
*        A DISPLACEMENT IS CALCULATED (USING DSECT ERRTABLE) SO THAT  * 63580002
*        WHEN IT IS TIME TO POST THE SENSE IT ONLY HAS TO BE DETER-   * 63600002
*        MINED WHICH TABLE TO USE FOR THE ERROR FOR THE GIVEN DEVICE. * 63620002
*                                                                     * 63640002
*        SEE DSECT ERRTABLE FOR THE ERROR REASONS.                    * 63660002
*                                                                     * 63680002
*********************************************************************** 63700002
*                                                                       63720002
*                                                                       63740002
*              THE FOLLOWING EQUATES ARE USED TO INDICATE A ZERO SENSE  63760002
*              BYTE.                                                    63780002
*                                                                       63800002
NOSENS0  EQU   X'00'                    ZERO SENSE BYTE ZERO            63820002
NOSENS1  EQU   X'00'                    ZERO SENSE BYTE ONE             63840002
*                                                                       63860002
*              THE REMEAINDER OF THE EQUATES USED IN THESE TABLES ARE   63880002
*              DEFINED IN THE IOB DSECT.                                63900002
*                                                                       63920002
*                                                                       63940002
*              THE FOLLOWING TABLE IS USED WHEN THE DEVICE IS A 2314    63960002
*                                                                       63980002
         DS    0H                       ALIGNMENT                       64000002
KERRTAB1 EQU   *                        *                               64020002
*                                                                       64040002
* ERROR00 - INDICATES NO SENSE RELATED ERROR                            64060002
*                                                                       64080002
         DC    AL1(NOSENS0)             ZERO SENSE                      64100002
         DC    AL1(NOSENS1)             ZERO SENSE                      64120002
*                                                                       64140002
* ERROR01 - SEE DSECT ERRTABLE FOR ERROR DESCRIPTION                    64160002
*                                                                       64180002
         DC    AL1(IOBCMDRJ)            X'80' COMMAND REJECT            64200002
         DC    AL1(NOSENS1)             X'00' ZERO SENSE BYTE           64220002
*                                                                       64240002
* ERROR02 - SEE DSECT ERRTABLE FOR ERROR DESCRIPTION                    64260002
*                                                                       64280002
         DC    AL1(IOBCMDRJ)            X'80' COMMAND REJECT            64300002
         DC    AL1(IOBINVSQ)            X'10' INVALID SEQUENCE          64320002
*                                                                       64340002
* ERROR03 - SEE DSECT ERRTABLE FOR ERROR DESCRIPTION                    64360002
*                                                                       64380002
         DC    AL1(IOBCMDRJ+IOBSKCHK)   X'81' COMMAND REJECT AND SEEK   64400002
*                                             CHECK                     64420002
         DC    AL1(NOSENS1)             X'00' ZERO SENSE BYTE           64440002
*                                                                       64460002
* ERROR04 - SEE DSECT ERRTABLE FOR ERROR DESCRIPTION                    64480002
*                                                                       64500002
         DC    AL1(IOBCMDRJ)            X'80' COMMAND REJECT            64520002
         DC    AL1(IOBFILEP)            X'04' FILE PROTECT              64540002
*                                                                       64560002
* ERROR05 - SEE DSECT ERRTABLE FOR ERROR DESCRIPTION                    64580002
*                                                                       64600002
         DC    AL1(NOSENS0)             X'00' ZERO SENSE BYTE           64620002
         DC    AL1(IOBTOVRN)            X'40' TRACK OVERRUN             64640002
*                                                                       64660002
* ERROR06 - SEE DSECT ERRTABLE FOR ERROR DESCRIPTION                    64680002
*                                                                       64700002
         DC    AL1(NOSENS0)             X'00' ZERO SENSE BYTE           64720002
         DC    AL1(IOBNRECF)            X'08' NO RECORD FOUND           64740002
*                                                                       64760002
* ERROR07 - SEE DSECT ERRTABLE FOR ERROR DESCRIPTION                    64780002
*                                                                       64800002
         DC    AL1(NOSENS0)             X'00' ZERO SENSE BYTE           64820002
         DC    AL1(IOBFILEP)            X'04' FILE PROTECT              64840002
*                                                                       64860002
* ERROR08 - SEE DSECT ERRTABLE FOR ERROR DESCRIPTION                    64880002
*                                                                       64900002
         DC    AL1(NOSENS0)             X'00' ZERO SENSE BYTE           64920002
         DC    AL1(IOBFILEP)            X'04' FILE PROTECT              64940002
*                                                                       64960002
* ERROR09 - SEE DSECT ERRTABLE FOR ERROR DESCRIPTION                    64980002
*                                                                       65000002
         DC    AL1(NOSENS0)             X'00' ZERO SENSE BYTE           65020002
         DC    AL1(IOBFILEP+IOBOVINC)   X'05' FILE PROTECT AND OVER-    65040002
*                                             FLOW INCOMPLETE           65060002
*                                                                       65080002
* ERROR10 - SEE DSECT ERRTABLE FOR ERROR DESCRIPTION                    65100002
*                                                                       65120002
         DC    AL1(NOSENS0)             X'00' ZERO SENSE BYTE           65140002
         DC    AL1(IOBEOCYL)            X'20' END OF CYLINDER           65160002
*                                                                       65180002
* ERROR11 - SEE DSECT ERRTABLE FOR ERROR DESCRIPTION                    65200002
*                                                                       65220002
         DC    AL1(NOSENS0)             X'00' ZERO SENSE BYTE           65240002
         DC    AL1(IOBEOCYL+IOBOVINC)   X'21' END OF CYLINDER AND       65260002
*                                             OVERFLOW INCOMPLETE       65280002
*                                                                       65300002
*                                                                       65320002
*              THE FOLLOWING TABLE IS USED FOR ALL DEVICES OTHER THAN   65340002
*              THE 2314 DEVICE.                                         65360002
*                                                                       65380002
         DS    0H                       ALIGNMENT                       65400002
KERRTAB2 EQU   *                        *                               65420002
*                                                                       65440002
* ERROR00 - INDICATES NO SENSE RELATED ERROR                            65460002
*                                                                       65480002
         DC    AL1(NOSENS0)             ZERO SENSE                      65500002
         DC    AL1(NOSENS1)             ZERO SENSE                      65520002
*                                                                       65540002
* ERROR01 - SEE DSECT ERRTABLE FOR ERROR DESCRIPTION                    65560002
*                                                                       65580002
         DC    AL1(IOBCMDRJ)            X'80' COMMAND REJECT            65600002
         DC    AL1(NOSENS1)             X'00' ZERO SENSE BYTE           65620002
*                                                                       65640002
* ERROR02 - SEE DSECT ERRTABLE FOR ERROR DESCRIPTION                    65660002
*                                                                       65680002
         DC    AL1(IOBCMDRJ)            X'80' COMMAND REJECT            65700002
         DC    AL1(NOSENS1)             X'00' ZERO SENSE BYTE           65720002
*                                                                       65740002
* ERROR03 - SEE DSECT ERRTABLE FOR ERROR DESCRIPTION                    65760002
*                                                                       65780002
         DC    AL1(IOBCMDRJ)            X'80' COMMAND REJECT            65800002
         DC    AL1(NOSENS1)             X'00' ZERO SENSE BYTE           65820002
*                                                                       65840002
* ERROR04 - SEE DSECT ERRTABLE FOR ERROR DESCRIPTION                    65860002
*                                                                       65880002
         DC    AL1(IOBCMDRJ)            X'80' COMMAND REJECT            65900002
         DC    AL1(NOSENS1)             X'00' ZERO SENSE BYTE           65920002
*                                                                       65940002
* ERROR05 - SEE DSECT ERRTABLE FOR ERROR DESCRIPTION                    65960002
*                                                                       65980002
         DC    AL1(NOSENS0)             X'00' ZERO SENSE BYTE           66000002
         DC    AL1(IOBTOVRN)            X'40' TRACK OVERRUN             66020002
*                                                                       66040002
* ERROR06 - SEE DSECT ERRTABLE FOR ERROR DESCRIPTION                    66060002
*                                                                       66080002
         DC    AL1(NOSENS0)             X'00' ZERO SENSE BYTE           66100002
         DC    AL1(IOBNRECF)            X'08' NO RECORD FOUND           66120002
*                                                                       66140002
* ERROR07 - SEE DSECT ERRTABLE FOR ERROR DESCRIPTION                    66160002
*                                                                       66180002
         DC    AL1(NOSENS0)             X'00' ZERO SENSE BYTE           66200002
         DC    AL1(IOBFILEP)            X'04' FILE PROTECT              66220002
*                                                                       66240002
* ERROR08 - SEE DSECT ERRTABLE FOR ERROR DESCRIPTION                    66260002
*                                                                       66280002
         DC    AL1(NOSENS0)             X'00' ZERO SENSE BYTE           66300002
         DC    AL1(IOBFILEP)            X'04' FILE PROTECT              66320002
*                                                                       66340002
* ERROR09 - SEE DSECT ERRTABLE FOR ERROR DESCRIPTION                    66360002
*                                                                       66380002
         DC    AL1(NOSENS0)             X'00' ZERO SENSE BYTE           66400002
         DC    AL1(IOBFILEP+IOBOVINC)   X'05' FILE PROTECT AND OVER-    66420002
*                                             FLOW INCOMPLETE           66440002
*                                                                       66460002
* ERROR10 - SEE DSECT ERRTABLE FOR ERROR DESCRIPTION                    66480002
*                                                                       66500002
         DC    AL1(NOSENS0)             X'00' ZERO SENSE BYTE           66520002
         DC    AL1(IOBEOCYL)            X'20' END OF CYLINDER           66540002
*                                                                       66560002
* ERROR11 - SEE DSECT ERRTABLE FOR ERROR DESCRIPTION                    66580002
*                                                                       66600002
         DC    AL1(NOSENS0)             X'00' ZERO SENSE BYTE           66620002
         DC    AL1(IOBEOCYL+IOBOVINC)   X'21' END OF CYLINDER AND       66640002
*                                             OVERFLOW INCOMPLETE       66660002
         TITLE 'CHANNEL PROGRAM INTERPRETER -  MISCELLANEOUS CONSTANTS' 66680002
*********************************************************************** 66700002
*                                                                     * 66720002
*        MISCELLANEOUS CONSTANTS                                      * 66740002
*                                                                     * 66760002
*********************************************************************** 66780002
*                                                                       66800002
*                                                                       66820002
KCCWLGTH DS    0F                       LENGTH OF CCW                   66840002
KCNTLGTH DC    F'8'                     LENGTH OF COUNT                 66860002
*                                                                       66880002
KOPBRMSK DC    X'0000001C'              MASK FOR BYTES 3-5 OF OP CODE   66900002
*                                                                       66920002
KIOSSFM  DC    X'1F00000000000001'      SET FILE MASK CCW SKELETON      66940002
KIOSTIC  DC    X'0800000000000000'      TIC CCW SKELETON                66960002
KIOSSEEK DC    X'0700000000000006'      SEEK CCW SKELETON               66980002
BASEADDR DC    A(IDDWICPI)         BASE ADDR OF THIS MODULE     YM03980 66982002
*                                 USED FOR RETRY FROM FRR               66984002
         TITLE 'CHANNEL PROGRAM INTERPRETOR - PATCH AREA'               66990002
*********************************************************************** 67046602
*                                                                     * 67053302
*        PATCH AREA                                                   * 67060002
*                                                                     * 67080002
*********************************************************************** 67100002
*                                                                       67120002
CPIPATCH DC    10F'0'                   PATCH AREA                      67140002
         TITLE 'CHANNEL PROGRAM INTERPRETER -  ERROR TABLE DSECT'       67160002
*********************************************************************** 67180002
*                                                                     * 67200002
*        SENSE BYTE TABLE DSECT                                       * 67220002
*                                                                     * 67240002
*********************************************************************** 67260002
*                                                                       67280002
ERRTABLE DSECT                                                          67300002
*                                                                       67320002
ERRENTRY DS    0H                       LENGTH OF EACH ENTRY            67340002
*                                                                       67360002
*              THE FIRST POSITION OF EACH TABLE REPRESENTS A NO         67380002
*              SENSE BYTE RELATED ERROR.                                67400002
*                                                                       67420002
ERROR00  DS    H                        TWO SENSE BYTES FOR ERROR       67440002
ERR00DSP EQU   ERROR00-ERRTABLE         DISPLACEMENT FOR ERROR          67460002
*                                                                       67480002
*              THE FOLLOWING ERROR IS FOR                               67500002
*                  INVALID FILE MASK FORMAT                             67520002
*                  INVALID OP CODE                                      67540002
*                                                                       67560002
ERROR01  DS    H                        TWO SENSE BYTES FOR ERROR       67580002
ERR01DSP EQU   ERROR01-ERRTABLE         DISPLACEMENT FOR ERROR          67600002
*                                                                       67620002
*              THE FOLLOWING ERROR IS FOR                               67640002
*                  INVALID CHANNEL PROGRAM SEQUENCE                     67660002
*                                                                       67680002
ERROR02  DS    H                        TWO SENSE BYTES FOR ERROR       67700002
ERR02DSP EQU   ERROR02-ERRTABLE         DISPLACEMENT FOR ERROR          67720002
*                                                                       67740002
*              THE FOLLOWING ERROR IS FOR                               67760002
*                  INVALID SEEK ARGUMENT                                67780002
*                                                                       67800002
ERROR03  DS    H                        TWO SENSE BYTES FOR ERROR       67820002
ERR03DSP EQU   ERROR03-ERRTABLE         DISPLACEMENT FOR ERROR          67840002
*                                                                       67860002
*              THE FOLLOWING ERROR IS FOR                               67880002
*                  WRITE FILE MASK VIOLATION                            67900002
*                                                                       67920002
ERROR04  DS    H                        TWO SENSE BYTES FOR ERROR       67940002
ERR04DSP EQU   ERROR04-ERRTABLE         DISPLACEMENT FOR ERROR          67960002
*                                                                       67980002
*              THE FOLLOWING ERROR IS FOR                               68000002
*                  TRACK OVERRUN CONDITION                              68020002
*                                                                       68040002
ERROR05  DS    H                        TWO SENSE BYTES FOR ERROR       68060002
ERR05DSP EQU   ERROR05-ERRTABLE         DISPLACEMENT FOR ERROR          68080002
*                                                                       68100002
*              THE FOLLOWING ERROR IS FOR                               68120002
*                  NO RECORD FOUND CONDITION                            68140002
*                                                                       68160002
ERROR06  DS    H                        TWO SENSE BYTES FOR ERROR       68180002
ERR06DSP EQU   ERROR06-ERRTABLE         DISPLACEMENT FOR ERROR          68200002
*                                                                       68220002
*              THE FOLLOWING ERROR IS FOR                               68240002
*                  FILE MASK VIOLATION ON A SEEK                        68260002
*                                                                       68280002
ERROR07  DS    H                        TWO SENSE BYTES FOR ERROR       68300002
ERR07DSP EQU   ERROR07-ERRTABLE         DISPLACEMENT FOR ERROR          68320002
*                                                                       68340002
*              THE FOLLOWING ERROR IS FOR                               68360002
*                  FILE MASK VIOLATION FOR A MULTITRACK READ OR SEARCH  68380002
*                                                                       68400002
ERROR08  DS    H                        TWO SENSE BYTES FOR ERROR       68420002
ERR08DSP EQU   ERROR08-ERRTABLE         DISPLACEMENT FOR ERROR          68440002
*                                                                       68460002
*              THE FOLLOWING ERROR IS FOR                               68480002
*                  FILE MASK VIOLATION FOR A MULTITRACK READ OR SEARCH  68500002
*                  WHEN THE REC BEING PROCESSED IS AN OVERFLOW RECORD   68520002
*                                                                       68540002
ERROR09  DS    H                        TWO SENSE BYTES FOR ERROR       68560002
ERR09DSP EQU   ERROR09-ERRTABLE         DISPLACEMENT FOR ERROR          68580002
*                                                                       68600002
*              THE FOLLOWING ERROR IS FOR                               68620002
*                  END OF CYLINDER REACHED                              68640002
*                                                                       68660002
ERROR10  DS    H                        TWO SENSE BYTES FOR ERROR       68680002
ERR10DSP EQU   ERROR10-ERRTABLE         DISPLACEMENT FOR ERROR          68700002
*                                                                       68720002
*              THE FOLLOWING ERROR IS FOR                               68740002
*                  END OF CYLINDER REACHED AND RECORD BEING PROCESSED   68760002
*                  IS AN OVERFLOW RECORD                                68780002
*                                                                       68800002
ERROR11  DS    H                        TWO SENSE BYTES FOR ERROR       68820002
ERR11DSP EQU   ERROR11-ERRTABLE         DISPLACEMENT FOR ERROR          68840002
         TITLE 'CHANNEL PROGRAM INTERPRETER -  VIRTUAL TRACK DSECT'     68914002
         IDDTRACK                                                       68920502
         TITLE 'CHANNEL PROGRAM INTERPRETER -  CCW DSECT'               68927002
*********************************************************************** 68933502
*                                                                     * 68940002
*        CHANNEL COMMAND WORD DESCRIPTION                             * 68960002
*                                                                     * 68980002
*********************************************************************** 69000002
*                                                                       69020002
*                                                                       69040002
CCWDES   DSECT                                                          69060002
CCW      DS    0CL8                     LENGTH OF CCW                   69080002
*                                                                       69100002
CCWOPCDE DS    XL1                      OPERATION CODE                  69120002
*                                                                       69140002
CCWMLTRK EQU   X'80'                    MULTITRACKING BIT               69160002
CCWHICON EQU   X'40'                    SEARCH HIGH CONDITION BIT       69180002
CCWEQCON EQU   X'20'                    SEARCH EQUAL CONDITION BIT      69200002
CCWUSECT EQU   X'10'                    USE COUNT AREA BIT              69220002
CCWTICBT EQU   X'08'                    TIC BIT WHEN BITS 5-7 ARE ZERO  69240002
CCWUSEKY EQU   X'08'                    USE KEY AREA BIT                69260002
CCWUSEDT EQU   X'04'                    USE DATA AREA BIT               69280002
CCWTYPE  EQU   X'03'                    BITS 6-7 DESCRIBE TYPE          69300002
CCWCNTRL EQU   X'03'                    '11' CONTROL                    69320002
CCWREAD  EQU   X'02'                    '10' READ                       69340002
CCWSRCH  EQU   X'01'                    '01' SEARCH                     69360002
CCWWRITE EQU   X'01'                    '01' WRITE                      69380002
CCWSENSE EQU   X'00'                    '00' SENSE                      69400002
         ORG   CCW                      BEGINNING OF CCW                69420002
CCWDATAD DS    A                        ADDRESS FIELD                   69440002
*                                                                       69460002
CCWFLAGS DS    XL1                      FLAG BYTE                       69480002
*                                                                       69500002
CCWDC    EQU   X'80'                    DATA CHAINING                   69520002
CCWCC    EQU   X'40'                    COMMAND CHAINING                69540002
CCWSILI  EQU   X'20'                    SUPPRESS INCORRECT LENGTH       69560002
CCWSKIP  EQU   X'10'                    SKIP DATA TRANSFER              69580002
*                                                                       69600002
CCWPCI   EQU   X'08'                    PROGRAM CONTROLLED INTERRUPT    69620002
CCWLOW3  EQU   X'07'                    MUST BE ZERO                    69640002
         DS    XL1                      UNUSED                          69660002
CCWCOUNT DS    H                        BYTE COUNT                      69680002
         TITLE 'CHANNEL PROGRAM INTERPRETER -  COUNT FIELD DSECT'       69700002
*********************************************************************** 69720002
*                                                                     * 69740002
*        THE FOLLOWING DESCRIBES THE COUNT AREA OF A RECORD           * 69760002
*                                                                     * 69780002
*********************************************************************** 69800002
*                                                                       69820002
*                                                                       69840002
COUNTDES DSECT                                                          69860002
CNTFIELD DS    0CL8                     LENGTH OF COUNT AREA            69880002
*                                                                       69900002
CNTID    DS    CL5                      FIVE BYTE ID USUALLY OF THE     69920002
*                                       FORM CCHHR                      69940002
CNTKL    DS    AL1                      KEY LENGTH OF RECORD            69960002
CNTDL    DS    AL2                      DATA LENGTH OF RECORD           69980002
         TITLE 'CHANNEL PROGRAM INTERPRETER -  DASD ADDRESS DSECT'      70000002
*********************************************************************** 70020002
*                                                                     * 70040002
*        SEEK ARGUMENT DESCRIPTION USED IN CONJUNCTION WITH SEEK      * 70060002
*        COMMANDS.                                                    * 70080002
*                                                                     * 70100002
*********************************************************************** 70120002
*                                                                       70140002
*                                                                       70160002
DASDADDR DSECT                                                          70180002
DASDARG  DS    0CL6                     ADDRESS DESCPRITION             70200002
DASDBB   DS    CL2                      BB - BIN NUMBER                 70220002
DASDCC   DS    CL2                      CC - CYLINDER NUMBER            70240002
DASDHH   DS    CL2                      HH - HEAD NUMBER                70260002
         TITLE 'CHANNEL PROGRAM INTERPRETER -  IOB DSECT'               70280002
*********************************************************************** 70300002
*                                                                     * 70320002
*        IOB DESCRIPTION                                              * 70340002
*                                                                     * 70360002
*        THE STANDARD DSECT IS INVOKED BY CODING THE CALLING MACRO    * 70380002
*        IEZIOB.  THIS IS FOLLOWED BY EQUATES CODED IN THIS MODULE    * 70400002
*        TO DESCRIBE THE SENSE BYTES 0 AND 1.  THESE EQUATES APPEAR   * 70420002
*        IMMEDIATELY FOLLOWING THE INCLUDED DSECT AND GIVE MORE       * 70440002
*        MEANINGFUL DESCRIPTIONS FOR THE 2 SENSE BYTES AS THEY ARE    * 70460002
*        USED FOR DIRECT ACCESS DEVICES.  IN ADDITION, A DETAILED     * 70480002
*        DESCRIPTION OF THE CSW IS CODED FOLLOWING THE EQUATES FOR    * 70500002
*        THE SENSE BYTES.                                             * 70520002
*                                                                     * 70540002
*********************************************************************** 70560002
*                                                                       70580002
         IEZIOB                                                         70600002
*                                                                       70620002
*********************************************************************** 70640002
*                                                                     * 70660002
*        SENSE BYTE EQUATES                                           * 70680002
*                                                                     * 70700002
*        THE FOLLOWING EQUATES GIVE THE DIRECT ACCESS USE FOR SENSE   * 70720002
*        BYTES 0 AND 1 DEFINED IN THE IOB DSECT                       * 70740002
*                                                                     * 70760002
*********************************************************************** 70780002
*                                                                       70800002
*        SENSE BYTE 0                                                   70820002
*                                                                       70840002
IOBCMDRJ EQU   IOBS0B0                  X'80'-COMMAND REJECT            70860002
IOBINTRQ EQU   IOBS0B1                  X'40'-INTERVENTION REQUIRED     70880002
IOBBUSPR EQU   IOBS0B2                  X'20'-BUS OUT PARITY            70900002
IOBEQUIP EQU   IOBS0B3                  X'10'-EQUIPMENT CHECK           70920002
*                                                                       70940002
IOBDATCK EQU   IOBS0B4                  X'08'-DATA CHECK                70960002
IOBOVRUN EQU   IOBS0B5                  X'04'-OVERRUN                   70980002
IOBTRKCD EQU   IOBS0B6                  X'02'-TRACK CONDITION           71000002
IOBSKCHK EQU   IOBS0B7                  X'01'-SEEK CHECK                71020002
*                                                                       71040002
*        SENSE BYTE 1                                                   71060002
*                                                                       71080002
IOBDATCT EQU   IOBS1B0                  X'80'-DATA CHECK COUNT FIELD    71100002
IOBTOVRN EQU   IOBS1B1                  X'40'-TRACK OVERRUN             71120002
IOBEOCYL EQU   IOBS1B2                  X'20'-END OF CYLINDER           71140002
IOBINVSQ EQU   IOBS1B3                  X'10'-INVALID SEQUENCE          71160002
*                                                                       71180002
IOBNRECF EQU   IOBS1B4                  X'08'-NO RECORD FOUND           71200002
IOBFILEP EQU   IOBS1B5                  X'04'-FILE PROTECT              71220002
IOBNAMRK EQU   IOBS1B6                  X'02'-MISSING ADDRESS MARKER    71240002
IOBOVINC EQU   IOBS1B7                  X'01'-OVERFLOW INCOMPLETE       71260002
*                                                                       71280002
*                                                                     * 71300002
*********************************************************************** 71320002
*                                                                     * 71340002
*        DESCRIBE THE CSW                                             * 71360002
*                                                                     * 71380002
*********************************************************************** 71400002
*                                                                       71420002
         ORG   IOBCSW                   START AT IOBCSW                 71440002
IOBCSWCA DS    AL3                      COMMAND ADDRESS                 71460002
*                                                                       71480002
IOBCSWS0 DS    CL1                      STATUS BYTE ZERO                71500002
*                                                                       71520002
IOBCSWAT EQU   X'80'                    ATTENTION                       71540002
IOBCSWSM EQU   X'40'                    STATUS MODIFIER                 71560002
IOBCSWCU EQU   X'20'                    CONTROL UNIT END                71580002
IOBCSWBS EQU   X'10'                    BUSY                            71600002
*                                                                       71620002
IOBCSWCE EQU   X'08'                    CHANNEL END                     71640002
IOBCSWDE EQU   X'04'                    DEVICE END                      71660002
IOBCSWUC EQU   X'02'                    UNIT CHECK                      71680002
IOBCSWUE EQU   X'01'                    UNIT EXCEPTION                  71700002
*                                                                       71720002
IOBCSWS1 DS    CL1                      STATUS BYTE ONE                 71740002
*                                                                       71760002
IOBCSWPI EQU   X'80'                    PROGRAM CONTROLLED INTERRUPT    71780002
IOBCSWIL EQU   X'40'                    INCORRECT LENGTH                71800002
IOBCSWPG EQU   X'20'                    PROGRAM CHECK                   71820002
IOBCSWPT EQU   X'10'                    PROTECTION CHECK                71840002
*                                                                       71860002
IOBCSWCD EQU   X'08'                    CHANNEL DATA CHECK              71880002
IOBCSWCC EQU   X'04'                    CHANNEL CONTROL CHECK           71900002
IOBCSWIC EQU   X'02'                    INTERFACE CONTROL CHECK         71920002
IOBCSWCH EQU   X'01'                    CHAINING CHECK                  71940002
*                                                                       71960002
IOBCSWBC DS    AL2                      BYTE COUNT                      71980002
         TITLE 'CHANNEL PROGRAM INTERPRETER -  VDSCB DSECT'             72000002
         IDDVDSCB                                                       72020002
         TITLE 'CHANNEL PROGRAM INTERPRETER -  VBPPL DSECT'             72040002
         IDDVBPPL                                                       72060002
         TITLE 'CHANNEL PROGRAM INTERPRETER -  WICB DSECT'              72080002
         IDDWICB                                                        72100002
         END                                                            72120002
